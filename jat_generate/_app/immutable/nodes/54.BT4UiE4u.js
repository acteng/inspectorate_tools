import{s as je,y as re,z as se,l as _t,u as gt,r as pt,v as dt,E as be,k as Te,S as jt,x as we,a as F,g as z,i as k,f as d,H as Me,Y as Ct,e as R,c as W,b as Y,p as le,h as B,G as ae,o as $t,q as X,L as Ne,t as G,M as Ae,d as H,n as Se,m as Le,j as ue,w as Mt,V as Je}from"../chunks/scheduler.NGc5rx4B.js";import{S as ye,i as Ee,e as fe,c as A,a as P,m as D,t as v,b as j,d as U,g as me,f as ce}from"../chunks/index.CXr-pTxM.js";import{e as ge}from"../chunks/each.C0Oa3ZQW.js";import{C as ze,B as Lt}from"../chunks/ClickableCard.Dy0Gc3SI.js";import{D as qe}from"../chunks/DefaultButton.HZ4Q0i-3.js";import{S as ve}from"../chunks/SecondaryButton.DY728Lpc.js";/* empty css                                                    */import{T as Oe}from"../chunks/TextInput.B2MdnKN0.js";import{W as Ge}from"../chunks/WarningButton.B2__z57s.js";import{s as te}from"../chunks/data.C_0TZsja.js";import{g as St}from"../chunks/globals.D0QH3NT1.js";import{c as Ve}from"../chunks/index.DjoUhx1q.js";import{L as yt,h as Et,d as he,q as It,t as Tt,v as Ue,M as Nt,b as At,C as Pt,G as Xe,w as Be,x as Re,f as Dt,P as ht}from"../chunks/index.njNJ3Y3r.js";import{g as Fe,t as Ut}from"../chunks/index.BHS7OAsp.js";import{c as de}from"../chunks/colors.DaC397qr.js";import{G as Bt,I as Pe,p as Ft}from"../chunks/pan.SyiJiewp.js";import{M as zt,a as Ie,B as qt,G as Ot,S as Gt,C as Ht}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.C1IoIm-1.js";import"../chunks/paths.By4F8VuA.js";import{C as Jt}from"../chunks/CollapsibleCard.CecXaQdy.js";import{T as vt}from"../chunks/TextArea.T6odI4uv.js";import{R as We}from"../chunks/Radio.lfhmTBy6.js";function Vt(n){let e;const l=n[16].default,t=_t(l,n,n[24],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16777216)&&gt(t,l,o,o[24],e?dt(l,o[24],i,null):pt(o[24]),null)},i(o){e||(v(t,o),e=!0)},o(o){j(t,o),e=!1},d(o){t&&t.d(o)}}}function Xt(n){let e,l,t;function o(r){n[17](r)}let i={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Vt]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.hovered=n[0]),e=new yt({props:i}),re.push(()=>fe(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,a){D(e,r,a),t=!0},p(r,[a]){const s={};a&2&&(s.id=r[1]),a&4&&(s.source=r[2]),a&8&&(s.sourceLayer=r[3]),a&16&&(s.beforeId=r[4]),a&32&&(s.beforeLayerType=r[5]),a&64&&(s.paint=r[6]),a&128&&(s.layout=r[7]),a&256&&(s.filter=r[8]),a&512&&(s.applyToClusters=r[9]),a&1024&&(s.minzoom=r[10]),a&2048&&(s.maxzoom=r[11]),a&4096&&(s.hoverCursor=r[12]),a&8192&&(s.manageHoverState=r[13]),a&16384&&(s.eventsIfTopMost=r[14]),a&32768&&(s.interactive=r[15]),a&16777216&&(s.$$scope={dirty:a,ctx:r}),!l&&a&1&&(l=!0,s.hovered=r[0],se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){U(e,r)}}}function Rt(n,e,l){let{$$slots:t={},$$scope:o}=e,{id:i=Et("symbol")}=e,{source:r=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:c=void 0}=e,{layout:p=void 0}=e,{filter:_=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:S=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:E=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:N=!0}=e;function f(C){$=C,l(0,$)}function g(C){be.call(this,n,C)}function T(C){be.call(this,n,C)}function Q(C){be.call(this,n,C)}function ee(C){be.call(this,n,C)}function x(C){be.call(this,n,C)}function J(C){be.call(this,n,C)}return n.$$set=C=>{"id"in C&&l(1,i=C.id),"source"in C&&l(2,r=C.source),"sourceLayer"in C&&l(3,a=C.sourceLayer),"beforeId"in C&&l(4,s=C.beforeId),"beforeLayerType"in C&&l(5,m=C.beforeLayerType),"paint"in C&&l(6,c=C.paint),"layout"in C&&l(7,p=C.layout),"filter"in C&&l(8,_=C.filter),"applyToClusters"in C&&l(9,w=C.applyToClusters),"minzoom"in C&&l(10,S=C.minzoom),"maxzoom"in C&&l(11,I=C.maxzoom),"hoverCursor"in C&&l(12,M=C.hoverCursor),"manageHoverState"in C&&l(13,E=C.manageHoverState),"hovered"in C&&l(0,$=C.hovered),"eventsIfTopMost"in C&&l(14,b=C.eventsIfTopMost),"interactive"in C&&l(15,N=C.interactive),"$$scope"in C&&l(24,o=C.$$scope)},[$,i,r,a,s,m,c,p,_,w,S,I,M,E,b,N,t,f,g,T,Q,ee,x,J,o]}class Wt extends ye{constructor(e){super(),Ee(this,e,Rt,Xt,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Zt=Object.defineProperty,Kt=(n,e)=>Zt(n,"name",{value:e,configurable:!0});function bt(n,e,l,t={}){const o=Fe(n),i=he(o[0]),r=he(o[1]),a=he(l),s=It(e,t.units),m=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(a)),c=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(m)),p=Ue(c),_=Ue(m);return Tt([p,_],t.properties)}Kt(bt,"destination");var Ce=bt,Yt=Object.defineProperty,kt=(n,e)=>Yt(n,"name",{value:e,configurable:!0});function He(n,e,l={}){if(l.final===!0)return wt(n,e);const t=Fe(n),o=Fe(e),i=he(t[0]),r=he(o[0]),a=he(t[1]),s=he(o[1]),m=Math.sin(r-i)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(r-i);return Ue(Math.atan2(m,c))}kt(He,"bearing");function wt(n,e){let l=He(e,n);return l=(l+180)%360,l}kt(wt,"calculateFinalBearing");var ke=He;const Qt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ze(n,e,l){const t=n.slice();return t[36]=e[l],t[37]=e,t[38]=l,t}function Ke(n,e,l){const t=n.slice();return t[39]=e[l],t[40]=e,t[38]=l,t}function Ye(n){let e,l,t,o,i,r,a;return l=new Pe({props:{$$slots:{default:[tn]},$$scope:{ctx:n}}}),l.$on("click",function(){Ct(n[5])&&n[5].apply(this,arguments)}),o=new Pe({props:{$$slots:{default:[on]},$$scope:{ctx:n}}}),o.$on("click",n[17]),r=new Pe({props:{$$slots:{default:[sn]},$$scope:{ctx:n}}}),r.$on("click",n[18]),{c(){e=R("div"),A(l.$$.fragment),t=F(),A(o.$$.fragment),i=F(),A(r.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Y(e);P(l.$$.fragment,m),t=z(m),P(o.$$.fragment,m),i=z(m),P(r.$$.fragment,m),m.forEach(d),this.h()},h(){le(e,"class","control-panel svelte-1w3m76d")},m(s,m){k(s,e,m),D(l,e,null),B(e,t),D(o,e,null),B(e,i),D(r,e,null),a=!0},p(s,m){n=s;const c={};m[0]&1|m[1]&1024&&(c.$$scope={dirty:m,ctx:n}),l.$set(c);const p={};m[0]&1|m[1]&1024&&(p.$$scope={dirty:m,ctx:n}),o.$set(p);const _={};m[0]&1|m[1]&1024&&(_.$$scope={dirty:m,ctx:n}),r.$set(_)},i(s){a||(v(l.$$.fragment,s),v(o.$$.fragment,s),v(r.$$.fragment,s),a=!0)},o(s){j(l.$$.fragment,s),j(o.$$.fragment,s),j(r.$$.fragment,s),a=!1},d(s){s&&d(e),U(l),U(o),U(r)}}}function xt(n){let e;return{c(){e=G("Move map")},l(l){e=H(l,"Move map")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function en(n){let e,l="Move map";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Le(e)!=="svelte-1719ytd"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&d(e)}}}function tn(n){let e,l,t,o;function i(s,m){return s[0].mode=="select"?en:xt}let r=i(n),a=r(n);return{c(){e=R("img"),t=F(),a.c(),o=ae(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),t=z(s),a.l(s),o=ae(),this.h()},h(){$t(e.src,l=Ft)||le(e,"src",l),le(e,"alt","Move map"),X(e,"vertical-align","middle")},m(s,m){k(s,e,m),k(s,t,m),a.m(s,m),k(s,o,m)},p(s,m){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(o.parentNode,o)))},d(s){s&&(d(e),d(t),d(o)),a.d(s)}}}function nn(n){let e;return{c(){e=G("New arm")},l(l){e=H(l,"New arm")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function ln(n){let e,l="New arm";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Le(e)!=="svelte-1typ7gq"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&d(e)}}}function on(n){let e,l,t,o,i,r;function a(c,p){return c[0].mode=="new-arm"?ln:nn}let s=a(n),m=s(n);return{c(){e=Ne("svg"),l=Ne("circle"),t=Ne("text"),o=G("A"),i=F(),m.c(),r=ae(),this.h()},l(c){e=Ae(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var p=Y(e);l=Ae(p,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(l).forEach(d),t=Ae(p,"text",{x:!0,y:!0,fill:!0});var _=Y(t);o=H(_,"A"),_.forEach(d),p.forEach(d),i=z(c),m.l(c),r=ae(),this.h()},h(){le(l,"cx","12"),le(l,"cy","12"),le(l,"r","12"),le(l,"fill","white"),le(t,"x","6"),le(t,"y","16"),le(t,"fill","#4472c4"),le(e,"width","24"),le(e,"height","24"),le(e,"xmlns","http://www.w3.org/2000/svg"),X(e,"vertical-align","middle")},m(c,p){k(c,e,p),B(e,l),B(e,t),B(t,o),k(c,i,p),m.m(c,p),k(c,r,p)},p(c,p){s!==(s=a(c))&&(m.d(1),m=s(c),m&&(m.c(),m.m(r.parentNode,r)))},d(c){c&&(d(e),d(i),d(r)),m.d(c)}}}function rn(n){let e;return{c(){e=G("New movement")},l(l){e=H(l,"New movement")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function an(n){let e,l="New movement";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Le(e)!=="svelte-o92ucp"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&d(e)}}}function sn(n){let e,l,t,o;function i(s,m){return s[0].mode=="new-movement"?an:rn}let r=i(n),a=r(n);return{c(){e=R("img"),t=F(),a.c(),o=ae(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),t=z(s),a.l(s),o=ae(),this.h()},h(){$t(e.src,l=Qt)||le(e,"src",l),le(e,"alt","New movement"),X(e,"vertical-align","middle")},m(s,m){k(s,e,m),k(s,t,m),a.m(s,m),k(s,o,m)},p(s,m){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(o.parentNode,o)))},d(s){s&&(d(e),d(t),d(o)),a.d(s)}}}function fn(n){let e,l=kn(n[38])+"",t;return{c(){e=R("span"),t=G(l),this.h()},l(o){e=W(o,"SPAN",{class:!0});var i=Y(e);t=H(i,l),i.forEach(d),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(o,i){k(o,e,i),B(e,t)},p:Se,d(o){o&&d(e)}}}function Qe(n){let e,l,t;function o(s){n[19](s,n[39])}function i(){return n[20](n[38])}function r(){return n[21](n[38])}let a={draggable:!0,$$slots:{default:[fn]},$$scope:{ctx:n}};return n[39].point!==void 0&&(a.lngLat=n[39].point),e=new Ie({props:a}),re.push(()=>fe(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",r),{c(){A(e.$$.fragment)},l(s){P(e.$$.fragment,s)},m(s,m){D(e,s,m),t=!0},p(s,m){n=s;const c={};m[1]&1024&&(c.$$scope={dirty:m,ctx:n}),!l&&m[0]&70&&(l=!0,c.lngLat=n[39].point,se(()=>l=!1)),e.$set(c)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){U(e,s)}}}function un(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(d),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score]),X(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score]),t[0]&70&&X(e,"opacity",l[36].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&d(e)}}}function mn(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(d),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score])},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score])},d(l){l&&d(e)}}}function cn(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(d),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score]),X(e,"opacity","0%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score])},d(l){l&&d(e)}}}function xe(n){let e,l,t,o,i,r,a,s,m;function c(g){n[22](g,n[36])}function p(){return n[23](n[38])}function _(){return n[24](n[38])}let w={draggable:!0,$$slots:{default:[un]},$$scope:{ctx:n}};n[36].point1!==void 0&&(w.lngLat=n[36].point1),e=new Ie({props:w}),re.push(()=>fe(e,"lngLat",c)),e.$on("dragend",p),e.$on("click",_);function S(g){n[25](g,n[36])}function I(){return n[26](n[38])}function M(){return n[27](n[38])}let E={draggable:!0,$$slots:{default:[mn]},$$scope:{ctx:n}};n[36].point2!==void 0&&(E.lngLat=n[36].point2),o=new Ie({props:E}),re.push(()=>fe(o,"lngLat",S)),o.$on("dragend",I),o.$on("click",M);function $(g){n[28](g,n[36])}function b(){return n[29](n[38])}function N(){return n[30](n[38])}let f={draggable:!0,$$slots:{default:[cn]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(f.lngLat=n[36].point3),a=new Ie({props:f}),re.push(()=>fe(a,"lngLat",$)),a.$on("dragend",b),a.$on("click",N),{c(){A(e.$$.fragment),t=F(),A(o.$$.fragment),r=F(),A(a.$$.fragment)},l(g){P(e.$$.fragment,g),t=z(g),P(o.$$.fragment,g),r=z(g),P(a.$$.fragment,g)},m(g,T){D(e,g,T),k(g,t,T),D(o,g,T),k(g,r,T),D(a,g,T),m=!0},p(g,T){n=g;const Q={};T[0]&70|T[1]&1024&&(Q.$$scope={dirty:T,ctx:n}),!l&&T[0]&70&&(l=!0,Q.lngLat=n[36].point1,se(()=>l=!1)),e.$set(Q);const ee={};T[0]&70|T[1]&1024&&(ee.$$scope={dirty:T,ctx:n}),!i&&T[0]&70&&(i=!0,ee.lngLat=n[36].point2,se(()=>i=!1)),o.$set(ee);const x={};T[0]&70|T[1]&1024&&(x.$$scope={dirty:T,ctx:n}),!s&&T[0]&70&&(s=!0,x.lngLat=n[36].point3,se(()=>s=!1)),a.$set(x)},i(g){m||(v(e.$$.fragment,g),v(o.$$.fragment,g),v(a.$$.fragment,g),m=!0)},o(g){j(e.$$.fragment,g),j(o.$$.fragment,g),j(a.$$.fragment,g),m=!1},d(g){g&&(d(t),d(r)),U(e,g),U(o,g),U(a,g)}}}function _n(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ue(l,e)},d(t){t&&d(l)}}}function gn(n){let e,l;return e=new ht({props:{$$slots:{default:[_n,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o[1]&1040&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function pn(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ue(l,e)},d(t){t&&d(l)}}}function dn(n){let e,l;return e=new ht({props:{$$slots:{default:[pn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o[1]&1040&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function $n(n){let e,l,t,o,i,r;return e=new Be({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Re(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[gn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Be({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Re(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[dn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),i=new Wt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),A(i.$$.fragment)},l(a){P(e.$$.fragment,a),l=z(a),P(t.$$.fragment,a),o=z(a),P(i.$$.fragment,a)},m(a,s){D(e,a,s),k(a,l,s),D(t,a,s),k(a,o,s),D(i,a,s),r=!0},p(a,s){const m={};s[1]&1024&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){r||(v(e.$$.fragment,a),v(t.$$.fragment,a),v(i.$$.fragment,a),r=!0)},o(a){j(e.$$.fragment,a),j(t.$$.fragment,a),j(i.$$.fragment,a),r=!1},d(a){a&&(d(l),d(o)),U(e,a),U(t,a),U(i,a)}}}function hn(n){let e,l,t,o;return e=new Be({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Dt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment)},l(i){P(e.$$.fragment,i),l=z(i),P(t.$$.fragment,i)},m(i,r){D(e,i,r),k(i,l,r),D(t,i,r),o=!0},p:Se,i(i){o||(v(e.$$.fragment,i),v(t.$$.fragment,i),o=!0)},o(i){j(e.$$.fragment,i),j(t.$$.fragment,i),o=!1},d(i){i&&d(l),U(e,i),U(t,i)}}}function vn(n){let e,l,t,o,i,r,a,s,m,c,p,_,w;e=new zt({}),e.$on("click",n[10]);let S=n[0].mode!="editing"&&Ye(n);o=new Pt({props:{gj:n[6].summary.networkMap,show:n[3]}});let I=ge(n[6].jat[n[1]][n[2]].arms),M=[];for(let f=0;f<I.length;f+=1)M[f]=Qe(Ke(n,I,f));const E=f=>j(M[f],1,1,()=>{M[f]=null});let $=ge(n[6].jat[n[1]][n[2]].movements),b=[];for(let f=0;f<$.length;f+=1)b[f]=xe(Ze(n,$,f));const N=f=>j(b[f],1,1,()=>{b[f]=null});return s=new Xe({props:{data:n[12](n[6]),$$slots:{default:[$n]},$$scope:{ctx:n}}}),c=new Xe({props:{data:n[8],$$slots:{default:[hn]},$$scope:{ctx:n}}}),_=new Bt({props:{map:n[7]}}),{c(){A(e.$$.fragment),l=F(),S&&S.c(),t=F(),A(o.$$.fragment),i=F();for(let f=0;f<M.length;f+=1)M[f].c();r=F();for(let f=0;f<b.length;f+=1)b[f].c();a=F(),A(s.$$.fragment),m=F(),A(c.$$.fragment),p=F(),A(_.$$.fragment)},l(f){P(e.$$.fragment,f),l=z(f),S&&S.l(f),t=z(f),P(o.$$.fragment,f),i=z(f);for(let g=0;g<M.length;g+=1)M[g].l(f);r=z(f);for(let g=0;g<b.length;g+=1)b[g].l(f);a=z(f),P(s.$$.fragment,f),m=z(f),P(c.$$.fragment,f),p=z(f),P(_.$$.fragment,f)},m(f,g){D(e,f,g),k(f,l,g),S&&S.m(f,g),k(f,t,g),D(o,f,g),k(f,i,g);for(let T=0;T<M.length;T+=1)M[T]&&M[T].m(f,g);k(f,r,g);for(let T=0;T<b.length;T+=1)b[T]&&b[T].m(f,g);k(f,a,g),D(s,f,g),k(f,m,g),D(c,f,g),k(f,p,g),D(_,f,g),w=!0},p(f,g){f[0].mode!="editing"?S?(S.p(f,g),g[0]&1&&v(S,1)):(S=Ye(f),S.c(),v(S,1),S.m(t.parentNode,t)):S&&(me(),j(S,1,1,()=>{S=null}),ce());const T={};if(g[0]&64&&(T.gj=f[6].summary.networkMap),g[0]&8&&(T.show=f[3]),o.$set(T),g[0]&86){I=ge(f[6].jat[f[1]][f[2]].arms);let J;for(J=0;J<I.length;J+=1){const C=Ke(f,I,J);M[J]?(M[J].p(C,g),v(M[J],1)):(M[J]=Qe(C),M[J].c(),v(M[J],1),M[J].m(r.parentNode,r))}for(me(),J=I.length;J<M.length;J+=1)E(J);ce()}if(g[0]&598){$=ge(f[6].jat[f[1]][f[2]].movements);let J;for(J=0;J<$.length;J+=1){const C=Ze(f,$,J);b[J]?(b[J].p(C,g),v(b[J],1)):(b[J]=xe(C),b[J].c(),v(b[J],1),b[J].m(a.parentNode,a))}for(me(),J=$.length;J<b.length;J+=1)N(J);ce()}const Q={};g[0]&64&&(Q.data=f[12](f[6])),g[1]&1024&&(Q.$$scope={dirty:g,ctx:f}),s.$set(Q);const ee={};g[0]&256&&(ee.data=f[8]),g[1]&1024&&(ee.$$scope={dirty:g,ctx:f}),c.$set(ee);const x={};g[0]&128&&(x.map=f[7]),_.$set(x)},i(f){if(!w){v(e.$$.fragment,f),v(S),v(o.$$.fragment,f);for(let g=0;g<I.length;g+=1)v(M[g]);for(let g=0;g<$.length;g+=1)v(b[g]);v(s.$$.fragment,f),v(c.$$.fragment,f),v(_.$$.fragment,f),w=!0}},o(f){j(e.$$.fragment,f),j(S),j(o.$$.fragment,f),M=M.filter(Boolean);for(let g=0;g<M.length;g+=1)j(M[g]);b=b.filter(Boolean);for(let g=0;g<b.length;g+=1)j(b[g]);j(s.$$.fragment,f),j(c.$$.fragment,f),j(_.$$.fragment,f),w=!1},d(f){f&&(d(l),d(t),d(i),d(r),d(a),d(m),d(p)),U(e,f),S&&S.d(f),U(o,f),Me(M,f),Me(b,f),U(s,f),U(c,f),U(_,f)}}}function bn(n){let e,l,t;function o(r){n[31](r)}let i={$$slots:{default:[vn]},$$scope:{ctx:n}};return n[7]!==void 0&&(i.map=n[7]),e=new Nt({props:i}),re.push(()=>fe(e,"map",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,a){D(e,r,a),t=!0},p(r,a){const s={};a[0]&511|a[1]&1024&&(s.$$scope={dirty:a,ctx:r}),!l&&a[0]&128&&(l=!0,s.map=r[7],se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){U(e,r)}}}function et(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function kn(n){return String.fromCharCode(n+65)}function wn(n,e,l){let t,o;Te(n,te,u=>l(6,o=u));let{junctionIdx:i}=e,{stage:r}=e,{mode:a}=e,{hoveringSidebar:s}=e,{streetviewOn:m}=e,{showContext:c}=e,{select:p}=e,{stopEditing:_}=e,w,S={0:de.red.background,1:de.amber.background,2:de.green.background,X:de.critical.background};function I(u,h,K){let O={type:"FeatureCollection",features:[]},_e=h.mode=="editing"?h.id:K;return _e!=null&&(_e.kind=="arm"?O.features.push(et(u.jat[i][r].arms[_e.idx],_e.idx)):O.features.push(b(u.jat[i][r].movements[_e.idx],_e.idx))),O}async function M(u){if(!m){for(let h of w.queryRenderedFeatures(u.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await _();return}a.mode=="new-arm"?(we(te,o.jat[i][r].arms=[...o.jat[i][r].arms,{point:u.detail.lngLat.toArray(),name:""}],o),await p({kind:"arm",idx:o.jat[i][r].arms.length-1})):(we(te,o.jat[i][r].movements=[...o.jat[i][r].movements,{point1:u.detail.lngLat.toArray(),point2:Ce(u.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Ce(u.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await p({kind:"movement",idx:o.jat[i][r].movements.length-1}))}}}async function E(u){await p({kind:"movement",idx:u.detail.features[0].id})}jt(()=>{f(!1)});function $(u){let h={type:"FeatureCollection",features:u.jat[i][r].movements.map((K,O)=>b(K,O))};for(let K of u.jat[i][r].movements)if(h.features.push(N(K,h.features.length)),K.kind=="walking & wheeling"){let O={...K,point1:K.point3,point3:K.point1};h.features.push(N(O,h.features.length))}return h}function b(u,h){return{type:"Feature",id:h,properties:{name:u.name,kind:u.kind,color:S[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2,u.point3]}}}function N(u,h){return{type:"Feature",id:h,properties:{kind:u.kind,color:S[u.score],angle:ke(u.point2,u.point3)},geometry:{type:"Point",coordinates:u.point3}}}function f(u){let h=$(o);for(let K of o.jat[i][r].arms)h.features.push(et(K,h.features.length));for(let K of o.summary.networkMap.features)h.features.push(K);h.features.length>0&&w.fitBounds(At(h),{padding:20,animate:u})}function g(){return w}const T=()=>l(0,a={mode:"new-arm"}),Q=()=>l(0,a={mode:"new-movement"});function ee(u,h){n.$$.not_equal(h.point,u)&&(h.point=u,te.set(o))}const x=u=>p({kind:"arm",idx:u}),J=u=>p({kind:"arm",idx:u});function C(u,h){n.$$.not_equal(h.point1,u)&&(h.point1=u,te.set(o))}const oe=u=>p({kind:"movement",idx:u}),Z=u=>p({kind:"movement",idx:u});function $e(u,h){n.$$.not_equal(h.point2,u)&&(h.point2=u,te.set(o))}const y=u=>p({kind:"movement",idx:u}),q=u=>p({kind:"movement",idx:u});function ne(u,h){n.$$.not_equal(h.point3,u)&&(h.point3=u,te.set(o))}const V=u=>p({kind:"movement",idx:u}),ie=u=>p({kind:"movement",idx:u});function L(u){w=u,l(7,w)}return n.$$set=u=>{"junctionIdx"in u&&l(1,i=u.junctionIdx),"stage"in u&&l(2,r=u.stage),"mode"in u&&l(0,a=u.mode),"hoveringSidebar"in u&&l(13,s=u.hoveringSidebar),"streetviewOn"in u&&l(14,m=u.streetviewOn),"showContext"in u&&l(3,c=u.showContext),"select"in u&&l(4,p=u.select),"stopEditing"in u&&l(5,_=u.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&8257&&l(8,t=I(o,a,s))},[a,i,r,c,p,_,o,w,t,S,M,E,$,s,m,f,g,T,Q,ee,x,J,C,oe,Z,$e,y,q,ne,V,ie,L]}class jn extends ye{constructor(e){super(),Ee(this,e,wn,bn,je,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showContext:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Cn(n){let e,l,t,o,i,r,a,s,m,c,p,_;function w(f){n[5](f)}let S={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(S.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Oe({props:S}),re.push(()=>fe(e,"value",w));function I(f){n[6](f)}let M={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(M.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),o=new We({props:M}),re.push(()=>fe(o,"value",I));function E(f){n[7](f)}let $={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),a=new We({props:$}),re.push(()=>fe(a,"value",E));function b(f){n[8](f)}let N={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(N.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),c=new vt({props:N}),re.push(()=>fe(c,"value",b)),{c(){A(e.$$.fragment),t=F(),A(o.$$.fragment),r=F(),A(a.$$.fragment),m=F(),A(c.$$.fragment)},l(f){P(e.$$.fragment,f),t=z(f),P(o.$$.fragment,f),r=z(f),P(a.$$.fragment,f),m=z(f),P(c.$$.fragment,f)},m(f,g){D(e,f,g),k(f,t,g),D(o,f,g),k(f,r,g),D(a,f,g),k(f,m,g),D(c,f,g),_=!0},p(f,[g]){const T={};!l&&g&15&&(l=!0,T.value=f[3].jat[f[0]][f[1]].movements[f[2]].name,se(()=>l=!1)),e.$set(T);const Q={};!i&&g&15&&(i=!0,Q.value=f[3].jat[f[0]][f[1]].movements[f[2]].kind,se(()=>i=!1)),o.$set(Q);const ee={};!s&&g&15&&(s=!0,ee.value=f[3].jat[f[0]][f[1]].movements[f[2]].score,se(()=>s=!1)),a.$set(ee);const x={};!p&&g&15&&(p=!0,x.value=f[3].jat[f[0]][f[1]].movements[f[2]].notes,se(()=>p=!1)),c.$set(x)},i(f){_||(v(e.$$.fragment,f),v(o.$$.fragment,f),v(a.$$.fragment,f),v(c.$$.fragment,f),_=!0)},o(f){j(e.$$.fragment,f),j(o.$$.fragment,f),j(a.$$.fragment,f),j(c.$$.fragment,f),_=!1},d(f){f&&(d(t),d(r),d(m)),U(e,f),U(o,f),U(a,f),U(c,f)}}}function Mn(n,e,l){let t;Te(n,te,_=>l(3,t=_));let{junctionIdx:o}=e,{stage:i}=e,{idx:r}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){n.$$.not_equal(t.jat[o][i].movements[r].name,_)&&(t.jat[o][i].movements[r].name=_,te.set(t))}function m(_){n.$$.not_equal(t.jat[o][i].movements[r].kind,_)&&(t.jat[o][i].movements[r].kind=_,te.set(t))}function c(_){n.$$.not_equal(t.jat[o][i].movements[r].score,_)&&(t.jat[o][i].movements[r].score=_,te.set(t))}function p(_){n.$$.not_equal(t.jat[o][i].movements[r].notes,_)&&(t.jat[o][i].movements[r].notes=_,te.set(t))}return n.$$set=_=>{"junctionIdx"in _&&l(0,o=_.junctionIdx),"stage"in _&&l(1,i=_.stage),"idx"in _&&l(2,r=_.idx)},[o,i,r,t,a,s,m,c,p]}class Ln extends ye{constructor(e){super(),Ee(this,e,Mn,Cn,je,{junctionIdx:0,stage:1,idx:2})}}function pe(n){if(n.movements.length==0)return"No movements added";let e=0,l=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],l+=2;let t=e/l*100;return`${Math.round(t)}%`}function Sn(n,e){let l=.003,t=(i,r)=>{let a=e[i].point,m=ke(a,n.point)-90,c=l*r;return Ce(a,c,m).geometry.coordinates};e.sort((i,r)=>tt(ke(n.point,r.point))-tt(ke(n.point,i.point)));let o=[];for(let i=0;i<e.length;i++){let r=e[i],a=ke(r.point,n.point),s=1;for(let m of yn(i,e.length)){let c=e[m],p=ke(n.point,c.point),_=t(i,s++),w=Ut(r.point,n.point),S=Ce(_,.5*w,a).geometry.coordinates,I=Ce(S,.2*w,p).geometry.coordinates;o.push({point1:_,point2:S,point3:I,kind:"cycling",score:"X",name:`${r.name} to ${c.name}`,notes:""})}}return o}function tt(n){return(n+360)%360}function yn(n,e){let l=[];for(let t=n+1;t<e;t++)l.push(t);for(let t=0;t<n;t++)l.push(t);return l}const{window:En}=St;function nt(n,e,l){const t=n.slice();t[34]=e[l],t[37]=l;const o=t[16][t[34].score];return t[35]=o,t}function lt(n,e,l){const t=n.slice();return t[38]=e[l],t[37]=l,t}function In(n){let e,l,t,o,i,r,a,s;e=new qe({props:{$$slots:{default:[Nn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Ge({props:{$$slots:{default:[An]},$$scope:{ctx:n}}}),t.$on("click",n[12]);const m=[Dn,Pn],c=[];function p(_,w){return _[2].id.kind=="movement"?0:1}return i=p(n),r=c[i]=m[i](n),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),r.c(),a=ae()},l(_){P(e.$$.fragment,_),l=z(_),P(t.$$.fragment,_),o=z(_),r.l(_),a=ae()},m(_,w){D(e,_,w),k(_,l,w),D(t,_,w),k(_,o,w),c[i].m(_,w),k(_,a,w),s=!0},p(_,w){const S={};w[1]&2&&(S.$$scope={dirty:w,ctx:_}),e.$set(S);const I={};w[1]&2&&(I.$$scope={dirty:w,ctx:_}),t.$set(I);let M=i;i=p(_),i===M?c[i].p(_,w):(me(),j(c[M],1,1,()=>{c[M]=null}),ce(),r=c[i],r?r.p(_,w):(r=c[i]=m[i](_),r.c()),v(r,1),r.m(a.parentNode,a))},i(_){s||(v(e.$$.fragment,_),v(t.$$.fragment,_),v(r),s=!0)},o(_){j(e.$$.fragment,_),j(t.$$.fragment,_),j(r),s=!1},d(_){_&&(d(l),d(o),d(a)),U(e,_),U(t,_),c[i].d(_)}}}function Tn(n){let e,l,t,o,i="Arms",r,a,s,m,c="Movements",p,_,w,S,I,M,E=(n[8].jat[n[0]].name||"Untitled junction")+"",$,b,N=pe(n[8].jat[n[0]][n[1]])+"",f,g,T,Q,ee,x;const J=n[18].default,C=_t(J,n,n[32],null);l=new Jt({props:{label:"Tools",$$slots:{default:[qn]},$$scope:{ctx:n}}});let oe=ge(n[8].jat[n[0]][n[1]].arms),Z=[];for(let u=0;u<oe.length;u+=1)Z[u]=ot(lt(n,oe,u));const $e=u=>j(Z[u],1,1,()=>{Z[u]=null});let y=n[8].jat[n[0]][n[9]].arms.length>0&&rt(n),q=n[8].jat[n[0]][n[1]].arms.length>0&&it(n),ne=ge(n[8].jat[n[0]][n[1]].movements),V=[];for(let u=0;u<ne.length;u+=1)V[u]=at(nt(n,ne,u));const ie=u=>j(V[u],1,1,()=>{V[u]=null});let L=n[8].jat[n[0]][n[9]].movements.length>0&&st(n);return{c(){C&&C.c(),e=F(),A(l.$$.fragment),t=F(),o=R("h3"),o.textContent=i,r=F();for(let u=0;u<Z.length;u+=1)Z[u].c();a=F(),y&&y.c(),s=F(),m=R("h3"),m.textContent=c,p=F(),_=R("p"),w=G("Total JAT score for "),S=G(n[1]),I=F(),M=R("u"),$=G(E),b=G(`
        : `),f=G(N),g=F(),q&&q.c(),T=F();for(let u=0;u<V.length;u+=1)V[u].c();Q=F(),L&&L.c(),ee=ae()},l(u){C&&C.l(u),e=z(u),P(l.$$.fragment,u),t=z(u),o=W(u,"H3",{"data-svelte-h":!0}),Le(o)!=="svelte-ld74qb"&&(o.textContent=i),r=z(u);for(let O=0;O<Z.length;O+=1)Z[O].l(u);a=z(u),y&&y.l(u),s=z(u),m=W(u,"H3",{"data-svelte-h":!0}),Le(m)!=="svelte-1dc52s8"&&(m.textContent=c),p=z(u),_=W(u,"P",{});var h=Y(_);w=H(h,"Total JAT score for "),S=H(h,n[1]),I=z(h),M=W(h,"U",{});var K=Y(M);$=H(K,E),K.forEach(d),b=H(h,`
        : `),f=H(h,N),h.forEach(d),g=z(u),q&&q.l(u),T=z(u);for(let O=0;O<V.length;O+=1)V[O].l(u);Q=z(u),L&&L.l(u),ee=ae()},m(u,h){C&&C.m(u,h),k(u,e,h),D(l,u,h),k(u,t,h),k(u,o,h),k(u,r,h);for(let K=0;K<Z.length;K+=1)Z[K]&&Z[K].m(u,h);k(u,a,h),y&&y.m(u,h),k(u,s,h),k(u,m,h),k(u,p,h),k(u,_,h),B(_,w),B(_,S),B(_,I),B(_,M),B(M,$),B(_,b),B(_,f),k(u,g,h),q&&q.m(u,h),k(u,T,h);for(let K=0;K<V.length;K+=1)V[K]&&V[K].m(u,h);k(u,Q,h),L&&L.m(u,h),k(u,ee,h),x=!0},p(u,h){C&&C.p&&(!x||h[1]&2)&&gt(C,J,u,u[32],x?dt(J,u[32],h,null):pt(u[32]),null);const K={};if(h[0]&112|h[1]&2&&(K.$$scope={dirty:h,ctx:u}),l.$set(K),h[0]&1291){oe=ge(u[8].jat[u[0]][u[1]].arms);let O;for(O=0;O<oe.length;O+=1){const _e=lt(u,oe,O);Z[O]?(Z[O].p(_e,h),v(Z[O],1)):(Z[O]=ot(_e),Z[O].c(),v(Z[O],1),Z[O].m(a.parentNode,a))}for(me(),O=oe.length;O<Z.length;O+=1)$e(O);ce()}if(u[8].jat[u[0]][u[9]].arms.length>0?y?(y.p(u,h),h[0]&257&&v(y,1)):(y=rt(u),y.c(),v(y,1),y.m(s.parentNode,s)):y&&(me(),j(y,1,1,()=>{y=null}),ce()),(!x||h[0]&2)&&ue(S,u[1]),(!x||h[0]&257)&&E!==(E=(u[8].jat[u[0]].name||"Untitled junction")+"")&&ue($,E),(!x||h[0]&259)&&N!==(N=pe(u[8].jat[u[0]][u[1]])+"")&&ue(f,N),u[8].jat[u[0]][u[1]].arms.length>0?q?(q.p(u,h),h[0]&259&&v(q,1)):(q=it(u),q.c(),v(q,1),q.m(T.parentNode,T)):q&&(me(),j(q,1,1,()=>{q=null}),ce()),h[0]&66827){ne=ge(u[8].jat[u[0]][u[1]].movements);let O;for(O=0;O<ne.length;O+=1){const _e=nt(u,ne,O);V[O]?(V[O].p(_e,h),v(V[O],1)):(V[O]=at(_e),V[O].c(),v(V[O],1),V[O].m(Q.parentNode,Q))}for(me(),O=ne.length;O<V.length;O+=1)ie(O);ce()}u[8].jat[u[0]][u[9]].movements.length>0?L?(L.p(u,h),h[0]&257&&v(L,1)):(L=st(u),L.c(),v(L,1),L.m(ee.parentNode,ee)):L&&(me(),j(L,1,1,()=>{L=null}),ce())},i(u){if(!x){v(C,u),v(l.$$.fragment,u);for(let h=0;h<oe.length;h+=1)v(Z[h]);v(y),v(q);for(let h=0;h<ne.length;h+=1)v(V[h]);v(L),x=!0}},o(u){j(C,u),j(l.$$.fragment,u),Z=Z.filter(Boolean);for(let h=0;h<Z.length;h+=1)j(Z[h]);j(y),j(q),V=V.filter(Boolean);for(let h=0;h<V.length;h+=1)j(V[h]);j(L),x=!1},d(u){u&&(d(e),d(t),d(o),d(r),d(a),d(s),d(m),d(p),d(_),d(g),d(T),d(Q),d(ee)),C&&C.d(u),U(l,u),Me(Z,u),y&&y.d(u),q&&q.d(u),Me(V,u),L&&L.d(u)}}}function Nn(n){let e;return{c(){e=G("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function An(n){let e;return{c(){e=G("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function Pn(n){let e,l,t;function o(r){n[29](r)}let i={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(i.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new Oe({props:i}),re.push(()=>fe(e,"value",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,a){D(e,r,a),t=!0},p(r,a){const s={};!l&&a[0]&263&&(l=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){U(e,r)}}}function Dn(n){let e,l,t,o,i,r;return e=new Ln({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),t=new qe({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),t.$on("click",n[11]),i=new Ge({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),i.$on("click",n[12]),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),A(i.$$.fragment)},l(a){P(e.$$.fragment,a),l=z(a),P(t.$$.fragment,a),o=z(a),P(i.$$.fragment,a)},m(a,s){D(e,a,s),k(a,l,s),D(t,a,s),k(a,o,s),D(i,a,s),r=!0},p(a,s){const m={};s[0]&1&&(m.junctionIdx=a[0]),s[0]&2&&(m.stage=a[1]),s[0]&4&&(m.idx=a[2].id.idx),e.$set(m);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:a}),t.$set(c);const p={};s[1]&2&&(p.$$scope={dirty:s,ctx:a}),i.$set(p)},i(a){r||(v(e.$$.fragment,a),v(t.$$.fragment,a),v(i.$$.fragment,a),r=!0)},o(a){j(e.$$.fragment,a),j(t.$$.fragment,a),j(i.$$.fragment,a),r=!1},d(a){a&&(d(l),d(o)),U(e,a),U(t,a),U(i,a)}}}function Un(n){let e;return{c(){e=G("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function Bn(n){let e;return{c(){e=G("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function Fn(n){let e;return{c(){e=G("Zoom to fit")},l(l){e=H(l,"Zoom to fit")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function zn(n){let e;return{c(){e=G("Show scheme context")},l(l){e=H(l,"Show scheme context")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function qn(n){var E;let e,l,t,o,i,r,a,s,m,c,p,_;e=new ve({props:{$$slots:{default:[Fn]},$$scope:{ctx:n}}}),e.$on("click",n[20]),t=new qt({}),i=new Ot({});function w($){n[21]($)}let S={map:(E=n[6])==null?void 0:E.getMap()};n[4]!==void 0&&(S.enabled=n[4]),a=new Gt({props:S}),re.push(()=>fe(a,"enabled",w));function I($){n[22]($)}let M={$$slots:{default:[zn]},$$scope:{ctx:n}};return n[5]!==void 0&&(M.checked=n[5]),c=new Ht({props:M}),re.push(()=>fe(c,"checked",I)),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),A(i.$$.fragment),r=F(),A(a.$$.fragment),m=F(),A(c.$$.fragment)},l($){P(e.$$.fragment,$),l=z($),P(t.$$.fragment,$),o=z($),P(i.$$.fragment,$),r=z($),P(a.$$.fragment,$),m=z($),P(c.$$.fragment,$)},m($,b){D(e,$,b),k($,l,b),D(t,$,b),k($,o,b),D(i,$,b),k($,r,b),D(a,$,b),k($,m,b),D(c,$,b),_=!0},p($,b){var T;const N={};b[1]&2&&(N.$$scope={dirty:b,ctx:$}),e.$set(N);const f={};b[0]&64&&(f.map=(T=$[6])==null?void 0:T.getMap()),!s&&b[0]&16&&(s=!0,f.enabled=$[4],se(()=>s=!1)),a.$set(f);const g={};b[1]&2&&(g.$$scope={dirty:b,ctx:$}),!p&&b[0]&32&&(p=!0,g.checked=$[5],se(()=>p=!1)),c.$set(g)},i($){_||(v(e.$$.fragment,$),v(t.$$.fragment,$),v(i.$$.fragment,$),v(a.$$.fragment,$),v(c.$$.fragment,$),_=!0)},o($){j(e.$$.fragment,$),j(t.$$.fragment,$),j(i.$$.fragment,$),j(a.$$.fragment,$),j(c.$$.fragment,$),_=!1},d($){$&&(d(l),d(o),d(r),d(m)),U(e,$),U(t,$),U(i,$),U(a,$),U(c,$)}}}function ot(n){let e,l;function t(){return n[23](n[37])}function o(){return n[24](n[37])}return e=new ze({props:{name:`${ft(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[25]),{c(){A(e.$$.fragment)},l(i){P(e.$$.fragment,i)},m(i,r){D(e,i,r),l=!0},p(i,r){n=i;const a={};r[0]&259&&(a.name=`${ft(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(a)},i(i){l||(v(e.$$.fragment,i),l=!0)},o(i){j(e.$$.fragment,i),l=!1},d(i){U(e,i)}}}function rt(n){let e,l;return e=new ve({props:{$$slots:{default:[On]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o[1]&2&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function On(n){let e,l;return{c(){e=G("Copy arms from "),l=G(n[9])},l(t){e=H(t,"Copy arms from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:Se,d(t){t&&(d(e),d(l))}}}function it(n){let e,l;return e=new ve({props:{$$slots:{default:[Gn]},$$scope:{ctx:n}}}),e.$on("click",n[17]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o[1]&2&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function Gn(n){let e;return{c(){e=G("Generate cycling movements between all arms (1st arm is the center)")},l(l){e=H(l,"Generate cycling movements between all arms (1st arm is the center)")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function Hn(n){let e,l,t,o=n[34].score+"",i,r,a,s=Ve(n[34].kind)+"",m;return{c(){e=R("div"),l=R("span"),t=G("Score: "),i=G(o),r=F(),a=R("span"),m=G(s),this.h()},l(c){e=W(c,"DIV",{style:!0});var p=Y(e);l=W(p,"SPAN",{style:!0});var _=Y(l);t=H(_,"Score: "),i=H(_,o),_.forEach(d),r=z(p),a=W(p,"SPAN",{});var w=Y(a);m=H(w,s),w.forEach(d),p.forEach(d),this.h()},h(){X(l,"padding","4px"),X(l,"color",n[35].font),X(l,"background-color",n[35].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(c,p){k(c,e,p),B(e,l),B(l,t),B(l,i),B(e,r),B(e,a),B(a,m)},p(c,p){p[0]&259&&o!==(o=c[34].score+"")&&ue(i,o),p[0]&259&&X(l,"color",c[35].font),p[0]&259&&X(l,"background-color",c[35].background),p[0]&259&&s!==(s=Ve(c[34].kind)+"")&&ue(m,s)},d(c){c&&d(e)}}}function at(n){let e,l;function t(){return n[26](n[37])}function o(){return n[27](n[37])}return e=new ze({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[Hn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[28]),{c(){A(e.$$.fragment)},l(i){P(e.$$.fragment,i)},m(i,r){D(e,i,r),l=!0},p(i,r){n=i;const a={};r[0]&259&&(a.name=n[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(a.$$scope={dirty:r,ctx:n}),e.$set(a)},i(i){l||(v(e.$$.fragment,i),l=!0)},o(i){j(e.$$.fragment,i),l=!1},d(i){U(e,i)}}}function st(n){let e,l;return e=new ve({props:{$$slots:{default:[Jn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o[1]&2&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function Jn(n){let e,l;return{c(){e=G("Copy movements from "),l=G(n[9])},l(t){e=H(t,"Copy movements from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:Se,d(t){t&&(d(e),d(l))}}}function Vn(n){let e,l,t,o,i,r,a,s=pe(n[8].jat[n[0]].existing)+"",m,c,p,_=pe(n[8].jat[n[0]].proposed)+"",w,S,I,M,E,$,b,N,f,g,T,Q,ee;function x(y){n[19](y)}let J={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(J.value=n[8].jat[n[0]][n[1]].notes),l=new vt({props:J}),re.push(()=>fe(l,"value",x));const C=[Tn,In],oe=[];function Z(y,q){return y[2].mode!="editing"?0:1}$=Z(n),b=oe[$]=C[$](n);let $e={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showContext:n[5],select:n[10],stopEditing:n[11]};return g=new jn({props:$e}),n[31](g),{c(){e=R("div"),A(l.$$.fragment),o=F(),i=R("p"),r=G("Total JAT score: "),a=R("b"),m=G(s),c=G(`
    existing,
    `),p=R("b"),w=G(_),S=G(`
    proposed`),I=F(),M=R("div"),E=R("div"),b.c(),N=F(),f=R("div"),A(g.$$.fragment),this.h()},l(y){e=W(y,"DIV",{class:!0});var q=Y(e);P(l.$$.fragment,q),o=z(q),i=W(q,"P",{});var ne=Y(i);r=H(ne,"Total JAT score: "),a=W(ne,"B",{});var V=Y(a);m=H(V,s),V.forEach(d),c=H(ne,`
    existing,
    `),p=W(ne,"B",{});var ie=Y(p);w=H(ie,_),ie.forEach(d),S=H(ne,`
    proposed`),ne.forEach(d),q.forEach(d),I=z(y),M=W(y,"DIV",{style:!0});var L=Y(M);E=W(L,"DIV",{style:!0});var u=Y(E);b.l(u),u.forEach(d),N=z(L),f=W(L,"DIV",{style:!0});var h=Y(f);P(g.$$.fragment,h),h.forEach(d),L.forEach(d),this.h()},h(){le(e,"class","govuk-width-container"),X(E,"width","30%"),X(E,"overflow-y","scroll"),X(E,"padding","10px"),X(E,"border","1px solid black"),X(f,"position","relative"),X(f,"width","100%"),X(M,"display","flex"),X(M,"height","80vh")},m(y,q){k(y,e,q),D(l,e,null),B(e,o),B(e,i),B(i,r),B(i,a),B(a,m),B(i,c),B(i,p),B(p,w),B(i,S),k(y,I,q),k(y,M,q),B(M,E),oe[$].m(E,null),n[30](E),B(M,N),B(M,f),D(g,f,null),T=!0,Q||(ee=Mt(En,"keydown",n[13]),Q=!0)},p(y,q){const ne={};q[0]&2&&(ne.label="Commentary / Notes about "+y[1]+" junction"),!t&&q[0]&259&&(t=!0,ne.value=y[8].jat[y[0]][y[1]].notes,se(()=>t=!1)),l.$set(ne),(!T||q[0]&257)&&s!==(s=pe(y[8].jat[y[0]].existing)+"")&&ue(m,s),(!T||q[0]&257)&&_!==(_=pe(y[8].jat[y[0]].proposed)+"")&&ue(w,_);let V=$;$=Z(y),$===V?oe[$].p(y,q):(me(),j(oe[V],1,1,()=>{oe[V]=null}),ce(),b=oe[$],b?b.p(y,q):(b=oe[$]=C[$](y),b.c()),v(b,1),b.m(E,null));const ie={};q[0]&1&&(ie.junctionIdx=y[0]),q[0]&2&&(ie.stage=y[1]),q[0]&4&&(ie.mode=y[2]),q[0]&8&&(ie.hoveringSidebar=y[3]),q[0]&16&&(ie.streetviewOn=y[4]),q[0]&32&&(ie.showContext=y[5]),g.$set(ie)},i(y){T||(v(l.$$.fragment,y),v(b),v(g.$$.fragment,y),T=!0)},o(y){j(l.$$.fragment,y),j(b),j(g.$$.fragment,y),T=!1},d(y){y&&(d(e),d(I),d(M)),U(l),oe[$].d(),n[30](null),n[31](null),U(g),Q=!1,ee()}}}function ft(n){return String.fromCharCode(n+65)}function Xn(n,e,l){let t;Te(n,te,L=>l(8,t=L));let{$$slots:o={},$$scope:i}=e,{junctionIdx:r}=e,{stage:a}=e,s=a=="existing"?"proposed":"existing",m={mode:"select"},c=null,p=null,_=!1,w=!0,S=null,I;async function M(L){c=I.scrollTop,l(2,m={mode:"editing",id:L}),l(3,p=null),await Je(),l(7,I.scrollTop=0,I)}async function E(){l(2,m={mode:"select"}),c!=null&&(await Je(),l(7,I.scrollTop=c,I),c=null)}function $(){m.mode=="editing"&&window.confirm(`Delete this ${m.id.kind}?`)&&(m.id.kind=="movement"?(t.jat[r][a].movements.splice(m.id.idx,1),te.set(t)):(t.jat[r][a].arms.splice(m.id.idx,1),te.set(t)),E())}function b(L){if(m.mode!="editing")return;let u=L.target.tagName,h=u=="INPUT"||u=="TEXTAREA";L.key=="Escape"||L.key=="Enter"&&!h?(L.stopPropagation(),E()):L.key=="Delete"&&!h&&(L.stopPropagation(),$())}function N(){t.jat[r][a].arms.length>0&&!window.confirm("Overwrite arms?")||(we(te,t.jat[r][a].arms=JSON.parse(JSON.stringify(t.jat[r][s].arms)),t),te.set(t))}function f(){t.jat[r][a].movements.length>0&&!window.confirm("Overwrite movements?")||(we(te,t.jat[r][a].movements=JSON.parse(JSON.stringify(t.jat[r][s].movements)),t),te.set(t))}let g={0:de.red,1:de.amber,2:de.green,X:de.critical};function T(){let[L,...u]=t.jat[r][a].arms;we(te,t.jat[r][a].movements=Sn(L,u),t)}function Q(L){n.$$.not_equal(t.jat[r][a].notes,L)&&(t.jat[r][a].notes=L,te.set(t))}const ee=()=>S==null?void 0:S.zoom(!0);function x(L){_=L,l(4,_)}function J(L){w=L,l(5,w)}const C=L=>M({kind:"arm",idx:L}),oe=L=>l(3,p={kind:"arm",idx:L}),Z=()=>l(3,p=null),$e=L=>M({kind:"movement",idx:L}),y=L=>l(3,p={kind:"movement",idx:L}),q=()=>l(3,p=null);function ne(L){n.$$.not_equal(t.jat[r][a].arms[m.id.idx].name,L)&&(t.jat[r][a].arms[m.id.idx].name=L,te.set(t))}function V(L){re[L?"unshift":"push"](()=>{I=L,l(7,I)})}function ie(L){re[L?"unshift":"push"](()=>{S=L,l(6,S)})}return n.$$set=L=>{"junctionIdx"in L&&l(0,r=L.junctionIdx),"stage"in L&&l(1,a=L.stage),"$$scope"in L&&l(32,i=L.$$scope)},[r,a,m,p,_,w,S,I,t,s,M,E,$,b,N,f,g,T,o,Q,ee,x,J,C,oe,Z,$e,y,q,ne,V,ie,i]}class Rn extends ye{constructor(e){super(),Ee(this,e,Xn,Vn,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function ut(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function Wn(n){let e,l,t=(n[1].jat[n[0].idx].name||"Untitled junction")+"",o,i,r=n[0].stage+"",a,s,m,c,p,_,w,S=n[0].stage,I,M;m=new Lt({props:{$$slots:{default:[Qn]},$$scope:{ctx:n}}});function E(N){n[7](N)}let $={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&($.value=n[1].jat[n[0].idx].name),p=new Oe({props:$}),re.push(()=>fe(p,"value",E));let b=mt(n);return{c(){e=R("div"),l=R("h2"),o=G(t),i=G(" - "),a=G(r),s=F(),A(m.$$.fragment),c=F(),A(p.$$.fragment),w=F(),b.c(),I=ae(),this.h()},l(N){e=W(N,"DIV",{class:!0});var f=Y(e);l=W(f,"H2",{});var g=Y(l);o=H(g,t),i=H(g," - "),a=H(g,r),g.forEach(d),s=z(f),P(m.$$.fragment,f),c=z(f),P(p.$$.fragment,f),f.forEach(d),w=z(N),b.l(N),I=ae(),this.h()},h(){le(e,"class","govuk-width-container")},m(N,f){k(N,e,f),B(e,l),B(l,o),B(l,i),B(l,a),B(e,s),D(m,e,null),B(e,c),D(p,e,null),k(N,w,f),b.m(N,f),k(N,I,f),M=!0},p(N,f){(!M||f&3)&&t!==(t=(N[1].jat[N[0].idx].name||"Untitled junction")+"")&&ue(o,t),(!M||f&1)&&r!==(r=N[0].stage+"")&&ue(a,r);const g={};f&8193&&(g.$$scope={dirty:f,ctx:N}),m.$set(g);const T={};!_&&f&3&&(_=!0,T.value=N[1].jat[N[0].idx].name,se(()=>_=!1)),p.$set(T),f&1&&je(S,S=N[0].stage)?(me(),j(b,1,1,Se),ce(),b=mt(N),b.c(),v(b,1),b.m(I.parentNode,I)):b.p(N,f)},i(N){M||(v(m.$$.fragment,N),v(p.$$.fragment,N),v(b),M=!0)},o(N){j(m.$$.fragment,N),j(p.$$.fragment,N),j(b),M=!1},d(N){N&&(d(e),d(w),d(I)),U(m),U(p),b.d(N)}}}function Zn(n){let e,l,t,o;l=new qe({props:{$$slots:{default:[ol]},$$scope:{ctx:n}}}),l.$on("click",n[2]);let i=ge(n[1].jat),r=[];for(let s=0;s<i.length;s+=1)r[s]=ct(ut(n,i,s));const a=s=>j(r[s],1,1,()=>{r[s]=null});return{c(){e=R("div"),A(l.$$.fragment),t=F();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Y(e);P(l.$$.fragment,m),t=z(m);for(let c=0;c<r.length;c+=1)r[c].l(m);m.forEach(d),this.h()},h(){le(e,"class","govuk-width-container")},m(s,m){k(s,e,m),D(l,e,null),B(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);o=!0},p(s,m){const c={};if(m&8192&&(c.$$scope={dirty:m,ctx:s}),l.$set(c),m&3){i=ge(s[1].jat);let p;for(p=0;p<i.length;p+=1){const _=ut(s,i,p);r[p]?(r[p].p(_,m),v(r[p],1)):(r[p]=ct(_),r[p].c(),v(r[p],1),r[p].m(e,null))}for(me(),p=i.length;p<r.length;p+=1)a(p);ce()}},i(s){if(!o){v(l.$$.fragment,s);for(let m=0;m<i.length;m+=1)v(r[m]);o=!0}},o(s){j(l.$$.fragment,s),r=r.filter(Boolean);for(let m=0;m<r.length;m+=1)j(r[m]);o=!1},d(s){s&&d(e),U(l),Me(r,s)}}}function Kn(n){let e;return{c(){e=G("Back to all junctions")},l(l){e=H(l,"Back to all junctions")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function Yn(n){let e;return{c(){e=G("Delete junction")},l(l){e=H(l,"Delete junction")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function Qn(n){let e,l,t,o;return e=new ve({props:{$$slots:{default:[Kn]},$$scope:{ctx:n}}}),e.$on("click",n[5]),t=new Ge({props:{$$slots:{default:[Yn]},$$scope:{ctx:n}}}),t.$on("click",n[6]),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment)},l(i){P(e.$$.fragment,i),l=z(i),P(t.$$.fragment,i)},m(i,r){D(e,i,r),k(i,l,r),D(t,i,r),o=!0},p(i,r){const a={};r&8192&&(a.$$scope={dirty:r,ctx:i}),e.$set(a);const s={};r&8192&&(s.$$scope={dirty:r,ctx:i}),t.$set(s)},i(i){o||(v(e.$$.fragment,i),v(t.$$.fragment,i),o=!0)},o(i){j(e.$$.fragment,i),j(t.$$.fragment,i),o=!1},d(i){i&&d(l),U(e,i),U(t,i)}}}function xn(n){let e,l;return e=new ve({props:{$$slots:{default:[tl]},$$scope:{ctx:n}}}),e.$on("click",n[9]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function el(n){let e,l;return e=new ve({props:{$$slots:{default:[nl]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function tl(n){let e;return{c(){e=G("Edit Proposed")},l(l){e=H(l,"Edit Proposed")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function nl(n){let e;return{c(){e=G("Edit Existing")},l(l){e=H(l,"Edit Existing")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function ll(n){let e,l,t=n[0].stage+"",o,i,r,a=n[1].jat[n[0].idx].name+"",s,m,c,p,_,w;const S=[el,xn],I=[];function M(E,$){return E[0].stage=="proposed"?0:1}return c=M(n),p=I[c]=S[c](n),{c(){e=R("p"),l=G("Currently editing "),o=G(t),i=G(` junction
        `),r=R("u"),s=G(a),m=F(),p.c(),_=ae()},l(E){e=W(E,"P",{});var $=Y(e);l=H($,"Currently editing "),o=H($,t),i=H($,` junction
        `),r=W($,"U",{});var b=Y(r);s=H(b,a),b.forEach(d),$.forEach(d),m=z(E),p.l(E),_=ae()},m(E,$){k(E,e,$),B(e,l),B(e,o),B(e,i),B(e,r),B(r,s),k(E,m,$),I[c].m(E,$),k(E,_,$),w=!0},p(E,$){(!w||$&1)&&t!==(t=E[0].stage+"")&&ue(o,t),(!w||$&3)&&a!==(a=E[1].jat[E[0].idx].name+"")&&ue(s,a);let b=c;c=M(E),c===b?I[c].p(E,$):(me(),j(I[b],1,1,()=>{I[b]=null}),ce(),p=I[c],p?p.p(E,$):(p=I[c]=S[c](E),p.c()),v(p,1),p.m(_.parentNode,_))},i(E){w||(v(p),w=!0)},o(E){j(p),w=!1},d(E){E&&(d(e),d(m),d(_)),I[c].d(E)}}}function mt(n){let e,l;return e=new Rn({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[ll]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const i={};o&1&&(i.junctionIdx=t[0].idx),o&1&&(i.stage=t[0].stage),o&8195&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function ol(n){let e;return{c(){e=G("Add new junction")},l(l){e=H(l,"Add new junction")},m(l,t){k(l,e,t)},d(l){l&&d(e)}}}function rl(n){let e,l,t,o=pe(n[10].existing)+"",i,r,a,s,m=pe(n[10].proposed)+"",c,p;return{c(){e=R("div"),l=R("span"),t=G("Existing: "),i=G(o),r=F(),a=R("span"),s=G("Proposed: "),c=G(m),p=F(),this.h()},l(_){e=W(_,"DIV",{style:!0});var w=Y(e);l=W(w,"SPAN",{});var S=Y(l);t=H(S,"Existing: "),i=H(S,o),S.forEach(d),r=z(w),a=W(w,"SPAN",{});var I=Y(a);s=H(I,"Proposed: "),c=H(I,m),I.forEach(d),w.forEach(d),p=z(_),this.h()},h(){X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(_,w){k(_,e,w),B(e,l),B(l,t),B(l,i),B(e,r),B(e,a),B(a,s),B(a,c),k(_,p,w)},p(_,w){w&2&&o!==(o=pe(_[10].existing)+"")&&ue(i,o),w&2&&m!==(m=pe(_[10].proposed)+"")&&ue(c,m)},d(_){_&&(d(e),d(p))}}}function ct(n){let e,l;function t(){return n[4](n[12])}return e=new ze({props:{name:n[10].name||"Untitled junction",$$slots:{default:[rl]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){A(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,i){D(e,o,i),l=!0},p(o,i){n=o;const r={};i&2&&(r.name=n[10].name||"Untitled junction"),i&8194&&(r.$$scope={dirty:i,ctx:n}),e.$set(r)},i(o){l||(v(e.$$.fragment,o),l=!0)},o(o){j(e.$$.fragment,o),l=!1},d(o){U(e,o)}}}function il(n){let e,l,t,o;const i=[Zn,Wn],r=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(n))&&(l=r[e]=i[e](n)),{c(){l&&l.c(),t=ae()},l(s){l&&l.l(s),t=ae()},m(s,m){~e&&r[e].m(s,m),k(s,t,m),o=!0},p(s,[m]){let c=e;e=a(s),e===c?~e&&r[e].p(s,m):(l&&(me(),j(r[c],1,1,()=>{r[c]=null}),ce()),~e?(l=r[e],l?l.p(s,m):(l=r[e]=i[e](s),l.c()),v(l,1),l.m(t.parentNode,t)):l=null)},i(s){o||(v(l),o=!0)},o(s){j(l),o=!1},d(s){s&&d(t),~e&&r[e].d(s)}}}function De(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function al(n,e,l){let t;Te(n,te,w=>l(1,t=w));let o={kind:"list"};function i(){we(te,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),l(0,o={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function r(w){window.confirm("Delete this junction?")&&(t.jat.splice(w,1),te.set(t),l(0,o={kind:"list"}))}const a=w=>l(0,o={kind:"edit",idx:w,stage:"existing"}),s=()=>l(0,o={kind:"list"}),m=()=>r(De(o));function c(w){n.$$.not_equal(t.jat[o.idx].name,w)&&(t.jat[o.idx].name=w,te.set(t))}return[o,t,i,r,a,s,m,c,()=>l(0,o={kind:"edit",idx:De(o),stage:"existing"}),()=>l(0,o={kind:"edit",idx:De(o),stage:"proposed"})]}class El extends ye{constructor(e){super(),Ee(this,e,al,il,je,{})}}export{El as component};
