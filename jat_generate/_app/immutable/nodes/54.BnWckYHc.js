import{s as ve,w as x,x as ee,l as dt,u as $t,r as ht,v as kt,D as ke,k as Ae,R as bt,T as be,a as D,g as B,i as L,f as w,G as Le,n as we,e as le,t as G,c as re,b as se,d as H,p as Ne,q as X,h as Y,j as _e,z as vt,W as wt,E as ce,m as Ge}from"../chunks/scheduler.ytQcc2rf.js";import{S as Se,i as ye,e as te,c as A,a as N,m as P,t as v,b as j,d as z,g as ae,f as ie}from"../chunks/index.D9yYtTfk.js";import{e as me}from"../chunks/each.2RvRdhFj.js";import{C as Ue,B as jt}from"../chunks/ClickableCard.R7NkEgQq.js";import{D as ft}from"../chunks/DefaultButton.DeS4Ykkw.js";import{S as $e}from"../chunks/SecondaryButton.Dq9MsXNi.js";/* empty css                                                    */import{T as Oe}from"../chunks/TextInput.6W_uhnqP.js";import{W as ut}from"../chunks/WarningButton.C6jnTAfb.js";import{s as W}from"../chunks/data.f5sl0_SV.js";import{L as Ct,a as Mt,d as de,t as Lt,v as St,w as ze,M as yt,b as It,C as Tt,G as He,x as qe,y as Je,m as Et,P as mt,l as At}from"../chunks/index.zgbzr8dD.js";import{c as Ke}from"../chunks/index.B0AE0gvo.js";import{g as De}from"../chunks/index.Cy9FAIrc.js";import{c as pe}from"../chunks/colors.DaC397qr.js";import{G as Nt}from"../chunks/GeoreferenceLayer.DidOkMDU.js";import{a as Pt,M as Ie,B as zt,G as qt,S as Dt,C as Bt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DosUjqq1.js";import{C as Ut}from"../chunks/CollapsibleCard.Bf0oqccF.js";import{R as Be}from"../chunks/Radio.BwqxTJTI.js";import{T as ct}from"../chunks/TextArea.CtGDg2p0.js";import"../chunks/paths.2zhJ3USx.js";function Ot(n){let e;const o=n[16].default,t=dt(o,n,n[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,r){t&&t.m(l,r),e=!0},p(l,r){t&&t.p&&(!e||r&16777216)&&$t(t,o,l,l[24],e?kt(o,l[24],r,null):ht(l[24]),null)},i(l){e||(v(t,l),e=!0)},o(l){j(t,l),e=!1},d(l){t&&t.d(l)}}}function Ft(n){let e,o,t;function l(a){n[17](a)}let r={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Ot]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.hovered=n[0]),e=new Ct({props:r}),x.push(()=>te(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){A(e.$$.fragment)},l(a){N(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,[s]){const i={};s&2&&(i.id=a[1]),s&4&&(i.source=a[2]),s&8&&(i.sourceLayer=a[3]),s&16&&(i.beforeId=a[4]),s&32&&(i.beforeLayerType=a[5]),s&64&&(i.paint=a[6]),s&128&&(i.layout=a[7]),s&256&&(i.filter=a[8]),s&512&&(i.applyToClusters=a[9]),s&1024&&(i.minzoom=a[10]),s&2048&&(i.maxzoom=a[11]),s&4096&&(i.hoverCursor=a[12]),s&8192&&(i.manageHoverState=a[13]),s&16384&&(i.eventsIfTopMost=a[14]),s&32768&&(i.interactive=a[15]),s&16777216&&(i.$$scope={dirty:s,ctx:a}),!o&&s&1&&(o=!0,i.hovered=a[0],ee(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){j(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Gt(n,e,o){let{$$slots:t={},$$scope:l}=e,{id:r=Mt("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:i=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:_=void 0}=e,{layout:g=void 0}=e,{filter:u=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:q=void 0}=e,{hoverCursor:U=void 0}=e,{manageHoverState:E=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:$=!0}=e;function k(T){h=T,o(0,h)}function p(T){ke.call(this,n,T)}function y(T){ke.call(this,n,T)}function J(T){ke.call(this,n,T)}function I(T){ke.call(this,n,T)}function O(T){ke.call(this,n,T)}function ge(T){ke.call(this,n,T)}return n.$$set=T=>{"id"in T&&o(1,r=T.id),"source"in T&&o(2,a=T.source),"sourceLayer"in T&&o(3,s=T.sourceLayer),"beforeId"in T&&o(4,i=T.beforeId),"beforeLayerType"in T&&o(5,c=T.beforeLayerType),"paint"in T&&o(6,_=T.paint),"layout"in T&&o(7,g=T.layout),"filter"in T&&o(8,u=T.filter),"applyToClusters"in T&&o(9,C=T.applyToClusters),"minzoom"in T&&o(10,M=T.minzoom),"maxzoom"in T&&o(11,q=T.maxzoom),"hoverCursor"in T&&o(12,U=T.hoverCursor),"manageHoverState"in T&&o(13,E=T.manageHoverState),"hovered"in T&&o(0,h=T.hovered),"eventsIfTopMost"in T&&o(14,f=T.eventsIfTopMost),"interactive"in T&&o(15,$=T.interactive),"$$scope"in T&&o(24,l=T.$$scope)},[h,r,a,s,i,c,_,g,u,C,M,q,U,E,f,$,t,k,p,y,J,I,O,ge,l]}class Ht extends Se{constructor(e){super(),ye(this,e,Gt,Ft,ve,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Jt=Object.defineProperty,Kt=(n,e)=>Jt(n,"name",{value:e,configurable:!0});function _t(n,e,o,t={}){const l=De(n),r=de(l[0]),a=de(l[1]),s=de(o),i=Lt(e,t.units),c=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(s)),_=r+Math.atan2(Math.sin(s)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(c)),g=ze(_),u=ze(c);return St([g,u],t.properties)}Kt(_t,"destination");var Ee=_t,Rt=Object.defineProperty,gt=(n,e)=>Rt(n,"name",{value:e,configurable:!0});function Fe(n,e,o={}){if(o.final===!0)return pt(n,e);const t=De(n),l=De(e),r=de(t[0]),a=de(l[0]),s=de(t[1]),i=de(l[1]),c=Math.sin(a-r)*Math.cos(i),_=Math.cos(s)*Math.sin(i)-Math.sin(s)*Math.cos(i)*Math.cos(a-r);return ze(Math.atan2(c,_))}gt(Fe,"bearing");function pt(n,e){let o=Fe(e,n);return o=(o+180)%360,o}gt(pt,"calculateFinalBearing");var Te=Fe;function Re(n,e,o){const t=n.slice();return t[35]=e[o],t[36]=e,t[37]=o,t}function Xe(n,e,o){const t=n.slice();return t[38]=e[o],t[39]=e,t[37]=o,t}function Xt(n){let e,o=rn(n[37])+"",t;return{c(){e=le("span"),t=G(o),this.h()},l(l){e=re(l,"SPAN",{class:!0});var r=se(e);t=H(r,o),r.forEach(w),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(l,r){L(l,e,r),Y(e,t)},p:we,d(l){l&&w(e)}}}function We(n){let e,o,t;function l(i){n[18](i,n[38])}function r(){return n[19](n[37])}function a(){return n[20](n[37])}let s={draggable:!0,$$slots:{default:[Xt]},$$scope:{ctx:n}};return n[38].point!==void 0&&(s.lngLat=n[38].point),e=new Ie({props:s}),x.push(()=>te(e,"lngLat",l)),e.$on("dragend",r),e.$on("click",a),{c(){A(e.$$.fragment)},l(i){N(e.$$.fragment,i)},m(i,c){P(e,i,c),t=!0},p(i,c){n=i;const _={};c[1]&512&&(_.$$scope={dirty:c,ctx:n}),!o&&c[0]&19&&(o=!0,_.lngLat=n[38].point,ee(()=>o=!1)),e.$set(_)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){j(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function Wt(n){let e;return{c(){e=le("span"),this.h()},l(o){e=re(o,"SPAN",{class:!0}),se(e).forEach(w),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score]),X(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score]),t[0]&19&&X(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&w(e)}}}function Vt(n){let e;return{c(){e=le("span"),this.h()},l(o){e=re(o,"SPAN",{class:!0}),se(e).forEach(w),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score])},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&w(e)}}}function Zt(n){let e;return{c(){e=le("span"),this.h()},l(o){e=re(o,"SPAN",{class:!0}),se(e).forEach(w),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score]),X(e,"opacity","0%")},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&w(e)}}}function Ve(n){let e,o,t,l,r,a,s,i,c;function _(p){n[21](p,n[35])}function g(){return n[22](n[37])}function u(){return n[23](n[37])}let C={draggable:!0,$$slots:{default:[Wt]},$$scope:{ctx:n}};n[35].point1!==void 0&&(C.lngLat=n[35].point1),e=new Ie({props:C}),x.push(()=>te(e,"lngLat",_)),e.$on("dragend",g),e.$on("click",u);function M(p){n[24](p,n[35])}function q(){return n[25](n[37])}function U(){return n[26](n[37])}let E={draggable:!0,$$slots:{default:[Vt]},$$scope:{ctx:n}};n[35].point2!==void 0&&(E.lngLat=n[35].point2),l=new Ie({props:E}),x.push(()=>te(l,"lngLat",M)),l.$on("dragend",q),l.$on("click",U);function h(p){n[27](p,n[35])}function f(){return n[28](n[37])}function $(){return n[29](n[37])}let k={draggable:!0,$$slots:{default:[Zt]},$$scope:{ctx:n}};return n[35].point3!==void 0&&(k.lngLat=n[35].point3),s=new Ie({props:k}),x.push(()=>te(s,"lngLat",h)),s.$on("dragend",f),s.$on("click",$),{c(){A(e.$$.fragment),t=D(),A(l.$$.fragment),a=D(),A(s.$$.fragment)},l(p){N(e.$$.fragment,p),t=B(p),N(l.$$.fragment,p),a=B(p),N(s.$$.fragment,p)},m(p,y){P(e,p,y),L(p,t,y),P(l,p,y),L(p,a,y),P(s,p,y),c=!0},p(p,y){n=p;const J={};y[0]&19|y[1]&512&&(J.$$scope={dirty:y,ctx:n}),!o&&y[0]&19&&(o=!0,J.lngLat=n[35].point1,ee(()=>o=!1)),e.$set(J);const I={};y[0]&19|y[1]&512&&(I.$$scope={dirty:y,ctx:n}),!r&&y[0]&19&&(r=!0,I.lngLat=n[35].point2,ee(()=>r=!1)),l.$set(I);const O={};y[0]&19|y[1]&512&&(O.$$scope={dirty:y,ctx:n}),!i&&y[0]&19&&(i=!0,O.lngLat=n[35].point3,ee(()=>i=!1)),s.$set(O)},i(p){c||(v(e.$$.fragment,p),v(l.$$.fragment,p),v(s.$$.fragment,p),c=!0)},o(p){j(e.$$.fragment,p),j(l.$$.fragment,p),j(s.$$.fragment,p),c=!1},d(p){p&&(w(t),w(a)),z(e,p),z(l,p),z(s,p)}}}function Qt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=G(e)},l(t){o=H(t,e)},m(t,l){L(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&_e(o,e)},d(t){t&&w(o)}}}function Yt(n){let e,o;return e=new mt({props:{$$slots:{default:[Qt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function xt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=G(e)},l(t){o=H(t,e)},m(t,l){L(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&_e(o,e)},d(t){t&&w(o)}}}function en(n){let e,o;return e=new mt({props:{$$slots:{default:[xt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function tn(n){let e,o,t,l,r,a;return e=new qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Je(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Yt]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Je(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[en]},$$scope:{ctx:n}}}),t.$on("click",n[9]),r=new Ht({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){A(e.$$.fragment),o=D(),A(t.$$.fragment),l=D(),A(r.$$.fragment)},l(s){N(e.$$.fragment,s),o=B(s),N(t.$$.fragment,s),l=B(s),N(r.$$.fragment,s)},m(s,i){P(e,s,i),L(s,o,i),P(t,s,i),L(s,l,i),P(r,s,i),a=!0},p(s,i){const c={};i[1]&512&&(c.$$scope={dirty:i,ctx:s}),e.$set(c);const _={};i[1]&512&&(_.$$scope={dirty:i,ctx:s}),t.$set(_)},i(s){a||(v(e.$$.fragment,s),v(t.$$.fragment,s),v(r.$$.fragment,s),a=!0)},o(s){j(e.$$.fragment,s),j(t.$$.fragment,s),j(r.$$.fragment,s),a=!1},d(s){s&&(w(o),w(l)),z(e,s),z(t,s),z(r,s)}}}function nn(n){let e,o,t,l;return e=new qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Et({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){A(e.$$.fragment),o=D(),A(t.$$.fragment)},l(r){N(e.$$.fragment,r),o=B(r),N(t.$$.fragment,r)},m(r,a){P(e,r,a),L(r,o,a),P(t,r,a),l=!0},p:we,i(r){l||(v(e.$$.fragment,r),v(t.$$.fragment,r),l=!0)},o(r){j(e.$$.fragment,r),j(t.$$.fragment,r),l=!1},d(r){r&&w(o),z(e,r),z(t,r)}}}function on(n){let e,o,t,l,r,a,s,i,c,_,g,u;e=new Pt({}),e.$on("click",n[8]),t=new Tt({props:{gj:n[4].summary.networkMap,show:n[2]}});let C=me(n[4].jat[n[0]][n[1]].arms),M=[];for(let f=0;f<C.length;f+=1)M[f]=We(Xe(n,C,f));const q=f=>j(M[f],1,1,()=>{M[f]=null});let U=me(n[4].jat[n[0]][n[1]].movements),E=[];for(let f=0;f<U.length;f+=1)E[f]=Ve(Re(n,U,f));const h=f=>j(E[f],1,1,()=>{E[f]=null});return s=new He({props:{data:n[10](n[4]),$$slots:{default:[tn]},$$scope:{ctx:n}}}),c=new He({props:{data:n[6],$$slots:{default:[nn]},$$scope:{ctx:n}}}),g=new Nt({props:{map:n[5]}}),{c(){A(e.$$.fragment),o=D(),A(t.$$.fragment),l=D();for(let f=0;f<M.length;f+=1)M[f].c();r=D();for(let f=0;f<E.length;f+=1)E[f].c();a=D(),A(s.$$.fragment),i=D(),A(c.$$.fragment),_=D(),A(g.$$.fragment)},l(f){N(e.$$.fragment,f),o=B(f),N(t.$$.fragment,f),l=B(f);for(let $=0;$<M.length;$+=1)M[$].l(f);r=B(f);for(let $=0;$<E.length;$+=1)E[$].l(f);a=B(f),N(s.$$.fragment,f),i=B(f),N(c.$$.fragment,f),_=B(f),N(g.$$.fragment,f)},m(f,$){P(e,f,$),L(f,o,$),P(t,f,$),L(f,l,$);for(let k=0;k<M.length;k+=1)M[k]&&M[k].m(f,$);L(f,r,$);for(let k=0;k<E.length;k+=1)E[k]&&E[k].m(f,$);L(f,a,$),P(s,f,$),L(f,i,$),P(c,f,$),L(f,_,$),P(g,f,$),u=!0},p(f,$){const k={};if($[0]&16&&(k.gj=f[4].summary.networkMap),$[0]&4&&(k.show=f[2]),t.$set(k),$[0]&27){C=me(f[4].jat[f[0]][f[1]].arms);let I;for(I=0;I<C.length;I+=1){const O=Xe(f,C,I);M[I]?(M[I].p(O,$),v(M[I],1)):(M[I]=We(O),M[I].c(),v(M[I],1),M[I].m(r.parentNode,r))}for(ae(),I=C.length;I<M.length;I+=1)q(I);ie()}if($[0]&155){U=me(f[4].jat[f[0]][f[1]].movements);let I;for(I=0;I<U.length;I+=1){const O=Re(f,U,I);E[I]?(E[I].p(O,$),v(E[I],1)):(E[I]=Ve(O),E[I].c(),v(E[I],1),E[I].m(a.parentNode,a))}for(ae(),I=U.length;I<E.length;I+=1)h(I);ie()}const p={};$[0]&16&&(p.data=f[10](f[4])),$[1]&512&&(p.$$scope={dirty:$,ctx:f}),s.$set(p);const y={};$[0]&64&&(y.data=f[6]),$[1]&512&&(y.$$scope={dirty:$,ctx:f}),c.$set(y);const J={};$[0]&32&&(J.map=f[5]),g.$set(J)},i(f){if(!u){v(e.$$.fragment,f),v(t.$$.fragment,f);for(let $=0;$<C.length;$+=1)v(M[$]);for(let $=0;$<U.length;$+=1)v(E[$]);v(s.$$.fragment,f),v(c.$$.fragment,f),v(g.$$.fragment,f),u=!0}},o(f){j(e.$$.fragment,f),j(t.$$.fragment,f),M=M.filter(Boolean);for(let $=0;$<M.length;$+=1)j(M[$]);E=E.filter(Boolean);for(let $=0;$<E.length;$+=1)j(E[$]);j(s.$$.fragment,f),j(c.$$.fragment,f),j(g.$$.fragment,f),u=!1},d(f){f&&(w(o),w(l),w(r),w(a),w(i),w(_)),z(e,f),z(t,f),Le(M,f),Le(E,f),z(s,f),z(c,f),z(g,f)}}}function ln(n){let e,o,t;function l(a){n[30](a)}let r={$$slots:{default:[on]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.map=n[5]),e=new yt({props:r}),x.push(()=>te(e,"map",l)),{c(){A(e.$$.fragment)},l(a){N(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};s[0]&127|s[1]&512&&(i.$$scope={dirty:s,ctx:a}),!o&&s[0]&32&&(o=!0,i.map=a[5],ee(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){j(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Ze(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function rn(n){return String.fromCharCode(n+65)}function an(n,e,o){let t,l;Ae(n,W,b=>o(4,l=b));let{junctionIdx:r}=e,{stage:a}=e,{newKind:s}=e,{editing:i}=e,{hoveringSidebar:c}=e,{streetviewOn:_}=e,{showContext:g}=e,{select:u}=e,{stopEditing:C}=e,M,q={0:pe.red.background,1:pe.amber.background,2:pe.green.background,X:pe.critical.background};function U(b,d,Q){let R={type:"FeatureCollection",features:[]},m=d??Q;return m!=null&&(m.kind=="arm"?R.features.push(Ze(b.jat[r][a].arms[m.idx],m.idx)):R.features.push($(b.jat[r][a].movements[m.idx],m.idx))),R}async function E(b){if(!_){for(let d of M.queryRenderedFeatures(b.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i!=null){await C();return}s=="arm"?(be(W,l.jat[r][a].arms=[...l.jat[r][a].arms,{point:b.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[r][a].arms.length-1})):(be(W,l.jat[r][a].movements=[...l.jat[r][a].movements,{point1:b.detail.lngLat.toArray(),point2:Ee(b.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Ee(b.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[r][a].movements.length-1}))}}async function h(b){await u({kind:"movement",idx:b.detail.features[0].id})}bt(()=>{p(!1)});function f(b){let d={type:"FeatureCollection",features:b.jat[r][a].movements.map((Q,R)=>$(Q,R))};for(let Q of b.jat[r][a].movements)if(d.features.push(k(Q,d.features.length)),Q.kind=="walking & wheeling"){let R={...Q,point1:Q.point3,point3:Q.point1};d.features.push(k(R,d.features.length))}return d}function $(b,d){return{type:"Feature",id:d,properties:{name:b.name,kind:b.kind,color:q[b.score]},geometry:{type:"LineString",coordinates:[b.point1,b.point2,b.point3]}}}function k(b,d){return{type:"Feature",id:d,properties:{kind:b.kind,color:q[b.score],angle:Te(b.point2,b.point3)},geometry:{type:"Point",coordinates:b.point3}}}function p(b){let d=f(l);for(let Q of l.jat[r][a].arms)d.features.push(Ze(Q,d.features.length));for(let Q of l.summary.networkMap.features)d.features.push(Q);d.features.length>0&&M.fitBounds(It(d),{padding:20,animate:b})}function y(){return M}function J(b,d){n.$$.not_equal(d.point,b)&&(d.point=b,W.set(l))}const I=b=>u({kind:"arm",idx:b}),O=b=>u({kind:"arm",idx:b});function ge(b,d){n.$$.not_equal(d.point1,b)&&(d.point1=b,W.set(l))}const T=b=>u({kind:"movement",idx:b}),ne=b=>u({kind:"movement",idx:b});function je(b,d){n.$$.not_equal(d.point2,b)&&(d.point2=b,W.set(l))}const he=b=>u({kind:"movement",idx:b}),fe=b=>u({kind:"movement",idx:b});function K(b,d){n.$$.not_equal(d.point3,b)&&(d.point3=b,W.set(l))}const Ce=b=>u({kind:"movement",idx:b}),V=b=>u({kind:"movement",idx:b});function Z(b){M=b,o(5,M)}return n.$$set=b=>{"junctionIdx"in b&&o(0,r=b.junctionIdx),"stage"in b&&o(1,a=b.stage),"newKind"in b&&o(11,s=b.newKind),"editing"in b&&o(12,i=b.editing),"hoveringSidebar"in b&&o(13,c=b.hoveringSidebar),"streetviewOn"in b&&o(14,_=b.streetviewOn),"showContext"in b&&o(2,g=b.showContext),"select"in b&&o(3,u=b.select),"stopEditing"in b&&o(15,C=b.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&12304&&o(6,t=U(l,i,c))},[r,a,g,u,l,M,t,q,E,h,f,s,i,c,_,C,p,y,J,I,O,ge,T,ne,je,he,fe,K,Ce,V,Z]}class sn extends Se{constructor(e){super(),ye(this,e,an,ln,ve,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function fn(n){let e,o,t,l,r,a,s,i,c,_,g,u;function C(k){n[5](k)}let M={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(M.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Oe({props:M}),x.push(()=>te(e,"value",C));function q(k){n[6](k)}let U={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(U.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new Be({props:U}),x.push(()=>te(l,"value",q));function E(k){n[7](k)}let h={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(h.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new Be({props:h}),x.push(()=>te(s,"value",E));function f(k){n[8](k)}let $={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),_=new ct({props:$}),x.push(()=>te(_,"value",f)),{c(){A(e.$$.fragment),t=D(),A(l.$$.fragment),a=D(),A(s.$$.fragment),c=D(),A(_.$$.fragment)},l(k){N(e.$$.fragment,k),t=B(k),N(l.$$.fragment,k),a=B(k),N(s.$$.fragment,k),c=B(k),N(_.$$.fragment,k)},m(k,p){P(e,k,p),L(k,t,p),P(l,k,p),L(k,a,p),P(s,k,p),L(k,c,p),P(_,k,p),u=!0},p(k,[p]){const y={};!o&&p&15&&(o=!0,y.value=k[3].jat[k[0]][k[1]].movements[k[2]].name,ee(()=>o=!1)),e.$set(y);const J={};!r&&p&15&&(r=!0,J.value=k[3].jat[k[0]][k[1]].movements[k[2]].kind,ee(()=>r=!1)),l.$set(J);const I={};!i&&p&15&&(i=!0,I.value=k[3].jat[k[0]][k[1]].movements[k[2]].score,ee(()=>i=!1)),s.$set(I);const O={};!g&&p&15&&(g=!0,O.value=k[3].jat[k[0]][k[1]].movements[k[2]].notes,ee(()=>g=!1)),_.$set(O)},i(k){u||(v(e.$$.fragment,k),v(l.$$.fragment,k),v(s.$$.fragment,k),v(_.$$.fragment,k),u=!0)},o(k){j(e.$$.fragment,k),j(l.$$.fragment,k),j(s.$$.fragment,k),j(_.$$.fragment,k),u=!1},d(k){k&&(w(t),w(a),w(c)),z(e,k),z(l,k),z(s,k),z(_,k)}}}function un(n,e,o){let t;Ae(n,W,u=>o(3,t=u));let{junctionIdx:l}=e,{stage:r}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function i(u){n.$$.not_equal(t.jat[l][r].movements[a].name,u)&&(t.jat[l][r].movements[a].name=u,W.set(t))}function c(u){n.$$.not_equal(t.jat[l][r].movements[a].kind,u)&&(t.jat[l][r].movements[a].kind=u,W.set(t))}function _(u){n.$$.not_equal(t.jat[l][r].movements[a].score,u)&&(t.jat[l][r].movements[a].score=u,W.set(t))}function g(u){n.$$.not_equal(t.jat[l][r].movements[a].notes,u)&&(t.jat[l][r].movements[a].notes=u,W.set(t))}return n.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,r=u.stage),"idx"in u&&o(2,a=u.idx)},[l,r,a,t,s,i,c,_,g]}class mn extends Se{constructor(e){super(),ye(this,e,un,fn,ve,{junctionIdx:0,stage:1,idx:2})}}function cn(n,e){e.map(s=>Te(s.point,n.point)),2*(e.length-1);let o=e.length-1,t=Array(e.length).fill(0),l=.002,r=s=>{let i=e[s].point,_=Te(i,n.point)+(t[s]<o?90:-90),g=l*(1+t[s]%o);return t[s]++,Ee(i,g,_).geometry.coordinates},a=[];for(let s=0;s<e.length;s++)for(let i=0;i<e.length;i++){if(s==i)continue;let c=e[s],_=e[i],g=r(s),u=r(i),C=Te(n.point,u);a.push({point1:g,point2:Ee(n.point,l,C).geometry.coordinates,point3:u,kind:"cycling",score:"0",name:`${c.name} to ${_.name}`,notes:""})}return a}const{window:_n}=At;function Qe(n,e,o){const t=n.slice();t[35]=e[o],t[38]=o;const l=t[17][t[35].score];return t[36]=l,t}function Ye(n,e,o){const t=n.slice();return t[39]=e[o],t[38]=o,t}function gn(n){let e,o,t,l,r,a,s,i;e=new ft({props:{$$slots:{default:[dn]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new ut({props:{$$slots:{default:[$n]},$$scope:{ctx:n}}}),t.$on("click",n[13]);const c=[kn,hn],_=[];function g(u,C){return u[3].kind=="movement"?0:1}return r=g(n),a=_[r]=c[r](n),{c(){A(e.$$.fragment),o=D(),A(t.$$.fragment),l=D(),a.c(),s=ce()},l(u){N(e.$$.fragment,u),o=B(u),N(t.$$.fragment,u),l=B(u),a.l(u),s=ce()},m(u,C){P(e,u,C),L(u,o,C),P(t,u,C),L(u,l,C),_[r].m(u,C),L(u,s,C),i=!0},p(u,C){const M={};C[1]&1024&&(M.$$scope={dirty:C,ctx:u}),e.$set(M);const q={};C[1]&1024&&(q.$$scope={dirty:C,ctx:u}),t.$set(q);let U=r;r=g(u),r===U?_[r].p(u,C):(ae(),j(_[U],1,1,()=>{_[U]=null}),ie(),a=_[r],a?a.p(u,C):(a=_[r]=c[r](u),a.c()),v(a,1),a.m(s.parentNode,s))},i(u){i||(v(e.$$.fragment,u),v(t.$$.fragment,u),v(a),i=!0)},o(u){j(e.$$.fragment,u),j(t.$$.fragment,u),j(a),i=!1},d(u){u&&(w(o),w(l),w(s)),z(e,u),z(t,u),_[r].d(u)}}}function pn(n){let e,o,t,l,r,a,s,i=(n[9].jat[n[0]].name||"Untitled junction")+"",c,_,g,u,C,M,q,U="Arms",E,h,f,$,k="Movements",p,y,J,I,O;e=new Ut({props:{label:"Tools",$$slots:{default:[wn]},$$scope:{ctx:n}}});function ge(m,S){return m[9].jat[m[0]][m[1]].movements.length>0?Cn:jn}let T=ge(n),ne=T(n);function je(m){n[23](m)}let he={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};n[2]!==void 0&&(he.value=n[2]),u=new Be({props:he}),x.push(()=>te(u,"value",je));let fe=me(n[9].jat[n[0]][n[1]].arms),K=[];for(let m=0;m<fe.length;m+=1)K[m]=xe(Ye(n,fe,m));const Ce=m=>j(K[m],1,1,()=>{K[m]=null});let V=n[9].jat[n[0]][n[10]].arms.length>0&&et(n),Z=n[9].jat[n[0]][n[1]].arms.length>0&&tt(n),b=me(n[9].jat[n[0]][n[1]].movements),d=[];for(let m=0;m<b.length;m+=1)d[m]=nt(Qe(n,b,m));const Q=m=>j(d[m],1,1,()=>{d[m]=null});let R=n[9].jat[n[0]][n[10]].movements.length>0&&ot(n);return{c(){A(e.$$.fragment),o=D(),t=le("p"),l=G("Total JAT score for "),r=G(n[1]),a=D(),s=le("u"),c=G(i),_=G(`
        :
        `),ne.c(),g=D(),A(u.$$.fragment),M=D(),q=le("h3"),q.textContent=U,E=D();for(let m=0;m<K.length;m+=1)K[m].c();h=D(),V&&V.c(),f=D(),$=le("h3"),$.textContent=k,p=D(),Z&&Z.c(),y=D();for(let m=0;m<d.length;m+=1)d[m].c();J=D(),R&&R.c(),I=ce()},l(m){N(e.$$.fragment,m),o=B(m),t=re(m,"P",{});var S=se(t);l=H(S,"Total JAT score for "),r=H(S,n[1]),a=B(S),s=re(S,"U",{});var oe=se(s);c=H(oe,i),oe.forEach(w),_=H(S,`
        :
        `),ne.l(S),S.forEach(w),g=B(m),N(u.$$.fragment,m),M=B(m),q=re(m,"H3",{"data-svelte-h":!0}),Ge(q)!=="svelte-ld74qb"&&(q.textContent=U),E=B(m);for(let ue=0;ue<K.length;ue+=1)K[ue].l(m);h=B(m),V&&V.l(m),f=B(m),$=re(m,"H3",{"data-svelte-h":!0}),Ge($)!=="svelte-1dc52s8"&&($.textContent=k),p=B(m),Z&&Z.l(m),y=B(m);for(let ue=0;ue<d.length;ue+=1)d[ue].l(m);J=B(m),R&&R.l(m),I=ce()},m(m,S){P(e,m,S),L(m,o,S),L(m,t,S),Y(t,l),Y(t,r),Y(t,a),Y(t,s),Y(s,c),Y(t,_),ne.m(t,null),L(m,g,S),P(u,m,S),L(m,M,S),L(m,q,S),L(m,E,S);for(let oe=0;oe<K.length;oe+=1)K[oe]&&K[oe].m(m,S);L(m,h,S),V&&V.m(m,S),L(m,f,S),L(m,$,S),L(m,p,S),Z&&Z.m(m,S),L(m,y,S);for(let oe=0;oe<d.length;oe+=1)d[oe]&&d[oe].m(m,S);L(m,J,S),R&&R.m(m,S),L(m,I,S),O=!0},p(m,S){const oe={};S[0]&224|S[1]&1024&&(oe.$$scope={dirty:S,ctx:m}),e.$set(oe),(!O||S[0]&2)&&_e(r,m[1]),(!O||S[0]&513)&&i!==(i=(m[9].jat[m[0]].name||"Untitled junction")+"")&&_e(c,i),T===(T=ge(m))&&ne?ne.p(m,S):(ne.d(1),ne=T(m),ne&&(ne.c(),ne.m(t,null)));const ue={};if(!C&&S[0]&4&&(C=!0,ue.value=m[2],ee(()=>C=!1)),u.$set(ue),S[0]&2579){fe=me(m[9].jat[m[0]][m[1]].arms);let F;for(F=0;F<fe.length;F+=1){const Me=Ye(m,fe,F);K[F]?(K[F].p(Me,S),v(K[F],1)):(K[F]=xe(Me),K[F].c(),v(K[F],1),K[F].m(h.parentNode,h))}for(ae(),F=fe.length;F<K.length;F+=1)Ce(F);ie()}if(m[9].jat[m[0]][m[10]].arms.length>0?V?(V.p(m,S),S[0]&513&&v(V,1)):(V=et(m),V.c(),v(V,1),V.m(f.parentNode,f)):V&&(ae(),j(V,1,1,()=>{V=null}),ie()),m[9].jat[m[0]][m[1]].arms.length>0?Z?(Z.p(m,S),S[0]&515&&v(Z,1)):(Z=tt(m),Z.c(),v(Z,1),Z.m(y.parentNode,y)):Z&&(ae(),j(Z,1,1,()=>{Z=null}),ie()),S[0]&133651){b=me(m[9].jat[m[0]][m[1]].movements);let F;for(F=0;F<b.length;F+=1){const Me=Qe(m,b,F);d[F]?(d[F].p(Me,S),v(d[F],1)):(d[F]=nt(Me),d[F].c(),v(d[F],1),d[F].m(J.parentNode,J))}for(ae(),F=b.length;F<d.length;F+=1)Q(F);ie()}m[9].jat[m[0]][m[10]].movements.length>0?R?(R.p(m,S),S[0]&513&&v(R,1)):(R=ot(m),R.c(),v(R,1),R.m(I.parentNode,I)):R&&(ae(),j(R,1,1,()=>{R=null}),ie())},i(m){if(!O){v(e.$$.fragment,m),v(u.$$.fragment,m);for(let S=0;S<fe.length;S+=1)v(K[S]);v(V),v(Z);for(let S=0;S<b.length;S+=1)v(d[S]);v(R),O=!0}},o(m){j(e.$$.fragment,m),j(u.$$.fragment,m),K=K.filter(Boolean);for(let S=0;S<K.length;S+=1)j(K[S]);j(V),j(Z),d=d.filter(Boolean);for(let S=0;S<d.length;S+=1)j(d[S]);j(R),O=!1},d(m){m&&(w(o),w(t),w(g),w(M),w(q),w(E),w(h),w(f),w($),w(p),w(y),w(J),w(I)),z(e,m),ne.d(),z(u,m),Le(K,m),V&&V.d(m),Z&&Z.d(m),Le(d,m),R&&R.d(m)}}}function dn(n){let e;return{c(){e=G("Save")},l(o){e=H(o,"Save")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function $n(n){let e;return{c(){e=G("Delete")},l(o){e=H(o,"Delete")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function hn(n){let e,o,t;function l(a){n[30](a)}let r={label:"Arm Name"};return n[9].jat[n[0]][n[1]].arms[n[3].idx].name!==void 0&&(r.value=n[9].jat[n[0]][n[1]].arms[n[3].idx].name),e=new Oe({props:r}),x.push(()=>te(e,"value",l)),{c(){A(e.$$.fragment)},l(a){N(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};!o&&s[0]&523&&(o=!0,i.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,ee(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){j(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function kn(n){let e,o;return e=new mn({props:{junctionIdx:n[0],stage:n[1],idx:n[3].idx}}),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[0]&1&&(r.junctionIdx=t[0]),l[0]&2&&(r.stage=t[1]),l[0]&8&&(r.idx=t[3].idx),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function bn(n){let e;return{c(){e=G("Zoom to fit")},l(o){e=H(o,"Zoom to fit")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function vn(n){let e;return{c(){e=G("Show scheme context")},l(o){e=H(o,"Show scheme context")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function wn(n){var E;let e,o,t,l,r,a,s,i,c,_,g,u;e=new $e({props:{$$slots:{default:[bn]},$$scope:{ctx:n}}}),e.$on("click",n[20]),t=new zt({}),r=new qt({});function C(h){n[21](h)}let M={map:(E=n[7])==null?void 0:E.getMap()};n[5]!==void 0&&(M.enabled=n[5]),s=new Dt({props:M}),x.push(()=>te(s,"enabled",C));function q(h){n[22](h)}let U={$$slots:{default:[vn]},$$scope:{ctx:n}};return n[6]!==void 0&&(U.checked=n[6]),_=new Bt({props:U}),x.push(()=>te(_,"checked",q)),{c(){A(e.$$.fragment),o=D(),A(t.$$.fragment),l=D(),A(r.$$.fragment),a=D(),A(s.$$.fragment),c=D(),A(_.$$.fragment)},l(h){N(e.$$.fragment,h),o=B(h),N(t.$$.fragment,h),l=B(h),N(r.$$.fragment,h),a=B(h),N(s.$$.fragment,h),c=B(h),N(_.$$.fragment,h)},m(h,f){P(e,h,f),L(h,o,f),P(t,h,f),L(h,l,f),P(r,h,f),L(h,a,f),P(s,h,f),L(h,c,f),P(_,h,f),u=!0},p(h,f){var y;const $={};f[1]&1024&&($.$$scope={dirty:f,ctx:h}),e.$set($);const k={};f[0]&128&&(k.map=(y=h[7])==null?void 0:y.getMap()),!i&&f[0]&32&&(i=!0,k.enabled=h[5],ee(()=>i=!1)),s.$set(k);const p={};f[1]&1024&&(p.$$scope={dirty:f,ctx:h}),!g&&f[0]&64&&(g=!0,p.checked=h[6],ee(()=>g=!1)),_.$set(p)},i(h){u||(v(e.$$.fragment,h),v(t.$$.fragment,h),v(r.$$.fragment,h),v(s.$$.fragment,h),v(_.$$.fragment,h),u=!0)},o(h){j(e.$$.fragment,h),j(t.$$.fragment,h),j(r.$$.fragment,h),j(s.$$.fragment,h),j(_.$$.fragment,h),u=!1},d(h){h&&(w(o),w(l),w(a),w(c)),z(e,h),z(t,h),z(r,h),z(s,h),z(_,h)}}}function jn(n){let e;return{c(){e=G("No movements added")},l(o){e=H(o,"No movements added")},m(o,t){L(o,e,t)},p:we,d(o){o&&w(e)}}}function Cn(n){let e=Math.round(rt(n[9].jat[n[0]][n[1]]))+"",o,t;return{c(){o=G(e),t=G("%")},l(l){o=H(l,e),t=H(l,"%")},m(l,r){L(l,o,r),L(l,t,r)},p(l,r){r[0]&515&&e!==(e=Math.round(rt(l[9].jat[l[0]][l[1]]))+"")&&_e(o,e)},d(l){l&&(w(o),w(t))}}}function xe(n){let e,o;function t(){return n[24](n[38])}function l(){return n[25](n[38])}return e=new Ue({props:{name:`${lt(n[38])} - ${n[39].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[26]),{c(){A(e.$$.fragment)},l(r){N(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=`${lt(n[38])} - ${n[39].name||"Unnamed arm"}`),e.$set(s)},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){j(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function et(n){let e,o;return e=new $e({props:{$$slots:{default:[Mn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&1024&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Mn(n){let e,o;return{c(){e=G("Copy arms from "),o=G(n[10])},l(t){e=H(t,"Copy arms from "),o=H(t,n[10])},m(t,l){L(t,e,l),L(t,o,l)},p:we,d(t){t&&(w(e),w(o))}}}function tt(n){let e,o;return e=new $e({props:{$$slots:{default:[Ln]},$$scope:{ctx:n}}}),e.$on("click",n[18]),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&1024&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Ln(n){let e;return{c(){e=G("Generate movements between all arms (1st arm is the center)")},l(o){e=H(o,"Generate movements between all arms (1st arm is the center)")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function Sn(n){let e,o,t,l=n[35].score+"",r,a,s,i=Ke(n[35].kind)+"",c;return{c(){e=le("div"),o=le("span"),t=G("Score: "),r=G(l),a=D(),s=le("span"),c=G(i),this.h()},l(_){e=re(_,"DIV",{style:!0});var g=se(e);o=re(g,"SPAN",{style:!0});var u=se(o);t=H(u,"Score: "),r=H(u,l),u.forEach(w),a=B(g),s=re(g,"SPAN",{});var C=se(s);c=H(C,i),C.forEach(w),g.forEach(w),this.h()},h(){X(o,"padding","4px"),X(o,"color",n[36].font),X(o,"background-color",n[36].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(_,g){L(_,e,g),Y(e,o),Y(o,t),Y(o,r),Y(e,a),Y(e,s),Y(s,c)},p(_,g){g[0]&515&&l!==(l=_[35].score+"")&&_e(r,l),g[0]&515&&X(o,"color",_[36].font),g[0]&515&&X(o,"background-color",_[36].background),g[0]&515&&i!==(i=Ke(_[35].kind)+"")&&_e(c,i)},d(_){_&&w(e)}}}function nt(n){let e,o;function t(){return n[27](n[38])}function l(){return n[28](n[38])}return e=new Ue({props:{name:n[35].name||"Unnamed movement",$$slots:{default:[Sn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[29]),{c(){A(e.$$.fragment)},l(r){N(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=n[35].name||"Unnamed movement"),a[0]&515|a[1]&1024&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){j(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function ot(n){let e,o;return e=new $e({props:{$$slots:{default:[yn]},$$scope:{ctx:n}}}),e.$on("click",n[16]),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&1024&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function yn(n){let e,o;return{c(){e=G("Copy movements from "),o=G(n[10])},l(t){e=H(t,"Copy movements from "),o=H(t,n[10])},m(t,l){L(t,e,l),L(t,o,l)},p:we,d(t){t&&(w(e),w(o))}}}function In(n){let e,o,t,l,r,a,s,i,c,_,g,u,C,M;function q(p){n[19](p)}let U={label:"Commentary / Notes"};n[9].jat[n[0]][n[1]].notes!==void 0&&(U.value=n[9].jat[n[0]][n[1]].notes),e=new ct({props:U}),x.push(()=>te(e,"value",q));const E=[pn,gn],h=[];function f(p,y){return p[3]==null?0:1}a=f(n),s=h[a]=E[a](n);function $(p){n[33](p)}let k={junctionIdx:n[0],stage:n[1],newKind:n[2],hoveringSidebar:n[4],streetviewOn:n[5],showContext:n[6],select:n[11],stopEditing:n[12]};return n[3]!==void 0&&(k.editing=n[3]),_=new sn({props:k}),n[32](_),x.push(()=>te(_,"editing",$)),{c(){A(e.$$.fragment),t=D(),l=le("div"),r=le("div"),s.c(),i=D(),c=le("div"),A(_.$$.fragment),this.h()},l(p){N(e.$$.fragment,p),t=B(p),l=re(p,"DIV",{style:!0});var y=se(l);r=re(y,"DIV",{style:!0});var J=se(r);s.l(J),J.forEach(w),i=B(y),c=re(y,"DIV",{style:!0});var I=se(c);N(_.$$.fragment,I),I.forEach(w),y.forEach(w),this.h()},h(){X(r,"width","30%"),X(r,"overflow-y","scroll"),X(r,"padding","10px"),X(r,"border","1px solid black"),X(c,"position","relative"),X(c,"width","100%"),X(l,"display","flex"),X(l,"height","80vh")},m(p,y){P(e,p,y),L(p,t,y),L(p,l,y),Y(l,r),h[a].m(r,null),n[31](r),Y(l,i),Y(l,c),P(_,c,null),u=!0,C||(M=vt(_n,"keydown",n[14]),C=!0)},p(p,y){const J={};!o&&y[0]&515&&(o=!0,J.value=p[9].jat[p[0]][p[1]].notes,ee(()=>o=!1)),e.$set(J);let I=a;a=f(p),a===I?h[a].p(p,y):(ae(),j(h[I],1,1,()=>{h[I]=null}),ie(),s=h[a],s?s.p(p,y):(s=h[a]=E[a](p),s.c()),v(s,1),s.m(r,null));const O={};y[0]&1&&(O.junctionIdx=p[0]),y[0]&2&&(O.stage=p[1]),y[0]&4&&(O.newKind=p[2]),y[0]&16&&(O.hoveringSidebar=p[4]),y[0]&32&&(O.streetviewOn=p[5]),y[0]&64&&(O.showContext=p[6]),!g&&y[0]&8&&(g=!0,O.editing=p[3],ee(()=>g=!1)),_.$set(O)},i(p){u||(v(e.$$.fragment,p),v(s),v(_.$$.fragment,p),u=!0)},o(p){j(e.$$.fragment,p),j(s),j(_.$$.fragment,p),u=!1},d(p){p&&(w(t),w(l)),z(e,p),h[a].d(),n[31](null),n[32](null),z(_),C=!1,M()}}}function lt(n){return String.fromCharCode(n+65)}function rt(n){let e=0,o=0;for(let t of n.movements)e+={0:0,1:1,2:2,X:0}[t.score],o+=2;return e/o*100}function Tn(n,e,o){let t;Ae(n,W,d=>o(9,t=d));let{junctionIdx:l}=e,{stage:r}=e,a=r=="existing"?"proposed":"existing",s="arm",i=null,c=null,_=null,g=!1,u=!0,C=null,M;async function q(d){c=M.scrollTop,o(3,i=d),o(4,_=null)}async function U(){o(3,i=null),c!=null&&(await wt(),o(8,M.scrollTop=c,M),c=null)}function E(){window.confirm(`Delete this ${i.kind}?`)&&(i.kind=="movement"?(t.jat[l][r].movements.splice(i.idx,1),W.set(t)):(t.jat[l][r].arms.splice(i.idx,1),W.set(t)),U())}function h(d){if(i!=null&&d.key=="Escape")d.stopPropagation(),U();else if(i!=null&&d.key=="Delete"){let Q=d.target.tagName;if(Q=="INPUT"||Q=="TEXTAREA")return;d.stopPropagation(),E()}}function f(){t.jat[l][r].arms.length>0&&!window.confirm("Overwrite arms?")||(be(W,t.jat[l][r].arms=JSON.parse(JSON.stringify(t.jat[l][a].arms)),t),W.set(t))}function $(){t.jat[l][r].movements.length>0&&!window.confirm("Overwrite movements?")||(be(W,t.jat[l][r].movements=JSON.parse(JSON.stringify(t.jat[l][a].movements)),t),W.set(t))}let k={0:pe.red,1:pe.amber,2:pe.green,X:pe.critical};function p(){let[d,...Q]=t.jat[l][r].arms;be(W,t.jat[l][r].movements=cn(d,Q),t)}function y(d){n.$$.not_equal(t.jat[l][r].notes,d)&&(t.jat[l][r].notes=d,W.set(t))}const J=()=>C==null?void 0:C.zoom(!0);function I(d){g=d,o(5,g)}function O(d){u=d,o(6,u)}function ge(d){s=d,o(2,s)}const T=d=>q({kind:"arm",idx:d}),ne=d=>o(4,_={kind:"arm",idx:d}),je=()=>o(4,_=null),he=d=>q({kind:"movement",idx:d}),fe=d=>o(4,_={kind:"movement",idx:d}),K=()=>o(4,_=null);function Ce(d){n.$$.not_equal(t.jat[l][r].arms[i.idx].name,d)&&(t.jat[l][r].arms[i.idx].name=d,W.set(t))}function V(d){x[d?"unshift":"push"](()=>{M=d,o(8,M)})}function Z(d){x[d?"unshift":"push"](()=>{C=d,o(7,C)})}function b(d){i=d,o(3,i)}return n.$$set=d=>{"junctionIdx"in d&&o(0,l=d.junctionIdx),"stage"in d&&o(1,r=d.stage)},[l,r,s,i,_,g,u,C,M,t,a,q,U,E,h,f,$,k,p,y,J,I,O,ge,T,ne,je,he,fe,K,Ce,V,Z,b]}class En extends Se{constructor(e){super(),ye(this,e,Tn,In,ve,{junctionIdx:0,stage:1},null,[-1,-1])}}function at(n,e,o){const t=n.slice();return t[10]=e[o],t[12]=o,t}function An(n){let e,o=(n[1].jat[n[0].idx].name||"Untitled junction")+"",t,l,r=n[0].stage+"",a,s,i,c,_,g,u,C=n[0].stage,M,q;i=new jt({props:{$$slots:{default:[On]},$$scope:{ctx:n}}});function U(f){n[9](f)}let E={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(E.value=n[1].jat[n[0].idx].name),_=new Oe({props:E}),x.push(()=>te(_,"value",U));let h=it(n);return{c(){e=le("h2"),t=G(o),l=G(" - "),a=G(r),s=D(),A(i.$$.fragment),c=D(),A(_.$$.fragment),u=D(),h.c(),M=ce()},l(f){e=re(f,"H2",{});var $=se(e);t=H($,o),l=H($," - "),a=H($,r),$.forEach(w),s=B(f),N(i.$$.fragment,f),c=B(f),N(_.$$.fragment,f),u=B(f),h.l(f),M=ce()},m(f,$){L(f,e,$),Y(e,t),Y(e,l),Y(e,a),L(f,s,$),P(i,f,$),L(f,c,$),P(_,f,$),L(f,u,$),h.m(f,$),L(f,M,$),q=!0},p(f,$){(!q||$&3)&&o!==(o=(f[1].jat[f[0].idx].name||"Untitled junction")+"")&&_e(t,o),(!q||$&1)&&r!==(r=f[0].stage+"")&&_e(a,r);const k={};$&8193&&(k.$$scope={dirty:$,ctx:f}),i.$set(k);const p={};!g&&$&3&&(g=!0,p.value=f[1].jat[f[0].idx].name,ee(()=>g=!1)),_.$set(p),$&1&&ve(C,C=f[0].stage)?(ae(),j(h,1,1,we),ie(),h=it(f),h.c(),v(h,1),h.m(M.parentNode,M)):h.p(f,$)},i(f){q||(v(i.$$.fragment,f),v(_.$$.fragment,f),v(h),q=!0)},o(f){j(i.$$.fragment,f),j(_.$$.fragment,f),j(h),q=!1},d(f){f&&(w(e),w(s),w(c),w(u),w(M)),z(i,f),z(_,f),h.d(f)}}}function Nn(n){let e,o,t,l;e=new ft({props:{$$slots:{default:[Fn]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let r=me(n[1].jat),a=[];for(let i=0;i<r.length;i+=1)a[i]=st(at(n,r,i));const s=i=>j(a[i],1,1,()=>{a[i]=null});return{c(){A(e.$$.fragment),o=D();for(let i=0;i<a.length;i+=1)a[i].c();t=ce()},l(i){N(e.$$.fragment,i),o=B(i);for(let c=0;c<a.length;c+=1)a[c].l(i);t=ce()},m(i,c){P(e,i,c),L(i,o,c);for(let _=0;_<a.length;_+=1)a[_]&&a[_].m(i,c);L(i,t,c),l=!0},p(i,c){const _={};if(c&8192&&(_.$$scope={dirty:c,ctx:i}),e.$set(_),c&3){r=me(i[1].jat);let g;for(g=0;g<r.length;g+=1){const u=at(i,r,g);a[g]?(a[g].p(u,c),v(a[g],1)):(a[g]=st(u),a[g].c(),v(a[g],1),a[g].m(t.parentNode,t))}for(ae(),g=r.length;g<a.length;g+=1)s(g);ie()}},i(i){if(!l){v(e.$$.fragment,i);for(let c=0;c<r.length;c+=1)v(a[c]);l=!0}},o(i){j(e.$$.fragment,i),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)j(a[c]);l=!1},d(i){i&&(w(o),w(t)),z(e,i),Le(a,i)}}}function Pn(n){let e;return{c(){e=G("Back to all junctions")},l(o){e=H(o,"Back to all junctions")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function zn(n){let e,o;return e=new $e({props:{$$slots:{default:[Dn]},$$scope:{ctx:n}}}),e.$on("click",n[7]),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function qn(n){let e,o;return e=new $e({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Dn(n){let e;return{c(){e=G("Edit Proposed")},l(o){e=H(o,"Edit Proposed")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function Bn(n){let e;return{c(){e=G("Edit Existing")},l(o){e=H(o,"Edit Existing")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function Un(n){let e;return{c(){e=G("Delete")},l(o){e=H(o,"Delete")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function On(n){let e,o,t,l,r,a,s;e=new $e({props:{$$slots:{default:[Pn]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const i=[qn,zn],c=[];function _(g,u){return g[0].stage=="proposed"?0:1}return t=_(n),l=c[t]=i[t](n),a=new ut({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),a.$on("click",n[8]),{c(){A(e.$$.fragment),o=D(),l.c(),r=D(),A(a.$$.fragment)},l(g){N(e.$$.fragment,g),o=B(g),l.l(g),r=B(g),N(a.$$.fragment,g)},m(g,u){P(e,g,u),L(g,o,u),c[t].m(g,u),L(g,r,u),P(a,g,u),s=!0},p(g,u){const C={};u&8192&&(C.$$scope={dirty:u,ctx:g}),e.$set(C);let M=t;t=_(g),t===M?c[t].p(g,u):(ae(),j(c[M],1,1,()=>{c[M]=null}),ie(),l=c[t],l?l.p(g,u):(l=c[t]=i[t](g),l.c()),v(l,1),l.m(r.parentNode,r));const q={};u&8192&&(q.$$scope={dirty:u,ctx:g}),a.$set(q)},i(g){s||(v(e.$$.fragment,g),v(l),v(a.$$.fragment,g),s=!0)},o(g){j(e.$$.fragment,g),j(l),j(a.$$.fragment,g),s=!1},d(g){g&&(w(o),w(r)),z(e,g),c[t].d(g),z(a,g)}}}function it(n){let e,o;return e=new En({props:{junctionIdx:n[0].idx,stage:n[0].stage}}),{c(){A(e.$$.fragment)},l(t){N(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&1&&(r.junctionIdx=t[0].idx),l&1&&(r.stage=t[0].stage),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Fn(n){let e;return{c(){e=G("Add new junction")},l(o){e=H(o,"Add new junction")},m(o,t){L(o,e,t)},d(o){o&&w(e)}}}function st(n){let e,o;function t(){return n[4](n[12])}return e=new Ue({props:{name:n[10].name||"Untitled junction"}}),e.$on("click",t),{c(){A(e.$$.fragment)},l(l){N(e.$$.fragment,l)},m(l,r){P(e,l,r),o=!0},p(l,r){n=l;const a={};r&2&&(a.name=n[10].name||"Untitled junction"),e.$set(a)},i(l){o||(v(e.$$.fragment,l),o=!0)},o(l){j(e.$$.fragment,l),o=!1},d(l){z(e,l)}}}function Gn(n){let e,o,t,l;const r=[Nn,An],a=[];function s(i,c){return i[0].kind=="list"?0:i[0].kind=="edit"?1:-1}return~(e=s(n))&&(o=a[e]=r[e](n)),{c(){o&&o.c(),t=ce()},l(i){o&&o.l(i),t=ce()},m(i,c){~e&&a[e].m(i,c),L(i,t,c),l=!0},p(i,[c]){let _=e;e=s(i),e===_?~e&&a[e].p(i,c):(o&&(ae(),j(a[_],1,1,()=>{a[_]=null}),ie()),~e?(o=a[e],o?o.p(i,c):(o=a[e]=r[e](i),o.c()),v(o,1),o.m(t.parentNode,t)):o=null)},i(i){l||(v(o),l=!0)},o(i){j(o),l=!1},d(i){i&&w(t),~e&&a[e].d(i)}}}function Pe(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Hn(n,e,o){let t;Ae(n,W,C=>o(1,t=C));let l={kind:"list"};function r(){be(W,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),o(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function a(C){window.confirm("Delete this junction?")&&(t.jat.splice(C,1),W.set(t),o(0,l={kind:"list"}))}const s=C=>o(0,l={kind:"edit",idx:C,stage:"existing"}),i=()=>o(0,l={kind:"list"}),c=()=>o(0,l={kind:"edit",idx:Pe(l),stage:"existing"}),_=()=>o(0,l={kind:"edit",idx:Pe(l),stage:"proposed"}),g=()=>a(Pe(l));function u(C){n.$$.not_equal(t.jat[l.idx].name,C)&&(t.jat[l.idx].name=C,W.set(t))}return[l,t,r,a,s,i,c,_,g,u]}class uo extends Se{constructor(e){super(),ye(this,e,Hn,Gn,ve,{})}}export{uo as component};
