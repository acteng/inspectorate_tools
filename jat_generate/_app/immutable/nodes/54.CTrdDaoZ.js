import{s as je,y as re,z as se,l as _t,u as gt,r as dt,v as pt,E as be,k as Te,S as yt,x as we,a as B,g as z,i as k,f as p,H as ye,Y as Mt,e as R,c as W,b as Y,p as le,h as U,G as ie,o as $t,q as X,L as Ne,t as G,M as Ae,d as H,n as Le,m as Me,j as ue,w as Lt,V as Je}from"../chunks/scheduler.NGc5rx4B.js";import{S as Se,i as Ee,e as fe,c as A,a as P,m as D,t as v,b as j,d as F,g as me,f as ce}from"../chunks/index.CXr-pTxM.js";import{e as ge}from"../chunks/each.C0Oa3ZQW.js";import{C as ze,B as St}from"../chunks/ClickableCard.Dy0Gc3SI.js";import{D as qe}from"../chunks/DefaultButton.HZ4Q0i-3.js";import{S as ve}from"../chunks/SecondaryButton.DY728Lpc.js";/* empty css                                                    */import{T as Oe}from"../chunks/TextInput.B2MdnKN0.js";import{W as Ge}from"../chunks/WarningButton.B2__z57s.js";import{s as te}from"../chunks/data.DOkSBWF3.js";import{g as Et}from"../chunks/globals.D0QH3NT1.js";import{c as Ve}from"../chunks/index.B1bu1eHp.js";import{L as It,h as Tt,d as he,q as Nt,t as ht,v as Fe,M as At,b as Pt,C as Dt,G as Xe,w as Ue,x as Re,f as Ft,P as vt,y as Ut}from"../chunks/index.BUxFzbL5.js";import{g as Be,t as Bt}from"../chunks/index.B66i3JRM.js";import{c as pe}from"../chunks/colors.DaC397qr.js";import{G as zt,I as Pe,p as qt}from"../chunks/pan.ClQ5rXEe.js";import{M as Ot,a as Ie,B as Gt,G as Ht,S as Jt,C as Vt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.8oRlRSIL.js";import"../chunks/paths.DzsZoGuW.js";import{C as Xt}from"../chunks/CollapsibleCard.CecXaQdy.js";import{T as bt}from"../chunks/TextArea.T6odI4uv.js";import{R as We}from"../chunks/Radio.lfhmTBy6.js";function Rt(n){let e;const l=n[16].default,t=_t(l,n,n[24],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,a){t&&t.m(o,a),e=!0},p(o,a){t&&t.p&&(!e||a&16777216)&&gt(t,l,o,o[24],e?pt(l,o[24],a,null):dt(o[24]),null)},i(o){e||(v(t,o),e=!0)},o(o){j(t,o),e=!1},d(o){t&&t.d(o)}}}function Wt(n){let e,l,t;function o(r){n[17](r)}let a={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Rt]},$$scope:{ctx:n}};return n[0]!==void 0&&(a.hovered=n[0]),e=new It({props:a}),re.push(()=>fe(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),t=!0},p(r,[i]){const s={};i&2&&(s.id=r[1]),i&4&&(s.source=r[2]),i&8&&(s.sourceLayer=r[3]),i&16&&(s.beforeId=r[4]),i&32&&(s.beforeLayerType=r[5]),i&64&&(s.paint=r[6]),i&128&&(s.layout=r[7]),i&256&&(s.filter=r[8]),i&512&&(s.applyToClusters=r[9]),i&1024&&(s.minzoom=r[10]),i&2048&&(s.maxzoom=r[11]),i&4096&&(s.hoverCursor=r[12]),i&8192&&(s.manageHoverState=r[13]),i&16384&&(s.eventsIfTopMost=r[14]),i&32768&&(s.interactive=r[15]),i&16777216&&(s.$$scope={dirty:i,ctx:r}),!l&&i&1&&(l=!0,s.hovered=r[0],se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Zt(n,e,l){let{$$slots:t={},$$scope:o}=e,{id:a=Tt("symbol")}=e,{source:r=void 0}=e,{sourceLayer:i=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:c=void 0}=e,{layout:d=void 0}=e,{filter:_=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:E=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:N=!0}=e;function f(C){$=C,l(0,$)}function g(C){be.call(this,n,C)}function T(C){be.call(this,n,C)}function Q(C){be.call(this,n,C)}function ee(C){be.call(this,n,C)}function x(C){be.call(this,n,C)}function J(C){be.call(this,n,C)}return n.$$set=C=>{"id"in C&&l(1,a=C.id),"source"in C&&l(2,r=C.source),"sourceLayer"in C&&l(3,i=C.sourceLayer),"beforeId"in C&&l(4,s=C.beforeId),"beforeLayerType"in C&&l(5,m=C.beforeLayerType),"paint"in C&&l(6,c=C.paint),"layout"in C&&l(7,d=C.layout),"filter"in C&&l(8,_=C.filter),"applyToClusters"in C&&l(9,w=C.applyToClusters),"minzoom"in C&&l(10,L=C.minzoom),"maxzoom"in C&&l(11,I=C.maxzoom),"hoverCursor"in C&&l(12,y=C.hoverCursor),"manageHoverState"in C&&l(13,E=C.manageHoverState),"hovered"in C&&l(0,$=C.hovered),"eventsIfTopMost"in C&&l(14,b=C.eventsIfTopMost),"interactive"in C&&l(15,N=C.interactive),"$$scope"in C&&l(24,o=C.$$scope)},[$,a,r,i,s,m,c,d,_,w,L,I,y,E,b,N,t,f,g,T,Q,ee,x,J,o]}class Kt extends Se{constructor(e){super(),Ee(this,e,Zt,Wt,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Yt=Object.defineProperty,Qt=(n,e)=>Yt(n,"name",{value:e,configurable:!0});function kt(n,e,l,t={}){const o=Be(n),a=he(o[0]),r=he(o[1]),i=he(l),s=Nt(e,t.units),m=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),c=a+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(m)),d=Fe(c),_=Fe(m);return ht([d,_],t.properties)}Qt(kt,"destination");var Ce=kt,xt=Object.defineProperty,wt=(n,e)=>xt(n,"name",{value:e,configurable:!0});function He(n,e,l={}){if(l.final===!0)return jt(n,e);const t=Be(n),o=Be(e),a=he(t[0]),r=he(o[0]),i=he(t[1]),s=he(o[1]),m=Math.sin(r-a)*Math.cos(s),c=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(r-a);return Fe(Math.atan2(m,c))}wt(He,"bearing");function jt(n,e){let l=He(e,n);return l=(l+180)%360,l}wt(jt,"calculateFinalBearing");var ke=He;const en="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ze(n,e,l){const t=n.slice();return t[36]=e[l],t[37]=e,t[38]=l,t}function Ke(n,e,l){const t=n.slice();return t[39]=e[l],t[40]=e,t[38]=l,t}function Ye(n){let e,l,t,o,a,r,i;return l=new Pe({props:{$$slots:{default:[ln]},$$scope:{ctx:n}}}),l.$on("click",function(){Mt(n[5])&&n[5].apply(this,arguments)}),o=new Pe({props:{$$slots:{default:[an]},$$scope:{ctx:n}}}),o.$on("click",n[17]),r=new Pe({props:{$$slots:{default:[un]},$$scope:{ctx:n}}}),r.$on("click",n[18]),{c(){e=R("div"),A(l.$$.fragment),t=B(),A(o.$$.fragment),a=B(),A(r.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Y(e);P(l.$$.fragment,m),t=z(m),P(o.$$.fragment,m),a=z(m),P(r.$$.fragment,m),m.forEach(p),this.h()},h(){le(e,"class","control-panel svelte-1w3m76d")},m(s,m){k(s,e,m),D(l,e,null),U(e,t),D(o,e,null),U(e,a),D(r,e,null),i=!0},p(s,m){n=s;const c={};m[0]&1|m[1]&1024&&(c.$$scope={dirty:m,ctx:n}),l.$set(c);const d={};m[0]&1|m[1]&1024&&(d.$$scope={dirty:m,ctx:n}),o.$set(d);const _={};m[0]&1|m[1]&1024&&(_.$$scope={dirty:m,ctx:n}),r.$set(_)},i(s){i||(v(l.$$.fragment,s),v(o.$$.fragment,s),v(r.$$.fragment,s),i=!0)},o(s){j(l.$$.fragment,s),j(o.$$.fragment,s),j(r.$$.fragment,s),i=!1},d(s){s&&p(e),F(l),F(o),F(r)}}}function tn(n){let e;return{c(){e=G("Move map")},l(l){e=H(l,"Move map")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function nn(n){let e,l="Move map";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-1719ytd"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function ln(n){let e,l,t,o;function a(s,m){return s[0].mode=="select"?nn:tn}let r=a(n),i=r(n);return{c(){e=R("img"),t=B(),i.c(),o=ie(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),t=z(s),i.l(s),o=ie(),this.h()},h(){$t(e.src,l=qt)||le(e,"src",l),le(e,"alt","Move map"),X(e,"vertical-align","middle")},m(s,m){k(s,e,m),k(s,t,m),i.m(s,m),k(s,o,m)},p(s,m){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(t),p(o)),i.d(s)}}}function on(n){let e;return{c(){e=G("New arm")},l(l){e=H(l,"New arm")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function rn(n){let e,l="New arm";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-1typ7gq"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function an(n){let e,l,t,o,a,r;function i(c,d){return c[0].mode=="new-arm"?rn:on}let s=i(n),m=s(n);return{c(){e=Ne("svg"),l=Ne("circle"),t=Ne("text"),o=G("A"),a=B(),m.c(),r=ie(),this.h()},l(c){e=Ae(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var d=Y(e);l=Ae(d,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(l).forEach(p),t=Ae(d,"text",{x:!0,y:!0,fill:!0});var _=Y(t);o=H(_,"A"),_.forEach(p),d.forEach(p),a=z(c),m.l(c),r=ie(),this.h()},h(){le(l,"cx","12"),le(l,"cy","12"),le(l,"r","12"),le(l,"fill","white"),le(t,"x","6"),le(t,"y","16"),le(t,"fill","#4472c4"),le(e,"width","24"),le(e,"height","24"),le(e,"xmlns","http://www.w3.org/2000/svg"),X(e,"vertical-align","middle")},m(c,d){k(c,e,d),U(e,l),U(e,t),U(t,o),k(c,a,d),m.m(c,d),k(c,r,d)},p(c,d){s!==(s=i(c))&&(m.d(1),m=s(c),m&&(m.c(),m.m(r.parentNode,r)))},d(c){c&&(p(e),p(a),p(r)),m.d(c)}}}function sn(n){let e;return{c(){e=G("New movement")},l(l){e=H(l,"New movement")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function fn(n){let e,l="New movement";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-o92ucp"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function un(n){let e,l,t,o;function a(s,m){return s[0].mode=="new-movement"?fn:sn}let r=a(n),i=r(n);return{c(){e=R("img"),t=B(),i.c(),o=ie(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),t=z(s),i.l(s),o=ie(),this.h()},h(){$t(e.src,l=en)||le(e,"src",l),le(e,"alt","New movement"),X(e,"vertical-align","middle")},m(s,m){k(s,e,m),k(s,t,m),i.m(s,m),k(s,o,m)},p(s,m){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(t),p(o)),i.d(s)}}}function mn(n){let e,l=jn(n[38])+"",t;return{c(){e=R("span"),t=G(l),this.h()},l(o){e=W(o,"SPAN",{class:!0});var a=Y(e);t=H(a,l),a.forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(o,a){k(o,e,a),U(e,t)},p:Le,d(o){o&&p(e)}}}function Qe(n){let e,l,t;function o(s){n[19](s,n[39])}function a(){return n[20](n[38])}function r(){return n[21](n[38])}let i={draggable:!0,$$slots:{default:[mn]},$$scope:{ctx:n}};return n[39].point!==void 0&&(i.lngLat=n[39].point),e=new Ie({props:i}),re.push(()=>fe(e,"lngLat",o)),e.$on("dragend",a),e.$on("click",r),{c(){A(e.$$.fragment)},l(s){P(e.$$.fragment,s)},m(s,m){D(e,s,m),t=!0},p(s,m){n=s;const c={};m[1]&1024&&(c.$$scope={dirty:m,ctx:n}),!l&&m[0]&70&&(l=!0,c.lngLat=n[39].point,se(()=>l=!1)),e.$set(c)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function cn(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score]),X(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score]),t[0]&70&&X(e,"opacity",l[36].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&p(e)}}}function _n(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score])},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function gn(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score]),X(e,"opacity","0%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function xe(n){let e,l,t,o,a,r,i,s,m;function c(g){n[22](g,n[36])}function d(){return n[23](n[38])}function _(){return n[24](n[38])}let w={draggable:!0,$$slots:{default:[cn]},$$scope:{ctx:n}};n[36].point1!==void 0&&(w.lngLat=n[36].point1),e=new Ie({props:w}),re.push(()=>fe(e,"lngLat",c)),e.$on("dragend",d),e.$on("click",_);function L(g){n[25](g,n[36])}function I(){return n[26](n[38])}function y(){return n[27](n[38])}let E={draggable:!0,$$slots:{default:[_n]},$$scope:{ctx:n}};n[36].point2!==void 0&&(E.lngLat=n[36].point2),o=new Ie({props:E}),re.push(()=>fe(o,"lngLat",L)),o.$on("dragend",I),o.$on("click",y);function $(g){n[28](g,n[36])}function b(){return n[29](n[38])}function N(){return n[30](n[38])}let f={draggable:!0,$$slots:{default:[gn]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(f.lngLat=n[36].point3),i=new Ie({props:f}),re.push(()=>fe(i,"lngLat",$)),i.$on("dragend",b),i.$on("click",N),{c(){A(e.$$.fragment),t=B(),A(o.$$.fragment),r=B(),A(i.$$.fragment)},l(g){P(e.$$.fragment,g),t=z(g),P(o.$$.fragment,g),r=z(g),P(i.$$.fragment,g)},m(g,T){D(e,g,T),k(g,t,T),D(o,g,T),k(g,r,T),D(i,g,T),m=!0},p(g,T){n=g;const Q={};T[0]&70|T[1]&1024&&(Q.$$scope={dirty:T,ctx:n}),!l&&T[0]&70&&(l=!0,Q.lngLat=n[36].point1,se(()=>l=!1)),e.$set(Q);const ee={};T[0]&70|T[1]&1024&&(ee.$$scope={dirty:T,ctx:n}),!a&&T[0]&70&&(a=!0,ee.lngLat=n[36].point2,se(()=>a=!1)),o.$set(ee);const x={};T[0]&70|T[1]&1024&&(x.$$scope={dirty:T,ctx:n}),!s&&T[0]&70&&(s=!0,x.lngLat=n[36].point3,se(()=>s=!1)),i.$set(x)},i(g){m||(v(e.$$.fragment,g),v(o.$$.fragment,g),v(i.$$.fragment,g),m=!0)},o(g){j(e.$$.fragment,g),j(o.$$.fragment,g),j(i.$$.fragment,g),m=!1},d(g){g&&(p(t),p(r)),F(e,g),F(o,g),F(i,g)}}}function dn(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ue(l,e)},d(t){t&&p(l)}}}function pn(n){let e,l;return e=new vt({props:{$$slots:{default:[dn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function $n(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ue(l,e)},d(t){t&&p(l)}}}function hn(n){let e,l;return e=new vt({props:{$$slots:{default:[$n,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function vn(n){let e,l,t,o,a,r;return e=new Ue({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Re(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[pn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Ue({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Re(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[hn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),a=new Kt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){A(e.$$.fragment),l=B(),A(t.$$.fragment),o=B(),A(a.$$.fragment)},l(i){P(e.$$.fragment,i),l=z(i),P(t.$$.fragment,i),o=z(i),P(a.$$.fragment,i)},m(i,s){D(e,i,s),k(i,l,s),D(t,i,s),k(i,o,s),D(a,i,s),r=!0},p(i,s){const m={};s[1]&1024&&(m.$$scope={dirty:s,ctx:i}),e.$set(m);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:i}),t.$set(c)},i(i){r||(v(e.$$.fragment,i),v(t.$$.fragment,i),v(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(t.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),F(e,i),F(t,i),F(a,i)}}}function bn(n){let e,l,t,o;return e=new Ue({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Ft({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){A(e.$$.fragment),l=B(),A(t.$$.fragment)},l(a){P(e.$$.fragment,a),l=z(a),P(t.$$.fragment,a)},m(a,r){D(e,a,r),k(a,l,r),D(t,a,r),o=!0},p:Le,i(a){o||(v(e.$$.fragment,a),v(t.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(t.$$.fragment,a),o=!1},d(a){a&&p(l),F(e,a),F(t,a)}}}function kn(n){let e,l,t,o,a,r,i,s,m,c,d,_,w;e=new Ot({}),e.$on("click",n[10]);let L=n[0].mode!="editing"&&Ye(n);o=new Dt({props:{gj:n[6].summary.networkMap,show:n[3]}});let I=ge(n[6].jat[n[1]][n[2]].arms),y=[];for(let f=0;f<I.length;f+=1)y[f]=Qe(Ke(n,I,f));const E=f=>j(y[f],1,1,()=>{y[f]=null});let $=ge(n[6].jat[n[1]][n[2]].movements),b=[];for(let f=0;f<$.length;f+=1)b[f]=xe(Ze(n,$,f));const N=f=>j(b[f],1,1,()=>{b[f]=null});return s=new Xe({props:{data:n[12](n[6]),$$slots:{default:[vn]},$$scope:{ctx:n}}}),c=new Xe({props:{data:n[8],$$slots:{default:[bn]},$$scope:{ctx:n}}}),_=new zt({props:{map:n[7]}}),{c(){A(e.$$.fragment),l=B(),L&&L.c(),t=B(),A(o.$$.fragment),a=B();for(let f=0;f<y.length;f+=1)y[f].c();r=B();for(let f=0;f<b.length;f+=1)b[f].c();i=B(),A(s.$$.fragment),m=B(),A(c.$$.fragment),d=B(),A(_.$$.fragment)},l(f){P(e.$$.fragment,f),l=z(f),L&&L.l(f),t=z(f),P(o.$$.fragment,f),a=z(f);for(let g=0;g<y.length;g+=1)y[g].l(f);r=z(f);for(let g=0;g<b.length;g+=1)b[g].l(f);i=z(f),P(s.$$.fragment,f),m=z(f),P(c.$$.fragment,f),d=z(f),P(_.$$.fragment,f)},m(f,g){D(e,f,g),k(f,l,g),L&&L.m(f,g),k(f,t,g),D(o,f,g),k(f,a,g);for(let T=0;T<y.length;T+=1)y[T]&&y[T].m(f,g);k(f,r,g);for(let T=0;T<b.length;T+=1)b[T]&&b[T].m(f,g);k(f,i,g),D(s,f,g),k(f,m,g),D(c,f,g),k(f,d,g),D(_,f,g),w=!0},p(f,g){f[0].mode!="editing"?L?(L.p(f,g),g[0]&1&&v(L,1)):(L=Ye(f),L.c(),v(L,1),L.m(t.parentNode,t)):L&&(me(),j(L,1,1,()=>{L=null}),ce());const T={};if(g[0]&64&&(T.gj=f[6].summary.networkMap),g[0]&8&&(T.show=f[3]),o.$set(T),g[0]&86){I=ge(f[6].jat[f[1]][f[2]].arms);let J;for(J=0;J<I.length;J+=1){const C=Ke(f,I,J);y[J]?(y[J].p(C,g),v(y[J],1)):(y[J]=Qe(C),y[J].c(),v(y[J],1),y[J].m(r.parentNode,r))}for(me(),J=I.length;J<y.length;J+=1)E(J);ce()}if(g[0]&598){$=ge(f[6].jat[f[1]][f[2]].movements);let J;for(J=0;J<$.length;J+=1){const C=Ze(f,$,J);b[J]?(b[J].p(C,g),v(b[J],1)):(b[J]=xe(C),b[J].c(),v(b[J],1),b[J].m(i.parentNode,i))}for(me(),J=$.length;J<b.length;J+=1)N(J);ce()}const Q={};g[0]&64&&(Q.data=f[12](f[6])),g[1]&1024&&(Q.$$scope={dirty:g,ctx:f}),s.$set(Q);const ee={};g[0]&256&&(ee.data=f[8]),g[1]&1024&&(ee.$$scope={dirty:g,ctx:f}),c.$set(ee);const x={};g[0]&128&&(x.map=f[7]),_.$set(x)},i(f){if(!w){v(e.$$.fragment,f),v(L),v(o.$$.fragment,f);for(let g=0;g<I.length;g+=1)v(y[g]);for(let g=0;g<$.length;g+=1)v(b[g]);v(s.$$.fragment,f),v(c.$$.fragment,f),v(_.$$.fragment,f),w=!0}},o(f){j(e.$$.fragment,f),j(L),j(o.$$.fragment,f),y=y.filter(Boolean);for(let g=0;g<y.length;g+=1)j(y[g]);b=b.filter(Boolean);for(let g=0;g<b.length;g+=1)j(b[g]);j(s.$$.fragment,f),j(c.$$.fragment,f),j(_.$$.fragment,f),w=!1},d(f){f&&(p(l),p(t),p(a),p(r),p(i),p(m),p(d)),F(e,f),L&&L.d(f),F(o,f),ye(y,f),ye(b,f),F(s,f),F(c,f),F(_,f)}}}function wn(n){let e,l,t;function o(r){n[31](r)}let a={$$slots:{default:[kn]},$$scope:{ctx:n}};return n[7]!==void 0&&(a.map=n[7]),e=new At({props:a}),re.push(()=>fe(e,"map",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),t=!0},p(r,i){const s={};i[0]&511|i[1]&1024&&(s.$$scope={dirty:i,ctx:r}),!l&&i[0]&128&&(l=!0,s.map=r[7],se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function et(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function jn(n){return String.fromCharCode(n+65)}function Cn(n,e,l){let t,o;Te(n,te,u=>l(6,o=u));let{junctionIdx:a}=e,{stage:r}=e,{mode:i}=e,{hoveringSidebar:s}=e,{streetviewOn:m}=e,{showContext:c}=e,{select:d}=e,{stopEditing:_}=e,w,L={0:pe.red.background,1:pe.amber.background,2:pe.green.background,X:pe.critical.background};function I(u,h,K){let O={type:"FeatureCollection",features:[]},_e=h.mode=="editing"?h.id:K;return _e!=null&&(_e.kind=="arm"?O.features.push(et(u.jat[a][r].arms[_e.idx],_e.idx)):O.features.push(b(u.jat[a][r].movements[_e.idx],_e.idx))),O}async function y(u){if(!m){for(let h of w.queryRenderedFeatures(u.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i.mode!="select"){if(i.mode=="editing"){await _();return}i.mode=="new-arm"?(we(te,o.jat[a][r].arms=[...o.jat[a][r].arms,{point:u.detail.lngLat.toArray(),name:""}],o),await d({kind:"arm",idx:o.jat[a][r].arms.length-1})):(we(te,o.jat[a][r].movements=[...o.jat[a][r].movements,{point1:u.detail.lngLat.toArray(),point2:Ce(u.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Ce(u.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await d({kind:"movement",idx:o.jat[a][r].movements.length-1}))}}}async function E(u){await d({kind:"movement",idx:u.detail.features[0].id})}yt(()=>{f(!1)});function $(u){let h={type:"FeatureCollection",features:u.jat[a][r].movements.map((K,O)=>b(K,O))};for(let K of u.jat[a][r].movements)if(h.features.push(N(K,h.features.length)),K.kind=="walking & wheeling"){let O={...K,point1:K.point3,point3:K.point1};h.features.push(N(O,h.features.length))}return h}function b(u,h){return{type:"Feature",id:h,properties:{name:u.name,kind:u.kind,color:L[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2,u.point3]}}}function N(u,h){return{type:"Feature",id:h,properties:{kind:u.kind,color:L[u.score],angle:ke(u.point2,u.point3)},geometry:{type:"Point",coordinates:u.point3}}}function f(u){let h=$(o);for(let K of o.jat[a][r].arms)h.features.push(et(K,h.features.length));for(let K of o.summary.networkMap.features)h.features.push(K);h.features.length>0&&w.fitBounds(Pt(h),{padding:20,animate:u})}function g(){return w}const T=()=>l(0,i={mode:"new-arm"}),Q=()=>l(0,i={mode:"new-movement"});function ee(u,h){n.$$.not_equal(h.point,u)&&(h.point=u,te.set(o))}const x=u=>d({kind:"arm",idx:u}),J=u=>d({kind:"arm",idx:u});function C(u,h){n.$$.not_equal(h.point1,u)&&(h.point1=u,te.set(o))}const oe=u=>d({kind:"movement",idx:u}),Z=u=>d({kind:"movement",idx:u});function $e(u,h){n.$$.not_equal(h.point2,u)&&(h.point2=u,te.set(o))}const S=u=>d({kind:"movement",idx:u}),q=u=>d({kind:"movement",idx:u});function ne(u,h){n.$$.not_equal(h.point3,u)&&(h.point3=u,te.set(o))}const V=u=>d({kind:"movement",idx:u}),ae=u=>d({kind:"movement",idx:u});function M(u){w=u,l(7,w)}return n.$$set=u=>{"junctionIdx"in u&&l(1,a=u.junctionIdx),"stage"in u&&l(2,r=u.stage),"mode"in u&&l(0,i=u.mode),"hoveringSidebar"in u&&l(13,s=u.hoveringSidebar),"streetviewOn"in u&&l(14,m=u.streetviewOn),"showContext"in u&&l(3,c=u.showContext),"select"in u&&l(4,d=u.select),"stopEditing"in u&&l(5,_=u.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&8257&&l(8,t=I(o,i,s))},[i,a,r,c,d,_,o,w,t,L,y,E,$,s,m,f,g,T,Q,ee,x,J,C,oe,Z,$e,S,q,ne,V,ae,M]}class yn extends Se{constructor(e){super(),Ee(this,e,Cn,wn,je,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showContext:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Mn(n){let e,l,t,o,a,r,i,s,m,c,d,_;function w(f){n[5](f)}let L={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(L.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Oe({props:L}),re.push(()=>fe(e,"value",w));function I(f){n[6](f)}let y={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(y.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),o=new We({props:y}),re.push(()=>fe(o,"value",I));function E(f){n[7](f)}let $={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),i=new We({props:$}),re.push(()=>fe(i,"value",E));function b(f){n[8](f)}let N={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(N.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),c=new bt({props:N}),re.push(()=>fe(c,"value",b)),{c(){A(e.$$.fragment),t=B(),A(o.$$.fragment),r=B(),A(i.$$.fragment),m=B(),A(c.$$.fragment)},l(f){P(e.$$.fragment,f),t=z(f),P(o.$$.fragment,f),r=z(f),P(i.$$.fragment,f),m=z(f),P(c.$$.fragment,f)},m(f,g){D(e,f,g),k(f,t,g),D(o,f,g),k(f,r,g),D(i,f,g),k(f,m,g),D(c,f,g),_=!0},p(f,[g]){const T={};!l&&g&15&&(l=!0,T.value=f[3].jat[f[0]][f[1]].movements[f[2]].name,se(()=>l=!1)),e.$set(T);const Q={};!a&&g&15&&(a=!0,Q.value=f[3].jat[f[0]][f[1]].movements[f[2]].kind,se(()=>a=!1)),o.$set(Q);const ee={};!s&&g&15&&(s=!0,ee.value=f[3].jat[f[0]][f[1]].movements[f[2]].score,se(()=>s=!1)),i.$set(ee);const x={};!d&&g&15&&(d=!0,x.value=f[3].jat[f[0]][f[1]].movements[f[2]].notes,se(()=>d=!1)),c.$set(x)},i(f){_||(v(e.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),v(c.$$.fragment,f),_=!0)},o(f){j(e.$$.fragment,f),j(o.$$.fragment,f),j(i.$$.fragment,f),j(c.$$.fragment,f),_=!1},d(f){f&&(p(t),p(r),p(m)),F(e,f),F(o,f),F(i,f),F(c,f)}}}function Ln(n,e,l){let t;Te(n,te,_=>l(3,t=_));let{junctionIdx:o}=e,{stage:a}=e,{idx:r}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){n.$$.not_equal(t.jat[o][a].movements[r].name,_)&&(t.jat[o][a].movements[r].name=_,te.set(t))}function m(_){n.$$.not_equal(t.jat[o][a].movements[r].kind,_)&&(t.jat[o][a].movements[r].kind=_,te.set(t))}function c(_){n.$$.not_equal(t.jat[o][a].movements[r].score,_)&&(t.jat[o][a].movements[r].score=_,te.set(t))}function d(_){n.$$.not_equal(t.jat[o][a].movements[r].notes,_)&&(t.jat[o][a].movements[r].notes=_,te.set(t))}return n.$$set=_=>{"junctionIdx"in _&&l(0,o=_.junctionIdx),"stage"in _&&l(1,a=_.stage),"idx"in _&&l(2,r=_.idx)},[o,a,r,t,i,s,m,c,d]}class Sn extends Se{constructor(e){super(),Ee(this,e,Ln,Mn,je,{junctionIdx:0,stage:1,idx:2})}}function de(n){if(n.movements.length==0)return"No movements added";let e=0,l=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],l+=2;let t=e/l*100;return`${Math.round(t)}%`}var En=Object.defineProperty,In=(n,e)=>En(n,"name",{value:e,configurable:!0});function Ct(n,e={}){const l=Ut(n),t=(l[0]+l[2])/2,o=(l[1]+l[3])/2;return ht([t,o],e.properties,e)}In(Ct,"center");var Tn=Ct;function Nn(n){let e=.003,l=(a,r)=>{let i=n[a].point,m=ke(i,t)-90,c=e*r;return Ce(i,c,m).geometry.coordinates},t=Tn({type:"FeatureCollection",features:n.map(a=>({type:"Feature",geometry:{type:"Point",coordinates:a.point}}))}).geometry.coordinates;n.sort((a,r)=>tt(ke(t,r.point))-tt(ke(t,a.point)));let o=[];for(let a=0;a<n.length;a++){let r=n[a],i=ke(r.point,t),s=1;for(let m of An(a,n.length)){let c=n[m],d=ke(t,c.point),_=l(a,s++),w=Bt(r.point,t),L=Ce(_,.5*w,i).geometry.coordinates,I=Ce(L,.2*w,d).geometry.coordinates;o.push({point1:_,point2:L,point3:I,kind:"cycling",score:"X",name:`${r.name} to ${c.name}`,notes:""})}}return o}function tt(n){return(n+360)%360}function An(n,e){let l=[];for(let t=n+1;t<e;t++)l.push(t);for(let t=0;t<n;t++)l.push(t);return l}const{window:Pn}=Et;function nt(n,e,l){const t=n.slice();t[34]=e[l],t[37]=l;const o=t[16][t[34].score];return t[35]=o,t}function lt(n,e,l){const t=n.slice();return t[38]=e[l],t[37]=l,t}function Dn(n){let e,l,t,o,a,r,i,s;e=new qe({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Ge({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),t.$on("click",n[12]);const m=[qn,zn],c=[];function d(_,w){return _[2].id.kind=="movement"?0:1}return a=d(n),r=c[a]=m[a](n),{c(){A(e.$$.fragment),l=B(),A(t.$$.fragment),o=B(),r.c(),i=ie()},l(_){P(e.$$.fragment,_),l=z(_),P(t.$$.fragment,_),o=z(_),r.l(_),i=ie()},m(_,w){D(e,_,w),k(_,l,w),D(t,_,w),k(_,o,w),c[a].m(_,w),k(_,i,w),s=!0},p(_,w){const L={};w[1]&2&&(L.$$scope={dirty:w,ctx:_}),e.$set(L);const I={};w[1]&2&&(I.$$scope={dirty:w,ctx:_}),t.$set(I);let y=a;a=d(_),a===y?c[a].p(_,w):(me(),j(c[y],1,1,()=>{c[y]=null}),ce(),r=c[a],r?r.p(_,w):(r=c[a]=m[a](_),r.c()),v(r,1),r.m(i.parentNode,i))},i(_){s||(v(e.$$.fragment,_),v(t.$$.fragment,_),v(r),s=!0)},o(_){j(e.$$.fragment,_),j(t.$$.fragment,_),j(r),s=!1},d(_){_&&(p(l),p(o),p(i)),F(e,_),F(t,_),c[a].d(_)}}}function Fn(n){let e,l,t,o,a="Arms",r,i,s,m,c="Movements",d,_,w,L,I,y,E=(n[8].jat[n[0]].name||"Untitled junction")+"",$,b,N=de(n[8].jat[n[0]][n[1]])+"",f,g,T,Q,ee,x;const J=n[18].default,C=_t(J,n,n[32],null);l=new Xt({props:{label:"Tools",$$slots:{default:[Vn]},$$scope:{ctx:n}}});let oe=ge(n[8].jat[n[0]][n[1]].arms),Z=[];for(let u=0;u<oe.length;u+=1)Z[u]=ot(lt(n,oe,u));const $e=u=>j(Z[u],1,1,()=>{Z[u]=null});let S=n[8].jat[n[0]][n[9]].arms.length>0&&rt(n),q=n[8].jat[n[0]][n[1]].arms.length>0&&at(n),ne=ge(n[8].jat[n[0]][n[1]].movements),V=[];for(let u=0;u<ne.length;u+=1)V[u]=it(nt(n,ne,u));const ae=u=>j(V[u],1,1,()=>{V[u]=null});let M=n[8].jat[n[0]][n[9]].movements.length>0&&st(n);return{c(){C&&C.c(),e=B(),A(l.$$.fragment),t=B(),o=R("h3"),o.textContent=a,r=B();for(let u=0;u<Z.length;u+=1)Z[u].c();i=B(),S&&S.c(),s=B(),m=R("h3"),m.textContent=c,d=B(),_=R("p"),w=G("Total JAT score for "),L=G(n[1]),I=B(),y=R("u"),$=G(E),b=G(`
        : `),f=G(N),g=B(),q&&q.c(),T=B();for(let u=0;u<V.length;u+=1)V[u].c();Q=B(),M&&M.c(),ee=ie()},l(u){C&&C.l(u),e=z(u),P(l.$$.fragment,u),t=z(u),o=W(u,"H3",{"data-svelte-h":!0}),Me(o)!=="svelte-ld74qb"&&(o.textContent=a),r=z(u);for(let O=0;O<Z.length;O+=1)Z[O].l(u);i=z(u),S&&S.l(u),s=z(u),m=W(u,"H3",{"data-svelte-h":!0}),Me(m)!=="svelte-1dc52s8"&&(m.textContent=c),d=z(u),_=W(u,"P",{});var h=Y(_);w=H(h,"Total JAT score for "),L=H(h,n[1]),I=z(h),y=W(h,"U",{});var K=Y(y);$=H(K,E),K.forEach(p),b=H(h,`
        : `),f=H(h,N),h.forEach(p),g=z(u),q&&q.l(u),T=z(u);for(let O=0;O<V.length;O+=1)V[O].l(u);Q=z(u),M&&M.l(u),ee=ie()},m(u,h){C&&C.m(u,h),k(u,e,h),D(l,u,h),k(u,t,h),k(u,o,h),k(u,r,h);for(let K=0;K<Z.length;K+=1)Z[K]&&Z[K].m(u,h);k(u,i,h),S&&S.m(u,h),k(u,s,h),k(u,m,h),k(u,d,h),k(u,_,h),U(_,w),U(_,L),U(_,I),U(_,y),U(y,$),U(_,b),U(_,f),k(u,g,h),q&&q.m(u,h),k(u,T,h);for(let K=0;K<V.length;K+=1)V[K]&&V[K].m(u,h);k(u,Q,h),M&&M.m(u,h),k(u,ee,h),x=!0},p(u,h){C&&C.p&&(!x||h[1]&2)&&gt(C,J,u,u[32],x?pt(J,u[32],h,null):dt(u[32]),null);const K={};if(h[0]&112|h[1]&2&&(K.$$scope={dirty:h,ctx:u}),l.$set(K),h[0]&1291){oe=ge(u[8].jat[u[0]][u[1]].arms);let O;for(O=0;O<oe.length;O+=1){const _e=lt(u,oe,O);Z[O]?(Z[O].p(_e,h),v(Z[O],1)):(Z[O]=ot(_e),Z[O].c(),v(Z[O],1),Z[O].m(i.parentNode,i))}for(me(),O=oe.length;O<Z.length;O+=1)$e(O);ce()}if(u[8].jat[u[0]][u[9]].arms.length>0?S?(S.p(u,h),h[0]&257&&v(S,1)):(S=rt(u),S.c(),v(S,1),S.m(s.parentNode,s)):S&&(me(),j(S,1,1,()=>{S=null}),ce()),(!x||h[0]&2)&&ue(L,u[1]),(!x||h[0]&257)&&E!==(E=(u[8].jat[u[0]].name||"Untitled junction")+"")&&ue($,E),(!x||h[0]&259)&&N!==(N=de(u[8].jat[u[0]][u[1]])+"")&&ue(f,N),u[8].jat[u[0]][u[1]].arms.length>0?q?(q.p(u,h),h[0]&259&&v(q,1)):(q=at(u),q.c(),v(q,1),q.m(T.parentNode,T)):q&&(me(),j(q,1,1,()=>{q=null}),ce()),h[0]&66827){ne=ge(u[8].jat[u[0]][u[1]].movements);let O;for(O=0;O<ne.length;O+=1){const _e=nt(u,ne,O);V[O]?(V[O].p(_e,h),v(V[O],1)):(V[O]=it(_e),V[O].c(),v(V[O],1),V[O].m(Q.parentNode,Q))}for(me(),O=ne.length;O<V.length;O+=1)ae(O);ce()}u[8].jat[u[0]][u[9]].movements.length>0?M?(M.p(u,h),h[0]&257&&v(M,1)):(M=st(u),M.c(),v(M,1),M.m(ee.parentNode,ee)):M&&(me(),j(M,1,1,()=>{M=null}),ce())},i(u){if(!x){v(C,u),v(l.$$.fragment,u);for(let h=0;h<oe.length;h+=1)v(Z[h]);v(S),v(q);for(let h=0;h<ne.length;h+=1)v(V[h]);v(M),x=!0}},o(u){j(C,u),j(l.$$.fragment,u),Z=Z.filter(Boolean);for(let h=0;h<Z.length;h+=1)j(Z[h]);j(S),j(q),V=V.filter(Boolean);for(let h=0;h<V.length;h+=1)j(V[h]);j(M),x=!1},d(u){u&&(p(e),p(t),p(o),p(r),p(i),p(s),p(m),p(d),p(_),p(g),p(T),p(Q),p(ee)),C&&C.d(u),F(l,u),ye(Z,u),S&&S.d(u),q&&q.d(u),ye(V,u),M&&M.d(u)}}}function Un(n){let e;return{c(){e=G("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Bn(n){let e;return{c(){e=G("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function zn(n){let e,l,t;function o(r){n[29](r)}let a={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(a.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new Oe({props:a}),re.push(()=>fe(e,"value",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),t=!0},p(r,i){const s={};!l&&i[0]&263&&(l=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function qn(n){let e,l,t,o,a,r;return e=new Sn({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),t=new qe({props:{$$slots:{default:[On]},$$scope:{ctx:n}}}),t.$on("click",n[11]),a=new Ge({props:{$$slots:{default:[Gn]},$$scope:{ctx:n}}}),a.$on("click",n[12]),{c(){A(e.$$.fragment),l=B(),A(t.$$.fragment),o=B(),A(a.$$.fragment)},l(i){P(e.$$.fragment,i),l=z(i),P(t.$$.fragment,i),o=z(i),P(a.$$.fragment,i)},m(i,s){D(e,i,s),k(i,l,s),D(t,i,s),k(i,o,s),D(a,i,s),r=!0},p(i,s){const m={};s[0]&1&&(m.junctionIdx=i[0]),s[0]&2&&(m.stage=i[1]),s[0]&4&&(m.idx=i[2].id.idx),e.$set(m);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:i}),t.$set(c);const d={};s[1]&2&&(d.$$scope={dirty:s,ctx:i}),a.$set(d)},i(i){r||(v(e.$$.fragment,i),v(t.$$.fragment,i),v(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(t.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),F(e,i),F(t,i),F(a,i)}}}function On(n){let e;return{c(){e=G("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Gn(n){let e;return{c(){e=G("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Hn(n){let e;return{c(){e=G("Zoom to fit")},l(l){e=H(l,"Zoom to fit")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Jn(n){let e;return{c(){e=G("Show scheme context")},l(l){e=H(l,"Show scheme context")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Vn(n){var E;let e,l,t,o,a,r,i,s,m,c,d,_;e=new ve({props:{$$slots:{default:[Hn]},$$scope:{ctx:n}}}),e.$on("click",n[20]),t=new Gt({}),a=new Ht({});function w($){n[21]($)}let L={map:(E=n[6])==null?void 0:E.getMap()};n[4]!==void 0&&(L.enabled=n[4]),i=new Jt({props:L}),re.push(()=>fe(i,"enabled",w));function I($){n[22]($)}let y={$$slots:{default:[Jn]},$$scope:{ctx:n}};return n[5]!==void 0&&(y.checked=n[5]),c=new Vt({props:y}),re.push(()=>fe(c,"checked",I)),{c(){A(e.$$.fragment),l=B(),A(t.$$.fragment),o=B(),A(a.$$.fragment),r=B(),A(i.$$.fragment),m=B(),A(c.$$.fragment)},l($){P(e.$$.fragment,$),l=z($),P(t.$$.fragment,$),o=z($),P(a.$$.fragment,$),r=z($),P(i.$$.fragment,$),m=z($),P(c.$$.fragment,$)},m($,b){D(e,$,b),k($,l,b),D(t,$,b),k($,o,b),D(a,$,b),k($,r,b),D(i,$,b),k($,m,b),D(c,$,b),_=!0},p($,b){var T;const N={};b[1]&2&&(N.$$scope={dirty:b,ctx:$}),e.$set(N);const f={};b[0]&64&&(f.map=(T=$[6])==null?void 0:T.getMap()),!s&&b[0]&16&&(s=!0,f.enabled=$[4],se(()=>s=!1)),i.$set(f);const g={};b[1]&2&&(g.$$scope={dirty:b,ctx:$}),!d&&b[0]&32&&(d=!0,g.checked=$[5],se(()=>d=!1)),c.$set(g)},i($){_||(v(e.$$.fragment,$),v(t.$$.fragment,$),v(a.$$.fragment,$),v(i.$$.fragment,$),v(c.$$.fragment,$),_=!0)},o($){j(e.$$.fragment,$),j(t.$$.fragment,$),j(a.$$.fragment,$),j(i.$$.fragment,$),j(c.$$.fragment,$),_=!1},d($){$&&(p(l),p(o),p(r),p(m)),F(e,$),F(t,$),F(a,$),F(i,$),F(c,$)}}}function ot(n){let e,l;function t(){return n[23](n[37])}function o(){return n[24](n[37])}return e=new ze({props:{name:`${ft(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[25]),{c(){A(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,r){D(e,a,r),l=!0},p(a,r){n=a;const i={};r[0]&259&&(i.name=`${ft(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(i)},i(a){l||(v(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){F(e,a)}}}function rt(n){let e,l;return e=new ve({props:{$$slots:{default:[Xn]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function Xn(n){let e,l;return{c(){e=G("Copy arms from "),l=G(n[9])},l(t){e=H(t,"Copy arms from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:Le,d(t){t&&(p(e),p(l))}}}function at(n){let e,l;return e=new ve({props:{$$slots:{default:[Rn]},$$scope:{ctx:n}}}),e.$on("click",n[17]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function Rn(n){let e;return{c(){e=G("Generate cycling movements between all arms")},l(l){e=H(l,"Generate cycling movements between all arms")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Wn(n){let e,l,t,o=n[34].score+"",a,r,i,s=Ve(n[34].kind)+"",m;return{c(){e=R("div"),l=R("span"),t=G("Score: "),a=G(o),r=B(),i=R("span"),m=G(s),this.h()},l(c){e=W(c,"DIV",{style:!0});var d=Y(e);l=W(d,"SPAN",{style:!0});var _=Y(l);t=H(_,"Score: "),a=H(_,o),_.forEach(p),r=z(d),i=W(d,"SPAN",{});var w=Y(i);m=H(w,s),w.forEach(p),d.forEach(p),this.h()},h(){X(l,"padding","4px"),X(l,"color",n[35].font),X(l,"background-color",n[35].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(c,d){k(c,e,d),U(e,l),U(l,t),U(l,a),U(e,r),U(e,i),U(i,m)},p(c,d){d[0]&259&&o!==(o=c[34].score+"")&&ue(a,o),d[0]&259&&X(l,"color",c[35].font),d[0]&259&&X(l,"background-color",c[35].background),d[0]&259&&s!==(s=Ve(c[34].kind)+"")&&ue(m,s)},d(c){c&&p(e)}}}function it(n){let e,l;function t(){return n[26](n[37])}function o(){return n[27](n[37])}return e=new ze({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[Wn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[28]),{c(){A(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,r){D(e,a,r),l=!0},p(a,r){n=a;const i={};r[0]&259&&(i.name=n[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(a){l||(v(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){F(e,a)}}}function st(n){let e,l;return e=new ve({props:{$$slots:{default:[Zn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function Zn(n){let e,l;return{c(){e=G("Copy movements from "),l=G(n[9])},l(t){e=H(t,"Copy movements from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:Le,d(t){t&&(p(e),p(l))}}}function Kn(n){let e,l,t,o,a,r,i,s=de(n[8].jat[n[0]].existing)+"",m,c,d,_=de(n[8].jat[n[0]].proposed)+"",w,L,I,y,E,$,b,N,f,g,T,Q,ee;function x(S){n[19](S)}let J={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(J.value=n[8].jat[n[0]][n[1]].notes),l=new bt({props:J}),re.push(()=>fe(l,"value",x));const C=[Fn,Dn],oe=[];function Z(S,q){return S[2].mode!="editing"?0:1}$=Z(n),b=oe[$]=C[$](n);let $e={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showContext:n[5],select:n[10],stopEditing:n[11]};return g=new yn({props:$e}),n[31](g),{c(){e=R("div"),A(l.$$.fragment),o=B(),a=R("p"),r=G("Total JAT score: "),i=R("b"),m=G(s),c=G(`
    existing,
    `),d=R("b"),w=G(_),L=G(`
    proposed`),I=B(),y=R("div"),E=R("div"),b.c(),N=B(),f=R("div"),A(g.$$.fragment),this.h()},l(S){e=W(S,"DIV",{class:!0});var q=Y(e);P(l.$$.fragment,q),o=z(q),a=W(q,"P",{});var ne=Y(a);r=H(ne,"Total JAT score: "),i=W(ne,"B",{});var V=Y(i);m=H(V,s),V.forEach(p),c=H(ne,`
    existing,
    `),d=W(ne,"B",{});var ae=Y(d);w=H(ae,_),ae.forEach(p),L=H(ne,`
    proposed`),ne.forEach(p),q.forEach(p),I=z(S),y=W(S,"DIV",{style:!0});var M=Y(y);E=W(M,"DIV",{style:!0});var u=Y(E);b.l(u),u.forEach(p),N=z(M),f=W(M,"DIV",{style:!0});var h=Y(f);P(g.$$.fragment,h),h.forEach(p),M.forEach(p),this.h()},h(){le(e,"class","govuk-width-container"),X(E,"width","30%"),X(E,"overflow-y","scroll"),X(E,"padding","10px"),X(E,"border","1px solid black"),X(f,"position","relative"),X(f,"width","100%"),X(y,"display","flex"),X(y,"height","80vh")},m(S,q){k(S,e,q),D(l,e,null),U(e,o),U(e,a),U(a,r),U(a,i),U(i,m),U(a,c),U(a,d),U(d,w),U(a,L),k(S,I,q),k(S,y,q),U(y,E),oe[$].m(E,null),n[30](E),U(y,N),U(y,f),D(g,f,null),T=!0,Q||(ee=Lt(Pn,"keydown",n[13]),Q=!0)},p(S,q){const ne={};q[0]&2&&(ne.label="Commentary / Notes about "+S[1]+" junction"),!t&&q[0]&259&&(t=!0,ne.value=S[8].jat[S[0]][S[1]].notes,se(()=>t=!1)),l.$set(ne),(!T||q[0]&257)&&s!==(s=de(S[8].jat[S[0]].existing)+"")&&ue(m,s),(!T||q[0]&257)&&_!==(_=de(S[8].jat[S[0]].proposed)+"")&&ue(w,_);let V=$;$=Z(S),$===V?oe[$].p(S,q):(me(),j(oe[V],1,1,()=>{oe[V]=null}),ce(),b=oe[$],b?b.p(S,q):(b=oe[$]=C[$](S),b.c()),v(b,1),b.m(E,null));const ae={};q[0]&1&&(ae.junctionIdx=S[0]),q[0]&2&&(ae.stage=S[1]),q[0]&4&&(ae.mode=S[2]),q[0]&8&&(ae.hoveringSidebar=S[3]),q[0]&16&&(ae.streetviewOn=S[4]),q[0]&32&&(ae.showContext=S[5]),g.$set(ae)},i(S){T||(v(l.$$.fragment,S),v(b),v(g.$$.fragment,S),T=!0)},o(S){j(l.$$.fragment,S),j(b),j(g.$$.fragment,S),T=!1},d(S){S&&(p(e),p(I),p(y)),F(l),oe[$].d(),n[30](null),n[31](null),F(g),Q=!1,ee()}}}function ft(n){return String.fromCharCode(n+65)}function Yn(n,e,l){let t;Te(n,te,M=>l(8,t=M));let{$$slots:o={},$$scope:a}=e,{junctionIdx:r}=e,{stage:i}=e,s=i=="existing"?"proposed":"existing",m={mode:"select"},c=null,d=null,_=!1,w=!0,L=null,I;async function y(M){c=I.scrollTop,l(2,m={mode:"editing",id:M}),l(3,d=null),await Je(),l(7,I.scrollTop=0,I)}async function E(){l(2,m={mode:"select"}),c!=null&&(await Je(),l(7,I.scrollTop=c,I),c=null)}function $(){m.mode=="editing"&&window.confirm(`Delete this ${m.id.kind}?`)&&(m.id.kind=="movement"?(t.jat[r][i].movements.splice(m.id.idx,1),te.set(t)):(t.jat[r][i].arms.splice(m.id.idx,1),te.set(t)),E())}function b(M){if(m.mode!="editing")return;let u=M.target.tagName,h=u=="INPUT"||u=="TEXTAREA";M.key=="Escape"||M.key=="Enter"&&!h?(M.stopPropagation(),E()):M.key=="Delete"&&!h&&(M.stopPropagation(),$())}function N(){t.jat[r][i].arms.length>0&&!window.confirm("Overwrite arms?")||(we(te,t.jat[r][i].arms=JSON.parse(JSON.stringify(t.jat[r][s].arms)),t),te.set(t))}function f(){t.jat[r][i].movements.length>0&&!window.confirm("Overwrite movements?")||(we(te,t.jat[r][i].movements=JSON.parse(JSON.stringify(t.jat[r][s].movements)),t),te.set(t))}let g={0:pe.red,1:pe.amber,2:pe.green,X:pe.critical};function T(){we(te,t.jat[r][i].movements=Nn(t.jat[r][i].arms),t)}function Q(M){n.$$.not_equal(t.jat[r][i].notes,M)&&(t.jat[r][i].notes=M,te.set(t))}const ee=()=>L==null?void 0:L.zoom(!0);function x(M){_=M,l(4,_)}function J(M){w=M,l(5,w)}const C=M=>y({kind:"arm",idx:M}),oe=M=>l(3,d={kind:"arm",idx:M}),Z=()=>l(3,d=null),$e=M=>y({kind:"movement",idx:M}),S=M=>l(3,d={kind:"movement",idx:M}),q=()=>l(3,d=null);function ne(M){n.$$.not_equal(t.jat[r][i].arms[m.id.idx].name,M)&&(t.jat[r][i].arms[m.id.idx].name=M,te.set(t))}function V(M){re[M?"unshift":"push"](()=>{I=M,l(7,I)})}function ae(M){re[M?"unshift":"push"](()=>{L=M,l(6,L)})}return n.$$set=M=>{"junctionIdx"in M&&l(0,r=M.junctionIdx),"stage"in M&&l(1,i=M.stage),"$$scope"in M&&l(32,a=M.$$scope)},[r,i,m,d,_,w,L,I,t,s,y,E,$,b,N,f,g,T,o,Q,ee,x,J,C,oe,Z,$e,S,q,ne,V,ae,a]}class Qn extends Se{constructor(e){super(),Ee(this,e,Yn,Kn,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function ut(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function xn(n){let e,l,t=(n[1].jat[n[0].idx].name||"Untitled junction")+"",o,a,r=n[0].stage+"",i,s,m,c,d,_,w,L=n[0].stage,I,y;m=new St({props:{$$slots:{default:[ll]},$$scope:{ctx:n}}});function E(N){n[7](N)}let $={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&($.value=n[1].jat[n[0].idx].name),d=new Oe({props:$}),re.push(()=>fe(d,"value",E));let b=mt(n);return{c(){e=R("div"),l=R("h2"),o=G(t),a=G(" - "),i=G(r),s=B(),A(m.$$.fragment),c=B(),A(d.$$.fragment),w=B(),b.c(),I=ie(),this.h()},l(N){e=W(N,"DIV",{class:!0});var f=Y(e);l=W(f,"H2",{});var g=Y(l);o=H(g,t),a=H(g," - "),i=H(g,r),g.forEach(p),s=z(f),P(m.$$.fragment,f),c=z(f),P(d.$$.fragment,f),f.forEach(p),w=z(N),b.l(N),I=ie(),this.h()},h(){le(e,"class","govuk-width-container")},m(N,f){k(N,e,f),U(e,l),U(l,o),U(l,a),U(l,i),U(e,s),D(m,e,null),U(e,c),D(d,e,null),k(N,w,f),b.m(N,f),k(N,I,f),y=!0},p(N,f){(!y||f&3)&&t!==(t=(N[1].jat[N[0].idx].name||"Untitled junction")+"")&&ue(o,t),(!y||f&1)&&r!==(r=N[0].stage+"")&&ue(i,r);const g={};f&8193&&(g.$$scope={dirty:f,ctx:N}),m.$set(g);const T={};!_&&f&3&&(_=!0,T.value=N[1].jat[N[0].idx].name,se(()=>_=!1)),d.$set(T),f&1&&je(L,L=N[0].stage)?(me(),j(b,1,1,Le),ce(),b=mt(N),b.c(),v(b,1),b.m(I.parentNode,I)):b.p(N,f)},i(N){y||(v(m.$$.fragment,N),v(d.$$.fragment,N),v(b),y=!0)},o(N){j(m.$$.fragment,N),j(d.$$.fragment,N),j(b),y=!1},d(N){N&&(p(e),p(w),p(I)),F(m),F(d),b.d(N)}}}function el(n){let e,l,t,o;l=new qe({props:{$$slots:{default:[fl]},$$scope:{ctx:n}}}),l.$on("click",n[2]);let a=ge(n[1].jat),r=[];for(let s=0;s<a.length;s+=1)r[s]=ct(ut(n,a,s));const i=s=>j(r[s],1,1,()=>{r[s]=null});return{c(){e=R("div"),A(l.$$.fragment),t=B();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Y(e);P(l.$$.fragment,m),t=z(m);for(let c=0;c<r.length;c+=1)r[c].l(m);m.forEach(p),this.h()},h(){le(e,"class","govuk-width-container")},m(s,m){k(s,e,m),D(l,e,null),U(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);o=!0},p(s,m){const c={};if(m&8192&&(c.$$scope={dirty:m,ctx:s}),l.$set(c),m&3){a=ge(s[1].jat);let d;for(d=0;d<a.length;d+=1){const _=ut(s,a,d);r[d]?(r[d].p(_,m),v(r[d],1)):(r[d]=ct(_),r[d].c(),v(r[d],1),r[d].m(e,null))}for(me(),d=a.length;d<r.length;d+=1)i(d);ce()}},i(s){if(!o){v(l.$$.fragment,s);for(let m=0;m<a.length;m+=1)v(r[m]);o=!0}},o(s){j(l.$$.fragment,s),r=r.filter(Boolean);for(let m=0;m<r.length;m+=1)j(r[m]);o=!1},d(s){s&&p(e),F(l),ye(r,s)}}}function tl(n){let e;return{c(){e=G("Back to all junctions")},l(l){e=H(l,"Back to all junctions")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function nl(n){let e;return{c(){e=G("Delete junction")},l(l){e=H(l,"Delete junction")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function ll(n){let e,l,t,o;return e=new ve({props:{$$slots:{default:[tl]},$$scope:{ctx:n}}}),e.$on("click",n[5]),t=new Ge({props:{$$slots:{default:[nl]},$$scope:{ctx:n}}}),t.$on("click",n[6]),{c(){A(e.$$.fragment),l=B(),A(t.$$.fragment)},l(a){P(e.$$.fragment,a),l=z(a),P(t.$$.fragment,a)},m(a,r){D(e,a,r),k(a,l,r),D(t,a,r),o=!0},p(a,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const s={};r&8192&&(s.$$scope={dirty:r,ctx:a}),t.$set(s)},i(a){o||(v(e.$$.fragment,a),v(t.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(t.$$.fragment,a),o=!1},d(a){a&&p(l),F(e,a),F(t,a)}}}function ol(n){let e,l;return e=new ve({props:{$$slots:{default:[al]},$$scope:{ctx:n}}}),e.$on("click",n[9]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function rl(n){let e,l;return e=new ve({props:{$$slots:{default:[il]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function al(n){let e;return{c(){e=G("Edit Proposed")},l(l){e=H(l,"Edit Proposed")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function il(n){let e;return{c(){e=G("Edit Existing")},l(l){e=H(l,"Edit Existing")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function sl(n){let e,l,t=n[0].stage+"",o,a,r,i=n[1].jat[n[0].idx].name+"",s,m,c,d,_,w;const L=[rl,ol],I=[];function y(E,$){return E[0].stage=="proposed"?0:1}return c=y(n),d=I[c]=L[c](n),{c(){e=R("p"),l=G("Currently editing "),o=G(t),a=G(` junction
        `),r=R("u"),s=G(i),m=B(),d.c(),_=ie()},l(E){e=W(E,"P",{});var $=Y(e);l=H($,"Currently editing "),o=H($,t),a=H($,` junction
        `),r=W($,"U",{});var b=Y(r);s=H(b,i),b.forEach(p),$.forEach(p),m=z(E),d.l(E),_=ie()},m(E,$){k(E,e,$),U(e,l),U(e,o),U(e,a),U(e,r),U(r,s),k(E,m,$),I[c].m(E,$),k(E,_,$),w=!0},p(E,$){(!w||$&1)&&t!==(t=E[0].stage+"")&&ue(o,t),(!w||$&3)&&i!==(i=E[1].jat[E[0].idx].name+"")&&ue(s,i);let b=c;c=y(E),c===b?I[c].p(E,$):(me(),j(I[b],1,1,()=>{I[b]=null}),ce(),d=I[c],d?d.p(E,$):(d=I[c]=L[c](E),d.c()),v(d,1),d.m(_.parentNode,_))},i(E){w||(v(d),w=!0)},o(E){j(d),w=!1},d(E){E&&(p(e),p(m),p(_)),I[c].d(E)}}}function mt(n){let e,l;return e=new Qn({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[sl]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o&1&&(a.junctionIdx=t[0].idx),o&1&&(a.stage=t[0].stage),o&8195&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){F(e,t)}}}function fl(n){let e;return{c(){e=G("Add new junction")},l(l){e=H(l,"Add new junction")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function ul(n){let e,l,t,o=de(n[10].existing)+"",a,r,i,s,m=de(n[10].proposed)+"",c,d;return{c(){e=R("div"),l=R("span"),t=G("Existing: "),a=G(o),r=B(),i=R("span"),s=G("Proposed: "),c=G(m),d=B(),this.h()},l(_){e=W(_,"DIV",{style:!0});var w=Y(e);l=W(w,"SPAN",{});var L=Y(l);t=H(L,"Existing: "),a=H(L,o),L.forEach(p),r=z(w),i=W(w,"SPAN",{});var I=Y(i);s=H(I,"Proposed: "),c=H(I,m),I.forEach(p),w.forEach(p),d=z(_),this.h()},h(){X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(_,w){k(_,e,w),U(e,l),U(l,t),U(l,a),U(e,r),U(e,i),U(i,s),U(i,c),k(_,d,w)},p(_,w){w&2&&o!==(o=de(_[10].existing)+"")&&ue(a,o),w&2&&m!==(m=de(_[10].proposed)+"")&&ue(c,m)},d(_){_&&(p(e),p(d))}}}function ct(n){let e,l;function t(){return n[4](n[12])}return e=new ze({props:{name:n[10].name||"Untitled junction",$$slots:{default:[ul]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){A(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,a){D(e,o,a),l=!0},p(o,a){n=o;const r={};a&2&&(r.name=n[10].name||"Untitled junction"),a&8194&&(r.$$scope={dirty:a,ctx:n}),e.$set(r)},i(o){l||(v(e.$$.fragment,o),l=!0)},o(o){j(e.$$.fragment,o),l=!1},d(o){F(e,o)}}}function ml(n){let e,l,t,o;const a=[el,xn],r=[];function i(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=i(n))&&(l=r[e]=a[e](n)),{c(){l&&l.c(),t=ie()},l(s){l&&l.l(s),t=ie()},m(s,m){~e&&r[e].m(s,m),k(s,t,m),o=!0},p(s,[m]){let c=e;e=i(s),e===c?~e&&r[e].p(s,m):(l&&(me(),j(r[c],1,1,()=>{r[c]=null}),ce()),~e?(l=r[e],l?l.p(s,m):(l=r[e]=a[e](s),l.c()),v(l,1),l.m(t.parentNode,t)):l=null)},i(s){o||(v(l),o=!0)},o(s){j(l),o=!1},d(s){s&&p(t),~e&&r[e].d(s)}}}function De(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function cl(n,e,l){let t;Te(n,te,w=>l(1,t=w));let o={kind:"list"};function a(){we(te,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),l(0,o={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function r(w){window.confirm("Delete this junction?")&&(t.jat.splice(w,1),te.set(t),l(0,o={kind:"list"}))}const i=w=>l(0,o={kind:"edit",idx:w,stage:"existing"}),s=()=>l(0,o={kind:"list"}),m=()=>r(De(o));function c(w){n.$$.not_equal(t.jat[o.idx].name,w)&&(t.jat[o.idx].name=w,te.set(t))}return[o,t,a,r,i,s,m,c,()=>l(0,o={kind:"edit",idx:De(o),stage:"existing"}),()=>l(0,o={kind:"edit",idx:De(o),stage:"proposed"})]}class Pl extends Se{constructor(e){super(),Ee(this,e,cl,ml,je,{})}}export{Pl as component};
