import{s as we,y as re,z as se,l as ct,u as _t,r as gt,v as dt,E as be,k as Te,S as wt,x as ke,a as F,g as q,i as k,f as p,H as Ce,Y as jt,e as R,c as W,b as Y,p as le,h as B,G as ie,o as pt,q as X,L as Ne,t as G,M as Ae,d as H,n as Le,m as Me,j as ue,w as Ct,V as Je}from"../chunks/scheduler.NGc5rx4B.js";import{S as Se,i as ye,e as fe,c as A,a as P,m as D,t as v,b as j,d as U,g as me,f as ce}from"../chunks/index.CXr-pTxM.js";import{e as ge}from"../chunks/each.C0Oa3ZQW.js";import{C as qe,B as Mt}from"../chunks/ClickableCard.Dy0Gc3SI.js";import{D as ze}from"../chunks/DefaultButton.HZ4Q0i-3.js";import{S as ve}from"../chunks/SecondaryButton.DY728Lpc.js";/* empty css                                                    */import{T as Oe}from"../chunks/TextInput.B2MdnKN0.js";import{W as Ge}from"../chunks/WarningButton.B2__z57s.js";import{s as te}from"../chunks/data.IFSZru-A.js";import{g as Lt}from"../chunks/globals.D0QH3NT1.js";import{c as Ve}from"../chunks/index.EGG-koyX.js";import{L as St,h as yt,d as he,q as Et,t as It,v as Ue,M as Tt,b as Nt,C as At,G as Xe,w as Be,x as Re,f as Pt,P as $t}from"../chunks/index.BI6F_H-A.js";import{g as Fe,t as Dt}from"../chunks/index.BPg7j72P.js";import{c as pe}from"../chunks/colors.DaC397qr.js";import{G as Ut,I as Pe,p as Bt}from"../chunks/pan.YqUq8aT6.js";import{M as Ft,a as Ee,B as qt,G as zt,S as Ot,C as Gt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.CWYMobZU.js";import"../chunks/paths.C3WBBnTo.js";import{C as Ht}from"../chunks/CollapsibleCard.CecXaQdy.js";import{T as ht}from"../chunks/TextArea.T6odI4uv.js";import{R as We}from"../chunks/Radio.lfhmTBy6.js";function Jt(n){let e;const l=n[16].default,t=ct(l,n,n[24],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,a){t&&t.m(o,a),e=!0},p(o,a){t&&t.p&&(!e||a&16777216)&&_t(t,l,o,o[24],e?dt(l,o[24],a,null):gt(o[24]),null)},i(o){e||(v(t,o),e=!0)},o(o){j(t,o),e=!1},d(o){t&&t.d(o)}}}function Vt(n){let e,l,t;function o(r){n[17](r)}let a={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Jt]},$$scope:{ctx:n}};return n[0]!==void 0&&(a.hovered=n[0]),e=new St({props:a}),re.push(()=>fe(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),t=!0},p(r,[i]){const s={};i&2&&(s.id=r[1]),i&4&&(s.source=r[2]),i&8&&(s.sourceLayer=r[3]),i&16&&(s.beforeId=r[4]),i&32&&(s.beforeLayerType=r[5]),i&64&&(s.paint=r[6]),i&128&&(s.layout=r[7]),i&256&&(s.filter=r[8]),i&512&&(s.applyToClusters=r[9]),i&1024&&(s.minzoom=r[10]),i&2048&&(s.maxzoom=r[11]),i&4096&&(s.hoverCursor=r[12]),i&8192&&(s.manageHoverState=r[13]),i&16384&&(s.eventsIfTopMost=r[14]),i&32768&&(s.interactive=r[15]),i&16777216&&(s.$$scope={dirty:i,ctx:r}),!l&&i&1&&(l=!0,s.hovered=r[0],se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){U(e,r)}}}function Xt(n,e,l){let{$$slots:t={},$$scope:o}=e,{id:a=yt("symbol")}=e,{source:r=void 0}=e,{sourceLayer:i=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:c=void 0}=e,{layout:d=void 0}=e,{filter:_=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:S=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:E=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:N=!0}=e;function f(C){$=C,l(0,$)}function g(C){be.call(this,n,C)}function T(C){be.call(this,n,C)}function Q(C){be.call(this,n,C)}function ee(C){be.call(this,n,C)}function x(C){be.call(this,n,C)}function J(C){be.call(this,n,C)}return n.$$set=C=>{"id"in C&&l(1,a=C.id),"source"in C&&l(2,r=C.source),"sourceLayer"in C&&l(3,i=C.sourceLayer),"beforeId"in C&&l(4,s=C.beforeId),"beforeLayerType"in C&&l(5,m=C.beforeLayerType),"paint"in C&&l(6,c=C.paint),"layout"in C&&l(7,d=C.layout),"filter"in C&&l(8,_=C.filter),"applyToClusters"in C&&l(9,w=C.applyToClusters),"minzoom"in C&&l(10,S=C.minzoom),"maxzoom"in C&&l(11,I=C.maxzoom),"hoverCursor"in C&&l(12,M=C.hoverCursor),"manageHoverState"in C&&l(13,E=C.manageHoverState),"hovered"in C&&l(0,$=C.hovered),"eventsIfTopMost"in C&&l(14,b=C.eventsIfTopMost),"interactive"in C&&l(15,N=C.interactive),"$$scope"in C&&l(24,o=C.$$scope)},[$,a,r,i,s,m,c,d,_,w,S,I,M,E,b,N,t,f,g,T,Q,ee,x,J,o]}class Rt extends Se{constructor(e){super(),ye(this,e,Xt,Vt,we,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Wt=Object.defineProperty,Zt=(n,e)=>Wt(n,"name",{value:e,configurable:!0});function vt(n,e,l,t={}){const o=Fe(n),a=he(o[0]),r=he(o[1]),i=he(l),s=Et(e,t.units),m=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),c=a+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(m)),d=Ue(c),_=Ue(m);return It([d,_],t.properties)}Zt(vt,"destination");var je=vt,Kt=Object.defineProperty,bt=(n,e)=>Kt(n,"name",{value:e,configurable:!0});function He(n,e,l={}){if(l.final===!0)return kt(n,e);const t=Fe(n),o=Fe(e),a=he(t[0]),r=he(o[0]),i=he(t[1]),s=he(o[1]),m=Math.sin(r-a)*Math.cos(s),c=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(r-a);return Ue(Math.atan2(m,c))}bt(He,"bearing");function kt(n,e){let l=He(e,n);return l=(l+180)%360,l}bt(kt,"calculateFinalBearing");var Ie=He;const Yt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ze(n,e,l){const t=n.slice();return t[36]=e[l],t[37]=e,t[38]=l,t}function Ke(n,e,l){const t=n.slice();return t[39]=e[l],t[40]=e,t[38]=l,t}function Ye(n){let e,l,t,o,a,r,i;return l=new Pe({props:{$$slots:{default:[en]},$$scope:{ctx:n}}}),l.$on("click",function(){jt(n[5])&&n[5].apply(this,arguments)}),o=new Pe({props:{$$slots:{default:[ln]},$$scope:{ctx:n}}}),o.$on("click",n[17]),r=new Pe({props:{$$slots:{default:[an]},$$scope:{ctx:n}}}),r.$on("click",n[18]),{c(){e=R("div"),A(l.$$.fragment),t=F(),A(o.$$.fragment),a=F(),A(r.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Y(e);P(l.$$.fragment,m),t=q(m),P(o.$$.fragment,m),a=q(m),P(r.$$.fragment,m),m.forEach(p),this.h()},h(){le(e,"class","control-panel svelte-1w3m76d")},m(s,m){k(s,e,m),D(l,e,null),B(e,t),D(o,e,null),B(e,a),D(r,e,null),i=!0},p(s,m){n=s;const c={};m[0]&1|m[1]&1024&&(c.$$scope={dirty:m,ctx:n}),l.$set(c);const d={};m[0]&1|m[1]&1024&&(d.$$scope={dirty:m,ctx:n}),o.$set(d);const _={};m[0]&1|m[1]&1024&&(_.$$scope={dirty:m,ctx:n}),r.$set(_)},i(s){i||(v(l.$$.fragment,s),v(o.$$.fragment,s),v(r.$$.fragment,s),i=!0)},o(s){j(l.$$.fragment,s),j(o.$$.fragment,s),j(r.$$.fragment,s),i=!1},d(s){s&&p(e),U(l),U(o),U(r)}}}function Qt(n){let e;return{c(){e=G("Move map")},l(l){e=H(l,"Move map")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function xt(n){let e,l="Move map";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-1719ytd"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function en(n){let e,l,t,o;function a(s,m){return s[0].mode=="select"?xt:Qt}let r=a(n),i=r(n);return{c(){e=R("img"),t=F(),i.c(),o=ie(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),t=q(s),i.l(s),o=ie(),this.h()},h(){pt(e.src,l=Bt)||le(e,"src",l),le(e,"alt","Move map"),X(e,"vertical-align","middle")},m(s,m){k(s,e,m),k(s,t,m),i.m(s,m),k(s,o,m)},p(s,m){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(t),p(o)),i.d(s)}}}function tn(n){let e;return{c(){e=G("New arm")},l(l){e=H(l,"New arm")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function nn(n){let e,l="New arm";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-1typ7gq"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function ln(n){let e,l,t,o,a,r;function i(c,d){return c[0].mode=="new-arm"?nn:tn}let s=i(n),m=s(n);return{c(){e=Ne("svg"),l=Ne("circle"),t=Ne("text"),o=G("A"),a=F(),m.c(),r=ie(),this.h()},l(c){e=Ae(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var d=Y(e);l=Ae(d,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(l).forEach(p),t=Ae(d,"text",{x:!0,y:!0,fill:!0});var _=Y(t);o=H(_,"A"),_.forEach(p),d.forEach(p),a=q(c),m.l(c),r=ie(),this.h()},h(){le(l,"cx","12"),le(l,"cy","12"),le(l,"r","12"),le(l,"fill","white"),le(t,"x","6"),le(t,"y","16"),le(t,"fill","#4472c4"),le(e,"width","24"),le(e,"height","24"),le(e,"xmlns","http://www.w3.org/2000/svg"),X(e,"vertical-align","middle")},m(c,d){k(c,e,d),B(e,l),B(e,t),B(t,o),k(c,a,d),m.m(c,d),k(c,r,d)},p(c,d){s!==(s=i(c))&&(m.d(1),m=s(c),m&&(m.c(),m.m(r.parentNode,r)))},d(c){c&&(p(e),p(a),p(r)),m.d(c)}}}function on(n){let e;return{c(){e=G("New movement")},l(l){e=H(l,"New movement")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function rn(n){let e,l="New movement";return{c(){e=R("u"),e.textContent=l},l(t){e=W(t,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-o92ucp"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function an(n){let e,l,t,o;function a(s,m){return s[0].mode=="new-movement"?rn:on}let r=a(n),i=r(n);return{c(){e=R("img"),t=F(),i.c(),o=ie(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),t=q(s),i.l(s),o=ie(),this.h()},h(){pt(e.src,l=Yt)||le(e,"src",l),le(e,"alt","New movement"),X(e,"vertical-align","middle")},m(s,m){k(s,e,m),k(s,t,m),i.m(s,m),k(s,o,m)},p(s,m){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(t),p(o)),i.d(s)}}}function sn(n){let e,l=bn(n[38])+"",t;return{c(){e=R("span"),t=G(l),this.h()},l(o){e=W(o,"SPAN",{class:!0});var a=Y(e);t=H(a,l),a.forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(o,a){k(o,e,a),B(e,t)},p:Le,d(o){o&&p(e)}}}function Qe(n){let e,l,t;function o(s){n[19](s,n[39])}function a(){return n[20](n[38])}function r(){return n[21](n[38])}let i={draggable:!0,$$slots:{default:[sn]},$$scope:{ctx:n}};return n[39].point!==void 0&&(i.lngLat=n[39].point),e=new Ee({props:i}),re.push(()=>fe(e,"lngLat",o)),e.$on("dragend",a),e.$on("click",r),{c(){A(e.$$.fragment)},l(s){P(e.$$.fragment,s)},m(s,m){D(e,s,m),t=!0},p(s,m){n=s;const c={};m[1]&1024&&(c.$$scope={dirty:m,ctx:n}),!l&&m[0]&70&&(l=!0,c.lngLat=n[39].point,se(()=>l=!1)),e.$set(c)},i(s){t||(v(e.$$.fragment,s),t=!0)},o(s){j(e.$$.fragment,s),t=!1},d(s){U(e,s)}}}function fn(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score]),X(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score]),t[0]&70&&X(e,"opacity",l[36].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&p(e)}}}function un(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score])},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function mn(n){let e;return{c(){e=R("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){le(e,"class","dot svelte-1w3m76d"),X(e,"background-color",n[9][n[36].score]),X(e,"opacity","0%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&X(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function xe(n){let e,l,t,o,a,r,i,s,m;function c(g){n[22](g,n[36])}function d(){return n[23](n[38])}function _(){return n[24](n[38])}let w={draggable:!0,$$slots:{default:[fn]},$$scope:{ctx:n}};n[36].point1!==void 0&&(w.lngLat=n[36].point1),e=new Ee({props:w}),re.push(()=>fe(e,"lngLat",c)),e.$on("dragend",d),e.$on("click",_);function S(g){n[25](g,n[36])}function I(){return n[26](n[38])}function M(){return n[27](n[38])}let E={draggable:!0,$$slots:{default:[un]},$$scope:{ctx:n}};n[36].point2!==void 0&&(E.lngLat=n[36].point2),o=new Ee({props:E}),re.push(()=>fe(o,"lngLat",S)),o.$on("dragend",I),o.$on("click",M);function $(g){n[28](g,n[36])}function b(){return n[29](n[38])}function N(){return n[30](n[38])}let f={draggable:!0,$$slots:{default:[mn]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(f.lngLat=n[36].point3),i=new Ee({props:f}),re.push(()=>fe(i,"lngLat",$)),i.$on("dragend",b),i.$on("click",N),{c(){A(e.$$.fragment),t=F(),A(o.$$.fragment),r=F(),A(i.$$.fragment)},l(g){P(e.$$.fragment,g),t=q(g),P(o.$$.fragment,g),r=q(g),P(i.$$.fragment,g)},m(g,T){D(e,g,T),k(g,t,T),D(o,g,T),k(g,r,T),D(i,g,T),m=!0},p(g,T){n=g;const Q={};T[0]&70|T[1]&1024&&(Q.$$scope={dirty:T,ctx:n}),!l&&T[0]&70&&(l=!0,Q.lngLat=n[36].point1,se(()=>l=!1)),e.$set(Q);const ee={};T[0]&70|T[1]&1024&&(ee.$$scope={dirty:T,ctx:n}),!a&&T[0]&70&&(a=!0,ee.lngLat=n[36].point2,se(()=>a=!1)),o.$set(ee);const x={};T[0]&70|T[1]&1024&&(x.$$scope={dirty:T,ctx:n}),!s&&T[0]&70&&(s=!0,x.lngLat=n[36].point3,se(()=>s=!1)),i.$set(x)},i(g){m||(v(e.$$.fragment,g),v(o.$$.fragment,g),v(i.$$.fragment,g),m=!0)},o(g){j(e.$$.fragment,g),j(o.$$.fragment,g),j(i.$$.fragment,g),m=!1},d(g){g&&(p(t),p(r)),U(e,g),U(o,g),U(i,g)}}}function cn(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ue(l,e)},d(t){t&&p(l)}}}function _n(n){let e,l;return e=new $t({props:{$$slots:{default:[cn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function gn(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ue(l,e)},d(t){t&&p(l)}}}function dn(n){let e,l;return e=new $t({props:{$$slots:{default:[gn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function pn(n){let e,l,t,o,a,r;return e=new Be({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Re(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[_n]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Be({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Re(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[dn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),a=new Rt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),A(a.$$.fragment)},l(i){P(e.$$.fragment,i),l=q(i),P(t.$$.fragment,i),o=q(i),P(a.$$.fragment,i)},m(i,s){D(e,i,s),k(i,l,s),D(t,i,s),k(i,o,s),D(a,i,s),r=!0},p(i,s){const m={};s[1]&1024&&(m.$$scope={dirty:s,ctx:i}),e.$set(m);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:i}),t.$set(c)},i(i){r||(v(e.$$.fragment,i),v(t.$$.fragment,i),v(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(t.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),U(e,i),U(t,i),U(a,i)}}}function $n(n){let e,l,t,o;return e=new Be({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Pt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment)},l(a){P(e.$$.fragment,a),l=q(a),P(t.$$.fragment,a)},m(a,r){D(e,a,r),k(a,l,r),D(t,a,r),o=!0},p:Le,i(a){o||(v(e.$$.fragment,a),v(t.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(t.$$.fragment,a),o=!1},d(a){a&&p(l),U(e,a),U(t,a)}}}function hn(n){let e,l,t,o,a,r,i,s,m,c,d,_,w;e=new Ft({}),e.$on("click",n[10]);let S=n[0].mode!="editing"&&Ye(n);o=new At({props:{gj:n[6].summary.networkMap,show:n[3]}});let I=ge(n[6].jat[n[1]][n[2]].arms),M=[];for(let f=0;f<I.length;f+=1)M[f]=Qe(Ke(n,I,f));const E=f=>j(M[f],1,1,()=>{M[f]=null});let $=ge(n[6].jat[n[1]][n[2]].movements),b=[];for(let f=0;f<$.length;f+=1)b[f]=xe(Ze(n,$,f));const N=f=>j(b[f],1,1,()=>{b[f]=null});return s=new Xe({props:{data:n[12](n[6]),$$slots:{default:[pn]},$$scope:{ctx:n}}}),c=new Xe({props:{data:n[8],$$slots:{default:[$n]},$$scope:{ctx:n}}}),_=new Ut({props:{map:n[7]}}),{c(){A(e.$$.fragment),l=F(),S&&S.c(),t=F(),A(o.$$.fragment),a=F();for(let f=0;f<M.length;f+=1)M[f].c();r=F();for(let f=0;f<b.length;f+=1)b[f].c();i=F(),A(s.$$.fragment),m=F(),A(c.$$.fragment),d=F(),A(_.$$.fragment)},l(f){P(e.$$.fragment,f),l=q(f),S&&S.l(f),t=q(f),P(o.$$.fragment,f),a=q(f);for(let g=0;g<M.length;g+=1)M[g].l(f);r=q(f);for(let g=0;g<b.length;g+=1)b[g].l(f);i=q(f),P(s.$$.fragment,f),m=q(f),P(c.$$.fragment,f),d=q(f),P(_.$$.fragment,f)},m(f,g){D(e,f,g),k(f,l,g),S&&S.m(f,g),k(f,t,g),D(o,f,g),k(f,a,g);for(let T=0;T<M.length;T+=1)M[T]&&M[T].m(f,g);k(f,r,g);for(let T=0;T<b.length;T+=1)b[T]&&b[T].m(f,g);k(f,i,g),D(s,f,g),k(f,m,g),D(c,f,g),k(f,d,g),D(_,f,g),w=!0},p(f,g){f[0].mode!="editing"?S?(S.p(f,g),g[0]&1&&v(S,1)):(S=Ye(f),S.c(),v(S,1),S.m(t.parentNode,t)):S&&(me(),j(S,1,1,()=>{S=null}),ce());const T={};if(g[0]&64&&(T.gj=f[6].summary.networkMap),g[0]&8&&(T.show=f[3]),o.$set(T),g[0]&86){I=ge(f[6].jat[f[1]][f[2]].arms);let J;for(J=0;J<I.length;J+=1){const C=Ke(f,I,J);M[J]?(M[J].p(C,g),v(M[J],1)):(M[J]=Qe(C),M[J].c(),v(M[J],1),M[J].m(r.parentNode,r))}for(me(),J=I.length;J<M.length;J+=1)E(J);ce()}if(g[0]&598){$=ge(f[6].jat[f[1]][f[2]].movements);let J;for(J=0;J<$.length;J+=1){const C=Ze(f,$,J);b[J]?(b[J].p(C,g),v(b[J],1)):(b[J]=xe(C),b[J].c(),v(b[J],1),b[J].m(i.parentNode,i))}for(me(),J=$.length;J<b.length;J+=1)N(J);ce()}const Q={};g[0]&64&&(Q.data=f[12](f[6])),g[1]&1024&&(Q.$$scope={dirty:g,ctx:f}),s.$set(Q);const ee={};g[0]&256&&(ee.data=f[8]),g[1]&1024&&(ee.$$scope={dirty:g,ctx:f}),c.$set(ee);const x={};g[0]&128&&(x.map=f[7]),_.$set(x)},i(f){if(!w){v(e.$$.fragment,f),v(S),v(o.$$.fragment,f);for(let g=0;g<I.length;g+=1)v(M[g]);for(let g=0;g<$.length;g+=1)v(b[g]);v(s.$$.fragment,f),v(c.$$.fragment,f),v(_.$$.fragment,f),w=!0}},o(f){j(e.$$.fragment,f),j(S),j(o.$$.fragment,f),M=M.filter(Boolean);for(let g=0;g<M.length;g+=1)j(M[g]);b=b.filter(Boolean);for(let g=0;g<b.length;g+=1)j(b[g]);j(s.$$.fragment,f),j(c.$$.fragment,f),j(_.$$.fragment,f),w=!1},d(f){f&&(p(l),p(t),p(a),p(r),p(i),p(m),p(d)),U(e,f),S&&S.d(f),U(o,f),Ce(M,f),Ce(b,f),U(s,f),U(c,f),U(_,f)}}}function vn(n){let e,l,t;function o(r){n[31](r)}let a={$$slots:{default:[hn]},$$scope:{ctx:n}};return n[7]!==void 0&&(a.map=n[7]),e=new Tt({props:a}),re.push(()=>fe(e,"map",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),t=!0},p(r,i){const s={};i[0]&511|i[1]&1024&&(s.$$scope={dirty:i,ctx:r}),!l&&i[0]&128&&(l=!0,s.map=r[7],se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){U(e,r)}}}function et(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function bn(n){return String.fromCharCode(n+65)}function kn(n,e,l){let t,o;Te(n,te,u=>l(6,o=u));let{junctionIdx:a}=e,{stage:r}=e,{mode:i}=e,{hoveringSidebar:s}=e,{streetviewOn:m}=e,{showContext:c}=e,{select:d}=e,{stopEditing:_}=e,w,S={0:pe.red.background,1:pe.amber.background,2:pe.green.background,X:pe.critical.background};function I(u,h,K){let O={type:"FeatureCollection",features:[]},_e=h.mode=="editing"?h.id:K;return _e!=null&&(_e.kind=="arm"?O.features.push(et(u.jat[a][r].arms[_e.idx],_e.idx)):O.features.push(b(u.jat[a][r].movements[_e.idx],_e.idx))),O}async function M(u){if(!m){for(let h of w.queryRenderedFeatures(u.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i.mode!="select"){if(i.mode=="editing"){await _();return}i.mode=="new-arm"?(ke(te,o.jat[a][r].arms=[...o.jat[a][r].arms,{point:u.detail.lngLat.toArray(),name:""}],o),await d({kind:"arm",idx:o.jat[a][r].arms.length-1})):(ke(te,o.jat[a][r].movements=[...o.jat[a][r].movements,{point1:u.detail.lngLat.toArray(),point2:je(u.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:je(u.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await d({kind:"movement",idx:o.jat[a][r].movements.length-1}))}}}async function E(u){await d({kind:"movement",idx:u.detail.features[0].id})}wt(()=>{f(!1)});function $(u){let h={type:"FeatureCollection",features:u.jat[a][r].movements.map((K,O)=>b(K,O))};for(let K of u.jat[a][r].movements)if(h.features.push(N(K,h.features.length)),K.kind=="walking & wheeling"){let O={...K,point1:K.point3,point3:K.point1};h.features.push(N(O,h.features.length))}return h}function b(u,h){return{type:"Feature",id:h,properties:{name:u.name,kind:u.kind,color:S[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2,u.point3]}}}function N(u,h){return{type:"Feature",id:h,properties:{kind:u.kind,color:S[u.score],angle:Ie(u.point2,u.point3)},geometry:{type:"Point",coordinates:u.point3}}}function f(u){let h=$(o);for(let K of o.jat[a][r].arms)h.features.push(et(K,h.features.length));for(let K of o.summary.networkMap.features)h.features.push(K);h.features.length>0&&w.fitBounds(Nt(h),{padding:20,animate:u})}function g(){return w}const T=()=>l(0,i={mode:"new-arm"}),Q=()=>l(0,i={mode:"new-movement"});function ee(u,h){n.$$.not_equal(h.point,u)&&(h.point=u,te.set(o))}const x=u=>d({kind:"arm",idx:u}),J=u=>d({kind:"arm",idx:u});function C(u,h){n.$$.not_equal(h.point1,u)&&(h.point1=u,te.set(o))}const oe=u=>d({kind:"movement",idx:u}),Z=u=>d({kind:"movement",idx:u});function $e(u,h){n.$$.not_equal(h.point2,u)&&(h.point2=u,te.set(o))}const y=u=>d({kind:"movement",idx:u}),z=u=>d({kind:"movement",idx:u});function ne(u,h){n.$$.not_equal(h.point3,u)&&(h.point3=u,te.set(o))}const V=u=>d({kind:"movement",idx:u}),ae=u=>d({kind:"movement",idx:u});function L(u){w=u,l(7,w)}return n.$$set=u=>{"junctionIdx"in u&&l(1,a=u.junctionIdx),"stage"in u&&l(2,r=u.stage),"mode"in u&&l(0,i=u.mode),"hoveringSidebar"in u&&l(13,s=u.hoveringSidebar),"streetviewOn"in u&&l(14,m=u.streetviewOn),"showContext"in u&&l(3,c=u.showContext),"select"in u&&l(4,d=u.select),"stopEditing"in u&&l(5,_=u.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&8257&&l(8,t=I(o,i,s))},[i,a,r,c,d,_,o,w,t,S,M,E,$,s,m,f,g,T,Q,ee,x,J,C,oe,Z,$e,y,z,ne,V,ae,L]}class wn extends Se{constructor(e){super(),ye(this,e,kn,vn,we,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showContext:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function jn(n){let e,l,t,o,a,r,i,s,m,c,d,_;function w(f){n[5](f)}let S={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(S.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Oe({props:S}),re.push(()=>fe(e,"value",w));function I(f){n[6](f)}let M={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(M.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),o=new We({props:M}),re.push(()=>fe(o,"value",I));function E(f){n[7](f)}let $={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),i=new We({props:$}),re.push(()=>fe(i,"value",E));function b(f){n[8](f)}let N={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(N.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),c=new ht({props:N}),re.push(()=>fe(c,"value",b)),{c(){A(e.$$.fragment),t=F(),A(o.$$.fragment),r=F(),A(i.$$.fragment),m=F(),A(c.$$.fragment)},l(f){P(e.$$.fragment,f),t=q(f),P(o.$$.fragment,f),r=q(f),P(i.$$.fragment,f),m=q(f),P(c.$$.fragment,f)},m(f,g){D(e,f,g),k(f,t,g),D(o,f,g),k(f,r,g),D(i,f,g),k(f,m,g),D(c,f,g),_=!0},p(f,[g]){const T={};!l&&g&15&&(l=!0,T.value=f[3].jat[f[0]][f[1]].movements[f[2]].name,se(()=>l=!1)),e.$set(T);const Q={};!a&&g&15&&(a=!0,Q.value=f[3].jat[f[0]][f[1]].movements[f[2]].kind,se(()=>a=!1)),o.$set(Q);const ee={};!s&&g&15&&(s=!0,ee.value=f[3].jat[f[0]][f[1]].movements[f[2]].score,se(()=>s=!1)),i.$set(ee);const x={};!d&&g&15&&(d=!0,x.value=f[3].jat[f[0]][f[1]].movements[f[2]].notes,se(()=>d=!1)),c.$set(x)},i(f){_||(v(e.$$.fragment,f),v(o.$$.fragment,f),v(i.$$.fragment,f),v(c.$$.fragment,f),_=!0)},o(f){j(e.$$.fragment,f),j(o.$$.fragment,f),j(i.$$.fragment,f),j(c.$$.fragment,f),_=!1},d(f){f&&(p(t),p(r),p(m)),U(e,f),U(o,f),U(i,f),U(c,f)}}}function Cn(n,e,l){let t;Te(n,te,_=>l(3,t=_));let{junctionIdx:o}=e,{stage:a}=e,{idx:r}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){n.$$.not_equal(t.jat[o][a].movements[r].name,_)&&(t.jat[o][a].movements[r].name=_,te.set(t))}function m(_){n.$$.not_equal(t.jat[o][a].movements[r].kind,_)&&(t.jat[o][a].movements[r].kind=_,te.set(t))}function c(_){n.$$.not_equal(t.jat[o][a].movements[r].score,_)&&(t.jat[o][a].movements[r].score=_,te.set(t))}function d(_){n.$$.not_equal(t.jat[o][a].movements[r].notes,_)&&(t.jat[o][a].movements[r].notes=_,te.set(t))}return n.$$set=_=>{"junctionIdx"in _&&l(0,o=_.junctionIdx),"stage"in _&&l(1,a=_.stage),"idx"in _&&l(2,r=_.idx)},[o,a,r,t,i,s,m,c,d]}class Mn extends Se{constructor(e){super(),ye(this,e,Cn,jn,we,{junctionIdx:0,stage:1,idx:2})}}function de(n){if(n.movements.length==0)return"No movements added";let e=0,l=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],l+=2;let t=e/l*100;return`${Math.round(t)}%`}function Ln(n,e){let l=.003,t=(a,r)=>{let i=e[a].point,m=Ie(i,n.point)-90,c=l*r;return je(i,c,m).geometry.coordinates},o=[];for(let a=0;a<e.length;a++){let r=e[a],i=Ie(r.point,n.point),s=1;for(let m of Sn(a,e.length)){let c=e[m],d=Ie(n.point,c.point),_=t(a,s++),w=Dt(r.point,n.point),S=je(_,.5*w,i).geometry.coordinates,I=je(S,.2*w,d).geometry.coordinates;o.push({point1:_,point2:S,point3:I,kind:"cycling",score:"X",name:`${r.name} to ${c.name}`,notes:""})}}return o}function Sn(n,e){let l=[];for(let t=n+1;t<e;t++)l.push(t);for(let t=0;t<n;t++)l.push(t);return l}const{window:yn}=Lt;function tt(n,e,l){const t=n.slice();t[34]=e[l],t[37]=l;const o=t[16][t[34].score];return t[35]=o,t}function nt(n,e,l){const t=n.slice();return t[38]=e[l],t[37]=l,t}function En(n){let e,l,t,o,a,r,i,s;e=new ze({props:{$$slots:{default:[Tn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Ge({props:{$$slots:{default:[Nn]},$$scope:{ctx:n}}}),t.$on("click",n[12]);const m=[Pn,An],c=[];function d(_,w){return _[2].id.kind=="movement"?0:1}return a=d(n),r=c[a]=m[a](n),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),r.c(),i=ie()},l(_){P(e.$$.fragment,_),l=q(_),P(t.$$.fragment,_),o=q(_),r.l(_),i=ie()},m(_,w){D(e,_,w),k(_,l,w),D(t,_,w),k(_,o,w),c[a].m(_,w),k(_,i,w),s=!0},p(_,w){const S={};w[1]&2&&(S.$$scope={dirty:w,ctx:_}),e.$set(S);const I={};w[1]&2&&(I.$$scope={dirty:w,ctx:_}),t.$set(I);let M=a;a=d(_),a===M?c[a].p(_,w):(me(),j(c[M],1,1,()=>{c[M]=null}),ce(),r=c[a],r?r.p(_,w):(r=c[a]=m[a](_),r.c()),v(r,1),r.m(i.parentNode,i))},i(_){s||(v(e.$$.fragment,_),v(t.$$.fragment,_),v(r),s=!0)},o(_){j(e.$$.fragment,_),j(t.$$.fragment,_),j(r),s=!1},d(_){_&&(p(l),p(o),p(i)),U(e,_),U(t,_),c[a].d(_)}}}function In(n){let e,l,t,o,a="Arms",r,i,s,m,c="Movements",d,_,w,S,I,M,E=(n[8].jat[n[0]].name||"Untitled junction")+"",$,b,N=de(n[8].jat[n[0]][n[1]])+"",f,g,T,Q,ee,x;const J=n[18].default,C=ct(J,n,n[32],null);l=new Ht({props:{label:"Tools",$$slots:{default:[qn]},$$scope:{ctx:n}}});let oe=ge(n[8].jat[n[0]][n[1]].arms),Z=[];for(let u=0;u<oe.length;u+=1)Z[u]=lt(nt(n,oe,u));const $e=u=>j(Z[u],1,1,()=>{Z[u]=null});let y=n[8].jat[n[0]][n[9]].arms.length>0&&ot(n),z=n[8].jat[n[0]][n[1]].arms.length>0&&rt(n),ne=ge(n[8].jat[n[0]][n[1]].movements),V=[];for(let u=0;u<ne.length;u+=1)V[u]=at(tt(n,ne,u));const ae=u=>j(V[u],1,1,()=>{V[u]=null});let L=n[8].jat[n[0]][n[9]].movements.length>0&&it(n);return{c(){C&&C.c(),e=F(),A(l.$$.fragment),t=F(),o=R("h3"),o.textContent=a,r=F();for(let u=0;u<Z.length;u+=1)Z[u].c();i=F(),y&&y.c(),s=F(),m=R("h3"),m.textContent=c,d=F(),_=R("p"),w=G("Total JAT score for "),S=G(n[1]),I=F(),M=R("u"),$=G(E),b=G(`
        : `),f=G(N),g=F(),z&&z.c(),T=F();for(let u=0;u<V.length;u+=1)V[u].c();Q=F(),L&&L.c(),ee=ie()},l(u){C&&C.l(u),e=q(u),P(l.$$.fragment,u),t=q(u),o=W(u,"H3",{"data-svelte-h":!0}),Me(o)!=="svelte-ld74qb"&&(o.textContent=a),r=q(u);for(let O=0;O<Z.length;O+=1)Z[O].l(u);i=q(u),y&&y.l(u),s=q(u),m=W(u,"H3",{"data-svelte-h":!0}),Me(m)!=="svelte-1dc52s8"&&(m.textContent=c),d=q(u),_=W(u,"P",{});var h=Y(_);w=H(h,"Total JAT score for "),S=H(h,n[1]),I=q(h),M=W(h,"U",{});var K=Y(M);$=H(K,E),K.forEach(p),b=H(h,`
        : `),f=H(h,N),h.forEach(p),g=q(u),z&&z.l(u),T=q(u);for(let O=0;O<V.length;O+=1)V[O].l(u);Q=q(u),L&&L.l(u),ee=ie()},m(u,h){C&&C.m(u,h),k(u,e,h),D(l,u,h),k(u,t,h),k(u,o,h),k(u,r,h);for(let K=0;K<Z.length;K+=1)Z[K]&&Z[K].m(u,h);k(u,i,h),y&&y.m(u,h),k(u,s,h),k(u,m,h),k(u,d,h),k(u,_,h),B(_,w),B(_,S),B(_,I),B(_,M),B(M,$),B(_,b),B(_,f),k(u,g,h),z&&z.m(u,h),k(u,T,h);for(let K=0;K<V.length;K+=1)V[K]&&V[K].m(u,h);k(u,Q,h),L&&L.m(u,h),k(u,ee,h),x=!0},p(u,h){C&&C.p&&(!x||h[1]&2)&&_t(C,J,u,u[32],x?dt(J,u[32],h,null):gt(u[32]),null);const K={};if(h[0]&112|h[1]&2&&(K.$$scope={dirty:h,ctx:u}),l.$set(K),h[0]&1291){oe=ge(u[8].jat[u[0]][u[1]].arms);let O;for(O=0;O<oe.length;O+=1){const _e=nt(u,oe,O);Z[O]?(Z[O].p(_e,h),v(Z[O],1)):(Z[O]=lt(_e),Z[O].c(),v(Z[O],1),Z[O].m(i.parentNode,i))}for(me(),O=oe.length;O<Z.length;O+=1)$e(O);ce()}if(u[8].jat[u[0]][u[9]].arms.length>0?y?(y.p(u,h),h[0]&257&&v(y,1)):(y=ot(u),y.c(),v(y,1),y.m(s.parentNode,s)):y&&(me(),j(y,1,1,()=>{y=null}),ce()),(!x||h[0]&2)&&ue(S,u[1]),(!x||h[0]&257)&&E!==(E=(u[8].jat[u[0]].name||"Untitled junction")+"")&&ue($,E),(!x||h[0]&259)&&N!==(N=de(u[8].jat[u[0]][u[1]])+"")&&ue(f,N),u[8].jat[u[0]][u[1]].arms.length>0?z?(z.p(u,h),h[0]&259&&v(z,1)):(z=rt(u),z.c(),v(z,1),z.m(T.parentNode,T)):z&&(me(),j(z,1,1,()=>{z=null}),ce()),h[0]&66827){ne=ge(u[8].jat[u[0]][u[1]].movements);let O;for(O=0;O<ne.length;O+=1){const _e=tt(u,ne,O);V[O]?(V[O].p(_e,h),v(V[O],1)):(V[O]=at(_e),V[O].c(),v(V[O],1),V[O].m(Q.parentNode,Q))}for(me(),O=ne.length;O<V.length;O+=1)ae(O);ce()}u[8].jat[u[0]][u[9]].movements.length>0?L?(L.p(u,h),h[0]&257&&v(L,1)):(L=it(u),L.c(),v(L,1),L.m(ee.parentNode,ee)):L&&(me(),j(L,1,1,()=>{L=null}),ce())},i(u){if(!x){v(C,u),v(l.$$.fragment,u);for(let h=0;h<oe.length;h+=1)v(Z[h]);v(y),v(z);for(let h=0;h<ne.length;h+=1)v(V[h]);v(L),x=!0}},o(u){j(C,u),j(l.$$.fragment,u),Z=Z.filter(Boolean);for(let h=0;h<Z.length;h+=1)j(Z[h]);j(y),j(z),V=V.filter(Boolean);for(let h=0;h<V.length;h+=1)j(V[h]);j(L),x=!1},d(u){u&&(p(e),p(t),p(o),p(r),p(i),p(s),p(m),p(d),p(_),p(g),p(T),p(Q),p(ee)),C&&C.d(u),U(l,u),Ce(Z,u),y&&y.d(u),z&&z.d(u),Ce(V,u),L&&L.d(u)}}}function Tn(n){let e;return{c(){e=G("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Nn(n){let e;return{c(){e=G("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function An(n){let e,l,t;function o(r){n[29](r)}let a={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(a.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new Oe({props:a}),re.push(()=>fe(e,"value",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),t=!0},p(r,i){const s={};!l&&i[0]&263&&(l=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,se(()=>l=!1)),e.$set(s)},i(r){t||(v(e.$$.fragment,r),t=!0)},o(r){j(e.$$.fragment,r),t=!1},d(r){U(e,r)}}}function Pn(n){let e,l,t,o,a,r;return e=new Mn({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),t=new ze({props:{$$slots:{default:[Dn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),a=new Ge({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),a.$on("click",n[12]),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),A(a.$$.fragment)},l(i){P(e.$$.fragment,i),l=q(i),P(t.$$.fragment,i),o=q(i),P(a.$$.fragment,i)},m(i,s){D(e,i,s),k(i,l,s),D(t,i,s),k(i,o,s),D(a,i,s),r=!0},p(i,s){const m={};s[0]&1&&(m.junctionIdx=i[0]),s[0]&2&&(m.stage=i[1]),s[0]&4&&(m.idx=i[2].id.idx),e.$set(m);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:i}),t.$set(c);const d={};s[1]&2&&(d.$$scope={dirty:s,ctx:i}),a.$set(d)},i(i){r||(v(e.$$.fragment,i),v(t.$$.fragment,i),v(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(t.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),U(e,i),U(t,i),U(a,i)}}}function Dn(n){let e;return{c(){e=G("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Un(n){let e;return{c(){e=G("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Bn(n){let e;return{c(){e=G("Zoom to fit")},l(l){e=H(l,"Zoom to fit")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Fn(n){let e;return{c(){e=G("Show scheme context")},l(l){e=H(l,"Show scheme context")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function qn(n){var E;let e,l,t,o,a,r,i,s,m,c,d,_;e=new ve({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),e.$on("click",n[20]),t=new qt({}),a=new zt({});function w($){n[21]($)}let S={map:(E=n[6])==null?void 0:E.getMap()};n[4]!==void 0&&(S.enabled=n[4]),i=new Ot({props:S}),re.push(()=>fe(i,"enabled",w));function I($){n[22]($)}let M={$$slots:{default:[Fn]},$$scope:{ctx:n}};return n[5]!==void 0&&(M.checked=n[5]),c=new Gt({props:M}),re.push(()=>fe(c,"checked",I)),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment),o=F(),A(a.$$.fragment),r=F(),A(i.$$.fragment),m=F(),A(c.$$.fragment)},l($){P(e.$$.fragment,$),l=q($),P(t.$$.fragment,$),o=q($),P(a.$$.fragment,$),r=q($),P(i.$$.fragment,$),m=q($),P(c.$$.fragment,$)},m($,b){D(e,$,b),k($,l,b),D(t,$,b),k($,o,b),D(a,$,b),k($,r,b),D(i,$,b),k($,m,b),D(c,$,b),_=!0},p($,b){var T;const N={};b[1]&2&&(N.$$scope={dirty:b,ctx:$}),e.$set(N);const f={};b[0]&64&&(f.map=(T=$[6])==null?void 0:T.getMap()),!s&&b[0]&16&&(s=!0,f.enabled=$[4],se(()=>s=!1)),i.$set(f);const g={};b[1]&2&&(g.$$scope={dirty:b,ctx:$}),!d&&b[0]&32&&(d=!0,g.checked=$[5],se(()=>d=!1)),c.$set(g)},i($){_||(v(e.$$.fragment,$),v(t.$$.fragment,$),v(a.$$.fragment,$),v(i.$$.fragment,$),v(c.$$.fragment,$),_=!0)},o($){j(e.$$.fragment,$),j(t.$$.fragment,$),j(a.$$.fragment,$),j(i.$$.fragment,$),j(c.$$.fragment,$),_=!1},d($){$&&(p(l),p(o),p(r),p(m)),U(e,$),U(t,$),U(a,$),U(i,$),U(c,$)}}}function lt(n){let e,l;function t(){return n[23](n[37])}function o(){return n[24](n[37])}return e=new qe({props:{name:`${st(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[25]),{c(){A(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,r){D(e,a,r),l=!0},p(a,r){n=a;const i={};r[0]&259&&(i.name=`${st(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(i)},i(a){l||(v(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){U(e,a)}}}function ot(n){let e,l;return e=new ve({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function zn(n){let e,l;return{c(){e=G("Copy arms from "),l=G(n[9])},l(t){e=H(t,"Copy arms from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:Le,d(t){t&&(p(e),p(l))}}}function rt(n){let e,l;return e=new ve({props:{$$slots:{default:[On]},$$scope:{ctx:n}}}),e.$on("click",n[17]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function On(n){let e;return{c(){e=G("Generate cycling movements between all arms (1st arm is the center)")},l(l){e=H(l,"Generate cycling movements between all arms (1st arm is the center)")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Gn(n){let e,l,t,o=n[34].score+"",a,r,i,s=Ve(n[34].kind)+"",m;return{c(){e=R("div"),l=R("span"),t=G("Score: "),a=G(o),r=F(),i=R("span"),m=G(s),this.h()},l(c){e=W(c,"DIV",{style:!0});var d=Y(e);l=W(d,"SPAN",{style:!0});var _=Y(l);t=H(_,"Score: "),a=H(_,o),_.forEach(p),r=q(d),i=W(d,"SPAN",{});var w=Y(i);m=H(w,s),w.forEach(p),d.forEach(p),this.h()},h(){X(l,"padding","4px"),X(l,"color",n[35].font),X(l,"background-color",n[35].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(c,d){k(c,e,d),B(e,l),B(l,t),B(l,a),B(e,r),B(e,i),B(i,m)},p(c,d){d[0]&259&&o!==(o=c[34].score+"")&&ue(a,o),d[0]&259&&X(l,"color",c[35].font),d[0]&259&&X(l,"background-color",c[35].background),d[0]&259&&s!==(s=Ve(c[34].kind)+"")&&ue(m,s)},d(c){c&&p(e)}}}function at(n){let e,l;function t(){return n[26](n[37])}function o(){return n[27](n[37])}return e=new qe({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[Gn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[28]),{c(){A(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,r){D(e,a,r),l=!0},p(a,r){n=a;const i={};r[0]&259&&(i.name=n[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(a){l||(v(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){U(e,a)}}}function it(n){let e,l;return e=new ve({props:{$$slots:{default:[Hn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function Hn(n){let e,l;return{c(){e=G("Copy movements from "),l=G(n[9])},l(t){e=H(t,"Copy movements from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:Le,d(t){t&&(p(e),p(l))}}}function Jn(n){let e,l,t,o,a,r,i,s=de(n[8].jat[n[0]].existing)+"",m,c,d,_=de(n[8].jat[n[0]].proposed)+"",w,S,I,M,E,$,b,N,f,g,T,Q,ee;function x(y){n[19](y)}let J={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(J.value=n[8].jat[n[0]][n[1]].notes),l=new ht({props:J}),re.push(()=>fe(l,"value",x));const C=[In,En],oe=[];function Z(y,z){return y[2].mode!="editing"?0:1}$=Z(n),b=oe[$]=C[$](n);let $e={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showContext:n[5],select:n[10],stopEditing:n[11]};return g=new wn({props:$e}),n[31](g),{c(){e=R("div"),A(l.$$.fragment),o=F(),a=R("p"),r=G("Total JAT score: "),i=R("b"),m=G(s),c=G(`
    existing,
    `),d=R("b"),w=G(_),S=G(`
    proposed`),I=F(),M=R("div"),E=R("div"),b.c(),N=F(),f=R("div"),A(g.$$.fragment),this.h()},l(y){e=W(y,"DIV",{class:!0});var z=Y(e);P(l.$$.fragment,z),o=q(z),a=W(z,"P",{});var ne=Y(a);r=H(ne,"Total JAT score: "),i=W(ne,"B",{});var V=Y(i);m=H(V,s),V.forEach(p),c=H(ne,`
    existing,
    `),d=W(ne,"B",{});var ae=Y(d);w=H(ae,_),ae.forEach(p),S=H(ne,`
    proposed`),ne.forEach(p),z.forEach(p),I=q(y),M=W(y,"DIV",{style:!0});var L=Y(M);E=W(L,"DIV",{style:!0});var u=Y(E);b.l(u),u.forEach(p),N=q(L),f=W(L,"DIV",{style:!0});var h=Y(f);P(g.$$.fragment,h),h.forEach(p),L.forEach(p),this.h()},h(){le(e,"class","govuk-width-container"),X(E,"width","30%"),X(E,"overflow-y","scroll"),X(E,"padding","10px"),X(E,"border","1px solid black"),X(f,"position","relative"),X(f,"width","100%"),X(M,"display","flex"),X(M,"height","80vh")},m(y,z){k(y,e,z),D(l,e,null),B(e,o),B(e,a),B(a,r),B(a,i),B(i,m),B(a,c),B(a,d),B(d,w),B(a,S),k(y,I,z),k(y,M,z),B(M,E),oe[$].m(E,null),n[30](E),B(M,N),B(M,f),D(g,f,null),T=!0,Q||(ee=Ct(yn,"keydown",n[13]),Q=!0)},p(y,z){const ne={};z[0]&2&&(ne.label="Commentary / Notes about "+y[1]+" junction"),!t&&z[0]&259&&(t=!0,ne.value=y[8].jat[y[0]][y[1]].notes,se(()=>t=!1)),l.$set(ne),(!T||z[0]&257)&&s!==(s=de(y[8].jat[y[0]].existing)+"")&&ue(m,s),(!T||z[0]&257)&&_!==(_=de(y[8].jat[y[0]].proposed)+"")&&ue(w,_);let V=$;$=Z(y),$===V?oe[$].p(y,z):(me(),j(oe[V],1,1,()=>{oe[V]=null}),ce(),b=oe[$],b?b.p(y,z):(b=oe[$]=C[$](y),b.c()),v(b,1),b.m(E,null));const ae={};z[0]&1&&(ae.junctionIdx=y[0]),z[0]&2&&(ae.stage=y[1]),z[0]&4&&(ae.mode=y[2]),z[0]&8&&(ae.hoveringSidebar=y[3]),z[0]&16&&(ae.streetviewOn=y[4]),z[0]&32&&(ae.showContext=y[5]),g.$set(ae)},i(y){T||(v(l.$$.fragment,y),v(b),v(g.$$.fragment,y),T=!0)},o(y){j(l.$$.fragment,y),j(b),j(g.$$.fragment,y),T=!1},d(y){y&&(p(e),p(I),p(M)),U(l),oe[$].d(),n[30](null),n[31](null),U(g),Q=!1,ee()}}}function st(n){return String.fromCharCode(n+65)}function Vn(n,e,l){let t;Te(n,te,L=>l(8,t=L));let{$$slots:o={},$$scope:a}=e,{junctionIdx:r}=e,{stage:i}=e,s=i=="existing"?"proposed":"existing",m={mode:"select"},c=null,d=null,_=!1,w=!0,S=null,I;async function M(L){c=I.scrollTop,l(2,m={mode:"editing",id:L}),l(3,d=null),await Je(),l(7,I.scrollTop=0,I)}async function E(){l(2,m={mode:"select"}),c!=null&&(await Je(),l(7,I.scrollTop=c,I),c=null)}function $(){m.mode=="editing"&&window.confirm(`Delete this ${m.id.kind}?`)&&(m.id.kind=="movement"?(t.jat[r][i].movements.splice(m.id.idx,1),te.set(t)):(t.jat[r][i].arms.splice(m.id.idx,1),te.set(t)),E())}function b(L){if(m.mode!="editing")return;let u=L.target.tagName,h=u=="INPUT"||u=="TEXTAREA";L.key=="Escape"||L.key=="Enter"&&!h?(L.stopPropagation(),E()):L.key=="Delete"&&!h&&(L.stopPropagation(),$())}function N(){t.jat[r][i].arms.length>0&&!window.confirm("Overwrite arms?")||(ke(te,t.jat[r][i].arms=JSON.parse(JSON.stringify(t.jat[r][s].arms)),t),te.set(t))}function f(){t.jat[r][i].movements.length>0&&!window.confirm("Overwrite movements?")||(ke(te,t.jat[r][i].movements=JSON.parse(JSON.stringify(t.jat[r][s].movements)),t),te.set(t))}let g={0:pe.red,1:pe.amber,2:pe.green,X:pe.critical};function T(){let[L,...u]=t.jat[r][i].arms;ke(te,t.jat[r][i].movements=Ln(L,u),t)}function Q(L){n.$$.not_equal(t.jat[r][i].notes,L)&&(t.jat[r][i].notes=L,te.set(t))}const ee=()=>S==null?void 0:S.zoom(!0);function x(L){_=L,l(4,_)}function J(L){w=L,l(5,w)}const C=L=>M({kind:"arm",idx:L}),oe=L=>l(3,d={kind:"arm",idx:L}),Z=()=>l(3,d=null),$e=L=>M({kind:"movement",idx:L}),y=L=>l(3,d={kind:"movement",idx:L}),z=()=>l(3,d=null);function ne(L){n.$$.not_equal(t.jat[r][i].arms[m.id.idx].name,L)&&(t.jat[r][i].arms[m.id.idx].name=L,te.set(t))}function V(L){re[L?"unshift":"push"](()=>{I=L,l(7,I)})}function ae(L){re[L?"unshift":"push"](()=>{S=L,l(6,S)})}return n.$$set=L=>{"junctionIdx"in L&&l(0,r=L.junctionIdx),"stage"in L&&l(1,i=L.stage),"$$scope"in L&&l(32,a=L.$$scope)},[r,i,m,d,_,w,S,I,t,s,M,E,$,b,N,f,g,T,o,Q,ee,x,J,C,oe,Z,$e,y,z,ne,V,ae,a]}class Xn extends Se{constructor(e){super(),ye(this,e,Vn,Jn,we,{junctionIdx:0,stage:1},null,[-1,-1])}}function ft(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function Rn(n){let e,l,t=(n[1].jat[n[0].idx].name||"Untitled junction")+"",o,a,r=n[0].stage+"",i,s,m,c,d,_,w,S=n[0].stage,I,M;m=new Mt({props:{$$slots:{default:[Yn]},$$scope:{ctx:n}}});function E(N){n[7](N)}let $={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&($.value=n[1].jat[n[0].idx].name),d=new Oe({props:$}),re.push(()=>fe(d,"value",E));let b=ut(n);return{c(){e=R("div"),l=R("h2"),o=G(t),a=G(" - "),i=G(r),s=F(),A(m.$$.fragment),c=F(),A(d.$$.fragment),w=F(),b.c(),I=ie(),this.h()},l(N){e=W(N,"DIV",{class:!0});var f=Y(e);l=W(f,"H2",{});var g=Y(l);o=H(g,t),a=H(g," - "),i=H(g,r),g.forEach(p),s=q(f),P(m.$$.fragment,f),c=q(f),P(d.$$.fragment,f),f.forEach(p),w=q(N),b.l(N),I=ie(),this.h()},h(){le(e,"class","govuk-width-container")},m(N,f){k(N,e,f),B(e,l),B(l,o),B(l,a),B(l,i),B(e,s),D(m,e,null),B(e,c),D(d,e,null),k(N,w,f),b.m(N,f),k(N,I,f),M=!0},p(N,f){(!M||f&3)&&t!==(t=(N[1].jat[N[0].idx].name||"Untitled junction")+"")&&ue(o,t),(!M||f&1)&&r!==(r=N[0].stage+"")&&ue(i,r);const g={};f&8193&&(g.$$scope={dirty:f,ctx:N}),m.$set(g);const T={};!_&&f&3&&(_=!0,T.value=N[1].jat[N[0].idx].name,se(()=>_=!1)),d.$set(T),f&1&&we(S,S=N[0].stage)?(me(),j(b,1,1,Le),ce(),b=ut(N),b.c(),v(b,1),b.m(I.parentNode,I)):b.p(N,f)},i(N){M||(v(m.$$.fragment,N),v(d.$$.fragment,N),v(b),M=!0)},o(N){j(m.$$.fragment,N),j(d.$$.fragment,N),j(b),M=!1},d(N){N&&(p(e),p(w),p(I)),U(m),U(d),b.d(N)}}}function Wn(n){let e,l,t,o;l=new ze({props:{$$slots:{default:[ll]},$$scope:{ctx:n}}}),l.$on("click",n[2]);let a=ge(n[1].jat),r=[];for(let s=0;s<a.length;s+=1)r[s]=mt(ft(n,a,s));const i=s=>j(r[s],1,1,()=>{r[s]=null});return{c(){e=R("div"),A(l.$$.fragment),t=F();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Y(e);P(l.$$.fragment,m),t=q(m);for(let c=0;c<r.length;c+=1)r[c].l(m);m.forEach(p),this.h()},h(){le(e,"class","govuk-width-container")},m(s,m){k(s,e,m),D(l,e,null),B(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);o=!0},p(s,m){const c={};if(m&8192&&(c.$$scope={dirty:m,ctx:s}),l.$set(c),m&3){a=ge(s[1].jat);let d;for(d=0;d<a.length;d+=1){const _=ft(s,a,d);r[d]?(r[d].p(_,m),v(r[d],1)):(r[d]=mt(_),r[d].c(),v(r[d],1),r[d].m(e,null))}for(me(),d=a.length;d<r.length;d+=1)i(d);ce()}},i(s){if(!o){v(l.$$.fragment,s);for(let m=0;m<a.length;m+=1)v(r[m]);o=!0}},o(s){j(l.$$.fragment,s),r=r.filter(Boolean);for(let m=0;m<r.length;m+=1)j(r[m]);o=!1},d(s){s&&p(e),U(l),Ce(r,s)}}}function Zn(n){let e;return{c(){e=G("Back to all junctions")},l(l){e=H(l,"Back to all junctions")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Kn(n){let e;return{c(){e=G("Delete junction")},l(l){e=H(l,"Delete junction")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Yn(n){let e,l,t,o;return e=new ve({props:{$$slots:{default:[Zn]},$$scope:{ctx:n}}}),e.$on("click",n[5]),t=new Ge({props:{$$slots:{default:[Kn]},$$scope:{ctx:n}}}),t.$on("click",n[6]),{c(){A(e.$$.fragment),l=F(),A(t.$$.fragment)},l(a){P(e.$$.fragment,a),l=q(a),P(t.$$.fragment,a)},m(a,r){D(e,a,r),k(a,l,r),D(t,a,r),o=!0},p(a,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const s={};r&8192&&(s.$$scope={dirty:r,ctx:a}),t.$set(s)},i(a){o||(v(e.$$.fragment,a),v(t.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(t.$$.fragment,a),o=!1},d(a){a&&p(l),U(e,a),U(t,a)}}}function Qn(n){let e,l;return e=new ve({props:{$$slots:{default:[el]},$$scope:{ctx:n}}}),e.$on("click",n[9]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function xn(n){let e,l;return e=new ve({props:{$$slots:{default:[tl]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function el(n){let e;return{c(){e=G("Edit Proposed")},l(l){e=H(l,"Edit Proposed")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function tl(n){let e;return{c(){e=G("Edit Existing")},l(l){e=H(l,"Edit Existing")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function nl(n){let e,l,t=n[0].stage+"",o,a,r,i=n[1].jat[n[0].idx].name+"",s,m,c,d,_,w;const S=[xn,Qn],I=[];function M(E,$){return E[0].stage=="proposed"?0:1}return c=M(n),d=I[c]=S[c](n),{c(){e=R("p"),l=G("Currently editing "),o=G(t),a=G(` junction
        `),r=R("u"),s=G(i),m=F(),d.c(),_=ie()},l(E){e=W(E,"P",{});var $=Y(e);l=H($,"Currently editing "),o=H($,t),a=H($,` junction
        `),r=W($,"U",{});var b=Y(r);s=H(b,i),b.forEach(p),$.forEach(p),m=q(E),d.l(E),_=ie()},m(E,$){k(E,e,$),B(e,l),B(e,o),B(e,a),B(e,r),B(r,s),k(E,m,$),I[c].m(E,$),k(E,_,$),w=!0},p(E,$){(!w||$&1)&&t!==(t=E[0].stage+"")&&ue(o,t),(!w||$&3)&&i!==(i=E[1].jat[E[0].idx].name+"")&&ue(s,i);let b=c;c=M(E),c===b?I[c].p(E,$):(me(),j(I[b],1,1,()=>{I[b]=null}),ce(),d=I[c],d?d.p(E,$):(d=I[c]=S[c](E),d.c()),v(d,1),d.m(_.parentNode,_))},i(E){w||(v(d),w=!0)},o(E){j(d),w=!1},d(E){E&&(p(e),p(m),p(_)),I[c].d(E)}}}function ut(n){let e,l;return e=new Xn({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[nl]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(t){P(e.$$.fragment,t)},m(t,o){D(e,t,o),l=!0},p(t,o){const a={};o&1&&(a.junctionIdx=t[0].idx),o&1&&(a.stage=t[0].stage),o&8195&&(a.$$scope={dirty:o,ctx:t}),e.$set(a)},i(t){l||(v(e.$$.fragment,t),l=!0)},o(t){j(e.$$.fragment,t),l=!1},d(t){U(e,t)}}}function ll(n){let e;return{c(){e=G("Add new junction")},l(l){e=H(l,"Add new junction")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function ol(n){let e,l,t,o=de(n[10].existing)+"",a,r,i,s,m=de(n[10].proposed)+"",c,d;return{c(){e=R("div"),l=R("span"),t=G("Existing: "),a=G(o),r=F(),i=R("span"),s=G("Proposed: "),c=G(m),d=F(),this.h()},l(_){e=W(_,"DIV",{style:!0});var w=Y(e);l=W(w,"SPAN",{});var S=Y(l);t=H(S,"Existing: "),a=H(S,o),S.forEach(p),r=q(w),i=W(w,"SPAN",{});var I=Y(i);s=H(I,"Proposed: "),c=H(I,m),I.forEach(p),w.forEach(p),d=q(_),this.h()},h(){X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(_,w){k(_,e,w),B(e,l),B(l,t),B(l,a),B(e,r),B(e,i),B(i,s),B(i,c),k(_,d,w)},p(_,w){w&2&&o!==(o=de(_[10].existing)+"")&&ue(a,o),w&2&&m!==(m=de(_[10].proposed)+"")&&ue(c,m)},d(_){_&&(p(e),p(d))}}}function mt(n){let e,l;function t(){return n[4](n[12])}return e=new qe({props:{name:n[10].name||"Untitled junction",$$slots:{default:[ol]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){A(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,a){D(e,o,a),l=!0},p(o,a){n=o;const r={};a&2&&(r.name=n[10].name||"Untitled junction"),a&8194&&(r.$$scope={dirty:a,ctx:n}),e.$set(r)},i(o){l||(v(e.$$.fragment,o),l=!0)},o(o){j(e.$$.fragment,o),l=!1},d(o){U(e,o)}}}function rl(n){let e,l,t,o;const a=[Wn,Rn],r=[];function i(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=i(n))&&(l=r[e]=a[e](n)),{c(){l&&l.c(),t=ie()},l(s){l&&l.l(s),t=ie()},m(s,m){~e&&r[e].m(s,m),k(s,t,m),o=!0},p(s,[m]){let c=e;e=i(s),e===c?~e&&r[e].p(s,m):(l&&(me(),j(r[c],1,1,()=>{r[c]=null}),ce()),~e?(l=r[e],l?l.p(s,m):(l=r[e]=a[e](s),l.c()),v(l,1),l.m(t.parentNode,t)):l=null)},i(s){o||(v(l),o=!0)},o(s){j(l),o=!1},d(s){s&&p(t),~e&&r[e].d(s)}}}function De(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function al(n,e,l){let t;Te(n,te,w=>l(1,t=w));let o={kind:"list"};function a(){ke(te,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),l(0,o={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function r(w){window.confirm("Delete this junction?")&&(t.jat.splice(w,1),te.set(t),l(0,o={kind:"list"}))}const i=w=>l(0,o={kind:"edit",idx:w,stage:"existing"}),s=()=>l(0,o={kind:"list"}),m=()=>r(De(o));function c(w){n.$$.not_equal(t.jat[o.idx].name,w)&&(t.jat[o.idx].name=w,te.set(t))}return[o,t,a,r,i,s,m,c,()=>l(0,o={kind:"edit",idx:De(o),stage:"existing"}),()=>l(0,o={kind:"edit",idx:De(o),stage:"proposed"})]}class yl extends Se{constructor(e){super(),ye(this,e,al,rl,we,{})}}export{yl as component};
