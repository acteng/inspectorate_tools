import{s as we,w as ee,x as oe,l as pt,u as $t,r as ht,v as kt,D as be,k as Ae,R as bt,T as ve,a as U,g as F,i as S,f as b,G as ye,n as je,e as te,t as J,c as ne,b as re,d as K,p as $e,q as V,h as Q,j as _e,B as vt,W as wt,F as de,m as Ge}from"../chunks/scheduler.D5JRtHaf.js";import{S as Ie,i as Te,e as le,c as N,a as A,m as P,t as k,b as C,d as z,g as se,f as fe}from"../chunks/index.Xm1AgzMF.js";import{e as ce}from"../chunks/each.C9BadmQM.js";import{C as Ue,B as jt}from"../chunks/ClickableCard.BhW8XYpY.js";import{D as ft}from"../chunks/DefaultButton.BHwS446X.js";import{S as he}from"../chunks/SecondaryButton.DxO4nu9r.js";/* empty css                                                    */import{T as Fe}from"../chunks/TextInput.Cluermb4.js";import{W as ut}from"../chunks/WarningButton.jEqntaGg.js";import{s as X}from"../chunks/data.B_wxjxMs.js";import{L as Ct,a as Mt,d as pe,t as Lt,v as St,w as ze,M as yt,b as It,C as Tt,G as He,x as De,y as Je,m as Et,P as mt,l as Nt}from"../chunks/index.i9EXcxqq.js";import{c as Ke}from"../chunks/index.COPICGVb.js";import{g as qe,t as At}from"../chunks/index.C0fJjsl8.js";import{c as ge}from"../chunks/colors.DaC397qr.js";import{G as Pt}from"../chunks/GeoreferenceLayer.B3G7RaiM.js";import{a as zt,M as Ee,B as Dt,G as qt,S as Bt,C as Ut}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.BIPt44Lz.js";import{C as Ft}from"../chunks/CollapsibleCard.D0GavHKp.js";import{R as Be}from"../chunks/Radio.BjpWuuOn.js";import{T as ct}from"../chunks/TextArea.Ct1XwDet.js";import"../chunks/paths.DewGt5Pb.js";function Ot(n){let e;const o=n[16].default,t=pt(o,n,n[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,r){t&&t.m(l,r),e=!0},p(l,r){t&&t.p&&(!e||r&16777216)&&$t(t,o,l,l[24],e?kt(o,l[24],r,null):ht(l[24]),null)},i(l){e||(k(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function Gt(n){let e,o,t;function l(a){n[17](a)}let r={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Ot]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.hovered=n[0]),e=new Ct({props:r}),ee.push(()=>le(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,[s]){const i={};s&2&&(i.id=a[1]),s&4&&(i.source=a[2]),s&8&&(i.sourceLayer=a[3]),s&16&&(i.beforeId=a[4]),s&32&&(i.beforeLayerType=a[5]),s&64&&(i.paint=a[6]),s&128&&(i.layout=a[7]),s&256&&(i.filter=a[8]),s&512&&(i.applyToClusters=a[9]),s&1024&&(i.minzoom=a[10]),s&2048&&(i.maxzoom=a[11]),s&4096&&(i.hoverCursor=a[12]),s&8192&&(i.manageHoverState=a[13]),s&16384&&(i.eventsIfTopMost=a[14]),s&32768&&(i.interactive=a[15]),s&16777216&&(i.$$scope={dirty:s,ctx:a}),!o&&s&1&&(o=!0,i.hovered=a[0],oe(()=>o=!1)),e.$set(i)},i(a){t||(k(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Ht(n,e,o){let{$$slots:t={},$$scope:l}=e,{id:r=Mt("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:i=void 0}=e,{beforeLayerType:_=void 0}=e,{paint:g=void 0}=e,{layout:m=void 0}=e,{filter:u=void 0}=e,{applyToClusters:M=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:E=!1}=e,{hovered:w=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:p=!0}=e;function d(T){w=T,o(0,w)}function j(T){be.call(this,n,T)}function v(T){be.call(this,n,T)}function q(T){be.call(this,n,T)}function I(T){be.call(this,n,T)}function O(T){be.call(this,n,T)}function Y(T){be.call(this,n,T)}return n.$$set=T=>{"id"in T&&o(1,r=T.id),"source"in T&&o(2,a=T.source),"sourceLayer"in T&&o(3,s=T.sourceLayer),"beforeId"in T&&o(4,i=T.beforeId),"beforeLayerType"in T&&o(5,_=T.beforeLayerType),"paint"in T&&o(6,g=T.paint),"layout"in T&&o(7,m=T.layout),"filter"in T&&o(8,u=T.filter),"applyToClusters"in T&&o(9,M=T.applyToClusters),"minzoom"in T&&o(10,L=T.minzoom),"maxzoom"in T&&o(11,D=T.maxzoom),"hoverCursor"in T&&o(12,B=T.hoverCursor),"manageHoverState"in T&&o(13,E=T.manageHoverState),"hovered"in T&&o(0,w=T.hovered),"eventsIfTopMost"in T&&o(14,f=T.eventsIfTopMost),"interactive"in T&&o(15,p=T.interactive),"$$scope"in T&&o(24,l=T.$$scope)},[w,r,a,s,i,_,g,m,u,M,L,D,B,E,f,p,t,d,j,v,q,I,O,Y,l]}class Jt extends Ie{constructor(e){super(),Te(this,e,Ht,Gt,we,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Kt=Object.defineProperty,Rt=(n,e)=>Kt(n,"name",{value:e,configurable:!0});function _t(n,e,o,t={}){const l=qe(n),r=pe(l[0]),a=pe(l[1]),s=pe(o),i=Lt(e,t.units),_=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(s)),g=r+Math.atan2(Math.sin(s)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(_)),m=ze(g),u=ze(_);return St([m,u],t.properties)}Rt(_t,"destination");var Se=_t,Vt=Object.defineProperty,gt=(n,e)=>Vt(n,"name",{value:e,configurable:!0});function Oe(n,e,o={}){if(o.final===!0)return dt(n,e);const t=qe(n),l=qe(e),r=pe(t[0]),a=pe(l[0]),s=pe(t[1]),i=pe(l[1]),_=Math.sin(a-r)*Math.cos(i),g=Math.cos(s)*Math.sin(i)-Math.sin(s)*Math.cos(i)*Math.cos(a-r);return ze(Math.atan2(_,g))}gt(Oe,"bearing");function dt(n,e){let o=Oe(e,n);return o=(o+180)%360,o}gt(dt,"calculateFinalBearing");var Ne=Oe;function Re(n,e,o){const t=n.slice();return t[35]=e[o],t[36]=e,t[37]=o,t}function Ve(n,e,o){const t=n.slice();return t[38]=e[o],t[39]=e,t[37]=o,t}function Xt(n){let e,o=an(n[37])+"",t;return{c(){e=te("span"),t=J(o),this.h()},l(l){e=ne(l,"SPAN",{class:!0});var r=re(e);t=K(r,o),r.forEach(b),this.h()},h(){$e(e,"class","dot svelte-1qktznf"),V(e,"color","#4472c4"),V(e,"background-color","white")},m(l,r){S(l,e,r),Q(e,t)},p:je,d(l){l&&b(e)}}}function Xe(n){let e,o,t;function l(i){n[18](i,n[38])}function r(){return n[19](n[37])}function a(){return n[20](n[37])}let s={draggable:!0,$$slots:{default:[Xt]},$$scope:{ctx:n}};return n[38].point!==void 0&&(s.lngLat=n[38].point),e=new Ee({props:s}),ee.push(()=>le(e,"lngLat",l)),e.$on("dragend",r),e.$on("click",a),{c(){N(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,_){P(e,i,_),t=!0},p(i,_){n=i;const g={};_[1]&512&&(g.$$scope={dirty:_,ctx:n}),!o&&_[0]&19&&(o=!0,g.lngLat=n[38].point,oe(()=>o=!1)),e.$set(g)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function Wt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),re(e).forEach(b),this.h()},h(){$e(e,"class","dot svelte-1qktznf"),V(e,"background-color",n[7][n[35].score]),V(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},m(o,t){S(o,e,t)},p(o,t){t[0]&19&&V(e,"background-color",o[7][o[35].score]),t[0]&19&&V(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&b(e)}}}function Zt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),re(e).forEach(b),this.h()},h(){$e(e,"class","dot svelte-1qktznf"),V(e,"background-color",n[7][n[35].score])},m(o,t){S(o,e,t)},p(o,t){t[0]&19&&V(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Qt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),re(e).forEach(b),this.h()},h(){$e(e,"class","dot svelte-1qktznf"),V(e,"background-color",n[7][n[35].score]),V(e,"opacity","0%")},m(o,t){S(o,e,t)},p(o,t){t[0]&19&&V(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function We(n){let e,o,t,l,r,a,s,i,_;function g(j){n[21](j,n[35])}function m(){return n[22](n[37])}function u(){return n[23](n[37])}let M={draggable:!0,$$slots:{default:[Wt]},$$scope:{ctx:n}};n[35].point1!==void 0&&(M.lngLat=n[35].point1),e=new Ee({props:M}),ee.push(()=>le(e,"lngLat",g)),e.$on("dragend",m),e.$on("click",u);function L(j){n[24](j,n[35])}function D(){return n[25](n[37])}function B(){return n[26](n[37])}let E={draggable:!0,$$slots:{default:[Zt]},$$scope:{ctx:n}};n[35].point2!==void 0&&(E.lngLat=n[35].point2),l=new Ee({props:E}),ee.push(()=>le(l,"lngLat",L)),l.$on("dragend",D),l.$on("click",B);function w(j){n[27](j,n[35])}function f(){return n[28](n[37])}function p(){return n[29](n[37])}let d={draggable:!0,$$slots:{default:[Qt]},$$scope:{ctx:n}};return n[35].point3!==void 0&&(d.lngLat=n[35].point3),s=new Ee({props:d}),ee.push(()=>le(s,"lngLat",w)),s.$on("dragend",f),s.$on("click",p),{c(){N(e.$$.fragment),t=U(),N(l.$$.fragment),a=U(),N(s.$$.fragment)},l(j){A(e.$$.fragment,j),t=F(j),A(l.$$.fragment,j),a=F(j),A(s.$$.fragment,j)},m(j,v){P(e,j,v),S(j,t,v),P(l,j,v),S(j,a,v),P(s,j,v),_=!0},p(j,v){n=j;const q={};v[0]&19|v[1]&512&&(q.$$scope={dirty:v,ctx:n}),!o&&v[0]&19&&(o=!0,q.lngLat=n[35].point1,oe(()=>o=!1)),e.$set(q);const I={};v[0]&19|v[1]&512&&(I.$$scope={dirty:v,ctx:n}),!r&&v[0]&19&&(r=!0,I.lngLat=n[35].point2,oe(()=>r=!1)),l.$set(I);const O={};v[0]&19|v[1]&512&&(O.$$scope={dirty:v,ctx:n}),!i&&v[0]&19&&(i=!0,O.lngLat=n[35].point3,oe(()=>i=!1)),s.$set(O)},i(j){_||(k(e.$$.fragment,j),k(l.$$.fragment,j),k(s.$$.fragment,j),_=!0)},o(j){C(e.$$.fragment,j),C(l.$$.fragment,j),C(s.$$.fragment,j),_=!1},d(j){j&&(b(t),b(a)),z(e,j),z(l,j),z(s,j)}}}function Yt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=J(e)},l(t){o=K(t,e)},m(t,l){S(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&_e(o,e)},d(t){t&&b(o)}}}function xt(n){let e,o;return e=new mt({props:{$$slots:{default:[Yt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function en(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=J(e)},l(t){o=K(t,e)},m(t,l){S(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&_e(o,e)},d(t){t&&b(o)}}}function tn(n){let e,o;return e=new mt({props:{$$slots:{default:[en,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function nn(n){let e,o,t,l,r,a;return e=new De({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Je(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[xt]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new De({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Je(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[tn]},$$scope:{ctx:n}}}),t.$on("click",n[9]),r=new Jt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U(),N(r.$$.fragment)},l(s){A(e.$$.fragment,s),o=F(s),A(t.$$.fragment,s),l=F(s),A(r.$$.fragment,s)},m(s,i){P(e,s,i),S(s,o,i),P(t,s,i),S(s,l,i),P(r,s,i),a=!0},p(s,i){const _={};i[1]&512&&(_.$$scope={dirty:i,ctx:s}),e.$set(_);const g={};i[1]&512&&(g.$$scope={dirty:i,ctx:s}),t.$set(g)},i(s){a||(k(e.$$.fragment,s),k(t.$$.fragment,s),k(r.$$.fragment,s),a=!0)},o(s){C(e.$$.fragment,s),C(t.$$.fragment,s),C(r.$$.fragment,s),a=!1},d(s){s&&(b(o),b(l)),z(e,s),z(t,s),z(r,s)}}}function on(n){let e,o,t,l;return e=new De({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Et({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment)},l(r){A(e.$$.fragment,r),o=F(r),A(t.$$.fragment,r)},m(r,a){P(e,r,a),S(r,o,a),P(t,r,a),l=!0},p:je,i(r){l||(k(e.$$.fragment,r),k(t.$$.fragment,r),l=!0)},o(r){C(e.$$.fragment,r),C(t.$$.fragment,r),l=!1},d(r){r&&b(o),z(e,r),z(t,r)}}}function ln(n){let e,o,t,l,r,a,s,i,_,g,m,u;e=new zt({}),e.$on("click",n[8]),t=new Tt({props:{gj:n[4].summary.networkMap,show:n[2]}});let M=ce(n[4].jat[n[0]][n[1]].arms),L=[];for(let f=0;f<M.length;f+=1)L[f]=Xe(Ve(n,M,f));const D=f=>C(L[f],1,1,()=>{L[f]=null});let B=ce(n[4].jat[n[0]][n[1]].movements),E=[];for(let f=0;f<B.length;f+=1)E[f]=We(Re(n,B,f));const w=f=>C(E[f],1,1,()=>{E[f]=null});return s=new He({props:{data:n[10](n[4]),$$slots:{default:[nn]},$$scope:{ctx:n}}}),_=new He({props:{data:n[6],$$slots:{default:[on]},$$scope:{ctx:n}}}),m=new Pt({props:{map:n[5]}}),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U();for(let f=0;f<L.length;f+=1)L[f].c();r=U();for(let f=0;f<E.length;f+=1)E[f].c();a=U(),N(s.$$.fragment),i=U(),N(_.$$.fragment),g=U(),N(m.$$.fragment)},l(f){A(e.$$.fragment,f),o=F(f),A(t.$$.fragment,f),l=F(f);for(let p=0;p<L.length;p+=1)L[p].l(f);r=F(f);for(let p=0;p<E.length;p+=1)E[p].l(f);a=F(f),A(s.$$.fragment,f),i=F(f),A(_.$$.fragment,f),g=F(f),A(m.$$.fragment,f)},m(f,p){P(e,f,p),S(f,o,p),P(t,f,p),S(f,l,p);for(let d=0;d<L.length;d+=1)L[d]&&L[d].m(f,p);S(f,r,p);for(let d=0;d<E.length;d+=1)E[d]&&E[d].m(f,p);S(f,a,p),P(s,f,p),S(f,i,p),P(_,f,p),S(f,g,p),P(m,f,p),u=!0},p(f,p){const d={};if(p[0]&16&&(d.gj=f[4].summary.networkMap),p[0]&4&&(d.show=f[2]),t.$set(d),p[0]&27){M=ce(f[4].jat[f[0]][f[1]].arms);let I;for(I=0;I<M.length;I+=1){const O=Ve(f,M,I);L[I]?(L[I].p(O,p),k(L[I],1)):(L[I]=Xe(O),L[I].c(),k(L[I],1),L[I].m(r.parentNode,r))}for(se(),I=M.length;I<L.length;I+=1)D(I);fe()}if(p[0]&155){B=ce(f[4].jat[f[0]][f[1]].movements);let I;for(I=0;I<B.length;I+=1){const O=Re(f,B,I);E[I]?(E[I].p(O,p),k(E[I],1)):(E[I]=We(O),E[I].c(),k(E[I],1),E[I].m(a.parentNode,a))}for(se(),I=B.length;I<E.length;I+=1)w(I);fe()}const j={};p[0]&16&&(j.data=f[10](f[4])),p[1]&512&&(j.$$scope={dirty:p,ctx:f}),s.$set(j);const v={};p[0]&64&&(v.data=f[6]),p[1]&512&&(v.$$scope={dirty:p,ctx:f}),_.$set(v);const q={};p[0]&32&&(q.map=f[5]),m.$set(q)},i(f){if(!u){k(e.$$.fragment,f),k(t.$$.fragment,f);for(let p=0;p<M.length;p+=1)k(L[p]);for(let p=0;p<B.length;p+=1)k(E[p]);k(s.$$.fragment,f),k(_.$$.fragment,f),k(m.$$.fragment,f),u=!0}},o(f){C(e.$$.fragment,f),C(t.$$.fragment,f),L=L.filter(Boolean);for(let p=0;p<L.length;p+=1)C(L[p]);E=E.filter(Boolean);for(let p=0;p<E.length;p+=1)C(E[p]);C(s.$$.fragment,f),C(_.$$.fragment,f),C(m.$$.fragment,f),u=!1},d(f){f&&(b(o),b(l),b(r),b(a),b(i),b(g)),z(e,f),z(t,f),ye(L,f),ye(E,f),z(s,f),z(_,f),z(m,f)}}}function rn(n){let e,o,t;function l(a){n[30](a)}let r={$$slots:{default:[ln]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.map=n[5]),e=new yt({props:r}),ee.push(()=>le(e,"map",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};s[0]&127|s[1]&512&&(i.$$scope={dirty:s,ctx:a}),!o&&s[0]&32&&(o=!0,i.map=a[5],oe(()=>o=!1)),e.$set(i)},i(a){t||(k(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Ze(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function an(n){return String.fromCharCode(n+65)}function sn(n,e,o){let t,l;Ae(n,X,h=>o(4,l=h));let{junctionIdx:r}=e,{stage:a}=e,{newKind:s}=e,{editing:i}=e,{hoveringSidebar:_}=e,{streetviewOn:g}=e,{showContext:m}=e,{select:u}=e,{stopEditing:M}=e,L,D={0:ge.red.background,1:ge.amber.background,2:ge.green.background,X:ge.critical.background};function B(h,$,x){let G={type:"FeatureCollection",features:[]},c=$??x;return c!=null&&(c.kind=="arm"?G.features.push(Ze(h.jat[r][a].arms[c.idx],c.idx)):G.features.push(p(h.jat[r][a].movements[c.idx],c.idx))),G}async function E(h){if(!g){for(let $ of L.queryRenderedFeatures(h.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i!=null){await M();return}s=="arm"?(ve(X,l.jat[r][a].arms=[...l.jat[r][a].arms,{point:h.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[r][a].arms.length-1})):(ve(X,l.jat[r][a].movements=[...l.jat[r][a].movements,{point1:h.detail.lngLat.toArray(),point2:Se(h.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Se(h.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[r][a].movements.length-1}))}}async function w(h){await u({kind:"movement",idx:h.detail.features[0].id})}bt(()=>{j(!1)});function f(h){let $={type:"FeatureCollection",features:h.jat[r][a].movements.map((x,G)=>p(x,G))};for(let x of h.jat[r][a].movements)if($.features.push(d(x,$.features.length)),x.kind=="walking & wheeling"){let G={...x,point1:x.point3,point3:x.point1};$.features.push(d(G,$.features.length))}return $}function p(h,$){return{type:"Feature",id:$,properties:{name:h.name,kind:h.kind,color:D[h.score]},geometry:{type:"LineString",coordinates:[h.point1,h.point2,h.point3]}}}function d(h,$){return{type:"Feature",id:$,properties:{kind:h.kind,color:D[h.score],angle:Ne(h.point2,h.point3)},geometry:{type:"Point",coordinates:h.point3}}}function j(h){let $=f(l);for(let x of l.jat[r][a].arms)$.features.push(Ze(x,$.features.length));for(let x of l.summary.networkMap.features)$.features.push(x);$.features.length>0&&L.fitBounds(It($),{padding:20,animate:h})}function v(){return L}function q(h,$){n.$$.not_equal($.point,h)&&($.point=h,X.set(l))}const I=h=>u({kind:"arm",idx:h}),O=h=>u({kind:"arm",idx:h});function Y(h,$){n.$$.not_equal($.point1,h)&&($.point1=h,X.set(l))}const T=h=>u({kind:"movement",idx:h}),ae=h=>u({kind:"movement",idx:h});function Ce(h,$){n.$$.not_equal($.point2,h)&&($.point2=h,X.set(l))}const ke=h=>u({kind:"movement",idx:h}),ue=h=>u({kind:"movement",idx:h});function R(h,$){n.$$.not_equal($.point3,h)&&($.point3=h,X.set(l))}const Me=h=>u({kind:"movement",idx:h}),W=h=>u({kind:"movement",idx:h});function Z(h){L=h,o(5,L)}return n.$$set=h=>{"junctionIdx"in h&&o(0,r=h.junctionIdx),"stage"in h&&o(1,a=h.stage),"newKind"in h&&o(11,s=h.newKind),"editing"in h&&o(12,i=h.editing),"hoveringSidebar"in h&&o(13,_=h.hoveringSidebar),"streetviewOn"in h&&o(14,g=h.streetviewOn),"showContext"in h&&o(2,m=h.showContext),"select"in h&&o(3,u=h.select),"stopEditing"in h&&o(15,M=h.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&12304&&o(6,t=B(l,i,_))},[r,a,m,u,l,L,t,D,E,w,f,s,i,_,g,M,j,v,q,I,O,Y,T,ae,Ce,ke,ue,R,Me,W,Z]}class fn extends Ie{constructor(e){super(),Te(this,e,sn,rn,we,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function un(n){let e,o,t,l,r,a,s,i,_,g,m,u;function M(d){n[5](d)}let L={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(L.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Fe({props:L}),ee.push(()=>le(e,"value",M));function D(d){n[6](d)}let B={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(B.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new Be({props:B}),ee.push(()=>le(l,"value",D));function E(d){n[7](d)}let w={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(w.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new Be({props:w}),ee.push(()=>le(s,"value",E));function f(d){n[8](d)}let p={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(p.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),g=new ct({props:p}),ee.push(()=>le(g,"value",f)),{c(){N(e.$$.fragment),t=U(),N(l.$$.fragment),a=U(),N(s.$$.fragment),_=U(),N(g.$$.fragment)},l(d){A(e.$$.fragment,d),t=F(d),A(l.$$.fragment,d),a=F(d),A(s.$$.fragment,d),_=F(d),A(g.$$.fragment,d)},m(d,j){P(e,d,j),S(d,t,j),P(l,d,j),S(d,a,j),P(s,d,j),S(d,_,j),P(g,d,j),u=!0},p(d,[j]){const v={};!o&&j&15&&(o=!0,v.value=d[3].jat[d[0]][d[1]].movements[d[2]].name,oe(()=>o=!1)),e.$set(v);const q={};!r&&j&15&&(r=!0,q.value=d[3].jat[d[0]][d[1]].movements[d[2]].kind,oe(()=>r=!1)),l.$set(q);const I={};!i&&j&15&&(i=!0,I.value=d[3].jat[d[0]][d[1]].movements[d[2]].score,oe(()=>i=!1)),s.$set(I);const O={};!m&&j&15&&(m=!0,O.value=d[3].jat[d[0]][d[1]].movements[d[2]].notes,oe(()=>m=!1)),g.$set(O)},i(d){u||(k(e.$$.fragment,d),k(l.$$.fragment,d),k(s.$$.fragment,d),k(g.$$.fragment,d),u=!0)},o(d){C(e.$$.fragment,d),C(l.$$.fragment,d),C(s.$$.fragment,d),C(g.$$.fragment,d),u=!1},d(d){d&&(b(t),b(a),b(_)),z(e,d),z(l,d),z(s,d),z(g,d)}}}function mn(n,e,o){let t;Ae(n,X,u=>o(3,t=u));let{junctionIdx:l}=e,{stage:r}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function i(u){n.$$.not_equal(t.jat[l][r].movements[a].name,u)&&(t.jat[l][r].movements[a].name=u,X.set(t))}function _(u){n.$$.not_equal(t.jat[l][r].movements[a].kind,u)&&(t.jat[l][r].movements[a].kind=u,X.set(t))}function g(u){n.$$.not_equal(t.jat[l][r].movements[a].score,u)&&(t.jat[l][r].movements[a].score=u,X.set(t))}function m(u){n.$$.not_equal(t.jat[l][r].movements[a].notes,u)&&(t.jat[l][r].movements[a].notes=u,X.set(t))}return n.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,r=u.stage),"idx"in u&&o(2,a=u.idx)},[l,r,a,t,s,i,_,g,m]}class cn extends Ie{constructor(e){super(),Te(this,e,mn,un,we,{junctionIdx:0,stage:1,idx:2})}}function _n(n,e){let o=.003,t=(r,a)=>{let s=e[r].point,_=Ne(s,n.point)-90,g=o*a;return Se(s,g,_).geometry.coordinates},l=[];for(let r=0;r<e.length;r++){let a=1;for(let s=0;s<e.length;s++){if(r==s)continue;let i=e[r],_=e[s],g=Ne(i.point,n.point),m=Ne(n.point,_.point),u=t(r,a++),M=At(i.point,n.point),L=Se(u,.5*M,g).geometry.coordinates,D=Se(L,.2*M,m).geometry.coordinates;l.push({point1:u,point2:L,point3:D,kind:"cycling",score:"0",name:`${i.name} to ${_.name}`,notes:""})}}return l}const{window:gn}=Nt;function Qe(n,e,o){const t=n.slice();t[35]=e[o],t[38]=o;const l=t[17][t[35].score];return t[36]=l,t}function Ye(n,e,o){const t=n.slice();return t[39]=e[o],t[38]=o,t}function dn(n){let e,o,t,l,r,a,s,i;e=new ft({props:{$$slots:{default:[$n]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new ut({props:{$$slots:{default:[hn]},$$scope:{ctx:n}}}),t.$on("click",n[13]);const _=[bn,kn],g=[];function m(u,M){return u[3].kind=="movement"?0:1}return r=m(n),a=g[r]=_[r](n),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U(),a.c(),s=de()},l(u){A(e.$$.fragment,u),o=F(u),A(t.$$.fragment,u),l=F(u),a.l(u),s=de()},m(u,M){P(e,u,M),S(u,o,M),P(t,u,M),S(u,l,M),g[r].m(u,M),S(u,s,M),i=!0},p(u,M){const L={};M[1]&1024&&(L.$$scope={dirty:M,ctx:u}),e.$set(L);const D={};M[1]&1024&&(D.$$scope={dirty:M,ctx:u}),t.$set(D);let B=r;r=m(u),r===B?g[r].p(u,M):(se(),C(g[B],1,1,()=>{g[B]=null}),fe(),a=g[r],a?a.p(u,M):(a=g[r]=_[r](u),a.c()),k(a,1),a.m(s.parentNode,s))},i(u){i||(k(e.$$.fragment,u),k(t.$$.fragment,u),k(a),i=!0)},o(u){C(e.$$.fragment,u),C(t.$$.fragment,u),C(a),i=!1},d(u){u&&(b(o),b(l),b(s)),z(e,u),z(t,u),g[r].d(u)}}}function pn(n){let e,o,t,l,r,a,s,i=(n[9].jat[n[0]].name||"Untitled junction")+"",_,g,m,u,M,L,D,B="Arms",E,w,f,p,d="Movements",j,v,q,I,O;e=new Ft({props:{label:"Tools",$$slots:{default:[jn]},$$scope:{ctx:n}}});function Y(c,y){return c[9].jat[c[0]][c[1]].movements.length>0?Mn:Cn}let T=Y(n),ae=T(n);function Ce(c){n[23](c)}let ke={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};n[2]!==void 0&&(ke.value=n[2]),u=new Be({props:ke}),ee.push(()=>le(u,"value",Ce));let ue=ce(n[9].jat[n[0]][n[1]].arms),R=[];for(let c=0;c<ue.length;c+=1)R[c]=xe(Ye(n,ue,c));const Me=c=>C(R[c],1,1,()=>{R[c]=null});let W=n[9].jat[n[0]][n[10]].arms.length>0&&et(n),Z=n[9].jat[n[0]][n[1]].arms.length>0&&tt(n),h=ce(n[9].jat[n[0]][n[1]].movements),$=[];for(let c=0;c<h.length;c+=1)$[c]=nt(Qe(n,h,c));const x=c=>C($[c],1,1,()=>{$[c]=null});let G=n[9].jat[n[0]][n[10]].movements.length>0&&ot(n);return{c(){N(e.$$.fragment),o=U(),t=te("p"),l=J("Total JAT score for "),r=J(n[1]),a=U(),s=te("u"),_=J(i),g=J(`
        :
        `),ae.c(),m=U(),N(u.$$.fragment),L=U(),D=te("h3"),D.textContent=B,E=U();for(let c=0;c<R.length;c+=1)R[c].c();w=U(),W&&W.c(),f=U(),p=te("h3"),p.textContent=d,j=U(),Z&&Z.c(),v=U();for(let c=0;c<$.length;c+=1)$[c].c();q=U(),G&&G.c(),I=de()},l(c){A(e.$$.fragment,c),o=F(c),t=ne(c,"P",{});var y=re(t);l=K(y,"Total JAT score for "),r=K(y,n[1]),a=F(y),s=ne(y,"U",{});var ie=re(s);_=K(ie,i),ie.forEach(b),g=K(y,`
        :
        `),ae.l(y),y.forEach(b),m=F(c),A(u.$$.fragment,c),L=F(c),D=ne(c,"H3",{"data-svelte-h":!0}),Ge(D)!=="svelte-ld74qb"&&(D.textContent=B),E=F(c);for(let me=0;me<R.length;me+=1)R[me].l(c);w=F(c),W&&W.l(c),f=F(c),p=ne(c,"H3",{"data-svelte-h":!0}),Ge(p)!=="svelte-1dc52s8"&&(p.textContent=d),j=F(c),Z&&Z.l(c),v=F(c);for(let me=0;me<$.length;me+=1)$[me].l(c);q=F(c),G&&G.l(c),I=de()},m(c,y){P(e,c,y),S(c,o,y),S(c,t,y),Q(t,l),Q(t,r),Q(t,a),Q(t,s),Q(s,_),Q(t,g),ae.m(t,null),S(c,m,y),P(u,c,y),S(c,L,y),S(c,D,y),S(c,E,y);for(let ie=0;ie<R.length;ie+=1)R[ie]&&R[ie].m(c,y);S(c,w,y),W&&W.m(c,y),S(c,f,y),S(c,p,y),S(c,j,y),Z&&Z.m(c,y),S(c,v,y);for(let ie=0;ie<$.length;ie+=1)$[ie]&&$[ie].m(c,y);S(c,q,y),G&&G.m(c,y),S(c,I,y),O=!0},p(c,y){const ie={};y[0]&224|y[1]&1024&&(ie.$$scope={dirty:y,ctx:c}),e.$set(ie),(!O||y[0]&2)&&_e(r,c[1]),(!O||y[0]&513)&&i!==(i=(c[9].jat[c[0]].name||"Untitled junction")+"")&&_e(_,i),T===(T=Y(c))&&ae?ae.p(c,y):(ae.d(1),ae=T(c),ae&&(ae.c(),ae.m(t,null)));const me={};if(!M&&y[0]&4&&(M=!0,me.value=c[2],oe(()=>M=!1)),u.$set(me),y[0]&2579){ue=ce(c[9].jat[c[0]][c[1]].arms);let H;for(H=0;H<ue.length;H+=1){const Le=Ye(c,ue,H);R[H]?(R[H].p(Le,y),k(R[H],1)):(R[H]=xe(Le),R[H].c(),k(R[H],1),R[H].m(w.parentNode,w))}for(se(),H=ue.length;H<R.length;H+=1)Me(H);fe()}if(c[9].jat[c[0]][c[10]].arms.length>0?W?(W.p(c,y),y[0]&513&&k(W,1)):(W=et(c),W.c(),k(W,1),W.m(f.parentNode,f)):W&&(se(),C(W,1,1,()=>{W=null}),fe()),c[9].jat[c[0]][c[1]].arms.length>0?Z?(Z.p(c,y),y[0]&515&&k(Z,1)):(Z=tt(c),Z.c(),k(Z,1),Z.m(v.parentNode,v)):Z&&(se(),C(Z,1,1,()=>{Z=null}),fe()),y[0]&133651){h=ce(c[9].jat[c[0]][c[1]].movements);let H;for(H=0;H<h.length;H+=1){const Le=Qe(c,h,H);$[H]?($[H].p(Le,y),k($[H],1)):($[H]=nt(Le),$[H].c(),k($[H],1),$[H].m(q.parentNode,q))}for(se(),H=h.length;H<$.length;H+=1)x(H);fe()}c[9].jat[c[0]][c[10]].movements.length>0?G?(G.p(c,y),y[0]&513&&k(G,1)):(G=ot(c),G.c(),k(G,1),G.m(I.parentNode,I)):G&&(se(),C(G,1,1,()=>{G=null}),fe())},i(c){if(!O){k(e.$$.fragment,c),k(u.$$.fragment,c);for(let y=0;y<ue.length;y+=1)k(R[y]);k(W),k(Z);for(let y=0;y<h.length;y+=1)k($[y]);k(G),O=!0}},o(c){C(e.$$.fragment,c),C(u.$$.fragment,c),R=R.filter(Boolean);for(let y=0;y<R.length;y+=1)C(R[y]);C(W),C(Z),$=$.filter(Boolean);for(let y=0;y<$.length;y+=1)C($[y]);C(G),O=!1},d(c){c&&(b(o),b(t),b(m),b(L),b(D),b(E),b(w),b(f),b(p),b(j),b(v),b(q),b(I)),z(e,c),ae.d(),z(u,c),ye(R,c),W&&W.d(c),Z&&Z.d(c),ye($,c),G&&G.d(c)}}}function $n(n){let e;return{c(){e=J("Save")},l(o){e=K(o,"Save")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function hn(n){let e;return{c(){e=J("Delete")},l(o){e=K(o,"Delete")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function kn(n){let e,o,t;function l(a){n[30](a)}let r={label:"Arm Name"};return n[9].jat[n[0]][n[1]].arms[n[3].idx].name!==void 0&&(r.value=n[9].jat[n[0]][n[1]].arms[n[3].idx].name),e=new Fe({props:r}),ee.push(()=>le(e,"value",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};!o&&s[0]&523&&(o=!0,i.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,oe(()=>o=!1)),e.$set(i)},i(a){t||(k(e.$$.fragment,a),t=!0)},o(a){C(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function bn(n){let e,o;return e=new cn({props:{junctionIdx:n[0],stage:n[1],idx:n[3].idx}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[0]&1&&(r.junctionIdx=t[0]),l[0]&2&&(r.stage=t[1]),l[0]&8&&(r.idx=t[3].idx),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function vn(n){let e;return{c(){e=J("Zoom to fit")},l(o){e=K(o,"Zoom to fit")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function wn(n){let e;return{c(){e=J("Show scheme context")},l(o){e=K(o,"Show scheme context")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function jn(n){var E;let e,o,t,l,r,a,s,i,_,g,m,u;e=new he({props:{$$slots:{default:[vn]},$$scope:{ctx:n}}}),e.$on("click",n[20]),t=new Dt({}),r=new qt({});function M(w){n[21](w)}let L={map:(E=n[7])==null?void 0:E.getMap()};n[5]!==void 0&&(L.enabled=n[5]),s=new Bt({props:L}),ee.push(()=>le(s,"enabled",M));function D(w){n[22](w)}let B={$$slots:{default:[wn]},$$scope:{ctx:n}};return n[6]!==void 0&&(B.checked=n[6]),g=new Ut({props:B}),ee.push(()=>le(g,"checked",D)),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U(),N(r.$$.fragment),a=U(),N(s.$$.fragment),_=U(),N(g.$$.fragment)},l(w){A(e.$$.fragment,w),o=F(w),A(t.$$.fragment,w),l=F(w),A(r.$$.fragment,w),a=F(w),A(s.$$.fragment,w),_=F(w),A(g.$$.fragment,w)},m(w,f){P(e,w,f),S(w,o,f),P(t,w,f),S(w,l,f),P(r,w,f),S(w,a,f),P(s,w,f),S(w,_,f),P(g,w,f),u=!0},p(w,f){var v;const p={};f[1]&1024&&(p.$$scope={dirty:f,ctx:w}),e.$set(p);const d={};f[0]&128&&(d.map=(v=w[7])==null?void 0:v.getMap()),!i&&f[0]&32&&(i=!0,d.enabled=w[5],oe(()=>i=!1)),s.$set(d);const j={};f[1]&1024&&(j.$$scope={dirty:f,ctx:w}),!m&&f[0]&64&&(m=!0,j.checked=w[6],oe(()=>m=!1)),g.$set(j)},i(w){u||(k(e.$$.fragment,w),k(t.$$.fragment,w),k(r.$$.fragment,w),k(s.$$.fragment,w),k(g.$$.fragment,w),u=!0)},o(w){C(e.$$.fragment,w),C(t.$$.fragment,w),C(r.$$.fragment,w),C(s.$$.fragment,w),C(g.$$.fragment,w),u=!1},d(w){w&&(b(o),b(l),b(a),b(_)),z(e,w),z(t,w),z(r,w),z(s,w),z(g,w)}}}function Cn(n){let e;return{c(){e=J("No movements added")},l(o){e=K(o,"No movements added")},m(o,t){S(o,e,t)},p:je,d(o){o&&b(e)}}}function Mn(n){let e=Math.round(rt(n[9].jat[n[0]][n[1]]))+"",o,t;return{c(){o=J(e),t=J("%")},l(l){o=K(l,e),t=K(l,"%")},m(l,r){S(l,o,r),S(l,t,r)},p(l,r){r[0]&515&&e!==(e=Math.round(rt(l[9].jat[l[0]][l[1]]))+"")&&_e(o,e)},d(l){l&&(b(o),b(t))}}}function xe(n){let e,o;function t(){return n[24](n[38])}function l(){return n[25](n[38])}return e=new Ue({props:{name:`${lt(n[38])} - ${n[39].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[26]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=`${lt(n[38])} - ${n[39].name||"Unnamed arm"}`),e.$set(s)},i(r){o||(k(e.$$.fragment,r),o=!0)},o(r){C(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function et(n){let e,o;return e=new he({props:{$$slots:{default:[Ln]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&1024&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Ln(n){let e,o;return{c(){e=J("Copy arms from "),o=J(n[10])},l(t){e=K(t,"Copy arms from "),o=K(t,n[10])},m(t,l){S(t,e,l),S(t,o,l)},p:je,d(t){t&&(b(e),b(o))}}}function tt(n){let e,o;return e=new he({props:{$$slots:{default:[Sn]},$$scope:{ctx:n}}}),e.$on("click",n[18]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&1024&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Sn(n){let e;return{c(){e=J("Generate movements between all arms (1st arm is the center)")},l(o){e=K(o,"Generate movements between all arms (1st arm is the center)")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function yn(n){let e,o,t,l=n[35].score+"",r,a,s,i=Ke(n[35].kind)+"",_;return{c(){e=te("div"),o=te("span"),t=J("Score: "),r=J(l),a=U(),s=te("span"),_=J(i),this.h()},l(g){e=ne(g,"DIV",{style:!0});var m=re(e);o=ne(m,"SPAN",{style:!0});var u=re(o);t=K(u,"Score: "),r=K(u,l),u.forEach(b),a=F(m),s=ne(m,"SPAN",{});var M=re(s);_=K(M,i),M.forEach(b),m.forEach(b),this.h()},h(){V(o,"padding","4px"),V(o,"color",n[36].font),V(o,"background-color",n[36].background),V(e,"width","100%"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(g,m){S(g,e,m),Q(e,o),Q(o,t),Q(o,r),Q(e,a),Q(e,s),Q(s,_)},p(g,m){m[0]&515&&l!==(l=g[35].score+"")&&_e(r,l),m[0]&515&&V(o,"color",g[36].font),m[0]&515&&V(o,"background-color",g[36].background),m[0]&515&&i!==(i=Ke(g[35].kind)+"")&&_e(_,i)},d(g){g&&b(e)}}}function nt(n){let e,o;function t(){return n[27](n[38])}function l(){return n[28](n[38])}return e=new Ue({props:{name:n[35].name||"Unnamed movement",$$slots:{default:[yn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[29]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=n[35].name||"Unnamed movement"),a[0]&515|a[1]&1024&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(r){o||(k(e.$$.fragment,r),o=!0)},o(r){C(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function ot(n){let e,o;return e=new he({props:{$$slots:{default:[In]},$$scope:{ctx:n}}}),e.$on("click",n[16]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&1024&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function In(n){let e,o;return{c(){e=J("Copy movements from "),o=J(n[10])},l(t){e=K(t,"Copy movements from "),o=K(t,n[10])},m(t,l){S(t,e,l),S(t,o,l)},p:je,d(t){t&&(b(e),b(o))}}}function Tn(n){let e,o,t,l,r,a,s,i,_,g,m,u,M,L,D;function B(v){n[19](v)}let E={label:"Commentary / Notes"};n[9].jat[n[0]][n[1]].notes!==void 0&&(E.value=n[9].jat[n[0]][n[1]].notes),o=new ct({props:E}),ee.push(()=>le(o,"value",B));const w=[pn,dn],f=[];function p(v,q){return v[3]==null?0:1}s=p(n),i=f[s]=w[s](n);function d(v){n[33](v)}let j={junctionIdx:n[0],stage:n[1],newKind:n[2],hoveringSidebar:n[4],streetviewOn:n[5],showContext:n[6],select:n[11],stopEditing:n[12]};return n[3]!==void 0&&(j.editing=n[3]),m=new fn({props:j}),n[32](m),ee.push(()=>le(m,"editing",d)),{c(){e=te("div"),N(o.$$.fragment),l=U(),r=te("div"),a=te("div"),i.c(),_=U(),g=te("div"),N(m.$$.fragment),this.h()},l(v){e=ne(v,"DIV",{class:!0});var q=re(e);A(o.$$.fragment,q),q.forEach(b),l=F(v),r=ne(v,"DIV",{style:!0});var I=re(r);a=ne(I,"DIV",{style:!0});var O=re(a);i.l(O),O.forEach(b),_=F(I),g=ne(I,"DIV",{style:!0});var Y=re(g);A(m.$$.fragment,Y),Y.forEach(b),I.forEach(b),this.h()},h(){$e(e,"class","govuk-width-container"),V(a,"width","30%"),V(a,"overflow-y","scroll"),V(a,"padding","10px"),V(a,"border","1px solid black"),V(g,"position","relative"),V(g,"width","100%"),V(r,"display","flex"),V(r,"height","80vh")},m(v,q){S(v,e,q),P(o,e,null),S(v,l,q),S(v,r,q),Q(r,a),f[s].m(a,null),n[31](a),Q(r,_),Q(r,g),P(m,g,null),M=!0,L||(D=vt(gn,"keydown",n[14]),L=!0)},p(v,q){const I={};!t&&q[0]&515&&(t=!0,I.value=v[9].jat[v[0]][v[1]].notes,oe(()=>t=!1)),o.$set(I);let O=s;s=p(v),s===O?f[s].p(v,q):(se(),C(f[O],1,1,()=>{f[O]=null}),fe(),i=f[s],i?i.p(v,q):(i=f[s]=w[s](v),i.c()),k(i,1),i.m(a,null));const Y={};q[0]&1&&(Y.junctionIdx=v[0]),q[0]&2&&(Y.stage=v[1]),q[0]&4&&(Y.newKind=v[2]),q[0]&16&&(Y.hoveringSidebar=v[4]),q[0]&32&&(Y.streetviewOn=v[5]),q[0]&64&&(Y.showContext=v[6]),!u&&q[0]&8&&(u=!0,Y.editing=v[3],oe(()=>u=!1)),m.$set(Y)},i(v){M||(k(o.$$.fragment,v),k(i),k(m.$$.fragment,v),M=!0)},o(v){C(o.$$.fragment,v),C(i),C(m.$$.fragment,v),M=!1},d(v){v&&(b(e),b(l),b(r)),z(o),f[s].d(),n[31](null),n[32](null),z(m),L=!1,D()}}}function lt(n){return String.fromCharCode(n+65)}function rt(n){let e=0,o=0;for(let t of n.movements)e+={0:0,1:1,2:2,X:0}[t.score],o+=2;return e/o*100}function En(n,e,o){let t;Ae(n,X,$=>o(9,t=$));let{junctionIdx:l}=e,{stage:r}=e,a=r=="existing"?"proposed":"existing",s="arm",i=null,_=null,g=null,m=!1,u=!0,M=null,L;async function D($){_=L.scrollTop,o(3,i=$),o(4,g=null)}async function B(){o(3,i=null),_!=null&&(await wt(),o(8,L.scrollTop=_,L),_=null)}function E(){window.confirm(`Delete this ${i.kind}?`)&&(i.kind=="movement"?(t.jat[l][r].movements.splice(i.idx,1),X.set(t)):(t.jat[l][r].arms.splice(i.idx,1),X.set(t)),B())}function w($){if(i==null)return;let x=$.target.tagName,G=x=="INPUT"||x=="TEXTAREA";$.key=="Escape"||$.key=="Enter"&&!G?($.stopPropagation(),B()):$.key=="Delete"&&!G&&($.stopPropagation(),E())}function f(){t.jat[l][r].arms.length>0&&!window.confirm("Overwrite arms?")||(ve(X,t.jat[l][r].arms=JSON.parse(JSON.stringify(t.jat[l][a].arms)),t),X.set(t))}function p(){t.jat[l][r].movements.length>0&&!window.confirm("Overwrite movements?")||(ve(X,t.jat[l][r].movements=JSON.parse(JSON.stringify(t.jat[l][a].movements)),t),X.set(t))}let d={0:ge.red,1:ge.amber,2:ge.green,X:ge.critical};function j(){let[$,...x]=t.jat[l][r].arms;ve(X,t.jat[l][r].movements=_n($,x),t)}function v($){n.$$.not_equal(t.jat[l][r].notes,$)&&(t.jat[l][r].notes=$,X.set(t))}const q=()=>M==null?void 0:M.zoom(!0);function I($){m=$,o(5,m)}function O($){u=$,o(6,u)}function Y($){s=$,o(2,s)}const T=$=>D({kind:"arm",idx:$}),ae=$=>o(4,g={kind:"arm",idx:$}),Ce=()=>o(4,g=null),ke=$=>D({kind:"movement",idx:$}),ue=$=>o(4,g={kind:"movement",idx:$}),R=()=>o(4,g=null);function Me($){n.$$.not_equal(t.jat[l][r].arms[i.idx].name,$)&&(t.jat[l][r].arms[i.idx].name=$,X.set(t))}function W($){ee[$?"unshift":"push"](()=>{L=$,o(8,L)})}function Z($){ee[$?"unshift":"push"](()=>{M=$,o(7,M)})}function h($){i=$,o(3,i)}return n.$$set=$=>{"junctionIdx"in $&&o(0,l=$.junctionIdx),"stage"in $&&o(1,r=$.stage)},[l,r,s,i,g,m,u,M,L,t,a,D,B,E,w,f,p,d,j,v,q,I,O,Y,T,ae,Ce,ke,ue,R,Me,W,Z,h]}class Nn extends Ie{constructor(e){super(),Te(this,e,En,Tn,we,{junctionIdx:0,stage:1},null,[-1,-1])}}function at(n,e,o){const t=n.slice();return t[10]=e[o],t[12]=o,t}function An(n){let e,o,t=(n[1].jat[n[0].idx].name||"Untitled junction")+"",l,r,a=n[0].stage+"",s,i,_,g,m,u,M,L=n[0].stage,D,B;_=new jt({props:{$$slots:{default:[On]},$$scope:{ctx:n}}});function E(p){n[9](p)}let w={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(w.value=n[1].jat[n[0].idx].name),m=new Fe({props:w}),ee.push(()=>le(m,"value",E));let f=it(n);return{c(){e=te("div"),o=te("h2"),l=J(t),r=J(" - "),s=J(a),i=U(),N(_.$$.fragment),g=U(),N(m.$$.fragment),M=U(),f.c(),D=de(),this.h()},l(p){e=ne(p,"DIV",{class:!0});var d=re(e);o=ne(d,"H2",{});var j=re(o);l=K(j,t),r=K(j," - "),s=K(j,a),j.forEach(b),i=F(d),A(_.$$.fragment,d),g=F(d),A(m.$$.fragment,d),d.forEach(b),M=F(p),f.l(p),D=de(),this.h()},h(){$e(e,"class","govuk-width-container")},m(p,d){S(p,e,d),Q(e,o),Q(o,l),Q(o,r),Q(o,s),Q(e,i),P(_,e,null),Q(e,g),P(m,e,null),S(p,M,d),f.m(p,d),S(p,D,d),B=!0},p(p,d){(!B||d&3)&&t!==(t=(p[1].jat[p[0].idx].name||"Untitled junction")+"")&&_e(l,t),(!B||d&1)&&a!==(a=p[0].stage+"")&&_e(s,a);const j={};d&8193&&(j.$$scope={dirty:d,ctx:p}),_.$set(j);const v={};!u&&d&3&&(u=!0,v.value=p[1].jat[p[0].idx].name,oe(()=>u=!1)),m.$set(v),d&1&&we(L,L=p[0].stage)?(se(),C(f,1,1,je),fe(),f=it(p),f.c(),k(f,1),f.m(D.parentNode,D)):f.p(p,d)},i(p){B||(k(_.$$.fragment,p),k(m.$$.fragment,p),k(f),B=!0)},o(p){C(_.$$.fragment,p),C(m.$$.fragment,p),C(f),B=!1},d(p){p&&(b(e),b(M),b(D)),z(_),z(m),f.d(p)}}}function Pn(n){let e,o,t,l;o=new ft({props:{$$slots:{default:[Gn]},$$scope:{ctx:n}}}),o.$on("click",n[2]);let r=ce(n[1].jat),a=[];for(let i=0;i<r.length;i+=1)a[i]=st(at(n,r,i));const s=i=>C(a[i],1,1,()=>{a[i]=null});return{c(){e=te("div"),N(o.$$.fragment),t=U();for(let i=0;i<a.length;i+=1)a[i].c();this.h()},l(i){e=ne(i,"DIV",{class:!0});var _=re(e);A(o.$$.fragment,_),t=F(_);for(let g=0;g<a.length;g+=1)a[g].l(_);_.forEach(b),this.h()},h(){$e(e,"class","govuk-width-container")},m(i,_){S(i,e,_),P(o,e,null),Q(e,t);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(e,null);l=!0},p(i,_){const g={};if(_&8192&&(g.$$scope={dirty:_,ctx:i}),o.$set(g),_&3){r=ce(i[1].jat);let m;for(m=0;m<r.length;m+=1){const u=at(i,r,m);a[m]?(a[m].p(u,_),k(a[m],1)):(a[m]=st(u),a[m].c(),k(a[m],1),a[m].m(e,null))}for(se(),m=r.length;m<a.length;m+=1)s(m);fe()}},i(i){if(!l){k(o.$$.fragment,i);for(let _=0;_<r.length;_+=1)k(a[_]);l=!0}},o(i){C(o.$$.fragment,i),a=a.filter(Boolean);for(let _=0;_<a.length;_+=1)C(a[_]);l=!1},d(i){i&&b(e),z(o),ye(a,i)}}}function zn(n){let e;return{c(){e=J("Back to all junctions")},l(o){e=K(o,"Back to all junctions")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function Dn(n){let e,o;return e=new he({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function qn(n){let e,o;return e=new he({props:{$$slots:{default:[Un]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Bn(n){let e;return{c(){e=J("Edit Proposed")},l(o){e=K(o,"Edit Proposed")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function Un(n){let e;return{c(){e=J("Edit Existing")},l(o){e=K(o,"Edit Existing")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function Fn(n){let e;return{c(){e=J("Delete")},l(o){e=K(o,"Delete")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function On(n){let e,o,t,l,r,a,s;e=new he({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const i=[qn,Dn],_=[];function g(m,u){return m[0].stage=="proposed"?0:1}return t=g(n),l=_[t]=i[t](n),a=new ut({props:{$$slots:{default:[Fn]},$$scope:{ctx:n}}}),a.$on("click",n[8]),{c(){N(e.$$.fragment),o=U(),l.c(),r=U(),N(a.$$.fragment)},l(m){A(e.$$.fragment,m),o=F(m),l.l(m),r=F(m),A(a.$$.fragment,m)},m(m,u){P(e,m,u),S(m,o,u),_[t].m(m,u),S(m,r,u),P(a,m,u),s=!0},p(m,u){const M={};u&8192&&(M.$$scope={dirty:u,ctx:m}),e.$set(M);let L=t;t=g(m),t===L?_[t].p(m,u):(se(),C(_[L],1,1,()=>{_[L]=null}),fe(),l=_[t],l?l.p(m,u):(l=_[t]=i[t](m),l.c()),k(l,1),l.m(r.parentNode,r));const D={};u&8192&&(D.$$scope={dirty:u,ctx:m}),a.$set(D)},i(m){s||(k(e.$$.fragment,m),k(l),k(a.$$.fragment,m),s=!0)},o(m){C(e.$$.fragment,m),C(l),C(a.$$.fragment,m),s=!1},d(m){m&&(b(o),b(r)),z(e,m),_[t].d(m),z(a,m)}}}function it(n){let e,o;return e=new Nn({props:{junctionIdx:n[0].idx,stage:n[0].stage}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&1&&(r.junctionIdx=t[0].idx),l&1&&(r.stage=t[0].stage),e.$set(r)},i(t){o||(k(e.$$.fragment,t),o=!0)},o(t){C(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Gn(n){let e;return{c(){e=J("Add new junction")},l(o){e=K(o,"Add new junction")},m(o,t){S(o,e,t)},d(o){o&&b(e)}}}function st(n){let e,o;function t(){return n[4](n[12])}return e=new Ue({props:{name:n[10].name||"Untitled junction"}}),e.$on("click",t),{c(){N(e.$$.fragment)},l(l){A(e.$$.fragment,l)},m(l,r){P(e,l,r),o=!0},p(l,r){n=l;const a={};r&2&&(a.name=n[10].name||"Untitled junction"),e.$set(a)},i(l){o||(k(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){z(e,l)}}}function Hn(n){let e,o,t,l;const r=[Pn,An],a=[];function s(i,_){return i[0].kind=="list"?0:i[0].kind=="edit"?1:-1}return~(e=s(n))&&(o=a[e]=r[e](n)),{c(){o&&o.c(),t=de()},l(i){o&&o.l(i),t=de()},m(i,_){~e&&a[e].m(i,_),S(i,t,_),l=!0},p(i,[_]){let g=e;e=s(i),e===g?~e&&a[e].p(i,_):(o&&(se(),C(a[g],1,1,()=>{a[g]=null}),fe()),~e?(o=a[e],o?o.p(i,_):(o=a[e]=r[e](i),o.c()),k(o,1),o.m(t.parentNode,t)):o=null)},i(i){l||(k(o),l=!0)},o(i){C(o),l=!1},d(i){i&&b(t),~e&&a[e].d(i)}}}function Pe(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Jn(n,e,o){let t;Ae(n,X,M=>o(1,t=M));let l={kind:"list"};function r(){ve(X,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),o(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function a(M){window.confirm("Delete this junction?")&&(t.jat.splice(M,1),X.set(t),o(0,l={kind:"list"}))}const s=M=>o(0,l={kind:"edit",idx:M,stage:"existing"}),i=()=>o(0,l={kind:"list"}),_=()=>o(0,l={kind:"edit",idx:Pe(l),stage:"existing"}),g=()=>o(0,l={kind:"edit",idx:Pe(l),stage:"proposed"}),m=()=>a(Pe(l));function u(M){n.$$.not_equal(t.jat[l.idx].name,M)&&(t.jat[l.idx].name=M,X.set(t))}return[l,t,r,a,s,i,_,g,m,u]}class mo extends Ie{constructor(e){super(),Te(this,e,Jn,Hn,we,{})}}export{mo as component};
