import{s as E,e as J,a as x,c as T,m as j,g as d,i as u,f as p,k as O,t as U,d as W}from"../chunks/scheduler.BJ06nkRu.js";import{S as B,i as K,c as b,a as w,m as S,t as C,b as _,d as v}from"../chunks/index.Dmc4uC9p.js";import{e as R}from"../chunks/da_log.DiOlKUB5.js";import{s as D}from"../chunks/data.lSY4I58x.js";import{D as N}from"../chunks/DefaultButton.CRXvyloG.js";/* empty css                                                               */import{T as y}from"../chunks/TextArea.dqrL6eGj.js";import{E as F}from"../chunks/exceljs.min.BuyXGIGS.js";const I=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function M(t){console.log("Loading blank route check xlsx");let l=await(await fetch(I)).arrayBuffer(),a=new F.Workbook;await a.xlsx.load(l),a.eachSheet((s,r)=>{s.conditionalFormattings=[]}),V(t,a),$(t.safetyCheck,a,"3.1 Safety Check",["J","K","L","M"],h([[13,28]])),$(t.streetCheck,a,"4.1 Street Check",["J","K","L","M"],h([[13,19],[23,25],[29,34],[38,43],[47,50]])),$(t.streetPlacemakingCheck,a,"4.2 Street Placemaking Check",["I","J","K","L"],h([[13,15],[19,21],[25,34],[38,47]])),$(t.pathCheck,a,"5.1 Path Check",["J","K","L","M"],h([[15,19],[23,33],[37,40],[44,48],[52,56]])),$(t.pathPlacemakingCheck,a,"5.2 Path Placemaking Check",["I","J","K","L"],h([[12,14],[20,22],[26,29],[33,41]])),console.log("Writing route check xlsx");let n=await a.xlsx.writeBuffer();A(n,"out.xlsx")}function V(t,o){let l=o.getWorksheet("1. Summary of Scheme");t.summary.checkType=="path"&&(l.getCell("D22").value="Path Check")}function $(t,o,l,a,n){let s=o.getWorksheet(l);if(n.length!=t.existingScores.length)throw new Error(`Wrong Excel ranges for ${l}`);for(let r=0;r<t.existingScores.length;r++){let m=n[r];s.getCell(a[0]+m).value=P(t.existingScores[r]),s.getCell(a[1]+m).value=t.existingScoreNotes[r],s.getCell(a[2]+m).value=P(t.proposedScores[r]),s.getCell(a[3]+m).value=t.proposedScoreNotes[r]}}function h(t){let o=[];for(let[l,a]of t)for(let n=l;n<=a;n++)o.push(n);return o}function P(t){return{"":t,C:t,0:0,1:1,2:2,"N/A":t}[t]}function A(t,o){let l=new Blob([t],{type:"application/octet-stream"}),a=URL.createObjectURL(l),n=document.createElement("a");n.href=a,n.download=o,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(a)}function G(t){let o;return{c(){o=U("Convert to .xlsx (takes a few seconds)")},l(l){o=W(l,"Convert to .xlsx (takes a few seconds)")},m(l,a){u(l,o,a)},d(l){l&&p(o)}}}function q(t){let o,l=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,a,n,s,r,m,i,g,c,k;return n=new y({props:{label:"TSV output, just the one row of values",value:t[3]}}),r=new y({props:{label:"TSV output with header",value:`${t[2]}
${t[3]}
`}}),i=new y({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(t[1]),null,"  ")}}),c=new N({props:{$$slots:{default:[G]},$$scope:{ctx:t}}}),c.$on("click",t[4]),{c(){o=J("p"),o.textContent=l,a=x(),b(n.$$.fragment),s=x(),b(r.$$.fragment),m=x(),b(i.$$.fragment),g=x(),b(c.$$.fragment)},l(e){o=T(e,"P",{"data-svelte-h":!0}),j(o)!=="svelte-5ssfe3"&&(o.textContent=l),a=d(e),w(n.$$.fragment,e),s=d(e),w(r.$$.fragment,e),m=d(e),w(i.$$.fragment,e),g=d(e),w(c.$$.fragment,e)},m(e,f){u(e,o,f),u(e,a,f),S(n,e,f),u(e,s,f),S(r,e,f),u(e,m,f),S(i,e,f),u(e,g,f),S(c,e,f),k=!0},p(e,[f]){const L={};f&32&&(L.$$scope={dirty:f,ctx:e}),c.$set(L)},i(e){k||(C(n.$$.fragment,e),C(r.$$.fragment,e),C(i.$$.fragment,e),C(c.$$.fragment,e),k=!0)},o(e){_(n.$$.fragment,e),_(r.$$.fragment,e),_(i.$$.fragment,e),_(c.$$.fragment,e),k=!1},d(e){e&&(p(o),p(a),p(s),p(m),p(g)),v(n,e),v(r,e),v(i,e),v(c,e)}}}function z(t,o,l){let a;O(t,D,i=>l(0,a=i));let n=R(a),s=n.map(i=>i[0]).join("	"),r=n.map(i=>`"${i[1]}"`).join("	");return[a,n,s,r,()=>M(a)]}class ne extends B{constructor(o){super(),K(this,o,z,q,E,{})}}export{ne as component};
