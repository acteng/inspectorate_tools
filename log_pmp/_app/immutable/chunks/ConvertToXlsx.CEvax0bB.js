import{s as J,a as v,e as x,g as y,c as w,m as R,i as C,f,k as S,t as A,d as K}from"./scheduler.6uFXgBQz.js";import{S as T,i as D,c as $,a as _,m as L,t as b,b as I,d as P}from"./index.CFPeyt6C.js";import{c as N,s as M}from"./data.DL20cGZ1.js";import{S as H}from"./SecondaryButton.IIp7NGAE.js";/* empty css                                            */import{E as j}from"./exceljs.min.BuyXGIGS.js";import{g as B,a as G}from"./lists.BvURpO7c.js";import{a as O}from"./index.BIRnK1vS.js";import{L as U}from"./Loading.BkDOwF42.js";import"./paths.w05FvYs4.js";const X=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function q(e,r){console.log("Loading blank route check xlsx");let l=await(await fetch(X)).arrayBuffer(),o=new j.Workbook;await o.xlsx.load(l),o.eachSheet((n,i)=>{n.conditionalFormattings=[]}),z(e,o),Q(e,o),V(e,o),Y(e,o),h(e.safetyCheck,o,"3.1 Safety Check",["J","K","L","M"],p([[13,28]])),h(e.streetCheck,o,"4.1 Street Check",["J","K","L","M"],p([[13,19],[23,25],[29,34],[38,43],[47,50]])),h(e.streetPlacemakingCheck,o,"4.2 Street Placemaking Check",["I","J","K","L"],p([[13,15],[19,21],[25,34],[38,47]])),h(e.pathCheck,o,"5.1 Path Check",["J","K","L","M"],p([[15,19],[23,33],[37,40],[44,48],[52,56]])),h(e.pathPlacemakingCheck,o,"5.2 Path Placemaking Check",["I","J","K","L"],p([[12,14],[20,22],[26,29],[33,41]])),Z(e,o),o.getWorksheet("5.1 Path Check").getCell("D7").value=e.horseRiders,o.getWorksheet("7.1 Results Summary").getCell("G7").value=e.resultsReviewStatement,console.log("Writing route check xlsx");let s=await o.xlsx.writeBuffer();O(s,`route_check_${r}.xlsx`)}function z(e,r){let t=r.getWorksheet("1. Summary of Scheme");t.getCell("C6").value=e.summary.dateDesignReview,t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.assessedRouteLengthKm,t.getCell("C19").value=e.summary.totalRouteLengthKm,t.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(t.getCell("D22").value="Path Check");for(let l of e.summary.networkMap.features)if(l.geometry.type=="LineString"){t.getCell("C26").value=l.geometry.coordinates[0][1],t.getCell("D26").value=l.geometry.coordinates[0][0],t.getCell("C27").value=l.geometry.coordinates[0][1],t.getCell("D27").value=l.geometry.coordinates[0][0],t.getCell("C28").value=`https://www.openstreetmap.org/#map=18/${l.geometry.coordinates[0][1]}/${l.geometry.coordinates[0][0]}`;break}}function Q(e,r){let t=r.getWorksheet("2.1 Policy Check");for(let l=0;l<6;l++)t.getCell("D"+(8+l)).value=e.policyCheck[l].existing,t.getCell("E"+(8+l)).value=e.policyCheck[l].proposed,t.getCell("F"+(8+l)).value=e.policyCheck[l].commentary}function V(e,r){let t=r.getWorksheet("2.2 Policy Conflict Log");for(let[l,o]of e.policyConflictLog.entries())t.getCell("F"+(8+l)).value=B(o.conflict),t.getCell("H"+(8+l)).value=o.stage,t.getCell("I"+(8+l)).value=E(o.point),t.getCell("J"+(8+l)).value=o.locationName,t.getCell("K"+(8+l)).value=o.stage==="Design"?"No":o.resolved,t.getCell("L"+(8+l)).value=o.notes}function Y(e,r){let t=r.getWorksheet("3.2 Critical Issues Log");for(let[l,o]of e.criticalIssues.entries())t.getCell("F"+(8+l)).value=G(o.criticalIssue),t.getCell("H"+(8+l)).value=o.stage,t.getCell("I"+(8+l)).value=E(o.point),t.getCell("J"+(8+l)).value=o.locationName,t.getCell("K"+(8+l)).value=o.stage==="Design"?"No":o.resolved,t.getCell("L"+(8+l)).value=o.notes}function h(e,r,t,l,o){let s=r.getWorksheet(t);if(o.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${t}`);for(let n=0;n<e.existingScores.length;n++){let i=o[n];s.getCell(l[0]+i).value=W(e.existingScores[n]),s.getCell(l[1]+i).value=e.existingScoreNotes[n],s.getCell(l[2]+i).value=W(e.proposedScores[n]),s.getCell(l[3]+i).value=e.proposedScoreNotes[n]}}function Z(e,r){let t=r.getWorksheet("6. JAT Check"),l=0;for(let o of e.jat)for(let s of[o.existing,o.proposed]){let n=g("H",l*5);t.getCell(g(n,1)+"9").value=o.name,t.getCell(g(n,1)+"10").value=s.notes;for(let[i,u]of s.movements.filter(m=>m.kind=="walking & wheeling").entries())t.getCell(n+(13+i)).value=u.name,t.getCell(g(n,2)+(13+i)).value=F(u.score),t.getCell(g(n,3)+(13+i)).value=u.notes;for(let[i,u]of s.movements.filter(m=>m.kind=="cycling").entries())t.getCell(n+(26+i)).value=u.name,t.getCell(g(n,2)+(26+i)).value=F(u.score),t.getCell(g(n,3)+(26+i)).value=u.notes;l++}}function g(e,r){return te(ee(e)+r)}function ee(e){let r=0;for(let t=0;t<e.length;t++)r*=26,r+=e.charCodeAt(t)-65+1;return r-1}function te(e){let r="";for(e+=1;e>0;){let t=(e-1)%26;r=String.fromCharCode(t+65)+r,e=Math.floor((e-1)/26)}return r}function p(e){let r=[];for(let[t,l]of e)for(let o=t;o<=l;o++)r.push(o);return r}function W(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function F(e){return{0:0,1:1,2:2,X:e}[e]}function E(e){return`${e[1]}, ${e[0]}`}function le(e){let r;return{c(){r=A("Export .xlsx")},l(t){r=K(t,"Export .xlsx")},m(t,l){C(t,r,l)},d(t){t&&f(r)}}}function oe(e){let r,t,l,o=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9. The route coordinates in the Summary of Scheme may not
    capture everything mapped when the route is split into multiple pieces. The
    map weblink only shows the route start point.</i>`,s,n,i,u,m;return r=new H({props:{$$slots:{default:[le]},$$scope:{ctx:e}}}),r.$on("click",e[1]),n=new U({props:{loading:e[0]}}),{c(){$(r.$$.fragment),t=v(),l=x("p"),l.innerHTML=o,s=v(),$(n.$$.fragment),i=v(),u=x("hr")},l(a){_(r.$$.fragment,a),t=y(a),l=w(a,"P",{"data-svelte-h":!0}),R(l)!=="svelte-1lahb25"&&(l.innerHTML=o),s=y(a),_(n.$$.fragment,a),i=y(a),u=w(a,"HR",{})},m(a,c){L(r,a,c),C(a,t,c),C(a,l,c),C(a,s,c),L(n,a,c),C(a,i,c),C(a,u,c),m=!0},p(a,[c]){const k={};c&16&&(k.$$scope={dirty:c,ctx:a}),r.$set(k);const d={};c&1&&(d.loading=a[0]),n.$set(d)},i(a){m||(b(r.$$.fragment,a),b(n.$$.fragment,a),m=!0)},o(a){I(r.$$.fragment,a),I(n.$$.fragment,a),m=!1},d(a){a&&(f(t),f(l),f(s),f(i),f(u)),P(r,a),P(n,a)}}}function re(e,r,t){let l,o;S(e,N,i=>t(2,l=i)),S(e,M,i=>t(3,o=i));let s="";async function n(){t(0,s="Converting to .xlsx (takes about 20 seconds)");try{await q(o,l)}catch(i){window.alert(`Conversion failed: ${i}`)}t(0,s="")}return[s,n]}class he extends T{constructor(r){super(),D(this,r,re,oe,J,{})}}export{he as C};
