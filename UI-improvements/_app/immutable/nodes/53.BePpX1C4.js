import{s as y,e as w,a as C,c as x,m as k,g as R,p as v,i as h,n as b,f as g,k as $}from"../chunks/scheduler.Dx5MGYrL.js";import{S as L,i as _,c as P,a as D,m as E,t as N,b as A,d as F}from"../chunks/index.BJbZCI5a.js";import{F as T}from"../chunks/FileManager.CuMYE1fn.js";import{e as I,f as M,c as d,s as S}from"../chunks/data.BbDaCMNi.js";import{E as O}from"../chunks/exceljs.min.BuyXGIGS.js";import{b as H}from"../chunks/index.DZrlUlTI.js";import{d as j}from"../chunks/export.Xor2Ls91.js";function B(i){let n=i.getWorksheet("DALog"),r=n.getRow(1).values.map(o=>typeof o=="string"?o:o.result),a=n.getRow(2).values.map(o=>typeof o=="string"?o:o.result??null);r.shift(),r.shift(),a.shift(),a.shift();let l=r.map((o,s)=>[o,a[s]]);return Object.fromEntries(l)}function f(i){return(i+1).toString().padStart(2,"0")}function K(i){let n=I(),r=t=>{let e=i[t];if(typeof e=="string")return e;if(e==null)return"";throw new Error(`${t} isn't a string, it's ${e}`)},a=t=>{let e=i[t];return typeof e=="number"?e:(e==null||console.warn(`${t} isn't a number, it's ${e}. Defaulting to 0`),0)},l=t=>{let e=i[t];return typeof e=="object"&&e instanceof Date?H(e):""},o=t=>{let e=i[t];if(e==""||e=="Yes"||e=="No")return e;if(e==null)return"";throw new Error(`${t} isn't yesNoBlank, it's ${e}`)},s=t=>{let e=i[t];if(e==""||e=="C"||e=="N/A")return e;if(e==0||e==1||e==2)return e.toString();if(e==null)return"0";throw new Error(`${t} isn't score, it's ${e}`)},u=t=>{let e=r(t).split(", ").map(parseFloat);return[e[1],e[0]]},m=r("Sub-tool")=="Street Check"?"street":"path";n.summary={dateDesignReview:l("Date of Design Review"),schemeReference:r("Scheme Ref"),schemeName:r("Scheme Name"),schemeSummary:"",schemeInfoReviewed:"",authority:r("Authority"),transportOrCombinedAuthority:r("Transport/ Combined Authority"),region:r("Region"),fundingProgramme:r("Funding Programme"),designStage:r("Design Stage"),fundingConditions:r("Funding Conditions"),inspectorEmail:r("Inspector"),assessedRouteLengthKm:a("RouteLength"),totalRouteLengthKm:a("RouteFileLength"),notes:r("Notes"),checkType:m,networkMap:{type:"FeatureCollection",features:[]}},n.horseRiders=i["PA-LOS-HR-E"]=="N/A"?"No":"Yes";for(let[t,e]of n.policyCheck.entries())e.existing=o(`PC${f(t)}-E`),e.proposed=o(`PC${f(t)}-D`);for(let[t,e,p]of[[n.safetyCheck,"SA",0],[n.streetCheck,"ST",16],[n.streetPlacemakingCheck,"SP",0],[n.pathCheck,"PA",16],[n.pathPlacemakingCheck,"PP",0]])for(let c=0;c<t.existingScores.length;c++)t.existingScores[c]=s(`${e}${f(c+p)}-E`),t.proposedScores[c]=s(`${e}${f(c+p)}-D`);for(let t=0;t<35;t++){let e=`${f(t)}PC`;i[`${e}Ref`]!=null&&n.policyConflictLog.push({conflict:r(`${e}Typ`).substr(0,1),stage:r(`${e}Sta`),point:u(`${e}LaL`),locationName:r(`${e}Loc`),resolved:o(`${e}Res`),notes:r(`${e}Com`)})}for(let t=0;t<35;t++){let e=`${f(t)}SA`;i[`${e}Ref`]!=null&&n.criticalIssues.push({criticalIssue:r(`${e}Typ`).split(" - ")[0],stage:r(`${e}Sta`),point:u(`${e}LaL`),locationName:r(`${e}Loc`),resolved:o(`${e}Res`),notes:r(`${e}Com`)})}return n}function W(i){let n,r="<h3>Route Check Tool</h3> <h2>Manage my schemes</h2>",a,l,o;return l=new T({props:{files:M,currentFile:d,state:S,xlsxImporter:i[0],downloadXlsx:i[1]}}),{c(){n=w("div"),n.innerHTML=r,a=C(),P(l.$$.fragment),this.h()},l(s){n=x(s,"DIV",{class:!0,"data-svelte-h":!0}),k(n)!=="svelte-5x8dy6"&&(n.innerHTML=r),a=R(s),D(l.$$.fragment,s),this.h()},h(){v(n,"class","govuk-width-container")},m(s,u){h(s,n,u),h(s,a,u),E(l,s,u),o=!0},p:b,i(s){o||(N(l.$$.fragment,s),o=!0)},o(s){A(l.$$.fragment,s),o=!1},d(s){s&&(g(n),g(a)),F(l,s)}}}function X(i,n,r){let a,l;$(i,d,u=>r(2,a=u)),$(i,S,u=>r(3,l=u));async function o(u){let m=new O.Workbook;await m.xlsx.load(u);let t=B(m);return K(t)}async function s(){loading="Converting to .xlsx (takes about 20 seconds)";try{await j(l,a)}catch(u){window.alert(`Conversion failed: ${u}`)}loading=""}return[o,s]}class Q extends L{constructor(n){super(),_(this,n,X,W,y,{})}}export{Q as component};
