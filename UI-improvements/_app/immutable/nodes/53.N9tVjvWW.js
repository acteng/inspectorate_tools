import{s as w,e as R,a as v,c as k,m as _,g as L,p as P,i as $,f as g}from"../chunks/scheduler.V-ByFQ7u.js";import{S as b,i as D,c as h,a as d,m as S,t as C,b as y,d as x}from"../chunks/index.Zcf2TLuh.js";import{F as N}from"../chunks/FileManager.C-lWjKbQ.js";import{e as T,f as A,c as E,s as F}from"../chunks/data.YJDb17yu.js";import{E as I}from"../chunks/exceljs.min.BuyXGIGS.js";import{d as M}from"../chunks/index.sZKgQQCk.js";import{C as O}from"../chunks/ConvertToXlsx.Dmk_HqIk.js";function H(a){let t=a.getWorksheet("DALog"),r=t.getRow(1).values.map(i=>typeof i=="string"?i:i.result),s=t.getRow(2).values.map(i=>typeof i=="string"?i:i.result??null);r.shift(),r.shift(),s.shift(),s.shift();let l=r.map((i,o)=>[i,s[o]]);return Object.fromEntries(l)}function f(a){return(a+1).toString().padStart(2,"0")}function j(a){let t=T(),r=n=>{let e=a[n];if(typeof e=="string")return e;if(e==null)return"";throw new Error(`${n} isn't a string, it's ${e}`)},s=n=>{let e=a[n];return typeof e=="number"?e:(e==null||console.warn(`${n} isn't a number, it's ${e}. Defaulting to 0`),0)},l=n=>{let e=a[n];return typeof e=="object"&&e instanceof Date?M(e):""},i=n=>{let e=a[n];if(e==""||e=="Yes"||e=="No")return e;if(e==null)return"";throw new Error(`${n} isn't yesNoBlank, it's ${e}`)},o=n=>{let e=a[n];if(e==""||e=="C"||e=="N/A")return e;if(e==0||e==1||e==2)return e.toString();if(e==null)return"0";throw new Error(`${n} isn't score, it's ${e}`)},u=n=>{let e=r(n).split(", ").map(parseFloat);return[e[1],e[0]]},m=r("Sub-tool")=="Street Check"?"street":"path";t.summary={dateDesignReview:l("Date of Design Review"),schemeReference:r("Scheme Ref"),schemeName:r("Scheme Name"),schemeSummary:"",schemeInfoReviewed:"",authority:r("Authority"),transportOrCombinedAuthority:r("Transport/ Combined Authority"),region:r("Region"),fundingProgramme:r("Funding Programme"),designStage:r("Design Stage"),fundingConditions:r("Funding Conditions"),inspectorEmail:r("Inspector"),assessedRouteLengthKm:s("RouteLength"),totalRouteLengthKm:s("RouteFileLength"),notes:r("Notes"),checkType:m,networkMap:{type:"FeatureCollection",features:[]}},t.horseRiders=a["PA-LOS-HR-E"]=="N/A"?"No":"Yes";for(let[n,e]of t.policyCheck.entries())e.existing=i(`PC${f(n)}-E`),e.proposed=i(`PC${f(n)}-D`);for(let[n,e,p]of[[t.safetyCheck,"SA",0],[t.streetCheck,"ST",16],[t.streetPlacemakingCheck,"SP",0],[t.pathCheck,"PA",16],[t.pathPlacemakingCheck,"PP",0]])for(let c=0;c<n.existingScores.length;c++)n.existingScores[c]=o(`${e}${f(c+p)}-E`),n.proposedScores[c]=o(`${e}${f(c+p)}-D`);for(let n=0;n<35;n++){let e=`${f(n)}PC`;a[`${e}Ref`]!=null&&t.policyConflictLog.push({conflict:r(`${e}Typ`).substr(0,1),stage:r(`${e}Sta`),point:u(`${e}LaL`),locationName:r(`${e}Loc`),resolved:i(`${e}Res`),notes:r(`${e}Com`)})}for(let n=0;n<35;n++){let e=`${f(n)}SA`;a[`${e}Ref`]!=null&&t.criticalIssues.push({criticalIssue:r(`${e}Typ`).split(" - ")[0],stage:r(`${e}Sta`),point:u(`${e}LaL`),locationName:r(`${e}Loc`),resolved:i(`${e}Res`),notes:r(`${e}Com`)})}return t}function B(a){let t,r;return t=new O({}),{c(){h(t.$$.fragment)},l(s){d(t.$$.fragment,s)},m(s,l){S(t,s,l),r=!0},i(s){r||(C(t.$$.fragment,s),r=!0)},o(s){y(t.$$.fragment,s),r=!1},d(s){x(t,s)}}}function K(a){let t,r="<h3>Route Check Tool</h3> <h2>Manage my schemes</h2>",s,l,i;return l=new N({props:{files:A,currentFile:E,state:F,xlsxImporter:a[0],$$slots:{default:[B]},$$scope:{ctx:a}}}),{c(){t=R("div"),t.innerHTML=r,s=v(),h(l.$$.fragment),this.h()},l(o){t=k(o,"DIV",{class:!0,"data-svelte-h":!0}),_(t)!=="svelte-5x8dy6"&&(t.innerHTML=r),s=L(o),d(l.$$.fragment,o),this.h()},h(){P(t,"class","govuk-width-container")},m(o,u){$(o,t,u),$(o,s,u),S(l,o,u),i=!0},p(o,[u]){const m={};u&2&&(m.$$scope={dirty:u,ctx:o}),l.$set(m)},i(o){i||(C(l.$$.fragment,o),i=!0)},o(o){y(l.$$.fragment,o),i=!1},d(o){o&&(g(t),g(s)),x(l,o)}}}function W(a){async function t(r){let s=new I.Workbook;await s.xlsx.load(r);let l=H(s);return j(l)}return[t]}class G extends b{constructor(t){super(),D(this,t,W,K,w,{})}}export{G as component};
