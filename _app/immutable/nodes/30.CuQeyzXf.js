import{s as Ie,v as le,x as se,l as Ze,u as Qe,m as Ye,o as xe,H as pe,E as Be,i as L,f as y,a9 as hn,a8 as bn,k as Me,U as Jt,a7 as Wt,N as He,e as ne,c as re,b as ae,r as et,a as z,g as D,w as ie,h as ge,z as yn,t as Q,p as wt,d as Y,j as je,q as Re,n as mt}from"../chunks/scheduler.Bsni_e59.js";import{S as Te,i as Ae,e as ue,c as A,a as O,m as S,t as w,b as $,d as F,g as de,f as _e}from"../chunks/index.CCfAUppz.js";import{e as ve}from"../chunks/each.ChCadThl.js";import{W as Vt,S as we}from"../chunks/WarningButton.D9QeV9gM.js";import{T as ct}from"../chunks/TextInput.CHbK327s.js";import{s as x}from"../chunks/data.CZ-XIam_.js";import{L as Xt,a as Kt,e as vn,m as Fe,i as wn,f as Zt,M as kn,g as jn,G as kt,h as jt}from"../chunks/MapLibreMap.wuen_33g.js";import{c as We}from"../chunks/colors.CYEpEtTL.js";import{D as $n}from"../chunks/DefaultButton.DyQsHGbh.js";import{a as Ln,B as Cn,G as En,R as Pn,S as Mn,c as In,M as lt,C as Tn}from"../chunks/GeoreferenceLayer.DrxKipII.js";import{T as Qt}from"../chunks/TextArea.DbePhW6L.js";import{p as An}from"../chunks/index.DGIJ59Zv.js";import{S as $t}from"../chunks/Select.N7F_8zcJ.js";function On(t){let e;const n=t[15].default,r=Ze(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&Qe(r,n,o,o[23],e?xe(n,o[23],l,null):Ye(o[23]),null)},i(o){e||(w(r,o),e=!0)},o(o){$(r,o),e=!1},d(o){r&&r.d(o)}}}function Sn(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[On]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Xt({props:l}),le.push(()=>ue(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){A(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){S(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],se(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){$(e.$$.fragment,i),r=!1},d(i){F(e,i)}}}function Fn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Kt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:f}=e,{layout:j=void 0}=e,{filter:g=void 0}=e,{minzoom:c=void 0}=e,{maxzoom:_=void 0}=e,{hoverCursor:u=void 0}=e,{manageHoverState:d=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:q=!1}=e,{interactive:U=!0}=e;function P(M){I=M,n(0,I)}function v(M){pe.call(this,t,M)}function C(M){pe.call(this,t,M)}function B(M){pe.call(this,t,M)}function K(M){pe.call(this,t,M)}function N(M){pe.call(this,t,M)}function ee(M){pe.call(this,t,M)}return t.$$set=M=>{"id"in M&&n(1,l=M.id),"source"in M&&n(2,i=M.source),"sourceLayer"in M&&n(3,a=M.sourceLayer),"beforeId"in M&&n(4,s=M.beforeId),"beforeLayerType"in M&&n(5,p=M.beforeLayerType),"paint"in M&&n(6,f=M.paint),"layout"in M&&n(7,j=M.layout),"filter"in M&&n(8,g=M.filter),"minzoom"in M&&n(9,c=M.minzoom),"maxzoom"in M&&n(10,_=M.maxzoom),"hoverCursor"in M&&n(11,u=M.hoverCursor),"manageHoverState"in M&&n(12,d=M.manageHoverState),"hovered"in M&&n(0,I=M.hovered),"eventsIfTopMost"in M&&n(13,q=M.eventsIfTopMost),"interactive"in M&&n(14,U=M.interactive),"$$scope"in M&&n(23,o=M.$$scope)},[I,l,i,a,s,p,f,j,g,c,_,u,d,q,U,r,P,v,C,B,K,N,ee,o]}class at extends Te{constructor(e){super(),Ae(this,e,Fn,Sn,Ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Bn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),Lt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function Ct(t){let e,n,r=(t[4]||t[3]instanceof Fe.Marker)&&Et(t);return{c(){e=ne("div"),r&&r.c()},l(o){e=re(o,"DIV",{});var l=ae(e);r&&r.l(l),l.forEach(y)},m(o,l){L(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof Fe.Marker?r?(r.p(o,l),l[0]&24&&w(r,1)):(r=Et(o),r.c(),w(r,1),r.m(e,null)):r&&(de(),$(r,1,1,()=>{r=null}),_e())},i(o){n||(w(r),n=!0)},o(o){$(r),n=!1},d(o){o&&y(e),r&&r.d(),t[32](null)}}}function Et(t){let e;const n=t[30].default,r=Ze(n,t,t[29],Lt);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&Qe(r,n,o,o[29],e?xe(n,o[29],l,Bn):Ye(o[29]),Lt)},i(o){e||(w(r,o),e=!0)},o(o){$(r,o),e=!1},d(o){r&&r.d(o)}}}function qn(t){let e,n,r=t[9].default&&Ct(t);return{c(){r&&r.c(),e=Be()},l(o){r&&r.l(o),e=Be()},m(o,l){r&&r.m(o,l),L(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&w(r,1)):(r=Ct(o),r.c(),w(r,1),r.m(e.parentNode,e)):r&&(de(),$(r,1,1,()=>{r=null}),_e())},i(o){n||(w(r),n=!0)},o(o){$(r),n=!1},d(o){o&&y(e),r&&r.d(o)}}}function Nn(t,e,n){let r,o,l,i,a,s,{$$slots:p={},$$scope:f}=e;const j=hn(p);let{closeButton:g=void 0}=e,{closeOnClickOutside:c=!0}=e,{closeOnClickInside:_=!1}=e,{closeOnMove:u=!1}=e,{openOn:d="click"}=e,{openIfTopMost:I=!0}=e,{focusAfterOpen:q=!0}=e,{anchor:U=void 0}=e,{offset:P=void 0}=e,{popupClass:v=void 0}=e,{maxWidth:C=void 0}=e,{lngLat:B=void 0}=e,{html:K=void 0}=e,{open:N=!1}=e;const ee=bn(),{map:M,popupTarget:k,layerEvent:ke,layer:Pe,eventTopMost:he}=vn();Me(t,M,b=>n(2,l=b)),Me(t,k,b=>n(3,a=b)),Me(t,ke,b=>n(28,i=b)),Me(t,Pe,b=>n(35,s=b));const J=["click","dblclick","contextmenu"];let G,X=!1,te;function W(){if(!G)return;let b=G.getElement();!b||b===te||(te=b,d==="hover"&&(te.style.pointerEvents="none"),te.addEventListener("mouseenter",()=>{n(24,X=!0)},{passive:!0}),te.addEventListener("mouseleave",()=>{n(24,X=!1)},{passive:!0}),te.addEventListener("click",()=>{_&&n(0,N=!1)},{passive:!0}))}Jt(()=>{if(l)return l.on("click",Se),l.on("contextmenu",Se),typeof a=="string"&&(l.on("click",a,Z),l.on("dblclick",a,Z),l.on("contextmenu",a,Z),l.on("mousemove",a,Je),l.on("mouseleave",a,Ue),l.on("touchstart",a,T),l.on("touchend",a,be)),()=>{l!=null&&l.loaded()&&(G==null||G.remove(),l.off("click",Se),l.off("contextmenu",Se),a instanceof Fe.Marker?a.getPopup()===G&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,Z),l.off("dblclick",a,Z),l.off("contextmenu",a,Z),l.off("mousemove",a,Je),l.off("mouseleave",a,Ue),l.off("touchstart",a,T),l.off("touchend",a,be)))}});function Oe(b){return I?!("marker"in b)&&!wn(b)&&he(b)!==s:!1}let m=null,E="normal";function Z(b){b.type===d&&(Oe(b)||("layerType"in b?b.layerType==="deckgl"?(n(10,B=b.coordinate),n(4,m=b.object?[b.object]:null)):(n(10,B=b.lngLat),n(4,m=b.features??[])):(n(10,B=b.lngLat),n(4,m=b.features??[])),setTimeout(()=>n(0,N=!0))))}let oe=null;function T(b){oe=b.point}function be(b){if(!oe||d!=="hover")return;let ye=oe.dist(b.point);oe=null,ye<3&&(n(10,B=b.lngLat),n(4,m=b.features??[]),G.isOpen()?n(25,E="justOpened"):(n(25,E="opening"),n(0,N=!0)))}function Ue(b){d!=="hover"||oe||E!=="normal"||(n(0,N=!1),n(4,m=null))}function Je(b){if(!(d!=="hover"||oe||E!=="normal")){if(Oe(b)){n(0,N=!1),n(4,m=null);return}n(0,N=!0),n(4,m=b.features??[]),n(10,B=b.lngLat)}}function Se(b){if(E==="justOpened"){n(25,E="normal");return}if(!c)return;let ye=[te,a instanceof Fe.Marker?a==null?void 0:a.getElement():null];N&&G.isOpen()&&!ye.some(it=>it==null?void 0:it.contains(b.originalEvent.target))&&(b.type==="contextmenu"&&d==="contextmenu"||b.type!=="contextmenu")&&n(0,N=!1)}Wt(()=>{l&&(G!=null&&G.isOpen())&&G.remove()});let h;const V=()=>n(0,N=!1);function fe(b){le[b?"unshift":"push"](()=>{h=b,n(1,h)})}return t.$$set=b=>{"closeButton"in b&&n(11,g=b.closeButton),"closeOnClickOutside"in b&&n(12,c=b.closeOnClickOutside),"closeOnClickInside"in b&&n(13,_=b.closeOnClickInside),"closeOnMove"in b&&n(14,u=b.closeOnMove),"openOn"in b&&n(15,d=b.openOn),"openIfTopMost"in b&&n(16,I=b.openIfTopMost),"focusAfterOpen"in b&&n(17,q=b.focusAfterOpen),"anchor"in b&&n(18,U=b.anchor),"offset"in b&&n(19,P=b.offset),"popupClass"in b&&n(20,v=b.popupClass),"maxWidth"in b&&n(21,C=b.maxWidth),"lngLat"in b&&n(10,B=b.lngLat),"html"in b&&n(22,K=b.html),"open"in b&&n(0,N=b.open),"$$scope"in b&&n(29,f=b.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=g??(!c&&!_)),t.$$.dirty[0]&146685952&&(G||(n(23,G=new Fe.Popup({closeButton:r,closeOnClick:!1,closeOnMove:u,focusAfterOpen:q,maxWidth:C,className:v,anchor:U,offset:P})),te=G.getElement(),G.on("open",()=>{n(0,N=!0),W(),ee("open",G)}),G.on("close",()=>{n(0,N=!1),ee("close",G)}),G.on("hover",()=>{ee("hover",G)}))),t.$$.dirty[0]&8421384&&G&&a instanceof Fe.Marker&&(d==="click"?a.setPopup(G):a.getPopup()===G&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&J.includes(d)&&(i==null?void 0:i.type)===d&&(Z(i),He(ke,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=d==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&d==="hover"&&ke&&(o&&i&&(i.layerType==="deckgl"?(n(10,B=i.coordinate),n(4,m=i.object?[i.object]:null)):(n(10,B=i.lngLat),n(4,m=i.features??[]))),n(0,N=(o||X)??!1)),t.$$.dirty[0]&12582914&&(h?G.setDOMContent(h):K&&G.setHTML(K)),t.$$.dirty[0]&8389632&&B&&G.setLngLat(B),t.$$.dirty[0]&41943045&&l){let b=G.isOpen();N&&!b?(G.addTo(l),E==="opening"&&n(25,E="justOpened")):!N&&b&&G.remove()}},[N,h,l,a,m,M,k,ke,Pe,j,B,g,c,_,u,d,I,q,U,P,v,C,K,G,X,E,o,r,i,f,p,V,fe]}class Gn extends Te{constructor(e){super(),Ae(this,e,Nn,qn,Ie,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function zn(t){let e;const n=t[16].default,r=Ze(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Qe(r,n,o,o[24],e?xe(n,o[24],l,null):Ye(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){$(r,o),e=!1},d(o){r&&r.d(o)}}}function Dn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[zn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Xt({props:l}),le.push(()=>ue(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){A(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){S(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],se(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){$(e.$$.fragment,i),r=!1},d(i){F(e,i)}}}function Hn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Kt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:f=void 0}=e,{layout:j=void 0}=e,{filter:g=void 0}=e,{applyToClusters:c=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:u=void 0}=e,{hoverCursor:d=void 0}=e,{manageHoverState:I=!1}=e,{hovered:q=null}=e,{eventsIfTopMost:U=!1}=e,{interactive:P=!0}=e;function v(k){q=k,n(0,q)}function C(k){pe.call(this,t,k)}function B(k){pe.call(this,t,k)}function K(k){pe.call(this,t,k)}function N(k){pe.call(this,t,k)}function ee(k){pe.call(this,t,k)}function M(k){pe.call(this,t,k)}return t.$$set=k=>{"id"in k&&n(1,l=k.id),"source"in k&&n(2,i=k.source),"sourceLayer"in k&&n(3,a=k.sourceLayer),"beforeId"in k&&n(4,s=k.beforeId),"beforeLayerType"in k&&n(5,p=k.beforeLayerType),"paint"in k&&n(6,f=k.paint),"layout"in k&&n(7,j=k.layout),"filter"in k&&n(8,g=k.filter),"applyToClusters"in k&&n(9,c=k.applyToClusters),"minzoom"in k&&n(10,_=k.minzoom),"maxzoom"in k&&n(11,u=k.maxzoom),"hoverCursor"in k&&n(12,d=k.hoverCursor),"manageHoverState"in k&&n(13,I=k.manageHoverState),"hovered"in k&&n(0,q=k.hovered),"eventsIfTopMost"in k&&n(14,U=k.eventsIfTopMost),"interactive"in k&&n(15,P=k.interactive),"$$scope"in k&&n(24,o=k.$$scope)},[q,l,i,a,s,p,f,j,g,c,_,u,d,I,U,P,r,v,C,B,K,N,ee,M,o]}class Rn extends Te{constructor(e){super(),Ae(this,e,Hn,Dn,Ie,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Un=t=>({props:t&8}),Pt=t=>({props:Vn(t[3])});function Jn(t){let e,n;const r=t[1].default,o=Ze(r,t,t[2],Pt);return{c(){e=ne("div"),o&&o.c(),this.h()},l(l){e=re(l,"DIV",{class:!0});var i=ae(e);o&&o.l(i),i.forEach(y),this.h()},h(){et(e,"class","govuk-prose")},m(l,i){L(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&Qe(o,r,l,l[2],n?xe(r,l[2],i,Un):Ye(l[2]),Pt)},i(l){n||(w(o,l),n=!0)},o(l){$(o,l),n=!1},d(l){l&&y(e),o&&o.d(l)}}}function Wn(t){let e,n;return e=new Gn({props:{openOn:t[0],$$slots:{default:[Jn,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){S(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){$(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function Vn(t){return t?t[0].properties??{}:{}}function Xn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Yt extends Te{constructor(e){super(),Ae(this,e,Xn,Wn,Ie,{openOn:0})}}var Kn=Object.defineProperty,H=(t,e)=>Kn(t,"name",{value:e,configurable:!0}),Zn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ge(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=st(e),o=st(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ge(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ge(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ge(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};H(Zn,"GeojsonEquality");function Ge(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}H(Ge,"sameLength");function st(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}H(st,"explode");var me=63710088e-1,xt={centimeters:me*100,centimetres:me*100,degrees:360/(2*Math.PI),feet:me*3.28084,inches:me*39.37,kilometers:me/1e3,kilometres:me/1e3,meters:me,metres:me,miles:me/1609.344,millimeters:me*1e3,millimetres:me*1e3,nauticalmiles:me/1852,radians:1,yards:me*1.0936},Mt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $e(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}H($e,"feature");function Qn(t,e,n={}){switch(t){case"Point":return tt(e).geometry;case"LineString":return pt(e).geometry;case"Polygon":return gt(e).geometry;case"MultiPoint":return tn(e).geometry;case"MultiLineString":return en(e).geometry;case"MultiPolygon":return nn(e).geometry;default:throw new Error(t+" is invalid")}}H(Qn,"geometry");function tt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!qe(t[0])||!qe(t[1]))throw new Error("coordinates must contain numbers");return $e({type:"Point",coordinates:t},e,n)}H(tt,"point");function Yn(t,e,n={}){return nt(t.map(r=>tt(r,e)),n)}H(Yn,"points");function gt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return $e({type:"Polygon",coordinates:t},e,n)}H(gt,"polygon");function xn(t,e,n={}){return nt(t.map(r=>gt(r,e)),n)}H(xn,"polygons");function pt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return $e({type:"LineString",coordinates:t},e,n)}H(pt,"lineString");function er(t,e,n={}){return nt(t.map(r=>pt(r,e)),n)}H(er,"lineStrings");function nt(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}H(nt,"featureCollection");function en(t,e,n={}){return $e({type:"MultiLineString",coordinates:t},e,n)}H(en,"multiLineString");function tn(t,e,n={}){return $e({type:"MultiPoint",coordinates:t},e,n)}H(tn,"multiPoint");function nn(t,e,n={}){return $e({type:"MultiPolygon",coordinates:t},e,n)}H(nn,"multiPolygon");function tr(t,e,n={}){return $e({type:"GeometryCollection",geometries:t},e,n)}H(tr,"geometryCollection");function nr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}H(nr,"round");function rn(t,e="kilometers"){const n=xt[e];if(!n)throw new Error(e+" units is invalid");return t*n}H(rn,"radiansToLength");function rt(t,e="kilometers"){const n=xt[e];if(!n)throw new Error(e+" units is invalid");return t/n}H(rt,"lengthToRadians");function rr(t,e){return Ke(rt(t,e))}H(rr,"lengthToDegrees");function or(t){let e=t%360;return e<0&&(e+=360),e}H(or,"bearingToAzimuth");function Ke(t){return t%(2*Math.PI)*180/Math.PI}H(Ke,"radiansToDegrees");function Xe(t){return t%360*Math.PI/180}H(Xe,"degreesToRadians");function ir(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return rn(rt(t,e),n)}H(ir,"convertLength");function lr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Mt[e];if(!r)throw new Error("invalid original units");const o=Mt[n];if(!o)throw new Error("invalid final units");return t/r*o}H(lr,"convertArea");function qe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}H(qe,"isNumber");function ar(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}H(ar,"isObject");function sr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!qe(e))throw new Error("bbox must only contain numbers")})}H(sr,"validateBBox");function ur(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}H(ur,"validateId");var fr=Object.defineProperty,Le=(t,e)=>fr(t,"name",{value:e,configurable:!0});function on(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Le(on,"getCoord");function mr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Le(mr,"getCoords");function ln(t){if(t.length>1&&qe(t[0])&&qe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return ln(t[0]);throw new Error("coordinates must only contain numbers")}Le(ln,"containsNumber");function cr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}Le(cr,"geojsonType");function gr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}Le(gr,"featureOf");function pr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}Le(pr,"collectionOf");function dr(t){return t.type==="Feature"?t.geometry:t}Le(dr,"getGeom");function _r(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Le(_r,"getType");var hr=Object.defineProperty,br=(t,e)=>hr(t,"name",{value:e,configurable:!0});function an(t,e,n,r={}){const o=on(t),l=Xe(o[0]),i=Xe(o[1]),a=Xe(n),s=rt(e,r.units),p=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),f=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(p)),j=Ke(f),g=Ke(p);return tt([j,g],r.properties)}br(an,"destination");var yr=an,vr=Object.defineProperty,R=(t,e)=>vr(t,"name",{value:e,configurable:!0}),wr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!ze(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=ut(e),o=ut(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!ze(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return ze(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return ze(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};R(wr,"GeojsonEquality");function ze(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}R(ze,"sameLength");function ut(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}R(ut,"explode");var ce=63710088e-1,sn={centimeters:ce*100,centimetres:ce*100,degrees:360/(2*Math.PI),feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},It={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ce(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}R(Ce,"feature");function kr(t,e,n={}){switch(t){case"Point":return dt(e).geometry;case"LineString":return ht(e).geometry;case"Polygon":return _t(e).geometry;case"MultiPoint":return fn(e).geometry;case"MultiLineString":return un(e).geometry;case"MultiPolygon":return mn(e).geometry;default:throw new Error(t+" is invalid")}}R(kr,"geometry");function dt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ne(t[0])||!Ne(t[1]))throw new Error("coordinates must contain numbers");return Ce({type:"Point",coordinates:t},e,n)}R(dt,"point");function jr(t,e,n={}){return ot(t.map(r=>dt(r,e)),n)}R(jr,"points");function _t(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return Ce({type:"Polygon",coordinates:t},e,n)}R(_t,"polygon");function $r(t,e,n={}){return ot(t.map(r=>_t(r,e)),n)}R($r,"polygons");function ht(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Ce({type:"LineString",coordinates:t},e,n)}R(ht,"lineString");function Lr(t,e,n={}){return ot(t.map(r=>ht(r,e)),n)}R(Lr,"lineStrings");function ot(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}R(ot,"featureCollection");function un(t,e,n={}){return Ce({type:"MultiLineString",coordinates:t},e,n)}R(un,"multiLineString");function fn(t,e,n={}){return Ce({type:"MultiPoint",coordinates:t},e,n)}R(fn,"multiPoint");function mn(t,e,n={}){return Ce({type:"MultiPolygon",coordinates:t},e,n)}R(mn,"multiPolygon");function Cr(t,e,n={}){return Ce({type:"GeometryCollection",geometries:t},e,n)}R(Cr,"geometryCollection");function Er(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}R(Er,"round");function cn(t,e="kilometers"){const n=sn[e];if(!n)throw new Error(e+" units is invalid");return t*n}R(cn,"radiansToLength");function bt(t,e="kilometers"){const n=sn[e];if(!n)throw new Error(e+" units is invalid");return t/n}R(bt,"lengthToRadians");function Pr(t,e){return yt(bt(t,e))}R(Pr,"lengthToDegrees");function Mr(t){let e=t%360;return e<0&&(e+=360),e}R(Mr,"bearingToAzimuth");function yt(t){return t%(2*Math.PI)*180/Math.PI}R(yt,"radiansToDegrees");function De(t){return t%360*Math.PI/180}R(De,"degreesToRadians");function Ir(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return cn(bt(t,e),n)}R(Ir,"convertLength");function Tr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=It[e];if(!r)throw new Error("invalid original units");const o=It[n];if(!o)throw new Error("invalid final units");return t/r*o}R(Tr,"convertArea");function Ne(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}R(Ne,"isNumber");function Ar(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}R(Ar,"isObject");function Or(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ne(e))throw new Error("bbox must only contain numbers")})}R(Or,"validateBBox");function Sr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}R(Sr,"validateId");var Fr=Object.defineProperty,Ee=(t,e)=>Fr(t,"name",{value:e,configurable:!0});function ft(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Ee(ft,"getCoord");function Br(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Ee(Br,"getCoords");function gn(t){if(t.length>1&&Ne(t[0])&&Ne(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return gn(t[0]);throw new Error("coordinates must only contain numbers")}Ee(gn,"containsNumber");function qr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}Ee(qr,"geojsonType");function Nr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}Ee(Nr,"featureOf");function Gr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}Ee(Gr,"collectionOf");function zr(t){return t.type==="Feature"?t.geometry:t}Ee(zr,"getGeom");function Dr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Ee(Dr,"getType");var Hr=Object.defineProperty,pn=(t,e)=>Hr(t,"name",{value:e,configurable:!0});function vt(t,e,n={}){if(n.final===!0)return dn(t,e);const r=ft(t),o=ft(e),l=De(r[0]),i=De(o[0]),a=De(r[1]),s=De(o[1]),p=Math.sin(i-l)*Math.cos(s),f=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return yt(Math.atan2(p,f))}pn(vt,"bearing");function dn(t,e){let n=vt(e,t);return n=(n+180)%360,n}pn(dn,"calculateFinalBearing");var Rr=vt;function Ur(t){let e,n,r,o,l,i,a,s,p,f,j,g;function c(v){t[6](v)}let _={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new ct({props:_}),le.push(()=>ue(e,"value",c));function u(v){t[7](v)}let d={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new $t({props:d}),le.push(()=>ue(o,"value",u));function I(v){t[8](v)}let q={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(q.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new $t({props:q}),le.push(()=>ue(a,"value",I));function U(v){t[9](v)}let P={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(P.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),f=new Qt({props:P}),le.push(()=>ue(f,"value",U)),{c(){A(e.$$.fragment),r=z(),A(o.$$.fragment),i=z(),A(a.$$.fragment),p=z(),A(f.$$.fragment)},l(v){O(e.$$.fragment,v),r=D(v),O(o.$$.fragment,v),i=D(v),O(a.$$.fragment,v),p=D(v),O(f.$$.fragment,v)},m(v,C){S(e,v,C),L(v,r,C),S(o,v,C),L(v,i,C),S(a,v,C),L(v,p,C),S(f,v,C),g=!0},p(v,[C]){const B={};!n&&C&15&&(n=!0,B.value=v[3].jat[v[0]][v[1]].movements[v[2]].name,se(()=>n=!1)),e.$set(B);const K={};!l&&C&15&&(l=!0,K.value=v[3].jat[v[0]][v[1]].movements[v[2]].kind,se(()=>l=!1)),o.$set(K);const N={};!s&&C&15&&(s=!0,N.value=v[3].jat[v[0]][v[1]].movements[v[2]].score,se(()=>s=!1)),a.$set(N);const ee={};!j&&C&15&&(j=!0,ee.value=v[3].jat[v[0]][v[1]].movements[v[2]].notes,se(()=>j=!1)),f.$set(ee)},i(v){g||(w(e.$$.fragment,v),w(o.$$.fragment,v),w(a.$$.fragment,v),w(f.$$.fragment,v),g=!0)},o(v){$(e.$$.fragment,v),$(o.$$.fragment,v),$(a.$$.fragment,v),$(f.$$.fragment,v),g=!1},d(v){v&&(y(r),y(i),y(p)),F(e,v),F(o,v),F(a,v),F(f,v)}}}function Jr(t,e,n){let r;Me(t,x,c=>n(3,r=c));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=An(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function p(c){t.$$.not_equal(r.jat[o][l].movements[i].name,c)&&(r.jat[o][l].movements[i].name=c,x.set(r))}function f(c){t.$$.not_equal(r.jat[o][l].movements[i].kind,c)&&(r.jat[o][l].movements[i].kind=c,x.set(r))}function j(c){t.$$.not_equal(r.jat[o][l].movements[i].score,c)&&(r.jat[o][l].movements[i].score=c,x.set(r))}function g(c){t.$$.not_equal(r.jat[o][l].movements[i].notes,c)&&(r.jat[o][l].movements[i].notes=c,x.set(r))}return t.$$set=c=>{"junctionIdx"in c&&n(0,o=c.junctionIdx),"stage"in c&&n(1,l=c.stage),"idx"in c&&n(2,i=c.idx)},[o,l,i,r,a,s,p,f,j,g]}class Wr extends Te{constructor(e){super(),Ae(this,e,Jr,Ur,Ie,{junctionIdx:0,stage:1,idx:2})}}const{window:Vr}=jn;function Tt(t,e,n){const r=t.slice();return r[46]=e[n],r[47]=e,r[48]=n,r}function At(t,e,n){const r=t.slice();return r[49]=e[n],r[50]=e,r[48]=n,r}function Ot(t,e,n){const r=t.slice();return r[46]=e[n],r[48]=n,r}function St(t,e,n){const r=t.slice();return r[49]=e[n],r[48]=n,r}function Xr(t){let e,n,r,o,l,i,a,s;e=new $n({props:{$$slots:{default:[Zr]},$$scope:{ctx:t}}}),e.$on("click",t[28]),r=new Vt({props:{$$slots:{default:[Qr]},$$scope:{ctx:t}}}),r.$on("click",t[14]);const p=[xr,Yr],f=[];function j(g,c){return g[2].kind=="movement"?0:1}return l=j(t),i=f[l]=p[l](t),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),i.c(),a=Be()},l(g){O(e.$$.fragment,g),n=D(g),O(r.$$.fragment,g),o=D(g),i.l(g),a=Be()},m(g,c){S(e,g,c),L(g,n,c),S(r,g,c),L(g,o,c),f[l].m(g,c),L(g,a,c),s=!0},p(g,c){const _={};c[1]&4194304&&(_.$$scope={dirty:c,ctx:g}),e.$set(_);const u={};c[1]&4194304&&(u.$$scope={dirty:c,ctx:g}),r.$set(u);let d=l;l=j(g),l===d?f[l].p(g,c):(de(),$(f[d],1,1,()=>{f[d]=null}),_e(),i=f[l],i?i.p(g,c):(i=f[l]=p[l](g),i.c()),w(i,1),i.m(a.parentNode,a))},i(g){s||(w(e.$$.fragment,g),w(r.$$.fragment,g),w(i),s=!0)},o(g){$(e.$$.fragment,g),$(r.$$.fragment,g),$(i),s=!1},d(g){g&&(y(n),y(o),y(a)),F(e,g),F(r,g),f[l].d(g)}}}function Kr(t){let e,n,r,o,l,i,a,s,p,f,j,g="Arms",c,_,u,d,I,q="Movements",U,P,v,C,B,K=Ht(t[4].jat[t[0]][t[1]])+"",N,ee,M;e=new we({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),e.$on("click",t[19]),r=new Cn({}),l=new En({});let k=t[5]&&Ft(t);function ke(m){t[21](m)}let Pe={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[6]!==void 0&&(Pe.value=t[6]),s=new Pn({props:Pe}),le.push(()=>ue(s,"value",ke));let he=ve(t[4].jat[t[0]][t[1]].arms),J=[];for(let m=0;m<he.length;m+=1)J[m]=Bt(St(t,he,m));const G=m=>$(J[m],1,1,()=>{J[m]=null});let X=t[4].jat[t[0]][t[9]].arms.length>0&&qt(t),te=ve(t[4].jat[t[0]][t[1]].movements),W=[];for(let m=0;m<te.length;m+=1)W[m]=Nt(Ot(t,te,m));const Oe=m=>$(W[m],1,1,()=>{W[m]=null});return{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment),i=z(),k&&k.c(),a=z(),A(s.$$.fragment),f=z(),j=ne("h3"),j.textContent=g,c=z(),_=ne("ul");for(let m=0;m<J.length;m+=1)J[m].c();u=z(),X&&X.c(),d=z(),I=ne("h3"),I.textContent=q,U=z(),P=ne("ol");for(let m=0;m<W.length;m+=1)W[m].c();v=z(),C=ne("p"),B=Q("Total JAT score: "),N=Q(K),ee=Q("%")},l(m){O(e.$$.fragment,m),n=D(m),O(r.$$.fragment,m),o=D(m),O(l.$$.fragment,m),i=D(m),k&&k.l(m),a=D(m),O(s.$$.fragment,m),f=D(m),j=re(m,"H3",{"data-svelte-h":!0}),wt(j)!=="svelte-ld74qb"&&(j.textContent=g),c=D(m),_=re(m,"UL",{});var E=ae(_);for(let T=0;T<J.length;T+=1)J[T].l(E);E.forEach(y),u=D(m),X&&X.l(m),d=D(m),I=re(m,"H3",{"data-svelte-h":!0}),wt(I)!=="svelte-1dc52s8"&&(I.textContent=q),U=D(m),P=re(m,"OL",{});var Z=ae(P);for(let T=0;T<W.length;T+=1)W[T].l(Z);Z.forEach(y),v=D(m),C=re(m,"P",{});var oe=ae(C);B=Y(oe,"Total JAT score: "),N=Y(oe,K),ee=Y(oe,"%"),oe.forEach(y)},m(m,E){S(e,m,E),L(m,n,E),S(r,m,E),L(m,o,E),S(l,m,E),L(m,i,E),k&&k.m(m,E),L(m,a,E),S(s,m,E),L(m,f,E),L(m,j,E),L(m,c,E),L(m,_,E);for(let Z=0;Z<J.length;Z+=1)J[Z]&&J[Z].m(_,null);L(m,u,E),X&&X.m(m,E),L(m,d,E),L(m,I,E),L(m,U,E),L(m,P,E);for(let Z=0;Z<W.length;Z+=1)W[Z]&&W[Z].m(P,null);L(m,v,E),L(m,C,E),ge(C,B),ge(C,N),ge(C,ee),M=!0},p(m,E){const Z={};E[1]&4194304&&(Z.$$scope={dirty:E,ctx:m}),e.$set(Z),m[5]?k?(k.p(m,E),E[0]&32&&w(k,1)):(k=Ft(m),k.c(),w(k,1),k.m(a.parentNode,a)):k&&(de(),$(k,1,1,()=>{k=null}),_e());const oe={};if(!p&&E[0]&64&&(p=!0,oe.value=m[6],se(()=>p=!1)),s.$set(oe),E[0]&2075){he=ve(m[4].jat[m[0]][m[1]].arms);let T;for(T=0;T<he.length;T+=1){const be=St(m,he,T);J[T]?(J[T].p(be,E),w(J[T],1)):(J[T]=Bt(be),J[T].c(),w(J[T],1),J[T].m(_,null))}for(de(),T=he.length;T<J.length;T+=1)G(T);_e()}if(m[4].jat[m[0]][m[9]].arms.length>0?X?(X.p(m,E),E[0]&17&&w(X,1)):(X=qt(m),X.c(),w(X,1),X.m(d.parentNode,d)):X&&(de(),$(X,1,1,()=>{X=null}),_e()),E[0]&2075){te=ve(m[4].jat[m[0]][m[1]].movements);let T;for(T=0;T<te.length;T+=1){const be=Ot(m,te,T);W[T]?(W[T].p(be,E),w(W[T],1)):(W[T]=Nt(be),W[T].c(),w(W[T],1),W[T].m(P,null))}for(de(),T=te.length;T<W.length;T+=1)Oe(T);_e()}(!M||E[0]&19)&&K!==(K=Ht(m[4].jat[m[0]][m[1]])+"")&&je(N,K)},i(m){if(!M){w(e.$$.fragment,m),w(r.$$.fragment,m),w(l.$$.fragment,m),w(k),w(s.$$.fragment,m);for(let E=0;E<he.length;E+=1)w(J[E]);w(X);for(let E=0;E<te.length;E+=1)w(W[E]);M=!0}},o(m){$(e.$$.fragment,m),$(r.$$.fragment,m),$(l.$$.fragment,m),$(k),$(s.$$.fragment,m),J=J.filter(Boolean);for(let E=0;E<J.length;E+=1)$(J[E]);$(X),W=W.filter(Boolean);for(let E=0;E<W.length;E+=1)$(W[E]);M=!1},d(m){m&&(y(n),y(o),y(i),y(a),y(f),y(j),y(c),y(_),y(u),y(d),y(I),y(U),y(P),y(v),y(C)),F(e,m),F(r,m),F(l,m),k&&k.d(m),F(s,m),Re(J,m),X&&X.d(m),Re(W,m)}}}function Zr(t){let e;return{c(){e=Q("Save")},l(n){e=Y(n,"Save")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function Qr(t){let e;return{c(){e=Q("Delete")},l(n){e=Y(n,"Delete")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function Yr(t){let e,n,r;function o(i){t[29](i)}let l={label:"Arm Name"};return t[4].jat[t[0]][t[1]].arms[t[2].idx].name!==void 0&&(l.value=t[4].jat[t[0]][t[1]].arms[t[2].idx].name),e=new ct({props:l}),le.push(()=>ue(e,"value",o)),{c(){A(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){S(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&23&&(n=!0,s.value=i[4].jat[i[0]][i[1]].arms[i[2].idx].name,se(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){$(e.$$.fragment,i),r=!1},d(i){F(e,i)}}}function xr(t){let e,n;return e=new Wr({props:{junctionIdx:t[0],stage:t[1],idx:t[2].idx}}),{c(){A(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){S(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&4&&(l.idx=r[2].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){$(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function eo(t){let e;return{c(){e=Q("Zoom to fit")},l(n){e=Y(n,"Zoom to fit")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function Ft(t){let e,n,r;function o(i){t[20](i)}let l={map:t[5]};return t[7]!==void 0&&(l.enabled=t[7]),e=new Mn({props:l}),le.push(()=>ue(e,"enabled",o)),{c(){A(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){S(e,i,a),r=!0},p(i,a){const s={};a[0]&32&&(s.map=i[5]),!n&&a[0]&128&&(n=!0,s.enabled=i[7],se(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){$(e.$$.fragment,i),r=!1},d(i){F(e,i)}}}function to(t){let e=_n(t[48])+"",n,r,o=(t[49].name||"Unnamed arm")+"",l;return{c(){n=Q(e),r=Q(" - "),l=Q(o)},l(i){n=Y(i,e),r=Y(i," - "),l=Y(i,o)},m(i,a){L(i,n,a),L(i,r,a),L(i,l,a)},p(i,a){a[0]&19&&o!==(o=(i[49].name||"Unnamed arm")+"")&&je(l,o)},d(i){i&&(y(n),y(r),y(l))}}}function Bt(t){let e,n,r,o;function l(){return t[22](t[48])}function i(){return t[23](t[48])}return n=new we({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[24]),{c(){e=ne("li"),A(n.$$.fragment),r=z()},l(a){e=re(a,"LI",{});var s=ae(e);O(n.$$.fragment,s),r=D(s),s.forEach(y)},m(a,s){L(a,e,s),S(n,e,null),ge(e,r),o=!0},p(a,s){t=a;const p={};s[0]&19|s[1]&4194304&&(p.$$scope={dirty:s,ctx:t}),n.$set(p)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){$(n.$$.fragment,a),o=!1},d(a){a&&y(e),F(n)}}}function qt(t){let e,n;return e=new we({props:{$$slots:{default:[no]},$$scope:{ctx:t}}}),e.$on("click",t[17]),{c(){A(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){S(e,r,o),n=!0},p(r,o){const l={};o[1]&4194304&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){$(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function no(t){let e,n;return{c(){e=Q("Copy arms from "),n=Q(t[9])},l(r){e=Y(r,"Copy arms from "),n=Y(r,t[9])},m(r,o){L(r,e,o),L(r,n,o)},p:mt,d(r){r&&(y(e),y(n))}}}function ro(t){let e=(t[46].name||"Unnamed movement")+"",n;return{c(){n=Q(e)},l(r){n=Y(r,e)},m(r,o){L(r,n,o)},p(r,o){o[0]&19&&e!==(e=(r[46].name||"Unnamed movement")+"")&&je(n,e)},d(r){r&&y(n)}}}function Nt(t){let e,n,r,o;function l(){return t[25](t[48])}function i(){return t[26](t[48])}return n=new we({props:{$$slots:{default:[ro]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[27]),{c(){e=ne("li"),A(n.$$.fragment),r=z()},l(a){e=re(a,"LI",{});var s=ae(e);O(n.$$.fragment,s),r=D(s),s.forEach(y)},m(a,s){L(a,e,s),S(n,e,null),ge(e,r),o=!0},p(a,s){t=a;const p={};s[0]&19|s[1]&4194304&&(p.$$scope={dirty:s,ctx:t}),n.$set(p)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){$(n.$$.fragment,a),o=!1},d(a){a&&y(e),F(n)}}}function oo(t){let e,n=_n(t[48])+"",r;return{c(){e=ne("span"),r=Q(n),this.h()},l(o){e=re(o,"SPAN",{class:!0});var l=ae(e);r=Y(l,n),l.forEach(y),this.h()},h(){et(e,"class","dot svelte-o3xbby"),ie(e,"color","#4472c4"),ie(e,"background-color","white")},m(o,l){L(o,e,l),ge(e,r)},p:mt,d(o){o&&y(e)}}}function Gt(t){let e,n,r;function o(s){t[30](s,t[49])}function l(){return t[31](t[48])}function i(){return t[32](t[48])}let a={draggable:!0,$$slots:{default:[oo]},$$scope:{ctx:t}};return t[49].point!==void 0&&(a.lngLat=t[49].point),e=new lt({props:a}),le.push(()=>ue(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){A(e.$$.fragment)},l(s){O(e.$$.fragment,s)},m(s,p){S(e,s,p),r=!0},p(s,p){t=s;const f={};p[1]&4194304&&(f.$$scope={dirty:p,ctx:t}),!n&&p[0]&19&&(n=!0,f.lngLat=t[49].point,se(()=>n=!1)),e.$set(f)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){$(e.$$.fragment,s),r=!1},d(s){F(e,s)}}}function io(t){let e;return{c(){e=ne("span"),this.h()},l(n){e=re(n,"SPAN",{class:!0}),ae(e).forEach(y),this.h()},h(){et(e,"class","dot svelte-o3xbby"),ie(e,"background-color",t[10][t[46].score]),ie(e,"opacity",t[46].kind=="pedestrian"?"0%":"100%")},m(n,r){L(n,e,r)},p(n,r){r[0]&19&&ie(e,"background-color",n[10][n[46].score]),r[0]&19&&ie(e,"opacity",n[46].kind=="pedestrian"?"0%":"100%")},d(n){n&&y(e)}}}function lo(t){let e;return{c(){e=ne("span"),this.h()},l(n){e=re(n,"SPAN",{class:!0}),ae(e).forEach(y),this.h()},h(){et(e,"class","dot svelte-o3xbby"),ie(e,"background-color",t[10][t[46].score]),ie(e,"opacity","0%")},m(n,r){L(n,e,r)},p(n,r){r[0]&19&&ie(e,"background-color",n[10][n[46].score])},d(n){n&&y(e)}}}function zt(t){let e,n,r,o,l,i;function a(u){t[33](u,t[46])}function s(){return t[34](t[48])}function p(){return t[35](t[48])}let f={draggable:!0,$$slots:{default:[io]},$$scope:{ctx:t}};t[46].point1!==void 0&&(f.lngLat=t[46].point1),e=new lt({props:f}),le.push(()=>ue(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",p);function j(u){t[36](u,t[46])}function g(){return t[37](t[48])}function c(){return t[38](t[48])}let _={draggable:!0,$$slots:{default:[lo]},$$scope:{ctx:t}};return t[46].point2!==void 0&&(_.lngLat=t[46].point2),o=new lt({props:_}),le.push(()=>ue(o,"lngLat",j)),o.$on("dragend",g),o.$on("click",c),{c(){A(e.$$.fragment),r=z(),A(o.$$.fragment)},l(u){O(e.$$.fragment,u),r=D(u),O(o.$$.fragment,u)},m(u,d){S(e,u,d),L(u,r,d),S(o,u,d),i=!0},p(u,d){t=u;const I={};d[0]&19|d[1]&4194304&&(I.$$scope={dirty:d,ctx:t}),!n&&d[0]&19&&(n=!0,I.lngLat=t[46].point1,se(()=>n=!1)),e.$set(I);const q={};d[0]&19|d[1]&4194304&&(q.$$scope={dirty:d,ctx:t}),!l&&d[0]&19&&(l=!0,q.lngLat=t[46].point2,se(()=>l=!1)),o.$set(q)},i(u){i||(w(e.$$.fragment,u),w(o.$$.fragment,u),i=!0)},o(u){$(e.$$.fragment,u),$(o.$$.fragment,u),i=!1},d(u){u&&y(r),F(e,u),F(o,u)}}}function ao(t){let e=(t[45].name||"Untitled movement")+"",n;return{c(){n=Q(e)},l(r){n=Y(r,e)},m(r,o){L(r,n,o)},p(r,o){o[1]&16384&&e!==(e=(r[45].name||"Untitled movement")+"")&&je(n,e)},d(r){r&&y(n)}}}function so(t){let e,n;return e=new Yt({props:{$$slots:{default:[ao,({props:r})=>({45:r}),({props:r})=>[0,r?16384:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){S(e,r,o),n=!0},p(r,o){const l={};o[1]&4210688&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){$(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function uo(t){let e=(t[45].name||"Untitled movement")+"",n;return{c(){n=Q(e)},l(r){n=Y(r,e)},m(r,o){L(r,n,o)},p(r,o){o[1]&16384&&e!==(e=(r[45].name||"Untitled movement")+"")&&je(n,e)},d(r){r&&y(n)}}}function fo(t){let e,n;return e=new Yt({props:{$$slots:{default:[uo,({props:r})=>({45:r}),({props:r})=>[0,r?16384:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){S(e,r,o),n=!0},p(r,o){const l={};o[1]&4210688&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){$(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function mo(t){let e,n,r,o,l,i;return e=new at({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":jt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[so]},$$scope:{ctx:t}}}),e.$on("click",t[12]),r=new at({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":jt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[fo]},$$scope:{ctx:t}}}),r.$on("click",t[12]),l=new Rn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment)},l(a){O(e.$$.fragment,a),n=D(a),O(r.$$.fragment,a),o=D(a),O(l.$$.fragment,a)},m(a,s){S(e,a,s),L(a,n,s),S(r,a,s),L(a,o,s),S(l,a,s),i=!0},p(a,s){const p={};s[1]&4194304&&(p.$$scope={dirty:s,ctx:a}),e.$set(p);const f={};s[1]&4194304&&(f.$$scope={dirty:s,ctx:a}),r.$set(f)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){$(e.$$.fragment,a),$(r.$$.fragment,a),$(l.$$.fragment,a),i=!1},d(a){a&&(y(n),y(o)),F(e,a),F(r,a),F(l,a)}}}function co(t){let e,n,r,o;return e=new at({props:{paint:{"line-width":15,"line-color":"yellow"}}}),r=new Tn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-color":"yellow","circle-radius":20}}}),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment)},l(l){O(e.$$.fragment,l),n=D(l),O(r.$$.fragment,l)},m(l,i){S(e,l,i),L(l,n,i),S(r,l,i),o=!0},p:mt,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){$(e.$$.fragment,l),$(r.$$.fragment,l),o=!1},d(l){l&&y(n),F(e,l),F(r,l)}}}function go(t){let e,n,r,o,l,i,a,s,p=ve(t[4].jat[t[0]][t[1]].arms),f=[];for(let u=0;u<p.length;u+=1)f[u]=Gt(At(t,p,u));const j=u=>$(f[u],1,1,()=>{f[u]=null});let g=ve(t[4].jat[t[0]][t[1]].movements),c=[];for(let u=0;u<g.length;u+=1)c[u]=zt(Tt(t,g,u));const _=u=>$(c[u],1,1,()=>{c[u]=null});return r=new kt({props:{data:t[13](t[4]),$$slots:{default:[mo]},$$scope:{ctx:t}}}),l=new kt({props:{data:t[8],$$slots:{default:[co]},$$scope:{ctx:t}}}),a=new In({props:{map:t[5]}}),{c(){for(let u=0;u<f.length;u+=1)f[u].c();e=z();for(let u=0;u<c.length;u+=1)c[u].c();n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment),i=z(),A(a.$$.fragment)},l(u){for(let d=0;d<f.length;d+=1)f[d].l(u);e=D(u);for(let d=0;d<c.length;d+=1)c[d].l(u);n=D(u),O(r.$$.fragment,u),o=D(u),O(l.$$.fragment,u),i=D(u),O(a.$$.fragment,u)},m(u,d){for(let I=0;I<f.length;I+=1)f[I]&&f[I].m(u,d);L(u,e,d);for(let I=0;I<c.length;I+=1)c[I]&&c[I].m(u,d);L(u,n,d),S(r,u,d),L(u,o,d),S(l,u,d),L(u,i,d),S(a,u,d),s=!0},p(u,d){if(d[0]&2067){p=ve(u[4].jat[u[0]][u[1]].arms);let P;for(P=0;P<p.length;P+=1){const v=At(u,p,P);f[P]?(f[P].p(v,d),w(f[P],1)):(f[P]=Gt(v),f[P].c(),w(f[P],1),f[P].m(e.parentNode,e))}for(de(),P=p.length;P<f.length;P+=1)j(P);_e()}if(d[0]&3091){g=ve(u[4].jat[u[0]][u[1]].movements);let P;for(P=0;P<g.length;P+=1){const v=Tt(u,g,P);c[P]?(c[P].p(v,d),w(c[P],1)):(c[P]=zt(v),c[P].c(),w(c[P],1),c[P].m(n.parentNode,n))}for(de(),P=g.length;P<c.length;P+=1)_(P);_e()}const I={};d[0]&16&&(I.data=u[13](u[4])),d[1]&4194304&&(I.$$scope={dirty:d,ctx:u}),r.$set(I);const q={};d[0]&256&&(q.data=u[8]),d[1]&4194304&&(q.$$scope={dirty:d,ctx:u}),l.$set(q);const U={};d[0]&32&&(U.map=u[5]),a.$set(U)},i(u){if(!s){for(let d=0;d<p.length;d+=1)w(f[d]);for(let d=0;d<g.length;d+=1)w(c[d]);w(r.$$.fragment,u),w(l.$$.fragment,u),w(a.$$.fragment,u),s=!0}},o(u){f=f.filter(Boolean);for(let d=0;d<f.length;d+=1)$(f[d]);c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)$(c[d]);$(r.$$.fragment,u),$(l.$$.fragment,u),$(a.$$.fragment,u),s=!1},d(u){u&&(y(e),y(n),y(o),y(i)),Re(f,u),Re(c,u),F(r,u),F(l,u),F(a,u)}}}function po(t){let e,n,r,o,l,i,a,s,p,f,j,g,c,_;function u(C){t[18](C)}let d={label:"Commentary / Notes"};t[4].jat[t[0]][t[1]].notes!==void 0&&(d.value=t[4].jat[t[0]][t[1]].notes),e=new Qt({props:d}),le.push(()=>ue(e,"value",u));const I=[Kr,Xr],q=[];function U(C,B){return C[2]==null?0:1}i=U(t),a=q[i]=I[i](t);function P(C){t[39](C)}let v={$$slots:{default:[go]},$$scope:{ctx:t}};return t[5]!==void 0&&(v.map=t[5]),f=new kn({props:v}),le.push(()=>ue(f,"map",P)),{c(){A(e.$$.fragment),r=z(),o=ne("div"),l=ne("div"),a.c(),s=z(),p=ne("div"),A(f.$$.fragment),this.h()},l(C){O(e.$$.fragment,C),r=D(C),o=re(C,"DIV",{style:!0});var B=ae(o);l=re(B,"DIV",{style:!0});var K=ae(l);a.l(K),K.forEach(y),s=D(B),p=re(B,"DIV",{style:!0});var N=ae(p);O(f.$$.fragment,N),N.forEach(y),B.forEach(y),this.h()},h(){ie(l,"width","30%"),ie(l,"overflow-y","scroll"),ie(l,"padding","10px"),ie(p,"position","relative"),ie(p,"width","100%"),ie(o,"display","flex"),ie(o,"height","80vh")},m(C,B){S(e,C,B),L(C,r,B),L(C,o,B),ge(o,l),q[i].m(l,null),ge(o,s),ge(o,p),S(f,p,null),g=!0,c||(_=yn(Vr,"keydown",t[16]),c=!0)},p(C,B){const K={};!n&&B[0]&19&&(n=!0,K.value=C[4].jat[C[0]][C[1]].notes,se(()=>n=!1)),e.$set(K);let N=i;i=U(C),i===N?q[i].p(C,B):(de(),$(q[N],1,1,()=>{q[N]=null}),_e(),a=q[i],a?a.p(C,B):(a=q[i]=I[i](C),a.c()),w(a,1),a.m(l,null));const ee={};B[0]&307|B[1]&4194304&&(ee.$$scope={dirty:B,ctx:C}),!j&&B[0]&32&&(j=!0,ee.map=C[5],se(()=>j=!1)),f.$set(ee)},i(C){g||(w(e.$$.fragment,C),w(a),w(f.$$.fragment,C),g=!0)},o(C){$(e.$$.fragment,C),$(a),$(f.$$.fragment,C),g=!1},d(C){C&&(y(r),y(o)),F(e,C),q[i].d(),F(f),c=!1,_()}}}function Dt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function _n(t){return String.fromCharCode(t+65)}function Ht(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function _o(t,e,n){let r,o;Me(t,x,h=>n(4,o=h));let{junctionIdx:l}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s,p="arm",f=null,j=null,g=!1,c={0:We.red.background,1:We.amber.background,2:We.green.background,X:We.critical.background};function _(h,V,fe){let b={type:"FeatureCollection",features:[]},ye=V??fe;return ye!=null&&(ye.kind=="arm"?b.features.push(Dt(h.jat[l][i].arms[ye.idx],ye.idx)):b.features.push(U(h.jat[l][i].movements[ye.idx],ye.idx))),b}function u(h){n(2,f=h),n(3,j=null)}function d(h){if(!g){for(let V of s.queryRenderedFeatures(h.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(f!=null){n(2,f=null);return}p=="arm"?(He(x,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:h.lngLat.toArray(),name:""}],o),n(2,f={kind:"arm",idx:o.jat[l][i].arms.length-1})):(He(x,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:h.lngLat.toArray(),point2:yr(h.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(2,f={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(3,j=null)}}function I(h){u({kind:"movement",idx:h.detail.features[0].id})}Jt(()=>{s.on("click",d),C(!1)}),Wt(()=>{s.off("click",d)});function q(h){let V={type:"FeatureCollection",features:h.jat[l][i].movements.map((fe,b)=>U(fe,b))};for(let fe of h.jat[l][i].movements)if(V.features.push(P(fe,V.features.length)),fe.kind=="pedestrian"){let b={...fe,point1:fe.point2,point2:fe.point1};V.features.push(P(b,V.features.length))}for(let fe of h.jat[l][i].arms)V.features.push(Dt(fe,V.features.length));return V}function U(h,V){return{type:"Feature",id:V,properties:{name:h.name,kind:h.kind,color:c[h.score]},geometry:{type:"LineString",coordinates:[h.point1,h.point2]}}}function P(h,V){return{type:"Feature",id:V,properties:{kind:h.kind,color:c[h.score],angle:Rr(h.point1,h.point2)},geometry:{type:"Point",coordinates:h.point2}}}function v(){window.confirm(`Delete this ${f.kind}?`)&&(f.kind=="movement"?(o.jat[l][i].movements.splice(f.idx,1),x.set(o)):(o.jat[l][i].arms.splice(f.idx,1),x.set(o)),n(2,f=null))}function C(h){let V=q(o);V.features.length>0&&s.fitBounds(Ln(V),{padding:20,animate:h})}function B(h){f!=null&&h.key=="Escape"?(h.stopPropagation(),n(2,f=null)):f!=null&&h.key=="Delete"&&v()}function K(){o.jat[l][i].arms.length>0&&!window.confirm("Overwrite arms?")||(He(x,o.jat[l][i].arms=JSON.parse(JSON.stringify(o.jat[l][a].arms)),o),x.set(o))}function N(h){t.$$.not_equal(o.jat[l][i].notes,h)&&(o.jat[l][i].notes=h,x.set(o))}const ee=()=>C(!0);function M(h){g=h,n(7,g)}function k(h){p=h,n(6,p)}const ke=h=>u({kind:"arm",idx:h}),Pe=h=>n(3,j={kind:"arm",idx:h}),he=()=>n(3,j=null),J=h=>u({kind:"movement",idx:h}),G=h=>n(3,j={kind:"movement",idx:h}),X=()=>n(3,j=null),te=()=>n(2,f=null);function W(h){t.$$.not_equal(o.jat[l][i].arms[f.idx].name,h)&&(o.jat[l][i].arms[f.idx].name=h,x.set(o))}function Oe(h,V){t.$$.not_equal(V.point,h)&&(V.point=h,x.set(o))}const m=h=>u({kind:"arm",idx:h}),E=h=>u({kind:"arm",idx:h});function Z(h,V){t.$$.not_equal(V.point1,h)&&(V.point1=h,x.set(o))}const oe=h=>u({kind:"movement",idx:h}),T=h=>u({kind:"movement",idx:h});function be(h,V){t.$$.not_equal(V.point2,h)&&(V.point2=h,x.set(o))}const Ue=h=>u({kind:"movement",idx:h}),Je=h=>u({kind:"movement",idx:h});function Se(h){s=h,n(5,s)}return t.$$set=h=>{"junctionIdx"in h&&n(0,l=h.junctionIdx),"stage"in h&&n(1,i=h.stage)},t.$$.update=()=>{t.$$.dirty[0]&28&&n(8,r=_(o,f,j))},[l,i,f,j,o,s,p,g,r,a,c,u,I,q,v,C,B,K,N,ee,M,k,ke,Pe,he,J,G,X,te,W,Oe,m,E,Z,oe,T,be,Ue,Je,Se]}class ho extends Te{constructor(e){super(),Ae(this,e,_o,po,Ie,{junctionIdx:0,stage:1},null,[-1,-1])}}function Rt(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function bo(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,p,f,j;return s=new we({props:{$$slots:{default:[wo]},$$scope:{ctx:t}}}),s.$on("click",t[10]),f=new ho({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=ne("h2"),r=Q(n),o=Q(" - "),i=Q(l),a=z(),A(s.$$.fragment),p=z(),A(f.$$.fragment)},l(g){e=re(g,"H2",{});var c=ae(e);r=Y(c,n),o=Y(c," - "),i=Y(c,l),c.forEach(y),a=D(g),O(s.$$.fragment,g),p=D(g),O(f.$$.fragment,g)},m(g,c){L(g,e,c),ge(e,r),ge(e,o),ge(e,i),L(g,a,c),S(s,g,c),L(g,p,c),S(f,g,c),j=!0},p(g,c){(!j||c&3)&&n!==(n=(g[1].jat[g[0].idx].name||"Untitled junction")+"")&&je(r,n),(!j||c&1)&&l!==(l=g[0].stage+"")&&je(i,l);const _={};c&16384&&(_.$$scope={dirty:c,ctx:g}),s.$set(_);const u={};c&1&&(u.junctionIdx=g[0].idx),c&1&&(u.stage=g[0].stage),f.$set(u)},i(g){j||(w(s.$$.fragment,g),w(f.$$.fragment,g),j=!0)},o(g){$(s.$$.fragment,g),$(f.$$.fragment,g),j=!1},d(g){g&&(y(e),y(a),y(p)),F(s,g),F(f,g)}}}function yo(t){let e,n,r,o,l,i,a,s,p,f,j;e=new we({props:{$$slots:{default:[ko]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new Vt({props:{$$slots:{default:[jo]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function g(_){t[7](_)}let c={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(c.value=t[1].jat[t[0].idx].name),l=new ct({props:c}),le.push(()=>ue(l,"value",g)),s=new we({props:{$$slots:{default:[$o]},$$scope:{ctx:t}}}),s.$on("click",t[8]),f=new we({props:{$$slots:{default:[Lo]},$$scope:{ctx:t}}}),f.$on("click",t[9]),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment),a=z(),A(s.$$.fragment),p=z(),A(f.$$.fragment)},l(_){O(e.$$.fragment,_),n=D(_),O(r.$$.fragment,_),o=D(_),O(l.$$.fragment,_),a=D(_),O(s.$$.fragment,_),p=D(_),O(f.$$.fragment,_)},m(_,u){S(e,_,u),L(_,n,u),S(r,_,u),L(_,o,u),S(l,_,u),L(_,a,u),S(s,_,u),L(_,p,u),S(f,_,u),j=!0},p(_,u){const d={};u&16384&&(d.$$scope={dirty:u,ctx:_}),e.$set(d);const I={};u&16384&&(I.$$scope={dirty:u,ctx:_}),r.$set(I);const q={};!i&&u&3&&(i=!0,q.value=_[1].jat[_[0].idx].name,se(()=>i=!1)),l.$set(q);const U={};u&16384&&(U.$$scope={dirty:u,ctx:_}),s.$set(U);const P={};u&16384&&(P.$$scope={dirty:u,ctx:_}),f.$set(P)},i(_){j||(w(e.$$.fragment,_),w(r.$$.fragment,_),w(l.$$.fragment,_),w(s.$$.fragment,_),w(f.$$.fragment,_),j=!0)},o(_){$(e.$$.fragment,_),$(r.$$.fragment,_),$(l.$$.fragment,_),$(s.$$.fragment,_),$(f.$$.fragment,_),j=!1},d(_){_&&(y(n),y(o),y(a),y(p)),F(e,_),F(r,_),F(l,_),F(s,_),F(f,_)}}}function vo(t){let e,n,r,o;e=new we({props:{$$slots:{default:[Co]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=ve(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Ut(Rt(t,l,s));const a=s=>$(i[s],1,1,()=>{i[s]=null});return{c(){A(e.$$.fragment),n=z(),r=ne("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){O(e.$$.fragment,s),n=D(s),r=re(s,"OL",{});var p=ae(r);for(let f=0;f<i.length;f+=1)i[f].l(p);p.forEach(y)},m(s,p){S(e,s,p),L(s,n,p),L(s,r,p);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(r,null);o=!0},p(s,p){const f={};if(p&16384&&(f.$$scope={dirty:p,ctx:s}),e.$set(f),p&3){l=ve(s[1].jat);let j;for(j=0;j<l.length;j+=1){const g=Rt(s,l,j);i[j]?(i[j].p(g,p),w(i[j],1)):(i[j]=Ut(g),i[j].c(),w(i[j],1),i[j].m(r,null))}for(de(),j=l.length;j<i.length;j+=1)a(j);_e()}},i(s){if(!o){w(e.$$.fragment,s);for(let p=0;p<l.length;p+=1)w(i[p]);o=!0}},o(s){$(e.$$.fragment,s),i=i.filter(Boolean);for(let p=0;p<i.length;p+=1)$(i[p]);o=!1},d(s){s&&(y(n),y(r)),F(e,s),Re(i,s)}}}function wo(t){let e;return{c(){e=Q("Back")},l(n){e=Y(n,"Back")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function ko(t){let e;return{c(){e=Q("Back to all junctions")},l(n){e=Y(n,"Back to all junctions")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function jo(t){let e;return{c(){e=Q("Delete")},l(n){e=Y(n,"Delete")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function $o(t){let e;return{c(){e=Q("Existing")},l(n){e=Y(n,"Existing")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function Lo(t){let e;return{c(){e=Q("Proposed")},l(n){e=Y(n,"Proposed")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function Co(t){let e;return{c(){e=Q("Add new junction")},l(n){e=Y(n,"Add new junction")},m(n,r){L(n,e,r)},d(n){n&&y(e)}}}function Eo(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=Q(e)},l(r){n=Y(r,e)},m(r,o){L(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&je(n,e)},d(r){r&&y(n)}}}function Ut(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new we({props:{$$slots:{default:[Eo]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=ne("li"),A(n.$$.fragment),r=z()},l(i){e=re(i,"LI",{});var a=ae(e);O(n.$$.fragment,a),r=D(a),a.forEach(y)},m(i,a){L(i,e,a),S(n,e,null),ge(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){$(n.$$.fragment,i),o=!1},d(i){i&&y(e),F(n)}}}function Po(t){let e,n,r,o;const l=[vo,yo,bo],i=[];function a(s,p){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=Be()},l(s){n&&n.l(s),r=Be()},m(s,p){~e&&i[e].m(s,p),L(s,r,p),o=!0},p(s,[p]){let f=e;e=a(s),e===f?~e&&i[e].p(s,p):(n&&(de(),$(i[f],1,1,()=>{i[f]=null}),_e()),~e?(n=i[e],n?n.p(s,p):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){$(n),o=!1},d(s){s&&y(r),~e&&i[e].d(s)}}}function Ve(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function Mo(t,e,n){let r;Me(t,x,_=>n(1,r=_));let o={kind:"list"};function l(){He(x,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(_){window.confirm("Delete this junction?")&&(r.jat.splice(_,1),x.set(r),n(0,o={kind:"list"}))}const a=_=>n(0,o={kind:"junction",idx:_}),s=()=>n(0,o={kind:"list"}),p=()=>i(Ve(o));function f(_){t.$$.not_equal(r.jat[o.idx].name,_)&&(r.jat[o.idx].name=_,x.set(r))}return[o,r,l,i,a,s,p,f,()=>n(0,o={kind:"map",idx:Ve(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:Ve(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:Ve(o)})]}class Jo extends Te{constructor(e){super(),Ae(this,e,Mo,Po,Ie,{})}}export{Jo as component};
