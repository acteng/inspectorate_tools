import{s as oe,R as H,S as Q,b as K,f as v,r as G,i as L,h as P,n as J,v as N,a as C,e as W,g as E,c as Z,w as T,x as I,q as le,k as me,U as $e,a7 as ce,t as ae,d as se,M as ge}from"../chunks/scheduler.srxSbnmG.js";import{S as ie,i as fe,e as F,c as y,a as j,m as S,t as k,f as ue,b as w,d as M,g as pe}from"../chunks/index.jWSzNkcH.js";import{e as z}from"../chunks/each.PFGD7pQK.js";import{p as X}from"../chunks/index.CRvgDNPa.js";import{c as _e}from"../chunks/colors.B_b9C5xD.js";import{S as he,W as de}from"../chunks/WarningButton.t2Artt9D.js";import{S as Y}from"../chunks/Select.DmCnIuVe.js";import{T as be}from"../chunks/TextInput.Drmp71y7.js";import{B as ve,G as ke,b as we,a as Le,M as x}from"../chunks/GeoreferenceLayer.D6tQQiVE.js";import{M as ye,G as je}from"../chunks/MapLibreMap.iFI_zsAS.js";import{L as Se}from"../chunks/LineLayer.evvYNeXS.js";import{s as A}from"../chunks/data.BvluUCWc.js";function Me(n){let e,r;return{c(){e=H("svg"),r=H("polygon"),this.h()},l(t){e=Q(t,"svg",{width:!0,height:!0,xmlns:!0});var l=K(e);r=Q(l,"polygon",{points:!0,fill:!0,class:!0}),K(r).forEach(v),l.forEach(v),this.h()},h(){G(r,"points","15,0 0,30 30,30"),G(r,"fill",n[0]),G(r,"class","svelte-19rpncr"),G(e,"width","30"),G(e,"height","30"),G(e,"xmlns","http://www.w3.org/2000/svg")},m(t,l){L(t,e,l),P(e,r)},p(t,[l]){l&1&&G(r,"fill",t[0])},i:J,o:J,d(t){t&&v(e)}}}function qe(n,e,r){let{color:t}=e;return n.$$set=l=>{"color"in l&&r(0,t=l.color)},[t]}class Be extends ie{constructor(e){super(),fe(this,e,qe,Me,oe,{color:0})}}function ee(n,e,r){const t=n.slice();return t[16]=e[r],t[17]=e,t[18]=r,t}function te(n,e,r){const t=n.slice();return t[16]=e[r],t[19]=e,t[20]=r,t}function Ce(n){let e;return{c(){e=ae("Zoom to fit")},l(r){e=se(r,"Zoom to fit")},m(r,t){L(r,e,t)},d(r){r&&v(e)}}}function Ee(n){let e,r;return{c(){e=W("span"),this.h()},l(t){e=Z(t,"SPAN",{class:!0,style:!0}),K(e).forEach(v),this.h()},h(){G(e,"class","dot svelte-1tmbx1c"),G(e,"style",r=`background-color: ${n[16].color}`)},m(t,l){L(t,e,l)},p(t,l){l&2&&r!==(r=`background-color: ${t[16].color}`)&&G(e,"style",r)},d(t){t&&v(e)}}}function Ge(n){let e,r;return e=new Be({props:{color:n[16].color}}),{c(){y(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,l){S(e,t,l),r=!0},p(t,l){const _={};l&2&&(_.color=t[16].color),e.$set(_)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){M(e,t)}}}function ne(n){let e,r,t,l,_,d;function f(i){n[8](i,n[16])}let b={draggable:!0,$$slots:{default:[Ee]},$$scope:{ctx:n}};n[16].point1!==void 0&&(b.lngLat=n[16].point1),e=new x({props:b}),N.push(()=>F(e,"lngLat",f));function a(i){n[9](i,n[16])}let u={draggable:!0,$$slots:{default:[Ge]},$$scope:{ctx:n}};return n[16].point2!==void 0&&(u.lngLat=n[16].point2),l=new x({props:u}),N.push(()=>F(l,"lngLat",a)),{c(){y(e.$$.fragment),t=C(),y(l.$$.fragment)},l(i){j(e.$$.fragment,i),t=E(i),j(l.$$.fragment,i)},m(i,h){S(e,i,h),L(i,t,h),S(l,i,h),d=!0},p(i,h){n=i;const c={};h&2097154&&(c.$$scope={dirty:h,ctx:n}),!r&&h&2&&(r=!0,c.lngLat=n[16].point1,I(()=>r=!1)),e.$set(c);const q={};h&2097154&&(q.$$scope={dirty:h,ctx:n}),!_&&h&2&&(_=!0,q.lngLat=n[16].point2,I(()=>_=!1)),l.$set(q)},i(i){d||(k(e.$$.fragment,i),k(l.$$.fragment,i),d=!0)},o(i){w(e.$$.fragment,i),w(l.$$.fragment,i),d=!1},d(i){i&&v(t),M(e,i),M(l,i)}}}function Ae(n){let e,r;return e=new Se({props:{paint:{"line-width":6,"line-color":["get","color"]}}}),{c(){y(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,l){S(e,t,l),r=!0},p:J,i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){w(e.$$.fragment,t),r=!1},d(t){M(e,t)}}}function De(n){let e,r,t,l,_,d=z(n[1].jat.movements),f=[];for(let a=0;a<d.length;a+=1)f[a]=ne(te(n,d,a));const b=a=>w(f[a],1,1,()=>{f[a]=null});return r=new je({props:{data:n[4](n[1].jat.movements),$$slots:{default:[Ae]},$$scope:{ctx:n}}}),l=new Le({props:{map:n[0]}}),{c(){for(let a=0;a<f.length;a+=1)f[a].c();e=C(),y(r.$$.fragment),t=C(),y(l.$$.fragment)},l(a){for(let u=0;u<f.length;u+=1)f[u].l(a);e=E(a),j(r.$$.fragment,a),t=E(a),j(l.$$.fragment,a)},m(a,u){for(let i=0;i<f.length;i+=1)f[i]&&f[i].m(a,u);L(a,e,u),S(r,a,u),L(a,t,u),S(l,a,u),_=!0},p(a,u){if(u&2){d=z(a[1].jat.movements);let c;for(c=0;c<d.length;c+=1){const q=te(a,d,c);f[c]?(f[c].p(q,u),k(f[c],1)):(f[c]=ne(q),f[c].c(),k(f[c],1),f[c].m(e.parentNode,e))}for(pe(),c=d.length;c<f.length;c+=1)b(c);ue()}const i={};u&2&&(i.data=a[4](a[1].jat.movements)),u&2097152&&(i.$$scope={dirty:u,ctx:a}),r.$set(i);const h={};u&1&&(h.map=a[0]),l.$set(h)},i(a){if(!_){for(let u=0;u<d.length;u+=1)k(f[u]);k(r.$$.fragment,a),k(l.$$.fragment,a),_=!0}},o(a){f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)w(f[u]);w(r.$$.fragment,a),w(l.$$.fragment,a),_=!1},d(a){a&&(v(e),v(t)),le(f,a),M(r,a),M(l,a)}}}function Ne(n){let e;return{c(){e=ae("Delete")},l(r){e=se(r,"Delete")},m(r,t){L(r,e,t)},d(r){r&&v(e)}}}function re(n){let e,r,t,l,_,d,f,b,a,u,i,h,c;function q($){n[11]($,n[16])}let B={label:"Name"};n[16].name!==void 0&&(B.value=n[16].name),r=new be({props:B}),N.push(()=>F(r,"value",q));function g($){n[12]($,n[16])}let D={label:"Kind",choices:n[2]};n[16].kind!==void 0&&(D.value=n[16].kind),_=new Y({props:D}),N.push(()=>F(_,"value",g));function s($){n[13]($,n[16])}let o={label:"Color",choices:n[3]};n[16].color!==void 0&&(o.value=n[16].color),b=new Y({props:o}),N.push(()=>F(b,"value",s));function m(){return n[14](n[18])}return i=new de({props:{$$slots:{default:[Ne]},$$scope:{ctx:n}}}),i.$on("click",m),{c(){e=W("li"),y(r.$$.fragment),l=C(),y(_.$$.fragment),f=C(),y(b.$$.fragment),u=C(),y(i.$$.fragment),h=C(),this.h()},l($){e=Z($,"LI",{style:!0});var p=K(e);j(r.$$.fragment,p),l=E(p),j(_.$$.fragment,p),f=E(p),j(b.$$.fragment,p),u=E(p),j(i.$$.fragment,p),h=E(p),p.forEach(v),this.h()},h(){T(e,"display","flex"),T(e,"justify-content","space-evenly")},m($,p){L($,e,p),S(r,e,null),P(e,l),S(_,e,null),P(e,f),S(b,e,null),P(e,u),S(i,e,null),P(e,h),c=!0},p($,p){n=$;const O={};!t&&p&2&&(t=!0,O.value=n[16].name,I(()=>t=!1)),r.$set(O);const R={};!d&&p&2&&(d=!0,R.value=n[16].kind,I(()=>d=!1)),_.$set(R);const U={};!a&&p&2&&(a=!0,U.value=n[16].color,I(()=>a=!1)),b.$set(U);const V={};p&2097152&&(V.$$scope={dirty:p,ctx:n}),i.$set(V)},i($){c||(k(r.$$.fragment,$),k(_.$$.fragment,$),k(b.$$.fragment,$),k(i.$$.fragment,$),c=!0)},o($){w(r.$$.fragment,$),w(_.$$.fragment,$),w(b.$$.fragment,$),w(i.$$.fragment,$),c=!1},d($){$&&v(e),M(r),M(_),M(b),M(i)}}}function Ie(n){let e,r,t,l,_,d,f,b,a,u,i,h;e=new he({props:{$$slots:{default:[Ce]},$$scope:{ctx:n}}}),e.$on("click",n[7]);function c(s){n[10](s)}let q={$$slots:{default:[De]},$$scope:{ctx:n}};n[0]!==void 0&&(q.map=n[0]),l=new ye({props:q}),N.push(()=>F(l,"map",c));let B=z(n[1].jat.movements),g=[];for(let s=0;s<B.length;s+=1)g[s]=re(ee(n,B,s));const D=s=>w(g[s],1,1,()=>{g[s]=null});return a=new ve({}),i=new ke({}),{c(){y(e.$$.fragment),r=C(),t=W("div"),y(l.$$.fragment),d=C(),f=W("ol");for(let s=0;s<g.length;s+=1)g[s].c();b=C(),y(a.$$.fragment),u=C(),y(i.$$.fragment),this.h()},l(s){j(e.$$.fragment,s),r=E(s),t=Z(s,"DIV",{style:!0});var o=K(t);j(l.$$.fragment,o),o.forEach(v),d=E(s),f=Z(s,"OL",{});var m=K(f);for(let $=0;$<g.length;$+=1)g[$].l(m);m.forEach(v),b=E(s),j(a.$$.fragment,s),u=E(s),j(i.$$.fragment,s),this.h()},h(){T(t,"position","relative"),T(t,"width","100%"),T(t,"height","600px")},m(s,o){S(e,s,o),L(s,r,o),L(s,t,o),S(l,t,null),L(s,d,o),L(s,f,o);for(let m=0;m<g.length;m+=1)g[m]&&g[m].m(f,null);L(s,b,o),S(a,s,o),L(s,u,o),S(i,s,o),h=!0},p(s,[o]){const m={};o&2097152&&(m.$$scope={dirty:o,ctx:s}),e.$set(m);const $={};if(o&2097155&&($.$$scope={dirty:o,ctx:s}),!_&&o&1&&(_=!0,$.map=s[0],I(()=>_=!1)),l.$set($),o&46){B=z(s[1].jat.movements);let p;for(p=0;p<B.length;p+=1){const O=ee(s,B,p);g[p]?(g[p].p(O,o),k(g[p],1)):(g[p]=re(O),g[p].c(),k(g[p],1),g[p].m(f,null))}for(pe(),p=B.length;p<g.length;p+=1)D(p);ue()}},i(s){if(!h){k(e.$$.fragment,s),k(l.$$.fragment,s);for(let o=0;o<B.length;o+=1)k(g[o]);k(a.$$.fragment,s),k(i.$$.fragment,s),h=!0}},o(s){w(e.$$.fragment,s),w(l.$$.fragment,s),g=g.filter(Boolean);for(let o=0;o<g.length;o+=1)w(g[o]);w(a.$$.fragment,s),w(i.$$.fragment,s),h=!1},d(s){s&&(v(r),v(t),v(d),v(f),v(b),v(u)),M(e,s),M(l),le(g,s),M(a,s),M(i,s)}}}function Fe(n,e,r){let t;me(n,A,o=>r(1,t=o));let l,_=X(["cycling-straight","cycling-turn","pedestrian"]),d=X(["green","amber","red","critical"]);function f(o){ge(A,t.jat.movements=[...t.jat.movements,{point1:o.lngLat.toArray(),point2:o.lngLat.toArray(),kind:"cycling-straight",color:"green",name:"",notes:""}],t)}$e(()=>{l.on("click",f),u(!1)}),ce(()=>{l.off("click",f)});function b(o){return{type:"FeatureCollection",features:o.map(m=>({type:"Feature",properties:{kind:m.kind,color:_e[m.color].background},geometry:{type:"LineString",coordinates:[m.point1,m.point2]}}))}}function a(o){t.jat.movements.splice(o,1),A.set(t)}function u(o){t.jat.movements.length>0&&l.fitBounds(we(b(t.jat.movements)),{padding:20,animate:o})}const i=()=>u(!0);function h(o,m){n.$$.not_equal(m.point1,o)&&(m.point1=o,A.set(t))}function c(o,m){n.$$.not_equal(m.point2,o)&&(m.point2=o,A.set(t))}function q(o){l=o,r(0,l)}function B(o,m){n.$$.not_equal(m.name,o)&&(m.name=o,A.set(t))}function g(o,m){n.$$.not_equal(m.kind,o)&&(m.kind=o,A.set(t))}function D(o,m){n.$$.not_equal(m.color,o)&&(m.color=o,A.set(t))}return[l,t,_,d,b,a,u,i,h,c,q,B,g,D,o=>a(o)]}class Qe extends ie{constructor(e){super(),fe(this,e,Fe,Ie,oe,{})}}export{Qe as component};
