import{s as ae,R as H,S as Q,b as F,f as b,r as G,i as w,h as P,n as J,v as D,a as C,e as W,g as E,c as Z,w as T,x as N,q as le,k as $e,U as ce,a8 as ge,t as se,d as ie,M as _e}from"../chunks/scheduler.d-ZThAIN.js";import{S as fe,i as ue,e as I,c as L,a as y,m as j,t as v,f as me,b as k,d as S,g as pe}from"../chunks/index.BKLGIcjh.js";import{e as z}from"../chunks/each.5I2k8VTY.js";import{p as X}from"../chunks/index.DA4Yc62u.js";import{c as he}from"../chunks/colors.B_b9C5xD.js";import{S as de,W as be}from"../chunks/WarningButton.CXBTrJR0.js";import{S as Y}from"../chunks/Select.DYDTV9Cm.js";import{T as ve}from"../chunks/TextInput.DLFUCrlZ.js";import{t as ke,L as we}from"../chunks/LineLayer.BjGVIZ6e.js";import{M as Le,G as ye}from"../chunks/MapLibreMap.BMNWHgvR.js";import{B as je,G as Se,a as Me,M as x}from"../chunks/GeoreferenceLayer.BgCDM98w.js";import{s as A}from"../chunks/data.Bgy6C2EI.js";function ee(r){return ke(r)}function Be(r){let e,o;return{c(){e=H("svg"),o=H("polygon"),this.h()},l(t){e=Q(t,"svg",{width:!0,height:!0,xmlns:!0});var a=F(e);o=Q(a,"polygon",{points:!0,fill:!0,class:!0}),F(o).forEach(b),a.forEach(b),this.h()},h(){G(o,"points","15,0 0,30 30,30"),G(o,"fill",r[0]),G(o,"class","svelte-19rpncr"),G(e,"width","30"),G(e,"height","30"),G(e,"xmlns","http://www.w3.org/2000/svg")},m(t,a){w(t,e,a),P(e,o)},p(t,[a]){a&1&&G(o,"fill",t[0])},i:J,o:J,d(t){t&&b(e)}}}function qe(r,e,o){let{color:t}=e;return r.$$set=a=>{"color"in a&&o(0,t=a.color)},[t]}class Ce extends fe{constructor(e){super(),ue(this,e,qe,Be,ae,{color:0})}}function te(r,e,o){const t=r.slice();return t[15]=e[o],t[16]=e,t[17]=o,t}function ne(r,e,o){const t=r.slice();return t[15]=e[o],t[18]=e,t[19]=o,t}function Ee(r){let e;return{c(){e=se("Zoom to fit")},l(o){e=ie(o,"Zoom to fit")},m(o,t){w(o,e,t)},d(o){o&&b(e)}}}function Ge(r){let e,o;return{c(){e=W("span"),this.h()},l(t){e=Z(t,"SPAN",{class:!0,style:!0}),F(e).forEach(b),this.h()},h(){G(e,"class","dot svelte-1tmbx1c"),G(e,"style",o=`background-color: ${r[15].color}`)},m(t,a){w(t,e,a)},p(t,a){a&2&&o!==(o=`background-color: ${t[15].color}`)&&G(e,"style",o)},d(t){t&&b(e)}}}function Ae(r){let e,o;return e=new Ce({props:{color:r[15].color}}),{c(){L(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,a){j(e,t,a),o=!0},p(t,a){const g={};a&2&&(g.color=t[15].color),e.$set(g)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){k(e.$$.fragment,t),o=!1},d(t){S(e,t)}}}function re(r){let e,o,t,a,g,h;function f(s){r[7](s,r[15])}let d={draggable:!0,$$slots:{default:[Ge]},$$scope:{ctx:r}};r[15].point1!==void 0&&(d.lngLat=r[15].point1),e=new x({props:d}),D.push(()=>I(e,"lngLat",f));function l(s){r[8](s,r[15])}let u={draggable:!0,$$slots:{default:[Ae]},$$scope:{ctx:r}};return r[15].point2!==void 0&&(u.lngLat=r[15].point2),a=new x({props:u}),D.push(()=>I(a,"lngLat",l)),{c(){L(e.$$.fragment),t=C(),L(a.$$.fragment)},l(s){y(e.$$.fragment,s),t=E(s),y(a.$$.fragment,s)},m(s,_){j(e,s,_),w(s,t,_),j(a,s,_),h=!0},p(s,_){r=s;const $={};_&1048578&&($.$$scope={dirty:_,ctx:r}),!o&&_&2&&(o=!0,$.lngLat=r[15].point1,N(()=>o=!1)),e.$set($);const M={};_&1048578&&(M.$$scope={dirty:_,ctx:r}),!g&&_&2&&(g=!0,M.lngLat=r[15].point2,N(()=>g=!1)),a.$set(M)},i(s){h||(v(e.$$.fragment,s),v(a.$$.fragment,s),h=!0)},o(s){k(e.$$.fragment,s),k(a.$$.fragment,s),h=!1},d(s){s&&b(t),S(e,s),S(a,s)}}}function De(r){let e,o;return e=new we({props:{paint:{"line-width":6,"line-color":["get","color"]}}}),{c(){L(e.$$.fragment)},l(t){y(e.$$.fragment,t)},m(t,a){j(e,t,a),o=!0},p:J,i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){k(e.$$.fragment,t),o=!1},d(t){S(e,t)}}}function Ne(r){let e,o,t,a,g,h=z(r[1].jat.movements),f=[];for(let l=0;l<h.length;l+=1)f[l]=re(ne(r,h,l));const d=l=>k(f[l],1,1,()=>{f[l]=null});return o=new ye({props:{data:r[4](r[1].jat.movements),$$slots:{default:[De]},$$scope:{ctx:r}}}),a=new Me({props:{map:r[0]}}),{c(){for(let l=0;l<f.length;l+=1)f[l].c();e=C(),L(o.$$.fragment),t=C(),L(a.$$.fragment)},l(l){for(let u=0;u<f.length;u+=1)f[u].l(l);e=E(l),y(o.$$.fragment,l),t=E(l),y(a.$$.fragment,l)},m(l,u){for(let s=0;s<f.length;s+=1)f[s]&&f[s].m(l,u);w(l,e,u),j(o,l,u),w(l,t,u),j(a,l,u),g=!0},p(l,u){if(u&2){h=z(l[1].jat.movements);let $;for($=0;$<h.length;$+=1){const M=ne(l,h,$);f[$]?(f[$].p(M,u),v(f[$],1)):(f[$]=re(M),f[$].c(),v(f[$],1),f[$].m(e.parentNode,e))}for(pe(),$=h.length;$<f.length;$+=1)d($);me()}const s={};u&2&&(s.data=l[4](l[1].jat.movements)),u&1048576&&(s.$$scope={dirty:u,ctx:l}),o.$set(s);const _={};u&1&&(_.map=l[0]),a.$set(_)},i(l){if(!g){for(let u=0;u<h.length;u+=1)v(f[u]);v(o.$$.fragment,l),v(a.$$.fragment,l),g=!0}},o(l){f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)k(f[u]);k(o.$$.fragment,l),k(a.$$.fragment,l),g=!1},d(l){l&&(b(e),b(t)),le(f,l),S(o,l),S(a,l)}}}function Ie(r){let e;return{c(){e=se("Delete")},l(o){e=ie(o,"Delete")},m(o,t){w(o,e,t)},d(o){o&&b(e)}}}function oe(r){let e,o,t,a,g,h,f,d,l,u,s,_,$;function M(p){r[10](p,r[15])}let B={label:"Name"};r[15].name!==void 0&&(B.value=r[15].name),o=new ve({props:B}),D.push(()=>I(o,"value",M));function c(p){r[11](p,r[15])}let K={label:"Kind",choices:r[2]};r[15].kind!==void 0&&(K.value=r[15].kind),g=new Y({props:K}),D.push(()=>I(g,"value",c));function n(p){r[12](p,r[15])}let i={label:"Color",choices:r[3]};r[15].color!==void 0&&(i.value=r[15].color),d=new Y({props:i}),D.push(()=>I(d,"value",n));function q(){return r[13](r[17])}return s=new be({props:{$$slots:{default:[Ie]},$$scope:{ctx:r}}}),s.$on("click",q),{c(){e=W("li"),L(o.$$.fragment),a=C(),L(g.$$.fragment),f=C(),L(d.$$.fragment),u=C(),L(s.$$.fragment),_=C(),this.h()},l(p){e=Z(p,"LI",{style:!0});var m=F(e);y(o.$$.fragment,m),a=E(m),y(g.$$.fragment,m),f=E(m),y(d.$$.fragment,m),u=E(m),y(s.$$.fragment,m),_=E(m),m.forEach(b),this.h()},h(){T(e,"display","flex"),T(e,"justify-content","space-evenly")},m(p,m){w(p,e,m),j(o,e,null),P(e,a),j(g,e,null),P(e,f),j(d,e,null),P(e,u),j(s,e,null),P(e,_),$=!0},p(p,m){r=p;const O={};!t&&m&2&&(t=!0,O.value=r[15].name,N(()=>t=!1)),o.$set(O);const R={};!h&&m&2&&(h=!0,R.value=r[15].kind,N(()=>h=!1)),g.$set(R);const U={};!l&&m&2&&(l=!0,U.value=r[15].color,N(()=>l=!1)),d.$set(U);const V={};m&1048576&&(V.$$scope={dirty:m,ctx:r}),s.$set(V)},i(p){$||(v(o.$$.fragment,p),v(g.$$.fragment,p),v(d.$$.fragment,p),v(s.$$.fragment,p),$=!0)},o(p){k(o.$$.fragment,p),k(g.$$.fragment,p),k(d.$$.fragment,p),k(s.$$.fragment,p),$=!1},d(p){p&&b(e),S(o),S(g),S(d),S(s)}}}function Fe(r){let e,o,t,a,g,h,f,d,l,u,s,_;e=new de({props:{$$slots:{default:[Ee]},$$scope:{ctx:r}}}),e.$on("click",r[6]);function $(n){r[9](n)}let M={$$slots:{default:[Ne]},$$scope:{ctx:r}};r[0]!==void 0&&(M.map=r[0]),a=new Le({props:M}),D.push(()=>I(a,"map",$));let B=z(r[1].jat.movements),c=[];for(let n=0;n<B.length;n+=1)c[n]=oe(te(r,B,n));const K=n=>k(c[n],1,1,()=>{c[n]=null});return l=new je({}),s=new Se({}),{c(){L(e.$$.fragment),o=C(),t=W("div"),L(a.$$.fragment),h=C(),f=W("ol");for(let n=0;n<c.length;n+=1)c[n].c();d=C(),L(l.$$.fragment),u=C(),L(s.$$.fragment),this.h()},l(n){y(e.$$.fragment,n),o=E(n),t=Z(n,"DIV",{style:!0});var i=F(t);y(a.$$.fragment,i),i.forEach(b),h=E(n),f=Z(n,"OL",{});var q=F(f);for(let p=0;p<c.length;p+=1)c[p].l(q);q.forEach(b),d=E(n),y(l.$$.fragment,n),u=E(n),y(s.$$.fragment,n),this.h()},h(){T(t,"position","relative"),T(t,"width","100%"),T(t,"height","600px")},m(n,i){j(e,n,i),w(n,o,i),w(n,t,i),j(a,t,null),w(n,h,i),w(n,f,i);for(let q=0;q<c.length;q+=1)c[q]&&c[q].m(f,null);w(n,d,i),j(l,n,i),w(n,u,i),j(s,n,i),_=!0},p(n,[i]){const q={};i&1048576&&(q.$$scope={dirty:i,ctx:n}),e.$set(q);const p={};if(i&1048579&&(p.$$scope={dirty:i,ctx:n}),!g&&i&1&&(g=!0,p.map=n[0],N(()=>g=!1)),a.$set(p),i&46){B=z(n[1].jat.movements);let m;for(m=0;m<B.length;m+=1){const O=te(n,B,m);c[m]?(c[m].p(O,i),v(c[m],1)):(c[m]=oe(O),c[m].c(),v(c[m],1),c[m].m(f,null))}for(pe(),m=B.length;m<c.length;m+=1)K(m);me()}},i(n){if(!_){v(e.$$.fragment,n),v(a.$$.fragment,n);for(let i=0;i<B.length;i+=1)v(c[i]);v(l.$$.fragment,n),v(s.$$.fragment,n),_=!0}},o(n){k(e.$$.fragment,n),k(a.$$.fragment,n),c=c.filter(Boolean);for(let i=0;i<c.length;i+=1)k(c[i]);k(l.$$.fragment,n),k(s.$$.fragment,n),_=!1},d(n){n&&(b(o),b(t),b(h),b(f),b(d),b(u)),S(e,n),S(a),le(c,n),S(l,n),S(s,n)}}}function Ke(r,e,o){let t;$e(r,A,n=>o(1,t=n));let a,g=X(["cycling-straight","cycling-turn","pedestrian"]),h=X(["green","amber","red","critical"]);function f(n){_e(A,t.jat.movements=[...t.jat.movements,{point1:n.lngLat.toArray(),point2:n.lngLat.toArray(),kind:"cycling-straight",color:"green",name:"",notes:""}],t)}ce(()=>{a.on("click",f),t.jat.movements.length>0&&a.fitBounds(ee(d(t.jat.movements)),{padding:20,animate:!1})}),ge(()=>{a.off("click",f)});function d(n){return{type:"FeatureCollection",features:n.map(i=>({type:"Feature",properties:{kind:i.kind,color:he[i.color].background},geometry:{type:"LineString",coordinates:[i.point1,i.point2]}}))}}function l(n){t.jat.movements.splice(n,1),A.set(t)}function u(){t.jat.movements.length>0&&a.fitBounds(ee(d(t.jat.movements)),{padding:20,animate:!0})}function s(n,i){r.$$.not_equal(i.point1,n)&&(i.point1=n,A.set(t))}function _(n,i){r.$$.not_equal(i.point2,n)&&(i.point2=n,A.set(t))}function $(n){a=n,o(0,a)}function M(n,i){r.$$.not_equal(i.name,n)&&(i.name=n,A.set(t))}function B(n,i){r.$$.not_equal(i.kind,n)&&(i.kind=n,A.set(t))}function c(n,i){r.$$.not_equal(i.color,n)&&(i.color=n,A.set(t))}return[a,t,g,h,d,l,u,s,_,$,M,B,c,n=>l(n)]}class Xe extends fe{constructor(e){super(),ue(this,e,Ke,Fe,ae,{})}}export{Xe as component};
