import{s as Ce,v as x,w as ee,l as Wt,u as Zt,m as Qt,o as Yt,G as ve,k as Ne,U as xt,T as Me,a as N,g as G,i as j,f as $,q as Ae,n as Se,e as te,t as K,c as ne,b as oe,d as X,r as Ge,x as Y,h as fe,j as pe,z as en,D as _e,p as ot}from"../chunks/scheduler.BBS-fkhU.js";import{S as Ie,i as Fe,e as re,c as F,a as T,m as q,t as w,b as k,d as O,g as se,f as ue}from"../chunks/index.B8H3ypVf.js";import{e as ce}from"../chunks/each.D79A5KlB.js";import{B as tn}from"../chunks/ButtonGroup.fhy-VJbf.js";import{W as Lt,S as ge}from"../chunks/WarningButton.CaqyhU7y.js";import{T as We}from"../chunks/TextInput.C_aBwF72.js";import{s as V}from"../chunks/data.CHVzQ2cP.js";import{L as nn,d as rn,e as Pt,M as on,b as ln,C as an,G as it,f as He,h as lt,c as sn,P as Mt,g as un}from"../chunks/index.BPwILK0w.js";import{c as Te}from"../chunks/colors.CYEpEtTL.js";import{M as fn,a as mn,b as qe,R as At,B as cn,G as gn,C as pn,S as _n}from"../chunks/GeoreferenceLayer.BcePDTci.js";import{D as dn,C as hn}from"../chunks/DefaultButton.Pbp5mObw.js";import{T as St}from"../chunks/TextArea.Ck6ITb4v.js";import{p as It}from"../chunks/index.CdrYfWNt.js";import{S as $n}from"../chunks/Select.DqyoFzIJ.js";function bn(t){let e;const n=t[16].default,r=Wt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Zt(r,n,o,o[24],e?Yt(n,o[24],l,null):Qt(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function wn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[bn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new nn({props:l}),x.push(()=>re(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],ee(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){O(e,i)}}}function yn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=rn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:p=void 0}=e,{layout:_=void 0}=e,{filter:f=void 0}=e,{applyToClusters:L=void 0}=e,{minzoom:P=void 0}=e,{maxzoom:B=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:E=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:d=!0}=e;function h(S){I=S,n(0,I)}function g(S){ve.call(this,t,S)}function v(S){ve.call(this,t,S)}function Z(S){ve.call(this,t,S)}function C(S){ve.call(this,t,S)}function z(S){ve.call(this,t,S)}function R(S){ve.call(this,t,S)}return t.$$set=S=>{"id"in S&&n(1,l=S.id),"source"in S&&n(2,i=S.source),"sourceLayer"in S&&n(3,a=S.sourceLayer),"beforeId"in S&&n(4,s=S.beforeId),"beforeLayerType"in S&&n(5,m=S.beforeLayerType),"paint"in S&&n(6,p=S.paint),"layout"in S&&n(7,_=S.layout),"filter"in S&&n(8,f=S.filter),"applyToClusters"in S&&n(9,L=S.applyToClusters),"minzoom"in S&&n(10,P=S.minzoom),"maxzoom"in S&&n(11,B=S.maxzoom),"hoverCursor"in S&&n(12,y=S.hoverCursor),"manageHoverState"in S&&n(13,E=S.manageHoverState),"hovered"in S&&n(0,I=S.hovered),"eventsIfTopMost"in S&&n(14,u=S.eventsIfTopMost),"interactive"in S&&n(15,d=S.interactive),"$$scope"in S&&n(24,o=S.$$scope)},[I,l,i,a,s,m,p,_,f,L,P,B,y,E,u,d,r,h,g,v,Z,C,z,R,o]}class vn extends Ie{constructor(e){super(),Fe(this,e,yn,wn,Ce,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var kn=Object.defineProperty,J=(t,e)=>kn(t,"name",{value:e,configurable:!0}),jn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ee(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ke(e),o=Ke(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ee(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ee(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Pt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ee(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(jn,"GeojsonEquality");function Ee(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(Ee,"sameLength");function Ke(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(Ke,"explode");var le=63710088e-1,Ft={centimeters:le*100,centimetres:le*100,degrees:360/(2*Math.PI),feet:le*3.28084,inches:le*39.37,kilometers:le/1e3,kilometres:le/1e3,meters:le,metres:le,miles:le/1609.344,millimeters:le*1e3,millimetres:le*1e3,nauticalmiles:le/1852,radians:1,yards:le*1.0936},at={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function de(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J(de,"feature");function Cn(t,e,n={}){switch(t){case"Point":return ze(e).geometry;case"LineString":return Qe(e).geometry;case"Polygon":return Ze(e).geometry;case"MultiPoint":return qt(e).geometry;case"MultiLineString":return Tt(e).geometry;case"MultiPolygon":return Ot(e).geometry;default:throw new Error(t+" is invalid")}}J(Cn,"geometry");function ze(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ke(t[0])||!ke(t[1]))throw new Error("coordinates must contain numbers");return de({type:"Point",coordinates:t},e,n)}J(ze,"point");function En(t,e,n={}){return De(t.map(r=>ze(r,e)),n)}J(En,"points");function Ze(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return de({type:"Polygon",coordinates:t},e,n)}J(Ze,"polygon");function Ln(t,e,n={}){return De(t.map(r=>Ze(r,e)),n)}J(Ln,"polygons");function Qe(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return de({type:"LineString",coordinates:t},e,n)}J(Qe,"lineString");function Pn(t,e,n={}){return De(t.map(r=>Qe(r,e)),n)}J(Pn,"lineStrings");function De(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(De,"featureCollection");function Tt(t,e,n={}){return de({type:"MultiLineString",coordinates:t},e,n)}J(Tt,"multiLineString");function qt(t,e,n={}){return de({type:"MultiPoint",coordinates:t},e,n)}J(qt,"multiPoint");function Ot(t,e,n={}){return de({type:"MultiPolygon",coordinates:t},e,n)}J(Ot,"multiPolygon");function Mn(t,e,n={}){return de({type:"GeometryCollection",geometries:t},e,n)}J(Mn,"geometryCollection");function An(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J(An,"round");function Bt(t,e="kilometers"){const n=Ft[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(Bt,"radiansToLength");function Re(t,e="kilometers"){const n=Ft[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(Re,"lengthToRadians");function Sn(t,e){return Be(Re(t,e))}J(Sn,"lengthToDegrees");function In(t){let e=t%360;return e<0&&(e+=360),e}J(In,"bearingToAzimuth");function Be(t){return t%(2*Math.PI)*180/Math.PI}J(Be,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}J(Oe,"degreesToRadians");function Fn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Bt(Re(t,e),n)}J(Fn,"convertLength");function Tn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=at[e];if(!r)throw new Error("invalid original units");const o=at[n];if(!o)throw new Error("invalid final units");return t/r*o}J(Tn,"convertArea");function ke(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(ke,"isNumber");function qn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(qn,"isObject");function On(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ke(e))throw new Error("bbox must only contain numbers")})}J(On,"validateBBox");function Bn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(Bn,"validateId");var Nn=Object.defineProperty,he=(t,e)=>Nn(t,"name",{value:e,configurable:!0});function Nt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}he(Nt,"getCoord");function Gn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}he(Gn,"getCoords");function Gt(t){if(t.length>1&&ke(t[0])&&ke(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Gt(t[0]);throw new Error("coordinates must only contain numbers")}he(Gt,"containsNumber");function zn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}he(zn,"geojsonType");function Dn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}he(Dn,"featureOf");function Rn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}he(Rn,"collectionOf");function Un(t){return t.type==="Feature"?t.geometry:t}he(Un,"getGeom");function Jn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}he(Jn,"getType");var Hn=Object.defineProperty,Kn=(t,e)=>Hn(t,"name",{value:e,configurable:!0});function zt(t,e,n,r={}){const o=Nt(t),l=Oe(o[0]),i=Oe(o[1]),a=Oe(n),s=Re(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),p=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),_=Be(p),f=Be(m);return ze([_,f],r.properties)}Kn(zt,"destination");var st=zt,Xn=Object.defineProperty,H=(t,e)=>Xn(t,"name",{value:e,configurable:!0}),Vn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Le(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Xe(e),o=Xe(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Le(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Le(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Pt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Le(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};H(Vn,"GeojsonEquality");function Le(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}H(Le,"sameLength");function Xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}H(Xe,"explode");var ae=63710088e-1,Dt={centimeters:ae*100,centimetres:ae*100,degrees:360/(2*Math.PI),feet:ae*3.28084,inches:ae*39.37,kilometers:ae/1e3,kilometres:ae/1e3,meters:ae,metres:ae,miles:ae/1609.344,millimeters:ae*1e3,millimetres:ae*1e3,nauticalmiles:ae/1852,radians:1,yards:ae*1.0936},ut={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $e(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}H($e,"feature");function Wn(t,e,n={}){switch(t){case"Point":return Ye(e).geometry;case"LineString":return et(e).geometry;case"Polygon":return xe(e).geometry;case"MultiPoint":return Ut(e).geometry;case"MultiLineString":return Rt(e).geometry;case"MultiPolygon":return Jt(e).geometry;default:throw new Error(t+" is invalid")}}H(Wn,"geometry");function Ye(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!je(t[0])||!je(t[1]))throw new Error("coordinates must contain numbers");return $e({type:"Point",coordinates:t},e,n)}H(Ye,"point");function Zn(t,e,n={}){return Ue(t.map(r=>Ye(r,e)),n)}H(Zn,"points");function xe(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return $e({type:"Polygon",coordinates:t},e,n)}H(xe,"polygon");function Qn(t,e,n={}){return Ue(t.map(r=>xe(r,e)),n)}H(Qn,"polygons");function et(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return $e({type:"LineString",coordinates:t},e,n)}H(et,"lineString");function Yn(t,e,n={}){return Ue(t.map(r=>et(r,e)),n)}H(Yn,"lineStrings");function Ue(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}H(Ue,"featureCollection");function Rt(t,e,n={}){return $e({type:"MultiLineString",coordinates:t},e,n)}H(Rt,"multiLineString");function Ut(t,e,n={}){return $e({type:"MultiPoint",coordinates:t},e,n)}H(Ut,"multiPoint");function Jt(t,e,n={}){return $e({type:"MultiPolygon",coordinates:t},e,n)}H(Jt,"multiPolygon");function xn(t,e,n={}){return $e({type:"GeometryCollection",geometries:t},e,n)}H(xn,"geometryCollection");function er(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}H(er,"round");function Ht(t,e="kilometers"){const n=Dt[e];if(!n)throw new Error(e+" units is invalid");return t*n}H(Ht,"radiansToLength");function tt(t,e="kilometers"){const n=Dt[e];if(!n)throw new Error(e+" units is invalid");return t/n}H(tt,"lengthToRadians");function tr(t,e){return nt(tt(t,e))}H(tr,"lengthToDegrees");function nr(t){let e=t%360;return e<0&&(e+=360),e}H(nr,"bearingToAzimuth");function nt(t){return t%(2*Math.PI)*180/Math.PI}H(nt,"radiansToDegrees");function Pe(t){return t%360*Math.PI/180}H(Pe,"degreesToRadians");function rr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Ht(tt(t,e),n)}H(rr,"convertLength");function or(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=ut[e];if(!r)throw new Error("invalid original units");const o=ut[n];if(!o)throw new Error("invalid final units");return t/r*o}H(or,"convertArea");function je(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}H(je,"isNumber");function ir(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}H(ir,"isObject");function lr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!je(e))throw new Error("bbox must only contain numbers")})}H(lr,"validateBBox");function ar(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}H(ar,"validateId");var sr=Object.defineProperty,be=(t,e)=>sr(t,"name",{value:e,configurable:!0});function Ve(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}be(Ve,"getCoord");function ur(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}be(ur,"getCoords");function Kt(t){if(t.length>1&&je(t[0])&&je(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Kt(t[0]);throw new Error("coordinates must only contain numbers")}be(Kt,"containsNumber");function fr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}be(fr,"geojsonType");function mr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}be(mr,"featureOf");function cr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}be(cr,"collectionOf");function gr(t){return t.type==="Feature"?t.geometry:t}be(gr,"getGeom");function pr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}be(pr,"getType");var _r=Object.defineProperty,Xt=(t,e)=>_r(t,"name",{value:e,configurable:!0});function rt(t,e,n={}){if(n.final===!0)return Vt(t,e);const r=Ve(t),o=Ve(e),l=Pe(r[0]),i=Pe(o[0]),a=Pe(r[1]),s=Pe(o[1]),m=Math.sin(i-l)*Math.cos(s),p=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return nt(Math.atan2(m,p))}Xt(rt,"bearing");function Vt(t,e){let n=rt(e,t);return n=(n+180)%360,n}Xt(Vt,"calculateFinalBearing");var dr=rt;function ft(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function mt(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function hr(t){let e,n=Mr(t[36])+"",r;return{c(){e=te("span"),r=K(n),this.h()},l(o){e=ne(o,"SPAN",{class:!0});var l=oe(e);r=X(l,n),l.forEach($),this.h()},h(){Ge(e,"class","dot svelte-1qktznf"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(o,l){j(o,e,l),fe(e,r)},p:Se,d(o){o&&$(e)}}}function ct(t){let e,n,r;function o(s){t[17](s,t[37])}function l(){return t[18](t[36])}function i(){return t[19](t[36])}let a={draggable:!0,$$slots:{default:[hr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(a.lngLat=t[37].point),e=new qe({props:a}),x.push(()=>re(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){F(e.$$.fragment)},l(s){T(e.$$.fragment,s)},m(s,m){q(e,s,m),r=!0},p(s,m){t=s;const p={};m[1]&256&&(p.$$scope={dirty:m,ctx:t}),!n&&m[0]&11&&(n=!0,p.lngLat=t[37].point,ee(()=>n=!1)),e.$set(p)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){O(e,s)}}}function $r(t){let e;return{c(){e=te("span"),this.h()},l(n){e=ne(n,"SPAN",{class:!0}),oe(e).forEach($),this.h()},h(){Ge(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score]),Y(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){j(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score]),r[0]&11&&Y(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&$(e)}}}function br(t){let e;return{c(){e=te("span"),this.h()},l(n){e=ne(n,"SPAN",{class:!0}),oe(e).forEach($),this.h()},h(){Ge(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score])},m(n,r){j(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score])},d(n){n&&$(e)}}}function wr(t){let e;return{c(){e=te("span"),this.h()},l(n){e=ne(n,"SPAN",{class:!0}),oe(e).forEach($),this.h()},h(){Ge(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score]),Y(e,"opacity","0%")},m(n,r){j(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score])},d(n){n&&$(e)}}}function gt(t){let e,n,r,o,l,i,a,s,m;function p(g){t[20](g,t[34])}function _(){return t[21](t[36])}function f(){return t[22](t[36])}let L={draggable:!0,$$slots:{default:[$r]},$$scope:{ctx:t}};t[34].point1!==void 0&&(L.lngLat=t[34].point1),e=new qe({props:L}),x.push(()=>re(e,"lngLat",p)),e.$on("dragend",_),e.$on("click",f);function P(g){t[23](g,t[34])}function B(){return t[24](t[36])}function y(){return t[25](t[36])}let E={draggable:!0,$$slots:{default:[br]},$$scope:{ctx:t}};t[34].point2!==void 0&&(E.lngLat=t[34].point2),o=new qe({props:E}),x.push(()=>re(o,"lngLat",P)),o.$on("dragend",B),o.$on("click",y);function I(g){t[26](g,t[34])}function u(){return t[27](t[36])}function d(){return t[28](t[36])}let h={draggable:!0,$$slots:{default:[wr]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(h.lngLat=t[34].point3),a=new qe({props:h}),x.push(()=>re(a,"lngLat",I)),a.$on("dragend",u),a.$on("click",d),{c(){F(e.$$.fragment),r=N(),F(o.$$.fragment),i=N(),F(a.$$.fragment)},l(g){T(e.$$.fragment,g),r=G(g),T(o.$$.fragment,g),i=G(g),T(a.$$.fragment,g)},m(g,v){q(e,g,v),j(g,r,v),q(o,g,v),j(g,i,v),q(a,g,v),m=!0},p(g,v){t=g;const Z={};v[0]&11|v[1]&256&&(Z.$$scope={dirty:v,ctx:t}),!n&&v[0]&11&&(n=!0,Z.lngLat=t[34].point1,ee(()=>n=!1)),e.$set(Z);const C={};v[0]&11|v[1]&256&&(C.$$scope={dirty:v,ctx:t}),!l&&v[0]&11&&(l=!0,C.lngLat=t[34].point2,ee(()=>l=!1)),o.$set(C);const z={};v[0]&11|v[1]&256&&(z.$$scope={dirty:v,ctx:t}),!s&&v[0]&11&&(s=!0,z.lngLat=t[34].point3,ee(()=>s=!1)),a.$set(z)},i(g){m||(w(e.$$.fragment,g),w(o.$$.fragment,g),w(a.$$.fragment,g),m=!0)},o(g){k(e.$$.fragment,g),k(o.$$.fragment,g),k(a.$$.fragment,g),m=!1},d(g){g&&($(r),$(i)),O(e,g),O(o,g),O(a,g)}}}function yr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){j(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&pe(n,e)},d(r){r&&$(n)}}}function vr(t){let e,n;return e=new Mt({props:{$$slots:{default:[yr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function kr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){j(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&pe(n,e)},d(r){r&&$(n)}}}function jr(t){let e,n;return e=new Mt({props:{$$slots:{default:[kr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function Cr(t){let e,n,r,o,l,i;return e=new He({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":lt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[vr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new He({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":lt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[jr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new vn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N(),F(l.$$.fragment)},l(a){T(e.$$.fragment,a),n=G(a),T(r.$$.fragment,a),o=G(a),T(l.$$.fragment,a)},m(a,s){q(e,a,s),j(a,n,s),q(r,a,s),j(a,o,s),q(l,a,s),i=!0},p(a,s){const m={};s[1]&256&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const p={};s[1]&256&&(p.$$scope={dirty:s,ctx:a}),r.$set(p)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),k(r.$$.fragment,a),k(l.$$.fragment,a),i=!1},d(a){a&&($(n),$(o)),O(e,a),O(r,a),O(l,a)}}}function Er(t){let e,n,r,o;return e=new He({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new sn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment)},l(l){T(e.$$.fragment,l),n=G(l),T(r.$$.fragment,l)},m(l,i){q(e,l,i),j(l,n,i),q(r,l,i),o=!0},p:Se,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),o=!1},d(l){l&&$(n),O(e,l),O(r,l)}}}function Lr(t){let e,n,r,o,l,i,a,s,m,p,_,f;e=new fn({}),e.$on("click",t[8]),r=new an({props:{gj:t[3].summary.networkMap,show:t[2]}});let L=ce(t[3].jat[t[0]][t[1]].arms),P=[];for(let u=0;u<L.length;u+=1)P[u]=ct(mt(t,L,u));const B=u=>k(P[u],1,1,()=>{P[u]=null});let y=ce(t[3].jat[t[0]][t[1]].movements),E=[];for(let u=0;u<y.length;u+=1)E[u]=gt(ft(t,y,u));const I=u=>k(E[u],1,1,()=>{E[u]=null});return a=new it({props:{data:t[10](t[3]),$$slots:{default:[Cr]},$$scope:{ctx:t}}}),m=new it({props:{data:t[5],$$slots:{default:[Er]},$$scope:{ctx:t}}}),_=new mn({props:{map:t[4]}}),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N();for(let u=0;u<P.length;u+=1)P[u].c();l=N();for(let u=0;u<E.length;u+=1)E[u].c();i=N(),F(a.$$.fragment),s=N(),F(m.$$.fragment),p=N(),F(_.$$.fragment)},l(u){T(e.$$.fragment,u),n=G(u),T(r.$$.fragment,u),o=G(u);for(let d=0;d<P.length;d+=1)P[d].l(u);l=G(u);for(let d=0;d<E.length;d+=1)E[d].l(u);i=G(u),T(a.$$.fragment,u),s=G(u),T(m.$$.fragment,u),p=G(u),T(_.$$.fragment,u)},m(u,d){q(e,u,d),j(u,n,d),q(r,u,d),j(u,o,d);for(let h=0;h<P.length;h+=1)P[h]&&P[h].m(u,d);j(u,l,d);for(let h=0;h<E.length;h+=1)E[h]&&E[h].m(u,d);j(u,i,d),q(a,u,d),j(u,s,d),q(m,u,d),j(u,p,d),q(_,u,d),f=!0},p(u,d){const h={};if(d[0]&8&&(h.gj=u[3].summary.networkMap),d[0]&4&&(h.show=u[2]),r.$set(h),d[0]&139){L=ce(u[3].jat[u[0]][u[1]].arms);let C;for(C=0;C<L.length;C+=1){const z=mt(u,L,C);P[C]?(P[C].p(z,d),w(P[C],1)):(P[C]=ct(z),P[C].c(),w(P[C],1),P[C].m(l.parentNode,l))}for(se(),C=L.length;C<P.length;C+=1)B(C);ue()}if(d[0]&203){y=ce(u[3].jat[u[0]][u[1]].movements);let C;for(C=0;C<y.length;C+=1){const z=ft(u,y,C);E[C]?(E[C].p(z,d),w(E[C],1)):(E[C]=gt(z),E[C].c(),w(E[C],1),E[C].m(i.parentNode,i))}for(se(),C=y.length;C<E.length;C+=1)I(C);ue()}const g={};d[0]&8&&(g.data=u[10](u[3])),d[1]&256&&(g.$$scope={dirty:d,ctx:u}),a.$set(g);const v={};d[0]&32&&(v.data=u[5]),d[1]&256&&(v.$$scope={dirty:d,ctx:u}),m.$set(v);const Z={};d[0]&16&&(Z.map=u[4]),_.$set(Z)},i(u){if(!f){w(e.$$.fragment,u),w(r.$$.fragment,u);for(let d=0;d<L.length;d+=1)w(P[d]);for(let d=0;d<y.length;d+=1)w(E[d]);w(a.$$.fragment,u),w(m.$$.fragment,u),w(_.$$.fragment,u),f=!0}},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),P=P.filter(Boolean);for(let d=0;d<P.length;d+=1)k(P[d]);E=E.filter(Boolean);for(let d=0;d<E.length;d+=1)k(E[d]);k(a.$$.fragment,u),k(m.$$.fragment,u),k(_.$$.fragment,u),f=!1},d(u){u&&($(n),$(o),$(l),$(i),$(s),$(p)),O(e,u),O(r,u),Ae(P,u),Ae(E,u),O(a,u),O(m,u),O(_,u)}}}function Pr(t){let e,n,r;function o(i){t[29](i)}let l={$$slots:{default:[Lr]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.map=t[4]),e=new on({props:l}),x.push(()=>re(e,"map",o)),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,a){const s={};a[0]&63|a[1]&256&&(s.$$scope={dirty:a,ctx:i}),!n&&a[0]&16&&(n=!0,s.map=i[4],ee(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){O(e,i)}}}function pt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Mr(t){return String.fromCharCode(t+65)}function Ar(t,e,n){let r,o;Ne(t,V,b=>n(3,o=b));let{junctionIdx:l}=e,{stage:i}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:m}=e,{streetviewOn:p}=e,{showContext:_}=e,f,L={0:Te.red.background,1:Te.amber.background,2:Te.green.background,X:Te.critical.background};function P(b,U,ie){let we={type:"FeatureCollection",features:[]},ye=U??ie;return ye!=null&&(ye.kind=="arm"?we.features.push(pt(b.jat[l][i].arms[ye.idx],ye.idx)):we.features.push(u(b.jat[l][i].movements[ye.idx],ye.idx))),we}function B(b){n(11,s=b),n(12,m=null)}function y(b){if(!p){for(let U of f.queryRenderedFeatures(b.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(11,s=null);return}a=="arm"?(Me(V,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:b.detail.lngLat.toArray(),name:""}],o),n(11,s={kind:"arm",idx:o.jat[l][i].arms.length-1})):(Me(V,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:b.detail.lngLat.toArray(),point2:st(b.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:st(b.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(11,s={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(12,m=null)}}function E(b){B({kind:"movement",idx:b.detail.features[0].id})}xt(()=>{h(!1)});function I(b){let U={type:"FeatureCollection",features:b.jat[l][i].movements.map((ie,we)=>u(ie,we))};for(let ie of b.jat[l][i].movements)if(U.features.push(d(ie,U.features.length)),ie.kind=="walking & wheeling"){let we={...ie,point1:ie.point3,point3:ie.point1};U.features.push(d(we,U.features.length))}return U}function u(b,U){return{type:"Feature",id:U,properties:{name:b.name,kind:b.kind,color:L[b.score]},geometry:{type:"LineString",coordinates:[b.point1,b.point2,b.point3]}}}function d(b,U){return{type:"Feature",id:U,properties:{kind:b.kind,color:L[b.score],angle:dr(b.point2,b.point3)},geometry:{type:"Point",coordinates:b.point3}}}function h(b){let U=I(o);for(let ie of o.jat[l][i].arms)U.features.push(pt(ie,U.features.length));for(let ie of o.summary.networkMap.features)U.features.push(ie);U.features.length>0&&f.fitBounds(ln(U),{padding:20,animate:b})}function g(){return f}function v(b,U){t.$$.not_equal(U.point,b)&&(U.point=b,V.set(o))}const Z=b=>B({kind:"arm",idx:b}),C=b=>B({kind:"arm",idx:b});function z(b,U){t.$$.not_equal(U.point1,b)&&(U.point1=b,V.set(o))}const R=b=>B({kind:"movement",idx:b}),S=b=>B({kind:"movement",idx:b});function W(b,U){t.$$.not_equal(U.point2,b)&&(U.point2=b,V.set(o))}const Q=b=>B({kind:"movement",idx:b}),c=b=>B({kind:"movement",idx:b});function M(b,U){t.$$.not_equal(U.point3,b)&&(U.point3=b,V.set(o))}const A=b=>B({kind:"movement",idx:b}),me=b=>B({kind:"movement",idx:b});function D(b){f=b,n(4,f)}return t.$$set=b=>{"junctionIdx"in b&&n(0,l=b.junctionIdx),"stage"in b&&n(1,i=b.stage),"newKind"in b&&n(13,a=b.newKind),"editing"in b&&n(11,s=b.editing),"hoveringSidebar"in b&&n(12,m=b.hoveringSidebar),"streetviewOn"in b&&n(14,p=b.streetviewOn),"showContext"in b&&n(2,_=b.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=P(o,s,m))},[l,i,_,o,f,r,L,B,y,E,I,s,m,a,p,h,g,v,Z,C,z,R,S,W,Q,c,M,A,me,D]}class Sr extends Ie{constructor(e){super(),Fe(this,e,Ar,Pr,Ce,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Ir(t){let e,n,r,o,l,i,a,s,m,p,_,f;function L(h){t[5](h)}let P={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(P.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new We({props:P}),x.push(()=>re(e,"value",L));function B(h){t[6](h)}let y={legend:"Movement",choices:It(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(y.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new At({props:y}),x.push(()=>re(o,"value",B));function E(h){t[7](h)}let I={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(I.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new $n({props:I}),x.push(()=>re(a,"value",E));function u(h){t[8](h)}let d={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),p=new St({props:d}),x.push(()=>re(p,"value",u)),{c(){F(e.$$.fragment),r=N(),F(o.$$.fragment),i=N(),F(a.$$.fragment),m=N(),F(p.$$.fragment)},l(h){T(e.$$.fragment,h),r=G(h),T(o.$$.fragment,h),i=G(h),T(a.$$.fragment,h),m=G(h),T(p.$$.fragment,h)},m(h,g){q(e,h,g),j(h,r,g),q(o,h,g),j(h,i,g),q(a,h,g),j(h,m,g),q(p,h,g),f=!0},p(h,[g]){const v={};!n&&g&15&&(n=!0,v.value=h[3].jat[h[0]][h[1]].movements[h[2]].name,ee(()=>n=!1)),e.$set(v);const Z={};!l&&g&15&&(l=!0,Z.value=h[3].jat[h[0]][h[1]].movements[h[2]].kind,ee(()=>l=!1)),o.$set(Z);const C={};!s&&g&15&&(s=!0,C.value=h[3].jat[h[0]][h[1]].movements[h[2]].score,ee(()=>s=!1)),a.$set(C);const z={};!_&&g&15&&(_=!0,z.value=h[3].jat[h[0]][h[1]].movements[h[2]].notes,ee(()=>_=!1)),p.$set(z)},i(h){f||(w(e.$$.fragment,h),w(o.$$.fragment,h),w(a.$$.fragment,h),w(p.$$.fragment,h),f=!0)},o(h){k(e.$$.fragment,h),k(o.$$.fragment,h),k(a.$$.fragment,h),k(p.$$.fragment,h),f=!1},d(h){h&&($(r),$(i),$(m)),O(e,h),O(o,h),O(a,h),O(p,h)}}}function Fr(t,e,n){let r;Ne(t,V,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e;It(["cycling","walking & wheeling"]);let a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(f){t.$$.not_equal(r.jat[o][l].movements[i].name,f)&&(r.jat[o][l].movements[i].name=f,V.set(r))}function m(f){t.$$.not_equal(r.jat[o][l].movements[i].kind,f)&&(r.jat[o][l].movements[i].kind=f,V.set(r))}function p(f){t.$$.not_equal(r.jat[o][l].movements[i].score,f)&&(r.jat[o][l].movements[i].score=f,V.set(r))}function _(f){t.$$.not_equal(r.jat[o][l].movements[i].notes,f)&&(r.jat[o][l].movements[i].notes=f,V.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,l=f.stage),"idx"in f&&n(2,i=f.idx)},[o,l,i,r,a,s,m,p,_]}class Tr extends Ie{constructor(e){super(),Fe(this,e,Fr,Ir,Ce,{junctionIdx:0,stage:1,idx:2})}}const{window:qr}=un;function _t(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function dt(t,e,n){const r=t.slice();return r[33]=e[n],r[32]=n,r}function Or(t){let e,n,r,o,l,i,a,s;e=new dn({props:{$$slots:{default:[Nr]},$$scope:{ctx:t}}}),e.$on("click",t[26]),r=new Lt({props:{$$slots:{default:[Gr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const m=[Dr,zr],p=[];function _(f,L){return f[3].kind=="movement"?0:1}return l=_(t),i=p[l]=m[l](t),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N(),i.c(),a=_e()},l(f){T(e.$$.fragment,f),n=G(f),T(r.$$.fragment,f),o=G(f),i.l(f),a=_e()},m(f,L){q(e,f,L),j(f,n,L),q(r,f,L),j(f,o,L),p[l].m(f,L),j(f,a,L),s=!0},p(f,L){const P={};L[1]&16&&(P.$$scope={dirty:L,ctx:f}),e.$set(P);const B={};L[1]&16&&(B.$$scope={dirty:L,ctx:f}),r.$set(B);let y=l;l=_(f),l===y?p[l].p(f,L):(se(),k(p[y],1,1,()=>{p[y]=null}),ue(),i=p[l],i?i.p(f,L):(i=p[l]=m[l](f),i.c()),w(i,1),i.m(a.parentNode,a))},i(f){s||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(i),s=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(i),s=!1},d(f){f&&($(n),$(o),$(a)),O(e,f),O(r,f),p[l].d(f)}}}function Br(t){let e,n,r,o,l,i,a="Arms",s,m,p,_,f,L="Movements",P,B,y,E,I,u;e=new hn({props:{label:"Tools",$$slots:{default:[Jr]},$$scope:{ctx:t}}});function d(c){t[19](c)}let h={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(h.value=t[2]),r=new At({props:h}),x.push(()=>re(r,"value",d));let g=ce(t[8].jat[t[0]][t[1]].arms),v=[];for(let c=0;c<g.length;c+=1)v[c]=$t(dt(t,g,c));const Z=c=>k(v[c],1,1,()=>{v[c]=null});let C=t[8].jat[t[0]][t[9]].arms.length>0&&bt(t),z=ce(t[8].jat[t[0]][t[1]].movements),R=[];for(let c=0;c<z.length;c+=1)R[c]=wt(_t(t,z,c));const S=c=>k(R[c],1,1,()=>{R[c]=null});let W=t[8].jat[t[0]][t[9]].movements.length>0&&yt(t),Q=t[8].jat[t[0]][t[1]].movements.length>0&&vt(t);return{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),l=N(),i=te("h3"),i.textContent=a,s=N(),m=te("ul");for(let c=0;c<v.length;c+=1)v[c].c();p=N(),C&&C.c(),_=N(),f=te("h3"),f.textContent=L,P=N(),B=te("ol");for(let c=0;c<R.length;c+=1)R[c].c();y=N(),W&&W.c(),E=N(),Q&&Q.c(),I=_e()},l(c){T(e.$$.fragment,c),n=G(c),T(r.$$.fragment,c),l=G(c),i=ne(c,"H3",{"data-svelte-h":!0}),ot(i)!=="svelte-ld74qb"&&(i.textContent=a),s=G(c),m=ne(c,"UL",{});var M=oe(m);for(let me=0;me<v.length;me+=1)v[me].l(M);M.forEach($),p=G(c),C&&C.l(c),_=G(c),f=ne(c,"H3",{"data-svelte-h":!0}),ot(f)!=="svelte-1dc52s8"&&(f.textContent=L),P=G(c),B=ne(c,"OL",{});var A=oe(B);for(let me=0;me<R.length;me+=1)R[me].l(A);A.forEach($),y=G(c),W&&W.l(c),E=G(c),Q&&Q.l(c),I=_e()},m(c,M){q(e,c,M),j(c,n,M),q(r,c,M),j(c,l,M),j(c,i,M),j(c,s,M),j(c,m,M);for(let A=0;A<v.length;A+=1)v[A]&&v[A].m(m,null);j(c,p,M),C&&C.m(c,M),j(c,_,M),j(c,f,M),j(c,P,M),j(c,B,M);for(let A=0;A<R.length;A+=1)R[A]&&R[A].m(B,null);j(c,y,M),W&&W.m(c,M),j(c,E,M),Q&&Q.m(c,M),j(c,I,M),u=!0},p(c,M){const A={};M[0]&224|M[1]&16&&(A.$$scope={dirty:M,ctx:c}),e.$set(A);const me={};if(!o&&M[0]&4&&(o=!0,me.value=c[2],ee(()=>o=!1)),r.$set(me),M[0]&1299){g=ce(c[8].jat[c[0]][c[1]].arms);let D;for(D=0;D<g.length;D+=1){const b=dt(c,g,D);v[D]?(v[D].p(b,M),w(v[D],1)):(v[D]=$t(b),v[D].c(),w(v[D],1),v[D].m(m,null))}for(se(),D=g.length;D<v.length;D+=1)Z(D);ue()}if(c[8].jat[c[0]][c[9]].arms.length>0?C?(C.p(c,M),M[0]&257&&w(C,1)):(C=bt(c),C.c(),w(C,1),C.m(_.parentNode,_)):C&&(se(),k(C,1,1,()=>{C=null}),ue()),M[0]&1299){z=ce(c[8].jat[c[0]][c[1]].movements);let D;for(D=0;D<z.length;D+=1){const b=_t(c,z,D);R[D]?(R[D].p(b,M),w(R[D],1)):(R[D]=wt(b),R[D].c(),w(R[D],1),R[D].m(B,null))}for(se(),D=z.length;D<R.length;D+=1)S(D);ue()}c[8].jat[c[0]][c[9]].movements.length>0?W?(W.p(c,M),M[0]&257&&w(W,1)):(W=yt(c),W.c(),w(W,1),W.m(E.parentNode,E)):W&&(se(),k(W,1,1,()=>{W=null}),ue()),c[8].jat[c[0]][c[1]].movements.length>0?Q?Q.p(c,M):(Q=vt(c),Q.c(),Q.m(I.parentNode,I)):Q&&(Q.d(1),Q=null)},i(c){if(!u){w(e.$$.fragment,c),w(r.$$.fragment,c);for(let M=0;M<g.length;M+=1)w(v[M]);w(C);for(let M=0;M<z.length;M+=1)w(R[M]);w(W),u=!0}},o(c){k(e.$$.fragment,c),k(r.$$.fragment,c),v=v.filter(Boolean);for(let M=0;M<v.length;M+=1)k(v[M]);k(C),R=R.filter(Boolean);for(let M=0;M<R.length;M+=1)k(R[M]);k(W),u=!1},d(c){c&&($(n),$(l),$(i),$(s),$(m),$(p),$(_),$(f),$(P),$(B),$(y),$(E),$(I)),O(e,c),O(r,c),Ae(v,c),C&&C.d(c),Ae(R,c),W&&W.d(c),Q&&Q.d(c)}}}function Nr(t){let e;return{c(){e=K("Save")},l(n){e=X(n,"Save")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function Gr(t){let e;return{c(){e=K("Delete")},l(n){e=X(n,"Delete")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function zr(t){let e,n,r;function o(i){t[27](i)}let l={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new We({props:l}),x.push(()=>re(e,"value",o)),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&267&&(n=!0,s.value=i[8].jat[i[0]][i[1]].arms[i[3].idx].name,ee(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){O(e,i)}}}function Dr(t){let e,n;return e=new Tr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function Rr(t){let e;return{c(){e=K("Zoom to fit")},l(n){e=X(n,"Zoom to fit")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function ht(t){var i;let e,n,r;function o(a){t[17](a)}let l={map:(i=t[7])==null?void 0:i.getMap()};return t[5]!==void 0&&(l.enabled=t[5]),e=new _n({props:l}),x.push(()=>re(e,"enabled",o)),{c(){F(e.$$.fragment)},l(a){T(e.$$.fragment,a)},m(a,s){q(e,a,s),r=!0},p(a,s){var p;const m={};s[0]&128&&(m.map=(p=a[7])==null?void 0:p.getMap()),!n&&s[0]&32&&(n=!0,m.enabled=a[5],ee(()=>n=!1)),e.$set(m)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){O(e,a)}}}function Ur(t){let e;return{c(){e=K("Show scheme context")},l(n){e=X(n,"Show scheme context")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function Jr(t){var B;let e,n,r,o,l,i,a=(B=t[7])==null?void 0:B.getMap(),s,m,p,_;e=new ge({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new cn({}),l=new gn({});let f=a&&ht(t);function L(y){t[18](y)}let P={$$slots:{default:[Ur]},$$scope:{ctx:t}};return t[6]!==void 0&&(P.checked=t[6]),m=new pn({props:P}),x.push(()=>re(m,"checked",L)),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N(),F(l.$$.fragment),i=N(),f&&f.c(),s=N(),F(m.$$.fragment)},l(y){T(e.$$.fragment,y),n=G(y),T(r.$$.fragment,y),o=G(y),T(l.$$.fragment,y),i=G(y),f&&f.l(y),s=G(y),T(m.$$.fragment,y)},m(y,E){q(e,y,E),j(y,n,E),q(r,y,E),j(y,o,E),q(l,y,E),j(y,i,E),f&&f.m(y,E),j(y,s,E),q(m,y,E),_=!0},p(y,E){var d;const I={};E[1]&16&&(I.$$scope={dirty:E,ctx:y}),e.$set(I),E[0]&128&&(a=(d=y[7])==null?void 0:d.getMap()),a?f?(f.p(y,E),E[0]&128&&w(f,1)):(f=ht(y),f.c(),w(f,1),f.m(s.parentNode,s)):f&&(se(),k(f,1,1,()=>{f=null}),ue());const u={};E[1]&16&&(u.$$scope={dirty:E,ctx:y}),!p&&E[0]&64&&(p=!0,u.checked=y[6],ee(()=>p=!1)),m.$set(u)},i(y){_||(w(e.$$.fragment,y),w(r.$$.fragment,y),w(l.$$.fragment,y),w(f),w(m.$$.fragment,y),_=!0)},o(y){k(e.$$.fragment,y),k(r.$$.fragment,y),k(l.$$.fragment,y),k(f),k(m.$$.fragment,y),_=!1},d(y){y&&($(n),$(o),$(i),$(s)),O(e,y),O(r,y),O(l,y),f&&f.d(y),O(m,y)}}}function Hr(t){let e=Zr(t[32])+"",n,r,o=(t[33].name||"Unnamed arm")+"",l;return{c(){n=K(e),r=K(" - "),l=K(o)},l(i){n=X(i,e),r=X(i," - "),l=X(i,o)},m(i,a){j(i,n,a),j(i,r,a),j(i,l,a)},p(i,a){a[0]&259&&o!==(o=(i[33].name||"Unnamed arm")+"")&&pe(l,o)},d(i){i&&($(n),$(r),$(l))}}}function $t(t){let e,n,r,o;function l(){return t[20](t[32])}function i(){return t[21](t[32])}return n=new ge({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[22]),{c(){e=te("li"),F(n.$$.fragment),r=N()},l(a){e=ne(a,"LI",{});var s=oe(e);T(n.$$.fragment,s),r=G(s),s.forEach($)},m(a,s){j(a,e,s),q(n,e,null),fe(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&16&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&$(e),O(n)}}}function bt(t){let e,n;return e=new ge({props:{$$slots:{default:[Kr]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function Kr(t){let e,n;return{c(){e=K("Copy arms from "),n=K(t[9])},l(r){e=X(r,"Copy arms from "),n=X(r,t[9])},m(r,o){j(r,e,o),j(r,n,o)},p:Se,d(r){r&&($(e),$(n))}}}function Xr(t){let e=(t[30].name||"Unnamed movement")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){j(r,n,o)},p(r,o){o[0]&259&&e!==(e=(r[30].name||"Unnamed movement")+"")&&pe(n,e)},d(r){r&&$(n)}}}function wt(t){let e,n,r,o;function l(){return t[23](t[32])}function i(){return t[24](t[32])}return n=new ge({props:{$$slots:{default:[Xr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[25]),{c(){e=te("li"),F(n.$$.fragment),r=N()},l(a){e=ne(a,"LI",{});var s=oe(e);T(n.$$.fragment,s),r=G(s),s.forEach($)},m(a,s){j(a,e,s),q(n,e,null),fe(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&16&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&$(e),O(n)}}}function yt(t){let e,n;return e=new ge({props:{$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function Vr(t){let e,n;return{c(){e=K("Copy movements from "),n=K(t[9])},l(r){e=X(r,"Copy movements from "),n=X(r,t[9])},m(r,o){j(r,e,o),j(r,n,o)},p:Se,d(r){r&&($(e),$(n))}}}function vt(t){let e,n,r=kt(t[8].jat[t[0]][t[1]]).toFixed(1)+"",o,l;return{c(){e=te("p"),n=K("Total JAT score: "),o=K(r),l=K("%")},l(i){e=ne(i,"P",{});var a=oe(e);n=X(a,"Total JAT score: "),o=X(a,r),l=X(a,"%"),a.forEach($)},m(i,a){j(i,e,a),fe(e,n),fe(e,o),fe(e,l)},p(i,a){a[0]&259&&r!==(r=kt(i[8].jat[i[0]][i[1]]).toFixed(1)+"")&&pe(o,r)},d(i){i&&$(e)}}}function Wr(t){let e,n,r,o,l,i,a,s,m,p,_,f,L,P;function B(g){t[15](g)}let y={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(y.value=t[8].jat[t[0]][t[1]].notes),e=new St({props:y}),x.push(()=>re(e,"value",B));const E=[Br,Or],I=[];function u(g,v){return g[3]==null?0:1}i=u(t),a=I[i]=E[i](t);function d(g){t[29](g)}let h={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(h.editing=t[3]),p=new Sr({props:h}),t[28](p),x.push(()=>re(p,"editing",d)),{c(){F(e.$$.fragment),r=N(),o=te("div"),l=te("div"),a.c(),s=N(),m=te("div"),F(p.$$.fragment),this.h()},l(g){T(e.$$.fragment,g),r=G(g),o=ne(g,"DIV",{style:!0});var v=oe(o);l=ne(v,"DIV",{style:!0});var Z=oe(l);a.l(Z),Z.forEach($),s=G(v),m=ne(v,"DIV",{style:!0});var C=oe(m);T(p.$$.fragment,C),C.forEach($),v.forEach($),this.h()},h(){Y(l,"width","30%"),Y(l,"overflow-y","scroll"),Y(l,"padding","10px"),Y(l,"border","1px solid black"),Y(m,"position","relative"),Y(m,"width","100%"),Y(o,"display","flex"),Y(o,"height","80vh")},m(g,v){q(e,g,v),j(g,r,v),j(g,o,v),fe(o,l),I[i].m(l,null),fe(o,s),fe(o,m),q(p,m,null),f=!0,L||(P=en(qr,"keydown",t[12]),L=!0)},p(g,v){const Z={};!n&&v[0]&259&&(n=!0,Z.value=g[8].jat[g[0]][g[1]].notes,ee(()=>n=!1)),e.$set(Z);let C=i;i=u(g),i===C?I[i].p(g,v):(se(),k(I[C],1,1,()=>{I[C]=null}),ue(),a=I[i],a?a.p(g,v):(a=I[i]=E[i](g),a.c()),w(a,1),a.m(l,null));const z={};v[0]&1&&(z.junctionIdx=g[0]),v[0]&2&&(z.stage=g[1]),v[0]&4&&(z.newKind=g[2]),v[0]&16&&(z.hoveringSidebar=g[4]),v[0]&32&&(z.streetviewOn=g[5]),v[0]&64&&(z.showContext=g[6]),!_&&v[0]&8&&(_=!0,z.editing=g[3],ee(()=>_=!1)),p.$set(z)},i(g){f||(w(e.$$.fragment,g),w(a),w(p.$$.fragment,g),f=!0)},o(g){k(e.$$.fragment,g),k(a),k(p.$$.fragment,g),f=!1},d(g){g&&($(r),$(o)),O(e,g),I[i].d(),t[28](null),O(p),L=!1,P()}}}function Zr(t){return String.fromCharCode(t+65)}function kt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function Qr(t,e,n){let r;Ne(t,V,A=>n(8,r=A));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",a="arm",s=null,m=null,p=!1,_=!0,f=null;function L(A){n(3,s=A),n(4,m=null)}function P(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][l].movements.splice(s.idx,1),V.set(r)):(r.jat[o][l].arms.splice(s.idx,1),V.set(r)),n(3,s=null))}function B(A){s!=null&&A.key=="Escape"?(A.stopPropagation(),n(3,s=null)):s!=null&&A.key=="Delete"&&P()}function y(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(Me(V,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),V.set(r))}function E(){r.jat[o][l].movements.length>0&&!window.confirm("Overwrite movements?")||(Me(V,r.jat[o][l].movements=JSON.parse(JSON.stringify(r.jat[o][i].movements)),r),V.set(r))}function I(A){t.$$.not_equal(r.jat[o][l].notes,A)&&(r.jat[o][l].notes=A,V.set(r))}const u=()=>f==null?void 0:f.zoom(!0);function d(A){p=A,n(5,p)}function h(A){_=A,n(6,_)}function g(A){a=A,n(2,a)}const v=A=>L({kind:"arm",idx:A}),Z=A=>n(4,m={kind:"arm",idx:A}),C=()=>n(4,m=null),z=A=>L({kind:"movement",idx:A}),R=A=>n(4,m={kind:"movement",idx:A}),S=()=>n(4,m=null),W=()=>n(3,s=null);function Q(A){t.$$.not_equal(r.jat[o][l].arms[s.idx].name,A)&&(r.jat[o][l].arms[s.idx].name=A,V.set(r))}function c(A){x[A?"unshift":"push"](()=>{f=A,n(7,f)})}function M(A){s=A,n(3,s)}return t.$$set=A=>{"junctionIdx"in A&&n(0,o=A.junctionIdx),"stage"in A&&n(1,l=A.stage)},[o,l,a,s,m,p,_,f,r,i,L,P,B,y,E,I,u,d,h,g,v,Z,C,z,R,S,W,Q,c,M]}class Yr extends Ie{constructor(e){super(),Fe(this,e,Qr,Wr,Ce,{junctionIdx:0,stage:1},null,[-1,-1])}}function jt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function xr(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,p,_,f,L=t[0].stage,P,B;s=new tn({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}});function y(u){t[9](u)}let E={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(E.value=t[1].jat[t[0].idx].name),p=new We({props:E}),x.push(()=>re(p,"value",y));let I=Ct(t);return{c(){e=te("h2"),r=K(n),o=K(" - "),i=K(l),a=N(),F(s.$$.fragment),m=N(),F(p.$$.fragment),f=N(),I.c(),P=_e()},l(u){e=ne(u,"H2",{});var d=oe(e);r=X(d,n),o=X(d," - "),i=X(d,l),d.forEach($),a=G(u),T(s.$$.fragment,u),m=G(u),T(p.$$.fragment,u),f=G(u),I.l(u),P=_e()},m(u,d){j(u,e,d),fe(e,r),fe(e,o),fe(e,i),j(u,a,d),q(s,u,d),j(u,m,d),q(p,u,d),j(u,f,d),I.m(u,d),j(u,P,d),B=!0},p(u,d){(!B||d&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&pe(r,n),(!B||d&1)&&l!==(l=u[0].stage+"")&&pe(i,l);const h={};d&8193&&(h.$$scope={dirty:d,ctx:u}),s.$set(h);const g={};!_&&d&3&&(_=!0,g.value=u[1].jat[u[0].idx].name,ee(()=>_=!1)),p.$set(g),d&1&&Ce(L,L=u[0].stage)?(se(),k(I,1,1,Se),ue(),I=Ct(u),I.c(),w(I,1),I.m(P.parentNode,P)):I.p(u,d)},i(u){B||(w(s.$$.fragment,u),w(p.$$.fragment,u),w(I),B=!0)},o(u){k(s.$$.fragment,u),k(p.$$.fragment,u),k(I),B=!1},d(u){u&&($(e),$(a),$(m),$(f),$(P)),O(s,u),O(p,u),I.d(u)}}}function eo(t){let e,n,r,o;e=new ge({props:{$$slots:{default:[so]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=ce(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Et(jt(t,l,s));const a=s=>k(i[s],1,1,()=>{i[s]=null});return{c(){F(e.$$.fragment),n=N(),r=te("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){T(e.$$.fragment,s),n=G(s),r=ne(s,"OL",{});var m=oe(r);for(let p=0;p<i.length;p+=1)i[p].l(m);m.forEach($)},m(s,m){q(e,s,m),j(s,n,m),j(s,r,m);for(let p=0;p<i.length;p+=1)i[p]&&i[p].m(r,null);o=!0},p(s,m){const p={};if(m&8192&&(p.$$scope={dirty:m,ctx:s}),e.$set(p),m&3){l=ce(s[1].jat);let _;for(_=0;_<l.length;_+=1){const f=jt(s,l,_);i[_]?(i[_].p(f,m),w(i[_],1)):(i[_]=Et(f),i[_].c(),w(i[_],1),i[_].m(r,null))}for(se(),_=l.length;_<i.length;_+=1)a(_);ue()}},i(s){if(!o){w(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(s){k(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)k(i[m]);o=!1},d(s){s&&($(n),$(r)),O(e,s),Ae(i,s)}}}function to(t){let e;return{c(){e=K("Back to all junctions")},l(n){e=X(n,"Back to all junctions")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function no(t){let e,n;return e=new ge({props:{$$slots:{default:[oo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function ro(t){let e,n;return e=new ge({props:{$$slots:{default:[io]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function oo(t){let e;return{c(){e=K("Edit Proposed")},l(n){e=X(n,"Edit Proposed")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function io(t){let e;return{c(){e=K("Edit Existing")},l(n){e=X(n,"Edit Existing")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function lo(t){let e;return{c(){e=K("Delete")},l(n){e=X(n,"Delete")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function ao(t){let e,n,r,o,l,i,a;e=new ge({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const s=[ro,no],m=[];function p(_,f){return _[0].stage=="proposed"?0:1}return r=p(t),o=m[r]=s[r](t),i=new Lt({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){F(e.$$.fragment),n=N(),o.c(),l=N(),F(i.$$.fragment)},l(_){T(e.$$.fragment,_),n=G(_),o.l(_),l=G(_),T(i.$$.fragment,_)},m(_,f){q(e,_,f),j(_,n,f),m[r].m(_,f),j(_,l,f),q(i,_,f),a=!0},p(_,f){const L={};f&8192&&(L.$$scope={dirty:f,ctx:_}),e.$set(L);let P=r;r=p(_),r===P?m[r].p(_,f):(se(),k(m[P],1,1,()=>{m[P]=null}),ue(),o=m[r],o?o.p(_,f):(o=m[r]=s[r](_),o.c()),w(o,1),o.m(l.parentNode,l));const B={};f&8192&&(B.$$scope={dirty:f,ctx:_}),i.$set(B)},i(_){a||(w(e.$$.fragment,_),w(o),w(i.$$.fragment,_),a=!0)},o(_){k(e.$$.fragment,_),k(o),k(i.$$.fragment,_),a=!1},d(_){_&&($(n),$(l)),O(e,_),m[r].d(_),O(i,_)}}}function Ct(t){let e,n;return e=new Yr({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function so(t){let e;return{c(){e=K("Add new junction")},l(n){e=X(n,"Add new junction")},m(n,r){j(n,e,r)},d(n){n&&$(e)}}}function uo(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){j(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&pe(n,e)},d(r){r&&$(n)}}}function Et(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new ge({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=te("li"),F(n.$$.fragment),r=N()},l(i){e=ne(i,"LI",{});var a=oe(e);T(n.$$.fragment,a),r=G(a),a.forEach($)},m(i,a){j(i,e,a),q(n,e,null),fe(e,r),o=!0},p(i,a){t=i;const s={};a&8194&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&$(e),O(n)}}}function fo(t){let e,n,r,o;const l=[eo,xr],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=_e()},l(s){n&&n.l(s),r=_e()},m(s,m){~e&&i[e].m(s,m),j(s,r,m),o=!0},p(s,[m]){let p=e;e=a(s),e===p?~e&&i[e].p(s,m):(n&&(se(),k(i[p],1,1,()=>{i[p]=null}),ue()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){k(n),o=!1},d(s){s&&$(r),~e&&i[e].d(s)}}}function Je(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function mo(t,e,n){let r;Ne(t,V,L=>n(1,r=L));let o={kind:"list"};function l(){Me(V,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(L){window.confirm("Delete this junction?")&&(r.jat.splice(L,1),V.set(r),n(0,o={kind:"list"}))}const a=L=>n(0,o={kind:"edit",idx:L,stage:"existing"}),s=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Je(o),stage:"existing"}),p=()=>n(0,o={kind:"edit",idx:Je(o),stage:"proposed"}),_=()=>i(Je(o));function f(L){t.$$.not_equal(r.jat[o.idx].name,L)&&(r.jat[o.idx].name=L,V.set(r))}return[o,r,l,i,a,s,m,p,_,f]}class Mo extends Ie{constructor(e){super(),Fe(this,e,mo,fo,Ce,{})}}export{Mo as component};
