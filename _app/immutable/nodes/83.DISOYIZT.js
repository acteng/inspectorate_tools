import{s as be,v as Y,x as Z,l as Ke,u as Je,m as Ye,o as Ze,H as fe,e as W,t as le,a as D,c as R,b as U,d as oe,f as b,g as E,r as V,w as x,i as C,h as F,k as Se,z as ae,U as Qe,a7 as Xe,E as Te,p as Ce,q as pe,j as $e,B as Ge,N as Be,n as xe,R as we,S as Le}from"../chunks/scheduler.Bsni_e59.js";import{S as ye,i as ke,e as Q,c as M,a as q,m as z,t as w,b as T,d as j,f as me,g as ge}from"../chunks/index.CCfAUppz.js";import{L as et,g as tt,M as nt,a as it,G as lt}from"../chunks/MapLibreMap.BhPkPOZb.js";import{e as se}from"../chunks/each.BmgwAlbi.js";import{c as ot,p as rt}from"../chunks/colors.CYEpEtTL.js";import{p as He}from"../chunks/index.B9wZUY4b.js";import{S as de}from"../chunks/Select.bLRJACqI.js";import{T as Oe}from"../chunks/TextArea.DbePhW6L.js";import{T as We}from"../chunks/TextInput.CHbK327s.js";import{s as O}from"../chunks/data.Bx6I4yi5.js";import{s as he,b as ve,a as st,B as at,G as ft,R as ut,S as ct,c as _t,M as Re}from"../chunks/GeoreferenceLayer.CxrvFMtl.js";import{Y as Ue}from"../chunks/YesNo.DKONmPAs.js";import{D as mt}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as gt,S as pt}from"../chunks/WarningButton.D9QeV9gM.js";function dt(e){let t;const i=e[16].default,n=Ke(i,e,e[24],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,c){n&&n.m(o,c),t=!0},p(o,c){n&&n.p&&(!t||c&16777216)&&Je(n,i,o,o[24],t?Ze(i,o[24],c,null):Ye(o[24]),null)},i(o){t||(w(n,o),t=!0)},o(o){T(n,o),t=!1},d(o){n&&n.d(o)}}}function ht(e){let t,i,n;function o(s){e[17](s)}let c={id:e[1],type:"circle",source:e[2],sourceLayer:e[3],beforeId:e[4],beforeLayerType:e[5],paint:e[6],layout:e[7],filter:e[8],applyToClusters:e[9],minzoom:e[10],maxzoom:e[11],hoverCursor:e[12],manageHoverState:e[13],eventsIfTopMost:e[14],interactive:e[15],$$slots:{default:[dt]},$$scope:{ctx:e}};return e[0]!==void 0&&(c.hovered=e[0]),t=new et({props:c}),Y.push(()=>Q(t,"hovered",o)),t.$on("click",e[18]),t.$on("dblclick",e[19]),t.$on("contextmenu",e[20]),t.$on("mouseenter",e[21]),t.$on("mousemove",e[22]),t.$on("mouseleave",e[23]),{c(){M(t.$$.fragment)},l(s){q(t.$$.fragment,s)},m(s,f){z(t,s,f),n=!0},p(s,[f]){const r={};f&2&&(r.id=s[1]),f&4&&(r.source=s[2]),f&8&&(r.sourceLayer=s[3]),f&16&&(r.beforeId=s[4]),f&32&&(r.beforeLayerType=s[5]),f&64&&(r.paint=s[6]),f&128&&(r.layout=s[7]),f&256&&(r.filter=s[8]),f&512&&(r.applyToClusters=s[9]),f&1024&&(r.minzoom=s[10]),f&2048&&(r.maxzoom=s[11]),f&4096&&(r.hoverCursor=s[12]),f&8192&&(r.manageHoverState=s[13]),f&16384&&(r.eventsIfTopMost=s[14]),f&32768&&(r.interactive=s[15]),f&16777216&&(r.$$scope={dirty:f,ctx:s}),!i&&f&1&&(i=!0,r.hovered=s[0],Z(()=>i=!1)),t.$set(r)},i(s){n||(w(t.$$.fragment,s),n=!0)},o(s){T(t.$$.fragment,s),n=!1},d(s){j(t,s)}}}function vt(e,t,i){let{$$slots:n={},$$scope:o}=t,{id:c=tt("circle")}=t,{source:s=void 0}=t,{sourceLayer:f=void 0}=t,{beforeId:r=void 0}=t,{beforeLayerType:y=void 0}=t,{paint:m}=t,{layout:u=void 0}=t,{filter:v=void 0}=t,{applyToClusters:a=void 0}=t,{minzoom:h=void 0}=t,{maxzoom:B=void 0}=t,{hoverCursor:L=void 0}=t,{manageHoverState:d=!1}=t,{hovered:k=null}=t,{eventsIfTopMost:I=!1}=t,{interactive:G=!0}=t;function K(p){k=p,i(0,k)}function A(p){fe.call(this,e,p)}function J(p){fe.call(this,e,p)}function S(p){fe.call(this,e,p)}function re(p){fe.call(this,e,p)}function ee(p){fe.call(this,e,p)}function X(p){fe.call(this,e,p)}return e.$$set=p=>{"id"in p&&i(1,c=p.id),"source"in p&&i(2,s=p.source),"sourceLayer"in p&&i(3,f=p.sourceLayer),"beforeId"in p&&i(4,r=p.beforeId),"beforeLayerType"in p&&i(5,y=p.beforeLayerType),"paint"in p&&i(6,m=p.paint),"layout"in p&&i(7,u=p.layout),"filter"in p&&i(8,v=p.filter),"applyToClusters"in p&&i(9,a=p.applyToClusters),"minzoom"in p&&i(10,h=p.minzoom),"maxzoom"in p&&i(11,B=p.maxzoom),"hoverCursor"in p&&i(12,L=p.hoverCursor),"manageHoverState"in p&&i(13,d=p.manageHoverState),"hovered"in p&&i(0,k=p.hovered),"eventsIfTopMost"in p&&i(14,I=p.eventsIfTopMost),"interactive"in p&&i(15,G=p.interactive),"$$scope"in p&&i(24,o=p.$$scope)},[k,c,s,f,r,y,m,u,v,a,h,B,L,d,I,G,n,K,A,J,S,re,ee,X,o]}class bt extends ye{constructor(t){super(),ke(this,t,vt,ht,be,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function $t(e){let t,i,n,o,c,s,f,r,y,m,u,v,a,h,B,L,d,k,I,G,K,A,J,S;function re(l){e[3](l)}let ee={label:"Critical Issue",emptyOption:!0,choices:e[2]};e[1].criticalIssues[e[0]].criticalIssue!==void 0&&(ee.value=e[1].criticalIssues[e[0]].criticalIssue),m=new de({props:ee}),Y.push(()=>Q(m,"value",re));function X(l){e[4](l)}let p={label:"Stage",emptyOption:!0,choices:He(["Existing","Design"])};e[1].criticalIssues[e[0]].stage!==void 0&&(p.value=e[1].criticalIssues[e[0]].stage),a=new de({props:p}),Y.push(()=>Q(a,"value",X));function te(l){e[5](l)}let P={label:"Location Name"};e[1].criticalIssues[e[0]].locationName!==void 0&&(P.value=e[1].criticalIssues[e[0]].locationName),L=new We({props:P}),Y.push(()=>Q(L,"value",te));function _(l){e[6](l)}let g={label:"Resolved by Design"};e[1].criticalIssues[e[0]].resolved!==void 0&&(g.value=e[1].criticalIssues[e[0]].resolved),I=new Ue({props:g}),Y.push(()=>Q(I,"value",_));function N(l){e[7](l)}let H={label:"Commentary & Feedback"};return e[1].criticalIssues[e[0]].notes!==void 0&&(H.value=e[1].criticalIssues[e[0]].notes),A=new Oe({props:H}),Y.push(()=>Q(A,"value",N)),{c(){t=W("div"),i=W("a"),n=le("Google StreetView"),c=D(),s=W("a"),f=le("Bing Streetside"),y=D(),M(m.$$.fragment),v=D(),M(a.$$.fragment),B=D(),M(L.$$.fragment),k=D(),M(I.$$.fragment),K=D(),M(A.$$.fragment),this.h()},l(l){t=R(l,"DIV",{style:!0});var $=U(t);i=R($,"A",{href:!0,target:!0});var ne=U(i);n=oe(ne,"Google StreetView"),ne.forEach(b),c=E($),s=R($,"A",{href:!0,target:!0});var ie=U(s);f=oe(ie,"Bing Streetside"),ie.forEach(b),$.forEach(b),y=E(l),q(m.$$.fragment,l),v=E(l),q(a.$$.fragment,l),B=E(l),q(L.$$.fragment,l),k=E(l),q(I.$$.fragment,l),K=E(l),q(A.$$.fragment,l),this.h()},h(){V(i,"href",o=he(e[1].criticalIssues[e[0]].point)),V(i,"target","_blank"),V(s,"href",r=ve(e[1].criticalIssues[e[0]].point)),V(s,"target","_blank"),x(t,"display","flex"),x(t,"justify-content","space-evenly")},m(l,$){C(l,t,$),F(t,i),F(i,n),F(t,c),F(t,s),F(s,f),C(l,y,$),z(m,l,$),C(l,v,$),z(a,l,$),C(l,B,$),z(L,l,$),C(l,k,$),z(I,l,$),C(l,K,$),z(A,l,$),S=!0},p(l,[$]){(!S||$&3&&o!==(o=he(l[1].criticalIssues[l[0]].point)))&&V(i,"href",o),(!S||$&3&&r!==(r=ve(l[1].criticalIssues[l[0]].point)))&&V(s,"href",r);const ne={};!u&&$&3&&(u=!0,ne.value=l[1].criticalIssues[l[0]].criticalIssue,Z(()=>u=!1)),m.$set(ne);const ie={};!h&&$&3&&(h=!0,ie.value=l[1].criticalIssues[l[0]].stage,Z(()=>h=!1)),a.$set(ie);const ue={};!d&&$&3&&(d=!0,ue.value=l[1].criticalIssues[l[0]].locationName,Z(()=>d=!1)),L.$set(ue);const ce={};!G&&$&3&&(G=!0,ce.value=l[1].criticalIssues[l[0]].resolved,Z(()=>G=!1)),I.$set(ce);const _e={};!J&&$&3&&(J=!0,_e.value=l[1].criticalIssues[l[0]].notes,Z(()=>J=!1)),A.$set(_e)},i(l){S||(w(m.$$.fragment,l),w(a.$$.fragment,l),w(L.$$.fragment,l),w(I.$$.fragment,l),w(A.$$.fragment,l),S=!0)},o(l){T(m.$$.fragment,l),T(a.$$.fragment,l),T(L.$$.fragment,l),T(I.$$.fragment,l),T(A.$$.fragment,l),S=!1},d(l){l&&(b(t),b(y),b(v),b(B),b(k),b(K)),j(m,l),j(a,l),j(L,l),j(I,l),j(A,l)}}}function yt(e,t,i){let n;Se(e,O,u=>i(1,n=u));let{idx:o}=t,c=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]];function s(u){e.$$.not_equal(n.criticalIssues[o].criticalIssue,u)&&(n.criticalIssues[o].criticalIssue=u,O.set(n))}function f(u){e.$$.not_equal(n.criticalIssues[o].stage,u)&&(n.criticalIssues[o].stage=u,O.set(n))}function r(u){e.$$.not_equal(n.criticalIssues[o].locationName,u)&&(n.criticalIssues[o].locationName=u,O.set(n))}function y(u){e.$$.not_equal(n.criticalIssues[o].resolved,u)&&(n.criticalIssues[o].resolved=u,O.set(n))}function m(u){e.$$.not_equal(n.criticalIssues[o].notes,u)&&(n.criticalIssues[o].notes=u,O.set(n))}return e.$$set=u=>{"idx"in u&&i(0,o=u.idx)},[o,n,c,s,f,r,y,m]}class kt extends ye{constructor(t){super(),ke(this,t,yt,$t,be,{idx:0})}}function Ct(e){let t,i,n,o,c,s,f,r,y,m,u,v,a,h,B,L,d,k,I,G,K,A,J,S;function re(l){e[3](l)}let ee={label:"Policy Conflict",emptyOption:!0,choices:e[2]};e[1].policyConflictLog[e[0]].conflict!==void 0&&(ee.value=e[1].policyConflictLog[e[0]].conflict),m=new de({props:ee}),Y.push(()=>Q(m,"value",re));function X(l){e[4](l)}let p={label:"Stage",emptyOption:!0,choices:He(["Existing","Design"])};e[1].policyConflictLog[e[0]].stage!==void 0&&(p.value=e[1].policyConflictLog[e[0]].stage),a=new de({props:p}),Y.push(()=>Q(a,"value",X));function te(l){e[5](l)}let P={label:"Location Name"};e[1].policyConflictLog[e[0]].locationName!==void 0&&(P.value=e[1].policyConflictLog[e[0]].locationName),L=new We({props:P}),Y.push(()=>Q(L,"value",te));function _(l){e[6](l)}let g={label:"Resolved by Design"};e[1].policyConflictLog[e[0]].resolved!==void 0&&(g.value=e[1].policyConflictLog[e[0]].resolved),I=new Ue({props:g}),Y.push(()=>Q(I,"value",_));function N(l){e[7](l)}let H={label:"Commentary & Feedback"};return e[1].policyConflictLog[e[0]].notes!==void 0&&(H.value=e[1].policyConflictLog[e[0]].notes),A=new Oe({props:H}),Y.push(()=>Q(A,"value",N)),{c(){t=W("div"),i=W("a"),n=le("Google StreetView"),c=D(),s=W("a"),f=le("Bing Streetside"),y=D(),M(m.$$.fragment),v=D(),M(a.$$.fragment),B=D(),M(L.$$.fragment),k=D(),M(I.$$.fragment),K=D(),M(A.$$.fragment),this.h()},l(l){t=R(l,"DIV",{style:!0});var $=U(t);i=R($,"A",{href:!0,target:!0});var ne=U(i);n=oe(ne,"Google StreetView"),ne.forEach(b),c=E($),s=R($,"A",{href:!0,target:!0});var ie=U(s);f=oe(ie,"Bing Streetside"),ie.forEach(b),$.forEach(b),y=E(l),q(m.$$.fragment,l),v=E(l),q(a.$$.fragment,l),B=E(l),q(L.$$.fragment,l),k=E(l),q(I.$$.fragment,l),K=E(l),q(A.$$.fragment,l),this.h()},h(){V(i,"href",o=he(e[1].policyConflictLog[e[0]].point)),V(i,"target","_blank"),V(s,"href",r=ve(e[1].policyConflictLog[e[0]].point)),V(s,"target","_blank"),x(t,"display","flex"),x(t,"justify-content","space-evenly")},m(l,$){C(l,t,$),F(t,i),F(i,n),F(t,c),F(t,s),F(s,f),C(l,y,$),z(m,l,$),C(l,v,$),z(a,l,$),C(l,B,$),z(L,l,$),C(l,k,$),z(I,l,$),C(l,K,$),z(A,l,$),S=!0},p(l,[$]){(!S||$&3&&o!==(o=he(l[1].policyConflictLog[l[0]].point)))&&V(i,"href",o),(!S||$&3&&r!==(r=ve(l[1].policyConflictLog[l[0]].point)))&&V(s,"href",r);const ne={};!u&&$&3&&(u=!0,ne.value=l[1].policyConflictLog[l[0]].conflict,Z(()=>u=!1)),m.$set(ne);const ie={};!h&&$&3&&(h=!0,ie.value=l[1].policyConflictLog[l[0]].stage,Z(()=>h=!1)),a.$set(ie);const ue={};!d&&$&3&&(d=!0,ue.value=l[1].policyConflictLog[l[0]].locationName,Z(()=>d=!1)),L.$set(ue);const ce={};!G&&$&3&&(G=!0,ce.value=l[1].policyConflictLog[l[0]].resolved,Z(()=>G=!1)),I.$set(ce);const _e={};!J&&$&3&&(J=!0,_e.value=l[1].policyConflictLog[l[0]].notes,Z(()=>J=!1)),A.$set(_e)},i(l){S||(w(m.$$.fragment,l),w(a.$$.fragment,l),w(L.$$.fragment,l),w(I.$$.fragment,l),w(A.$$.fragment,l),S=!0)},o(l){T(m.$$.fragment,l),T(a.$$.fragment,l),T(L.$$.fragment,l),T(I.$$.fragment,l),T(A.$$.fragment,l),S=!1},d(l){l&&(b(t),b(y),b(v),b(B),b(k),b(K)),j(m,l),j(a,l),j(L,l),j(I,l),j(A,l)}}}function wt(e,t,i){let n;Se(e,O,u=>i(1,n=u));let{idx:o}=t,c=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]];function s(u){e.$$.not_equal(n.policyConflictLog[o].conflict,u)&&(n.policyConflictLog[o].conflict=u,O.set(n))}function f(u){e.$$.not_equal(n.policyConflictLog[o].stage,u)&&(n.policyConflictLog[o].stage=u,O.set(n))}function r(u){e.$$.not_equal(n.policyConflictLog[o].locationName,u)&&(n.policyConflictLog[o].locationName=u,O.set(n))}function y(u){e.$$.not_equal(n.policyConflictLog[o].resolved,u)&&(n.policyConflictLog[o].resolved=u,O.set(n))}function m(u){e.$$.not_equal(n.policyConflictLog[o].notes,u)&&(n.policyConflictLog[o].notes=u,O.set(n))}return e.$$set=u=>{"idx"in u&&i(0,o=u.idx)},[o,n,c,s,f,r,y,m]}class Lt extends ye{constructor(t){super(),ke(this,t,wt,Ct,be,{idx:0})}}const{window:It}=it;function Ae(e,t,i){const n=e.slice();return n[29]=t[i],n[30]=t,n[31]=i,n}function De(e,t,i){const n=e.slice();return n[32]=t[i],n[33]=t,n[31]=i,n}function Ee(e,t,i){const n=e.slice();return n[29]=t[i],n[31]=i,n}function Ne(e,t,i){const n=e.slice();return n[32]=t[i],n[31]=i,n}function St(e){let t,i,n,o,c,s,f,r;t=new mt({props:{$$slots:{default:[Bt]},$$scope:{ctx:e}}}),t.$on("click",e[20]),n=new gt({props:{$$slots:{default:[At]},$$scope:{ctx:e}}}),n.$on("click",e[8]);const y=[Et,Dt],m=[];function u(v,a){return v[0].kind=="critical"?0:1}return c=u(e),s=m[c]=y[c](e),{c(){M(t.$$.fragment),i=D(),M(n.$$.fragment),o=D(),s.c(),f=Te()},l(v){q(t.$$.fragment,v),i=E(v),q(n.$$.fragment,v),o=E(v),s.l(v),f=Te()},m(v,a){z(t,v,a),C(v,i,a),z(n,v,a),C(v,o,a),m[c].m(v,a),C(v,f,a),r=!0},p(v,a){const h={};a[1]&32&&(h.$$scope={dirty:a,ctx:v}),t.$set(h);const B={};a[1]&32&&(B.$$scope={dirty:a,ctx:v}),n.$set(B);let L=c;c=u(v),c===L?m[c].p(v,a):(ge(),T(m[L],1,1,()=>{m[L]=null}),me(),s=m[c],s?s.p(v,a):(s=m[c]=y[c](v),s.c()),w(s,1),s.m(f.parentNode,f))},i(v){r||(w(t.$$.fragment,v),w(n.$$.fragment,v),w(s),r=!0)},o(v){T(t.$$.fragment,v),T(n.$$.fragment,v),T(s),r=!1},d(v){v&&(b(i),b(o),b(f)),j(t,v),j(n,v),m[c].d(v)}}}function Tt(e){let t,i,n,o,c,s,f,r,y,m,u,v="Click the map to add a problem, or select a problem to fill out data",a,h,B="Critical Issues",L,d,k,I,G="Policy Conflicts",K,A,J;t=new pt({props:{$$slots:{default:[Nt]},$$scope:{ctx:e}}}),t.$on("click",e[11]),n=new at({}),c=new ft({});let S=e[3]&&Me(e);function re(_){e[13](_)}let ee={legend:"Create new problems",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};e[4]!==void 0&&(ee.value=e[4]),r=new ut({props:ee}),Y.push(()=>Q(r,"value",re));let X=se(e[2].criticalIssues),p=[];for(let _=0;_<X.length;_+=1)p[_]=qe(Ne(e,X,_));let te=se(e[2].policyConflictLog),P=[];for(let _=0;_<te.length;_+=1)P[_]=ze(Ee(e,te,_));return{c(){M(t.$$.fragment),i=D(),M(n.$$.fragment),o=D(),M(c.$$.fragment),s=D(),S&&S.c(),f=D(),M(r.$$.fragment),m=D(),u=W("p"),u.textContent=v,a=D(),h=W("h3"),h.textContent=B,L=D(),d=W("ol");for(let _=0;_<p.length;_+=1)p[_].c();k=D(),I=W("h3"),I.textContent=G,K=D(),A=W("ol");for(let _=0;_<P.length;_+=1)P[_].c()},l(_){q(t.$$.fragment,_),i=E(_),q(n.$$.fragment,_),o=E(_),q(c.$$.fragment,_),s=E(_),S&&S.l(_),f=E(_),q(r.$$.fragment,_),m=E(_),u=R(_,"P",{"data-svelte-h":!0}),Ce(u)!=="svelte-12ba5j2"&&(u.textContent=v),a=E(_),h=R(_,"H3",{"data-svelte-h":!0}),Ce(h)!=="svelte-1qhh5xr"&&(h.textContent=B),L=E(_),d=R(_,"OL",{});var g=U(d);for(let H=0;H<p.length;H+=1)p[H].l(g);g.forEach(b),k=E(_),I=R(_,"H3",{"data-svelte-h":!0}),Ce(I)!=="svelte-eyxzjx"&&(I.textContent=G),K=E(_),A=R(_,"OL",{});var N=U(A);for(let H=0;H<P.length;H+=1)P[H].l(N);N.forEach(b)},m(_,g){z(t,_,g),C(_,i,g),z(n,_,g),C(_,o,g),z(c,_,g),C(_,s,g),S&&S.m(_,g),C(_,f,g),z(r,_,g),C(_,m,g),C(_,u,g),C(_,a,g),C(_,h,g),C(_,L,g),C(_,d,g);for(let N=0;N<p.length;N+=1)p[N]&&p[N].m(d,null);C(_,k,g),C(_,I,g),C(_,K,g),C(_,A,g);for(let N=0;N<P.length;N+=1)P[N]&&P[N].m(A,null);J=!0},p(_,g){const N={};g[1]&32&&(N.$$scope={dirty:g,ctx:_}),t.$set(N),_[3]?S?(S.p(_,g),g[0]&8&&w(S,1)):(S=Me(_),S.c(),w(S,1),S.m(f.parentNode,f)):S&&(ge(),T(S,1,1,()=>{S=null}),me());const H={};if(!y&&g[0]&16&&(y=!0,H.value=_[4],Z(()=>y=!1)),r.$set(H),g[0]&134){X=se(_[2].criticalIssues);let l;for(l=0;l<X.length;l+=1){const $=Ne(_,X,l);p[l]?p[l].p($,g):(p[l]=qe($),p[l].c(),p[l].m(d,null))}for(;l<p.length;l+=1)p[l].d(1);p.length=X.length}if(g[0]&134){te=se(_[2].policyConflictLog);let l;for(l=0;l<te.length;l+=1){const $=Ee(_,te,l);P[l]?P[l].p($,g):(P[l]=ze($),P[l].c(),P[l].m(A,null))}for(;l<P.length;l+=1)P[l].d(1);P.length=te.length}},i(_){J||(w(t.$$.fragment,_),w(n.$$.fragment,_),w(c.$$.fragment,_),w(S),w(r.$$.fragment,_),J=!0)},o(_){T(t.$$.fragment,_),T(n.$$.fragment,_),T(c.$$.fragment,_),T(S),T(r.$$.fragment,_),J=!1},d(_){_&&(b(i),b(o),b(s),b(f),b(m),b(u),b(a),b(h),b(L),b(d),b(k),b(I),b(K),b(A)),j(t,_),j(n,_),j(c,_),S&&S.d(_),j(r,_),pe(p,_),pe(P,_)}}}function Bt(e){let t;return{c(){t=le("Save")},l(i){t=oe(i,"Save")},m(i,n){C(i,t,n)},d(i){i&&b(t)}}}function At(e){let t;return{c(){t=le("Delete")},l(i){t=oe(i,"Delete")},m(i,n){C(i,t,n)},d(i){i&&b(t)}}}function Dt(e){let t,i;return t=new Lt({props:{idx:e[0].idx}}),{c(){M(t.$$.fragment)},l(n){q(t.$$.fragment,n)},m(n,o){z(t,n,o),i=!0},p(n,o){const c={};o[0]&1&&(c.idx=n[0].idx),t.$set(c)},i(n){i||(w(t.$$.fragment,n),i=!0)},o(n){T(t.$$.fragment,n),i=!1},d(n){j(t,n)}}}function Et(e){let t,i;return t=new kt({props:{idx:e[0].idx}}),{c(){M(t.$$.fragment)},l(n){q(t.$$.fragment,n)},m(n,o){z(t,n,o),i=!0},p(n,o){const c={};o[0]&1&&(c.idx=n[0].idx),t.$set(c)},i(n){i||(w(t.$$.fragment,n),i=!0)},o(n){T(t.$$.fragment,n),i=!1},d(n){j(t,n)}}}function Nt(e){let t;return{c(){t=le("Zoom to fit")},l(i){t=oe(i,"Zoom to fit")},m(i,n){C(i,t,n)},d(i){i&&b(t)}}}function Me(e){let t,i,n;function o(s){e[12](s)}let c={map:e[3]};return e[5]!==void 0&&(c.enabled=e[5]),t=new ct({props:c}),Y.push(()=>Q(t,"enabled",o)),{c(){M(t.$$.fragment)},l(s){q(t.$$.fragment,s)},m(s,f){z(t,s,f),n=!0},p(s,f){const r={};f[0]&8&&(r.map=s[3]),!i&&f[0]&32&&(i=!0,r.enabled=s[5],Z(()=>i=!1)),t.$set(r)},i(s){n||(w(t.$$.fragment,s),n=!0)},o(s){T(t.$$.fragment,s),n=!1},d(s){j(t,s)}}}function qe(e){let t,i,n=Ve(e[32])+"",o,c,s,f;function r(){return e[14](e[31])}function y(){return e[15](e[31])}return{c(){t=W("li"),i=W("a"),o=le(n),c=D(),this.h()},l(m){t=R(m,"LI",{});var u=U(t);i=R(u,"A",{href:!0});var v=U(i);o=oe(v,n),v.forEach(b),c=E(u),u.forEach(b),this.h()},h(){V(i,"href","#")},m(m,u){C(m,t,u),F(t,i),F(i,o),F(t,c),s||(f=[ae(i,"click",r),ae(i,"mouseenter",y),ae(i,"mouseleave",e[16])],s=!0)},p(m,u){e=m,u[0]&4&&n!==(n=Ve(e[32])+"")&&$e(o,n)},d(m){m&&b(t),s=!1,Ge(f)}}}function ze(e){let t,i,n=Fe(e[29])+"",o,c,s,f;function r(){return e[17](e[31])}function y(){return e[18](e[31])}return{c(){t=W("li"),i=W("a"),o=le(n),c=D(),this.h()},l(m){t=R(m,"LI",{});var u=U(t);i=R(u,"A",{href:!0});var v=U(i);o=oe(v,n),v.forEach(b),c=E(u),u.forEach(b),this.h()},h(){V(i,"href","#")},m(m,u){C(m,t,u),F(t,i),F(i,o),F(t,c),s||(f=[ae(i,"click",r),ae(i,"mouseenter",y),ae(i,"mouseleave",e[19])],s=!0)},p(m,u){e=m,u[0]&4&&n!==(n=Fe(e[29])+"")&&$e(o,n)},d(m){m&&b(t),s=!1,Ge(f)}}}function Mt(e){let t,i,n,o=e[32].criticalIssue+"",c;return{c(){t=we("svg"),i=we("polygon"),n=we("text"),c=le(o),this.h()},l(s){t=Le(s,"svg",{width:!0,height:!0,xmlns:!0});var f=U(t);i=Le(f,"polygon",{points:!0,fill:!0,class:!0}),U(i).forEach(b),n=Le(f,"text",{x:!0,y:!0});var r=U(n);c=oe(r,o),r.forEach(b),f.forEach(b),this.h()},h(){V(i,"points","20,0 0,40 40,40"),V(i,"fill",ot.critical.background),V(i,"class","svelte-996go8"),V(n,"x","13"),V(n,"y","30"),x(n,"fill","white"),V(t,"width","40"),V(t,"height","40"),V(t,"xmlns","http://www.w3.org/2000/svg")},m(s,f){C(s,t,f),F(t,i),F(t,n),F(n,c)},p(s,f){f[0]&4&&o!==(o=s[32].criticalIssue+"")&&$e(c,o)},d(s){s&&b(t)}}}function je(e){let t,i,n;function o(r){e[21](r,e[32])}function c(){return e[22](e[31])}function s(){return e[23](e[31])}let f={draggable:!0,$$slots:{default:[Mt]},$$scope:{ctx:e}};return e[32].point!==void 0&&(f.lngLat=e[32].point),t=new Re({props:f}),Y.push(()=>Q(t,"lngLat",o)),t.$on("click",c),t.$on("dragend",s),{c(){M(t.$$.fragment)},l(r){q(t.$$.fragment,r)},m(r,y){z(t,r,y),n=!0},p(r,y){e=r;const m={};y[0]&4|y[1]&32&&(m.$$scope={dirty:y,ctx:e}),!i&&y[0]&4&&(i=!0,m.lngLat=e[32].point,Z(()=>i=!1)),t.$set(m)},i(r){n||(w(t.$$.fragment,r),n=!0)},o(r){T(t.$$.fragment,r),n=!1},d(r){j(t,r)}}}function qt(e){let t,i=e[29].conflict+"",n;return{c(){t=W("span"),n=le(i),this.h()},l(o){t=R(o,"SPAN",{class:!0});var c=U(t);n=oe(c,i),c.forEach(b),this.h()},h(){V(t,"class","dot svelte-996go8"),x(t,"background",rt)},m(o,c){C(o,t,c),F(t,n)},p(o,c){c[0]&4&&i!==(i=o[29].conflict+"")&&$e(n,i)},d(o){o&&b(t)}}}function Pe(e){let t,i,n;function o(r){e[24](r,e[29])}function c(){return e[25](e[31])}function s(){return e[26](e[31])}let f={draggable:!0,$$slots:{default:[qt]},$$scope:{ctx:e}};return e[29].point!==void 0&&(f.lngLat=e[29].point),t=new Re({props:f}),Y.push(()=>Q(t,"lngLat",o)),t.$on("click",c),t.$on("dragend",s),{c(){M(t.$$.fragment)},l(r){q(t.$$.fragment,r)},m(r,y){z(t,r,y),n=!0},p(r,y){e=r;const m={};y[0]&4|y[1]&32&&(m.$$scope={dirty:y,ctx:e}),!i&&y[0]&4&&(i=!0,m.lngLat=e[29].point,Z(()=>i=!1)),t.$set(m)},i(r){n||(w(t.$$.fragment,r),n=!0)},o(r){T(t.$$.fragment,r),n=!1},d(r){j(t,r)}}}function zt(e){let t,i;return t=new bt({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){M(t.$$.fragment)},l(n){q(t.$$.fragment,n)},m(n,o){z(t,n,o),i=!0},p:xe,i(n){i||(w(t.$$.fragment,n),i=!0)},o(n){T(t.$$.fragment,n),i=!1},d(n){j(t,n)}}}function jt(e){let t,i,n,o,c,s,f=se(e[2].criticalIssues),r=[];for(let a=0;a<f.length;a+=1)r[a]=je(De(e,f,a));const y=a=>T(r[a],1,1,()=>{r[a]=null});let m=se(e[2].policyConflictLog),u=[];for(let a=0;a<m.length;a+=1)u[a]=Pe(Ae(e,m,a));const v=a=>T(u[a],1,1,()=>{u[a]=null});return n=new lt({props:{data:e[6],$$slots:{default:[zt]},$$scope:{ctx:e}}}),c=new _t({props:{map:e[3]}}),{c(){for(let a=0;a<r.length;a+=1)r[a].c();t=D();for(let a=0;a<u.length;a+=1)u[a].c();i=D(),M(n.$$.fragment),o=D(),M(c.$$.fragment)},l(a){for(let h=0;h<r.length;h+=1)r[h].l(a);t=E(a);for(let h=0;h<u.length;h+=1)u[h].l(a);i=E(a),q(n.$$.fragment,a),o=E(a),q(c.$$.fragment,a)},m(a,h){for(let B=0;B<r.length;B+=1)r[B]&&r[B].m(a,h);C(a,t,h);for(let B=0;B<u.length;B+=1)u[B]&&u[B].m(a,h);C(a,i,h),z(n,a,h),C(a,o,h),z(c,a,h),s=!0},p(a,h){if(h[0]&132){f=se(a[2].criticalIssues);let d;for(d=0;d<f.length;d+=1){const k=De(a,f,d);r[d]?(r[d].p(k,h),w(r[d],1)):(r[d]=je(k),r[d].c(),w(r[d],1),r[d].m(t.parentNode,t))}for(ge(),d=f.length;d<r.length;d+=1)y(d);me()}if(h[0]&132){m=se(a[2].policyConflictLog);let d;for(d=0;d<m.length;d+=1){const k=Ae(a,m,d);u[d]?(u[d].p(k,h),w(u[d],1)):(u[d]=Pe(k),u[d].c(),w(u[d],1),u[d].m(i.parentNode,i))}for(ge(),d=m.length;d<u.length;d+=1)v(d);me()}const B={};h[0]&64&&(B.data=a[6]),h[1]&32&&(B.$$scope={dirty:h,ctx:a}),n.$set(B);const L={};h[0]&8&&(L.map=a[3]),c.$set(L)},i(a){if(!s){for(let h=0;h<f.length;h+=1)w(r[h]);for(let h=0;h<m.length;h+=1)w(u[h]);w(n.$$.fragment,a),w(c.$$.fragment,a),s=!0}},o(a){r=r.filter(Boolean);for(let h=0;h<r.length;h+=1)T(r[h]);u=u.filter(Boolean);for(let h=0;h<u.length;h+=1)T(u[h]);T(n.$$.fragment,a),T(c.$$.fragment,a),s=!1},d(a){a&&(b(t),b(i),b(o)),pe(r,a),pe(u,a),j(n,a),j(c,a)}}}function Pt(e){let t,i,n,o,c,s,f,r,y,m,u;const v=[Tt,St],a=[];function h(d,k){return d[0]==null?0:1}n=h(e),o=a[n]=v[n](e);function B(d){e[27](d)}let L={$$slots:{default:[jt]},$$scope:{ctx:e}};return e[3]!==void 0&&(L.map=e[3]),f=new nt({props:L}),Y.push(()=>Q(f,"map",B)),{c(){t=W("div"),i=W("div"),o.c(),c=D(),s=W("div"),M(f.$$.fragment),this.h()},l(d){t=R(d,"DIV",{style:!0});var k=U(t);i=R(k,"DIV",{style:!0});var I=U(i);o.l(I),I.forEach(b),c=E(k),s=R(k,"DIV",{style:!0});var G=U(s);q(f.$$.fragment,G),G.forEach(b),k.forEach(b),this.h()},h(){x(i,"width","30%"),x(i,"overflow-y","scroll"),x(i,"padding","10px"),x(s,"position","relative"),x(s,"width","70%"),x(t,"display","flex"),x(t,"height","80vh")},m(d,k){C(d,t,k),F(t,i),a[n].m(i,null),F(t,c),F(t,s),z(f,s,null),y=!0,m||(u=ae(It,"keydown",e[10]),m=!0)},p(d,k){let I=n;n=h(d),n===I?a[n].p(d,k):(ge(),T(a[I],1,1,()=>{a[I]=null}),me(),o=a[n],o?o.p(d,k):(o=a[n]=v[n](d),o.c()),w(o,1),o.m(i,null));const G={};k[0]&76|k[1]&32&&(G.$$scope={dirty:k,ctx:d}),!r&&k[0]&8&&(r=!0,G.map=d[3],Z(()=>r=!1)),f.$set(G)},i(d){y||(w(o),w(f.$$.fragment,d),y=!0)},o(d){T(o),T(f.$$.fragment,d),y=!1},d(d){d&&b(t),a[n].d(),j(f),m=!1,u()}}}function Vt(e,t,i){let n={type:"FeatureCollection",features:[]},o=t??i;if(o!=null){let c=o.kind=="critical"?e.criticalIssues:e.policyConflictLog;n.features.push(Ie(c[o.idx].point))}return n}function Ie(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:e}}}function Ve(e){return`${e.criticalIssue||"Unknown critical"}: ${e.locationName||"???"}`}function Fe(e){return`${e.conflict||"Unknown conflict"}: ${e.locationName||"???"}`}function Ft(e,t,i){let n,o;Se(e,O,g=>i(2,o=g));let c,s="critical",f=null,r=null,y=!1;function m(g){i(0,f=g),i(1,r=null)}function u(g){if(!y){if(f!=null){i(0,f=null);return}s=="critical"?(Be(O,o.criticalIssues=[...o.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:g.lngLat.toArray(),locationName:"",resolved:"",notes:""}],o),i(0,f={kind:"critical",idx:o.criticalIssues.length-1})):(Be(O,o.policyConflictLog=[...o.policyConflictLog,{id:"TODO",conflict:"",stage:"",point:g.lngLat.toArray(),locationName:"",resolved:"",notes:""}],o),i(0,f={kind:"conflict",idx:o.policyConflictLog.length-1})),i(1,r=null)}}Qe(()=>{c.on("click",u),a()}),Xe(()=>{c.off("click",u)});function v(){window.confirm("Delete this entry?")&&(f.kind=="critical"?(o.criticalIssues.splice(f.idx,1),O.set(o)):(o.policyConflictLog.splice(f.idx,1),O.set(o)),i(0,f=null))}function a(g){let N={type:"FeatureCollection",features:[...o.criticalIssues.map(H=>Ie(H.point)),...o.policyConflictLog.map(H=>Ie(H.point))]};N.features.length>0&&c.fitBounds(st(N),{padding:20,animate:!0})}function h(g){f!=null&&g.key=="Escape"?(g.stopPropagation(),i(0,f=null)):f!=null&&g.key=="Delete"&&v()}const B=()=>a();function L(g){y=g,i(5,y)}function d(g){s=g,i(4,s)}const k=g=>m({kind:"critical",idx:g}),I=g=>i(1,r={kind:"critical",idx:g}),G=()=>i(1,r=null),K=g=>m({kind:"conflict",idx:g}),A=g=>i(1,r={kind:"conflict",idx:g}),J=()=>i(1,r=null),S=()=>i(0,f=null);function re(g,N){e.$$.not_equal(N.point,g)&&(N.point=g,O.set(o))}const ee=g=>m({kind:"critical",idx:g}),X=g=>m({kind:"critical",idx:g});function p(g,N){e.$$.not_equal(N.point,g)&&(N.point=g,O.set(o))}const te=g=>m({kind:"conflict",idx:g}),P=g=>m({kind:"conflict",idx:g});function _(g){c=g,i(3,c)}return e.$$.update=()=>{e.$$.dirty[0]&7&&i(6,n=Vt(o,f,r))},[f,r,o,c,s,y,n,m,v,a,h,B,L,d,k,I,G,K,A,J,S,re,ee,X,p,te,P,_]}class tn extends ye{constructor(t){super(),ke(this,t,Ft,Pt,be,{},null,[-1,-1])}}export{tn as component};
