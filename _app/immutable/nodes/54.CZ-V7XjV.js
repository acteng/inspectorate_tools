import{s as $e,w as Q,x as Y,l as mt,u as ct,r as _t,v as gt,D as de,k as ye,R as pt,T as je,a as B,g as U,i as C,f as v,G as Ce,n as he,e as te,t as K,c as ne,b as ie,d as R,p as Ie,q as W,h as ee,j as _e,z as dt,W as $t,E as me,m as Be}from"../chunks/scheduler.ytQcc2rf.js";import{S as Le,i as Me,e as x,c as N,a as A,m as z,t as b,b as w,d as P,g as oe,f as le}from"../chunks/index.D9yYtTfk.js";import{e as ue}from"../chunks/each.2RvRdhFj.js";import{C as ze,B as ht}from"../chunks/ClickableCard.CEal2XW6.js";import{D as ot}from"../chunks/DefaultButton.DeS4Ykkw.js";import{S as ke}from"../chunks/SecondaryButton.Dq9MsXNi.js";/* empty css                                                               */import{T as Pe}from"../chunks/TextInput.DxUXxcOo.js";import{W as lt}from"../chunks/WarningButton.C6jnTAfb.js";import{s as X}from"../chunks/data.D_34g9VG.js";import{L as kt,a as bt,d as ge,t as vt,v as wt,w as Ee,M as jt,b as Ct,C as Lt,G as Ue,x as Ne,y as De,m as Mt,P as rt,l as St}from"../chunks/index.C0LFwIuq.js";import{g as Ae}from"../chunks/index.Bf1TFi-C.js";import{c as ce}from"../chunks/colors.DaC397qr.js";import{G as yt}from"../chunks/GeoreferenceLayer.CAmDbHNb.js";import{a as It,M as Se,B as Tt,G as Et,S as Nt,C as At}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DsSNZa9p.js";import{C as zt}from"../chunks/CollapsibleCard.Bf0oqccF.js";import{R as at}from"../chunks/Radio.CjybguQ-.js";import{T as it}from"../chunks/TextArea.BNsNWsw2.js";/* empty css                                                    */import"../chunks/paths.D3UEUPSK.js";import{p as Pt}from"../chunks/index.BSwm-dyn.js";import{S as qt}from"../chunks/Select.CEc0mqfX.js";function Bt(n){let e;const o=n[16].default,t=mt(o,n,n[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,r){t&&t.m(l,r),e=!0},p(l,r){t&&t.p&&(!e||r&16777216)&&ct(t,o,l,l[24],e?gt(o,l[24],r,null):_t(l[24]),null)},i(l){e||(b(t,l),e=!0)},o(l){w(t,l),e=!1},d(l){t&&t.d(l)}}}function Ut(n){let e,o,t;function l(a){n[17](a)}let r={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Bt]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.hovered=n[0]),e=new kt({props:r}),Q.push(()=>x(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){z(e,a,s),t=!0},p(a,[s]){const i={};s&2&&(i.id=a[1]),s&4&&(i.source=a[2]),s&8&&(i.sourceLayer=a[3]),s&16&&(i.beforeId=a[4]),s&32&&(i.beforeLayerType=a[5]),s&64&&(i.paint=a[6]),s&128&&(i.layout=a[7]),s&256&&(i.filter=a[8]),s&512&&(i.applyToClusters=a[9]),s&1024&&(i.minzoom=a[10]),s&2048&&(i.maxzoom=a[11]),s&4096&&(i.hoverCursor=a[12]),s&8192&&(i.manageHoverState=a[13]),s&16384&&(i.eventsIfTopMost=a[14]),s&32768&&(i.interactive=a[15]),s&16777216&&(i.$$scope={dirty:s,ctx:a}),!o&&s&1&&(o=!0,i.hovered=a[0],Y(()=>o=!1)),e.$set(i)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function Dt(n,e,o){let{$$slots:t={},$$scope:l}=e,{id:r=bt("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:i=void 0}=e,{beforeLayerType:_=void 0}=e,{paint:p=void 0}=e,{layout:$=void 0}=e,{filter:u=void 0}=e,{applyToClusters:M=void 0}=e,{minzoom:j=void 0}=e,{maxzoom:q=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:E=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:d=!0}=e;function k(S){h=S,o(0,h)}function g(S){de.call(this,n,S)}function y(S){de.call(this,n,S)}function H(S){de.call(this,n,S)}function I(S){de.call(this,n,S)}function F(S){de.call(this,n,S)}function se(S){de.call(this,n,S)}return n.$$set=S=>{"id"in S&&o(1,r=S.id),"source"in S&&o(2,a=S.source),"sourceLayer"in S&&o(3,s=S.sourceLayer),"beforeId"in S&&o(4,i=S.beforeId),"beforeLayerType"in S&&o(5,_=S.beforeLayerType),"paint"in S&&o(6,p=S.paint),"layout"in S&&o(7,$=S.layout),"filter"in S&&o(8,u=S.filter),"applyToClusters"in S&&o(9,M=S.applyToClusters),"minzoom"in S&&o(10,j=S.minzoom),"maxzoom"in S&&o(11,q=S.maxzoom),"hoverCursor"in S&&o(12,D=S.hoverCursor),"manageHoverState"in S&&o(13,E=S.manageHoverState),"hovered"in S&&o(0,h=S.hovered),"eventsIfTopMost"in S&&o(14,f=S.eventsIfTopMost),"interactive"in S&&o(15,d=S.interactive),"$$scope"in S&&o(24,l=S.$$scope)},[h,r,a,s,i,_,p,$,u,M,j,q,D,E,f,d,t,k,g,y,H,I,F,se,l]}class Ot extends Le{constructor(e){super(),Me(this,e,Dt,Ut,$e,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ft=Object.defineProperty,Ht=(n,e)=>Ft(n,"name",{value:e,configurable:!0});function st(n,e,o,t={}){const l=Ae(n),r=ge(l[0]),a=ge(l[1]),s=ge(o),i=vt(e,t.units),_=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(s)),p=r+Math.atan2(Math.sin(s)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(_)),$=Ee(p),u=Ee(_);return wt([$,u],t.properties)}Ht(st,"destination");var Oe=st,Gt=Object.defineProperty,ft=(n,e)=>Gt(n,"name",{value:e,configurable:!0});function qe(n,e,o={}){if(o.final===!0)return ut(n,e);const t=Ae(n),l=Ae(e),r=ge(t[0]),a=ge(l[0]),s=ge(t[1]),i=ge(l[1]),_=Math.sin(a-r)*Math.cos(i),p=Math.cos(s)*Math.sin(i)-Math.sin(s)*Math.cos(i)*Math.cos(a-r);return Ee(Math.atan2(_,p))}ft(qe,"bearing");function ut(n,e){let o=qe(e,n);return o=(o+180)%360,o}ft(ut,"calculateFinalBearing");var Jt=qe;function Fe(n,e,o){const t=n.slice();return t[35]=e[o],t[36]=e,t[37]=o,t}function He(n,e,o){const t=n.slice();return t[38]=e[o],t[39]=e,t[37]=o,t}function Kt(n){let e,o=on(n[37])+"",t;return{c(){e=te("span"),t=K(o),this.h()},l(l){e=ne(l,"SPAN",{class:!0});var r=ie(e);t=R(r,o),r.forEach(v),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),W(e,"color","#4472c4"),W(e,"background-color","white")},m(l,r){C(l,e,r),ee(e,t)},p:he,d(l){l&&v(e)}}}function Ge(n){let e,o,t;function l(i){n[18](i,n[38])}function r(){return n[19](n[37])}function a(){return n[20](n[37])}let s={draggable:!0,$$slots:{default:[Kt]},$$scope:{ctx:n}};return n[38].point!==void 0&&(s.lngLat=n[38].point),e=new Se({props:s}),Q.push(()=>x(e,"lngLat",l)),e.$on("dragend",r),e.$on("click",a),{c(){N(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,_){z(e,i,_),t=!0},p(i,_){n=i;const p={};_[1]&512&&(p.$$scope={dirty:_,ctx:n}),!o&&_[0]&19&&(o=!0,p.lngLat=n[38].point,Y(()=>o=!1)),e.$set(p)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){P(e,i)}}}function Rt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),ie(e).forEach(v),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),W(e,"background-color",n[7][n[35].score]),W(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},m(o,t){C(o,e,t)},p(o,t){t[0]&19&&W(e,"background-color",o[7][o[35].score]),t[0]&19&&W(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&v(e)}}}function Xt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),ie(e).forEach(v),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),W(e,"background-color",n[7][n[35].score])},m(o,t){C(o,e,t)},p(o,t){t[0]&19&&W(e,"background-color",o[7][o[35].score])},d(o){o&&v(e)}}}function Vt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),ie(e).forEach(v),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),W(e,"background-color",n[7][n[35].score]),W(e,"opacity","0%")},m(o,t){C(o,e,t)},p(o,t){t[0]&19&&W(e,"background-color",o[7][o[35].score])},d(o){o&&v(e)}}}function Je(n){let e,o,t,l,r,a,s,i,_;function p(g){n[21](g,n[35])}function $(){return n[22](n[37])}function u(){return n[23](n[37])}let M={draggable:!0,$$slots:{default:[Rt]},$$scope:{ctx:n}};n[35].point1!==void 0&&(M.lngLat=n[35].point1),e=new Se({props:M}),Q.push(()=>x(e,"lngLat",p)),e.$on("dragend",$),e.$on("click",u);function j(g){n[24](g,n[35])}function q(){return n[25](n[37])}function D(){return n[26](n[37])}let E={draggable:!0,$$slots:{default:[Xt]},$$scope:{ctx:n}};n[35].point2!==void 0&&(E.lngLat=n[35].point2),l=new Se({props:E}),Q.push(()=>x(l,"lngLat",j)),l.$on("dragend",q),l.$on("click",D);function h(g){n[27](g,n[35])}function f(){return n[28](n[37])}function d(){return n[29](n[37])}let k={draggable:!0,$$slots:{default:[Vt]},$$scope:{ctx:n}};return n[35].point3!==void 0&&(k.lngLat=n[35].point3),s=new Se({props:k}),Q.push(()=>x(s,"lngLat",h)),s.$on("dragend",f),s.$on("click",d),{c(){N(e.$$.fragment),t=B(),N(l.$$.fragment),a=B(),N(s.$$.fragment)},l(g){A(e.$$.fragment,g),t=U(g),A(l.$$.fragment,g),a=U(g),A(s.$$.fragment,g)},m(g,y){z(e,g,y),C(g,t,y),z(l,g,y),C(g,a,y),z(s,g,y),_=!0},p(g,y){n=g;const H={};y[0]&19|y[1]&512&&(H.$$scope={dirty:y,ctx:n}),!o&&y[0]&19&&(o=!0,H.lngLat=n[35].point1,Y(()=>o=!1)),e.$set(H);const I={};y[0]&19|y[1]&512&&(I.$$scope={dirty:y,ctx:n}),!r&&y[0]&19&&(r=!0,I.lngLat=n[35].point2,Y(()=>r=!1)),l.$set(I);const F={};y[0]&19|y[1]&512&&(F.$$scope={dirty:y,ctx:n}),!i&&y[0]&19&&(i=!0,F.lngLat=n[35].point3,Y(()=>i=!1)),s.$set(F)},i(g){_||(b(e.$$.fragment,g),b(l.$$.fragment,g),b(s.$$.fragment,g),_=!0)},o(g){w(e.$$.fragment,g),w(l.$$.fragment,g),w(s.$$.fragment,g),_=!1},d(g){g&&(v(t),v(a)),P(e,g),P(l,g),P(s,g)}}}function Wt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=K(e)},l(t){o=R(t,e)},m(t,l){C(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&_e(o,e)},d(t){t&&v(o)}}}function Zt(n){let e,o;return e=new rt({props:{$$slots:{default:[Wt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Qt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=K(e)},l(t){o=R(t,e)},m(t,l){C(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&_e(o,e)},d(t){t&&v(o)}}}function Yt(n){let e,o;return e=new rt({props:{$$slots:{default:[Qt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function xt(n){let e,o,t,l,r,a;return e=new Ne({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":De(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Zt]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Ne({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":De(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Yt]},$$scope:{ctx:n}}}),t.$on("click",n[9]),r=new Ot({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),N(r.$$.fragment)},l(s){A(e.$$.fragment,s),o=U(s),A(t.$$.fragment,s),l=U(s),A(r.$$.fragment,s)},m(s,i){z(e,s,i),C(s,o,i),z(t,s,i),C(s,l,i),z(r,s,i),a=!0},p(s,i){const _={};i[1]&512&&(_.$$scope={dirty:i,ctx:s}),e.$set(_);const p={};i[1]&512&&(p.$$scope={dirty:i,ctx:s}),t.$set(p)},i(s){a||(b(e.$$.fragment,s),b(t.$$.fragment,s),b(r.$$.fragment,s),a=!0)},o(s){w(e.$$.fragment,s),w(t.$$.fragment,s),w(r.$$.fragment,s),a=!1},d(s){s&&(v(o),v(l)),P(e,s),P(t,s),P(r,s)}}}function en(n){let e,o,t,l;return e=new Ne({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Mt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment)},l(r){A(e.$$.fragment,r),o=U(r),A(t.$$.fragment,r)},m(r,a){z(e,r,a),C(r,o,a),z(t,r,a),l=!0},p:he,i(r){l||(b(e.$$.fragment,r),b(t.$$.fragment,r),l=!0)},o(r){w(e.$$.fragment,r),w(t.$$.fragment,r),l=!1},d(r){r&&v(o),P(e,r),P(t,r)}}}function tn(n){let e,o,t,l,r,a,s,i,_,p,$,u;e=new It({}),e.$on("click",n[8]),t=new Lt({props:{gj:n[4].summary.networkMap,show:n[2]}});let M=ue(n[4].jat[n[0]][n[1]].arms),j=[];for(let f=0;f<M.length;f+=1)j[f]=Ge(He(n,M,f));const q=f=>w(j[f],1,1,()=>{j[f]=null});let D=ue(n[4].jat[n[0]][n[1]].movements),E=[];for(let f=0;f<D.length;f+=1)E[f]=Je(Fe(n,D,f));const h=f=>w(E[f],1,1,()=>{E[f]=null});return s=new Ue({props:{data:n[10](n[4]),$$slots:{default:[xt]},$$scope:{ctx:n}}}),_=new Ue({props:{data:n[6],$$slots:{default:[en]},$$scope:{ctx:n}}}),$=new yt({props:{map:n[5]}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B();for(let f=0;f<j.length;f+=1)j[f].c();r=B();for(let f=0;f<E.length;f+=1)E[f].c();a=B(),N(s.$$.fragment),i=B(),N(_.$$.fragment),p=B(),N($.$$.fragment)},l(f){A(e.$$.fragment,f),o=U(f),A(t.$$.fragment,f),l=U(f);for(let d=0;d<j.length;d+=1)j[d].l(f);r=U(f);for(let d=0;d<E.length;d+=1)E[d].l(f);a=U(f),A(s.$$.fragment,f),i=U(f),A(_.$$.fragment,f),p=U(f),A($.$$.fragment,f)},m(f,d){z(e,f,d),C(f,o,d),z(t,f,d),C(f,l,d);for(let k=0;k<j.length;k+=1)j[k]&&j[k].m(f,d);C(f,r,d);for(let k=0;k<E.length;k+=1)E[k]&&E[k].m(f,d);C(f,a,d),z(s,f,d),C(f,i,d),z(_,f,d),C(f,p,d),z($,f,d),u=!0},p(f,d){const k={};if(d[0]&16&&(k.gj=f[4].summary.networkMap),d[0]&4&&(k.show=f[2]),t.$set(k),d[0]&27){M=ue(f[4].jat[f[0]][f[1]].arms);let I;for(I=0;I<M.length;I+=1){const F=He(f,M,I);j[I]?(j[I].p(F,d),b(j[I],1)):(j[I]=Ge(F),j[I].c(),b(j[I],1),j[I].m(r.parentNode,r))}for(oe(),I=M.length;I<j.length;I+=1)q(I);le()}if(d[0]&155){D=ue(f[4].jat[f[0]][f[1]].movements);let I;for(I=0;I<D.length;I+=1){const F=Fe(f,D,I);E[I]?(E[I].p(F,d),b(E[I],1)):(E[I]=Je(F),E[I].c(),b(E[I],1),E[I].m(a.parentNode,a))}for(oe(),I=D.length;I<E.length;I+=1)h(I);le()}const g={};d[0]&16&&(g.data=f[10](f[4])),d[1]&512&&(g.$$scope={dirty:d,ctx:f}),s.$set(g);const y={};d[0]&64&&(y.data=f[6]),d[1]&512&&(y.$$scope={dirty:d,ctx:f}),_.$set(y);const H={};d[0]&32&&(H.map=f[5]),$.$set(H)},i(f){if(!u){b(e.$$.fragment,f),b(t.$$.fragment,f);for(let d=0;d<M.length;d+=1)b(j[d]);for(let d=0;d<D.length;d+=1)b(E[d]);b(s.$$.fragment,f),b(_.$$.fragment,f),b($.$$.fragment,f),u=!0}},o(f){w(e.$$.fragment,f),w(t.$$.fragment,f),j=j.filter(Boolean);for(let d=0;d<j.length;d+=1)w(j[d]);E=E.filter(Boolean);for(let d=0;d<E.length;d+=1)w(E[d]);w(s.$$.fragment,f),w(_.$$.fragment,f),w($.$$.fragment,f),u=!1},d(f){f&&(v(o),v(l),v(r),v(a),v(i),v(p)),P(e,f),P(t,f),Ce(j,f),Ce(E,f),P(s,f),P(_,f),P($,f)}}}function nn(n){let e,o,t;function l(a){n[30](a)}let r={$$slots:{default:[tn]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.map=n[5]),e=new jt({props:r}),Q.push(()=>x(e,"map",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){z(e,a,s),t=!0},p(a,s){const i={};s[0]&127|s[1]&512&&(i.$$scope={dirty:s,ctx:a}),!o&&s[0]&32&&(o=!0,i.map=a[5],Y(()=>o=!1)),e.$set(i)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function Ke(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function on(n){return String.fromCharCode(n+65)}function ln(n,e,o){let t,l;ye(n,X,m=>o(4,l=m));let{junctionIdx:r}=e,{stage:a}=e,{newKind:s}=e,{editing:i}=e,{hoveringSidebar:_}=e,{streetviewOn:p}=e,{showContext:$}=e,{select:u}=e,{stopEditing:M}=e,j,q={0:ce.red.background,1:ce.amber.background,2:ce.green.background,X:ce.critical.background};function D(m,T,c){let L={type:"FeatureCollection",features:[]},Z=T??c;return Z!=null&&(Z.kind=="arm"?L.features.push(Ke(m.jat[r][a].arms[Z.idx],Z.idx)):L.features.push(d(m.jat[r][a].movements[Z.idx],Z.idx))),L}async function E(m){if(!p){for(let T of j.queryRenderedFeatures(m.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i!=null){await M();return}s=="arm"?(je(X,l.jat[r][a].arms=[...l.jat[r][a].arms,{point:m.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[r][a].arms.length-1})):(je(X,l.jat[r][a].movements=[...l.jat[r][a].movements,{point1:m.detail.lngLat.toArray(),point2:Oe(m.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Oe(m.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[r][a].movements.length-1}))}}async function h(m){await u({kind:"movement",idx:m.detail.features[0].id})}pt(()=>{g(!1)});function f(m){let T={type:"FeatureCollection",features:m.jat[r][a].movements.map((c,L)=>d(c,L))};for(let c of m.jat[r][a].movements)if(T.features.push(k(c,T.features.length)),c.kind=="walking & wheeling"){let L={...c,point1:c.point3,point3:c.point1};T.features.push(k(L,T.features.length))}return T}function d(m,T){return{type:"Feature",id:T,properties:{name:m.name,kind:m.kind,color:q[m.score]},geometry:{type:"LineString",coordinates:[m.point1,m.point2,m.point3]}}}function k(m,T){return{type:"Feature",id:T,properties:{kind:m.kind,color:q[m.score],angle:Jt(m.point2,m.point3)},geometry:{type:"Point",coordinates:m.point3}}}function g(m){let T=f(l);for(let c of l.jat[r][a].arms)T.features.push(Ke(c,T.features.length));for(let c of l.summary.networkMap.features)T.features.push(c);T.features.length>0&&j.fitBounds(Ct(T),{padding:20,animate:m})}function y(){return j}function H(m,T){n.$$.not_equal(T.point,m)&&(T.point=m,X.set(l))}const I=m=>u({kind:"arm",idx:m}),F=m=>u({kind:"arm",idx:m});function se(m,T){n.$$.not_equal(T.point1,m)&&(T.point1=m,X.set(l))}const S=m=>u({kind:"movement",idx:m}),be=m=>u({kind:"movement",idx:m});function pe(m,T){n.$$.not_equal(T.point2,m)&&(T.point2=m,X.set(l))}const re=m=>u({kind:"movement",idx:m}),G=m=>u({kind:"movement",idx:m});function ve(m,T){n.$$.not_equal(T.point3,m)&&(T.point3=m,X.set(l))}const V=m=>u({kind:"movement",idx:m}),ae=m=>u({kind:"movement",idx:m});function J(m){j=m,o(5,j)}return n.$$set=m=>{"junctionIdx"in m&&o(0,r=m.junctionIdx),"stage"in m&&o(1,a=m.stage),"newKind"in m&&o(11,s=m.newKind),"editing"in m&&o(12,i=m.editing),"hoveringSidebar"in m&&o(13,_=m.hoveringSidebar),"streetviewOn"in m&&o(14,p=m.streetviewOn),"showContext"in m&&o(2,$=m.showContext),"select"in m&&o(3,u=m.select),"stopEditing"in m&&o(15,M=m.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&12304&&o(6,t=D(l,i,_))},[r,a,$,u,l,j,t,q,E,h,f,s,i,_,p,M,g,y,H,I,F,se,S,be,pe,re,G,ve,V,ae,J]}class rn extends Le{constructor(e){super(),Me(this,e,ln,nn,$e,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function an(n){let e,o,t,l,r,a,s,i,_,p,$,u;function M(k){n[5](k)}let j={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(j.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Pe({props:j}),Q.push(()=>x(e,"value",M));function q(k){n[6](k)}let D={legend:"Movement",choices:Pt(["cycling","walking & wheeling"]),inlineSmall:!0};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(D.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new at({props:D}),Q.push(()=>x(l,"value",q));function E(k){n[7](k)}let h={label:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(h.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new qt({props:h}),Q.push(()=>x(s,"value",E));function f(k){n[8](k)}let d={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(d.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),p=new it({props:d}),Q.push(()=>x(p,"value",f)),{c(){N(e.$$.fragment),t=B(),N(l.$$.fragment),a=B(),N(s.$$.fragment),_=B(),N(p.$$.fragment)},l(k){A(e.$$.fragment,k),t=U(k),A(l.$$.fragment,k),a=U(k),A(s.$$.fragment,k),_=U(k),A(p.$$.fragment,k)},m(k,g){z(e,k,g),C(k,t,g),z(l,k,g),C(k,a,g),z(s,k,g),C(k,_,g),z(p,k,g),u=!0},p(k,[g]){const y={};!o&&g&15&&(o=!0,y.value=k[3].jat[k[0]][k[1]].movements[k[2]].name,Y(()=>o=!1)),e.$set(y);const H={};!r&&g&15&&(r=!0,H.value=k[3].jat[k[0]][k[1]].movements[k[2]].kind,Y(()=>r=!1)),l.$set(H);const I={};!i&&g&15&&(i=!0,I.value=k[3].jat[k[0]][k[1]].movements[k[2]].score,Y(()=>i=!1)),s.$set(I);const F={};!$&&g&15&&($=!0,F.value=k[3].jat[k[0]][k[1]].movements[k[2]].notes,Y(()=>$=!1)),p.$set(F)},i(k){u||(b(e.$$.fragment,k),b(l.$$.fragment,k),b(s.$$.fragment,k),b(p.$$.fragment,k),u=!0)},o(k){w(e.$$.fragment,k),w(l.$$.fragment,k),w(s.$$.fragment,k),w(p.$$.fragment,k),u=!1},d(k){k&&(v(t),v(a),v(_)),P(e,k),P(l,k),P(s,k),P(p,k)}}}function sn(n,e,o){let t;ye(n,X,u=>o(3,t=u));let{junctionIdx:l}=e,{stage:r}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function i(u){n.$$.not_equal(t.jat[l][r].movements[a].name,u)&&(t.jat[l][r].movements[a].name=u,X.set(t))}function _(u){n.$$.not_equal(t.jat[l][r].movements[a].kind,u)&&(t.jat[l][r].movements[a].kind=u,X.set(t))}function p(u){n.$$.not_equal(t.jat[l][r].movements[a].score,u)&&(t.jat[l][r].movements[a].score=u,X.set(t))}function $(u){n.$$.not_equal(t.jat[l][r].movements[a].notes,u)&&(t.jat[l][r].movements[a].notes=u,X.set(t))}return n.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,r=u.stage),"idx"in u&&o(2,a=u.idx)},[l,r,a,t,s,i,_,p,$]}class fn extends Le{constructor(e){super(),Me(this,e,sn,an,$e,{junctionIdx:0,stage:1,idx:2})}}const{window:un}=St;function Re(n,e,o){const t=n.slice();t[34]=e[o],t[37]=o;const l=t[17][t[34].score];return t[35]=l,t}function Xe(n,e,o){const t=n.slice();return t[38]=e[o],t[37]=o,t}function mn(n){let e,o,t,l,r,a,s,i;e=new ot({props:{$$slots:{default:[_n]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new lt({props:{$$slots:{default:[gn]},$$scope:{ctx:n}}}),t.$on("click",n[13]);const _=[dn,pn],p=[];function $(u,M){return u[3].kind=="movement"?0:1}return r=$(n),a=p[r]=_[r](n),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),a.c(),s=me()},l(u){A(e.$$.fragment,u),o=U(u),A(t.$$.fragment,u),l=U(u),a.l(u),s=me()},m(u,M){z(e,u,M),C(u,o,M),z(t,u,M),C(u,l,M),p[r].m(u,M),C(u,s,M),i=!0},p(u,M){const j={};M[1]&512&&(j.$$scope={dirty:M,ctx:u}),e.$set(j);const q={};M[1]&512&&(q.$$scope={dirty:M,ctx:u}),t.$set(q);let D=r;r=$(u),r===D?p[r].p(u,M):(oe(),w(p[D],1,1,()=>{p[D]=null}),le(),a=p[r],a?a.p(u,M):(a=p[r]=_[r](u),a.c()),b(a,1),a.m(s.parentNode,s))},i(u){i||(b(e.$$.fragment,u),b(t.$$.fragment,u),b(a),i=!0)},o(u){w(e.$$.fragment,u),w(t.$$.fragment,u),w(a),i=!1},d(u){u&&(v(o),v(l),v(s)),P(e,u),P(t,u),p[r].d(u)}}}function cn(n){let e,o,t,l,r,a,s,i=(n[9].jat[n[0]].name||"Untitled junction")+"",_,p,$,u,M,j,q,D="Arms",E,h,f,d,k="Movements",g,y,H,I;e=new zt({props:{label:"Tools",$$slots:{default:[kn]},$$scope:{ctx:n}}});function F(c,L){return c[9].jat[c[0]][c[1]].movements.length>0?vn:bn}let se=F(n),S=se(n);function be(c){n[22](c)}let pe={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};n[2]!==void 0&&(pe.value=n[2]),u=new at({props:pe}),Q.push(()=>x(u,"value",be));let re=ue(n[9].jat[n[0]][n[1]].arms),G=[];for(let c=0;c<re.length;c+=1)G[c]=Ve(Xe(n,re,c));const ve=c=>w(G[c],1,1,()=>{G[c]=null});let V=n[9].jat[n[0]][n[10]].arms.length>0&&We(n),ae=ue(n[9].jat[n[0]][n[1]].movements),J=[];for(let c=0;c<ae.length;c+=1)J[c]=Ze(Re(n,ae,c));const m=c=>w(J[c],1,1,()=>{J[c]=null});let T=n[9].jat[n[0]][n[10]].movements.length>0&&Qe(n);return{c(){N(e.$$.fragment),o=B(),t=te("p"),l=K("Total JAT score for "),r=K(n[1]),a=B(),s=te("u"),_=K(i),p=K(`
        :
        `),S.c(),$=B(),N(u.$$.fragment),j=B(),q=te("h3"),q.textContent=D,E=B();for(let c=0;c<G.length;c+=1)G[c].c();h=B(),V&&V.c(),f=B(),d=te("h3"),d.textContent=k,g=B();for(let c=0;c<J.length;c+=1)J[c].c();y=B(),T&&T.c(),H=me()},l(c){A(e.$$.fragment,c),o=U(c),t=ne(c,"P",{});var L=ie(t);l=R(L,"Total JAT score for "),r=R(L,n[1]),a=U(L),s=ne(L,"U",{});var Z=ie(s);_=R(Z,i),Z.forEach(v),p=R(L,`
        :
        `),S.l(L),L.forEach(v),$=U(c),A(u.$$.fragment,c),j=U(c),q=ne(c,"H3",{"data-svelte-h":!0}),Be(q)!=="svelte-ld74qb"&&(q.textContent=D),E=U(c);for(let fe=0;fe<G.length;fe+=1)G[fe].l(c);h=U(c),V&&V.l(c),f=U(c),d=ne(c,"H3",{"data-svelte-h":!0}),Be(d)!=="svelte-1dc52s8"&&(d.textContent=k),g=U(c);for(let fe=0;fe<J.length;fe+=1)J[fe].l(c);y=U(c),T&&T.l(c),H=me()},m(c,L){z(e,c,L),C(c,o,L),C(c,t,L),ee(t,l),ee(t,r),ee(t,a),ee(t,s),ee(s,_),ee(t,p),S.m(t,null),C(c,$,L),z(u,c,L),C(c,j,L),C(c,q,L),C(c,E,L);for(let Z=0;Z<G.length;Z+=1)G[Z]&&G[Z].m(c,L);C(c,h,L),V&&V.m(c,L),C(c,f,L),C(c,d,L),C(c,g,L);for(let Z=0;Z<J.length;Z+=1)J[Z]&&J[Z].m(c,L);C(c,y,L),T&&T.m(c,L),C(c,H,L),I=!0},p(c,L){const Z={};L[0]&224|L[1]&512&&(Z.$$scope={dirty:L,ctx:c}),e.$set(Z),(!I||L[0]&2)&&_e(r,c[1]),(!I||L[0]&513)&&i!==(i=(c[9].jat[c[0]].name||"Untitled junction")+"")&&_e(_,i),se===(se=F(c))&&S?S.p(c,L):(S.d(1),S=se(c),S&&(S.c(),S.m(t,null)));const fe={};if(!M&&L[0]&4&&(M=!0,fe.value=c[2],Y(()=>M=!1)),u.$set(fe),L[0]&2579){re=ue(c[9].jat[c[0]][c[1]].arms);let O;for(O=0;O<re.length;O+=1){const we=Xe(c,re,O);G[O]?(G[O].p(we,L),b(G[O],1)):(G[O]=Ve(we),G[O].c(),b(G[O],1),G[O].m(h.parentNode,h))}for(oe(),O=re.length;O<G.length;O+=1)ve(O);le()}if(c[9].jat[c[0]][c[10]].arms.length>0?V?(V.p(c,L),L[0]&513&&b(V,1)):(V=We(c),V.c(),b(V,1),V.m(f.parentNode,f)):V&&(oe(),w(V,1,1,()=>{V=null}),le()),L[0]&133651){ae=ue(c[9].jat[c[0]][c[1]].movements);let O;for(O=0;O<ae.length;O+=1){const we=Re(c,ae,O);J[O]?(J[O].p(we,L),b(J[O],1)):(J[O]=Ze(we),J[O].c(),b(J[O],1),J[O].m(y.parentNode,y))}for(oe(),O=ae.length;O<J.length;O+=1)m(O);le()}c[9].jat[c[0]][c[10]].movements.length>0?T?(T.p(c,L),L[0]&513&&b(T,1)):(T=Qe(c),T.c(),b(T,1),T.m(H.parentNode,H)):T&&(oe(),w(T,1,1,()=>{T=null}),le())},i(c){if(!I){b(e.$$.fragment,c),b(u.$$.fragment,c);for(let L=0;L<re.length;L+=1)b(G[L]);b(V);for(let L=0;L<ae.length;L+=1)b(J[L]);b(T),I=!0}},o(c){w(e.$$.fragment,c),w(u.$$.fragment,c),G=G.filter(Boolean);for(let L=0;L<G.length;L+=1)w(G[L]);w(V),J=J.filter(Boolean);for(let L=0;L<J.length;L+=1)w(J[L]);w(T),I=!1},d(c){c&&(v(o),v(t),v($),v(j),v(q),v(E),v(h),v(f),v(d),v(g),v(y),v(H)),P(e,c),S.d(),P(u,c),Ce(G,c),V&&V.d(c),Ce(J,c),T&&T.d(c)}}}function _n(n){let e;return{c(){e=K("Save")},l(o){e=R(o,"Save")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function gn(n){let e;return{c(){e=K("Delete")},l(o){e=R(o,"Delete")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function pn(n){let e,o,t;function l(a){n[29](a)}let r={label:"Arm Name"};return n[9].jat[n[0]][n[1]].arms[n[3].idx].name!==void 0&&(r.value=n[9].jat[n[0]][n[1]].arms[n[3].idx].name),e=new Pe({props:r}),Q.push(()=>x(e,"value",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){z(e,a,s),t=!0},p(a,s){const i={};!o&&s[0]&523&&(o=!0,i.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,Y(()=>o=!1)),e.$set(i)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function dn(n){let e,o;return e=new fn({props:{junctionIdx:n[0],stage:n[1],idx:n[3].idx}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[0]&1&&(r.junctionIdx=t[0]),l[0]&2&&(r.stage=t[1]),l[0]&8&&(r.idx=t[3].idx),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function $n(n){let e;return{c(){e=K("Zoom to fit")},l(o){e=R(o,"Zoom to fit")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function hn(n){let e;return{c(){e=K("Show scheme context")},l(o){e=R(o,"Show scheme context")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function kn(n){var E;let e,o,t,l,r,a,s,i,_,p,$,u;e=new ke({props:{$$slots:{default:[$n]},$$scope:{ctx:n}}}),e.$on("click",n[19]),t=new Tt({}),r=new Et({});function M(h){n[20](h)}let j={map:(E=n[7])==null?void 0:E.getMap()};n[5]!==void 0&&(j.enabled=n[5]),s=new Nt({props:j}),Q.push(()=>x(s,"enabled",M));function q(h){n[21](h)}let D={$$slots:{default:[hn]},$$scope:{ctx:n}};return n[6]!==void 0&&(D.checked=n[6]),p=new At({props:D}),Q.push(()=>x(p,"checked",q)),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),N(r.$$.fragment),a=B(),N(s.$$.fragment),_=B(),N(p.$$.fragment)},l(h){A(e.$$.fragment,h),o=U(h),A(t.$$.fragment,h),l=U(h),A(r.$$.fragment,h),a=U(h),A(s.$$.fragment,h),_=U(h),A(p.$$.fragment,h)},m(h,f){z(e,h,f),C(h,o,f),z(t,h,f),C(h,l,f),z(r,h,f),C(h,a,f),z(s,h,f),C(h,_,f),z(p,h,f),u=!0},p(h,f){var y;const d={};f[1]&512&&(d.$$scope={dirty:f,ctx:h}),e.$set(d);const k={};f[0]&128&&(k.map=(y=h[7])==null?void 0:y.getMap()),!i&&f[0]&32&&(i=!0,k.enabled=h[5],Y(()=>i=!1)),s.$set(k);const g={};f[1]&512&&(g.$$scope={dirty:f,ctx:h}),!$&&f[0]&64&&($=!0,g.checked=h[6],Y(()=>$=!1)),p.$set(g)},i(h){u||(b(e.$$.fragment,h),b(t.$$.fragment,h),b(r.$$.fragment,h),b(s.$$.fragment,h),b(p.$$.fragment,h),u=!0)},o(h){w(e.$$.fragment,h),w(t.$$.fragment,h),w(r.$$.fragment,h),w(s.$$.fragment,h),w(p.$$.fragment,h),u=!1},d(h){h&&(v(o),v(l),v(a),v(_)),P(e,h),P(t,h),P(r,h),P(s,h),P(p,h)}}}function bn(n){let e;return{c(){e=K("No movements added")},l(o){e=R(o,"No movements added")},m(o,t){C(o,e,t)},p:he,d(o){o&&v(e)}}}function vn(n){let e=Math.round(xe(n[9].jat[n[0]][n[1]]))+"",o,t;return{c(){o=K(e),t=K("%")},l(l){o=R(l,e),t=R(l,"%")},m(l,r){C(l,o,r),C(l,t,r)},p(l,r){r[0]&515&&e!==(e=Math.round(xe(l[9].jat[l[0]][l[1]]))+"")&&_e(o,e)},d(l){l&&(v(o),v(t))}}}function Ve(n){let e,o;function t(){return n[23](n[37])}function l(){return n[24](n[37])}return e=new ze({props:{name:`${Ye(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[25]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){z(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=`${Ye(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(s)},i(r){o||(b(e.$$.fragment,r),o=!0)},o(r){w(e.$$.fragment,r),o=!1},d(r){P(e,r)}}}function We(n){let e,o;return e=new ke({props:{$$slots:{default:[wn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function wn(n){let e,o;return{c(){e=K("Copy arms from "),o=K(n[10])},l(t){e=R(t,"Copy arms from "),o=R(t,n[10])},m(t,l){C(t,e,l),C(t,o,l)},p:he,d(t){t&&(v(e),v(o))}}}function jn(n){let e,o,t=n[34].score+"",l;return{c(){e=te("span"),o=K("Score: "),l=K(t),this.h()},l(r){e=ne(r,"SPAN",{style:!0});var a=ie(e);o=R(a,"Score: "),l=R(a,t),a.forEach(v),this.h()},h(){W(e,"padding","4px"),W(e,"color",n[35].font),W(e,"background-color",n[35].background)},m(r,a){C(r,e,a),ee(e,o),ee(e,l)},p(r,a){a[0]&515&&t!==(t=r[34].score+"")&&_e(l,t),a[0]&515&&W(e,"color",r[35].font),a[0]&515&&W(e,"background-color",r[35].background)},d(r){r&&v(e)}}}function Ze(n){let e,o;function t(){return n[26](n[37])}function l(){return n[27](n[37])}return e=new ze({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[jn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[28]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){z(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=n[34].name||"Unnamed movement"),a[0]&515|a[1]&512&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(r){o||(b(e.$$.fragment,r),o=!0)},o(r){w(e.$$.fragment,r),o=!1},d(r){P(e,r)}}}function Qe(n){let e,o;return e=new ke({props:{$$slots:{default:[Cn]},$$scope:{ctx:n}}}),e.$on("click",n[16]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Cn(n){let e,o;return{c(){e=K("Copy movements from "),o=K(n[10])},l(t){e=R(t,"Copy movements from "),o=R(t,n[10])},m(t,l){C(t,e,l),C(t,o,l)},p:he,d(t){t&&(v(e),v(o))}}}function Ln(n){let e,o,t,l,r,a,s,i,_,p,$,u,M,j;function q(g){n[18](g)}let D={label:"Commentary / Notes"};n[9].jat[n[0]][n[1]].notes!==void 0&&(D.value=n[9].jat[n[0]][n[1]].notes),e=new it({props:D}),Q.push(()=>x(e,"value",q));const E=[cn,mn],h=[];function f(g,y){return g[3]==null?0:1}a=f(n),s=h[a]=E[a](n);function d(g){n[32](g)}let k={junctionIdx:n[0],stage:n[1],newKind:n[2],hoveringSidebar:n[4],streetviewOn:n[5],showContext:n[6],select:n[11],stopEditing:n[12]};return n[3]!==void 0&&(k.editing=n[3]),p=new rn({props:k}),n[31](p),Q.push(()=>x(p,"editing",d)),{c(){N(e.$$.fragment),t=B(),l=te("div"),r=te("div"),s.c(),i=B(),_=te("div"),N(p.$$.fragment),this.h()},l(g){A(e.$$.fragment,g),t=U(g),l=ne(g,"DIV",{style:!0});var y=ie(l);r=ne(y,"DIV",{style:!0});var H=ie(r);s.l(H),H.forEach(v),i=U(y),_=ne(y,"DIV",{style:!0});var I=ie(_);A(p.$$.fragment,I),I.forEach(v),y.forEach(v),this.h()},h(){W(r,"width","30%"),W(r,"overflow-y","scroll"),W(r,"padding","10px"),W(r,"border","1px solid black"),W(_,"position","relative"),W(_,"width","100%"),W(l,"display","flex"),W(l,"height","80vh")},m(g,y){z(e,g,y),C(g,t,y),C(g,l,y),ee(l,r),h[a].m(r,null),n[30](r),ee(l,i),ee(l,_),z(p,_,null),u=!0,M||(j=dt(un,"keydown",n[14]),M=!0)},p(g,y){const H={};!o&&y[0]&515&&(o=!0,H.value=g[9].jat[g[0]][g[1]].notes,Y(()=>o=!1)),e.$set(H);let I=a;a=f(g),a===I?h[a].p(g,y):(oe(),w(h[I],1,1,()=>{h[I]=null}),le(),s=h[a],s?s.p(g,y):(s=h[a]=E[a](g),s.c()),b(s,1),s.m(r,null));const F={};y[0]&1&&(F.junctionIdx=g[0]),y[0]&2&&(F.stage=g[1]),y[0]&4&&(F.newKind=g[2]),y[0]&16&&(F.hoveringSidebar=g[4]),y[0]&32&&(F.streetviewOn=g[5]),y[0]&64&&(F.showContext=g[6]),!$&&y[0]&8&&($=!0,F.editing=g[3],Y(()=>$=!1)),p.$set(F)},i(g){u||(b(e.$$.fragment,g),b(s),b(p.$$.fragment,g),u=!0)},o(g){w(e.$$.fragment,g),w(s),w(p.$$.fragment,g),u=!1},d(g){g&&(v(t),v(l)),P(e,g),h[a].d(),n[30](null),n[31](null),P(p),M=!1,j()}}}function Ye(n){return String.fromCharCode(n+65)}function xe(n){let e=0,o=0;for(let t of n.movements)e+={0:0,1:1,2:2,X:0}[t.score],o+=2;return e/o*100}function Mn(n,e,o){let t;ye(n,X,m=>o(9,t=m));let{junctionIdx:l}=e,{stage:r}=e,a=r=="existing"?"proposed":"existing",s="arm",i=null,_=null,p=null,$=!1,u=!0,M=null,j;async function q(m){_=j.scrollTop,o(3,i=m),o(4,p=null)}async function D(){o(3,i=null),_!=null&&(await $t(),o(8,j.scrollTop=_,j),_=null)}function E(){window.confirm(`Delete this ${i.kind}?`)&&(i.kind=="movement"?(t.jat[l][r].movements.splice(i.idx,1),X.set(t)):(t.jat[l][r].arms.splice(i.idx,1),X.set(t)),D())}function h(m){if(i!=null&&m.key=="Escape")m.stopPropagation(),D();else if(i!=null&&m.key=="Delete"){let T=m.target.tagName;if(T=="INPUT"||T=="TEXTAREA")return;m.stopPropagation(),E()}}function f(){t.jat[l][r].arms.length>0&&!window.confirm("Overwrite arms?")||(je(X,t.jat[l][r].arms=JSON.parse(JSON.stringify(t.jat[l][a].arms)),t),X.set(t))}function d(){t.jat[l][r].movements.length>0&&!window.confirm("Overwrite movements?")||(je(X,t.jat[l][r].movements=JSON.parse(JSON.stringify(t.jat[l][a].movements)),t),X.set(t))}let k={0:ce.red,1:ce.amber,2:ce.green,X:ce.critical};function g(m){n.$$.not_equal(t.jat[l][r].notes,m)&&(t.jat[l][r].notes=m,X.set(t))}const y=()=>M==null?void 0:M.zoom(!0);function H(m){$=m,o(5,$)}function I(m){u=m,o(6,u)}function F(m){s=m,o(2,s)}const se=m=>q({kind:"arm",idx:m}),S=m=>o(4,p={kind:"arm",idx:m}),be=()=>o(4,p=null),pe=m=>q({kind:"movement",idx:m}),re=m=>o(4,p={kind:"movement",idx:m}),G=()=>o(4,p=null);function ve(m){n.$$.not_equal(t.jat[l][r].arms[i.idx].name,m)&&(t.jat[l][r].arms[i.idx].name=m,X.set(t))}function V(m){Q[m?"unshift":"push"](()=>{j=m,o(8,j)})}function ae(m){Q[m?"unshift":"push"](()=>{M=m,o(7,M)})}function J(m){i=m,o(3,i)}return n.$$set=m=>{"junctionIdx"in m&&o(0,l=m.junctionIdx),"stage"in m&&o(1,r=m.stage)},[l,r,s,i,p,$,u,M,j,t,a,q,D,E,h,f,d,k,g,y,H,I,F,se,S,be,pe,re,G,ve,V,ae,J]}class Sn extends Le{constructor(e){super(),Me(this,e,Mn,Ln,$e,{junctionIdx:0,stage:1},null,[-1,-1])}}function et(n,e,o){const t=n.slice();return t[10]=e[o],t[12]=o,t}function yn(n){let e,o=(n[1].jat[n[0].idx].name||"Untitled junction")+"",t,l,r=n[0].stage+"",a,s,i,_,p,$,u,M=n[0].stage,j,q;i=new ht({props:{$$slots:{default:[qn]},$$scope:{ctx:n}}});function D(f){n[9](f)}let E={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(E.value=n[1].jat[n[0].idx].name),p=new Pe({props:E}),Q.push(()=>x(p,"value",D));let h=tt(n);return{c(){e=te("h2"),t=K(o),l=K(" - "),a=K(r),s=B(),N(i.$$.fragment),_=B(),N(p.$$.fragment),u=B(),h.c(),j=me()},l(f){e=ne(f,"H2",{});var d=ie(e);t=R(d,o),l=R(d," - "),a=R(d,r),d.forEach(v),s=U(f),A(i.$$.fragment,f),_=U(f),A(p.$$.fragment,f),u=U(f),h.l(f),j=me()},m(f,d){C(f,e,d),ee(e,t),ee(e,l),ee(e,a),C(f,s,d),z(i,f,d),C(f,_,d),z(p,f,d),C(f,u,d),h.m(f,d),C(f,j,d),q=!0},p(f,d){(!q||d&3)&&o!==(o=(f[1].jat[f[0].idx].name||"Untitled junction")+"")&&_e(t,o),(!q||d&1)&&r!==(r=f[0].stage+"")&&_e(a,r);const k={};d&8193&&(k.$$scope={dirty:d,ctx:f}),i.$set(k);const g={};!$&&d&3&&($=!0,g.value=f[1].jat[f[0].idx].name,Y(()=>$=!1)),p.$set(g),d&1&&$e(M,M=f[0].stage)?(oe(),w(h,1,1,he),le(),h=tt(f),h.c(),b(h,1),h.m(j.parentNode,j)):h.p(f,d)},i(f){q||(b(i.$$.fragment,f),b(p.$$.fragment,f),b(h),q=!0)},o(f){w(i.$$.fragment,f),w(p.$$.fragment,f),w(h),q=!1},d(f){f&&(v(e),v(s),v(_),v(u),v(j)),P(i,f),P(p,f),h.d(f)}}}function In(n){let e,o,t,l;e=new ot({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let r=ue(n[1].jat),a=[];for(let i=0;i<r.length;i+=1)a[i]=nt(et(n,r,i));const s=i=>w(a[i],1,1,()=>{a[i]=null});return{c(){N(e.$$.fragment),o=B();for(let i=0;i<a.length;i+=1)a[i].c();t=me()},l(i){A(e.$$.fragment,i),o=U(i);for(let _=0;_<a.length;_+=1)a[_].l(i);t=me()},m(i,_){z(e,i,_),C(i,o,_);for(let p=0;p<a.length;p+=1)a[p]&&a[p].m(i,_);C(i,t,_),l=!0},p(i,_){const p={};if(_&8192&&(p.$$scope={dirty:_,ctx:i}),e.$set(p),_&3){r=ue(i[1].jat);let $;for($=0;$<r.length;$+=1){const u=et(i,r,$);a[$]?(a[$].p(u,_),b(a[$],1)):(a[$]=nt(u),a[$].c(),b(a[$],1),a[$].m(t.parentNode,t))}for(oe(),$=r.length;$<a.length;$+=1)s($);le()}},i(i){if(!l){b(e.$$.fragment,i);for(let _=0;_<r.length;_+=1)b(a[_]);l=!0}},o(i){w(e.$$.fragment,i),a=a.filter(Boolean);for(let _=0;_<a.length;_+=1)w(a[_]);l=!1},d(i){i&&(v(o),v(t)),P(e,i),Ce(a,i)}}}function Tn(n){let e;return{c(){e=K("Back to all junctions")},l(o){e=R(o,"Back to all junctions")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function En(n){let e,o;return e=new ke({props:{$$slots:{default:[An]},$$scope:{ctx:n}}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Nn(n){let e,o;return e=new ke({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function An(n){let e;return{c(){e=K("Edit Proposed")},l(o){e=R(o,"Edit Proposed")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function zn(n){let e;return{c(){e=K("Edit Existing")},l(o){e=R(o,"Edit Existing")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function Pn(n){let e;return{c(){e=K("Delete")},l(o){e=R(o,"Delete")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function qn(n){let e,o,t,l,r,a,s;e=new ke({props:{$$slots:{default:[Tn]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const i=[Nn,En],_=[];function p($,u){return $[0].stage=="proposed"?0:1}return t=p(n),l=_[t]=i[t](n),a=new lt({props:{$$slots:{default:[Pn]},$$scope:{ctx:n}}}),a.$on("click",n[8]),{c(){N(e.$$.fragment),o=B(),l.c(),r=B(),N(a.$$.fragment)},l($){A(e.$$.fragment,$),o=U($),l.l($),r=U($),A(a.$$.fragment,$)},m($,u){z(e,$,u),C($,o,u),_[t].m($,u),C($,r,u),z(a,$,u),s=!0},p($,u){const M={};u&8192&&(M.$$scope={dirty:u,ctx:$}),e.$set(M);let j=t;t=p($),t===j?_[t].p($,u):(oe(),w(_[j],1,1,()=>{_[j]=null}),le(),l=_[t],l?l.p($,u):(l=_[t]=i[t]($),l.c()),b(l,1),l.m(r.parentNode,r));const q={};u&8192&&(q.$$scope={dirty:u,ctx:$}),a.$set(q)},i($){s||(b(e.$$.fragment,$),b(l),b(a.$$.fragment,$),s=!0)},o($){w(e.$$.fragment,$),w(l),w(a.$$.fragment,$),s=!1},d($){$&&(v(o),v(r)),P(e,$),_[t].d($),P(a,$)}}}function tt(n){let e,o;return e=new Sn({props:{junctionIdx:n[0].idx,stage:n[0].stage}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l&1&&(r.junctionIdx=t[0].idx),l&1&&(r.stage=t[0].stage),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Bn(n){let e;return{c(){e=K("Add new junction")},l(o){e=R(o,"Add new junction")},m(o,t){C(o,e,t)},d(o){o&&v(e)}}}function nt(n){let e,o;function t(){return n[4](n[12])}return e=new ze({props:{name:n[10].name||"Untitled junction"}}),e.$on("click",t),{c(){N(e.$$.fragment)},l(l){A(e.$$.fragment,l)},m(l,r){z(e,l,r),o=!0},p(l,r){n=l;const a={};r&2&&(a.name=n[10].name||"Untitled junction"),e.$set(a)},i(l){o||(b(e.$$.fragment,l),o=!0)},o(l){w(e.$$.fragment,l),o=!1},d(l){P(e,l)}}}function Un(n){let e,o,t,l;const r=[In,yn],a=[];function s(i,_){return i[0].kind=="list"?0:i[0].kind=="edit"?1:-1}return~(e=s(n))&&(o=a[e]=r[e](n)),{c(){o&&o.c(),t=me()},l(i){o&&o.l(i),t=me()},m(i,_){~e&&a[e].m(i,_),C(i,t,_),l=!0},p(i,[_]){let p=e;e=s(i),e===p?~e&&a[e].p(i,_):(o&&(oe(),w(a[p],1,1,()=>{a[p]=null}),le()),~e?(o=a[e],o?o.p(i,_):(o=a[e]=r[e](i),o.c()),b(o,1),o.m(t.parentNode,t)):o=null)},i(i){l||(b(o),l=!0)},o(i){w(o),l=!1},d(i){i&&v(t),~e&&a[e].d(i)}}}function Te(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Dn(n,e,o){let t;ye(n,X,M=>o(1,t=M));let l={kind:"list"};function r(){je(X,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),o(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function a(M){window.confirm("Delete this junction?")&&(t.jat.splice(M,1),X.set(t),o(0,l={kind:"list"}))}const s=M=>o(0,l={kind:"edit",idx:M,stage:"existing"}),i=()=>o(0,l={kind:"list"}),_=()=>o(0,l={kind:"edit",idx:Te(l),stage:"existing"}),p=()=>o(0,l={kind:"edit",idx:Te(l),stage:"proposed"}),$=()=>a(Te(l));function u(M){n.$$.not_equal(t.jat[l.idx].name,M)&&(t.jat[l.idx].name=M,X.set(t))}return[l,t,r,a,s,i,_,p,$,u]}class so extends Le{constructor(e){super(),Me(this,e,Dn,Un,$e,{})}}export{so as component};
