import{s as je,r as ae,w as fe,l as _t,u as gt,m as dt,o as pt,C as be,k as Ne,S as yt,U as we,a as B,g as O,i as b,f as p,J as ye,Z as Mt,e as X,c as W,b as Q,q as oe,h as F,D as se,H as $t,v as V,N as Ae,t as q,O as Pe,d as R,n as Se,p as Me,j as me,y as Lt,a0 as Je}from"../chunks/scheduler.BupgUPYD.js";import{S as Ee,i as Ie,e as ue,c as N,a as A,m as P,t as k,b as j,d as D,g as _e,f as ge}from"../chunks/index.DdWFotL4.js";import{e as de}from"../chunks/each.DPGgJC1I.js";import{B as St}from"../chunks/ButtonGroup.BCNwrOPZ.js";import{D as ze,C as Et}from"../chunks/DefaultButton.B9e1GVo9.js";import"../chunks/index.BZ97sfHq.js";import{S as ve}from"../chunks/SecondaryButton.DDaC9gF3.js";import{T as qe}from"../chunks/TextInput.CA20muue.js";import{W as Re}from"../chunks/WarningButton.DFY34J1l.js";import{s as ee}from"../chunks/data.DumC-EaA.js";import{g as It}from"../chunks/globals.D0QH3NT1.js";import{c as Ve}from"../chunks/index.BSrUxFmj.js";import{a as Tt,c as Nt,j as he,v as At,w as ht,x as Fe,M as Pt,b as Dt,G as Xe,L as Be,h as We,C as Ut,y as Ft}from"../chunks/index.LICZvnLK.js";import{g as Oe,t as Bt}from"../chunks/index.glU42jsP.js";import{c as $e}from"../chunks/colors.DaC397qr.js";import{G as Ot,I as De,p as zt}from"../chunks/pan.DxDoTDzz.js";import{M as qt,G as Rt,S as Ht,C as He}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.KEqRhzcb.js";import{M as Te,B as Gt,C as Jt}from"../chunks/Marker.DaZNDpeS.js";import"../chunks/index.DhUfdivm.js";import"../chunks/paths.Br5y-eO8.js";import"../chunks/entry.rqy1AEDD.js";import{R as Vt}from"../chunks/RouteMapLayer.CVKixv7e.js";import{P as vt}from"../chunks/Popup.PeBMpIty.js";import{T as bt}from"../chunks/TextArea.BilFjioX.js";import{R as Ze}from"../chunks/Radio.BRVLBp4u.js";function Xt(t){let e;const l=t[16].default,n=_t(l,t,t[24],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&16777216)&&gt(n,l,o,o[24],e?pt(l,o[24],a,null):dt(o[24]),null)},i(o){e||(k(n,o),e=!0)},o(o){j(n,o),e=!1},d(o){n&&n.d(o)}}}function Wt(t){let e,l,n;function o(r){t[17](r)}let a={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Xt]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new Tt({props:a}),ae.push(()=>ue(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,i){P(e,r,i),n=!0},p(r,[i]){const s={};i&2&&(s.id=r[1]),i&4&&(s.source=r[2]),i&8&&(s.sourceLayer=r[3]),i&16&&(s.beforeId=r[4]),i&32&&(s.beforeLayerType=r[5]),i&64&&(s.paint=r[6]),i&128&&(s.layout=r[7]),i&256&&(s.filter=r[8]),i&512&&(s.applyToClusters=r[9]),i&1024&&(s.minzoom=r[10]),i&2048&&(s.maxzoom=r[11]),i&4096&&(s.hoverCursor=r[12]),i&8192&&(s.manageHoverState=r[13]),i&16384&&(s.eventsIfTopMost=r[14]),i&32768&&(s.interactive=r[15]),i&16777216&&(s.$$scope={dirty:i,ctx:r}),!l&&i&1&&(l=!0,s.hovered=r[0],fe(()=>l=!1)),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){D(e,r)}}}function Zt(t,e,l){let{$$slots:n={},$$scope:o}=e,{id:a=Nt("symbol")}=e,{source:r=void 0}=e,{sourceLayer:i=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:c=void 0}=e,{layout:g=void 0}=e,{filter:_=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:C=void 0}=e,{manageHoverState:E=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:T=!0}=e;function f(M){$=M,l(0,$)}function d(M){be.call(this,t,M)}function S(M){be.call(this,t,M)}function te(M){be.call(this,t,M)}function Y(M){be.call(this,t,M)}function ne(M){be.call(this,t,M)}function U(M){be.call(this,t,M)}return t.$$set=M=>{"id"in M&&l(1,a=M.id),"source"in M&&l(2,r=M.source),"sourceLayer"in M&&l(3,i=M.sourceLayer),"beforeId"in M&&l(4,s=M.beforeId),"beforeLayerType"in M&&l(5,m=M.beforeLayerType),"paint"in M&&l(6,c=M.paint),"layout"in M&&l(7,g=M.layout),"filter"in M&&l(8,_=M.filter),"applyToClusters"in M&&l(9,w=M.applyToClusters),"minzoom"in M&&l(10,L=M.minzoom),"maxzoom"in M&&l(11,I=M.maxzoom),"hoverCursor"in M&&l(12,C=M.hoverCursor),"manageHoverState"in M&&l(13,E=M.manageHoverState),"hovered"in M&&l(0,$=M.hovered),"eventsIfTopMost"in M&&l(14,v=M.eventsIfTopMost),"interactive"in M&&l(15,T=M.interactive),"$$scope"in M&&l(24,o=M.$$scope)},[$,a,r,i,s,m,c,g,_,w,L,I,C,E,v,T,n,f,d,S,te,Y,ne,U,o]}class Kt extends Ee{constructor(e){super(),Ie(this,e,Zt,Wt,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Qt=Object.defineProperty,Yt=(t,e)=>Qt(t,"name",{value:e,configurable:!0});function kt(t,e,l,n={}){const o=Oe(t),a=he(o[0]),r=he(o[1]),i=he(l),s=At(e,n.units),m=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),c=a+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(m)),g=Fe(c),_=Fe(m);return ht([g,_],n.properties)}Yt(kt,"destination");var Le=kt,xt=Object.defineProperty,wt=(t,e)=>xt(t,"name",{value:e,configurable:!0});function Ge(t,e,l={}){if(l.final===!0)return jt(t,e);const n=Oe(t),o=Oe(e),a=he(n[0]),r=he(o[0]),i=he(n[1]),s=he(o[1]),m=Math.sin(r-a)*Math.cos(s),c=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(r-a);return Fe(Math.atan2(m,c))}wt(Ge,"bearing");function jt(t,e){let l=Ge(e,t);return l=(l+180)%360,l}wt(jt,"calculateFinalBearing");var ke=Ge;const en="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ke(t,e,l){const n=t.slice();return n[36]=e[l],n[37]=e,n[38]=l,n}function Qe(t,e,l){const n=t.slice();return n[39]=e[l],n[40]=e,n[38]=l,n}function Ye(t){let e,l,n,o,a,r,i;return l=new De({props:{$$slots:{default:[ln]},$$scope:{ctx:t}}}),l.$on("click",function(){Mt(t[5])&&t[5].apply(this,arguments)}),o=new De({props:{$$slots:{default:[an]},$$scope:{ctx:t}}}),o.$on("click",t[17]),r=new De({props:{$$slots:{default:[un]},$$scope:{ctx:t}}}),r.$on("click",t[18]),{c(){e=X("div"),N(l.$$.fragment),n=B(),N(o.$$.fragment),a=B(),N(r.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Q(e);A(l.$$.fragment,m),n=O(m),A(o.$$.fragment,m),a=O(m),A(r.$$.fragment,m),m.forEach(p),this.h()},h(){oe(e,"class","control-panel svelte-1w3m76d")},m(s,m){b(s,e,m),P(l,e,null),F(e,n),P(o,e,null),F(e,a),P(r,e,null),i=!0},p(s,m){t=s;const c={};m[0]&1|m[1]&1024&&(c.$$scope={dirty:m,ctx:t}),l.$set(c);const g={};m[0]&1|m[1]&1024&&(g.$$scope={dirty:m,ctx:t}),o.$set(g);const _={};m[0]&1|m[1]&1024&&(_.$$scope={dirty:m,ctx:t}),r.$set(_)},i(s){i||(k(l.$$.fragment,s),k(o.$$.fragment,s),k(r.$$.fragment,s),i=!0)},o(s){j(l.$$.fragment,s),j(o.$$.fragment,s),j(r.$$.fragment,s),i=!1},d(s){s&&p(e),D(l),D(o),D(r)}}}function tn(t){let e;return{c(){e=q("Move map")},l(l){e=R(l,"Move map")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function nn(t){let e,l="Move map";return{c(){e=X("u"),e.textContent=l},l(n){e=W(n,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-1719ytd"&&(e.textContent=l)},m(n,o){b(n,e,o)},d(n){n&&p(e)}}}function ln(t){let e,l,n,o;function a(s,m){return s[0].mode=="select"?nn:tn}let r=a(t),i=r(t);return{c(){e=X("img"),n=B(),i.c(),o=se(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),n=O(s),i.l(s),o=se(),this.h()},h(){$t(e.src,l=zt)||oe(e,"src",l),oe(e,"alt","Move map"),V(e,"vertical-align","middle")},m(s,m){b(s,e,m),b(s,n,m),i.m(s,m),b(s,o,m)},p(s,m){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(n),p(o)),i.d(s)}}}function on(t){let e;return{c(){e=q("New arm")},l(l){e=R(l,"New arm")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function rn(t){let e,l="New arm";return{c(){e=X("u"),e.textContent=l},l(n){e=W(n,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-1typ7gq"&&(e.textContent=l)},m(n,o){b(n,e,o)},d(n){n&&p(e)}}}function an(t){let e,l,n,o,a,r;function i(c,g){return c[0].mode=="new-arm"?rn:on}let s=i(t),m=s(t);return{c(){e=Ae("svg"),l=Ae("circle"),n=Ae("text"),o=q("A"),a=B(),m.c(),r=se(),this.h()},l(c){e=Pe(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var g=Q(e);l=Pe(g,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Q(l).forEach(p),n=Pe(g,"text",{x:!0,y:!0,fill:!0});var _=Q(n);o=R(_,"A"),_.forEach(p),g.forEach(p),a=O(c),m.l(c),r=se(),this.h()},h(){oe(l,"cx","12"),oe(l,"cy","12"),oe(l,"r","12"),oe(l,"fill","white"),oe(n,"x","6"),oe(n,"y","16"),oe(n,"fill","#4472c4"),oe(e,"width","24"),oe(e,"height","24"),oe(e,"xmlns","http://www.w3.org/2000/svg"),V(e,"vertical-align","middle")},m(c,g){b(c,e,g),F(e,l),F(e,n),F(n,o),b(c,a,g),m.m(c,g),b(c,r,g)},p(c,g){s!==(s=i(c))&&(m.d(1),m=s(c),m&&(m.c(),m.m(r.parentNode,r)))},d(c){c&&(p(e),p(a),p(r)),m.d(c)}}}function sn(t){let e;return{c(){e=q("New movement")},l(l){e=R(l,"New movement")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function fn(t){let e,l="New movement";return{c(){e=X("u"),e.textContent=l},l(n){e=W(n,"U",{"data-svelte-h":!0}),Me(e)!=="svelte-o92ucp"&&(e.textContent=l)},m(n,o){b(n,e,o)},d(n){n&&p(e)}}}function un(t){let e,l,n,o;function a(s,m){return s[0].mode=="new-movement"?fn:sn}let r=a(t),i=r(t);return{c(){e=X("img"),n=B(),i.c(),o=se(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),n=O(s),i.l(s),o=se(),this.h()},h(){$t(e.src,l=en)||oe(e,"src",l),oe(e,"alt","New movement"),V(e,"vertical-align","middle")},m(s,m){b(s,e,m),b(s,n,m),i.m(s,m),b(s,o,m)},p(s,m){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(n),p(o)),i.d(s)}}}function mn(t){let e,l=jn(t[38])+"",n;return{c(){e=X("span"),n=q(l),this.h()},l(o){e=W(o,"SPAN",{class:!0});var a=Q(e);n=R(a,l),a.forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),V(e,"color","#4472c4"),V(e,"background-color","white")},m(o,a){b(o,e,a),F(e,n)},p:Se,d(o){o&&p(e)}}}function xe(t){let e,l,n;function o(s){t[19](s,t[39])}function a(){return t[20](t[38])}function r(){return t[21](t[38])}let i={draggable:!0,$$slots:{default:[mn]},$$scope:{ctx:t}};return t[39].point!==void 0&&(i.lngLat=t[39].point),e=new Te({props:i}),ae.push(()=>ue(e,"lngLat",o)),e.$on("dragend",a),e.$on("click",r),{c(){N(e.$$.fragment)},l(s){A(e.$$.fragment,s)},m(s,m){P(e,s,m),n=!0},p(s,m){t=s;const c={};m[1]&1024&&(c.$$scope={dirty:m,ctx:t}),!l&&m[0]&70&&(l=!0,c.lngLat=t[39].point,fe(()=>l=!1)),e.$set(c)},i(s){n||(k(e.$$.fragment,s),n=!0)},o(s){j(e.$$.fragment,s),n=!1},d(s){D(e,s)}}}function cn(t){let e;return{c(){e=X("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Q(e).forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),V(e,"background-color",t[9][t[36].score]),V(e,"opacity",t[36].kind=="walking & wheeling"?"0%":"100%")},m(l,n){b(l,e,n)},p(l,n){n[0]&70&&V(e,"background-color",l[9][l[36].score]),n[0]&70&&V(e,"opacity",l[36].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&p(e)}}}function _n(t){let e;return{c(){e=X("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Q(e).forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),V(e,"background-color",t[9][t[36].score])},m(l,n){b(l,e,n)},p(l,n){n[0]&70&&V(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function gn(t){let e;return{c(){e=X("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Q(e).forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),V(e,"background-color",t[9][t[36].score]),V(e,"opacity","0%")},m(l,n){b(l,e,n)},p(l,n){n[0]&70&&V(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function et(t){let e,l,n,o,a,r,i,s,m;function c(d){t[22](d,t[36])}function g(){return t[23](t[38])}function _(){return t[24](t[38])}let w={draggable:!0,$$slots:{default:[cn]},$$scope:{ctx:t}};t[36].point1!==void 0&&(w.lngLat=t[36].point1),e=new Te({props:w}),ae.push(()=>ue(e,"lngLat",c)),e.$on("dragend",g),e.$on("click",_);function L(d){t[25](d,t[36])}function I(){return t[26](t[38])}function C(){return t[27](t[38])}let E={draggable:!0,$$slots:{default:[_n]},$$scope:{ctx:t}};t[36].point2!==void 0&&(E.lngLat=t[36].point2),o=new Te({props:E}),ae.push(()=>ue(o,"lngLat",L)),o.$on("dragend",I),o.$on("click",C);function $(d){t[28](d,t[36])}function v(){return t[29](t[38])}function T(){return t[30](t[38])}let f={draggable:!0,$$slots:{default:[gn]},$$scope:{ctx:t}};return t[36].point3!==void 0&&(f.lngLat=t[36].point3),i=new Te({props:f}),ae.push(()=>ue(i,"lngLat",$)),i.$on("dragend",v),i.$on("click",T),{c(){N(e.$$.fragment),n=B(),N(o.$$.fragment),r=B(),N(i.$$.fragment)},l(d){A(e.$$.fragment,d),n=O(d),A(o.$$.fragment,d),r=O(d),A(i.$$.fragment,d)},m(d,S){P(e,d,S),b(d,n,S),P(o,d,S),b(d,r,S),P(i,d,S),m=!0},p(d,S){t=d;const te={};S[0]&70|S[1]&1024&&(te.$$scope={dirty:S,ctx:t}),!l&&S[0]&70&&(l=!0,te.lngLat=t[36].point1,fe(()=>l=!1)),e.$set(te);const Y={};S[0]&70|S[1]&1024&&(Y.$$scope={dirty:S,ctx:t}),!a&&S[0]&70&&(a=!0,Y.lngLat=t[36].point2,fe(()=>a=!1)),o.$set(Y);const ne={};S[0]&70|S[1]&1024&&(ne.$$scope={dirty:S,ctx:t}),!s&&S[0]&70&&(s=!0,ne.lngLat=t[36].point3,fe(()=>s=!1)),i.$set(ne)},i(d){m||(k(e.$$.fragment,d),k(o.$$.fragment,d),k(i.$$.fragment,d),m=!0)},o(d){j(e.$$.fragment,d),j(o.$$.fragment,d),j(i.$$.fragment,d),m=!1},d(d){d&&(p(n),p(r)),D(e,d),D(o,d),D(i,d)}}}function dn(t){let e=(t[35].name||"Untitled movement")+"",l;return{c(){l=q(e)},l(n){l=R(n,e)},m(n,o){b(n,l,o)},p(n,o){o[1]&16&&e!==(e=(n[35].name||"Untitled movement")+"")&&me(l,e)},d(n){n&&p(l)}}}function pn(t){let e,l;return e=new vt({props:{$$slots:{default:[dn,({props:n})=>({35:n}),({props:n})=>[0,n?16:0]]},$$scope:{ctx:t}}}),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function $n(t){let e=(t[35].name||"Untitled movement")+"",l;return{c(){l=q(e)},l(n){l=R(n,e)},m(n,o){b(n,l,o)},p(n,o){o[1]&16&&e!==(e=(n[35].name||"Untitled movement")+"")&&me(l,e)},d(n){n&&p(l)}}}function hn(t){let e,l;return e=new vt({props:{$$slots:{default:[$n,({props:n})=>({35:n}),({props:n})=>[0,n?16:0]]},$$scope:{ctx:t}}}),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function vn(t){let e,l,n,o,a,r;return e=new Be({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":We(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[pn]},$$scope:{ctx:t}}}),e.$on("click",t[11]),n=new Be({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":We(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[hn]},$$scope:{ctx:t}}}),n.$on("click",t[11]),a=new Kt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),l=B(),N(n.$$.fragment),o=B(),N(a.$$.fragment)},l(i){A(e.$$.fragment,i),l=O(i),A(n.$$.fragment,i),o=O(i),A(a.$$.fragment,i)},m(i,s){P(e,i,s),b(i,l,s),P(n,i,s),b(i,o,s),P(a,i,s),r=!0},p(i,s){const m={};s[1]&1024&&(m.$$scope={dirty:s,ctx:i}),e.$set(m);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:i}),n.$set(c)},i(i){r||(k(e.$$.fragment,i),k(n.$$.fragment,i),k(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(n.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),D(e,i),D(n,i),D(a,i)}}}function bn(t){let e,l,n,o;return e=new Be({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),n=new Ut({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),l=B(),N(n.$$.fragment)},l(a){A(e.$$.fragment,a),l=O(a),A(n.$$.fragment,a)},m(a,r){P(e,a,r),b(a,l,r),P(n,a,r),o=!0},p:Se,i(a){o||(k(e.$$.fragment,a),k(n.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(n.$$.fragment,a),o=!1},d(a){a&&p(l),D(e,a),D(n,a)}}}function kn(t){let e,l,n,o,a,r,i,s,m,c,g,_,w;e=new qt({}),e.$on("click",t[10]);let L=t[0].mode!="editing"&&Ye(t);o=new Vt({props:{show:t[3]}});let I=de(t[6].jat[t[1]][t[2]].arms),C=[];for(let f=0;f<I.length;f+=1)C[f]=xe(Qe(t,I,f));const E=f=>j(C[f],1,1,()=>{C[f]=null});let $=de(t[6].jat[t[1]][t[2]].movements),v=[];for(let f=0;f<$.length;f+=1)v[f]=et(Ke(t,$,f));const T=f=>j(v[f],1,1,()=>{v[f]=null});return s=new Xe({props:{data:t[12](t[6]),$$slots:{default:[vn]},$$scope:{ctx:t}}}),c=new Xe({props:{data:t[8],$$slots:{default:[bn]},$$scope:{ctx:t}}}),_=new Ot({props:{map:t[7]}}),{c(){N(e.$$.fragment),l=B(),L&&L.c(),n=B(),N(o.$$.fragment),a=B();for(let f=0;f<C.length;f+=1)C[f].c();r=B();for(let f=0;f<v.length;f+=1)v[f].c();i=B(),N(s.$$.fragment),m=B(),N(c.$$.fragment),g=B(),N(_.$$.fragment)},l(f){A(e.$$.fragment,f),l=O(f),L&&L.l(f),n=O(f),A(o.$$.fragment,f),a=O(f);for(let d=0;d<C.length;d+=1)C[d].l(f);r=O(f);for(let d=0;d<v.length;d+=1)v[d].l(f);i=O(f),A(s.$$.fragment,f),m=O(f),A(c.$$.fragment,f),g=O(f),A(_.$$.fragment,f)},m(f,d){P(e,f,d),b(f,l,d),L&&L.m(f,d),b(f,n,d),P(o,f,d),b(f,a,d);for(let S=0;S<C.length;S+=1)C[S]&&C[S].m(f,d);b(f,r,d);for(let S=0;S<v.length;S+=1)v[S]&&v[S].m(f,d);b(f,i,d),P(s,f,d),b(f,m,d),P(c,f,d),b(f,g,d),P(_,f,d),w=!0},p(f,d){f[0].mode!="editing"?L?(L.p(f,d),d[0]&1&&k(L,1)):(L=Ye(f),L.c(),k(L,1),L.m(n.parentNode,n)):L&&(_e(),j(L,1,1,()=>{L=null}),ge());const S={};if(d[0]&8&&(S.show=f[3]),o.$set(S),d[0]&86){I=de(f[6].jat[f[1]][f[2]].arms);let U;for(U=0;U<I.length;U+=1){const M=Qe(f,I,U);C[U]?(C[U].p(M,d),k(C[U],1)):(C[U]=xe(M),C[U].c(),k(C[U],1),C[U].m(r.parentNode,r))}for(_e(),U=I.length;U<C.length;U+=1)E(U);ge()}if(d[0]&598){$=de(f[6].jat[f[1]][f[2]].movements);let U;for(U=0;U<$.length;U+=1){const M=Ke(f,$,U);v[U]?(v[U].p(M,d),k(v[U],1)):(v[U]=et(M),v[U].c(),k(v[U],1),v[U].m(i.parentNode,i))}for(_e(),U=$.length;U<v.length;U+=1)T(U);ge()}const te={};d[0]&64&&(te.data=f[12](f[6])),d[1]&1024&&(te.$$scope={dirty:d,ctx:f}),s.$set(te);const Y={};d[0]&256&&(Y.data=f[8]),d[1]&1024&&(Y.$$scope={dirty:d,ctx:f}),c.$set(Y);const ne={};d[0]&128&&(ne.map=f[7]),_.$set(ne)},i(f){if(!w){k(e.$$.fragment,f),k(L),k(o.$$.fragment,f);for(let d=0;d<I.length;d+=1)k(C[d]);for(let d=0;d<$.length;d+=1)k(v[d]);k(s.$$.fragment,f),k(c.$$.fragment,f),k(_.$$.fragment,f),w=!0}},o(f){j(e.$$.fragment,f),j(L),j(o.$$.fragment,f),C=C.filter(Boolean);for(let d=0;d<C.length;d+=1)j(C[d]);v=v.filter(Boolean);for(let d=0;d<v.length;d+=1)j(v[d]);j(s.$$.fragment,f),j(c.$$.fragment,f),j(_.$$.fragment,f),w=!1},d(f){f&&(p(l),p(n),p(a),p(r),p(i),p(m),p(g)),D(e,f),L&&L.d(f),D(o,f),ye(C,f),ye(v,f),D(s,f),D(c,f),D(_,f)}}}function wn(t){let e,l,n;function o(r){t[31](r)}let a={$$slots:{default:[kn]},$$scope:{ctx:t}};return t[7]!==void 0&&(a.map=t[7]),e=new Pt({props:a}),ae.push(()=>ue(e,"map",o)),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,i){P(e,r,i),n=!0},p(r,i){const s={};i[0]&511|i[1]&1024&&(s.$$scope={dirty:i,ctx:r}),!l&&i[0]&128&&(l=!0,s.map=r[7],fe(()=>l=!1)),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){D(e,r)}}}function tt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function jn(t){return String.fromCharCode(t+65)}function Cn(t,e,l){let n,o;Ne(t,ee,u=>l(6,o=u));let{junctionIdx:a}=e,{stage:r}=e,{mode:i}=e,{hoveringSidebar:s}=e,{streetviewOn:m}=e,{showRoute:c}=e,{select:g}=e,{stopEditing:_}=e,w,L={0:$e.red.background,1:$e.amber.background,2:$e.green.background,X:$e.critical.background};function I(u,h,K){let re={type:"FeatureCollection",features:[]},G=h.mode=="editing"?h.id:K;return G!=null&&(G.kind=="arm"?re.features.push(tt(u.jat[a][r].arms[G.idx],G.idx)):re.features.push(v(u.jat[a][r].movements[G.idx],G.idx))),re}async function C(u){if(!m){for(let h of w.queryRenderedFeatures(u.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i.mode!="select"){if(i.mode=="editing"){await _();return}i.mode=="new-arm"?(we(ee,o.jat[a][r].arms=[...o.jat[a][r].arms,{point:u.detail.lngLat.toArray(),name:""}],o),await g({kind:"arm",idx:o.jat[a][r].arms.length-1})):(we(ee,o.jat[a][r].movements=[...o.jat[a][r].movements,{point1:u.detail.lngLat.toArray(),point2:Le(u.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Le(u.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await g({kind:"movement",idx:o.jat[a][r].movements.length-1}))}}}async function E(u){await g({kind:"movement",idx:u.detail.features[0].id})}yt(()=>{f(!1)});function $(u){let h={type:"FeatureCollection",features:u.jat[a][r].movements.map((K,re)=>v(K,re))};for(let K of u.jat[a][r].movements)if(h.features.push(T(K,h.features.length)),K.kind=="walking & wheeling"){let re={...K,point1:K.point3,point3:K.point1};h.features.push(T(re,h.features.length))}return h}function v(u,h){return{type:"Feature",id:h,properties:{name:u.name,kind:u.kind,color:L[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2,u.point3]}}}function T(u,h){return{type:"Feature",id:h,properties:{kind:u.kind,color:L[u.score],angle:ke(u.point2,u.point3)},geometry:{type:"Point",coordinates:u.point3}}}function f(u){let h=$(o);for(let K of o.jat[a][r].arms)h.features.push(tt(K,h.features.length));for(let K of o.summary.networkMap.features)h.features.push(K);h.features.length>0&&w.fitBounds(Dt(h),{padding:20,animate:u})}function d(){return w}const S=()=>l(0,i={mode:"new-arm"}),te=()=>l(0,i={mode:"new-movement"});function Y(u,h){t.$$.not_equal(h.point,u)&&(h.point=u,ee.set(o))}const ne=u=>g({kind:"arm",idx:u}),U=u=>g({kind:"arm",idx:u});function M(u,h){t.$$.not_equal(h.point1,u)&&(h.point1=u,ee.set(o))}const x=u=>g({kind:"movement",idx:u}),ce=u=>g({kind:"movement",idx:u});function Z(u,h){t.$$.not_equal(h.point2,u)&&(h.point2=u,ee.set(o))}const H=u=>g({kind:"movement",idx:u}),z=u=>g({kind:"movement",idx:u});function le(u,h){t.$$.not_equal(h.point3,u)&&(h.point3=u,ee.set(o))}const J=u=>g({kind:"movement",idx:u}),ie=u=>g({kind:"movement",idx:u});function y(u){w=u,l(7,w)}return t.$$set=u=>{"junctionIdx"in u&&l(1,a=u.junctionIdx),"stage"in u&&l(2,r=u.stage),"mode"in u&&l(0,i=u.mode),"hoveringSidebar"in u&&l(13,s=u.hoveringSidebar),"streetviewOn"in u&&l(14,m=u.streetviewOn),"showRoute"in u&&l(3,c=u.showRoute),"select"in u&&l(4,g=u.select),"stopEditing"in u&&l(5,_=u.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&8257&&l(8,n=I(o,i,s))},[i,a,r,c,g,_,o,w,n,L,C,E,$,s,m,f,d,S,te,Y,ne,U,M,x,ce,Z,H,z,le,J,ie,y]}class yn extends Ee{constructor(e){super(),Ie(this,e,Cn,wn,je,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showRoute:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Mn(t){let e,l,n,o,a,r,i,s,m,c,g,_;function w(f){t[5](f)}let L={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(L.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new qe({props:L}),ae.push(()=>ue(e,"value",w));function I(f){t[6](f)}let C={label:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(C.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Ze({props:C}),ae.push(()=>ue(o,"value",I));function E(f){t[7](f)}let $={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&($.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),i=new Ze({props:$}),ae.push(()=>ue(i,"value",E));function v(f){t[8](f)}let T={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(T.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),c=new bt({props:T}),ae.push(()=>ue(c,"value",v)),{c(){N(e.$$.fragment),n=B(),N(o.$$.fragment),r=B(),N(i.$$.fragment),m=B(),N(c.$$.fragment)},l(f){A(e.$$.fragment,f),n=O(f),A(o.$$.fragment,f),r=O(f),A(i.$$.fragment,f),m=O(f),A(c.$$.fragment,f)},m(f,d){P(e,f,d),b(f,n,d),P(o,f,d),b(f,r,d),P(i,f,d),b(f,m,d),P(c,f,d),_=!0},p(f,[d]){const S={};!l&&d&15&&(l=!0,S.value=f[3].jat[f[0]][f[1]].movements[f[2]].name,fe(()=>l=!1)),e.$set(S);const te={};!a&&d&15&&(a=!0,te.value=f[3].jat[f[0]][f[1]].movements[f[2]].kind,fe(()=>a=!1)),o.$set(te);const Y={};!s&&d&15&&(s=!0,Y.value=f[3].jat[f[0]][f[1]].movements[f[2]].score,fe(()=>s=!1)),i.$set(Y);const ne={};!g&&d&15&&(g=!0,ne.value=f[3].jat[f[0]][f[1]].movements[f[2]].notes,fe(()=>g=!1)),c.$set(ne)},i(f){_||(k(e.$$.fragment,f),k(o.$$.fragment,f),k(i.$$.fragment,f),k(c.$$.fragment,f),_=!0)},o(f){j(e.$$.fragment,f),j(o.$$.fragment,f),j(i.$$.fragment,f),j(c.$$.fragment,f),_=!1},d(f){f&&(p(n),p(r),p(m)),D(e,f),D(o,f),D(i,f),D(c,f)}}}function Ln(t,e,l){let n;Ne(t,ee,_=>l(3,n=_));let{junctionIdx:o}=e,{stage:a}=e,{idx:r}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){t.$$.not_equal(n.jat[o][a].movements[r].name,_)&&(n.jat[o][a].movements[r].name=_,ee.set(n))}function m(_){t.$$.not_equal(n.jat[o][a].movements[r].kind,_)&&(n.jat[o][a].movements[r].kind=_,ee.set(n))}function c(_){t.$$.not_equal(n.jat[o][a].movements[r].score,_)&&(n.jat[o][a].movements[r].score=_,ee.set(n))}function g(_){t.$$.not_equal(n.jat[o][a].movements[r].notes,_)&&(n.jat[o][a].movements[r].notes=_,ee.set(n))}return t.$$set=_=>{"junctionIdx"in _&&l(0,o=_.junctionIdx),"stage"in _&&l(1,a=_.stage),"idx"in _&&l(2,r=_.idx)},[o,a,r,n,i,s,m,c,g]}class Sn extends Ee{constructor(e){super(),Ie(this,e,Ln,Mn,je,{junctionIdx:0,stage:1,idx:2})}}function pe(t){if(t.movements.length==0)return"No movements added";let e=0,l=0;for(let o of t.movements)e+={0:0,1:1,2:2,X:0}[o.score],l+=2;let n=e/l*100;return`${Math.round(n)}%`}var En=Object.defineProperty,In=(t,e)=>En(t,"name",{value:e,configurable:!0});function Ct(t,e={}){const l=Ft(t),n=(l[0]+l[2])/2,o=(l[1]+l[3])/2;return ht([n,o],e.properties,e)}In(Ct,"center");var Tn=Ct;function Nn(t){let e=Tn({type:"FeatureCollection",features:t.map(n=>({type:"Feature",geometry:{type:"Point",coordinates:n.point},properties:{}}))}).geometry.coordinates;t.sort((n,o)=>nt(ke(e,o.point))-nt(ke(e,n.point)));let l=[];for(let n=0;n<t.length;n++){let o=t[n],a=ke(o.point,e),r=1;for(let i of Pn(n,t.length)){let s=t[i],m=ke(e,s.point),c=An(o.point,e,r++),g=Bt(o.point,e),_=Le(c,.5*g,a).geometry.coordinates,w=Le(_,.2*g,m).geometry.coordinates;l.push({point1:c,point2:_,point3:w,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return l}function An(t,e,l){let n=.003,a=ke(t,e)-90,r=n*l;return Le(t,r,a).geometry.coordinates}function nt(t){return(t+360)%360}function Pn(t,e){let l=[];for(let n=t+1;n<e;n++)l.push(n);for(let n=0;n<t;n++)l.push(n);return l}const{window:Dn}=It;function lt(t,e,l){const n=t.slice();n[34]=e[l],n[37]=l;const o=n[16][n[34].score];return n[35]=o,n}function ot(t,e,l){const n=t.slice();return n[38]=e[l],n[37]=l,n}function Un(t){let e,l,n,o,a,r,i,s;e=new ze({props:{$$slots:{default:[Bn]},$$scope:{ctx:t}}}),e.$on("click",t[11]),n=new Re({props:{$$slots:{default:[On]},$$scope:{ctx:t}}}),n.$on("click",t[12]);const m=[qn,zn],c=[];function g(_,w){return _[2].id.kind=="movement"?0:1}return a=g(t),r=c[a]=m[a](t),{c(){N(e.$$.fragment),l=B(),N(n.$$.fragment),o=B(),r.c(),i=se()},l(_){A(e.$$.fragment,_),l=O(_),A(n.$$.fragment,_),o=O(_),r.l(_),i=se()},m(_,w){P(e,_,w),b(_,l,w),P(n,_,w),b(_,o,w),c[a].m(_,w),b(_,i,w),s=!0},p(_,w){const L={};w[1]&2&&(L.$$scope={dirty:w,ctx:_}),e.$set(L);const I={};w[1]&2&&(I.$$scope={dirty:w,ctx:_}),n.$set(I);let C=a;a=g(_),a===C?c[a].p(_,w):(_e(),j(c[C],1,1,()=>{c[C]=null}),ge(),r=c[a],r?r.p(_,w):(r=c[a]=m[a](_),r.c()),k(r,1),r.m(i.parentNode,i))},i(_){s||(k(e.$$.fragment,_),k(n.$$.fragment,_),k(r),s=!0)},o(_){j(e.$$.fragment,_),j(n.$$.fragment,_),j(r),s=!1},d(_){_&&(p(l),p(o),p(i)),D(e,_),D(n,_),c[a].d(_)}}}function Fn(t){let e,l,n,o,a="Arms",r,i,s,m,c="Movements",g,_,w,L,I,C,E=(t[8].jat[t[0]].name||"Untitled junction")+"",$,v,T=pe(t[8].jat[t[0]][t[1]])+"",f,d,S,te,Y,ne,U;const M=t[18].default,x=_t(M,t,t[32],null);l=new Et({props:{label:"Tools",$$slots:{default:[Vn]},$$scope:{ctx:t}}});let ce=de(t[8].jat[t[0]][t[1]].arms),Z=[];for(let u=0;u<ce.length;u+=1)Z[u]=rt(ot(t,ce,u));const H=u=>j(Z[u],1,1,()=>{Z[u]=null});let z=t[8].jat[t[0]][t[9]].arms.length>0&&at(t);S=new ve({props:{disabled:t[8].jat[t[0]][t[1]].arms.length<2,$$slots:{default:[Wn]},$$scope:{ctx:t}}}),S.$on("click",t[17]);let le=de(t[8].jat[t[0]][t[1]].movements),J=[];for(let u=0;u<le.length;u+=1)J[u]=it(lt(t,le,u));const ie=u=>j(J[u],1,1,()=>{J[u]=null});let y=t[8].jat[t[0]][t[9]].movements.length>0&&st(t);return{c(){x&&x.c(),e=B(),N(l.$$.fragment),n=B(),o=X("h3"),o.textContent=a,r=B();for(let u=0;u<Z.length;u+=1)Z[u].c();i=B(),z&&z.c(),s=B(),m=X("h3"),m.textContent=c,g=B(),_=X("p"),w=q("Total JAT score for "),L=q(t[1]),I=B(),C=X("u"),$=q(E),v=q(`
        : `),f=q(T),d=B(),N(S.$$.fragment),te=B();for(let u=0;u<J.length;u+=1)J[u].c();Y=B(),y&&y.c(),ne=se()},l(u){x&&x.l(u),e=O(u),A(l.$$.fragment,u),n=O(u),o=W(u,"H3",{"data-svelte-h":!0}),Me(o)!=="svelte-ld74qb"&&(o.textContent=a),r=O(u);for(let re=0;re<Z.length;re+=1)Z[re].l(u);i=O(u),z&&z.l(u),s=O(u),m=W(u,"H3",{"data-svelte-h":!0}),Me(m)!=="svelte-1dc52s8"&&(m.textContent=c),g=O(u),_=W(u,"P",{});var h=Q(_);w=R(h,"Total JAT score for "),L=R(h,t[1]),I=O(h),C=W(h,"U",{});var K=Q(C);$=R(K,E),K.forEach(p),v=R(h,`
        : `),f=R(h,T),h.forEach(p),d=O(u),A(S.$$.fragment,u),te=O(u);for(let re=0;re<J.length;re+=1)J[re].l(u);Y=O(u),y&&y.l(u),ne=se()},m(u,h){x&&x.m(u,h),b(u,e,h),P(l,u,h),b(u,n,h),b(u,o,h),b(u,r,h);for(let K=0;K<Z.length;K+=1)Z[K]&&Z[K].m(u,h);b(u,i,h),z&&z.m(u,h),b(u,s,h),b(u,m,h),b(u,g,h),b(u,_,h),F(_,w),F(_,L),F(_,I),F(_,C),F(C,$),F(_,v),F(_,f),b(u,d,h),P(S,u,h),b(u,te,h);for(let K=0;K<J.length;K+=1)J[K]&&J[K].m(u,h);b(u,Y,h),y&&y.m(u,h),b(u,ne,h),U=!0},p(u,h){x&&x.p&&(!U||h[1]&2)&&gt(x,M,u,u[32],U?pt(M,u[32],h,null):dt(u[32]),null);const K={};if(h[0]&112|h[1]&2&&(K.$$scope={dirty:h,ctx:u}),l.$set(K),h[0]&1291){ce=de(u[8].jat[u[0]][u[1]].arms);let G;for(G=0;G<ce.length;G+=1){const Ce=ot(u,ce,G);Z[G]?(Z[G].p(Ce,h),k(Z[G],1)):(Z[G]=rt(Ce),Z[G].c(),k(Z[G],1),Z[G].m(i.parentNode,i))}for(_e(),G=ce.length;G<Z.length;G+=1)H(G);ge()}u[8].jat[u[0]][u[9]].arms.length>0?z?(z.p(u,h),h[0]&257&&k(z,1)):(z=at(u),z.c(),k(z,1),z.m(s.parentNode,s)):z&&(_e(),j(z,1,1,()=>{z=null}),ge()),(!U||h[0]&2)&&me(L,u[1]),(!U||h[0]&257)&&E!==(E=(u[8].jat[u[0]].name||"Untitled junction")+"")&&me($,E),(!U||h[0]&259)&&T!==(T=pe(u[8].jat[u[0]][u[1]])+"")&&me(f,T);const re={};if(h[0]&259&&(re.disabled=u[8].jat[u[0]][u[1]].arms.length<2),h[1]&2&&(re.$$scope={dirty:h,ctx:u}),S.$set(re),h[0]&66827){le=de(u[8].jat[u[0]][u[1]].movements);let G;for(G=0;G<le.length;G+=1){const Ce=lt(u,le,G);J[G]?(J[G].p(Ce,h),k(J[G],1)):(J[G]=it(Ce),J[G].c(),k(J[G],1),J[G].m(Y.parentNode,Y))}for(_e(),G=le.length;G<J.length;G+=1)ie(G);ge()}u[8].jat[u[0]][u[9]].movements.length>0?y?(y.p(u,h),h[0]&257&&k(y,1)):(y=st(u),y.c(),k(y,1),y.m(ne.parentNode,ne)):y&&(_e(),j(y,1,1,()=>{y=null}),ge())},i(u){if(!U){k(x,u),k(l.$$.fragment,u);for(let h=0;h<ce.length;h+=1)k(Z[h]);k(z),k(S.$$.fragment,u);for(let h=0;h<le.length;h+=1)k(J[h]);k(y),U=!0}},o(u){j(x,u),j(l.$$.fragment,u),Z=Z.filter(Boolean);for(let h=0;h<Z.length;h+=1)j(Z[h]);j(z),j(S.$$.fragment,u),J=J.filter(Boolean);for(let h=0;h<J.length;h+=1)j(J[h]);j(y),U=!1},d(u){u&&(p(e),p(n),p(o),p(r),p(i),p(s),p(m),p(g),p(_),p(d),p(te),p(Y),p(ne)),x&&x.d(u),D(l,u),ye(Z,u),z&&z.d(u),D(S,u),ye(J,u),y&&y.d(u)}}}function Bn(t){let e;return{c(){e=q("Save")},l(l){e=R(l,"Save")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function On(t){let e;return{c(){e=q("Delete")},l(l){e=R(l,"Delete")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function zn(t){let e,l,n;function o(r){t[29](r)}let a={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[2].id.idx].name!==void 0&&(a.value=t[8].jat[t[0]][t[1]].arms[t[2].id.idx].name),e=new qe({props:a}),ae.push(()=>ue(e,"value",o)),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,i){P(e,r,i),n=!0},p(r,i){const s={};!l&&i[0]&263&&(l=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,fe(()=>l=!1)),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){D(e,r)}}}function qn(t){let e,l,n,o,a,r;return e=new Sn({props:{junctionIdx:t[0],stage:t[1],idx:t[2].id.idx}}),n=new ze({props:{$$slots:{default:[Rn]},$$scope:{ctx:t}}}),n.$on("click",t[11]),a=new Re({props:{$$slots:{default:[Hn]},$$scope:{ctx:t}}}),a.$on("click",t[12]),{c(){N(e.$$.fragment),l=B(),N(n.$$.fragment),o=B(),N(a.$$.fragment)},l(i){A(e.$$.fragment,i),l=O(i),A(n.$$.fragment,i),o=O(i),A(a.$$.fragment,i)},m(i,s){P(e,i,s),b(i,l,s),P(n,i,s),b(i,o,s),P(a,i,s),r=!0},p(i,s){const m={};s[0]&1&&(m.junctionIdx=i[0]),s[0]&2&&(m.stage=i[1]),s[0]&4&&(m.idx=i[2].id.idx),e.$set(m);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:i}),n.$set(c);const g={};s[1]&2&&(g.$$scope={dirty:s,ctx:i}),a.$set(g)},i(i){r||(k(e.$$.fragment,i),k(n.$$.fragment,i),k(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(n.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),D(e,i),D(n,i),D(a,i)}}}function Rn(t){let e;return{c(){e=q("Save")},l(l){e=R(l,"Save")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function Hn(t){let e;return{c(){e=q("Delete")},l(l){e=R(l,"Delete")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function Gn(t){let e;return{c(){e=q("Zoom to fit")},l(l){e=R(l,"Zoom to fit")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function Jn(t){let e;return{c(){e=q("Show route")},l(l){e=R(l,"Show route")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function Vn(t){var E;let e,l,n,o,a,r,i,s,m,c,g,_;e=new ve({props:{$$slots:{default:[Gn]},$$scope:{ctx:t}}}),e.$on("click",t[20]),n=new Gt({}),a=new Rt({});function w($){t[21]($)}let L={map:(E=t[6])==null?void 0:E.getMap()};t[4]!==void 0&&(L.enabled=t[4]),i=new Ht({props:L}),ae.push(()=>ue(i,"enabled",w));function I($){t[22]($)}let C={$$slots:{default:[Jn]},$$scope:{ctx:t}};return t[5]!==void 0&&(C.checked=t[5]),c=new Jt({props:C}),ae.push(()=>ue(c,"checked",I)),{c(){N(e.$$.fragment),l=B(),N(n.$$.fragment),o=B(),N(a.$$.fragment),r=B(),N(i.$$.fragment),m=B(),N(c.$$.fragment)},l($){A(e.$$.fragment,$),l=O($),A(n.$$.fragment,$),o=O($),A(a.$$.fragment,$),r=O($),A(i.$$.fragment,$),m=O($),A(c.$$.fragment,$)},m($,v){P(e,$,v),b($,l,v),P(n,$,v),b($,o,v),P(a,$,v),b($,r,v),P(i,$,v),b($,m,v),P(c,$,v),_=!0},p($,v){var S;const T={};v[1]&2&&(T.$$scope={dirty:v,ctx:$}),e.$set(T);const f={};v[0]&64&&(f.map=(S=$[6])==null?void 0:S.getMap()),!s&&v[0]&16&&(s=!0,f.enabled=$[4],fe(()=>s=!1)),i.$set(f);const d={};v[1]&2&&(d.$$scope={dirty:v,ctx:$}),!g&&v[0]&32&&(g=!0,d.checked=$[5],fe(()=>g=!1)),c.$set(d)},i($){_||(k(e.$$.fragment,$),k(n.$$.fragment,$),k(a.$$.fragment,$),k(i.$$.fragment,$),k(c.$$.fragment,$),_=!0)},o($){j(e.$$.fragment,$),j(n.$$.fragment,$),j(a.$$.fragment,$),j(i.$$.fragment,$),j(c.$$.fragment,$),_=!1},d($){$&&(p(l),p(o),p(r),p(m)),D(e,$),D(n,$),D(a,$),D(i,$),D(c,$)}}}function rt(t){let e,l;function n(){return t[23](t[37])}function o(){return t[24](t[37])}return e=new He({props:{name:`${ft(t[37])} - ${t[38].name||"Unnamed arm"}`}}),e.$on("click",n),e.$on("mouseenter",o),e.$on("mouseleave",t[25]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,r){P(e,a,r),l=!0},p(a,r){t=a;const i={};r[0]&259&&(i.name=`${ft(t[37])} - ${t[38].name||"Unnamed arm"}`),e.$set(i)},i(a){l||(k(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){D(e,a)}}}function at(t){let e,l;return e=new ve({props:{$$slots:{default:[Xn]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function Xn(t){let e,l;return{c(){e=q("Copy arms from "),l=q(t[9])},l(n){e=R(n,"Copy arms from "),l=R(n,t[9])},m(n,o){b(n,e,o),b(n,l,o)},p:Se,d(n){n&&(p(e),p(l))}}}function Wn(t){let e;return{c(){e=q("Generate cycling movements between all arms")},l(l){e=R(l,"Generate cycling movements between all arms")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function Zn(t){let e,l,n,o=t[34].score+"",a,r,i,s=Ve(t[34].kind)+"",m;return{c(){e=X("div"),l=X("span"),n=q("Score: "),a=q(o),r=B(),i=X("span"),m=q(s),this.h()},l(c){e=W(c,"DIV",{style:!0});var g=Q(e);l=W(g,"SPAN",{style:!0});var _=Q(l);n=R(_,"Score: "),a=R(_,o),_.forEach(p),r=O(g),i=W(g,"SPAN",{});var w=Q(i);m=R(w,s),w.forEach(p),g.forEach(p),this.h()},h(){V(l,"padding","4px"),V(l,"color",t[35].font),V(l,"background-color",t[35].background),V(e,"width","100%"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(c,g){b(c,e,g),F(e,l),F(l,n),F(l,a),F(e,r),F(e,i),F(i,m)},p(c,g){g[0]&259&&o!==(o=c[34].score+"")&&me(a,o),g[0]&259&&V(l,"color",c[35].font),g[0]&259&&V(l,"background-color",c[35].background),g[0]&259&&s!==(s=Ve(c[34].kind)+"")&&me(m,s)},d(c){c&&p(e)}}}function it(t){let e,l;function n(){return t[26](t[37])}function o(){return t[27](t[37])}return e=new He({props:{name:t[34].name||"Unnamed movement",$$slots:{default:[Zn]},$$scope:{ctx:t}}}),e.$on("click",n),e.$on("mouseenter",o),e.$on("mouseleave",t[28]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,r){P(e,a,r),l=!0},p(a,r){t=a;const i={};r[0]&259&&(i.name=t[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(a){l||(k(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){D(e,a)}}}function st(t){let e,l;return e=new ve({props:{$$slots:{default:[Kn]},$$scope:{ctx:t}}}),e.$on("click",t[15]),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function Kn(t){let e,l;return{c(){e=q("Copy movements from "),l=q(t[9])},l(n){e=R(n,"Copy movements from "),l=R(n,t[9])},m(n,o){b(n,e,o),b(n,l,o)},p:Se,d(n){n&&(p(e),p(l))}}}function Qn(t){let e,l,n,o,a,r,i,s=pe(t[8].jat[t[0]].existing)+"",m,c,g,_=pe(t[8].jat[t[0]].proposed)+"",w,L,I,C,E,$,v,T,f,d,S,te,Y;function ne(H){t[19](H)}let U={label:"Commentary / Notes about "+t[1]+" junction"};t[8].jat[t[0]][t[1]].notes!==void 0&&(U.value=t[8].jat[t[0]][t[1]].notes),l=new bt({props:U}),ae.push(()=>ue(l,"value",ne));const M=[Fn,Un],x=[];function ce(H,z){return H[2].mode!="editing"?0:1}$=ce(t),v=x[$]=M[$](t);let Z={junctionIdx:t[0],stage:t[1],mode:t[2],hoveringSidebar:t[3],streetviewOn:t[4],showRoute:t[5],select:t[10],stopEditing:t[11]};return d=new yn({props:Z}),t[31](d),{c(){e=X("div"),N(l.$$.fragment),o=B(),a=X("p"),r=q("Total JAT score: "),i=X("b"),m=q(s),c=q(`
    existing,
    `),g=X("b"),w=q(_),L=q(`
    proposed`),I=B(),C=X("div"),E=X("div"),v.c(),T=B(),f=X("div"),N(d.$$.fragment),this.h()},l(H){e=W(H,"DIV",{class:!0});var z=Q(e);A(l.$$.fragment,z),o=O(z),a=W(z,"P",{});var le=Q(a);r=R(le,"Total JAT score: "),i=W(le,"B",{});var J=Q(i);m=R(J,s),J.forEach(p),c=R(le,`
    existing,
    `),g=W(le,"B",{});var ie=Q(g);w=R(ie,_),ie.forEach(p),L=R(le,`
    proposed`),le.forEach(p),z.forEach(p),I=O(H),C=W(H,"DIV",{style:!0});var y=Q(C);E=W(y,"DIV",{style:!0});var u=Q(E);v.l(u),u.forEach(p),T=O(y),f=W(y,"DIV",{style:!0});var h=Q(f);A(d.$$.fragment,h),h.forEach(p),y.forEach(p),this.h()},h(){oe(e,"class","govuk-width-container"),V(E,"width","30%"),V(E,"overflow-y","scroll"),V(E,"padding","10px"),V(E,"border","1px solid black"),V(f,"position","relative"),V(f,"width","100%"),V(C,"display","flex"),V(C,"height","80vh")},m(H,z){b(H,e,z),P(l,e,null),F(e,o),F(e,a),F(a,r),F(a,i),F(i,m),F(a,c),F(a,g),F(g,w),F(a,L),b(H,I,z),b(H,C,z),F(C,E),x[$].m(E,null),t[30](E),F(C,T),F(C,f),P(d,f,null),S=!0,te||(Y=Lt(Dn,"keydown",t[13]),te=!0)},p(H,z){const le={};z[0]&2&&(le.label="Commentary / Notes about "+H[1]+" junction"),!n&&z[0]&259&&(n=!0,le.value=H[8].jat[H[0]][H[1]].notes,fe(()=>n=!1)),l.$set(le),(!S||z[0]&257)&&s!==(s=pe(H[8].jat[H[0]].existing)+"")&&me(m,s),(!S||z[0]&257)&&_!==(_=pe(H[8].jat[H[0]].proposed)+"")&&me(w,_);let J=$;$=ce(H),$===J?x[$].p(H,z):(_e(),j(x[J],1,1,()=>{x[J]=null}),ge(),v=x[$],v?v.p(H,z):(v=x[$]=M[$](H),v.c()),k(v,1),v.m(E,null));const ie={};z[0]&1&&(ie.junctionIdx=H[0]),z[0]&2&&(ie.stage=H[1]),z[0]&4&&(ie.mode=H[2]),z[0]&8&&(ie.hoveringSidebar=H[3]),z[0]&16&&(ie.streetviewOn=H[4]),z[0]&32&&(ie.showRoute=H[5]),d.$set(ie)},i(H){S||(k(l.$$.fragment,H),k(v),k(d.$$.fragment,H),S=!0)},o(H){j(l.$$.fragment,H),j(v),j(d.$$.fragment,H),S=!1},d(H){H&&(p(e),p(I),p(C)),D(l),x[$].d(),t[30](null),t[31](null),D(d),te=!1,Y()}}}function ft(t){return String.fromCharCode(t+65)}function Yn(t,e,l){let n;Ne(t,ee,y=>l(8,n=y));let{$$slots:o={},$$scope:a}=e,{junctionIdx:r}=e,{stage:i}=e,s=i=="existing"?"proposed":"existing",m={mode:"select"},c=null,g=null,_=!1,w=!0,L=null,I;async function C(y){c=I.scrollTop,l(2,m={mode:"editing",id:y}),l(3,g=null),await Je(),l(7,I.scrollTop=0,I)}async function E(){l(2,m={mode:"select"}),c!=null&&(await Je(),l(7,I.scrollTop=c,I),c=null)}function $(){m.mode=="editing"&&window.confirm(`Delete this ${m.id.kind}?`)&&(m.id.kind=="movement"?(n.jat[r][i].movements.splice(m.id.idx,1),ee.set(n)):(n.jat[r][i].arms.splice(m.id.idx,1),ee.set(n)),E())}function v(y){if(m.mode!="editing")return;let u=y.target.tagName,h=u=="INPUT"||u=="TEXTAREA";y.key=="Escape"||y.key=="Enter"&&!h?(y.stopPropagation(),E()):y.key=="Delete"&&!h&&(y.stopPropagation(),$())}function T(){n.jat[r][i].arms.length>0&&!window.confirm("Overwrite arms?")||(we(ee,n.jat[r][i].arms=JSON.parse(JSON.stringify(n.jat[r][s].arms)),n),ee.set(n))}function f(){n.jat[r][i].movements.length>0&&!window.confirm("Overwrite movements?")||(we(ee,n.jat[r][i].movements=JSON.parse(JSON.stringify(n.jat[r][s].movements)),n),ee.set(n))}let d={0:$e.red,1:$e.amber,2:$e.green,X:$e.critical};function S(){n.jat[r][i].movements.length>0&&!window.confirm("Overwrite all movements?")||we(ee,n.jat[r][i].movements=Nn(n.jat[r][i].arms),n)}function te(y){t.$$.not_equal(n.jat[r][i].notes,y)&&(n.jat[r][i].notes=y,ee.set(n))}const Y=()=>L==null?void 0:L.zoom(!0);function ne(y){_=y,l(4,_)}function U(y){w=y,l(5,w)}const M=y=>C({kind:"arm",idx:y}),x=y=>l(3,g={kind:"arm",idx:y}),ce=()=>l(3,g=null),Z=y=>C({kind:"movement",idx:y}),H=y=>l(3,g={kind:"movement",idx:y}),z=()=>l(3,g=null);function le(y){t.$$.not_equal(n.jat[r][i].arms[m.id.idx].name,y)&&(n.jat[r][i].arms[m.id.idx].name=y,ee.set(n))}function J(y){ae[y?"unshift":"push"](()=>{I=y,l(7,I)})}function ie(y){ae[y?"unshift":"push"](()=>{L=y,l(6,L)})}return t.$$set=y=>{"junctionIdx"in y&&l(0,r=y.junctionIdx),"stage"in y&&l(1,i=y.stage),"$$scope"in y&&l(32,a=y.$$scope)},[r,i,m,g,_,w,L,I,n,s,C,E,$,v,T,f,d,S,o,te,Y,ne,U,M,x,ce,Z,H,z,le,J,ie,a]}class xn extends Ee{constructor(e){super(),Ie(this,e,Yn,Qn,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function ut(t,e,l){const n=t.slice();return n[10]=e[l],n[12]=l,n}function el(t){let e,l,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",o,a,r=t[0].stage+"",i,s,m,c,g,_,w,L=t[0].stage,I,C;m=new St({props:{$$slots:{default:[ol]},$$scope:{ctx:t}}});function E(T){t[7](T)}let $={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&($.value=t[1].jat[t[0].idx].name),g=new qe({props:$}),ae.push(()=>ue(g,"value",E));let v=mt(t);return{c(){e=X("div"),l=X("h2"),o=q(n),a=q(" - "),i=q(r),s=B(),N(m.$$.fragment),c=B(),N(g.$$.fragment),w=B(),v.c(),I=se(),this.h()},l(T){e=W(T,"DIV",{class:!0});var f=Q(e);l=W(f,"H2",{});var d=Q(l);o=R(d,n),a=R(d," - "),i=R(d,r),d.forEach(p),s=O(f),A(m.$$.fragment,f),c=O(f),A(g.$$.fragment,f),f.forEach(p),w=O(T),v.l(T),I=se(),this.h()},h(){oe(e,"class","govuk-width-container")},m(T,f){b(T,e,f),F(e,l),F(l,o),F(l,a),F(l,i),F(e,s),P(m,e,null),F(e,c),P(g,e,null),b(T,w,f),v.m(T,f),b(T,I,f),C=!0},p(T,f){(!C||f&3)&&n!==(n=(T[1].jat[T[0].idx].name||"Untitled junction")+"")&&me(o,n),(!C||f&1)&&r!==(r=T[0].stage+"")&&me(i,r);const d={};f&8193&&(d.$$scope={dirty:f,ctx:T}),m.$set(d);const S={};!_&&f&3&&(_=!0,S.value=T[1].jat[T[0].idx].name,fe(()=>_=!1)),g.$set(S),f&1&&je(L,L=T[0].stage)?(_e(),j(v,1,1,Se),ge(),v=mt(T),v.c(),k(v,1),v.m(I.parentNode,I)):v.p(T,f)},i(T){C||(k(m.$$.fragment,T),k(g.$$.fragment,T),k(v),C=!0)},o(T){j(m.$$.fragment,T),j(g.$$.fragment,T),j(v),C=!1},d(T){T&&(p(e),p(w),p(I)),D(m),D(g),v.d(T)}}}function tl(t){let e,l,n,o;l=new ze({props:{$$slots:{default:[ul]},$$scope:{ctx:t}}}),l.$on("click",t[2]);let a=de(t[1].jat),r=[];for(let s=0;s<a.length;s+=1)r[s]=ct(ut(t,a,s));const i=s=>j(r[s],1,1,()=>{r[s]=null});return{c(){e=X("div"),N(l.$$.fragment),n=B();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var m=Q(e);A(l.$$.fragment,m),n=O(m);for(let c=0;c<r.length;c+=1)r[c].l(m);m.forEach(p),this.h()},h(){oe(e,"class","govuk-width-container")},m(s,m){b(s,e,m),P(l,e,null),F(e,n);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);o=!0},p(s,m){const c={};if(m&8192&&(c.$$scope={dirty:m,ctx:s}),l.$set(c),m&3){a=de(s[1].jat);let g;for(g=0;g<a.length;g+=1){const _=ut(s,a,g);r[g]?(r[g].p(_,m),k(r[g],1)):(r[g]=ct(_),r[g].c(),k(r[g],1),r[g].m(e,null))}for(_e(),g=a.length;g<r.length;g+=1)i(g);ge()}},i(s){if(!o){k(l.$$.fragment,s);for(let m=0;m<a.length;m+=1)k(r[m]);o=!0}},o(s){j(l.$$.fragment,s),r=r.filter(Boolean);for(let m=0;m<r.length;m+=1)j(r[m]);o=!1},d(s){s&&p(e),D(l),ye(r,s)}}}function nl(t){let e;return{c(){e=q("Back to all junctions")},l(l){e=R(l,"Back to all junctions")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function ll(t){let e;return{c(){e=q("Delete junction")},l(l){e=R(l,"Delete junction")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function ol(t){let e,l,n,o;return e=new ve({props:{$$slots:{default:[nl]},$$scope:{ctx:t}}}),e.$on("click",t[5]),n=new Re({props:{$$slots:{default:[ll]},$$scope:{ctx:t}}}),n.$on("click",t[6]),{c(){N(e.$$.fragment),l=B(),N(n.$$.fragment)},l(a){A(e.$$.fragment,a),l=O(a),A(n.$$.fragment,a)},m(a,r){P(e,a,r),b(a,l,r),P(n,a,r),o=!0},p(a,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const s={};r&8192&&(s.$$scope={dirty:r,ctx:a}),n.$set(s)},i(a){o||(k(e.$$.fragment,a),k(n.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(n.$$.fragment,a),o=!1},d(a){a&&p(l),D(e,a),D(n,a)}}}function rl(t){let e,l;return e=new ve({props:{$$slots:{default:[il]},$$scope:{ctx:t}}}),e.$on("click",t[9]),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function al(t){let e,l;return e=new ve({props:{$$slots:{default:[sl]},$$scope:{ctx:t}}}),e.$on("click",t[8]),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function il(t){let e;return{c(){e=q("Edit Proposed")},l(l){e=R(l,"Edit Proposed")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function sl(t){let e;return{c(){e=q("Edit Existing")},l(l){e=R(l,"Edit Existing")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function fl(t){let e,l,n=t[0].stage+"",o,a,r,i=t[1].jat[t[0].idx].name+"",s,m,c,g,_,w;const L=[al,rl],I=[];function C(E,$){return E[0].stage=="proposed"?0:1}return c=C(t),g=I[c]=L[c](t),{c(){e=X("p"),l=q("Currently editing "),o=q(n),a=q(` junction
        `),r=X("u"),s=q(i),m=B(),g.c(),_=se()},l(E){e=W(E,"P",{});var $=Q(e);l=R($,"Currently editing "),o=R($,n),a=R($,` junction
        `),r=W($,"U",{});var v=Q(r);s=R(v,i),v.forEach(p),$.forEach(p),m=O(E),g.l(E),_=se()},m(E,$){b(E,e,$),F(e,l),F(e,o),F(e,a),F(e,r),F(r,s),b(E,m,$),I[c].m(E,$),b(E,_,$),w=!0},p(E,$){(!w||$&1)&&n!==(n=E[0].stage+"")&&me(o,n),(!w||$&3)&&i!==(i=E[1].jat[E[0].idx].name+"")&&me(s,i);let v=c;c=C(E),c===v?I[c].p(E,$):(_e(),j(I[v],1,1,()=>{I[v]=null}),ge(),g=I[c],g?g.p(E,$):(g=I[c]=L[c](E),g.c()),k(g,1),g.m(_.parentNode,_))},i(E){w||(k(g),w=!0)},o(E){j(g),w=!1},d(E){E&&(p(e),p(m),p(_)),I[c].d(E)}}}function mt(t){let e,l;return e=new xn({props:{junctionIdx:t[0].idx,stage:t[0].stage,$$slots:{default:[fl]},$$scope:{ctx:t}}}),{c(){N(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){P(e,n,o),l=!0},p(n,o){const a={};o&1&&(a.junctionIdx=n[0].idx),o&1&&(a.stage=n[0].stage),o&8195&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(k(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){D(e,n)}}}function ul(t){let e;return{c(){e=q("Add new junction")},l(l){e=R(l,"Add new junction")},m(l,n){b(l,e,n)},d(l){l&&p(e)}}}function ml(t){let e,l,n,o=pe(t[10].existing)+"",a,r,i,s,m=pe(t[10].proposed)+"",c,g;return{c(){e=X("div"),l=X("span"),n=q("Existing: "),a=q(o),r=B(),i=X("span"),s=q("Proposed: "),c=q(m),g=B(),this.h()},l(_){e=W(_,"DIV",{style:!0});var w=Q(e);l=W(w,"SPAN",{});var L=Q(l);n=R(L,"Existing: "),a=R(L,o),L.forEach(p),r=O(w),i=W(w,"SPAN",{});var I=Q(i);s=R(I,"Proposed: "),c=R(I,m),I.forEach(p),w.forEach(p),g=O(_),this.h()},h(){V(e,"width","100%"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(_,w){b(_,e,w),F(e,l),F(l,n),F(l,a),F(e,r),F(e,i),F(i,s),F(i,c),b(_,g,w)},p(_,w){w&2&&o!==(o=pe(_[10].existing)+"")&&me(a,o),w&2&&m!==(m=pe(_[10].proposed)+"")&&me(c,m)},d(_){_&&(p(e),p(g))}}}function ct(t){let e,l;function n(){return t[4](t[12])}return e=new He({props:{name:t[10].name||"Untitled junction",$$slots:{default:[ml]},$$scope:{ctx:t}}}),e.$on("click",n),{c(){N(e.$$.fragment)},l(o){A(e.$$.fragment,o)},m(o,a){P(e,o,a),l=!0},p(o,a){t=o;const r={};a&2&&(r.name=t[10].name||"Untitled junction"),a&8194&&(r.$$scope={dirty:a,ctx:t}),e.$set(r)},i(o){l||(k(e.$$.fragment,o),l=!0)},o(o){j(e.$$.fragment,o),l=!1},d(o){D(e,o)}}}function cl(t){let e,l,n,o;const a=[tl,el],r=[];function i(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=i(t))&&(l=r[e]=a[e](t)),{c(){l&&l.c(),n=se()},l(s){l&&l.l(s),n=se()},m(s,m){~e&&r[e].m(s,m),b(s,n,m),o=!0},p(s,[m]){let c=e;e=i(s),e===c?~e&&r[e].p(s,m):(l&&(_e(),j(r[c],1,1,()=>{r[c]=null}),ge()),~e?(l=r[e],l?l.p(s,m):(l=r[e]=a[e](s),l.c()),k(l,1),l.m(n.parentNode,n)):l=null)},i(s){o||(k(l),o=!0)},o(s){j(l),o=!1},d(s){s&&p(n),~e&&r[e].d(s)}}}function Ue(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function _l(t,e,l){let n;Ne(t,ee,w=>l(1,n=w));let o={kind:"list"};function a(){we(ee,n.jat=[...n.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],n),l(0,o={kind:"edit",idx:n.jat.length-1,stage:"existing"})}function r(w){window.confirm("Delete this junction?")&&(n.jat.splice(w,1),ee.set(n),l(0,o={kind:"list"}))}const i=w=>l(0,o={kind:"edit",idx:w,stage:"existing"}),s=()=>l(0,o={kind:"list"}),m=()=>r(Ue(o));function c(w){t.$$.not_equal(n.jat[o.idx].name,w)&&(n.jat[o.idx].name=w,ee.set(n))}return[o,n,a,r,i,s,m,c,()=>l(0,o={kind:"edit",idx:Ue(o),stage:"existing"}),()=>l(0,o={kind:"edit",idx:Ue(o),stage:"proposed"})]}class Ol extends Ee{constructor(e){super(),Ie(this,e,_l,cl,je,{})}}export{Ol as component};
