import{s as pe,e as F,t as H,a as D,c as O,b as U,d as z,f as b,g as S,r as R,y as fe,i as C,h as T,j as oe,q as re,O as Re,C as ke,z as le,B as $e,H as Ue,v as Y,x as Z,k as he,U as ve,N as ue,w as ne,a8 as Ve,E as ye,p as me,n as He}from"../chunks/scheduler.6N1D-Kb4.js";import{S as _e,i as ge,c as A,a as B,m as q,t as w,b as L,d as M,e as Q,g as se,f as ae}from"../chunks/index.D0SxPHfj.js";import{e as te}from"../chunks/each.BSDT5Eol.js";import{p as je}from"../chunks/index.B7AA0aaL.js";import{S as be,W as ze}from"../chunks/WarningButton.t9b5nnFf.js";import{S as ce}from"../chunks/Select.-i-4UYQ_.js";import{T as Fe}from"../chunks/TextArea.1Sgk8XzS.js";import{T as Oe}from"../chunks/TextInput.Rf9dyvs6.js";import{s as j}from"../chunks/data.D9-cysMe.js";import{Y as We}from"../chunks/YesNo.DuM7mQ-i.js";import{D as Ke}from"../chunks/DefaultButton.B7Pfn6zT.js";import{E as Je,v as Ye}from"../chunks/FormElement.DvOxJv-F.js";import{b as Ze,B as Qe,G as Xe,a as xe,M as Ge}from"../chunks/GeoreferenceLayer.C3SQpA5J.js";import{M as et,G as tt}from"../chunks/MapLibreMap.Dwh91KNq.js";import{C as nt}from"../chunks/CircleLayer.DBV89E7T.js";const lt=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Ce(n,t,l){const e=n.slice();return e[10]=t[l][0],e[11]=t[l][1],e}function we(n){let t,l,e,i,u=!1,_,c,f=n[11]+"",h,m,p,g,s,a;return g=Re(n[9][0]),{c(){t=F("div"),l=F("input"),_=D(),c=F("label"),h=H(f),p=D(),this.h()},l(v){t=O(v,"DIV",{class:!0});var k=U(t);l=O(k,"INPUT",{class:!0,id:!0,type:!0}),_=S(k),c=O(k,"LABEL",{class:!0,for:!0});var d=U(c);h=z(d,f),d.forEach(b),p=S(k),k.forEach(b),this.h()},h(){R(l,"class","govuk-radios__input"),R(l,"id",e=n[5]+n[10]),R(l,"type","radio"),l.__value=i=n[10],ke(l,l.__value),R(c,"class","govuk-label govuk-radios__label"),R(c,"for",m=n[5]+n[10]),R(t,"class","govuk-radios__item"),g.p(l)},m(v,k){C(v,t,k),T(t,l),l.checked=l.__value===n[0],T(t,_),T(t,c),T(c,h),T(t,p),s||(a=[le(l,"change",n[8]),le(l,"change",n[7])],s=!0)},p(v,k){k&4&&e!==(e=v[5]+v[10])&&R(l,"id",e),k&4&&i!==(i=v[10])&&(l.__value=i,ke(l,l.__value),u=!0),(u||k&5)&&(l.checked=l.__value===v[0]),k&4&&f!==(f=v[11]+"")&&oe(h,f),k&4&&m!==(m=v[5]+v[10])&&R(c,"for",m)},d(v){v&&b(t),g.r(),s=!1,$e(a)}}}function it(n){let t,l,e,i,u,_,c,f,h;_=new Je({props:{errorMessage:n[4]}});let m=te(n[2]),p=[];for(let g=0;g<m.length;g+=1)p[g]=we(Ce(n,m,g));return{c(){t=F("div"),l=F("fieldset"),e=F("legend"),i=H(n[1]),u=D(),A(_.$$.fragment),c=D(),f=F("div");for(let g=0;g<p.length;g+=1)p[g].c();this.h()},l(g){t=O(g,"DIV",{class:!0});var s=U(t);l=O(s,"FIELDSET",{class:!0});var a=U(l);e=O(a,"LEGEND",{class:!0});var v=U(e);i=z(v,n[1]),v.forEach(b),u=S(a),B(_.$$.fragment,a),c=S(a),f=O(a,"DIV",{class:!0,"data-module":!0});var k=U(f);for(let d=0;d<p.length;d+=1)p[d].l(k);k.forEach(b),a.forEach(b),s.forEach(b),this.h()},h(){R(e,"class","govuk-fieldset__legend govuk-label--s"),R(f,"class","govuk-radios"),R(f,"data-module","govuk-radios"),fe(f,"govuk-radios--inline",n[3]),fe(f,"govuk-radios--small",n[3]),R(l,"class","govuk-fieldset"),R(t,"class","govuk-form-group")},m(g,s){C(g,t,s),T(t,l),T(l,e),T(e,i),T(l,u),q(_,l,null),T(l,c),T(l,f);for(let a=0;a<p.length;a+=1)p[a]&&p[a].m(f,null);h=!0},p(g,[s]){(!h||s&2)&&oe(i,g[1]);const a={};if(s&16&&(a.errorMessage=g[4]),_.$set(a),s&37){m=te(g[2]);let v;for(v=0;v<m.length;v+=1){const k=Ce(g,m,v);p[v]?p[v].p(k,s):(p[v]=we(k),p[v].c(),p[v].m(f,null))}for(;v<p.length;v+=1)p[v].d(1);p.length=m.length}(!h||s&8)&&fe(f,"govuk-radios--inline",g[3]),(!h||s&8)&&fe(f,"govuk-radios--small",g[3])},i(g){h||(w(_.$$.fragment,g),h=!0)},o(g){L(_.$$.fragment,g),h=!1},d(g){g&&b(t),M(_),re(p,g)}}}function ot(n,t,l){let e,{legend:i}=t,{choices:u}=t,{inlineSmall:_=!1}=t,{required:c=!1}=t,{value:f}=t,h=Ye();const m=[[]];function p(s){Ue.call(this,n,s)}function g(){f=this.__value,l(0,f)}return n.$$set=s=>{"legend"in s&&l(1,i=s.legend),"choices"in s&&l(2,u=s.choices),"inlineSmall"in s&&l(3,_=s.inlineSmall),"required"in s&&l(6,c=s.required),"value"in s&&l(0,f=s.value)},n.$$.update=()=>{n.$$.dirty&65&&l(4,e=c&&f==""?"Required":"")},[f,i,u,_,e,h,c,p,g,m]}class st extends _e{constructor(t){super(),ge(this,t,ot,it,pe,{legend:1,choices:2,inlineSmall:3,required:6,value:0})}}function Le(n){let t,l;return t=new be({props:{$$slots:{default:[at]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){A(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const u={};i&2050&&(u.$$scope={dirty:i,ctx:e}),t.$set(u)},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function at(n){let t,l;return{c(){t=H("Use lookup: "),l=H(n[1])},l(e){t=z(e,"Use lookup: "),l=z(e,n[1])},m(e,i){C(e,t,i),C(e,l,i)},p(e,i){i&2&&oe(l,e[1])},d(e){e&&(b(t),b(l))}}}function rt(n){let t,l,e,i,u,_,c,f,h,m,p,g,s,a,v,k;function d(o){n[5](o)}let I={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(I.value=n[2].criticalIssues[n[0]].criticalIssue),t=new ce({props:I}),Y.push(()=>Q(t,"value",d));function V(o){n[6](o)}let G={label:"Stage",emptyOption:!0,choices:je(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(G.value=n[2].criticalIssues[n[0]].stage),i=new ce({props:G}),Y.push(()=>Q(i,"value",V));function X(o){n[7](o)}let x={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(x.value=n[2].criticalIssues[n[0]].locationName),c=new Oe({props:x}),Y.push(()=>Q(c,"value",X));let y=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&Le(n);function ie(o){n[8](o)}let K={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(K.value=n[2].criticalIssues[n[0]].resolved),p=new We({props:K}),Y.push(()=>Q(p,"value",ie));function P(o){n[9](o)}let J={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(J.value=n[2].criticalIssues[n[0]].notes),a=new Fe({props:J}),Y.push(()=>Q(a,"value",P)),{c(){A(t.$$.fragment),e=D(),A(i.$$.fragment),_=D(),A(c.$$.fragment),h=D(),y&&y.c(),m=D(),A(p.$$.fragment),s=D(),A(a.$$.fragment)},l(o){B(t.$$.fragment,o),e=S(o),B(i.$$.fragment,o),_=S(o),B(c.$$.fragment,o),h=S(o),y&&y.l(o),m=S(o),B(p.$$.fragment,o),s=S(o),B(a.$$.fragment,o)},m(o,r){q(t,o,r),C(o,e,r),q(i,o,r),C(o,_,r),q(c,o,r),C(o,h,r),y&&y.m(o,r),C(o,m,r),q(p,o,r),C(o,s,r),q(a,o,r),k=!0},p(o,[r]){const $={};!l&&r&5&&(l=!0,$.value=o[2].criticalIssues[o[0]].criticalIssue,Z(()=>l=!1)),t.$set($);const E={};!u&&r&5&&(u=!0,E.value=o[2].criticalIssues[o[0]].stage,Z(()=>u=!1)),i.$set(E);const W={};!f&&r&5&&(f=!0,W.value=o[2].criticalIssues[o[0]].locationName,Z(()=>f=!1)),c.$set(W),o[1]&&o[1]!="Loading"&&o[1]!=o[2].criticalIssues[o[0]].locationName?y?(y.p(o,r),r&7&&w(y,1)):(y=Le(o),y.c(),w(y,1),y.m(m.parentNode,m)):y&&(se(),L(y,1,1,()=>{y=null}),ae());const N={};!g&&r&5&&(g=!0,N.value=o[2].criticalIssues[o[0]].resolved,Z(()=>g=!1)),p.$set(N);const ee={};!v&&r&5&&(v=!0,ee.value=o[2].criticalIssues[o[0]].notes,Z(()=>v=!1)),a.$set(ee)},i(o){k||(w(t.$$.fragment,o),w(i.$$.fragment,o),w(c.$$.fragment,o),w(y),w(p.$$.fragment,o),w(a.$$.fragment,o),k=!0)},o(o){L(t.$$.fragment,o),L(i.$$.fragment,o),L(c.$$.fragment,o),L(y),L(p.$$.fragment,o),L(a.$$.fragment,o),k=!1},d(o){o&&(b(e),b(_),b(h),b(m),b(s)),M(t,o),M(i,o),M(c,o),y&&y.d(o),M(p,o),M(a,o)}}}function ft(n,t,l){let e;he(n,j,a=>l(2,e=a));let{idx:i}=t,u=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],_="Loading";ve(async()=>{await c(e.criticalIssues[i].point)});async function c(a){let v=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let d=await(await fetch(v)).json();l(1,_=d.address.road??d.display_name)}catch(k){return console.log(`Location lookup failed: ${k}`),""}}function f(){ue(j,e.criticalIssues[i].locationName=_,e)}function h(a){n.$$.not_equal(e.criticalIssues[i].criticalIssue,a)&&(e.criticalIssues[i].criticalIssue=a,j.set(e))}function m(a){n.$$.not_equal(e.criticalIssues[i].stage,a)&&(e.criticalIssues[i].stage=a,j.set(e))}function p(a){n.$$.not_equal(e.criticalIssues[i].locationName,a)&&(e.criticalIssues[i].locationName=a,j.set(e))}function g(a){n.$$.not_equal(e.criticalIssues[i].resolved,a)&&(e.criticalIssues[i].resolved=a,j.set(e))}function s(a){n.$$.not_equal(e.criticalIssues[i].notes,a)&&(e.criticalIssues[i].notes=a,j.set(e))}return n.$$set=a=>{"idx"in a&&l(0,i=a.idx)},[i,_,e,u,f,h,m,p,g,s]}class ut extends _e{constructor(t){super(),ge(this,t,ft,rt,pe,{idx:0})}}function Ie(n){let t,l;return t=new be({props:{$$slots:{default:[ct]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){A(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const u={};i&2050&&(u.$$scope={dirty:i,ctx:e}),t.$set(u)},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function ct(n){let t,l;return{c(){t=H("Use lookup: "),l=H(n[1])},l(e){t=z(e,"Use lookup: "),l=z(e,n[1])},m(e,i){C(e,t,i),C(e,l,i)},p(e,i){i&2&&oe(l,e[1])},d(e){e&&(b(t),b(l))}}}function pt(n){let t,l,e,i,u,_,c,f,h,m,p,g,s,a,v,k;function d(o){n[5](o)}let I={label:"Policy Conflict",emptyOption:!0,choices:n[3]};n[2].policyConflictLog[n[0]].conflict!==void 0&&(I.value=n[2].policyConflictLog[n[0]].conflict),t=new ce({props:I}),Y.push(()=>Q(t,"value",d));function V(o){n[6](o)}let G={label:"Stage",emptyOption:!0,choices:je(["Existing","Design"])};n[2].policyConflictLog[n[0]].stage!==void 0&&(G.value=n[2].policyConflictLog[n[0]].stage),i=new ce({props:G}),Y.push(()=>Q(i,"value",V));function X(o){n[7](o)}let x={label:"Location Name"};n[2].policyConflictLog[n[0]].locationName!==void 0&&(x.value=n[2].policyConflictLog[n[0]].locationName),c=new Oe({props:x}),Y.push(()=>Q(c,"value",X));let y=n[1]&&n[1]!="Loading"&&n[1]!=n[2].policyConflictLog[n[0]].locationName&&Ie(n);function ie(o){n[8](o)}let K={label:"Resolved by Design"};n[2].policyConflictLog[n[0]].resolved!==void 0&&(K.value=n[2].policyConflictLog[n[0]].resolved),p=new We({props:K}),Y.push(()=>Q(p,"value",ie));function P(o){n[9](o)}let J={label:"Commentary & Feedback"};return n[2].policyConflictLog[n[0]].notes!==void 0&&(J.value=n[2].policyConflictLog[n[0]].notes),a=new Fe({props:J}),Y.push(()=>Q(a,"value",P)),{c(){A(t.$$.fragment),e=D(),A(i.$$.fragment),_=D(),A(c.$$.fragment),h=D(),y&&y.c(),m=D(),A(p.$$.fragment),s=D(),A(a.$$.fragment)},l(o){B(t.$$.fragment,o),e=S(o),B(i.$$.fragment,o),_=S(o),B(c.$$.fragment,o),h=S(o),y&&y.l(o),m=S(o),B(p.$$.fragment,o),s=S(o),B(a.$$.fragment,o)},m(o,r){q(t,o,r),C(o,e,r),q(i,o,r),C(o,_,r),q(c,o,r),C(o,h,r),y&&y.m(o,r),C(o,m,r),q(p,o,r),C(o,s,r),q(a,o,r),k=!0},p(o,[r]){const $={};!l&&r&5&&(l=!0,$.value=o[2].policyConflictLog[o[0]].conflict,Z(()=>l=!1)),t.$set($);const E={};!u&&r&5&&(u=!0,E.value=o[2].policyConflictLog[o[0]].stage,Z(()=>u=!1)),i.$set(E);const W={};!f&&r&5&&(f=!0,W.value=o[2].policyConflictLog[o[0]].locationName,Z(()=>f=!1)),c.$set(W),o[1]&&o[1]!="Loading"&&o[1]!=o[2].policyConflictLog[o[0]].locationName?y?(y.p(o,r),r&7&&w(y,1)):(y=Ie(o),y.c(),w(y,1),y.m(m.parentNode,m)):y&&(se(),L(y,1,1,()=>{y=null}),ae());const N={};!g&&r&5&&(g=!0,N.value=o[2].policyConflictLog[o[0]].resolved,Z(()=>g=!1)),p.$set(N);const ee={};!v&&r&5&&(v=!0,ee.value=o[2].policyConflictLog[o[0]].notes,Z(()=>v=!1)),a.$set(ee)},i(o){k||(w(t.$$.fragment,o),w(i.$$.fragment,o),w(c.$$.fragment,o),w(y),w(p.$$.fragment,o),w(a.$$.fragment,o),k=!0)},o(o){L(t.$$.fragment,o),L(i.$$.fragment,o),L(c.$$.fragment,o),L(y),L(p.$$.fragment,o),L(a.$$.fragment,o),k=!1},d(o){o&&(b(e),b(_),b(h),b(m),b(s)),M(t,o),M(i,o),M(c,o),y&&y.d(o),M(p,o),M(a,o)}}}function _t(n,t,l){let e;he(n,j,a=>l(2,e=a));let{idx:i}=t,u=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]],_="Loading";ve(async()=>{await c(e.policyConflictLog[i].point)});async function c(a){let v=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let d=await(await fetch(v)).json();l(1,_=d.address.road??d.display_name)}catch(k){return console.log(`Location lookup failed: ${k}`),""}}function f(){ue(j,e.policyConflictLog[i].locationName=_,e)}function h(a){n.$$.not_equal(e.policyConflictLog[i].conflict,a)&&(e.policyConflictLog[i].conflict=a,j.set(e))}function m(a){n.$$.not_equal(e.policyConflictLog[i].stage,a)&&(e.policyConflictLog[i].stage=a,j.set(e))}function p(a){n.$$.not_equal(e.policyConflictLog[i].locationName,a)&&(e.policyConflictLog[i].locationName=a,j.set(e))}function g(a){n.$$.not_equal(e.policyConflictLog[i].resolved,a)&&(e.policyConflictLog[i].resolved=a,j.set(e))}function s(a){n.$$.not_equal(e.policyConflictLog[i].notes,a)&&(e.policyConflictLog[i].notes=a,j.set(e))}return n.$$set=a=>{"idx"in a&&l(0,i=a.idx)},[i,_,e,u,f,h,m,p,g,s]}class gt extends _e{constructor(t){super(),ge(this,t,_t,pt,pe,{idx:0})}}const{window:mt}=lt;function Ne(n,t,l){const e=n.slice();return e[27]=t[l],e[28]=t,e[29]=l,e}function Ee(n,t,l){const e=n.slice();return e[30]=t[l],e[31]=t,e[29]=l,e}function De(n,t,l){const e=n.slice();return e[27]=t[l],e[29]=l,e}function Se(n,t,l){const e=n.slice();return e[30]=t[l],e[29]=l,e}function dt(n){let t,l,e,i,u,_,c,f;t=new Ke({props:{$$slots:{default:[ht]},$$scope:{ctx:n}}}),t.$on("click",n[18]),e=new ze({props:{$$slots:{default:[vt]},$$scope:{ctx:n}}}),e.$on("click",n[7]);const h=[kt,bt],m=[];function p(g,s){return g[0].kind=="critical"?0:1}return u=p(n),_=m[u]=h[u](n),{c(){A(t.$$.fragment),l=D(),A(e.$$.fragment),i=D(),_.c(),c=ye()},l(g){B(t.$$.fragment,g),l=S(g),B(e.$$.fragment,g),i=S(g),_.l(g),c=ye()},m(g,s){q(t,g,s),C(g,l,s),q(e,g,s),C(g,i,s),m[u].m(g,s),C(g,c,s),f=!0},p(g,s){const a={};s[1]&8&&(a.$$scope={dirty:s,ctx:g}),t.$set(a);const v={};s[1]&8&&(v.$$scope={dirty:s,ctx:g}),e.$set(v);let k=u;u=p(g),u===k?m[u].p(g,s):(se(),L(m[k],1,1,()=>{m[k]=null}),ae(),_=m[u],_?_.p(g,s):(_=m[u]=h[u](g),_.c()),w(_,1),_.m(c.parentNode,c))},i(g){f||(w(t.$$.fragment,g),w(e.$$.fragment,g),w(_),f=!0)},o(g){L(t.$$.fragment,g),L(e.$$.fragment,g),L(_),f=!1},d(g){g&&(b(l),b(i),b(c)),M(t,g),M(e,g),m[u].d(g)}}}function $t(n){let t,l,e,i,u,_,c,f,h,m,p="Click the map to add a pin, or select a pin to fill out data",g,s,a="Critical Issues",v,k,d,I,V="Policy Conflicts",G,X,x;t=new be({props:{$$slots:{default:[yt]},$$scope:{ctx:n}}}),t.$on("click",n[10]),e=new Qe({}),u=new Xe({});function y(r){n[11](r)}let ie={legend:"Create new pins",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};n[4]!==void 0&&(ie.value=n[4]),c=new st({props:ie}),Y.push(()=>Q(c,"value",y));let K=te(n[2].criticalIssues),P=[];for(let r=0;r<K.length;r+=1)P[r]=Ae(Se(n,K,r));let J=te(n[2].policyConflictLog),o=[];for(let r=0;r<J.length;r+=1)o[r]=Be(De(n,J,r));return{c(){A(t.$$.fragment),l=D(),A(e.$$.fragment),i=D(),A(u.$$.fragment),_=D(),A(c.$$.fragment),h=D(),m=F("p"),m.textContent=p,g=D(),s=F("h3"),s.textContent=a,v=D(),k=F("ol");for(let r=0;r<P.length;r+=1)P[r].c();d=D(),I=F("h3"),I.textContent=V,G=D(),X=F("ol");for(let r=0;r<o.length;r+=1)o[r].c()},l(r){B(t.$$.fragment,r),l=S(r),B(e.$$.fragment,r),i=S(r),B(u.$$.fragment,r),_=S(r),B(c.$$.fragment,r),h=S(r),m=O(r,"P",{"data-svelte-h":!0}),me(m)!=="svelte-sv95ee"&&(m.textContent=p),g=S(r),s=O(r,"H3",{"data-svelte-h":!0}),me(s)!=="svelte-1qhh5xr"&&(s.textContent=a),v=S(r),k=O(r,"OL",{});var $=U(k);for(let W=0;W<P.length;W+=1)P[W].l($);$.forEach(b),d=S(r),I=O(r,"H3",{"data-svelte-h":!0}),me(I)!=="svelte-eyxzjx"&&(I.textContent=V),G=S(r),X=O(r,"OL",{});var E=U(X);for(let W=0;W<o.length;W+=1)o[W].l(E);E.forEach(b)},m(r,$){q(t,r,$),C(r,l,$),q(e,r,$),C(r,i,$),q(u,r,$),C(r,_,$),q(c,r,$),C(r,h,$),C(r,m,$),C(r,g,$),C(r,s,$),C(r,v,$),C(r,k,$);for(let E=0;E<P.length;E+=1)P[E]&&P[E].m(k,null);C(r,d,$),C(r,I,$),C(r,G,$),C(r,X,$);for(let E=0;E<o.length;E+=1)o[E]&&o[E].m(X,null);x=!0},p(r,$){const E={};$[1]&8&&(E.$$scope={dirty:$,ctx:r}),t.$set(E);const W={};if(!f&&$[0]&16&&(f=!0,W.value=r[4],Z(()=>f=!1)),c.$set(W),$[0]&70){K=te(r[2].criticalIssues);let N;for(N=0;N<K.length;N+=1){const ee=Se(r,K,N);P[N]?P[N].p(ee,$):(P[N]=Ae(ee),P[N].c(),P[N].m(k,null))}for(;N<P.length;N+=1)P[N].d(1);P.length=K.length}if($[0]&70){J=te(r[2].policyConflictLog);let N;for(N=0;N<J.length;N+=1){const ee=De(r,J,N);o[N]?o[N].p(ee,$):(o[N]=Be(ee),o[N].c(),o[N].m(X,null))}for(;N<o.length;N+=1)o[N].d(1);o.length=J.length}},i(r){x||(w(t.$$.fragment,r),w(e.$$.fragment,r),w(u.$$.fragment,r),w(c.$$.fragment,r),x=!0)},o(r){L(t.$$.fragment,r),L(e.$$.fragment,r),L(u.$$.fragment,r),L(c.$$.fragment,r),x=!1},d(r){r&&(b(l),b(i),b(_),b(h),b(m),b(g),b(s),b(v),b(k),b(d),b(I),b(G),b(X)),M(t,r),M(e,r),M(u,r),M(c,r),re(P,r),re(o,r)}}}function ht(n){let t;return{c(){t=H("Save")},l(l){t=z(l,"Save")},m(l,e){C(l,t,e)},d(l){l&&b(t)}}}function vt(n){let t;return{c(){t=H("Delete")},l(l){t=z(l,"Delete")},m(l,e){C(l,t,e)},d(l){l&&b(t)}}}function bt(n){let t,l;return t=new gt({props:{idx:n[0].idx}}),{c(){A(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const u={};i[0]&1&&(u.idx=e[0].idx),t.$set(u)},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function kt(n){let t,l;return t=new ut({props:{idx:n[0].idx}}),{c(){A(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const u={};i[0]&1&&(u.idx=e[0].idx),t.$set(u)},i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function yt(n){let t;return{c(){t=H("Zoom to fit")},l(l){t=z(l,"Zoom to fit")},m(l,e){C(l,t,e)},d(l){l&&b(t)}}}function Ae(n){let t,l,e=Te(n[30])+"",i,u,_,c;function f(){return n[12](n[29])}function h(){return n[13](n[29])}return{c(){t=F("li"),l=F("a"),i=H(e),u=D(),this.h()},l(m){t=O(m,"LI",{});var p=U(t);l=O(p,"A",{href:!0});var g=U(l);i=z(g,e),g.forEach(b),u=S(p),p.forEach(b),this.h()},h(){R(l,"href","#")},m(m,p){C(m,t,p),T(t,l),T(l,i),T(t,u),_||(c=[le(l,"click",f),le(l,"mouseenter",h),le(l,"mouseleave",n[14])],_=!0)},p(m,p){n=m,p[0]&4&&e!==(e=Te(n[30])+"")&&oe(i,e)},d(m){m&&b(t),_=!1,$e(c)}}}function Be(n){let t,l,e=Pe(n[27])+"",i,u,_,c;function f(){return n[15](n[29])}function h(){return n[16](n[29])}return{c(){t=F("li"),l=F("a"),i=H(e),u=D(),this.h()},l(m){t=O(m,"LI",{});var p=U(t);l=O(p,"A",{href:!0});var g=U(l);i=z(g,e),g.forEach(b),u=S(p),p.forEach(b),this.h()},h(){R(l,"href","#")},m(m,p){C(m,t,p),T(t,l),T(l,i),T(t,u),_||(c=[le(l,"click",f),le(l,"mouseenter",h),le(l,"mouseleave",n[17])],_=!0)},p(m,p){n=m,p[0]&4&&e!==(e=Pe(n[27])+"")&&oe(i,e)},d(m){m&&b(t),_=!1,$e(c)}}}function Ct(n){let t,l,e=n[30].criticalIssue+"",i;return{c(){t=F("span"),l=H("C"),i=H(e),this.h()},l(u){t=O(u,"SPAN",{class:!0});var _=U(t);l=z(_,"C"),i=z(_,e),_.forEach(b),this.h()},h(){R(t,"class","dot svelte-zal0eh"),ne(t,"background","black")},m(u,_){C(u,t,_),T(t,l),T(t,i)},p(u,_){_[0]&4&&e!==(e=u[30].criticalIssue+"")&&oe(i,e)},d(u){u&&b(t)}}}function qe(n){let t,l,e;function i(f){n[19](f,n[30])}function u(){return n[20](n[29])}function _(){return n[21](n[29])}let c={draggable:!0,$$slots:{default:[Ct]},$$scope:{ctx:n}};return n[30].point!==void 0&&(c.lngLat=n[30].point),t=new Ge({props:c}),Y.push(()=>Q(t,"lngLat",i)),t.$on("click",u),t.$on("dragend",_),{c(){A(t.$$.fragment)},l(f){B(t.$$.fragment,f)},m(f,h){q(t,f,h),e=!0},p(f,h){n=f;const m={};h[0]&4|h[1]&8&&(m.$$scope={dirty:h,ctx:n}),!l&&h[0]&4&&(l=!0,m.lngLat=n[30].point,Z(()=>l=!1)),t.$set(m)},i(f){e||(w(t.$$.fragment,f),e=!0)},o(f){L(t.$$.fragment,f),e=!1},d(f){M(t,f)}}}function wt(n){let t,l,e=n[27].conflict+"",i;return{c(){t=F("span"),l=H("P"),i=H(e),this.h()},l(u){t=O(u,"SPAN",{class:!0});var _=U(t);l=z(_,"P"),i=z(_,e),_.forEach(b),this.h()},h(){R(t,"class","dot svelte-zal0eh"),ne(t,"background","blue")},m(u,_){C(u,t,_),T(t,l),T(t,i)},p(u,_){_[0]&4&&e!==(e=u[27].conflict+"")&&oe(i,e)},d(u){u&&b(t)}}}function Me(n){let t,l,e;function i(f){n[22](f,n[27])}function u(){return n[23](n[29])}function _(){return n[24](n[29])}let c={draggable:!0,$$slots:{default:[wt]},$$scope:{ctx:n}};return n[27].point!==void 0&&(c.lngLat=n[27].point),t=new Ge({props:c}),Y.push(()=>Q(t,"lngLat",i)),t.$on("click",u),t.$on("dragend",_),{c(){A(t.$$.fragment)},l(f){B(t.$$.fragment,f)},m(f,h){q(t,f,h),e=!0},p(f,h){n=f;const m={};h[0]&4|h[1]&8&&(m.$$scope={dirty:h,ctx:n}),!l&&h[0]&4&&(l=!0,m.lngLat=n[27].point,Z(()=>l=!1)),t.$set(m)},i(f){e||(w(t.$$.fragment,f),e=!0)},o(f){L(t.$$.fragment,f),e=!1},d(f){M(t,f)}}}function Lt(n){let t,l;return t=new nt({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){A(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p:He,i(e){l||(w(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function It(n){let t,l,e,i,u,_,c=te(n[2].criticalIssues),f=[];for(let s=0;s<c.length;s+=1)f[s]=qe(Ee(n,c,s));const h=s=>L(f[s],1,1,()=>{f[s]=null});let m=te(n[2].policyConflictLog),p=[];for(let s=0;s<m.length;s+=1)p[s]=Me(Ne(n,m,s));const g=s=>L(p[s],1,1,()=>{p[s]=null});return e=new tt({props:{data:n[5],$$slots:{default:[Lt]},$$scope:{ctx:n}}}),u=new xe({props:{map:n[3]}}),{c(){for(let s=0;s<f.length;s+=1)f[s].c();t=D();for(let s=0;s<p.length;s+=1)p[s].c();l=D(),A(e.$$.fragment),i=D(),A(u.$$.fragment)},l(s){for(let a=0;a<f.length;a+=1)f[a].l(s);t=S(s);for(let a=0;a<p.length;a+=1)p[a].l(s);l=S(s),B(e.$$.fragment,s),i=S(s),B(u.$$.fragment,s)},m(s,a){for(let v=0;v<f.length;v+=1)f[v]&&f[v].m(s,a);C(s,t,a);for(let v=0;v<p.length;v+=1)p[v]&&p[v].m(s,a);C(s,l,a),q(e,s,a),C(s,i,a),q(u,s,a),_=!0},p(s,a){if(a[0]&68){c=te(s[2].criticalIssues);let d;for(d=0;d<c.length;d+=1){const I=Ee(s,c,d);f[d]?(f[d].p(I,a),w(f[d],1)):(f[d]=qe(I),f[d].c(),w(f[d],1),f[d].m(t.parentNode,t))}for(se(),d=c.length;d<f.length;d+=1)h(d);ae()}if(a[0]&68){m=te(s[2].policyConflictLog);let d;for(d=0;d<m.length;d+=1){const I=Ne(s,m,d);p[d]?(p[d].p(I,a),w(p[d],1)):(p[d]=Me(I),p[d].c(),w(p[d],1),p[d].m(l.parentNode,l))}for(se(),d=m.length;d<p.length;d+=1)g(d);ae()}const v={};a[0]&32&&(v.data=s[5]),a[1]&8&&(v.$$scope={dirty:a,ctx:s}),e.$set(v);const k={};a[0]&8&&(k.map=s[3]),u.$set(k)},i(s){if(!_){for(let a=0;a<c.length;a+=1)w(f[a]);for(let a=0;a<m.length;a+=1)w(p[a]);w(e.$$.fragment,s),w(u.$$.fragment,s),_=!0}},o(s){f=f.filter(Boolean);for(let a=0;a<f.length;a+=1)L(f[a]);p=p.filter(Boolean);for(let a=0;a<p.length;a+=1)L(p[a]);L(e.$$.fragment,s),L(u.$$.fragment,s),_=!1},d(s){s&&(b(t),b(l),b(i)),re(f,s),re(p,s),M(e,s),M(u,s)}}}function Nt(n){let t,l,e,i,u,_,c,f,h,m,p;const g=[$t,dt],s=[];function a(d,I){return d[0]==null?0:1}e=a(n),i=s[e]=g[e](n);function v(d){n[25](d)}let k={$$slots:{default:[It]},$$scope:{ctx:n}};return n[3]!==void 0&&(k.map=n[3]),c=new et({props:k}),Y.push(()=>Q(c,"map",v)),{c(){t=F("div"),l=F("div"),i.c(),u=D(),_=F("div"),A(c.$$.fragment),this.h()},l(d){t=O(d,"DIV",{style:!0});var I=U(t);l=O(I,"DIV",{style:!0});var V=U(l);i.l(V),V.forEach(b),u=S(I),_=O(I,"DIV",{style:!0});var G=U(_);B(c.$$.fragment,G),G.forEach(b),I.forEach(b),this.h()},h(){ne(l,"width","30%"),ne(l,"overflow-y","scroll"),ne(l,"padding","10px"),ne(_,"position","relative"),ne(_,"width","70%"),ne(t,"display","flex"),ne(t,"height","600px")},m(d,I){C(d,t,I),T(t,l),s[e].m(l,null),T(t,u),T(t,_),q(c,_,null),h=!0,m||(p=le(mt,"keydown",n[9]),m=!0)},p(d,I){let V=e;e=a(d),e===V?s[e].p(d,I):(se(),L(s[V],1,1,()=>{s[V]=null}),ae(),i=s[e],i?i.p(d,I):(i=s[e]=g[e](d),i.c()),w(i,1),i.m(l,null));const G={};I[0]&44|I[1]&8&&(G.$$scope={dirty:I,ctx:d}),!f&&I[0]&8&&(f=!0,G.map=d[3],Z(()=>f=!1)),c.$set(G)},i(d){h||(w(i),w(c.$$.fragment,d),h=!0)},o(d){L(i),L(c.$$.fragment,d),h=!1},d(d){d&&b(t),s[e].d(),M(c),m=!1,p()}}}function Et(n,t,l){let e={type:"FeatureCollection",features:[]},i=t??l;if(i!=null){let u=i.kind=="critical"?n.criticalIssues:n.policyConflictLog;e.features.push(de(u[i.idx].point))}return e}function de(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function Te(n){return`${n.criticalIssue||"Unknown critical"}: ${n.locationName||"???"}`}function Pe(n){return`${n.conflict||"Unknown conflict"}: ${n.locationName||"???"}`}function Dt(n,t,l){let e,i;he(n,j,$=>l(2,i=$));let u,_="critical",c=null,f=null;function h($){l(0,c=$),l(1,f=null)}function m($){if(c!=null){l(0,c=null);return}_=="critical"?(ue(j,i.criticalIssues=[...i.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:$.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,c={kind:"critical",idx:i.criticalIssues.length-1})):(ue(j,i.policyConflictLog=[...i.policyConflictLog,{id:"TODO",conflict:"",stage:"",point:$.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,c={kind:"conflict",idx:i.policyConflictLog.length-1})),l(1,f=null)}ve(()=>{u.on("click",m),g()}),Ve(()=>{u.off("click",m)});function p(){window.confirm("Delete this entry?")&&(c.kind=="critical"?(i.criticalIssues.splice(c.idx,1),j.set(i)):(i.policyConflictLog.splice(c.idx,1),j.set(i)),l(0,c=null))}function g($){let E={type:"FeatureCollection",features:[...i.criticalIssues.map(W=>de(W.point)),...i.policyConflictLog.map(W=>de(W.point))]};E.features.length>0&&u.fitBounds(Ze(E),{padding:20,animate:!0})}function s($){c!=null&&$.key=="Escape"&&($.stopPropagation(),l(0,c=null))}const a=()=>g();function v($){_=$,l(4,_)}const k=$=>h({kind:"critical",idx:$}),d=$=>l(1,f={kind:"critical",idx:$}),I=()=>l(1,f=null),V=$=>h({kind:"conflict",idx:$}),G=$=>l(1,f={kind:"conflict",idx:$}),X=()=>l(1,f=null),x=()=>l(0,c=null);function y($,E){n.$$.not_equal(E.point,$)&&(E.point=$,j.set(i))}const ie=$=>h({kind:"critical",idx:$}),K=$=>h({kind:"critical",idx:$});function P($,E){n.$$.not_equal(E.point,$)&&(E.point=$,j.set(i))}const J=$=>h({kind:"conflict",idx:$}),o=$=>h({kind:"conflict",idx:$});function r($){u=$,l(3,u)}return n.$$.update=()=>{n.$$.dirty[0]&7&&l(5,e=Et(i,c,f))},[c,f,i,u,_,e,h,p,g,s,a,v,k,d,I,V,G,X,x,y,ie,K,P,J,o,r]}class Ht extends _e{constructor(t){super(),ge(this,t,Dt,Nt,pe,{},null,[-1,-1])}}export{Ht as component};
