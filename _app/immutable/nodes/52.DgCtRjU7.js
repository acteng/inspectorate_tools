import{s as H,a as k,e as J,g as y,c as F,m as R,i as f,f as g,k as j,t as M,d as B}from"../chunks/scheduler.-FPbSINy.js";import{S as O,i as V,c as b,a as L,m as P,t as I,b as T,d as W}from"../chunks/index.Ii7XIK-w.js";import{e as G}from"../chunks/da_log.Bcddy3iz.js";import{c as U,s as q}from"../chunks/data.CDWWTqcd.js";import{D as X}from"../chunks/DefaultButton.CK1grpna.js";/* empty css                                                               */import{T as A}from"../chunks/TextArea.ytEpR8Wd.js";import{E as z}from"../chunks/exceljs.min.BuyXGIGS.js";import{g as Q,a as Y}from"../chunks/lists.djxH55N_.js";import{d as Z}from"../chunks/index.M1jeQ2dX.js";const ee=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function te(e,a){console.log("Loading blank route check xlsx");let l=await(await fetch(ee)).arrayBuffer(),o=new z.Workbook;await o.xlsx.load(l),o.eachSheet((n,i)=>{n.conditionalFormattings=[]}),le(e,o),oe(e,o),re(e,o),ae(e,o),$(e.safetyCheck,o,"3.1 Safety Check",["J","K","L","M"],d([[13,28]])),$(e.streetCheck,o,"4.1 Street Check",["J","K","L","M"],d([[13,19],[23,25],[29,34],[38,43],[47,50]])),$(e.streetPlacemakingCheck,o,"4.2 Street Placemaking Check",["I","J","K","L"],d([[13,15],[19,21],[25,34],[38,47]])),$(e.pathCheck,o,"5.1 Path Check",["J","K","L","M"],d([[15,19],[23,33],[37,40],[44,48],[52,56]])),$(e.pathPlacemakingCheck,o,"5.2 Path Placemaking Check",["I","J","K","L"],d([[12,14],[20,22],[26,29],[33,41]])),ne(e,o),o.getWorksheet("5.1 Path Check").getCell("D7").value=e.horseRiders,o.getWorksheet("7.1 Results Summary").getCell("G7").value=e.resultsReviewStatement,console.log("Writing route check xlsx");let s=await o.xlsx.writeBuffer();Z(s,`route_check_${a}.xlsx`)}function le(e,a){let t=a.getWorksheet("1. Summary of Scheme");t.getCell("C6").value=e.summary.dateDesignReview,t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.assessedRouteLengthKm,t.getCell("C19").value=e.summary.totalRouteLengthKm,t.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(t.getCell("D22").value="Path Check")}function oe(e,a){let t=a.getWorksheet("2.1 Policy Check");for(let l=0;l<6;l++)t.getCell("D"+(8+l)).value=e.policyCheck[l].existing,t.getCell("E"+(8+l)).value=e.policyCheck[l].proposed,t.getCell("F"+(8+l)).value=e.policyCheck[l].commentary}function re(e,a){let t=a.getWorksheet("2.2 Policy Conflict Log");for(let[l,o]of e.policyConflictLog.entries())t.getCell("F"+(8+l)).value=Q(o.conflict),t.getCell("H"+(8+l)).value=o.stage,t.getCell("I"+(8+l)).value=D(o.point),t.getCell("J"+(8+l)).value=o.locationName,t.getCell("K"+(8+l)).value=o.resolved,t.getCell("L"+(8+l)).value=o.notes}function ae(e,a){let t=a.getWorksheet("3.2 Critical Issues Log");for(let[l,o]of e.criticalIssues.entries())t.getCell("F"+(8+l)).value=Y(o.criticalIssue),t.getCell("H"+(8+l)).value=o.stage,t.getCell("I"+(8+l)).value=D(o.point),t.getCell("J"+(8+l)).value=o.locationName,t.getCell("K"+(8+l)).value=o.resolved,t.getCell("L"+(8+l)).value=o.notes}function $(e,a,t,l,o){let s=a.getWorksheet(t);if(o.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${t}`);for(let n=0;n<e.existingScores.length;n++){let i=o[n];s.getCell(l[0]+i).value=K(e.existingScores[n]),s.getCell(l[1]+i).value=e.existingScoreNotes[n],s.getCell(l[2]+i).value=K(e.proposedScores[n]),s.getCell(l[3]+i).value=e.proposedScoreNotes[n]}}function ne(e,a){let t=a.getWorksheet("6. JAT Check"),l=0;for(let o of e.jat)for(let s of[o.existing,o.proposed]){let n=v("H",l*5);t.getCell(v(n,1)+"9").value=o.name,t.getCell(v(n,1)+"10").value=s.notes;for(let[i,u]of s.movements.filter(m=>m.kind=="walking & wheeling").entries())t.getCell(n+(13+i)).value=u.name,t.getCell(v(n,2)+(13+i)).value=N(u.score),t.getCell(v(n,3)+(13+i)).value=u.notes;for(let[i,u]of s.movements.filter(m=>m.kind=="cycling").entries())t.getCell(n+(26+i)).value=u.name,t.getCell(v(n,2)+(26+i)).value=N(u.score),t.getCell(v(n,3)+(26+i)).value=u.notes;l++}}function v(e,a){return se(ie(e)+a)}function ie(e){let a=0;for(let t=0;t<e.length;t++)a*=26,a+=e.charCodeAt(t)-65+1;return a-1}function se(e){let a="";for(e+=1;e>0;){let t=(e-1)%26;a=String.fromCharCode(t+65)+a,e=Math.floor((e-1)/26)}return a}function d(e){let a=[];for(let[t,l]of e)for(let o=t;o<=l;o++)a.push(o);return a}function K(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function N(e){return{0:0,1:1,2:2,X:e}[e]}function D(e){return`${e[1]}, ${e[0]}`}function ue(e){let a;return{c(){a=M("Convert to .xlsx (takes a few seconds)")},l(t){a=B(t,"Convert to .xlsx (takes a few seconds)")},m(t,l){f(t,a,l)},d(t){t&&g(a)}}}function me(e){let a,t,l,o=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9</i>`,s,n,i,u,m=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,x,C,w,p,S,h,_;return a=new X({props:{$$slots:{default:[ue]},$$scope:{ctx:e}}}),a.$on("click",e[3]),C=new A({props:{label:"TSV output, just the one row of values",value:e[2]}}),p=new A({props:{label:"TSV output with header",value:`${e[1]}
${e[2]}
`}}),h=new A({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(e[0]),null,"  ")}}),{c(){b(a.$$.fragment),t=k(),l=J("p"),l.innerHTML=o,s=k(),n=J("hr"),i=k(),u=J("p"),u.textContent=m,x=k(),b(C.$$.fragment),w=k(),b(p.$$.fragment),S=k(),b(h.$$.fragment)},l(r){L(a.$$.fragment,r),t=y(r),l=F(r,"P",{"data-svelte-h":!0}),R(l)!=="svelte-6hhtkc"&&(l.innerHTML=o),s=y(r),n=F(r,"HR",{}),i=y(r),u=F(r,"P",{"data-svelte-h":!0}),R(u)!=="svelte-5ssfe3"&&(u.textContent=m),x=y(r),L(C.$$.fragment,r),w=y(r),L(p.$$.fragment,r),S=y(r),L(h.$$.fragment,r)},m(r,c){P(a,r,c),f(r,t,c),f(r,l,c),f(r,s,c),f(r,n,c),f(r,i,c),f(r,u,c),f(r,x,c),P(C,r,c),f(r,w,c),P(p,r,c),f(r,S,c),P(h,r,c),_=!0},p(r,[c]){const E={};c&64&&(E.$$scope={dirty:c,ctx:r}),a.$set(E)},i(r){_||(I(a.$$.fragment,r),I(C.$$.fragment,r),I(p.$$.fragment,r),I(h.$$.fragment,r),_=!0)},o(r){T(a.$$.fragment,r),T(C.$$.fragment,r),T(p.$$.fragment,r),T(h.$$.fragment,r),_=!1},d(r){r&&(g(t),g(l),g(s),g(n),g(i),g(u),g(x),g(w),g(S)),W(a,r),W(C,r),W(p,r),W(h,r)}}}function ce(e,a,t){let l,o;j(e,U,m=>t(4,l=m)),j(e,q,m=>t(5,o=m));let s=G(o),n=s.map(m=>m[0]).join("	"),i=s.map(m=>`"${m[1]}"`).join("	");async function u(){try{await te(o,l)}catch(m){window.alert(`Conversion failed: ${m}`)}}return[s,n,i,u]}class xe extends O{constructor(a){super(),V(this,a,ce,me,H,{})}}export{xe as component};
