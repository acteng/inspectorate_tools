import{s as je,w as oe,x as le,l as ut,u as mt,r as ct,v as _t,D as we,k as Ne,R as bt,T as Se,a as O,g as H,i as L,f as b,G as Me,n as Ee,e as x,t as J,c as ee,b as ne,d as G,p as ve,q as X,h as F,j as ie,B as kt,W as Je,F as pe,m as Ge}from"../chunks/scheduler.D5JRtHaf.js";import{S as Ie,i as Te,e as re,c as D,a as z,m as B,t as j,b as C,d as q,g as ue,f as me}from"../chunks/index.Xm1AgzMF.js";import{e as ge}from"../chunks/each.C9BadmQM.js";import{C as qe,B as vt}from"../chunks/ClickableCard.BhW8XYpY.js";import{D as Ue}from"../chunks/DefaultButton.BHwS446X.js";import{S as Ce}from"../chunks/SecondaryButton.DxO4nu9r.js";/* empty css                                                    */import{T as Fe}from"../chunks/TextInput.Cluermb4.js";import{W as Oe}from"../chunks/WarningButton.jEqntaGg.js";import{s as te}from"../chunks/data.Dm1UP3Mi.js";import{L as wt,a as jt,d as ke,t as Ct,v as Lt,w as Pe,M as St,b as Mt,C as Et,G as Ve,x as De,y as Ke,m as It,P as gt,l as Tt}from"../chunks/index.CC8ZgsdH.js";import{c as Re}from"../chunks/index.BLeW4pOs.js";import{g as ze}from"../chunks/index.BuSMz4Z1.js";import{c as be}from"../chunks/colors.DaC397qr.js";import{G as yt}from"../chunks/GeoreferenceLayer.uD5PxLp4.js";import{a as Nt,M as ye,B as At,G as Pt,S as Dt,C as zt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DhtGqEnn.js";import{C as Bt}from"../chunks/CollapsibleCard.D0GavHKp.js";import{R as Be}from"../chunks/Radio.BjpWuuOn.js";import{T as dt}from"../chunks/TextArea.Ct1XwDet.js";import"../chunks/paths.aZpBa8Q_.js";function qt(t){let e;const o=t[16].default,n=ut(o,t,t[24],null);return{c(){n&&n.c()},l(l){n&&n.l(l)},m(l,a){n&&n.m(l,a),e=!0},p(l,a){n&&n.p&&(!e||a&16777216)&&mt(n,o,l,l[24],e?_t(o,l[24],a,null):ct(l[24]),null)},i(l){e||(j(n,l),e=!0)},o(l){C(n,l),e=!1},d(l){n&&n.d(l)}}}function Ut(t){let e,o,n;function l(r){t[17](r)}let a={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[qt]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new wt({props:a}),oe.push(()=>re(e,"hovered",l)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){D(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,i){B(e,r,i),n=!0},p(r,[i]){const s={};i&2&&(s.id=r[1]),i&4&&(s.source=r[2]),i&8&&(s.sourceLayer=r[3]),i&16&&(s.beforeId=r[4]),i&32&&(s.beforeLayerType=r[5]),i&64&&(s.paint=r[6]),i&128&&(s.layout=r[7]),i&256&&(s.filter=r[8]),i&512&&(s.applyToClusters=r[9]),i&1024&&(s.minzoom=r[10]),i&2048&&(s.maxzoom=r[11]),i&4096&&(s.hoverCursor=r[12]),i&8192&&(s.manageHoverState=r[13]),i&16384&&(s.eventsIfTopMost=r[14]),i&32768&&(s.interactive=r[15]),i&16777216&&(s.$$scope={dirty:i,ctx:r}),!o&&i&1&&(o=!0,s.hovered=r[0],le(()=>o=!1)),e.$set(s)},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Ft(t,e,o){let{$$slots:n={},$$scope:l}=e,{id:a=jt("symbol")}=e,{source:r=void 0}=e,{sourceLayer:i=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:_=void 0}=e,{paint:m=void 0}=e,{layout:d=void 0}=e,{filter:u=void 0}=e,{applyToClusters:v=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:N=void 0}=e,{hoverCursor:A=void 0}=e,{manageHoverState:k=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:p=!0}=e;function g(T){$=T,o(0,$)}function w(T){we.call(this,t,T)}function U(T){we.call(this,t,T)}function Q(T){we.call(this,t,T)}function P(T){we.call(this,t,T)}function Z(T){we.call(this,t,T)}function se(T){we.call(this,t,T)}return t.$$set=T=>{"id"in T&&o(1,a=T.id),"source"in T&&o(2,r=T.source),"sourceLayer"in T&&o(3,i=T.sourceLayer),"beforeId"in T&&o(4,s=T.beforeId),"beforeLayerType"in T&&o(5,_=T.beforeLayerType),"paint"in T&&o(6,m=T.paint),"layout"in T&&o(7,d=T.layout),"filter"in T&&o(8,u=T.filter),"applyToClusters"in T&&o(9,v=T.applyToClusters),"minzoom"in T&&o(10,E=T.minzoom),"maxzoom"in T&&o(11,N=T.maxzoom),"hoverCursor"in T&&o(12,A=T.hoverCursor),"manageHoverState"in T&&o(13,k=T.manageHoverState),"hovered"in T&&o(0,$=T.hovered),"eventsIfTopMost"in T&&o(14,f=T.eventsIfTopMost),"interactive"in T&&o(15,p=T.interactive),"$$scope"in T&&o(24,l=T.$$scope)},[$,a,r,i,s,_,m,d,u,v,E,N,A,k,f,p,n,g,w,U,Q,P,Z,se,l]}class Ot extends Ie{constructor(e){super(),Te(this,e,Ft,Ut,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ht=Object.defineProperty,Jt=(t,e)=>Ht(t,"name",{value:e,configurable:!0});function pt(t,e,o,n={}){const l=ze(t),a=ke(l[0]),r=ke(l[1]),i=ke(o),s=Ct(e,n.units),_=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),m=a+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(_)),d=Pe(m),u=Pe(_);return Lt([d,u],n.properties)}Jt(pt,"destination");var Xe=pt,Gt=Object.defineProperty,$t=(t,e)=>Gt(t,"name",{value:e,configurable:!0});function He(t,e,o={}){if(o.final===!0)return ht(t,e);const n=ze(t),l=ze(e),a=ke(n[0]),r=ke(l[0]),i=ke(n[1]),s=ke(l[1]),_=Math.sin(r-a)*Math.cos(s),m=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(r-a);return Pe(Math.atan2(_,m))}$t(He,"bearing");function ht(t,e){let o=He(e,t);return o=(o+180)%360,o}$t(ht,"calculateFinalBearing");var Vt=He;function We(t,e,o){const n=t.slice();return n[35]=e[o],n[36]=e,n[37]=o,n}function Ze(t,e,o){const n=t.slice();return n[38]=e[o],n[39]=e,n[37]=o,n}function Kt(t){let e,o=ln(t[37])+"",n;return{c(){e=x("span"),n=J(o),this.h()},l(l){e=ee(l,"SPAN",{class:!0});var a=ne(e);n=G(a,o),a.forEach(b),this.h()},h(){ve(e,"class","dot svelte-1qktznf"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(l,a){L(l,e,a),F(e,n)},p:Ee,d(l){l&&b(e)}}}function Qe(t){let e,o,n;function l(s){t[18](s,t[38])}function a(){return t[19](t[37])}function r(){return t[20](t[37])}let i={draggable:!0,$$slots:{default:[Kt]},$$scope:{ctx:t}};return t[38].point!==void 0&&(i.lngLat=t[38].point),e=new ye({props:i}),oe.push(()=>re(e,"lngLat",l)),e.$on("dragend",a),e.$on("click",r),{c(){D(e.$$.fragment)},l(s){z(e.$$.fragment,s)},m(s,_){B(e,s,_),n=!0},p(s,_){t=s;const m={};_[1]&512&&(m.$$scope={dirty:_,ctx:t}),!o&&_[0]&19&&(o=!0,m.lngLat=t[38].point,le(()=>o=!1)),e.$set(m)},i(s){n||(j(e.$$.fragment,s),n=!0)},o(s){C(e.$$.fragment,s),n=!1},d(s){q(e,s)}}}function Rt(t){let e;return{c(){e=x("span"),this.h()},l(o){e=ee(o,"SPAN",{class:!0}),ne(e).forEach(b),this.h()},h(){ve(e,"class","dot svelte-1qktznf"),X(e,"background-color",t[7][t[35].score]),X(e,"opacity",t[35].kind=="walking & wheeling"?"0%":"100%")},m(o,n){L(o,e,n)},p(o,n){n[0]&19&&X(e,"background-color",o[7][o[35].score]),n[0]&19&&X(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&b(e)}}}function Xt(t){let e;return{c(){e=x("span"),this.h()},l(o){e=ee(o,"SPAN",{class:!0}),ne(e).forEach(b),this.h()},h(){ve(e,"class","dot svelte-1qktznf"),X(e,"background-color",t[7][t[35].score])},m(o,n){L(o,e,n)},p(o,n){n[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Wt(t){let e;return{c(){e=x("span"),this.h()},l(o){e=ee(o,"SPAN",{class:!0}),ne(e).forEach(b),this.h()},h(){ve(e,"class","dot svelte-1qktznf"),X(e,"background-color",t[7][t[35].score]),X(e,"opacity","0%")},m(o,n){L(o,e,n)},p(o,n){n[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Ye(t){let e,o,n,l,a,r,i,s,_;function m(w){t[21](w,t[35])}function d(){return t[22](t[37])}function u(){return t[23](t[37])}let v={draggable:!0,$$slots:{default:[Rt]},$$scope:{ctx:t}};t[35].point1!==void 0&&(v.lngLat=t[35].point1),e=new ye({props:v}),oe.push(()=>re(e,"lngLat",m)),e.$on("dragend",d),e.$on("click",u);function E(w){t[24](w,t[35])}function N(){return t[25](t[37])}function A(){return t[26](t[37])}let k={draggable:!0,$$slots:{default:[Xt]},$$scope:{ctx:t}};t[35].point2!==void 0&&(k.lngLat=t[35].point2),l=new ye({props:k}),oe.push(()=>re(l,"lngLat",E)),l.$on("dragend",N),l.$on("click",A);function $(w){t[27](w,t[35])}function f(){return t[28](t[37])}function p(){return t[29](t[37])}let g={draggable:!0,$$slots:{default:[Wt]},$$scope:{ctx:t}};return t[35].point3!==void 0&&(g.lngLat=t[35].point3),i=new ye({props:g}),oe.push(()=>re(i,"lngLat",$)),i.$on("dragend",f),i.$on("click",p),{c(){D(e.$$.fragment),n=O(),D(l.$$.fragment),r=O(),D(i.$$.fragment)},l(w){z(e.$$.fragment,w),n=H(w),z(l.$$.fragment,w),r=H(w),z(i.$$.fragment,w)},m(w,U){B(e,w,U),L(w,n,U),B(l,w,U),L(w,r,U),B(i,w,U),_=!0},p(w,U){t=w;const Q={};U[0]&19|U[1]&512&&(Q.$$scope={dirty:U,ctx:t}),!o&&U[0]&19&&(o=!0,Q.lngLat=t[35].point1,le(()=>o=!1)),e.$set(Q);const P={};U[0]&19|U[1]&512&&(P.$$scope={dirty:U,ctx:t}),!a&&U[0]&19&&(a=!0,P.lngLat=t[35].point2,le(()=>a=!1)),l.$set(P);const Z={};U[0]&19|U[1]&512&&(Z.$$scope={dirty:U,ctx:t}),!s&&U[0]&19&&(s=!0,Z.lngLat=t[35].point3,le(()=>s=!1)),i.$set(Z)},i(w){_||(j(e.$$.fragment,w),j(l.$$.fragment,w),j(i.$$.fragment,w),_=!0)},o(w){C(e.$$.fragment,w),C(l.$$.fragment,w),C(i.$$.fragment,w),_=!1},d(w){w&&(b(n),b(r)),q(e,w),q(l,w),q(i,w)}}}function Zt(t){let e=(t[34].name||"Untitled movement")+"",o;return{c(){o=J(e)},l(n){o=G(n,e)},m(n,l){L(n,o,l)},p(n,l){l[1]&8&&e!==(e=(n[34].name||"Untitled movement")+"")&&ie(o,e)},d(n){n&&b(o)}}}function Qt(t){let e,o;return e=new gt({props:{$$slots:{default:[Zt,({props:n})=>({34:n}),({props:n})=>[0,n?8:0]]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l[1]&520&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function Yt(t){let e=(t[34].name||"Untitled movement")+"",o;return{c(){o=J(e)},l(n){o=G(n,e)},m(n,l){L(n,o,l)},p(n,l){l[1]&8&&e!==(e=(n[34].name||"Untitled movement")+"")&&ie(o,e)},d(n){n&&b(o)}}}function xt(t){let e,o;return e=new gt({props:{$$slots:{default:[Yt,({props:n})=>({34:n}),({props:n})=>[0,n?8:0]]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l[1]&520&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function en(t){let e,o,n,l,a,r;return e=new De({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ke(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Qt]},$$scope:{ctx:t}}}),e.$on("click",t[9]),n=new De({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ke(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[xt]},$$scope:{ctx:t}}}),n.$on("click",t[9]),a=new Ot({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment),l=O(),D(a.$$.fragment)},l(i){z(e.$$.fragment,i),o=H(i),z(n.$$.fragment,i),l=H(i),z(a.$$.fragment,i)},m(i,s){B(e,i,s),L(i,o,s),B(n,i,s),L(i,l,s),B(a,i,s),r=!0},p(i,s){const _={};s[1]&512&&(_.$$scope={dirty:s,ctx:i}),e.$set(_);const m={};s[1]&512&&(m.$$scope={dirty:s,ctx:i}),n.$set(m)},i(i){r||(j(e.$$.fragment,i),j(n.$$.fragment,i),j(a.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),C(n.$$.fragment,i),C(a.$$.fragment,i),r=!1},d(i){i&&(b(o),b(l)),q(e,i),q(n,i),q(a,i)}}}function tn(t){let e,o,n,l;return e=new De({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),n=new It({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment)},l(a){z(e.$$.fragment,a),o=H(a),z(n.$$.fragment,a)},m(a,r){B(e,a,r),L(a,o,r),B(n,a,r),l=!0},p:Ee,i(a){l||(j(e.$$.fragment,a),j(n.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(n.$$.fragment,a),l=!1},d(a){a&&b(o),q(e,a),q(n,a)}}}function nn(t){let e,o,n,l,a,r,i,s,_,m,d,u;e=new Nt({}),e.$on("click",t[8]),n=new Et({props:{gj:t[4].summary.networkMap,show:t[2]}});let v=ge(t[4].jat[t[0]][t[1]].arms),E=[];for(let f=0;f<v.length;f+=1)E[f]=Qe(Ze(t,v,f));const N=f=>C(E[f],1,1,()=>{E[f]=null});let A=ge(t[4].jat[t[0]][t[1]].movements),k=[];for(let f=0;f<A.length;f+=1)k[f]=Ye(We(t,A,f));const $=f=>C(k[f],1,1,()=>{k[f]=null});return i=new Ve({props:{data:t[10](t[4]),$$slots:{default:[en]},$$scope:{ctx:t}}}),_=new Ve({props:{data:t[6],$$slots:{default:[tn]},$$scope:{ctx:t}}}),d=new yt({props:{map:t[5]}}),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment),l=O();for(let f=0;f<E.length;f+=1)E[f].c();a=O();for(let f=0;f<k.length;f+=1)k[f].c();r=O(),D(i.$$.fragment),s=O(),D(_.$$.fragment),m=O(),D(d.$$.fragment)},l(f){z(e.$$.fragment,f),o=H(f),z(n.$$.fragment,f),l=H(f);for(let p=0;p<E.length;p+=1)E[p].l(f);a=H(f);for(let p=0;p<k.length;p+=1)k[p].l(f);r=H(f),z(i.$$.fragment,f),s=H(f),z(_.$$.fragment,f),m=H(f),z(d.$$.fragment,f)},m(f,p){B(e,f,p),L(f,o,p),B(n,f,p),L(f,l,p);for(let g=0;g<E.length;g+=1)E[g]&&E[g].m(f,p);L(f,a,p);for(let g=0;g<k.length;g+=1)k[g]&&k[g].m(f,p);L(f,r,p),B(i,f,p),L(f,s,p),B(_,f,p),L(f,m,p),B(d,f,p),u=!0},p(f,p){const g={};if(p[0]&16&&(g.gj=f[4].summary.networkMap),p[0]&4&&(g.show=f[2]),n.$set(g),p[0]&27){v=ge(f[4].jat[f[0]][f[1]].arms);let P;for(P=0;P<v.length;P+=1){const Z=Ze(f,v,P);E[P]?(E[P].p(Z,p),j(E[P],1)):(E[P]=Qe(Z),E[P].c(),j(E[P],1),E[P].m(a.parentNode,a))}for(ue(),P=v.length;P<E.length;P+=1)N(P);me()}if(p[0]&155){A=ge(f[4].jat[f[0]][f[1]].movements);let P;for(P=0;P<A.length;P+=1){const Z=We(f,A,P);k[P]?(k[P].p(Z,p),j(k[P],1)):(k[P]=Ye(Z),k[P].c(),j(k[P],1),k[P].m(r.parentNode,r))}for(ue(),P=A.length;P<k.length;P+=1)$(P);me()}const w={};p[0]&16&&(w.data=f[10](f[4])),p[1]&512&&(w.$$scope={dirty:p,ctx:f}),i.$set(w);const U={};p[0]&64&&(U.data=f[6]),p[1]&512&&(U.$$scope={dirty:p,ctx:f}),_.$set(U);const Q={};p[0]&32&&(Q.map=f[5]),d.$set(Q)},i(f){if(!u){j(e.$$.fragment,f),j(n.$$.fragment,f);for(let p=0;p<v.length;p+=1)j(E[p]);for(let p=0;p<A.length;p+=1)j(k[p]);j(i.$$.fragment,f),j(_.$$.fragment,f),j(d.$$.fragment,f),u=!0}},o(f){C(e.$$.fragment,f),C(n.$$.fragment,f),E=E.filter(Boolean);for(let p=0;p<E.length;p+=1)C(E[p]);k=k.filter(Boolean);for(let p=0;p<k.length;p+=1)C(k[p]);C(i.$$.fragment,f),C(_.$$.fragment,f),C(d.$$.fragment,f),u=!1},d(f){f&&(b(o),b(l),b(a),b(r),b(s),b(m)),q(e,f),q(n,f),Me(E,f),Me(k,f),q(i,f),q(_,f),q(d,f)}}}function on(t){let e,o,n;function l(r){t[30](r)}let a={$$slots:{default:[nn]},$$scope:{ctx:t}};return t[5]!==void 0&&(a.map=t[5]),e=new St({props:a}),oe.push(()=>re(e,"map",l)),{c(){D(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,i){B(e,r,i),n=!0},p(r,i){const s={};i[0]&127|i[1]&512&&(s.$$scope={dirty:i,ctx:r}),!o&&i[0]&32&&(o=!0,s.map=r[5],le(()=>o=!1)),e.$set(s)},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function xe(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function ln(t){return String.fromCharCode(t+65)}function rn(t,e,o){let n,l;Ne(t,te,h=>o(4,l=h));let{junctionIdx:a}=e,{stage:r}=e,{newKind:i}=e,{editing:s}=e,{hoveringSidebar:_}=e,{streetviewOn:m}=e,{showContext:d}=e,{select:u}=e,{stopEditing:v}=e,E,N={0:be.red.background,1:be.amber.background,2:be.green.background,X:be.critical.background};function A(h,M,I){let K={type:"FeatureCollection",features:[]},c=M??I;return c!=null&&(c.kind=="arm"?K.features.push(xe(h.jat[a][r].arms[c.idx],c.idx)):K.features.push(p(h.jat[a][r].movements[c.idx],c.idx))),K}async function k(h){if(!m){for(let M of E.queryRenderedFeatures(h.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){await v();return}i=="arm"?(Se(te,l.jat[a][r].arms=[...l.jat[a][r].arms,{point:h.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[a][r].arms.length-1})):(Se(te,l.jat[a][r].movements=[...l.jat[a][r].movements,{point1:h.detail.lngLat.toArray(),point2:Xe(h.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Xe(h.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[a][r].movements.length-1}))}}async function $(h){await u({kind:"movement",idx:h.detail.features[0].id})}bt(()=>{w(!1)});function f(h){let M={type:"FeatureCollection",features:h.jat[a][r].movements.map((I,K)=>p(I,K))};for(let I of h.jat[a][r].movements)if(M.features.push(g(I,M.features.length)),I.kind=="walking & wheeling"){let K={...I,point1:I.point3,point3:I.point1};M.features.push(g(K,M.features.length))}return M}function p(h,M){return{type:"Feature",id:M,properties:{name:h.name,kind:h.kind,color:N[h.score]},geometry:{type:"LineString",coordinates:[h.point1,h.point2,h.point3]}}}function g(h,M){return{type:"Feature",id:M,properties:{kind:h.kind,color:N[h.score],angle:Vt(h.point2,h.point3)},geometry:{type:"Point",coordinates:h.point3}}}function w(h){let M=f(l);for(let I of l.jat[a][r].arms)M.features.push(xe(I,M.features.length));for(let I of l.summary.networkMap.features)M.features.push(I);M.features.length>0&&E.fitBounds(Mt(M),{padding:20,animate:h})}function U(){return E}function Q(h,M){t.$$.not_equal(M.point,h)&&(M.point=h,te.set(l))}const P=h=>u({kind:"arm",idx:h}),Z=h=>u({kind:"arm",idx:h});function se(h,M){t.$$.not_equal(M.point1,h)&&(M.point1=h,te.set(l))}const T=h=>u({kind:"movement",idx:h}),ce=h=>u({kind:"movement",idx:h});function Y(h,M){t.$$.not_equal(M.point2,h)&&(M.point2=h,te.set(l))}const $e=h=>u({kind:"movement",idx:h}),he=h=>u({kind:"movement",idx:h});function fe(h,M){t.$$.not_equal(M.point3,h)&&(M.point3=h,te.set(l))}const S=h=>u({kind:"movement",idx:h}),W=h=>u({kind:"movement",idx:h});function V(h){E=h,o(5,E)}return t.$$set=h=>{"junctionIdx"in h&&o(0,a=h.junctionIdx),"stage"in h&&o(1,r=h.stage),"newKind"in h&&o(11,i=h.newKind),"editing"in h&&o(12,s=h.editing),"hoveringSidebar"in h&&o(13,_=h.hoveringSidebar),"streetviewOn"in h&&o(14,m=h.streetviewOn),"showContext"in h&&o(2,d=h.showContext),"select"in h&&o(3,u=h.select),"stopEditing"in h&&o(15,v=h.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&12304&&o(6,n=A(l,s,_))},[a,r,d,u,l,E,n,N,k,$,f,i,s,_,m,v,w,U,Q,P,Z,se,T,ce,Y,$e,he,fe,S,W,V]}class an extends Ie{constructor(e){super(),Te(this,e,rn,on,je,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function sn(t){let e,o,n,l,a,r,i,s,_,m,d,u;function v(g){t[5](g)}let E={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(E.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new Fe({props:E}),oe.push(()=>re(e,"value",v));function N(g){t[6](g)}let A={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(A.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),l=new Be({props:A}),oe.push(()=>re(l,"value",N));function k(g){t[7](g)}let $={legend:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&($.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),i=new Be({props:$}),oe.push(()=>re(i,"value",k));function f(g){t[8](g)}let p={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(p.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),m=new dt({props:p}),oe.push(()=>re(m,"value",f)),{c(){D(e.$$.fragment),n=O(),D(l.$$.fragment),r=O(),D(i.$$.fragment),_=O(),D(m.$$.fragment)},l(g){z(e.$$.fragment,g),n=H(g),z(l.$$.fragment,g),r=H(g),z(i.$$.fragment,g),_=H(g),z(m.$$.fragment,g)},m(g,w){B(e,g,w),L(g,n,w),B(l,g,w),L(g,r,w),B(i,g,w),L(g,_,w),B(m,g,w),u=!0},p(g,[w]){const U={};!o&&w&15&&(o=!0,U.value=g[3].jat[g[0]][g[1]].movements[g[2]].name,le(()=>o=!1)),e.$set(U);const Q={};!a&&w&15&&(a=!0,Q.value=g[3].jat[g[0]][g[1]].movements[g[2]].kind,le(()=>a=!1)),l.$set(Q);const P={};!s&&w&15&&(s=!0,P.value=g[3].jat[g[0]][g[1]].movements[g[2]].score,le(()=>s=!1)),i.$set(P);const Z={};!d&&w&15&&(d=!0,Z.value=g[3].jat[g[0]][g[1]].movements[g[2]].notes,le(()=>d=!1)),m.$set(Z)},i(g){u||(j(e.$$.fragment,g),j(l.$$.fragment,g),j(i.$$.fragment,g),j(m.$$.fragment,g),u=!0)},o(g){C(e.$$.fragment,g),C(l.$$.fragment,g),C(i.$$.fragment,g),C(m.$$.fragment,g),u=!1},d(g){g&&(b(n),b(r),b(_)),q(e,g),q(l,g),q(i,g),q(m,g)}}}function fn(t,e,o){let n;Ne(t,te,u=>o(3,n=u));let{junctionIdx:l}=e,{stage:a}=e,{idx:r}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(u){t.$$.not_equal(n.jat[l][a].movements[r].name,u)&&(n.jat[l][a].movements[r].name=u,te.set(n))}function _(u){t.$$.not_equal(n.jat[l][a].movements[r].kind,u)&&(n.jat[l][a].movements[r].kind=u,te.set(n))}function m(u){t.$$.not_equal(n.jat[l][a].movements[r].score,u)&&(n.jat[l][a].movements[r].score=u,te.set(n))}function d(u){t.$$.not_equal(n.jat[l][a].movements[r].notes,u)&&(n.jat[l][a].movements[r].notes=u,te.set(n))}return t.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,a=u.stage),"idx"in u&&o(2,r=u.idx)},[l,a,r,n,i,s,_,m,d]}class un extends Ie{constructor(e){super(),Te(this,e,fn,sn,je,{junctionIdx:0,stage:1,idx:2})}}function de(t){if(t.movements.length==0)return"No movements added";let e=0,o=0;for(let l of t.movements)e+={0:0,1:1,2:2,X:0}[l.score],o+=2;let n=e/o*100;return`${Math.round(n)}%`}const{window:mn}=Tt;function et(t,e,o){const n=t.slice();n[36]=e[o],n[39]=o;const l=n[17][n[36].score];return n[37]=l,n}function tt(t,e,o){const n=t.slice();return n[40]=e[o],n[39]=o,n}function cn(t){let e,o,n,l,a,r,i,s;e=new Ue({props:{$$slots:{default:[gn]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new Oe({props:{$$slots:{default:[dn]},$$scope:{ctx:t}}}),n.$on("click",t[13]);const _=[$n,pn],m=[];function d(u,v){return u[3].kind=="movement"?0:1}return a=d(t),r=m[a]=_[a](t),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment),l=O(),r.c(),i=pe()},l(u){z(e.$$.fragment,u),o=H(u),z(n.$$.fragment,u),l=H(u),r.l(u),i=pe()},m(u,v){B(e,u,v),L(u,o,v),B(n,u,v),L(u,l,v),m[a].m(u,v),L(u,i,v),s=!0},p(u,v){const E={};v[1]&8&&(E.$$scope={dirty:v,ctx:u}),e.$set(E);const N={};v[1]&8&&(N.$$scope={dirty:v,ctx:u}),n.$set(N);let A=a;a=d(u),a===A?m[a].p(u,v):(ue(),C(m[A],1,1,()=>{m[A]=null}),me(),r=m[a],r?r.p(u,v):(r=m[a]=_[a](u),r.c()),j(r,1),r.m(i.parentNode,i))},i(u){s||(j(e.$$.fragment,u),j(n.$$.fragment,u),j(r),s=!0)},o(u){C(e.$$.fragment,u),C(n.$$.fragment,u),C(r),s=!1},d(u){u&&(b(o),b(l),b(i)),q(e,u),q(n,u),m[a].d(u)}}}function _n(t){let e,o,n,l,a,r,i,s="Arms",_,m,d,u,v="Movements",E,N,A,k,$,f,p=(t[9].jat[t[0]].name||"Untitled junction")+"",g,w,U=de(t[9].jat[t[0]][t[1]])+"",Q,P,Z,se,T;const ce=t[18].default,Y=ut(ce,t,t[34],null);o=new Bt({props:{label:"Tools",$$slots:{default:[wn]},$$scope:{ctx:t}}});function $e(c){t[23](c)}let he={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(he.value=t[2]),l=new Be({props:he}),oe.push(()=>re(l,"value",$e));let fe=ge(t[9].jat[t[0]][t[1]].arms),S=[];for(let c=0;c<fe.length;c+=1)S[c]=nt(tt(t,fe,c));const W=c=>C(S[c],1,1,()=>{S[c]=null});let V=t[9].jat[t[0]][t[10]].arms.length>0&&ot(t),h=ge(t[9].jat[t[0]][t[1]].movements),M=[];for(let c=0;c<h.length;c+=1)M[c]=lt(et(t,h,c));const I=c=>C(M[c],1,1,()=>{M[c]=null});let K=t[9].jat[t[0]][t[10]].movements.length>0&&rt(t);return{c(){Y&&Y.c(),e=O(),D(o.$$.fragment),n=O(),D(l.$$.fragment),r=O(),i=x("h3"),i.textContent=s,_=O();for(let c=0;c<S.length;c+=1)S[c].c();m=O(),V&&V.c(),d=O(),u=x("h3"),u.textContent=v,E=O(),N=x("p"),A=J("Total JAT score for "),k=J(t[1]),$=O(),f=x("u"),g=J(p),w=J(`
        : `),Q=J(U),P=O();for(let c=0;c<M.length;c+=1)M[c].c();Z=O(),K&&K.c(),se=pe()},l(c){Y&&Y.l(c),e=H(c),z(o.$$.fragment,c),n=H(c),z(l.$$.fragment,c),r=H(c),i=ee(c,"H3",{"data-svelte-h":!0}),Ge(i)!=="svelte-ld74qb"&&(i.textContent=s),_=H(c);for(let _e=0;_e<S.length;_e+=1)S[_e].l(c);m=H(c),V&&V.l(c),d=H(c),u=ee(c,"H3",{"data-svelte-h":!0}),Ge(u)!=="svelte-1dc52s8"&&(u.textContent=v),E=H(c),N=ee(c,"P",{});var y=ne(N);A=G(y,"Total JAT score for "),k=G(y,t[1]),$=H(y),f=ee(y,"U",{});var ae=ne(f);g=G(ae,p),ae.forEach(b),w=G(y,`
        : `),Q=G(y,U),y.forEach(b),P=H(c);for(let _e=0;_e<M.length;_e+=1)M[_e].l(c);Z=H(c),K&&K.l(c),se=pe()},m(c,y){Y&&Y.m(c,y),L(c,e,y),B(o,c,y),L(c,n,y),B(l,c,y),L(c,r,y),L(c,i,y),L(c,_,y);for(let ae=0;ae<S.length;ae+=1)S[ae]&&S[ae].m(c,y);L(c,m,y),V&&V.m(c,y),L(c,d,y),L(c,u,y),L(c,E,y),L(c,N,y),F(N,A),F(N,k),F(N,$),F(N,f),F(f,g),F(N,w),F(N,Q),L(c,P,y);for(let ae=0;ae<M.length;ae+=1)M[ae]&&M[ae].m(c,y);L(c,Z,y),K&&K.m(c,y),L(c,se,y),T=!0},p(c,y){Y&&Y.p&&(!T||y[1]&8)&&mt(Y,ce,c,c[34],T?_t(ce,c[34],y,null):ct(c[34]),null);const ae={};y[0]&224|y[1]&8&&(ae.$$scope={dirty:y,ctx:c}),o.$set(ae);const _e={};if(!a&&y[0]&4&&(a=!0,_e.value=c[2],le(()=>a=!1)),l.$set(_e),y[0]&2579){fe=ge(c[9].jat[c[0]][c[1]].arms);let R;for(R=0;R<fe.length;R+=1){const Le=tt(c,fe,R);S[R]?(S[R].p(Le,y),j(S[R],1)):(S[R]=nt(Le),S[R].c(),j(S[R],1),S[R].m(m.parentNode,m))}for(ue(),R=fe.length;R<S.length;R+=1)W(R);me()}if(c[9].jat[c[0]][c[10]].arms.length>0?V?(V.p(c,y),y[0]&513&&j(V,1)):(V=ot(c),V.c(),j(V,1),V.m(d.parentNode,d)):V&&(ue(),C(V,1,1,()=>{V=null}),me()),(!T||y[0]&2)&&ie(k,c[1]),(!T||y[0]&513)&&p!==(p=(c[9].jat[c[0]].name||"Untitled junction")+"")&&ie(g,p),(!T||y[0]&515)&&U!==(U=de(c[9].jat[c[0]][c[1]])+"")&&ie(Q,U),y[0]&133651){h=ge(c[9].jat[c[0]][c[1]].movements);let R;for(R=0;R<h.length;R+=1){const Le=et(c,h,R);M[R]?(M[R].p(Le,y),j(M[R],1)):(M[R]=lt(Le),M[R].c(),j(M[R],1),M[R].m(Z.parentNode,Z))}for(ue(),R=h.length;R<M.length;R+=1)I(R);me()}c[9].jat[c[0]][c[10]].movements.length>0?K?(K.p(c,y),y[0]&513&&j(K,1)):(K=rt(c),K.c(),j(K,1),K.m(se.parentNode,se)):K&&(ue(),C(K,1,1,()=>{K=null}),me())},i(c){if(!T){j(Y,c),j(o.$$.fragment,c),j(l.$$.fragment,c);for(let y=0;y<fe.length;y+=1)j(S[y]);j(V);for(let y=0;y<h.length;y+=1)j(M[y]);j(K),T=!0}},o(c){C(Y,c),C(o.$$.fragment,c),C(l.$$.fragment,c),S=S.filter(Boolean);for(let y=0;y<S.length;y+=1)C(S[y]);C(V),M=M.filter(Boolean);for(let y=0;y<M.length;y+=1)C(M[y]);C(K),T=!1},d(c){c&&(b(e),b(n),b(r),b(i),b(_),b(m),b(d),b(u),b(E),b(N),b(P),b(Z),b(se)),Y&&Y.d(c),q(o,c),q(l,c),Me(S,c),V&&V.d(c),Me(M,c),K&&K.d(c)}}}function gn(t){let e;return{c(){e=J("Save")},l(o){e=G(o,"Save")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function dn(t){let e;return{c(){e=J("Delete")},l(o){e=G(o,"Delete")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function pn(t){let e,o,n;function l(r){t[30](r)}let a={label:"Arm Name"};return t[9].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(a.value=t[9].jat[t[0]][t[1]].arms[t[3].idx].name),e=new Fe({props:a}),oe.push(()=>re(e,"value",l)),{c(){D(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,i){B(e,r,i),n=!0},p(r,i){const s={};!o&&i[0]&523&&(o=!0,s.value=r[9].jat[r[0]][r[1]].arms[r[3].idx].name,le(()=>o=!1)),e.$set(s)},i(r){n||(j(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function $n(t){let e,o,n,l,a,r;return e=new un({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),n=new Ue({props:{$$slots:{default:[hn]},$$scope:{ctx:t}}}),n.$on("click",t[12]),a=new Oe({props:{$$slots:{default:[bn]},$$scope:{ctx:t}}}),a.$on("click",t[13]),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment),l=O(),D(a.$$.fragment)},l(i){z(e.$$.fragment,i),o=H(i),z(n.$$.fragment,i),l=H(i),z(a.$$.fragment,i)},m(i,s){B(e,i,s),L(i,o,s),B(n,i,s),L(i,l,s),B(a,i,s),r=!0},p(i,s){const _={};s[0]&1&&(_.junctionIdx=i[0]),s[0]&2&&(_.stage=i[1]),s[0]&8&&(_.idx=i[3].idx),e.$set(_);const m={};s[1]&8&&(m.$$scope={dirty:s,ctx:i}),n.$set(m);const d={};s[1]&8&&(d.$$scope={dirty:s,ctx:i}),a.$set(d)},i(i){r||(j(e.$$.fragment,i),j(n.$$.fragment,i),j(a.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),C(n.$$.fragment,i),C(a.$$.fragment,i),r=!1},d(i){i&&(b(o),b(l)),q(e,i),q(n,i),q(a,i)}}}function hn(t){let e;return{c(){e=J("Save")},l(o){e=G(o,"Save")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function bn(t){let e;return{c(){e=J("Delete")},l(o){e=G(o,"Delete")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function kn(t){let e;return{c(){e=J("Zoom to fit")},l(o){e=G(o,"Zoom to fit")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function vn(t){let e;return{c(){e=J("Show scheme context")},l(o){e=G(o,"Show scheme context")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function wn(t){var k;let e,o,n,l,a,r,i,s,_,m,d,u;e=new Ce({props:{$$slots:{default:[kn]},$$scope:{ctx:t}}}),e.$on("click",t[20]),n=new At({}),a=new Pt({});function v($){t[21]($)}let E={map:(k=t[7])==null?void 0:k.getMap()};t[5]!==void 0&&(E.enabled=t[5]),i=new Dt({props:E}),oe.push(()=>re(i,"enabled",v));function N($){t[22]($)}let A={$$slots:{default:[vn]},$$scope:{ctx:t}};return t[6]!==void 0&&(A.checked=t[6]),m=new zt({props:A}),oe.push(()=>re(m,"checked",N)),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment),l=O(),D(a.$$.fragment),r=O(),D(i.$$.fragment),_=O(),D(m.$$.fragment)},l($){z(e.$$.fragment,$),o=H($),z(n.$$.fragment,$),l=H($),z(a.$$.fragment,$),r=H($),z(i.$$.fragment,$),_=H($),z(m.$$.fragment,$)},m($,f){B(e,$,f),L($,o,f),B(n,$,f),L($,l,f),B(a,$,f),L($,r,f),B(i,$,f),L($,_,f),B(m,$,f),u=!0},p($,f){var U;const p={};f[1]&8&&(p.$$scope={dirty:f,ctx:$}),e.$set(p);const g={};f[0]&128&&(g.map=(U=$[7])==null?void 0:U.getMap()),!s&&f[0]&32&&(s=!0,g.enabled=$[5],le(()=>s=!1)),i.$set(g);const w={};f[1]&8&&(w.$$scope={dirty:f,ctx:$}),!d&&f[0]&64&&(d=!0,w.checked=$[6],le(()=>d=!1)),m.$set(w)},i($){u||(j(e.$$.fragment,$),j(n.$$.fragment,$),j(a.$$.fragment,$),j(i.$$.fragment,$),j(m.$$.fragment,$),u=!0)},o($){C(e.$$.fragment,$),C(n.$$.fragment,$),C(a.$$.fragment,$),C(i.$$.fragment,$),C(m.$$.fragment,$),u=!1},d($){$&&(b(o),b(l),b(r),b(_)),q(e,$),q(n,$),q(a,$),q(i,$),q(m,$)}}}function nt(t){let e,o;function n(){return t[24](t[39])}function l(){return t[25](t[39])}return e=new qe({props:{name:`${at(t[39])} - ${t[40].name||"Unnamed arm"}`}}),e.$on("click",n),e.$on("mouseenter",l),e.$on("mouseleave",t[26]),{c(){D(e.$$.fragment)},l(a){z(e.$$.fragment,a)},m(a,r){B(e,a,r),o=!0},p(a,r){t=a;const i={};r[0]&515&&(i.name=`${at(t[39])} - ${t[40].name||"Unnamed arm"}`),e.$set(i)},i(a){o||(j(e.$$.fragment,a),o=!0)},o(a){C(e.$$.fragment,a),o=!1},d(a){q(e,a)}}}function ot(t){let e,o;return e=new Ce({props:{$$slots:{default:[jn]},$$scope:{ctx:t}}}),e.$on("click",t[15]),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l[1]&8&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function jn(t){let e,o;return{c(){e=J("Copy arms from "),o=J(t[10])},l(n){e=G(n,"Copy arms from "),o=G(n,t[10])},m(n,l){L(n,e,l),L(n,o,l)},p:Ee,d(n){n&&(b(e),b(o))}}}function Cn(t){let e,o,n,l=t[36].score+"",a,r,i,s=Re(t[36].kind)+"",_;return{c(){e=x("div"),o=x("span"),n=J("Score: "),a=J(l),r=O(),i=x("span"),_=J(s),this.h()},l(m){e=ee(m,"DIV",{style:!0});var d=ne(e);o=ee(d,"SPAN",{style:!0});var u=ne(o);n=G(u,"Score: "),a=G(u,l),u.forEach(b),r=H(d),i=ee(d,"SPAN",{});var v=ne(i);_=G(v,s),v.forEach(b),d.forEach(b),this.h()},h(){X(o,"padding","4px"),X(o,"color",t[37].font),X(o,"background-color",t[37].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(m,d){L(m,e,d),F(e,o),F(o,n),F(o,a),F(e,r),F(e,i),F(i,_)},p(m,d){d[0]&515&&l!==(l=m[36].score+"")&&ie(a,l),d[0]&515&&X(o,"color",m[37].font),d[0]&515&&X(o,"background-color",m[37].background),d[0]&515&&s!==(s=Re(m[36].kind)+"")&&ie(_,s)},d(m){m&&b(e)}}}function lt(t){let e,o;function n(){return t[27](t[39])}function l(){return t[28](t[39])}return e=new qe({props:{name:t[36].name||"Unnamed movement",$$slots:{default:[Cn]},$$scope:{ctx:t}}}),e.$on("click",n),e.$on("mouseenter",l),e.$on("mouseleave",t[29]),{c(){D(e.$$.fragment)},l(a){z(e.$$.fragment,a)},m(a,r){B(e,a,r),o=!0},p(a,r){t=a;const i={};r[0]&515&&(i.name=t[36].name||"Unnamed movement"),r[0]&515|r[1]&8&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(a){o||(j(e.$$.fragment,a),o=!0)},o(a){C(e.$$.fragment,a),o=!1},d(a){q(e,a)}}}function rt(t){let e,o;return e=new Ce({props:{$$slots:{default:[Ln]},$$scope:{ctx:t}}}),e.$on("click",t[16]),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l[1]&8&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function Ln(t){let e,o;return{c(){e=J("Copy movements from "),o=J(t[10])},l(n){e=G(n,"Copy movements from "),o=G(n,t[10])},m(n,l){L(n,e,l),L(n,o,l)},p:Ee,d(n){n&&(b(e),b(o))}}}function Sn(t){let e,o,n,l,a,r,i,s=de(t[9].jat[t[0]].existing)+"",_,m,d,u=de(t[9].jat[t[0]].proposed)+"",v,E,N,A,k,$,f,p,g,w,U,Q,P,Z;function se(S){t[19](S)}let T={label:"Commentary / Notes about "+t[1]+" junction"};t[9].jat[t[0]][t[1]].notes!==void 0&&(T.value=t[9].jat[t[0]][t[1]].notes),o=new dt({props:T}),oe.push(()=>re(o,"value",se));const ce=[_n,cn],Y=[];function $e(S,W){return S[3]==null?0:1}$=$e(t),f=Y[$]=ce[$](t);function he(S){t[33](S)}let fe={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6],select:t[11],stopEditing:t[12]};return t[3]!==void 0&&(fe.editing=t[3]),w=new an({props:fe}),t[32](w),oe.push(()=>re(w,"editing",he)),{c(){e=x("div"),D(o.$$.fragment),l=O(),a=x("p"),r=J("Total JAT score: "),i=x("b"),_=J(s),m=J(`
    existing,
    `),d=x("b"),v=J(u),E=J(`
    proposed`),N=O(),A=x("div"),k=x("div"),f.c(),p=O(),g=x("div"),D(w.$$.fragment),this.h()},l(S){e=ee(S,"DIV",{class:!0});var W=ne(e);z(o.$$.fragment,W),l=H(W),a=ee(W,"P",{});var V=ne(a);r=G(V,"Total JAT score: "),i=ee(V,"B",{});var h=ne(i);_=G(h,s),h.forEach(b),m=G(V,`
    existing,
    `),d=ee(V,"B",{});var M=ne(d);v=G(M,u),M.forEach(b),E=G(V,`
    proposed`),V.forEach(b),W.forEach(b),N=H(S),A=ee(S,"DIV",{style:!0});var I=ne(A);k=ee(I,"DIV",{style:!0});var K=ne(k);f.l(K),K.forEach(b),p=H(I),g=ee(I,"DIV",{style:!0});var c=ne(g);z(w.$$.fragment,c),c.forEach(b),I.forEach(b),this.h()},h(){ve(e,"class","govuk-width-container"),X(k,"width","30%"),X(k,"overflow-y","scroll"),X(k,"padding","10px"),X(k,"border","1px solid black"),X(g,"position","relative"),X(g,"width","100%"),X(A,"display","flex"),X(A,"height","80vh")},m(S,W){L(S,e,W),B(o,e,null),F(e,l),F(e,a),F(a,r),F(a,i),F(i,_),F(a,m),F(a,d),F(d,v),F(a,E),L(S,N,W),L(S,A,W),F(A,k),Y[$].m(k,null),t[31](k),F(A,p),F(A,g),B(w,g,null),Q=!0,P||(Z=kt(mn,"keydown",t[14]),P=!0)},p(S,W){const V={};W[0]&2&&(V.label="Commentary / Notes about "+S[1]+" junction"),!n&&W[0]&515&&(n=!0,V.value=S[9].jat[S[0]][S[1]].notes,le(()=>n=!1)),o.$set(V),(!Q||W[0]&513)&&s!==(s=de(S[9].jat[S[0]].existing)+"")&&ie(_,s),(!Q||W[0]&513)&&u!==(u=de(S[9].jat[S[0]].proposed)+"")&&ie(v,u);let h=$;$=$e(S),$===h?Y[$].p(S,W):(ue(),C(Y[h],1,1,()=>{Y[h]=null}),me(),f=Y[$],f?f.p(S,W):(f=Y[$]=ce[$](S),f.c()),j(f,1),f.m(k,null));const M={};W[0]&1&&(M.junctionIdx=S[0]),W[0]&2&&(M.stage=S[1]),W[0]&4&&(M.newKind=S[2]),W[0]&16&&(M.hoveringSidebar=S[4]),W[0]&32&&(M.streetviewOn=S[5]),W[0]&64&&(M.showContext=S[6]),!U&&W[0]&8&&(U=!0,M.editing=S[3],le(()=>U=!1)),w.$set(M)},i(S){Q||(j(o.$$.fragment,S),j(f),j(w.$$.fragment,S),Q=!0)},o(S){C(o.$$.fragment,S),C(f),C(w.$$.fragment,S),Q=!1},d(S){S&&(b(e),b(N),b(A)),q(o),Y[$].d(),t[31](null),t[32](null),q(w),P=!1,Z()}}}function at(t){return String.fromCharCode(t+65)}function Mn(t,e,o){let n;Ne(t,te,I=>o(9,n=I));let{$$slots:l={},$$scope:a}=e,{junctionIdx:r}=e,{stage:i}=e,s=i=="existing"?"proposed":"existing",_="arm",m=null,d=null,u=null,v=!1,E=!0,N=null,A;async function k(I){d=A.scrollTop,o(3,m=I),o(4,u=null),await Je(),o(8,A.scrollTop=0,A)}async function $(){o(3,m=null),d!=null&&(await Je(),o(8,A.scrollTop=d,A),d=null)}function f(){window.confirm(`Delete this ${m.kind}?`)&&(m.kind=="movement"?(n.jat[r][i].movements.splice(m.idx,1),te.set(n)):(n.jat[r][i].arms.splice(m.idx,1),te.set(n)),$())}function p(I){if(m==null)return;let K=I.target.tagName,c=K=="INPUT"||K=="TEXTAREA";I.key=="Escape"||I.key=="Enter"&&!c?(I.stopPropagation(),$()):I.key=="Delete"&&!c&&(I.stopPropagation(),f())}function g(){n.jat[r][i].arms.length>0&&!window.confirm("Overwrite arms?")||(Se(te,n.jat[r][i].arms=JSON.parse(JSON.stringify(n.jat[r][s].arms)),n),te.set(n))}function w(){n.jat[r][i].movements.length>0&&!window.confirm("Overwrite movements?")||(Se(te,n.jat[r][i].movements=JSON.parse(JSON.stringify(n.jat[r][s].movements)),n),te.set(n))}let U={0:be.red,1:be.amber,2:be.green,X:be.critical};function Q(I){t.$$.not_equal(n.jat[r][i].notes,I)&&(n.jat[r][i].notes=I,te.set(n))}const P=()=>N==null?void 0:N.zoom(!0);function Z(I){v=I,o(5,v)}function se(I){E=I,o(6,E)}function T(I){_=I,o(2,_)}const ce=I=>k({kind:"arm",idx:I}),Y=I=>o(4,u={kind:"arm",idx:I}),$e=()=>o(4,u=null),he=I=>k({kind:"movement",idx:I}),fe=I=>o(4,u={kind:"movement",idx:I}),S=()=>o(4,u=null);function W(I){t.$$.not_equal(n.jat[r][i].arms[m.idx].name,I)&&(n.jat[r][i].arms[m.idx].name=I,te.set(n))}function V(I){oe[I?"unshift":"push"](()=>{A=I,o(8,A)})}function h(I){oe[I?"unshift":"push"](()=>{N=I,o(7,N)})}function M(I){m=I,o(3,m)}return t.$$set=I=>{"junctionIdx"in I&&o(0,r=I.junctionIdx),"stage"in I&&o(1,i=I.stage),"$$scope"in I&&o(34,a=I.$$scope)},[r,i,_,m,u,v,E,N,A,n,s,k,$,f,p,g,w,U,l,Q,P,Z,se,T,ce,Y,$e,he,fe,S,W,V,h,M,a]}class En extends Ie{constructor(e){super(),Te(this,e,Mn,Sn,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function it(t,e,o){const n=t.slice();return n[10]=e[o],n[12]=o,n}function In(t){let e,o,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",l,a,r=t[0].stage+"",i,s,_,m,d,u,v,E=t[0].stage,N,A;_=new vt({props:{$$slots:{default:[An]},$$scope:{ctx:t}}});function k(p){t[7](p)}let $={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&($.value=t[1].jat[t[0].idx].name),d=new Fe({props:$}),oe.push(()=>re(d,"value",k));let f=st(t);return{c(){e=x("div"),o=x("h2"),l=J(n),a=J(" - "),i=J(r),s=O(),D(_.$$.fragment),m=O(),D(d.$$.fragment),v=O(),f.c(),N=pe(),this.h()},l(p){e=ee(p,"DIV",{class:!0});var g=ne(e);o=ee(g,"H2",{});var w=ne(o);l=G(w,n),a=G(w," - "),i=G(w,r),w.forEach(b),s=H(g),z(_.$$.fragment,g),m=H(g),z(d.$$.fragment,g),g.forEach(b),v=H(p),f.l(p),N=pe(),this.h()},h(){ve(e,"class","govuk-width-container")},m(p,g){L(p,e,g),F(e,o),F(o,l),F(o,a),F(o,i),F(e,s),B(_,e,null),F(e,m),B(d,e,null),L(p,v,g),f.m(p,g),L(p,N,g),A=!0},p(p,g){(!A||g&3)&&n!==(n=(p[1].jat[p[0].idx].name||"Untitled junction")+"")&&ie(l,n),(!A||g&1)&&r!==(r=p[0].stage+"")&&ie(i,r);const w={};g&8193&&(w.$$scope={dirty:g,ctx:p}),_.$set(w);const U={};!u&&g&3&&(u=!0,U.value=p[1].jat[p[0].idx].name,le(()=>u=!1)),d.$set(U),g&1&&je(E,E=p[0].stage)?(ue(),C(f,1,1,Ee),me(),f=st(p),f.c(),j(f,1),f.m(N.parentNode,N)):f.p(p,g)},i(p){A||(j(_.$$.fragment,p),j(d.$$.fragment,p),j(f),A=!0)},o(p){C(_.$$.fragment,p),C(d.$$.fragment,p),C(f),A=!1},d(p){p&&(b(e),b(v),b(N)),q(_),q(d),f.d(p)}}}function Tn(t){let e,o,n,l;o=new Ue({props:{$$slots:{default:[Un]},$$scope:{ctx:t}}}),o.$on("click",t[2]);let a=ge(t[1].jat),r=[];for(let s=0;s<a.length;s+=1)r[s]=ft(it(t,a,s));const i=s=>C(r[s],1,1,()=>{r[s]=null});return{c(){e=x("div"),D(o.$$.fragment),n=O();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=ee(s,"DIV",{class:!0});var _=ne(e);z(o.$$.fragment,_),n=H(_);for(let m=0;m<r.length;m+=1)r[m].l(_);_.forEach(b),this.h()},h(){ve(e,"class","govuk-width-container")},m(s,_){L(s,e,_),B(o,e,null),F(e,n);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null);l=!0},p(s,_){const m={};if(_&8192&&(m.$$scope={dirty:_,ctx:s}),o.$set(m),_&3){a=ge(s[1].jat);let d;for(d=0;d<a.length;d+=1){const u=it(s,a,d);r[d]?(r[d].p(u,_),j(r[d],1)):(r[d]=ft(u),r[d].c(),j(r[d],1),r[d].m(e,null))}for(ue(),d=a.length;d<r.length;d+=1)i(d);me()}},i(s){if(!l){j(o.$$.fragment,s);for(let _=0;_<a.length;_+=1)j(r[_]);l=!0}},o(s){C(o.$$.fragment,s),r=r.filter(Boolean);for(let _=0;_<r.length;_+=1)C(r[_]);l=!1},d(s){s&&b(e),q(o),Me(r,s)}}}function yn(t){let e;return{c(){e=J("Back to all junctions")},l(o){e=G(o,"Back to all junctions")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function Nn(t){let e;return{c(){e=J("Delete junction")},l(o){e=G(o,"Delete junction")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function An(t){let e,o,n,l;return e=new Ce({props:{$$slots:{default:[yn]},$$scope:{ctx:t}}}),e.$on("click",t[5]),n=new Oe({props:{$$slots:{default:[Nn]},$$scope:{ctx:t}}}),n.$on("click",t[6]),{c(){D(e.$$.fragment),o=O(),D(n.$$.fragment)},l(a){z(e.$$.fragment,a),o=H(a),z(n.$$.fragment,a)},m(a,r){B(e,a,r),L(a,o,r),B(n,a,r),l=!0},p(a,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const s={};r&8192&&(s.$$scope={dirty:r,ctx:a}),n.$set(s)},i(a){l||(j(e.$$.fragment,a),j(n.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(n.$$.fragment,a),l=!1},d(a){a&&b(o),q(e,a),q(n,a)}}}function Pn(t){let e,o;return e=new Ce({props:{$$slots:{default:[zn]},$$scope:{ctx:t}}}),e.$on("click",t[9]),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l&8192&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function Dn(t){let e,o;return e=new Ce({props:{$$slots:{default:[Bn]},$$scope:{ctx:t}}}),e.$on("click",t[8]),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l&8192&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function zn(t){let e;return{c(){e=J("Edit Proposed")},l(o){e=G(o,"Edit Proposed")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function Bn(t){let e;return{c(){e=J("Edit Existing")},l(o){e=G(o,"Edit Existing")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function qn(t){let e,o,n=t[0].stage+"",l,a,r,i=t[1].jat[t[0].idx].name+"",s,_,m,d,u,v;const E=[Dn,Pn],N=[];function A(k,$){return k[0].stage=="proposed"?0:1}return m=A(t),d=N[m]=E[m](t),{c(){e=x("p"),o=J("Currently editing "),l=J(n),a=J(` junction
        `),r=x("u"),s=J(i),_=O(),d.c(),u=pe()},l(k){e=ee(k,"P",{});var $=ne(e);o=G($,"Currently editing "),l=G($,n),a=G($,` junction
        `),r=ee($,"U",{});var f=ne(r);s=G(f,i),f.forEach(b),$.forEach(b),_=H(k),d.l(k),u=pe()},m(k,$){L(k,e,$),F(e,o),F(e,l),F(e,a),F(e,r),F(r,s),L(k,_,$),N[m].m(k,$),L(k,u,$),v=!0},p(k,$){(!v||$&1)&&n!==(n=k[0].stage+"")&&ie(l,n),(!v||$&3)&&i!==(i=k[1].jat[k[0].idx].name+"")&&ie(s,i);let f=m;m=A(k),m===f?N[m].p(k,$):(ue(),C(N[f],1,1,()=>{N[f]=null}),me(),d=N[m],d?d.p(k,$):(d=N[m]=E[m](k),d.c()),j(d,1),d.m(u.parentNode,u))},i(k){v||(j(d),v=!0)},o(k){C(d),v=!1},d(k){k&&(b(e),b(_),b(u)),N[m].d(k)}}}function st(t){let e,o;return e=new En({props:{junctionIdx:t[0].idx,stage:t[0].stage,$$slots:{default:[qn]},$$scope:{ctx:t}}}),{c(){D(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){B(e,n,l),o=!0},p(n,l){const a={};l&1&&(a.junctionIdx=n[0].idx),l&1&&(a.stage=n[0].stage),l&8195&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){o||(j(e.$$.fragment,n),o=!0)},o(n){C(e.$$.fragment,n),o=!1},d(n){q(e,n)}}}function Un(t){let e;return{c(){e=J("Add new junction")},l(o){e=G(o,"Add new junction")},m(o,n){L(o,e,n)},d(o){o&&b(e)}}}function Fn(t){let e,o,n,l=de(t[10].existing)+"",a,r,i,s,_=de(t[10].proposed)+"",m,d;return{c(){e=x("div"),o=x("span"),n=J("Existing: "),a=J(l),r=O(),i=x("span"),s=J("Proposed: "),m=J(_),d=O(),this.h()},l(u){e=ee(u,"DIV",{style:!0});var v=ne(e);o=ee(v,"SPAN",{});var E=ne(o);n=G(E,"Existing: "),a=G(E,l),E.forEach(b),r=H(v),i=ee(v,"SPAN",{});var N=ne(i);s=G(N,"Proposed: "),m=G(N,_),N.forEach(b),v.forEach(b),d=H(u),this.h()},h(){X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(u,v){L(u,e,v),F(e,o),F(o,n),F(o,a),F(e,r),F(e,i),F(i,s),F(i,m),L(u,d,v)},p(u,v){v&2&&l!==(l=de(u[10].existing)+"")&&ie(a,l),v&2&&_!==(_=de(u[10].proposed)+"")&&ie(m,_)},d(u){u&&(b(e),b(d))}}}function ft(t){let e,o;function n(){return t[4](t[12])}return e=new qe({props:{name:t[10].name||"Untitled junction",$$slots:{default:[Fn]},$$scope:{ctx:t}}}),e.$on("click",n),{c(){D(e.$$.fragment)},l(l){z(e.$$.fragment,l)},m(l,a){B(e,l,a),o=!0},p(l,a){t=l;const r={};a&2&&(r.name=t[10].name||"Untitled junction"),a&8194&&(r.$$scope={dirty:a,ctx:t}),e.$set(r)},i(l){o||(j(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){q(e,l)}}}function On(t){let e,o,n,l;const a=[Tn,In],r=[];function i(s,_){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=i(t))&&(o=r[e]=a[e](t)),{c(){o&&o.c(),n=pe()},l(s){o&&o.l(s),n=pe()},m(s,_){~e&&r[e].m(s,_),L(s,n,_),l=!0},p(s,[_]){let m=e;e=i(s),e===m?~e&&r[e].p(s,_):(o&&(ue(),C(r[m],1,1,()=>{r[m]=null}),me()),~e?(o=r[e],o?o.p(s,_):(o=r[e]=a[e](s),o.c()),j(o,1),o.m(n.parentNode,n)):o=null)},i(s){l||(j(o),l=!0)},o(s){C(o),l=!1},d(s){s&&b(n),~e&&r[e].d(s)}}}function Ae(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function Hn(t,e,o){let n;Ne(t,te,v=>o(1,n=v));let l={kind:"list"};function a(){Se(te,n.jat=[...n.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],n),o(0,l={kind:"edit",idx:n.jat.length-1,stage:"existing"})}function r(v){window.confirm("Delete this junction?")&&(n.jat.splice(v,1),te.set(n),o(0,l={kind:"list"}))}const i=v=>o(0,l={kind:"edit",idx:v,stage:"existing"}),s=()=>o(0,l={kind:"list"}),_=()=>r(Ae(l));function m(v){t.$$.not_equal(n.jat[l.idx].name,v)&&(n.jat[l.idx].name=v,te.set(n))}return[l,n,a,r,i,s,_,m,()=>o(0,l={kind:"edit",idx:Ae(l),stage:"existing"}),()=>o(0,l={kind:"edit",idx:Ae(l),stage:"proposed"})]}class fo extends Ie{constructor(e){super(),Te(this,e,Hn,On,je,{})}}export{fo as component};
