import{s as Z,a7 as Ce,U as ne,a8 as ye,v as V,a as A,g as S,i as y,x as O,f as _,k as ie,t as P,d as W,j as K,M as ke,e as j,c as F,b as U,w as J,h as M,r as Le,p as Ee,n as Y,q as we}from"../chunks/scheduler.d-ZThAIN.js";import{S as x,i as ee,e as R,c as C,a as L,m as E,t as h,g as z,b,f as Q,d as D}from"../chunks/index.BKLGIcjh.js";import{e as X}from"../chunks/each.5I2k8VTY.js";import{p as De}from"../chunks/index.Dwo8rjcy.js";import{S as Be,W as Ae}from"../chunks/WarningButton.CXBTrJR0.js";import{S as ue}from"../chunks/Select.DYDTV9Cm.js";import{T as Se}from"../chunks/TextArea.pNjiCJX9.js";import{T as Ne}from"../chunks/TextInput.DLFUCrlZ.js";import{s as T}from"../chunks/data.Cs7yq2xZ.js";import{Y as Me}from"../chunks/YesNo.BAxctd1g.js";import{D as Te}from"../chunks/DefaultButton.gdQzz5EL.js";import{B as Pe,G as We,a as qe}from"../chunks/GeoreferenceLayer.DLvLAXFb.js";import{m as pe,M as je,G as Fe}from"../chunks/MapLibreMap.BlItvk8j.js";import{C as Ge}from"../chunks/CircleLayer.s5C8BDJL.js";function Ve(n,t,i){let e=Ce(),{map:a}=t,{position:u}=t,r=null;return ne(()=>{r=new pe.Marker({draggable:!0}).setLngLat(new pe.LngLat(u[0],u[1])).addTo(a),r.on("dragstart",()=>{a.getCanvas().style.cursor="grabbing"}),r.on("drag",()=>{i(0,u=r.getLngLat().toArray())}),r.on("dragend",()=>{a.getCanvas().style.cursor="inherit",e("dragEnd")}),r.getElement().addEventListener("click",l=>{l.stopPropagation(),e("click")})}),ye(()=>{r==null||r.remove()}),n.$$set=l=>{"map"in l&&i(1,a=l.map),"position"in l&&i(0,u=l.position)},[u,a]}class Oe extends x{constructor(t){super(),ee(this,t,Ve,null,Z,{map:1,position:0})}}function me(n){let t,i;return t=new Be({props:{$$slots:{default:[Re]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){C(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,a){E(t,e,a),i=!0},p(e,a){const u={};a&2050&&(u.$$scope={dirty:a,ctx:e}),t.$set(u)},i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){D(t,e)}}}function Re(n){let t,i;return{c(){t=P("Use lookup: "),i=P(n[1])},l(e){t=W(e,"Use lookup: "),i=W(e,n[1])},m(e,a){y(e,t,a),y(e,i,a)},p(e,a){a&2&&K(i,e[1])},d(e){e&&(_(t),_(i))}}}function Ue(n){let t,i,e,a,u,r,l,o,s,p,c,m,$,g,N,B;function G(f){n[5](f)}let I={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(I.value=n[2].criticalIssues[n[0]].criticalIssue),t=new ue({props:I}),V.push(()=>R(t,"value",G));function te(f){n[6](f)}let H={label:"Stage",emptyOption:!0,choices:De(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(H.value=n[2].criticalIssues[n[0]].stage),a=new ue({props:H}),V.push(()=>R(a,"value",te));function d(f){n[7](f)}let k={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(k.value=n[2].criticalIssues[n[0]].locationName),l=new Ne({props:k}),V.push(()=>R(l,"value",d));let v=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&me(n);function q(f){n[8](f)}let se={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(se.value=n[2].criticalIssues[n[0]].resolved),c=new Me({props:se}),V.push(()=>R(c,"value",q));function Ie(f){n[9](f)}let ae={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(ae.value=n[2].criticalIssues[n[0]].notes),g=new Se({props:ae}),V.push(()=>R(g,"value",Ie)),{c(){C(t.$$.fragment),e=A(),C(a.$$.fragment),r=A(),C(l.$$.fragment),s=A(),v&&v.c(),p=A(),C(c.$$.fragment),$=A(),C(g.$$.fragment)},l(f){L(t.$$.fragment,f),e=S(f),L(a.$$.fragment,f),r=S(f),L(l.$$.fragment,f),s=S(f),v&&v.l(f),p=S(f),L(c.$$.fragment,f),$=S(f),L(g.$$.fragment,f)},m(f,w){E(t,f,w),y(f,e,w),E(a,f,w),y(f,r,w),E(l,f,w),y(f,s,w),v&&v.m(f,w),y(f,p,w),E(c,f,w),y(f,$,w),E(g,f,w),B=!0},p(f,[w]){const re={};!i&&w&5&&(i=!0,re.value=f[2].criticalIssues[f[0]].criticalIssue,O(()=>i=!1)),t.$set(re);const le={};!u&&w&5&&(u=!0,le.value=f[2].criticalIssues[f[0]].stage,O(()=>u=!1)),a.$set(le);const oe={};!o&&w&5&&(o=!0,oe.value=f[2].criticalIssues[f[0]].locationName,O(()=>o=!1)),l.$set(oe),f[1]&&f[1]!="Loading"&&f[1]!=f[2].criticalIssues[f[0]].locationName?v?(v.p(f,w),w&7&&h(v,1)):(v=me(f),v.c(),h(v,1),v.m(p.parentNode,p)):v&&(z(),b(v,1,1,()=>{v=null}),Q());const fe={};!m&&w&5&&(m=!0,fe.value=f[2].criticalIssues[f[0]].resolved,O(()=>m=!1)),c.$set(fe);const ce={};!N&&w&5&&(N=!0,ce.value=f[2].criticalIssues[f[0]].notes,O(()=>N=!1)),g.$set(ce)},i(f){B||(h(t.$$.fragment,f),h(a.$$.fragment,f),h(l.$$.fragment,f),h(v),h(c.$$.fragment,f),h(g.$$.fragment,f),B=!0)},o(f){b(t.$$.fragment,f),b(a.$$.fragment,f),b(l.$$.fragment,f),b(v),b(c.$$.fragment,f),b(g.$$.fragment,f),B=!1},d(f){f&&(_(e),_(r),_(s),_(p),_($)),D(t,f),D(a,f),D(l,f),v&&v.d(f),D(c,f),D(g,f)}}}function He(n,t,i){let e;ie(n,T,g=>i(2,e=g));let{idx:a}=t,u=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],r="Loading";ne(async()=>{await l(e.criticalIssues[a].point)});async function l(g){let N=`https://nominatim.openstreetmap.org/reverse?lon=${g[0]}&lat=${g[1]}&format=json`;try{let G=await(await fetch(N)).json();i(1,r=G.address.road??G.display_name)}catch(B){return console.log(`Location lookup failed: ${B}`),""}}function o(){ke(T,e.criticalIssues[a].locationName=r,e)}function s(g){n.$$.not_equal(e.criticalIssues[a].criticalIssue,g)&&(e.criticalIssues[a].criticalIssue=g,T.set(e))}function p(g){n.$$.not_equal(e.criticalIssues[a].stage,g)&&(e.criticalIssues[a].stage=g,T.set(e))}function c(g){n.$$.not_equal(e.criticalIssues[a].locationName,g)&&(e.criticalIssues[a].locationName=g,T.set(e))}function m(g){n.$$.not_equal(e.criticalIssues[a].resolved,g)&&(e.criticalIssues[a].resolved=g,T.set(e))}function $(g){n.$$.not_equal(e.criticalIssues[a].notes,g)&&(e.criticalIssues[a].notes=g,T.set(e))}return n.$$set=g=>{"idx"in g&&i(0,a=g.idx)},[a,r,e,u,o,s,p,c,m,$]}class Je extends x{constructor(t){super(),ee(this,t,He,Ue,Z,{idx:0})}}function ge(n,t,i){const e=n.slice();return e[11]=t[i],e[12]=t,e[13]=i,e}function Ke(n){let t,i,e,a,u,r,l,o,s,p;return u=new Te({props:{$$slots:{default:[ze]},$$scope:{ctx:n}}}),u.$on("click",n[5]),l=new Ae({props:{$$slots:{default:[Qe]},$$scope:{ctx:n}}}),l.$on("click",n[4]),s=new Je({props:{idx:n[1]}}),{c(){t=j("p"),i=P("Editing "),e=P(n[1]),a=A(),C(u.$$.fragment),r=A(),C(l.$$.fragment),o=A(),C(s.$$.fragment)},l(c){t=F(c,"P",{});var m=U(t);i=W(m,"Editing "),e=W(m,n[1]),m.forEach(_),a=S(c),L(u.$$.fragment,c),r=S(c),L(l.$$.fragment,c),o=S(c),L(s.$$.fragment,c)},m(c,m){y(c,t,m),M(t,i),M(t,e),y(c,a,m),E(u,c,m),y(c,r,m),E(l,c,m),y(c,o,m),E(s,c,m),p=!0},p(c,m){(!p||m&2)&&K(e,c[1]);const $={};m&16384&&($.$$scope={dirty:m,ctx:c}),u.$set($);const g={};m&16384&&(g.$$scope={dirty:m,ctx:c}),l.$set(g);const N={};m&2&&(N.idx=c[1]),s.$set(N)},i(c){p||(h(u.$$.fragment,c),h(l.$$.fragment,c),h(s.$$.fragment,c),p=!0)},o(c){b(u.$$.fragment,c),b(l.$$.fragment,c),b(s.$$.fragment,c),p=!1},d(c){c&&(_(t),_(a),_(r),_(o)),D(u,c),D(l,c),D(s,c)}}}function Ye(n){let t,i="Click the map to add a pin, or click a pin to fill out data";return{c(){t=j("p"),t.textContent=i},l(e){t=F(e,"P",{"data-svelte-h":!0}),Ee(t)!=="svelte-1rxcdnm"&&(t.textContent=i)},m(e,a){y(e,t,a)},p:Y,i:Y,o:Y,d(e){e&&_(t)}}}function ze(n){let t;return{c(){t=P("Save")},l(i){t=W(i,"Save")},m(i,e){y(i,t,e)},d(i){i&&_(t)}}}function Qe(n){let t;return{c(){t=P("Delete")},l(i){t=W(i,"Delete")},m(i,e){y(i,t,e)},d(i){i&&_(t)}}}function $e(n){let t;return{c(){t=j("div"),this.h()},l(i){t=F(i,"DIV",{class:!0}),U(t).forEach(_),this.h()},h(){Le(t,"class","block-map svelte-13rr2mh")},m(i,e){y(i,t,e)},d(i){i&&_(t)}}}function de(n){let t,i,e;function a(o){n[6](o,n[11])}function u(){return n[7](n[13])}function r(){return n[8](n[13])}let l={map:n[0]};return n[11].point!==void 0&&(l.position=n[11].point),t=new Oe({props:l}),V.push(()=>R(t,"position",a)),t.$on("click",u),t.$on("dragEnd",r),{c(){C(t.$$.fragment)},l(o){L(t.$$.fragment,o)},m(o,s){E(t,o,s),e=!0},p(o,s){n=o;const p={};s&1&&(p.map=n[0]),!i&&s&4&&(i=!0,p.position=n[11].point,O(()=>i=!1)),t.$set(p)},i(o){e||(h(t.$$.fragment,o),e=!0)},o(o){b(t.$$.fragment,o),e=!1},d(o){D(t,o)}}}function _e(n){let t,i;return t=new Fe({props:{data:he(n[2].criticalIssues[n[1]].point),$$slots:{default:[Xe]},$$scope:{ctx:n}}}),{c(){C(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,a){E(t,e,a),i=!0},p(e,a){const u={};a&6&&(u.data=he(e[2].criticalIssues[e[1]].point)),a&16384&&(u.$$scope={dirty:a,ctx:e}),t.$set(u)},i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){D(t,e)}}}function Xe(n){let t,i;return t=new Ge({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){C(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,a){E(t,e,a),i=!0},p:Y,i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){b(t.$$.fragment,e),i=!1},d(e){D(t,e)}}}function Ze(n){let t,i,e,a,u=X(n[2].criticalIssues),r=[];for(let s=0;s<u.length;s+=1)r[s]=de(ge(n,u,s));const l=s=>b(r[s],1,1,()=>{r[s]=null});let o=n[1]!=null&&_e(n);return e=new qe({props:{map:n[0]}}),{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=A(),o&&o.c(),i=A(),C(e.$$.fragment)},l(s){for(let p=0;p<r.length;p+=1)r[p].l(s);t=S(s),o&&o.l(s),i=S(s),L(e.$$.fragment,s)},m(s,p){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,p);y(s,t,p),o&&o.m(s,p),y(s,i,p),E(e,s,p),a=!0},p(s,p){if(p&13){u=X(s[2].criticalIssues);let m;for(m=0;m<u.length;m+=1){const $=ge(s,u,m);r[m]?(r[m].p($,p),h(r[m],1)):(r[m]=de($),r[m].c(),h(r[m],1),r[m].m(t.parentNode,t))}for(z(),m=u.length;m<r.length;m+=1)l(m);Q()}s[1]!=null?o?(o.p(s,p),p&2&&h(o,1)):(o=_e(s),o.c(),h(o,1),o.m(i.parentNode,i)):o&&(z(),b(o,1,1,()=>{o=null}),Q());const c={};p&1&&(c.map=s[0]),e.$set(c)},i(s){if(!a){for(let p=0;p<u.length;p+=1)h(r[p]);h(o),h(e.$$.fragment,s),a=!0}},o(s){r=r.filter(Boolean);for(let p=0;p<r.length;p+=1)b(r[p]);b(o),b(e.$$.fragment,s),a=!1},d(s){s&&(_(t),_(i)),we(r,s),o&&o.d(s),D(e,s)}}}function xe(n){let t,i,e,a,u,r,l,o,s,p,c,m,$,g;const N=[Ye,Ke],B=[];function G(d,k){return d[1]==null?0:1}e=G(n),a=B[e]=N[e](n);let I=n[1]!=null&&$e();function te(d){n[9](d)}let H={$$slots:{default:[Ze]},$$scope:{ctx:n}};return n[0]!==void 0&&(H.map=n[0]),o=new je({props:H}),V.push(()=>R(o,"map",te)),c=new Pe({}),$=new We({}),{c(){t=j("div"),i=j("div"),a.c(),u=A(),r=j("div"),I&&I.c(),l=A(),C(o.$$.fragment),p=A(),C(c.$$.fragment),m=A(),C($.$$.fragment),this.h()},l(d){t=F(d,"DIV",{style:!0});var k=U(t);i=F(k,"DIV",{style:!0});var v=U(i);a.l(v),v.forEach(_),u=S(k),r=F(k,"DIV",{style:!0});var q=U(r);I&&I.l(q),l=S(q),L(o.$$.fragment,q),q.forEach(_),k.forEach(_),p=S(d),L(c.$$.fragment,d),m=S(d),L($.$$.fragment,d),this.h()},h(){J(i,"width","30%"),J(r,"position","relative"),J(r,"width","70%"),J(r,"height","600px"),J(t,"display","flex")},m(d,k){y(d,t,k),M(t,i),B[e].m(i,null),M(t,u),M(t,r),I&&I.m(r,null),M(r,l),E(o,r,null),y(d,p,k),E(c,d,k),y(d,m,k),E($,d,k),g=!0},p(d,[k]){let v=e;e=G(d),e===v?B[e].p(d,k):(z(),b(B[v],1,1,()=>{B[v]=null}),Q(),a=B[e],a?a.p(d,k):(a=B[e]=N[e](d),a.c()),h(a,1),a.m(i,null)),d[1]!=null?I||(I=$e(),I.c(),I.m(r,l)):I&&(I.d(1),I=null);const q={};k&16391&&(q.$$scope={dirty:k,ctx:d}),!s&&k&1&&(s=!0,q.map=d[0],O(()=>s=!1)),o.$set(q)},i(d){g||(h(a),h(o.$$.fragment,d),h(c.$$.fragment,d),h($.$$.fragment,d),g=!0)},o(d){b(a),b(o.$$.fragment,d),b(c.$$.fragment,d),b($.$$.fragment,d),g=!1},d(d){d&&(_(t),_(p),_(m)),B[e].d(),I&&I.d(),D(o),D(c,d),D($,d)}}}function he(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function et(n,t,i){let e;ie(n,T,g=>i(2,e=g));let a,u=null;function r(g){i(1,u=g)}function l(g){ke(T,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:g.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),i(1,u=e.criticalIssues.length-1)}ne(()=>{a.on("click",l)}),ye(()=>{a.off("click",l)});function o(){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(u,1),T.set(e),i(1,u=null))}const s=()=>i(1,u=null);function p(g,N){n.$$.not_equal(N.point,g)&&(N.point=g,T.set(e))}const c=g=>r(g),m=g=>r(g);function $(g){a=g,i(0,a)}return[a,u,e,r,o,s,p,c,m,$]}class tt extends x{constructor(t){super(),ee(this,t,et,xe,Z,{})}}function ve(n,t,i){const e=n.slice();return e[1]=t[i],e}function be(n){let t,i,e=n[1].criticalIssue+"",a,u,r=n[1].stage+"",l,o,s=n[1].locationName+"",p,c;return{c(){t=j("li"),i=P("Critical issue: type="),a=P(e),u=P(", stage="),l=P(r),o=P(", at "),p=P(s),c=A()},l(m){t=F(m,"LI",{});var $=U(t);i=W($,"Critical issue: type="),a=W($,e),u=W($,", stage="),l=W($,r),o=W($,", at "),p=W($,s),c=S($),$.forEach(_)},m(m,$){y(m,t,$),M(t,i),M(t,a),M(t,u),M(t,l),M(t,o),M(t,p),M(t,c)},p(m,$){$&1&&e!==(e=m[1].criticalIssue+"")&&K(a,e),$&1&&r!==(r=m[1].stage+"")&&K(l,r),$&1&&s!==(s=m[1].locationName+"")&&K(p,s)},d(m){m&&_(t)}}}function nt(n){let t,i,e,a,u=X(n[0].criticalIssues),r=[];for(let l=0;l<u.length;l+=1)r[l]=be(ve(n,u,l));return e=new tt({}),{c(){t=j("ol");for(let l=0;l<r.length;l+=1)r[l].c();i=A(),C(e.$$.fragment)},l(l){t=F(l,"OL",{});var o=U(t);for(let s=0;s<r.length;s+=1)r[s].l(o);o.forEach(_),i=S(l),L(e.$$.fragment,l)},m(l,o){y(l,t,o);for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(t,null);y(l,i,o),E(e,l,o),a=!0},p(l,[o]){if(o&1){u=X(l[0].criticalIssues);let s;for(s=0;s<u.length;s+=1){const p=ve(l,u,s);r[s]?r[s].p(p,o):(r[s]=be(p),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=u.length}},i(l){a||(h(e.$$.fragment,l),a=!0)},o(l){b(e.$$.fragment,l),a=!1},d(l){l&&(_(t),_(i)),we(r,l),D(e,l)}}}function it(n,t,i){let e;return ie(n,T,a=>i(0,e=a)),[e]}class ht extends x{constructor(t){super(),ee(this,t,it,nt,Z,{})}}export{ht as component};
