import{s as be,y as oe,z as ie,l as ut,u as mt,r as ct,v as _t,E as ve,k as Ie,S as bt,x as we,a as O,g as H,i as k,f as p,H as je,Y as kt,e as X,c as W,b as Y,p as te,h as z,G as ae,o as gt,q as R,L as ye,t as G,M as Ne,d as J,n as Me,m as Ce,j as fe,w as wt,V as He}from"../chunks/scheduler.NGc5rx4B.js";import{S as Le,i as Se,e as se,c as P,a as D,m as U,t as b,b as j,d as B,g as ue,f as me}from"../chunks/index.CXr-pTxM.js";import{e as ce}from"../chunks/each.C0Oa3ZQW.js";import{C as Be,B as jt}from"../chunks/ClickableCard.Dy0Gc3SI.js";import{D as Fe}from"../chunks/DefaultButton.HZ4Q0i-3.js";import{S as ke}from"../chunks/SecondaryButton.DY728Lpc.js";/* empty css                                                    */import{T as qe}from"../chunks/TextInput.B2MdnKN0.js";import{W as ze}from"../chunks/WarningButton.B2__z57s.js";import{s as ee}from"../chunks/data.CcwWxht5.js";import{g as Ct}from"../chunks/globals.D0QH3NT1.js";import{c as Ge}from"../chunks/index.BSqje_d6.js";import{L as Mt,h as Lt,d as $e,q as St,t as Et,v as Pe,M as It,b as yt,C as Nt,G as Je,w as De,x as Ve,f as Tt,P as dt}from"../chunks/index.BfSlKP_F.js";import{g as Ue}from"../chunks/index.DiQOvX5u.js";import{c as de}from"../chunks/colors.DaC397qr.js";import{G as At,I as Te,p as Pt}from"../chunks/pan.D2Ss94-P.js";import{M as Dt,a as Ee,B as Ut,G as Bt,S as Ft,C as qt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DbXE8Zpj.js";import"../chunks/paths.CaIg03dX.js";import{C as zt}from"../chunks/CollapsibleCard.CecXaQdy.js";import{T as pt}from"../chunks/TextArea.T6odI4uv.js";import{R as Re}from"../chunks/Radio.lfhmTBy6.js";function Ot(t){let e;const l=t[16].default,n=ut(l,t,t[24],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,a){n&&n.m(o,a),e=!0},p(o,a){n&&n.p&&(!e||a&16777216)&&mt(n,l,o,o[24],e?_t(l,o[24],a,null):ct(o[24]),null)},i(o){e||(b(n,o),e=!0)},o(o){j(n,o),e=!1},d(o){n&&n.d(o)}}}function Ht(t){let e,l,n;function o(r){t[17](r)}let a={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Ot]},$$scope:{ctx:t}};return t[0]!==void 0&&(a.hovered=t[0]),e=new Mt({props:a}),oe.push(()=>se(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){P(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,i){U(e,r,i),n=!0},p(r,[i]){const s={};i&2&&(s.id=r[1]),i&4&&(s.source=r[2]),i&8&&(s.sourceLayer=r[3]),i&16&&(s.beforeId=r[4]),i&32&&(s.beforeLayerType=r[5]),i&64&&(s.paint=r[6]),i&128&&(s.layout=r[7]),i&256&&(s.filter=r[8]),i&512&&(s.applyToClusters=r[9]),i&1024&&(s.minzoom=r[10]),i&2048&&(s.maxzoom=r[11]),i&4096&&(s.hoverCursor=r[12]),i&8192&&(s.manageHoverState=r[13]),i&16384&&(s.eventsIfTopMost=r[14]),i&32768&&(s.interactive=r[15]),i&16777216&&(s.$$scope={dirty:i,ctx:r}),!l&&i&1&&(l=!0,s.hovered=r[0],ie(()=>l=!1)),e.$set(s)},i(r){n||(b(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function Gt(t,e,l){let{$$slots:n={},$$scope:o}=e,{id:a=Lt("symbol")}=e,{source:r=void 0}=e,{sourceLayer:i=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:d=void 0}=e,{filter:_=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:N=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:I=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:T=!0}=e;function f(L){$=L,l(0,$)}function g(L){ve.call(this,t,L)}function y(L){ve.call(this,t,L)}function Q(L){ve.call(this,t,L)}function K(L){ve.call(this,t,L)}function ne(L){ve.call(this,t,L)}function A(L){ve.call(this,t,L)}return t.$$set=L=>{"id"in L&&l(1,a=L.id),"source"in L&&l(2,r=L.source),"sourceLayer"in L&&l(3,i=L.sourceLayer),"beforeId"in L&&l(4,s=L.beforeId),"beforeLayerType"in L&&l(5,u=L.beforeLayerType),"paint"in L&&l(6,c=L.paint),"layout"in L&&l(7,d=L.layout),"filter"in L&&l(8,_=L.filter),"applyToClusters"in L&&l(9,w=L.applyToClusters),"minzoom"in L&&l(10,E=L.minzoom),"maxzoom"in L&&l(11,N=L.maxzoom),"hoverCursor"in L&&l(12,M=L.hoverCursor),"manageHoverState"in L&&l(13,I=L.manageHoverState),"hovered"in L&&l(0,$=L.hovered),"eventsIfTopMost"in L&&l(14,v=L.eventsIfTopMost),"interactive"in L&&l(15,T=L.interactive),"$$scope"in L&&l(24,o=L.$$scope)},[$,a,r,i,s,u,c,d,_,w,E,N,M,I,v,T,n,f,g,y,Q,K,ne,A,o]}class Jt extends Le{constructor(e){super(),Se(this,e,Gt,Ht,be,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Vt=Object.defineProperty,Rt=(t,e)=>Vt(t,"name",{value:e,configurable:!0});function $t(t,e,l,n={}){const o=Ue(t),a=$e(o[0]),r=$e(o[1]),i=$e(l),s=St(e,n.units),u=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),c=a+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(u)),d=Pe(c),_=Pe(u);return Et([d,_],n.properties)}Rt($t,"destination");var Xe=$t,Xt=Object.defineProperty,ht=(t,e)=>Xt(t,"name",{value:e,configurable:!0});function Oe(t,e,l={}){if(l.final===!0)return vt(t,e);const n=Ue(t),o=Ue(e),a=$e(n[0]),r=$e(o[0]),i=$e(n[1]),s=$e(o[1]),u=Math.sin(r-a)*Math.cos(s),c=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(r-a);return Pe(Math.atan2(u,c))}ht(Oe,"bearing");function vt(t,e){let l=Oe(e,t);return l=(l+180)%360,l}ht(vt,"calculateFinalBearing");var Wt=Oe;const Zt="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function We(t,e,l){const n=t.slice();return n[36]=e[l],n[37]=e,n[38]=l,n}function Ze(t,e,l){const n=t.slice();return n[39]=e[l],n[40]=e,n[38]=l,n}function Ke(t){let e,l,n,o,a,r,i;return l=new Te({props:{$$slots:{default:[Qt]},$$scope:{ctx:t}}}),l.$on("click",function(){kt(t[5])&&t[5].apply(this,arguments)}),o=new Te({props:{$$slots:{default:[tn]},$$scope:{ctx:t}}}),o.$on("click",t[17]),r=new Te({props:{$$slots:{default:[on]},$$scope:{ctx:t}}}),r.$on("click",t[18]),{c(){e=X("div"),P(l.$$.fragment),n=O(),P(o.$$.fragment),a=O(),P(r.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var u=Y(e);D(l.$$.fragment,u),n=H(u),D(o.$$.fragment,u),a=H(u),D(r.$$.fragment,u),u.forEach(p),this.h()},h(){te(e,"class","control-panel svelte-1w3m76d")},m(s,u){k(s,e,u),U(l,e,null),z(e,n),U(o,e,null),z(e,a),U(r,e,null),i=!0},p(s,u){t=s;const c={};u[0]&1|u[1]&1024&&(c.$$scope={dirty:u,ctx:t}),l.$set(c);const d={};u[0]&1|u[1]&1024&&(d.$$scope={dirty:u,ctx:t}),o.$set(d);const _={};u[0]&1|u[1]&1024&&(_.$$scope={dirty:u,ctx:t}),r.$set(_)},i(s){i||(b(l.$$.fragment,s),b(o.$$.fragment,s),b(r.$$.fragment,s),i=!0)},o(s){j(l.$$.fragment,s),j(o.$$.fragment,s),j(r.$$.fragment,s),i=!1},d(s){s&&p(e),B(l),B(o),B(r)}}}function Kt(t){let e;return{c(){e=G("Move map")},l(l){e=J(l,"Move map")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Yt(t){let e,l="Move map";return{c(){e=X("u"),e.textContent=l},l(n){e=W(n,"U",{"data-svelte-h":!0}),Ce(e)!=="svelte-1719ytd"&&(e.textContent=l)},m(n,o){k(n,e,o)},d(n){n&&p(e)}}}function Qt(t){let e,l,n,o;function a(s,u){return s[0].mode=="select"?Yt:Kt}let r=a(t),i=r(t);return{c(){e=X("img"),n=O(),i.c(),o=ae(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),n=H(s),i.l(s),o=ae(),this.h()},h(){gt(e.src,l=Pt)||te(e,"src",l),te(e,"alt","Move map"),R(e,"vertical-align","middle")},m(s,u){k(s,e,u),k(s,n,u),i.m(s,u),k(s,o,u)},p(s,u){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(n),p(o)),i.d(s)}}}function xt(t){let e;return{c(){e=G("New arm")},l(l){e=J(l,"New arm")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function en(t){let e,l="New arm";return{c(){e=X("u"),e.textContent=l},l(n){e=W(n,"U",{"data-svelte-h":!0}),Ce(e)!=="svelte-1typ7gq"&&(e.textContent=l)},m(n,o){k(n,e,o)},d(n){n&&p(e)}}}function tn(t){let e,l,n,o,a,r;function i(c,d){return c[0].mode=="new-arm"?en:xt}let s=i(t),u=s(t);return{c(){e=ye("svg"),l=ye("circle"),n=ye("text"),o=G("A"),a=O(),u.c(),r=ae(),this.h()},l(c){e=Ne(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var d=Y(e);l=Ne(d,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Y(l).forEach(p),n=Ne(d,"text",{x:!0,y:!0,fill:!0});var _=Y(n);o=J(_,"A"),_.forEach(p),d.forEach(p),a=H(c),u.l(c),r=ae(),this.h()},h(){te(l,"cx","12"),te(l,"cy","12"),te(l,"r","12"),te(l,"fill","white"),te(n,"x","6"),te(n,"y","16"),te(n,"fill","#4472c4"),te(e,"width","24"),te(e,"height","24"),te(e,"xmlns","http://www.w3.org/2000/svg"),R(e,"vertical-align","middle")},m(c,d){k(c,e,d),z(e,l),z(e,n),z(n,o),k(c,a,d),u.m(c,d),k(c,r,d)},p(c,d){s!==(s=i(c))&&(u.d(1),u=s(c),u&&(u.c(),u.m(r.parentNode,r)))},d(c){c&&(p(e),p(a),p(r)),u.d(c)}}}function nn(t){let e;return{c(){e=G("New movement")},l(l){e=J(l,"New movement")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function ln(t){let e,l="New movement";return{c(){e=X("u"),e.textContent=l},l(n){e=W(n,"U",{"data-svelte-h":!0}),Ce(e)!=="svelte-o92ucp"&&(e.textContent=l)},m(n,o){k(n,e,o)},d(n){n&&p(e)}}}function on(t){let e,l,n,o;function a(s,u){return s[0].mode=="new-movement"?ln:nn}let r=a(t),i=r(t);return{c(){e=X("img"),n=O(),i.c(),o=ae(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),n=H(s),i.l(s),o=ae(),this.h()},h(){gt(e.src,l=Zt)||te(e,"src",l),te(e,"alt","New movement"),R(e,"vertical-align","middle")},m(s,u){k(s,e,u),k(s,n,u),i.m(s,u),k(s,o,u)},p(s,u){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(p(e),p(n),p(o)),i.d(s)}}}function rn(t){let e,l=hn(t[38])+"",n;return{c(){e=X("span"),n=G(l),this.h()},l(o){e=W(o,"SPAN",{class:!0});var a=Y(e);n=J(a,l),a.forEach(p),this.h()},h(){te(e,"class","dot svelte-1w3m76d"),R(e,"color","#4472c4"),R(e,"background-color","white")},m(o,a){k(o,e,a),z(e,n)},p:Me,d(o){o&&p(e)}}}function Ye(t){let e,l,n;function o(s){t[19](s,t[39])}function a(){return t[20](t[38])}function r(){return t[21](t[38])}let i={draggable:!0,$$slots:{default:[rn]},$$scope:{ctx:t}};return t[39].point!==void 0&&(i.lngLat=t[39].point),e=new Ee({props:i}),oe.push(()=>se(e,"lngLat",o)),e.$on("dragend",a),e.$on("click",r),{c(){P(e.$$.fragment)},l(s){D(e.$$.fragment,s)},m(s,u){U(e,s,u),n=!0},p(s,u){t=s;const c={};u[1]&1024&&(c.$$scope={dirty:u,ctx:t}),!l&&u[0]&70&&(l=!0,c.lngLat=t[39].point,ie(()=>l=!1)),e.$set(c)},i(s){n||(b(e.$$.fragment,s),n=!0)},o(s){j(e.$$.fragment,s),n=!1},d(s){B(e,s)}}}function an(t){let e;return{c(){e=X("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){te(e,"class","dot svelte-1w3m76d"),R(e,"background-color",t[9][t[36].score]),R(e,"opacity",t[36].kind=="walking & wheeling"?"0%":"100%")},m(l,n){k(l,e,n)},p(l,n){n[0]&70&&R(e,"background-color",l[9][l[36].score]),n[0]&70&&R(e,"opacity",l[36].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&p(e)}}}function sn(t){let e;return{c(){e=X("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){te(e,"class","dot svelte-1w3m76d"),R(e,"background-color",t[9][t[36].score])},m(l,n){k(l,e,n)},p(l,n){n[0]&70&&R(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function fn(t){let e;return{c(){e=X("span"),this.h()},l(l){e=W(l,"SPAN",{class:!0}),Y(e).forEach(p),this.h()},h(){te(e,"class","dot svelte-1w3m76d"),R(e,"background-color",t[9][t[36].score]),R(e,"opacity","0%")},m(l,n){k(l,e,n)},p(l,n){n[0]&70&&R(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function Qe(t){let e,l,n,o,a,r,i,s,u;function c(g){t[22](g,t[36])}function d(){return t[23](t[38])}function _(){return t[24](t[38])}let w={draggable:!0,$$slots:{default:[an]},$$scope:{ctx:t}};t[36].point1!==void 0&&(w.lngLat=t[36].point1),e=new Ee({props:w}),oe.push(()=>se(e,"lngLat",c)),e.$on("dragend",d),e.$on("click",_);function E(g){t[25](g,t[36])}function N(){return t[26](t[38])}function M(){return t[27](t[38])}let I={draggable:!0,$$slots:{default:[sn]},$$scope:{ctx:t}};t[36].point2!==void 0&&(I.lngLat=t[36].point2),o=new Ee({props:I}),oe.push(()=>se(o,"lngLat",E)),o.$on("dragend",N),o.$on("click",M);function $(g){t[28](g,t[36])}function v(){return t[29](t[38])}function T(){return t[30](t[38])}let f={draggable:!0,$$slots:{default:[fn]},$$scope:{ctx:t}};return t[36].point3!==void 0&&(f.lngLat=t[36].point3),i=new Ee({props:f}),oe.push(()=>se(i,"lngLat",$)),i.$on("dragend",v),i.$on("click",T),{c(){P(e.$$.fragment),n=O(),P(o.$$.fragment),r=O(),P(i.$$.fragment)},l(g){D(e.$$.fragment,g),n=H(g),D(o.$$.fragment,g),r=H(g),D(i.$$.fragment,g)},m(g,y){U(e,g,y),k(g,n,y),U(o,g,y),k(g,r,y),U(i,g,y),u=!0},p(g,y){t=g;const Q={};y[0]&70|y[1]&1024&&(Q.$$scope={dirty:y,ctx:t}),!l&&y[0]&70&&(l=!0,Q.lngLat=t[36].point1,ie(()=>l=!1)),e.$set(Q);const K={};y[0]&70|y[1]&1024&&(K.$$scope={dirty:y,ctx:t}),!a&&y[0]&70&&(a=!0,K.lngLat=t[36].point2,ie(()=>a=!1)),o.$set(K);const ne={};y[0]&70|y[1]&1024&&(ne.$$scope={dirty:y,ctx:t}),!s&&y[0]&70&&(s=!0,ne.lngLat=t[36].point3,ie(()=>s=!1)),i.$set(ne)},i(g){u||(b(e.$$.fragment,g),b(o.$$.fragment,g),b(i.$$.fragment,g),u=!0)},o(g){j(e.$$.fragment,g),j(o.$$.fragment,g),j(i.$$.fragment,g),u=!1},d(g){g&&(p(n),p(r)),B(e,g),B(o,g),B(i,g)}}}function un(t){let e=(t[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(n){l=J(n,e)},m(n,o){k(n,l,o)},p(n,o){o[1]&16&&e!==(e=(n[35].name||"Untitled movement")+"")&&fe(l,e)},d(n){n&&p(l)}}}function mn(t){let e,l;return e=new dt({props:{$$slots:{default:[un,({props:n})=>({35:n}),({props:n})=>[0,n?16:0]]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function cn(t){let e=(t[35].name||"Untitled movement")+"",l;return{c(){l=G(e)},l(n){l=J(n,e)},m(n,o){k(n,l,o)},p(n,o){o[1]&16&&e!==(e=(n[35].name||"Untitled movement")+"")&&fe(l,e)},d(n){n&&p(l)}}}function _n(t){let e,l;return e=new dt({props:{$$slots:{default:[cn,({props:n})=>({35:n}),({props:n})=>[0,n?16:0]]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function gn(t){let e,l,n,o,a,r;return e=new De({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ve(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[mn]},$$scope:{ctx:t}}}),e.$on("click",t[11]),n=new De({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ve(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[_n]},$$scope:{ctx:t}}}),n.$on("click",t[11]),a=new Jt({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){P(e.$$.fragment),l=O(),P(n.$$.fragment),o=O(),P(a.$$.fragment)},l(i){D(e.$$.fragment,i),l=H(i),D(n.$$.fragment,i),o=H(i),D(a.$$.fragment,i)},m(i,s){U(e,i,s),k(i,l,s),U(n,i,s),k(i,o,s),U(a,i,s),r=!0},p(i,s){const u={};s[1]&1024&&(u.$$scope={dirty:s,ctx:i}),e.$set(u);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:i}),n.$set(c)},i(i){r||(b(e.$$.fragment,i),b(n.$$.fragment,i),b(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(n.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),B(e,i),B(n,i),B(a,i)}}}function dn(t){let e,l,n,o;return e=new De({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),n=new Tt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){P(e.$$.fragment),l=O(),P(n.$$.fragment)},l(a){D(e.$$.fragment,a),l=H(a),D(n.$$.fragment,a)},m(a,r){U(e,a,r),k(a,l,r),U(n,a,r),o=!0},p:Me,i(a){o||(b(e.$$.fragment,a),b(n.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(n.$$.fragment,a),o=!1},d(a){a&&p(l),B(e,a),B(n,a)}}}function pn(t){let e,l,n,o,a,r,i,s,u,c,d,_,w;e=new Dt({}),e.$on("click",t[10]);let E=t[0].mode!="editing"&&Ke(t);o=new Nt({props:{gj:t[6].summary.networkMap,show:t[3]}});let N=ce(t[6].jat[t[1]][t[2]].arms),M=[];for(let f=0;f<N.length;f+=1)M[f]=Ye(Ze(t,N,f));const I=f=>j(M[f],1,1,()=>{M[f]=null});let $=ce(t[6].jat[t[1]][t[2]].movements),v=[];for(let f=0;f<$.length;f+=1)v[f]=Qe(We(t,$,f));const T=f=>j(v[f],1,1,()=>{v[f]=null});return s=new Je({props:{data:t[12](t[6]),$$slots:{default:[gn]},$$scope:{ctx:t}}}),c=new Je({props:{data:t[8],$$slots:{default:[dn]},$$scope:{ctx:t}}}),_=new At({props:{map:t[7]}}),{c(){P(e.$$.fragment),l=O(),E&&E.c(),n=O(),P(o.$$.fragment),a=O();for(let f=0;f<M.length;f+=1)M[f].c();r=O();for(let f=0;f<v.length;f+=1)v[f].c();i=O(),P(s.$$.fragment),u=O(),P(c.$$.fragment),d=O(),P(_.$$.fragment)},l(f){D(e.$$.fragment,f),l=H(f),E&&E.l(f),n=H(f),D(o.$$.fragment,f),a=H(f);for(let g=0;g<M.length;g+=1)M[g].l(f);r=H(f);for(let g=0;g<v.length;g+=1)v[g].l(f);i=H(f),D(s.$$.fragment,f),u=H(f),D(c.$$.fragment,f),d=H(f),D(_.$$.fragment,f)},m(f,g){U(e,f,g),k(f,l,g),E&&E.m(f,g),k(f,n,g),U(o,f,g),k(f,a,g);for(let y=0;y<M.length;y+=1)M[y]&&M[y].m(f,g);k(f,r,g);for(let y=0;y<v.length;y+=1)v[y]&&v[y].m(f,g);k(f,i,g),U(s,f,g),k(f,u,g),U(c,f,g),k(f,d,g),U(_,f,g),w=!0},p(f,g){f[0].mode!="editing"?E?(E.p(f,g),g[0]&1&&b(E,1)):(E=Ke(f),E.c(),b(E,1),E.m(n.parentNode,n)):E&&(ue(),j(E,1,1,()=>{E=null}),me());const y={};if(g[0]&64&&(y.gj=f[6].summary.networkMap),g[0]&8&&(y.show=f[3]),o.$set(y),g[0]&86){N=ce(f[6].jat[f[1]][f[2]].arms);let A;for(A=0;A<N.length;A+=1){const L=Ze(f,N,A);M[A]?(M[A].p(L,g),b(M[A],1)):(M[A]=Ye(L),M[A].c(),b(M[A],1),M[A].m(r.parentNode,r))}for(ue(),A=N.length;A<M.length;A+=1)I(A);me()}if(g[0]&598){$=ce(f[6].jat[f[1]][f[2]].movements);let A;for(A=0;A<$.length;A+=1){const L=We(f,$,A);v[A]?(v[A].p(L,g),b(v[A],1)):(v[A]=Qe(L),v[A].c(),b(v[A],1),v[A].m(i.parentNode,i))}for(ue(),A=$.length;A<v.length;A+=1)T(A);me()}const Q={};g[0]&64&&(Q.data=f[12](f[6])),g[1]&1024&&(Q.$$scope={dirty:g,ctx:f}),s.$set(Q);const K={};g[0]&256&&(K.data=f[8]),g[1]&1024&&(K.$$scope={dirty:g,ctx:f}),c.$set(K);const ne={};g[0]&128&&(ne.map=f[7]),_.$set(ne)},i(f){if(!w){b(e.$$.fragment,f),b(E),b(o.$$.fragment,f);for(let g=0;g<N.length;g+=1)b(M[g]);for(let g=0;g<$.length;g+=1)b(v[g]);b(s.$$.fragment,f),b(c.$$.fragment,f),b(_.$$.fragment,f),w=!0}},o(f){j(e.$$.fragment,f),j(E),j(o.$$.fragment,f),M=M.filter(Boolean);for(let g=0;g<M.length;g+=1)j(M[g]);v=v.filter(Boolean);for(let g=0;g<v.length;g+=1)j(v[g]);j(s.$$.fragment,f),j(c.$$.fragment,f),j(_.$$.fragment,f),w=!1},d(f){f&&(p(l),p(n),p(a),p(r),p(i),p(u),p(d)),B(e,f),E&&E.d(f),B(o,f),je(M,f),je(v,f),B(s,f),B(c,f),B(_,f)}}}function $n(t){let e,l,n;function o(r){t[31](r)}let a={$$slots:{default:[pn]},$$scope:{ctx:t}};return t[7]!==void 0&&(a.map=t[7]),e=new It({props:a}),oe.push(()=>se(e,"map",o)),{c(){P(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,i){U(e,r,i),n=!0},p(r,i){const s={};i[0]&511|i[1]&1024&&(s.$$scope={dirty:i,ctx:r}),!l&&i[0]&128&&(l=!0,s.map=r[7],ie(()=>l=!1)),e.$set(s)},i(r){n||(b(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function xe(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function hn(t){return String.fromCharCode(t+65)}function vn(t,e,l){let n,o;Ie(t,ee,h=>l(6,o=h));let{junctionIdx:a}=e,{stage:r}=e,{mode:i}=e,{hoveringSidebar:s}=e,{streetviewOn:u}=e,{showContext:c}=e,{select:d}=e,{stopEditing:_}=e,w,E={0:de.red.background,1:de.amber.background,2:de.green.background,X:de.critical.background};function N(h,C,le){let pe={type:"FeatureCollection",features:[]},he=C.mode=="editing"?C.id:le;return he!=null&&(he.kind=="arm"?pe.features.push(xe(h.jat[a][r].arms[he.idx],he.idx)):pe.features.push(v(h.jat[a][r].movements[he.idx],he.idx))),pe}async function M(h){if(!u){for(let C of w.queryRenderedFeatures(h.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i.mode!="select"){if(i.mode=="editing"){await _();return}i.mode=="new-arm"?(we(ee,o.jat[a][r].arms=[...o.jat[a][r].arms,{point:h.detail.lngLat.toArray(),name:""}],o),await d({kind:"arm",idx:o.jat[a][r].arms.length-1})):(we(ee,o.jat[a][r].movements=[...o.jat[a][r].movements,{point1:h.detail.lngLat.toArray(),point2:Xe(h.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Xe(h.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await d({kind:"movement",idx:o.jat[a][r].movements.length-1}))}}}async function I(h){await d({kind:"movement",idx:h.detail.features[0].id})}bt(()=>{f(!1)});function $(h){let C={type:"FeatureCollection",features:h.jat[a][r].movements.map((le,pe)=>v(le,pe))};for(let le of h.jat[a][r].movements)if(C.features.push(T(le,C.features.length)),le.kind=="walking & wheeling"){let pe={...le,point1:le.point3,point3:le.point1};C.features.push(T(pe,C.features.length))}return C}function v(h,C){return{type:"Feature",id:C,properties:{name:h.name,kind:h.kind,color:E[h.score]},geometry:{type:"LineString",coordinates:[h.point1,h.point2,h.point3]}}}function T(h,C){return{type:"Feature",id:C,properties:{kind:h.kind,color:E[h.score],angle:Wt(h.point2,h.point3)},geometry:{type:"Point",coordinates:h.point3}}}function f(h){let C=$(o);for(let le of o.jat[a][r].arms)C.features.push(xe(le,C.features.length));for(let le of o.summary.networkMap.features)C.features.push(le);C.features.length>0&&w.fitBounds(yt(C),{padding:20,animate:h})}function g(){return w}const y=()=>l(0,i={mode:"new-arm"}),Q=()=>l(0,i={mode:"new-movement"});function K(h,C){t.$$.not_equal(C.point,h)&&(C.point=h,ee.set(o))}const ne=h=>d({kind:"arm",idx:h}),A=h=>d({kind:"arm",idx:h});function L(h,C){t.$$.not_equal(C.point1,h)&&(C.point1=h,ee.set(o))}const V=h=>d({kind:"movement",idx:h}),ge=h=>d({kind:"movement",idx:h});function x(h,C){t.$$.not_equal(C.point2,h)&&(C.point2=h,ee.set(o))}const q=h=>d({kind:"movement",idx:h}),F=h=>d({kind:"movement",idx:h});function re(h,C){t.$$.not_equal(C.point3,h)&&(C.point3=h,ee.set(o))}const Z=h=>d({kind:"movement",idx:h}),m=h=>d({kind:"movement",idx:h});function S(h){w=h,l(7,w)}return t.$$set=h=>{"junctionIdx"in h&&l(1,a=h.junctionIdx),"stage"in h&&l(2,r=h.stage),"mode"in h&&l(0,i=h.mode),"hoveringSidebar"in h&&l(13,s=h.hoveringSidebar),"streetviewOn"in h&&l(14,u=h.streetviewOn),"showContext"in h&&l(3,c=h.showContext),"select"in h&&l(4,d=h.select),"stopEditing"in h&&l(5,_=h.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&8257&&l(8,n=N(o,i,s))},[i,a,r,c,d,_,o,w,n,E,M,I,$,s,u,f,g,y,Q,K,ne,A,L,V,ge,x,q,F,re,Z,m,S]}class bn extends Le{constructor(e){super(),Se(this,e,vn,$n,be,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showContext:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function kn(t){let e,l,n,o,a,r,i,s,u,c,d,_;function w(f){t[5](f)}let E={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(E.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new qe({props:E}),oe.push(()=>se(e,"value",w));function N(f){t[6](f)}let M={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(M.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Re({props:M}),oe.push(()=>se(o,"value",N));function I(f){t[7](f)}let $={legend:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&($.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),i=new Re({props:$}),oe.push(()=>se(i,"value",I));function v(f){t[8](f)}let T={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(T.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),c=new pt({props:T}),oe.push(()=>se(c,"value",v)),{c(){P(e.$$.fragment),n=O(),P(o.$$.fragment),r=O(),P(i.$$.fragment),u=O(),P(c.$$.fragment)},l(f){D(e.$$.fragment,f),n=H(f),D(o.$$.fragment,f),r=H(f),D(i.$$.fragment,f),u=H(f),D(c.$$.fragment,f)},m(f,g){U(e,f,g),k(f,n,g),U(o,f,g),k(f,r,g),U(i,f,g),k(f,u,g),U(c,f,g),_=!0},p(f,[g]){const y={};!l&&g&15&&(l=!0,y.value=f[3].jat[f[0]][f[1]].movements[f[2]].name,ie(()=>l=!1)),e.$set(y);const Q={};!a&&g&15&&(a=!0,Q.value=f[3].jat[f[0]][f[1]].movements[f[2]].kind,ie(()=>a=!1)),o.$set(Q);const K={};!s&&g&15&&(s=!0,K.value=f[3].jat[f[0]][f[1]].movements[f[2]].score,ie(()=>s=!1)),i.$set(K);const ne={};!d&&g&15&&(d=!0,ne.value=f[3].jat[f[0]][f[1]].movements[f[2]].notes,ie(()=>d=!1)),c.$set(ne)},i(f){_||(b(e.$$.fragment,f),b(o.$$.fragment,f),b(i.$$.fragment,f),b(c.$$.fragment,f),_=!0)},o(f){j(e.$$.fragment,f),j(o.$$.fragment,f),j(i.$$.fragment,f),j(c.$$.fragment,f),_=!1},d(f){f&&(p(n),p(r),p(u)),B(e,f),B(o,f),B(i,f),B(c,f)}}}function wn(t,e,l){let n;Ie(t,ee,_=>l(3,n=_));let{junctionIdx:o}=e,{stage:a}=e,{idx:r}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){t.$$.not_equal(n.jat[o][a].movements[r].name,_)&&(n.jat[o][a].movements[r].name=_,ee.set(n))}function u(_){t.$$.not_equal(n.jat[o][a].movements[r].kind,_)&&(n.jat[o][a].movements[r].kind=_,ee.set(n))}function c(_){t.$$.not_equal(n.jat[o][a].movements[r].score,_)&&(n.jat[o][a].movements[r].score=_,ee.set(n))}function d(_){t.$$.not_equal(n.jat[o][a].movements[r].notes,_)&&(n.jat[o][a].movements[r].notes=_,ee.set(n))}return t.$$set=_=>{"junctionIdx"in _&&l(0,o=_.junctionIdx),"stage"in _&&l(1,a=_.stage),"idx"in _&&l(2,r=_.idx)},[o,a,r,n,i,s,u,c,d]}class jn extends Le{constructor(e){super(),Se(this,e,wn,kn,be,{junctionIdx:0,stage:1,idx:2})}}function _e(t){if(t.movements.length==0)return"No movements added";let e=0,l=0;for(let o of t.movements)e+={0:0,1:1,2:2,X:0}[o.score],l+=2;let n=e/l*100;return`${Math.round(n)}%`}const{window:Cn}=Ct;function et(t,e,l){const n=t.slice();n[33]=e[l],n[36]=l;const o=n[16][n[33].score];return n[34]=o,n}function tt(t,e,l){const n=t.slice();return n[37]=e[l],n[36]=l,n}function Mn(t){let e,l,n,o,a,r,i,s;e=new Fe({props:{$$slots:{default:[Sn]},$$scope:{ctx:t}}}),e.$on("click",t[11]),n=new ze({props:{$$slots:{default:[En]},$$scope:{ctx:t}}}),n.$on("click",t[12]);const u=[yn,In],c=[];function d(_,w){return _[2].id.kind=="movement"?0:1}return a=d(t),r=c[a]=u[a](t),{c(){P(e.$$.fragment),l=O(),P(n.$$.fragment),o=O(),r.c(),i=ae()},l(_){D(e.$$.fragment,_),l=H(_),D(n.$$.fragment,_),o=H(_),r.l(_),i=ae()},m(_,w){U(e,_,w),k(_,l,w),U(n,_,w),k(_,o,w),c[a].m(_,w),k(_,i,w),s=!0},p(_,w){const E={};w[1]&1&&(E.$$scope={dirty:w,ctx:_}),e.$set(E);const N={};w[1]&1&&(N.$$scope={dirty:w,ctx:_}),n.$set(N);let M=a;a=d(_),a===M?c[a].p(_,w):(ue(),j(c[M],1,1,()=>{c[M]=null}),me(),r=c[a],r?r.p(_,w):(r=c[a]=u[a](_),r.c()),b(r,1),r.m(i.parentNode,i))},i(_){s||(b(e.$$.fragment,_),b(n.$$.fragment,_),b(r),s=!0)},o(_){j(e.$$.fragment,_),j(n.$$.fragment,_),j(r),s=!1},d(_){_&&(p(l),p(o),p(i)),B(e,_),B(n,_),c[a].d(_)}}}function Ln(t){let e,l,n,o,a="Arms",r,i,s,u,c="Movements",d,_,w,E,N,M,I=(t[8].jat[t[0]].name||"Untitled junction")+"",$,v,T=_e(t[8].jat[t[0]][t[1]])+"",f,g,y,Q,K;const ne=t[17].default,A=ut(ne,t,t[31],null);l=new zt({props:{label:"Tools",$$slots:{default:[Dn]},$$scope:{ctx:t}}});let L=ce(t[8].jat[t[0]][t[1]].arms),V=[];for(let m=0;m<L.length;m+=1)V[m]=nt(tt(t,L,m));const ge=m=>j(V[m],1,1,()=>{V[m]=null});let x=t[8].jat[t[0]][t[9]].arms.length>0&&lt(t),q=ce(t[8].jat[t[0]][t[1]].movements),F=[];for(let m=0;m<q.length;m+=1)F[m]=ot(et(t,q,m));const re=m=>j(F[m],1,1,()=>{F[m]=null});let Z=t[8].jat[t[0]][t[9]].movements.length>0&&rt(t);return{c(){A&&A.c(),e=O(),P(l.$$.fragment),n=O(),o=X("h3"),o.textContent=a,r=O();for(let m=0;m<V.length;m+=1)V[m].c();i=O(),x&&x.c(),s=O(),u=X("h3"),u.textContent=c,d=O(),_=X("p"),w=G("Total JAT score for "),E=G(t[1]),N=O(),M=X("u"),$=G(I),v=G(`
        : `),f=G(T),g=O();for(let m=0;m<F.length;m+=1)F[m].c();y=O(),Z&&Z.c(),Q=ae()},l(m){A&&A.l(m),e=H(m),D(l.$$.fragment,m),n=H(m),o=W(m,"H3",{"data-svelte-h":!0}),Ce(o)!=="svelte-ld74qb"&&(o.textContent=a),r=H(m);for(let C=0;C<V.length;C+=1)V[C].l(m);i=H(m),x&&x.l(m),s=H(m),u=W(m,"H3",{"data-svelte-h":!0}),Ce(u)!=="svelte-1dc52s8"&&(u.textContent=c),d=H(m),_=W(m,"P",{});var S=Y(_);w=J(S,"Total JAT score for "),E=J(S,t[1]),N=H(S),M=W(S,"U",{});var h=Y(M);$=J(h,I),h.forEach(p),v=J(S,`
        : `),f=J(S,T),S.forEach(p),g=H(m);for(let C=0;C<F.length;C+=1)F[C].l(m);y=H(m),Z&&Z.l(m),Q=ae()},m(m,S){A&&A.m(m,S),k(m,e,S),U(l,m,S),k(m,n,S),k(m,o,S),k(m,r,S);for(let h=0;h<V.length;h+=1)V[h]&&V[h].m(m,S);k(m,i,S),x&&x.m(m,S),k(m,s,S),k(m,u,S),k(m,d,S),k(m,_,S),z(_,w),z(_,E),z(_,N),z(_,M),z(M,$),z(_,v),z(_,f),k(m,g,S);for(let h=0;h<F.length;h+=1)F[h]&&F[h].m(m,S);k(m,y,S),Z&&Z.m(m,S),k(m,Q,S),K=!0},p(m,S){A&&A.p&&(!K||S[1]&1)&&mt(A,ne,m,m[31],K?_t(ne,m[31],S,null):ct(m[31]),null);const h={};if(S[0]&112|S[1]&1&&(h.$$scope={dirty:S,ctx:m}),l.$set(h),S[0]&1291){L=ce(m[8].jat[m[0]][m[1]].arms);let C;for(C=0;C<L.length;C+=1){const le=tt(m,L,C);V[C]?(V[C].p(le,S),b(V[C],1)):(V[C]=nt(le),V[C].c(),b(V[C],1),V[C].m(i.parentNode,i))}for(ue(),C=L.length;C<V.length;C+=1)ge(C);me()}if(m[8].jat[m[0]][m[9]].arms.length>0?x?(x.p(m,S),S[0]&257&&b(x,1)):(x=lt(m),x.c(),b(x,1),x.m(s.parentNode,s)):x&&(ue(),j(x,1,1,()=>{x=null}),me()),(!K||S[0]&2)&&fe(E,m[1]),(!K||S[0]&257)&&I!==(I=(m[8].jat[m[0]].name||"Untitled junction")+"")&&fe($,I),(!K||S[0]&259)&&T!==(T=_e(m[8].jat[m[0]][m[1]])+"")&&fe(f,T),S[0]&66827){q=ce(m[8].jat[m[0]][m[1]].movements);let C;for(C=0;C<q.length;C+=1){const le=et(m,q,C);F[C]?(F[C].p(le,S),b(F[C],1)):(F[C]=ot(le),F[C].c(),b(F[C],1),F[C].m(y.parentNode,y))}for(ue(),C=q.length;C<F.length;C+=1)re(C);me()}m[8].jat[m[0]][m[9]].movements.length>0?Z?(Z.p(m,S),S[0]&257&&b(Z,1)):(Z=rt(m),Z.c(),b(Z,1),Z.m(Q.parentNode,Q)):Z&&(ue(),j(Z,1,1,()=>{Z=null}),me())},i(m){if(!K){b(A,m),b(l.$$.fragment,m);for(let S=0;S<L.length;S+=1)b(V[S]);b(x);for(let S=0;S<q.length;S+=1)b(F[S]);b(Z),K=!0}},o(m){j(A,m),j(l.$$.fragment,m),V=V.filter(Boolean);for(let S=0;S<V.length;S+=1)j(V[S]);j(x),F=F.filter(Boolean);for(let S=0;S<F.length;S+=1)j(F[S]);j(Z),K=!1},d(m){m&&(p(e),p(n),p(o),p(r),p(i),p(s),p(u),p(d),p(_),p(g),p(y),p(Q)),A&&A.d(m),B(l,m),je(V,m),x&&x.d(m),je(F,m),Z&&Z.d(m)}}}function Sn(t){let e;return{c(){e=G("Save")},l(l){e=J(l,"Save")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function En(t){let e;return{c(){e=G("Delete")},l(l){e=J(l,"Delete")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function In(t){let e,l,n;function o(r){t[28](r)}let a={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[2].id.idx].name!==void 0&&(a.value=t[8].jat[t[0]][t[1]].arms[t[2].id.idx].name),e=new qe({props:a}),oe.push(()=>se(e,"value",o)),{c(){P(e.$$.fragment)},l(r){D(e.$$.fragment,r)},m(r,i){U(e,r,i),n=!0},p(r,i){const s={};!l&&i[0]&263&&(l=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,ie(()=>l=!1)),e.$set(s)},i(r){n||(b(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function yn(t){let e,l,n,o,a,r;return e=new jn({props:{junctionIdx:t[0],stage:t[1],idx:t[2].id.idx}}),n=new Fe({props:{$$slots:{default:[Nn]},$$scope:{ctx:t}}}),n.$on("click",t[11]),a=new ze({props:{$$slots:{default:[Tn]},$$scope:{ctx:t}}}),a.$on("click",t[12]),{c(){P(e.$$.fragment),l=O(),P(n.$$.fragment),o=O(),P(a.$$.fragment)},l(i){D(e.$$.fragment,i),l=H(i),D(n.$$.fragment,i),o=H(i),D(a.$$.fragment,i)},m(i,s){U(e,i,s),k(i,l,s),U(n,i,s),k(i,o,s),U(a,i,s),r=!0},p(i,s){const u={};s[0]&1&&(u.junctionIdx=i[0]),s[0]&2&&(u.stage=i[1]),s[0]&4&&(u.idx=i[2].id.idx),e.$set(u);const c={};s[1]&1&&(c.$$scope={dirty:s,ctx:i}),n.$set(c);const d={};s[1]&1&&(d.$$scope={dirty:s,ctx:i}),a.$set(d)},i(i){r||(b(e.$$.fragment,i),b(n.$$.fragment,i),b(a.$$.fragment,i),r=!0)},o(i){j(e.$$.fragment,i),j(n.$$.fragment,i),j(a.$$.fragment,i),r=!1},d(i){i&&(p(l),p(o)),B(e,i),B(n,i),B(a,i)}}}function Nn(t){let e;return{c(){e=G("Save")},l(l){e=J(l,"Save")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Tn(t){let e;return{c(){e=G("Delete")},l(l){e=J(l,"Delete")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function An(t){let e;return{c(){e=G("Zoom to fit")},l(l){e=J(l,"Zoom to fit")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Pn(t){let e;return{c(){e=G("Show scheme context")},l(l){e=J(l,"Show scheme context")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Dn(t){var I;let e,l,n,o,a,r,i,s,u,c,d,_;e=new ke({props:{$$slots:{default:[An]},$$scope:{ctx:t}}}),e.$on("click",t[19]),n=new Ut({}),a=new Bt({});function w($){t[20]($)}let E={map:(I=t[6])==null?void 0:I.getMap()};t[4]!==void 0&&(E.enabled=t[4]),i=new Ft({props:E}),oe.push(()=>se(i,"enabled",w));function N($){t[21]($)}let M={$$slots:{default:[Pn]},$$scope:{ctx:t}};return t[5]!==void 0&&(M.checked=t[5]),c=new qt({props:M}),oe.push(()=>se(c,"checked",N)),{c(){P(e.$$.fragment),l=O(),P(n.$$.fragment),o=O(),P(a.$$.fragment),r=O(),P(i.$$.fragment),u=O(),P(c.$$.fragment)},l($){D(e.$$.fragment,$),l=H($),D(n.$$.fragment,$),o=H($),D(a.$$.fragment,$),r=H($),D(i.$$.fragment,$),u=H($),D(c.$$.fragment,$)},m($,v){U(e,$,v),k($,l,v),U(n,$,v),k($,o,v),U(a,$,v),k($,r,v),U(i,$,v),k($,u,v),U(c,$,v),_=!0},p($,v){var y;const T={};v[1]&1&&(T.$$scope={dirty:v,ctx:$}),e.$set(T);const f={};v[0]&64&&(f.map=(y=$[6])==null?void 0:y.getMap()),!s&&v[0]&16&&(s=!0,f.enabled=$[4],ie(()=>s=!1)),i.$set(f);const g={};v[1]&1&&(g.$$scope={dirty:v,ctx:$}),!d&&v[0]&32&&(d=!0,g.checked=$[5],ie(()=>d=!1)),c.$set(g)},i($){_||(b(e.$$.fragment,$),b(n.$$.fragment,$),b(a.$$.fragment,$),b(i.$$.fragment,$),b(c.$$.fragment,$),_=!0)},o($){j(e.$$.fragment,$),j(n.$$.fragment,$),j(a.$$.fragment,$),j(i.$$.fragment,$),j(c.$$.fragment,$),_=!1},d($){$&&(p(l),p(o),p(r),p(u)),B(e,$),B(n,$),B(a,$),B(i,$),B(c,$)}}}function nt(t){let e,l;function n(){return t[22](t[36])}function o(){return t[23](t[36])}return e=new Be({props:{name:`${at(t[36])} - ${t[37].name||"Unnamed arm"}`}}),e.$on("click",n),e.$on("mouseenter",o),e.$on("mouseleave",t[24]),{c(){P(e.$$.fragment)},l(a){D(e.$$.fragment,a)},m(a,r){U(e,a,r),l=!0},p(a,r){t=a;const i={};r[0]&259&&(i.name=`${at(t[36])} - ${t[37].name||"Unnamed arm"}`),e.$set(i)},i(a){l||(b(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){B(e,a)}}}function lt(t){let e,l;return e=new ke({props:{$$slots:{default:[Un]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o[1]&1&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function Un(t){let e,l;return{c(){e=G("Copy arms from "),l=G(t[9])},l(n){e=J(n,"Copy arms from "),l=J(n,t[9])},m(n,o){k(n,e,o),k(n,l,o)},p:Me,d(n){n&&(p(e),p(l))}}}function Bn(t){let e,l,n,o=t[33].score+"",a,r,i,s=Ge(t[33].kind)+"",u;return{c(){e=X("div"),l=X("span"),n=G("Score: "),a=G(o),r=O(),i=X("span"),u=G(s),this.h()},l(c){e=W(c,"DIV",{style:!0});var d=Y(e);l=W(d,"SPAN",{style:!0});var _=Y(l);n=J(_,"Score: "),a=J(_,o),_.forEach(p),r=H(d),i=W(d,"SPAN",{});var w=Y(i);u=J(w,s),w.forEach(p),d.forEach(p),this.h()},h(){R(l,"padding","4px"),R(l,"color",t[34].font),R(l,"background-color",t[34].background),R(e,"width","100%"),R(e,"display","flex"),R(e,"justify-content","space-between")},m(c,d){k(c,e,d),z(e,l),z(l,n),z(l,a),z(e,r),z(e,i),z(i,u)},p(c,d){d[0]&259&&o!==(o=c[33].score+"")&&fe(a,o),d[0]&259&&R(l,"color",c[34].font),d[0]&259&&R(l,"background-color",c[34].background),d[0]&259&&s!==(s=Ge(c[33].kind)+"")&&fe(u,s)},d(c){c&&p(e)}}}function ot(t){let e,l;function n(){return t[25](t[36])}function o(){return t[26](t[36])}return e=new Be({props:{name:t[33].name||"Unnamed movement",$$slots:{default:[Bn]},$$scope:{ctx:t}}}),e.$on("click",n),e.$on("mouseenter",o),e.$on("mouseleave",t[27]),{c(){P(e.$$.fragment)},l(a){D(e.$$.fragment,a)},m(a,r){U(e,a,r),l=!0},p(a,r){t=a;const i={};r[0]&259&&(i.name=t[33].name||"Unnamed movement"),r[0]&259|r[1]&1&&(i.$$scope={dirty:r,ctx:t}),e.$set(i)},i(a){l||(b(e.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),l=!1},d(a){B(e,a)}}}function rt(t){let e,l;return e=new ke({props:{$$slots:{default:[Fn]},$$scope:{ctx:t}}}),e.$on("click",t[15]),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o[1]&1&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function Fn(t){let e,l;return{c(){e=G("Copy movements from "),l=G(t[9])},l(n){e=J(n,"Copy movements from "),l=J(n,t[9])},m(n,o){k(n,e,o),k(n,l,o)},p:Me,d(n){n&&(p(e),p(l))}}}function qn(t){let e,l,n,o,a,r,i,s=_e(t[8].jat[t[0]].existing)+"",u,c,d,_=_e(t[8].jat[t[0]].proposed)+"",w,E,N,M,I,$,v,T,f,g,y,Q,K;function ne(q){t[18](q)}let A={label:"Commentary / Notes about "+t[1]+" junction"};t[8].jat[t[0]][t[1]].notes!==void 0&&(A.value=t[8].jat[t[0]][t[1]].notes),l=new pt({props:A}),oe.push(()=>se(l,"value",ne));const L=[Ln,Mn],V=[];function ge(q,F){return q[2].mode!="editing"?0:1}$=ge(t),v=V[$]=L[$](t);let x={junctionIdx:t[0],stage:t[1],mode:t[2],hoveringSidebar:t[3],streetviewOn:t[4],showContext:t[5],select:t[10],stopEditing:t[11]};return g=new bn({props:x}),t[30](g),{c(){e=X("div"),P(l.$$.fragment),o=O(),a=X("p"),r=G("Total JAT score: "),i=X("b"),u=G(s),c=G(`
    existing,
    `),d=X("b"),w=G(_),E=G(`
    proposed`),N=O(),M=X("div"),I=X("div"),v.c(),T=O(),f=X("div"),P(g.$$.fragment),this.h()},l(q){e=W(q,"DIV",{class:!0});var F=Y(e);D(l.$$.fragment,F),o=H(F),a=W(F,"P",{});var re=Y(a);r=J(re,"Total JAT score: "),i=W(re,"B",{});var Z=Y(i);u=J(Z,s),Z.forEach(p),c=J(re,`
    existing,
    `),d=W(re,"B",{});var m=Y(d);w=J(m,_),m.forEach(p),E=J(re,`
    proposed`),re.forEach(p),F.forEach(p),N=H(q),M=W(q,"DIV",{style:!0});var S=Y(M);I=W(S,"DIV",{style:!0});var h=Y(I);v.l(h),h.forEach(p),T=H(S),f=W(S,"DIV",{style:!0});var C=Y(f);D(g.$$.fragment,C),C.forEach(p),S.forEach(p),this.h()},h(){te(e,"class","govuk-width-container"),R(I,"width","30%"),R(I,"overflow-y","scroll"),R(I,"padding","10px"),R(I,"border","1px solid black"),R(f,"position","relative"),R(f,"width","100%"),R(M,"display","flex"),R(M,"height","80vh")},m(q,F){k(q,e,F),U(l,e,null),z(e,o),z(e,a),z(a,r),z(a,i),z(i,u),z(a,c),z(a,d),z(d,w),z(a,E),k(q,N,F),k(q,M,F),z(M,I),V[$].m(I,null),t[29](I),z(M,T),z(M,f),U(g,f,null),y=!0,Q||(K=wt(Cn,"keydown",t[13]),Q=!0)},p(q,F){const re={};F[0]&2&&(re.label="Commentary / Notes about "+q[1]+" junction"),!n&&F[0]&259&&(n=!0,re.value=q[8].jat[q[0]][q[1]].notes,ie(()=>n=!1)),l.$set(re),(!y||F[0]&257)&&s!==(s=_e(q[8].jat[q[0]].existing)+"")&&fe(u,s),(!y||F[0]&257)&&_!==(_=_e(q[8].jat[q[0]].proposed)+"")&&fe(w,_);let Z=$;$=ge(q),$===Z?V[$].p(q,F):(ue(),j(V[Z],1,1,()=>{V[Z]=null}),me(),v=V[$],v?v.p(q,F):(v=V[$]=L[$](q),v.c()),b(v,1),v.m(I,null));const m={};F[0]&1&&(m.junctionIdx=q[0]),F[0]&2&&(m.stage=q[1]),F[0]&4&&(m.mode=q[2]),F[0]&8&&(m.hoveringSidebar=q[3]),F[0]&16&&(m.streetviewOn=q[4]),F[0]&32&&(m.showContext=q[5]),g.$set(m)},i(q){y||(b(l.$$.fragment,q),b(v),b(g.$$.fragment,q),y=!0)},o(q){j(l.$$.fragment,q),j(v),j(g.$$.fragment,q),y=!1},d(q){q&&(p(e),p(N),p(M)),B(l),V[$].d(),t[29](null),t[30](null),B(g),Q=!1,K()}}}function at(t){return String.fromCharCode(t+65)}function zn(t,e,l){let n;Ie(t,ee,m=>l(8,n=m));let{$$slots:o={},$$scope:a}=e,{junctionIdx:r}=e,{stage:i}=e,s=i=="existing"?"proposed":"existing",u={mode:"select"},c=null,d=null,_=!1,w=!0,E=null,N;async function M(m){c=N.scrollTop,l(2,u={mode:"editing",id:m}),l(3,d=null),await He(),l(7,N.scrollTop=0,N)}async function I(){l(2,u={mode:"select"}),c!=null&&(await He(),l(7,N.scrollTop=c,N),c=null)}function $(){u.mode=="editing"&&window.confirm(`Delete this ${u.id.kind}?`)&&(u.id.kind=="movement"?(n.jat[r][i].movements.splice(u.id.idx,1),ee.set(n)):(n.jat[r][i].arms.splice(u.id.idx,1),ee.set(n)),I())}function v(m){if(u.mode!="editing")return;let S=m.target.tagName,h=S=="INPUT"||S=="TEXTAREA";m.key=="Escape"||m.key=="Enter"&&!h?(m.stopPropagation(),I()):m.key=="Delete"&&!h&&(m.stopPropagation(),$())}function T(){n.jat[r][i].arms.length>0&&!window.confirm("Overwrite arms?")||(we(ee,n.jat[r][i].arms=JSON.parse(JSON.stringify(n.jat[r][s].arms)),n),ee.set(n))}function f(){n.jat[r][i].movements.length>0&&!window.confirm("Overwrite movements?")||(we(ee,n.jat[r][i].movements=JSON.parse(JSON.stringify(n.jat[r][s].movements)),n),ee.set(n))}let g={0:de.red,1:de.amber,2:de.green,X:de.critical};function y(m){t.$$.not_equal(n.jat[r][i].notes,m)&&(n.jat[r][i].notes=m,ee.set(n))}const Q=()=>E==null?void 0:E.zoom(!0);function K(m){_=m,l(4,_)}function ne(m){w=m,l(5,w)}const A=m=>M({kind:"arm",idx:m}),L=m=>l(3,d={kind:"arm",idx:m}),V=()=>l(3,d=null),ge=m=>M({kind:"movement",idx:m}),x=m=>l(3,d={kind:"movement",idx:m}),q=()=>l(3,d=null);function F(m){t.$$.not_equal(n.jat[r][i].arms[u.id.idx].name,m)&&(n.jat[r][i].arms[u.id.idx].name=m,ee.set(n))}function re(m){oe[m?"unshift":"push"](()=>{N=m,l(7,N)})}function Z(m){oe[m?"unshift":"push"](()=>{E=m,l(6,E)})}return t.$$set=m=>{"junctionIdx"in m&&l(0,r=m.junctionIdx),"stage"in m&&l(1,i=m.stage),"$$scope"in m&&l(31,a=m.$$scope)},[r,i,u,d,_,w,E,N,n,s,M,I,$,v,T,f,g,o,y,Q,K,ne,A,L,V,ge,x,q,F,re,Z,a]}class On extends Le{constructor(e){super(),Se(this,e,zn,qn,be,{junctionIdx:0,stage:1},null,[-1,-1])}}function it(t,e,l){const n=t.slice();return n[10]=e[l],n[12]=l,n}function Hn(t){let e,l,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",o,a,r=t[0].stage+"",i,s,u,c,d,_,w,E=t[0].stage,N,M;u=new jt({props:{$$slots:{default:[Rn]},$$scope:{ctx:t}}});function I(T){t[7](T)}let $={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&($.value=t[1].jat[t[0].idx].name),d=new qe({props:$}),oe.push(()=>se(d,"value",I));let v=st(t);return{c(){e=X("div"),l=X("h2"),o=G(n),a=G(" - "),i=G(r),s=O(),P(u.$$.fragment),c=O(),P(d.$$.fragment),w=O(),v.c(),N=ae(),this.h()},l(T){e=W(T,"DIV",{class:!0});var f=Y(e);l=W(f,"H2",{});var g=Y(l);o=J(g,n),a=J(g," - "),i=J(g,r),g.forEach(p),s=H(f),D(u.$$.fragment,f),c=H(f),D(d.$$.fragment,f),f.forEach(p),w=H(T),v.l(T),N=ae(),this.h()},h(){te(e,"class","govuk-width-container")},m(T,f){k(T,e,f),z(e,l),z(l,o),z(l,a),z(l,i),z(e,s),U(u,e,null),z(e,c),U(d,e,null),k(T,w,f),v.m(T,f),k(T,N,f),M=!0},p(T,f){(!M||f&3)&&n!==(n=(T[1].jat[T[0].idx].name||"Untitled junction")+"")&&fe(o,n),(!M||f&1)&&r!==(r=T[0].stage+"")&&fe(i,r);const g={};f&8193&&(g.$$scope={dirty:f,ctx:T}),u.$set(g);const y={};!_&&f&3&&(_=!0,y.value=T[1].jat[T[0].idx].name,ie(()=>_=!1)),d.$set(y),f&1&&be(E,E=T[0].stage)?(ue(),j(v,1,1,Me),me(),v=st(T),v.c(),b(v,1),v.m(N.parentNode,N)):v.p(T,f)},i(T){M||(b(u.$$.fragment,T),b(d.$$.fragment,T),b(v),M=!0)},o(T){j(u.$$.fragment,T),j(d.$$.fragment,T),j(v),M=!1},d(T){T&&(p(e),p(w),p(N)),B(u),B(d),v.d(T)}}}function Gn(t){let e,l,n,o;l=new Fe({props:{$$slots:{default:[Qn]},$$scope:{ctx:t}}}),l.$on("click",t[2]);let a=ce(t[1].jat),r=[];for(let s=0;s<a.length;s+=1)r[s]=ft(it(t,a,s));const i=s=>j(r[s],1,1,()=>{r[s]=null});return{c(){e=X("div"),P(l.$$.fragment),n=O();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var u=Y(e);D(l.$$.fragment,u),n=H(u);for(let c=0;c<r.length;c+=1)r[c].l(u);u.forEach(p),this.h()},h(){te(e,"class","govuk-width-container")},m(s,u){k(s,e,u),U(l,e,null),z(e,n);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);o=!0},p(s,u){const c={};if(u&8192&&(c.$$scope={dirty:u,ctx:s}),l.$set(c),u&3){a=ce(s[1].jat);let d;for(d=0;d<a.length;d+=1){const _=it(s,a,d);r[d]?(r[d].p(_,u),b(r[d],1)):(r[d]=ft(_),r[d].c(),b(r[d],1),r[d].m(e,null))}for(ue(),d=a.length;d<r.length;d+=1)i(d);me()}},i(s){if(!o){b(l.$$.fragment,s);for(let u=0;u<a.length;u+=1)b(r[u]);o=!0}},o(s){j(l.$$.fragment,s),r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)j(r[u]);o=!1},d(s){s&&p(e),B(l),je(r,s)}}}function Jn(t){let e;return{c(){e=G("Back to all junctions")},l(l){e=J(l,"Back to all junctions")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Vn(t){let e;return{c(){e=G("Delete junction")},l(l){e=J(l,"Delete junction")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Rn(t){let e,l,n,o;return e=new ke({props:{$$slots:{default:[Jn]},$$scope:{ctx:t}}}),e.$on("click",t[5]),n=new ze({props:{$$slots:{default:[Vn]},$$scope:{ctx:t}}}),n.$on("click",t[6]),{c(){P(e.$$.fragment),l=O(),P(n.$$.fragment)},l(a){D(e.$$.fragment,a),l=H(a),D(n.$$.fragment,a)},m(a,r){U(e,a,r),k(a,l,r),U(n,a,r),o=!0},p(a,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const s={};r&8192&&(s.$$scope={dirty:r,ctx:a}),n.$set(s)},i(a){o||(b(e.$$.fragment,a),b(n.$$.fragment,a),o=!0)},o(a){j(e.$$.fragment,a),j(n.$$.fragment,a),o=!1},d(a){a&&p(l),B(e,a),B(n,a)}}}function Xn(t){let e,l;return e=new ke({props:{$$slots:{default:[Zn]},$$scope:{ctx:t}}}),e.$on("click",t[9]),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function Wn(t){let e,l;return e=new ke({props:{$$slots:{default:[Kn]},$$scope:{ctx:t}}}),e.$on("click",t[8]),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o&8192&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function Zn(t){let e;return{c(){e=G("Edit Proposed")},l(l){e=J(l,"Edit Proposed")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Kn(t){let e;return{c(){e=G("Edit Existing")},l(l){e=J(l,"Edit Existing")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function Yn(t){let e,l,n=t[0].stage+"",o,a,r,i=t[1].jat[t[0].idx].name+"",s,u,c,d,_,w;const E=[Wn,Xn],N=[];function M(I,$){return I[0].stage=="proposed"?0:1}return c=M(t),d=N[c]=E[c](t),{c(){e=X("p"),l=G("Currently editing "),o=G(n),a=G(` junction
        `),r=X("u"),s=G(i),u=O(),d.c(),_=ae()},l(I){e=W(I,"P",{});var $=Y(e);l=J($,"Currently editing "),o=J($,n),a=J($,` junction
        `),r=W($,"U",{});var v=Y(r);s=J(v,i),v.forEach(p),$.forEach(p),u=H(I),d.l(I),_=ae()},m(I,$){k(I,e,$),z(e,l),z(e,o),z(e,a),z(e,r),z(r,s),k(I,u,$),N[c].m(I,$),k(I,_,$),w=!0},p(I,$){(!w||$&1)&&n!==(n=I[0].stage+"")&&fe(o,n),(!w||$&3)&&i!==(i=I[1].jat[I[0].idx].name+"")&&fe(s,i);let v=c;c=M(I),c===v?N[c].p(I,$):(ue(),j(N[v],1,1,()=>{N[v]=null}),me(),d=N[c],d?d.p(I,$):(d=N[c]=E[c](I),d.c()),b(d,1),d.m(_.parentNode,_))},i(I){w||(b(d),w=!0)},o(I){j(d),w=!1},d(I){I&&(p(e),p(u),p(_)),N[c].d(I)}}}function st(t){let e,l;return e=new On({props:{junctionIdx:t[0].idx,stage:t[0].stage,$$slots:{default:[Yn]},$$scope:{ctx:t}}}),{c(){P(e.$$.fragment)},l(n){D(e.$$.fragment,n)},m(n,o){U(e,n,o),l=!0},p(n,o){const a={};o&1&&(a.junctionIdx=n[0].idx),o&1&&(a.stage=n[0].stage),o&8195&&(a.$$scope={dirty:o,ctx:n}),e.$set(a)},i(n){l||(b(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){B(e,n)}}}function Qn(t){let e;return{c(){e=G("Add new junction")},l(l){e=J(l,"Add new junction")},m(l,n){k(l,e,n)},d(l){l&&p(e)}}}function xn(t){let e,l,n,o=_e(t[10].existing)+"",a,r,i,s,u=_e(t[10].proposed)+"",c,d;return{c(){e=X("div"),l=X("span"),n=G("Existing: "),a=G(o),r=O(),i=X("span"),s=G("Proposed: "),c=G(u),d=O(),this.h()},l(_){e=W(_,"DIV",{style:!0});var w=Y(e);l=W(w,"SPAN",{});var E=Y(l);n=J(E,"Existing: "),a=J(E,o),E.forEach(p),r=H(w),i=W(w,"SPAN",{});var N=Y(i);s=J(N,"Proposed: "),c=J(N,u),N.forEach(p),w.forEach(p),d=H(_),this.h()},h(){R(e,"width","100%"),R(e,"display","flex"),R(e,"justify-content","space-between")},m(_,w){k(_,e,w),z(e,l),z(l,n),z(l,a),z(e,r),z(e,i),z(i,s),z(i,c),k(_,d,w)},p(_,w){w&2&&o!==(o=_e(_[10].existing)+"")&&fe(a,o),w&2&&u!==(u=_e(_[10].proposed)+"")&&fe(c,u)},d(_){_&&(p(e),p(d))}}}function ft(t){let e,l;function n(){return t[4](t[12])}return e=new Be({props:{name:t[10].name||"Untitled junction",$$slots:{default:[xn]},$$scope:{ctx:t}}}),e.$on("click",n),{c(){P(e.$$.fragment)},l(o){D(e.$$.fragment,o)},m(o,a){U(e,o,a),l=!0},p(o,a){t=o;const r={};a&2&&(r.name=t[10].name||"Untitled junction"),a&8194&&(r.$$scope={dirty:a,ctx:t}),e.$set(r)},i(o){l||(b(e.$$.fragment,o),l=!0)},o(o){j(e.$$.fragment,o),l=!1},d(o){B(e,o)}}}function el(t){let e,l,n,o;const a=[Gn,Hn],r=[];function i(s,u){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=i(t))&&(l=r[e]=a[e](t)),{c(){l&&l.c(),n=ae()},l(s){l&&l.l(s),n=ae()},m(s,u){~e&&r[e].m(s,u),k(s,n,u),o=!0},p(s,[u]){let c=e;e=i(s),e===c?~e&&r[e].p(s,u):(l&&(ue(),j(r[c],1,1,()=>{r[c]=null}),me()),~e?(l=r[e],l?l.p(s,u):(l=r[e]=a[e](s),l.c()),b(l,1),l.m(n.parentNode,n)):l=null)},i(s){o||(b(l),o=!0)},o(s){j(l),o=!1},d(s){s&&p(n),~e&&r[e].d(s)}}}function Ae(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function tl(t,e,l){let n;Ie(t,ee,w=>l(1,n=w));let o={kind:"list"};function a(){we(ee,n.jat=[...n.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],n),l(0,o={kind:"edit",idx:n.jat.length-1,stage:"existing"})}function r(w){window.confirm("Delete this junction?")&&(n.jat.splice(w,1),ee.set(n),l(0,o={kind:"list"}))}const i=w=>l(0,o={kind:"edit",idx:w,stage:"existing"}),s=()=>l(0,o={kind:"list"}),u=()=>r(Ae(o));function c(w){t.$$.not_equal(n.jat[o.idx].name,w)&&(n.jat[o.idx].name=w,ee.set(n))}return[o,n,a,r,i,s,u,c,()=>l(0,o={kind:"edit",idx:Ae(o),stage:"existing"}),()=>l(0,o={kind:"edit",idx:Ae(o),stage:"proposed"})]}class jl extends Le{constructor(e){super(),Se(this,e,tl,el,be,{})}}export{jl as component};
