import{s as we,v as Q,x as re,l as Ge,u as ze,m as Ne,o as De,H as W,E as ct,i as T,f as L,a9 as tr,a8 as rr,k as ge,U as Tt,a7 as Ot,N as It,e as V,c as J,b as X,r as pe,a as N,g as D,w as U,h as ye,z as Se,p as nr,q as At,t as ke,d as Ee,j as Ye,B as or,n as ir}from"../chunks/scheduler.Bsni_e59.js";import{S as Le,i as Ce,e as ne,c as A,a as F,m as S,t as w,b as C,d as j,g as Ie,f as Ae}from"../chunks/index.CCfAUppz.js";import{L as Ft,g as St,e as lr,m as de,i as ar,f as jt,M as sr,a as ur,G as mt,h as ht}from"../chunks/MapLibreMap.CIxOOdlx.js";import{e as Be}from"../chunks/each.BmgwAlbi.js";import{c as _e}from"../chunks/colors.CYEpEtTL.js";import{D as fr}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as cr,S as mr}from"../chunks/WarningButton.D9QeV9gM.js";import{a as hr,B as gr,G as dr,S as pr,c as yr,M as gt}from"../chunks/GeoreferenceLayer.DpVvH1eC.js";import{s as te}from"../chunks/data.BErw4HDM.js";import{p as dt}from"../chunks/index.Da2BcqRC.js";import{S as pt}from"../chunks/Select.bLRJACqI.js";import{T as _r}from"../chunks/TextInput.CHbK327s.js";function br(t){let e;const r=t[15].default,n=Ge(r,t,t[23],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&ze(n,r,o,o[23],e?De(r,o[23],l,null):Ne(o[23]),null)},i(o){e||(w(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function vr(t){let e,r,n;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[br]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Ft({props:l}),Q.push(()=>ne(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){A(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){S(e,i,a),n=!0},p(i,[a]){const u={};a&2&&(u.id=i[1]),a&4&&(u.source=i[2]),a&8&&(u.sourceLayer=i[3]),a&16&&(u.beforeId=i[4]),a&32&&(u.beforeLayerType=i[5]),a&64&&(u.paint=i[6]),a&128&&(u.layout=i[7]),a&256&&(u.filter=i[8]),a&512&&(u.minzoom=i[9]),a&1024&&(u.maxzoom=i[10]),a&2048&&(u.hoverCursor=i[11]),a&4096&&(u.manageHoverState=i[12]),a&8192&&(u.eventsIfTopMost=i[13]),a&16384&&(u.interactive=i[14]),a&8388608&&(u.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,u.hovered=i[0],re(()=>r=!1)),e.$set(u)},i(i){n||(w(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){j(e,i)}}}function wr(t,e,r){let{$$slots:n={},$$scope:o}=e,{id:l=St("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:u=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:d}=e,{layout:f=void 0}=e,{filter:p=void 0}=e,{minzoom:c=void 0}=e,{maxzoom:k=void 0}=e,{hoverCursor:E=void 0}=e,{manageHoverState:s=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:M=!0}=e;function B(y){h=y,r(0,h)}function Y(y){W.call(this,t,y)}function x(y){W.call(this,t,y)}function G(y){W.call(this,t,y)}function K(y){W.call(this,t,y)}function q(y){W.call(this,t,y)}function $(y){W.call(this,t,y)}return t.$$set=y=>{"id"in y&&r(1,l=y.id),"source"in y&&r(2,i=y.source),"sourceLayer"in y&&r(3,a=y.sourceLayer),"beforeId"in y&&r(4,u=y.beforeId),"beforeLayerType"in y&&r(5,g=y.beforeLayerType),"paint"in y&&r(6,d=y.paint),"layout"in y&&r(7,f=y.layout),"filter"in y&&r(8,p=y.filter),"minzoom"in y&&r(9,c=y.minzoom),"maxzoom"in y&&r(10,k=y.maxzoom),"hoverCursor"in y&&r(11,E=y.hoverCursor),"manageHoverState"in y&&r(12,s=y.manageHoverState),"hovered"in y&&r(0,h=y.hovered),"eventsIfTopMost"in y&&r(13,v=y.eventsIfTopMost),"interactive"in y&&r(14,M=y.interactive),"$$scope"in y&&r(23,o=y.$$scope)},[h,l,i,a,u,g,d,f,p,c,k,E,s,v,M,n,B,Y,x,G,K,q,$,o]}class Ke extends Le{constructor(e){super(),Ce(this,e,wr,vr,we,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const kr=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),yt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function _t(t){let e,r,n=(t[4]||t[3]instanceof de.Marker)&&bt(t);return{c(){e=V("div"),n&&n.c()},l(o){e=J(o,"DIV",{});var l=X(e);n&&n.l(l),l.forEach(L)},m(o,l){T(o,e,l),n&&n.m(e,null),t[32](e),r=!0},p(o,l){o[4]||o[3]instanceof de.Marker?n?(n.p(o,l),l[0]&24&&w(n,1)):(n=bt(o),n.c(),w(n,1),n.m(e,null)):n&&(Ie(),C(n,1,1,()=>{n=null}),Ae())},i(o){r||(w(n),r=!0)},o(o){C(n),r=!1},d(o){o&&L(e),n&&n.d(),t[32](null)}}}function bt(t){let e;const r=t[30].default,n=Ge(r,t,t[29],yt);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[0]&536870933)&&ze(n,r,o,o[29],e?De(r,o[29],l,kr):Ne(o[29]),yt)},i(o){e||(w(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Er(t){let e,r,n=t[9].default&&_t(t);return{c(){n&&n.c(),e=ct()},l(o){n&&n.l(o),e=ct()},m(o,l){n&&n.m(o,l),T(o,e,l),r=!0},p(o,l){o[9].default?n?(n.p(o,l),l[0]&512&&w(n,1)):(n=_t(o),n.c(),w(n,1),n.m(e.parentNode,e)):n&&(Ie(),C(n,1,1,()=>{n=null}),Ae())},i(o){r||(w(n),r=!0)},o(o){C(n),r=!1},d(o){o&&L(e),n&&n.d(o)}}}function Lr(t,e,r){let n,o,l,i,a,u,{$$slots:g={},$$scope:d}=e;const f=tr(g);let{closeButton:p=void 0}=e,{closeOnClickOutside:c=!0}=e,{closeOnClickInside:k=!1}=e,{closeOnMove:E=!1}=e,{openOn:s="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:v=!0}=e,{anchor:M=void 0}=e,{offset:B=void 0}=e,{popupClass:Y=void 0}=e,{maxWidth:x=void 0}=e,{lngLat:G=void 0}=e,{html:K=void 0}=e,{open:q=!1}=e;const $=rr(),{map:y,popupTarget:_,layerEvent:ce,layer:b,eventTopMost:z}=lr();ge(t,y,m=>r(2,l=m)),ge(t,_,m=>r(3,a=m)),ge(t,ce,m=>r(28,i=m)),ge(t,b,m=>r(35,u=m));const me=["click","dblclick","contextmenu"];let P,oe=!1,ie;function xt(){if(!P)return;let m=P.getElement();!m||m===ie||(ie=m,s==="hover"&&(ie.style.pointerEvents="none"),ie.addEventListener("mouseenter",()=>{r(24,oe=!0)},{passive:!0}),ie.addEventListener("mouseleave",()=>{r(24,oe=!1)},{passive:!0}),ie.addEventListener("click",()=>{k&&r(0,q=!1)},{passive:!0}))}Tt(()=>{if(l)return l.on("click",Fe),l.on("contextmenu",Fe),typeof a=="string"&&(l.on("click",a,fe),l.on("dblclick",a,fe),l.on("contextmenu",a,fe),l.on("mousemove",a,ft),l.on("mouseleave",a,ut),l.on("touchstart",a,at),l.on("touchend",a,st)),()=>{l!=null&&l.loaded()&&(P==null||P.remove(),l.off("click",Fe),l.off("contextmenu",Fe),a instanceof de.Marker?a.getPopup()===P&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,fe),l.off("dblclick",a,fe),l.off("contextmenu",a,fe),l.off("mousemove",a,ft),l.off("mouseleave",a,ut),l.off("touchstart",a,at),l.off("touchend",a,st)))}});function lt(m){return h?!("marker"in m)&&!ar(m)&&z(m)!==u:!1}let Z=null,ee="normal";function fe(m){m.type===s&&(lt(m)||("layerType"in m?m.layerType==="deckgl"?(r(10,G=m.coordinate),r(4,Z=m.object?[m.object]:null)):(r(10,G=m.lngLat),r(4,Z=m.features??[])):(r(10,G=m.lngLat),r(4,Z=m.features??[])),setTimeout(()=>r(0,q=!0))))}let he=null;function at(m){he=m.point}function st(m){if(!he||s!=="hover")return;let Ve=he.dist(m.point);he=null,Ve<3&&(r(10,G=m.lngLat),r(4,Z=m.features??[]),P.isOpen()?r(25,ee="justOpened"):(r(25,ee="opening"),r(0,q=!0)))}function ut(m){s!=="hover"||he||ee!=="normal"||(r(0,q=!1),r(4,Z=null))}function ft(m){if(!(s!=="hover"||he||ee!=="normal")){if(lt(m)){r(0,q=!1),r(4,Z=null);return}r(0,q=!0),r(4,Z=m.features??[]),r(10,G=m.lngLat)}}function Fe(m){if(ee==="justOpened"){r(25,ee="normal");return}if(!c)return;let Ve=[ie,a instanceof de.Marker?a==null?void 0:a.getElement():null];q&&P.isOpen()&&!Ve.some(Je=>Je==null?void 0:Je.contains(m.originalEvent.target))&&(m.type==="contextmenu"&&s==="contextmenu"||m.type!=="contextmenu")&&r(0,q=!1)}Ot(()=>{l&&(P!=null&&P.isOpen())&&P.remove()});let Me;const $t=()=>r(0,q=!1);function er(m){Q[m?"unshift":"push"](()=>{Me=m,r(1,Me)})}return t.$$set=m=>{"closeButton"in m&&r(11,p=m.closeButton),"closeOnClickOutside"in m&&r(12,c=m.closeOnClickOutside),"closeOnClickInside"in m&&r(13,k=m.closeOnClickInside),"closeOnMove"in m&&r(14,E=m.closeOnMove),"openOn"in m&&r(15,s=m.openOn),"openIfTopMost"in m&&r(16,h=m.openIfTopMost),"focusAfterOpen"in m&&r(17,v=m.focusAfterOpen),"anchor"in m&&r(18,M=m.anchor),"offset"in m&&r(19,B=m.offset),"popupClass"in m&&r(20,Y=m.popupClass),"maxWidth"in m&&r(21,x=m.maxWidth),"lngLat"in m&&r(10,G=m.lngLat),"html"in m&&r(22,K=m.html),"open"in m&&r(0,q=m.open),"$$scope"in m&&r(29,d=m.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&r(27,n=p??(!c&&!k)),t.$$.dirty[0]&146685952&&(P||(r(23,P=new de.Popup({closeButton:n,closeOnClick:!1,closeOnMove:E,focusAfterOpen:v,maxWidth:x,className:Y,anchor:M,offset:B})),ie=P.getElement(),P.on("open",()=>{r(0,q=!0),xt(),$("open",P)}),P.on("close",()=>{r(0,q=!1),$("close",P)}),P.on("hover",()=>{$("hover",P)}))),t.$$.dirty[0]&8421384&&P&&a instanceof de.Marker&&(s==="click"?a.setPopup(P):a.getPopup()===P&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&me.includes(s)&&(i==null?void 0:i.type)===s&&(fe(i),It(ce,i=null,i)),t.$$.dirty[0]&268468224&&r(26,o=s==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&s==="hover"&&ce&&(o&&i&&(i.layerType==="deckgl"?(r(10,G=i.coordinate),r(4,Z=i.object?[i.object]:null)):(r(10,G=i.lngLat),r(4,Z=i.features??[]))),r(0,q=(o||oe)??!1)),t.$$.dirty[0]&12582914&&(Me?P.setDOMContent(Me):K&&P.setHTML(K)),t.$$.dirty[0]&8389632&&G&&P.setLngLat(G),t.$$.dirty[0]&41943045&&l){let m=P.isOpen();q&&!m?(P.addTo(l),ee==="opening"&&r(25,ee="justOpened")):!q&&m&&P.remove()}},[q,Me,l,a,Z,y,_,ce,b,f,G,p,c,k,E,s,h,v,M,B,Y,x,K,P,oe,ee,o,n,i,d,g,$t,er]}class Cr extends Le{constructor(e){super(),Ce(this,e,Lr,Er,we,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Mr(t){let e;const r=t[16].default,n=Ge(r,t,t[24],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&ze(n,r,o,o[24],e?De(r,o[24],l,null):Ne(o[24]),null)},i(o){e||(w(n,o),e=!0)},o(o){C(n,o),e=!1},d(o){n&&n.d(o)}}}function Pr(t){let e,r,n;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Mr]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Ft({props:l}),Q.push(()=>ne(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){A(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){S(e,i,a),n=!0},p(i,[a]){const u={};a&2&&(u.id=i[1]),a&4&&(u.source=i[2]),a&8&&(u.sourceLayer=i[3]),a&16&&(u.beforeId=i[4]),a&32&&(u.beforeLayerType=i[5]),a&64&&(u.paint=i[6]),a&128&&(u.layout=i[7]),a&256&&(u.filter=i[8]),a&512&&(u.applyToClusters=i[9]),a&1024&&(u.minzoom=i[10]),a&2048&&(u.maxzoom=i[11]),a&4096&&(u.hoverCursor=i[12]),a&8192&&(u.manageHoverState=i[13]),a&16384&&(u.eventsIfTopMost=i[14]),a&32768&&(u.interactive=i[15]),a&16777216&&(u.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,u.hovered=i[0],re(()=>r=!1)),e.$set(u)},i(i){n||(w(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){j(e,i)}}}function Tr(t,e,r){let{$$slots:n={},$$scope:o}=e,{id:l=St("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:u=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:d=void 0}=e,{layout:f=void 0}=e,{filter:p=void 0}=e,{applyToClusters:c=void 0}=e,{minzoom:k=void 0}=e,{maxzoom:E=void 0}=e,{hoverCursor:s=void 0}=e,{manageHoverState:h=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:M=!1}=e,{interactive:B=!0}=e;function Y(_){v=_,r(0,v)}function x(_){W.call(this,t,_)}function G(_){W.call(this,t,_)}function K(_){W.call(this,t,_)}function q(_){W.call(this,t,_)}function $(_){W.call(this,t,_)}function y(_){W.call(this,t,_)}return t.$$set=_=>{"id"in _&&r(1,l=_.id),"source"in _&&r(2,i=_.source),"sourceLayer"in _&&r(3,a=_.sourceLayer),"beforeId"in _&&r(4,u=_.beforeId),"beforeLayerType"in _&&r(5,g=_.beforeLayerType),"paint"in _&&r(6,d=_.paint),"layout"in _&&r(7,f=_.layout),"filter"in _&&r(8,p=_.filter),"applyToClusters"in _&&r(9,c=_.applyToClusters),"minzoom"in _&&r(10,k=_.minzoom),"maxzoom"in _&&r(11,E=_.maxzoom),"hoverCursor"in _&&r(12,s=_.hoverCursor),"manageHoverState"in _&&r(13,h=_.manageHoverState),"hovered"in _&&r(0,v=_.hovered),"eventsIfTopMost"in _&&r(14,M=_.eventsIfTopMost),"interactive"in _&&r(15,B=_.interactive),"$$scope"in _&&r(24,o=_.$$scope)},[v,l,i,a,u,g,d,f,p,c,k,E,s,h,M,B,n,Y,x,G,K,q,$,y,o]}class Or extends Le{constructor(e){super(),Ce(this,e,Tr,Pr,we,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Ir=t=>({props:t&8}),vt=t=>({props:Sr(t[3])});function Ar(t){let e,r;const n=t[1].default,o=Ge(n,t,t[2],vt);return{c(){e=V("div"),o&&o.c(),this.h()},l(l){e=J(l,"DIV",{class:!0});var i=X(e);o&&o.l(i),i.forEach(L),this.h()},h(){pe(e,"class","govuk-prose")},m(l,i){T(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&12)&&ze(o,n,l,l[2],r?De(n,l[2],i,Ir):Ne(l[2]),vt)},i(l){r||(w(o,l),r=!0)},o(l){C(o,l),r=!1},d(l){l&&L(e),o&&o.d(l)}}}function Fr(t){let e,r;return e=new Cr({props:{openOn:t[0],$$slots:{default:[Ar,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(n){F(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,[o]){const l={};o&1&&(l.openOn=n[0]),o&12&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){r||(w(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Sr(t){return t?t[0].properties??{}:{}}function jr(t,e,r){let{$$slots:n={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&r(0,l=i.openOn),"$$scope"in i&&r(2,o=i.$$scope)},[l,n,o]}class Bt extends Le{constructor(e){super(),Ce(this,e,jr,Fr,we,{openOn:0})}}var Br=Object.defineProperty,O=(t,e)=>Br(t,"name",{value:e,configurable:!0}),qr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Pe(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Ze(e),o=Ze(r);return n.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Pe(e,r))return!1;const l=e;let i=r;if(o&&!this.compareCoord(l[0],i[0])){const u=this.fixStartIndex(i,l);if(u)i=u;else return!1}const a=this.compareCoord(l[n],i[n]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[n],i[i.length-(1+n)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],r[0])){o=l;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,r){return Pe(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?jt(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Pe(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};O(qr,"GeojsonEquality");function Pe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}O(Pe,"sameLength");function Ze(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}O(Ze,"explode");var H=63710088e-1,qt={centimeters:H*100,centimetres:H*100,degrees:360/(2*Math.PI),feet:H*3.28084,inches:H*39.37,kilometers:H/1e3,kilometres:H/1e3,meters:H,metres:H,miles:H/1609.344,millimeters:H*1e3,millimetres:H*1e3,nauticalmiles:H/1852,radians:1,yards:H*1.0936},wt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function le(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}O(le,"feature");function Gr(t,e,r={}){switch(t){case"Point":return He(e).geometry;case"LineString":return $e(e).geometry;case"Polygon":return xe(e).geometry;case"MultiPoint":return zt(e).geometry;case"MultiLineString":return Gt(e).geometry;case"MultiPolygon":return Nt(e).geometry;default:throw new Error(t+" is invalid")}}O(Gr,"geometry");function He(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!be(t[0])||!be(t[1]))throw new Error("coordinates must contain numbers");return le({type:"Point",coordinates:t},e,r)}O(He,"point");function zr(t,e,r={}){return Re(t.map(n=>He(n,e)),r)}O(zr,"points");function xe(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return le({type:"Polygon",coordinates:t},e,r)}O(xe,"polygon");function Nr(t,e,r={}){return Re(t.map(n=>xe(n,e)),r)}O(Nr,"polygons");function $e(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return le({type:"LineString",coordinates:t},e,r)}O($e,"lineString");function Dr(t,e,r={}){return Re(t.map(n=>$e(n,e)),r)}O(Dr,"lineStrings");function Re(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}O(Re,"featureCollection");function Gt(t,e,r={}){return le({type:"MultiLineString",coordinates:t},e,r)}O(Gt,"multiLineString");function zt(t,e,r={}){return le({type:"MultiPoint",coordinates:t},e,r)}O(zt,"multiPoint");function Nt(t,e,r={}){return le({type:"MultiPolygon",coordinates:t},e,r)}O(Nt,"multiPolygon");function Hr(t,e,r={}){return le({type:"GeometryCollection",geometries:t},e,r)}O(Hr,"geometryCollection");function Rr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}O(Rr,"round");function Dt(t,e="kilometers"){const r=qt[e];if(!r)throw new Error(e+" units is invalid");return t*r}O(Dt,"radiansToLength");function We(t,e="kilometers"){const r=qt[e];if(!r)throw new Error(e+" units is invalid");return t/r}O(We,"lengthToRadians");function Wr(t,e){return qe(We(t,e))}O(Wr,"lengthToDegrees");function Ur(t){let e=t%360;return e<0&&(e+=360),e}O(Ur,"bearingToAzimuth");function qe(t){return t%(2*Math.PI)*180/Math.PI}O(qe,"radiansToDegrees");function je(t){return t%360*Math.PI/180}O(je,"degreesToRadians");function Vr(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Dt(We(t,e),r)}O(Vr,"convertLength");function Jr(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=wt[e];if(!n)throw new Error("invalid original units");const o=wt[r];if(!o)throw new Error("invalid final units");return t/n*o}O(Jr,"convertArea");function be(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}O(be,"isNumber");function Kr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}O(Kr,"isObject");function Zr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!be(e))throw new Error("bbox must only contain numbers")})}O(Zr,"validateBBox");function Qr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}O(Qr,"validateId");var Xr=Object.defineProperty,ae=(t,e)=>Xr(t,"name",{value:e,configurable:!0});function Ht(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ae(Ht,"getCoord");function Yr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ae(Yr,"getCoords");function Rt(t){if(t.length>1&&be(t[0])&&be(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Rt(t[0]);throw new Error("coordinates must only contain numbers")}ae(Rt,"containsNumber");function xr(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}ae(xr,"geojsonType");function $r(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}ae($r,"featureOf");function en(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}ae(en,"collectionOf");function tn(t){return t.type==="Feature"?t.geometry:t}ae(tn,"getGeom");function rn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ae(rn,"getType");var nn=Object.defineProperty,on=(t,e)=>nn(t,"name",{value:e,configurable:!0});function Wt(t,e,r,n={}){const o=Ht(t),l=je(o[0]),i=je(o[1]),a=je(r),u=We(e,n.units),g=Math.asin(Math.sin(i)*Math.cos(u)+Math.cos(i)*Math.sin(u)*Math.cos(a)),d=l+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(i),Math.cos(u)-Math.sin(i)*Math.sin(g)),f=qe(d),p=qe(g);return He([f,p],n.properties)}on(Wt,"destination");var ln=Wt,an=Object.defineProperty,I=(t,e)=>an(t,"name",{value:e,configurable:!0}),sn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Te(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Qe(e),o=Qe(r);return n.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Te(e,r))return!1;const l=e;let i=r;if(o&&!this.compareCoord(l[0],i[0])){const u=this.fixStartIndex(i,l);if(u)i=u;else return!1}const a=this.compareCoord(l[n],i[n]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[n],i[i.length-(1+n)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],r[0])){o=l;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,r){return Te(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?jt(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Te(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};I(sn,"GeojsonEquality");function Te(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}I(Te,"sameLength");function Qe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}I(Qe,"explode");var R=63710088e-1,Ut={centimeters:R*100,centimetres:R*100,degrees:360/(2*Math.PI),feet:R*3.28084,inches:R*39.37,kilometers:R/1e3,kilometres:R/1e3,meters:R,metres:R,miles:R/1609.344,millimeters:R*1e3,millimetres:R*1e3,nauticalmiles:R/1852,radians:1,yards:R*1.0936},kt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function se(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}I(se,"feature");function un(t,e,r={}){switch(t){case"Point":return et(e).geometry;case"LineString":return rt(e).geometry;case"Polygon":return tt(e).geometry;case"MultiPoint":return Jt(e).geometry;case"MultiLineString":return Vt(e).geometry;case"MultiPolygon":return Kt(e).geometry;default:throw new Error(t+" is invalid")}}I(un,"geometry");function et(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ve(t[0])||!ve(t[1]))throw new Error("coordinates must contain numbers");return se({type:"Point",coordinates:t},e,r)}I(et,"point");function fn(t,e,r={}){return Ue(t.map(n=>et(n,e)),r)}I(fn,"points");function tt(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return se({type:"Polygon",coordinates:t},e,r)}I(tt,"polygon");function cn(t,e,r={}){return Ue(t.map(n=>tt(n,e)),r)}I(cn,"polygons");function rt(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return se({type:"LineString",coordinates:t},e,r)}I(rt,"lineString");function mn(t,e,r={}){return Ue(t.map(n=>rt(n,e)),r)}I(mn,"lineStrings");function Ue(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}I(Ue,"featureCollection");function Vt(t,e,r={}){return se({type:"MultiLineString",coordinates:t},e,r)}I(Vt,"multiLineString");function Jt(t,e,r={}){return se({type:"MultiPoint",coordinates:t},e,r)}I(Jt,"multiPoint");function Kt(t,e,r={}){return se({type:"MultiPolygon",coordinates:t},e,r)}I(Kt,"multiPolygon");function hn(t,e,r={}){return se({type:"GeometryCollection",geometries:t},e,r)}I(hn,"geometryCollection");function gn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}I(gn,"round");function Zt(t,e="kilometers"){const r=Ut[e];if(!r)throw new Error(e+" units is invalid");return t*r}I(Zt,"radiansToLength");function nt(t,e="kilometers"){const r=Ut[e];if(!r)throw new Error(e+" units is invalid");return t/r}I(nt,"lengthToRadians");function dn(t,e){return ot(nt(t,e))}I(dn,"lengthToDegrees");function pn(t){let e=t%360;return e<0&&(e+=360),e}I(pn,"bearingToAzimuth");function ot(t){return t%(2*Math.PI)*180/Math.PI}I(ot,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}I(Oe,"degreesToRadians");function yn(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Zt(nt(t,e),r)}I(yn,"convertLength");function _n(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=kt[e];if(!n)throw new Error("invalid original units");const o=kt[r];if(!o)throw new Error("invalid final units");return t/n*o}I(_n,"convertArea");function ve(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}I(ve,"isNumber");function bn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}I(bn,"isObject");function vn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ve(e))throw new Error("bbox must only contain numbers")})}I(vn,"validateBBox");function wn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}I(wn,"validateId");var kn=Object.defineProperty,ue=(t,e)=>kn(t,"name",{value:e,configurable:!0});function Xe(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ue(Xe,"getCoord");function En(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ue(En,"getCoords");function Qt(t){if(t.length>1&&ve(t[0])&&ve(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Qt(t[0]);throw new Error("coordinates must only contain numbers")}ue(Qt,"containsNumber");function Ln(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}ue(Ln,"geojsonType");function Cn(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}ue(Cn,"featureOf");function Mn(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}ue(Mn,"collectionOf");function Pn(t){return t.type==="Feature"?t.geometry:t}ue(Pn,"getGeom");function Tn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ue(Tn,"getType");var On=Object.defineProperty,Xt=(t,e)=>On(t,"name",{value:e,configurable:!0});function it(t,e,r={}){if(r.final===!0)return Yt(t,e);const n=Xe(t),o=Xe(e),l=Oe(n[0]),i=Oe(o[0]),a=Oe(n[1]),u=Oe(o[1]),g=Math.sin(i-l)*Math.cos(u),d=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(i-l);return ot(Math.atan2(g,d))}Xt(it,"bearing");function Yt(t,e){let r=it(e,t);return r=(r+180)%360,r}Xt(Yt,"calculateFinalBearing");var In=it;function An(t){let e,r,n,o,l,i,a,u,g;function d(s){t[4](s)}let f={label:"Name"};t[1].jat.movements[t[0]].name!==void 0&&(f.value=t[1].jat.movements[t[0]].name),e=new _r({props:f}),Q.push(()=>ne(e,"value",d));function p(s){t[5](s)}let c={label:"Kind",choices:t[2]};t[1].jat.movements[t[0]].kind!==void 0&&(c.value=t[1].jat.movements[t[0]].kind),o=new pt({props:c}),Q.push(()=>ne(o,"value",p));function k(s){t[6](s)}let E={label:"Color",choices:t[3]};return t[1].jat.movements[t[0]].color!==void 0&&(E.value=t[1].jat.movements[t[0]].color),a=new pt({props:E}),Q.push(()=>ne(a,"value",k)),{c(){A(e.$$.fragment),n=N(),A(o.$$.fragment),i=N(),A(a.$$.fragment)},l(s){F(e.$$.fragment,s),n=D(s),F(o.$$.fragment,s),i=D(s),F(a.$$.fragment,s)},m(s,h){S(e,s,h),T(s,n,h),S(o,s,h),T(s,i,h),S(a,s,h),g=!0},p(s,[h]){const v={};!r&&h&3&&(r=!0,v.value=s[1].jat.movements[s[0]].name,re(()=>r=!1)),e.$set(v);const M={};!l&&h&3&&(l=!0,M.value=s[1].jat.movements[s[0]].kind,re(()=>l=!1)),o.$set(M);const B={};!u&&h&3&&(u=!0,B.value=s[1].jat.movements[s[0]].color,re(()=>u=!1)),a.$set(B)},i(s){g||(w(e.$$.fragment,s),w(o.$$.fragment,s),w(a.$$.fragment,s),g=!0)},o(s){C(e.$$.fragment,s),C(o.$$.fragment,s),C(a.$$.fragment,s),g=!1},d(s){s&&(L(n),L(i)),j(e,s),j(o,s),j(a,s)}}}function Fn(t,e,r){let n;ge(t,te,d=>r(1,n=d));let{idx:o}=e,l=dt(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),i=dt(["green","amber","red","critical"]);function a(d){t.$$.not_equal(n.jat.movements[o].name,d)&&(n.jat.movements[o].name=d,te.set(n))}function u(d){t.$$.not_equal(n.jat.movements[o].kind,d)&&(n.jat.movements[o].kind=d,te.set(n))}function g(d){t.$$.not_equal(n.jat.movements[o].color,d)&&(n.jat.movements[o].color=d,te.set(n))}return t.$$set=d=>{"idx"in d&&r(0,o=d.idx)},[o,n,l,i,a,u,g]}class Sn extends Le{constructor(e){super(),Ce(this,e,Fn,An,we,{idx:0})}}const{window:jn}=ur;function Et(t,e,r){const n=t.slice();return n[28]=e[r],n[29]=e,n[30]=r,n}function Lt(t,e,r){const n=t.slice();return n[28]=e[r],n[30]=r,n}function Bn(t){let e,r,n,o,l,i;return e=new fr({props:{$$slots:{default:[Gn]},$$scope:{ctx:t}}}),e.$on("click",t[17]),n=new cr({props:{$$slots:{default:[zn]},$$scope:{ctx:t}}}),n.$on("click",t[9]),l=new Sn({props:{idx:t[0]}}),{c(){A(e.$$.fragment),r=N(),A(n.$$.fragment),o=N(),A(l.$$.fragment)},l(a){F(e.$$.fragment,a),r=D(a),F(n.$$.fragment,a),o=D(a),F(l.$$.fragment,a)},m(a,u){S(e,a,u),T(a,r,u),S(n,a,u),T(a,o,u),S(l,a,u),i=!0},p(a,u){const g={};u[1]&2&&(g.$$scope={dirty:u,ctx:a}),e.$set(g);const d={};u[1]&2&&(d.$$scope={dirty:u,ctx:a}),n.$set(d);const f={};u[0]&1&&(f.idx=a[0]),l.$set(f)},i(a){i||(w(e.$$.fragment,a),w(n.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(n.$$.fragment,a),C(l.$$.fragment,a),i=!1},d(a){a&&(L(r),L(o)),j(e,a),j(n,a),j(l,a)}}}function qn(t){let e,r,n,o,l,i,a,u,g="Movements",d,f,p;e=new mr({props:{$$slots:{default:[Nn]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new gr({}),l=new dr({});let c=t[3]&&Ct(t),k=Be(t[2].jat.movements),E=[];for(let s=0;s<k.length;s+=1)E[s]=Mt(Lt(t,k,s));return{c(){A(e.$$.fragment),r=N(),A(n.$$.fragment),o=N(),A(l.$$.fragment),i=N(),c&&c.c(),a=N(),u=V("h3"),u.textContent=g,d=N(),f=V("ol");for(let s=0;s<E.length;s+=1)E[s].c()},l(s){F(e.$$.fragment,s),r=D(s),F(n.$$.fragment,s),o=D(s),F(l.$$.fragment,s),i=D(s),c&&c.l(s),a=D(s),u=J(s,"H3",{"data-svelte-h":!0}),nr(u)!=="svelte-1dc52s8"&&(u.textContent=g),d=D(s),f=J(s,"OL",{});var h=X(f);for(let v=0;v<E.length;v+=1)E[v].l(h);h.forEach(L)},m(s,h){S(e,s,h),T(s,r,h),S(n,s,h),T(s,o,h),S(l,s,h),T(s,i,h),c&&c.m(s,h),T(s,a,h),T(s,u,h),T(s,d,h),T(s,f,h);for(let v=0;v<E.length;v+=1)E[v]&&E[v].m(f,null);p=!0},p(s,h){const v={};if(h[1]&2&&(v.$$scope={dirty:h,ctx:s}),e.$set(v),s[3]?c?(c.p(s,h),h[0]&8&&w(c,1)):(c=Ct(s),c.c(),w(c,1),c.m(a.parentNode,a)):c&&(Ie(),C(c,1,1,()=>{c=null}),Ae()),h[0]&70){k=Be(s[2].jat.movements);let M;for(M=0;M<k.length;M+=1){const B=Lt(s,k,M);E[M]?E[M].p(B,h):(E[M]=Mt(B),E[M].c(),E[M].m(f,null))}for(;M<E.length;M+=1)E[M].d(1);E.length=k.length}},i(s){p||(w(e.$$.fragment,s),w(n.$$.fragment,s),w(l.$$.fragment,s),w(c),p=!0)},o(s){C(e.$$.fragment,s),C(n.$$.fragment,s),C(l.$$.fragment,s),C(c),p=!1},d(s){s&&(L(r),L(o),L(i),L(a),L(u),L(d),L(f)),j(e,s),j(n,s),j(l,s),c&&c.d(s),At(E,s)}}}function Gn(t){let e;return{c(){e=ke("Save")},l(r){e=Ee(r,"Save")},m(r,n){T(r,e,n)},d(r){r&&L(e)}}}function zn(t){let e;return{c(){e=ke("Delete")},l(r){e=Ee(r,"Delete")},m(r,n){T(r,e,n)},d(r){r&&L(e)}}}function Nn(t){let e;return{c(){e=ke("Zoom to fit")},l(r){e=Ee(r,"Zoom to fit")},m(r,n){T(r,e,n)},d(r){r&&L(e)}}}function Ct(t){let e,r,n;function o(i){t[13](i)}let l={map:t[3]};return t[4]!==void 0&&(l.enabled=t[4]),e=new pr({props:l}),Q.push(()=>ne(e,"enabled",o)),{c(){A(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){S(e,i,a),n=!0},p(i,a){const u={};a[0]&8&&(u.map=i[3]),!r&&a[0]&16&&(r=!0,u.enabled=i[4],re(()=>r=!1)),e.$set(u)},i(i){n||(w(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){j(e,i)}}}function Mt(t){let e,r,n=(t[28].name||"Unnamed movement")+"",o,l,i,a;function u(){return t[14](t[30])}function g(){return t[15](t[30])}return{c(){e=V("li"),r=V("a"),o=ke(n),l=N(),this.h()},l(d){e=J(d,"LI",{});var f=X(e);r=J(f,"A",{href:!0});var p=X(r);o=Ee(p,n),p.forEach(L),l=D(f),f.forEach(L),this.h()},h(){pe(r,"href","#")},m(d,f){T(d,e,f),ye(e,r),ye(r,o),ye(e,l),i||(a=[Se(r,"click",u),Se(r,"mouseenter",g),Se(r,"mouseleave",t[16])],i=!0)},p(d,f){t=d,f[0]&4&&n!==(n=(t[28].name||"Unnamed movement")+"")&&Ye(o,n)},d(d){d&&L(e),i=!1,or(a)}}}function Dn(t){let e,r;return{c(){e=V("span"),this.h()},l(n){e=J(n,"SPAN",{class:!0,style:!0}),X(e).forEach(L),this.h()},h(){pe(e,"class","dot svelte-1kvjd2"),pe(e,"style",r=`background-color: ${_e[t[28].color].background}`)},m(n,o){T(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${_e[n[28].color].background}`)&&pe(e,"style",r)},d(n){n&&L(e)}}}function Hn(t){let e;return{c(){e=V("span"),this.h()},l(r){e=J(r,"SPAN",{class:!0}),X(e).forEach(L),this.h()},h(){pe(e,"class","dot svelte-1kvjd2"),U(e,"background-color",_e[t[28].color].background),U(e,"opacity",t[28].kind=="pedestrian"?"100%":"0%")},m(r,n){T(r,e,n)},p(r,n){n[0]&4&&U(e,"background-color",_e[r[28].color].background),n[0]&4&&U(e,"opacity",r[28].kind=="pedestrian"?"100%":"0%")},d(r){r&&L(e)}}}function Pt(t){let e,r,n,o,l,i;function a(c){t[18](c,t[28])}function u(){return t[19](t[30])}let g={draggable:!0,$$slots:{default:[Dn]},$$scope:{ctx:t}};t[28].point1!==void 0&&(g.lngLat=t[28].point1),e=new gt({props:g}),Q.push(()=>ne(e,"lngLat",a)),e.$on("dragend",u);function d(c){t[20](c,t[28])}function f(){return t[21](t[30])}let p={draggable:!0,$$slots:{default:[Hn]},$$scope:{ctx:t}};return t[28].point2!==void 0&&(p.lngLat=t[28].point2),o=new gt({props:p}),Q.push(()=>ne(o,"lngLat",d)),o.$on("dragend",f),{c(){A(e.$$.fragment),n=N(),A(o.$$.fragment)},l(c){F(e.$$.fragment,c),n=D(c),F(o.$$.fragment,c)},m(c,k){S(e,c,k),T(c,n,k),S(o,c,k),i=!0},p(c,k){t=c;const E={};k[0]&4|k[1]&2&&(E.$$scope={dirty:k,ctx:t}),!r&&k[0]&4&&(r=!0,E.lngLat=t[28].point1,re(()=>r=!1)),e.$set(E);const s={};k[0]&4|k[1]&2&&(s.$$scope={dirty:k,ctx:t}),!l&&k[0]&4&&(l=!0,s.lngLat=t[28].point2,re(()=>l=!1)),o.$set(s)},i(c){i||(w(e.$$.fragment,c),w(o.$$.fragment,c),i=!0)},o(c){C(e.$$.fragment,c),C(o.$$.fragment,c),i=!1},d(c){c&&L(n),j(e,c),j(o,c)}}}function Rn(t){let e=(t[27].name||"Untitled movement")+"",r;return{c(){r=ke(e)},l(n){r=Ee(n,e)},m(n,o){T(n,r,o)},p(n,o){o[0]&134217728&&e!==(e=(n[27].name||"Untitled movement")+"")&&Ye(r,e)},d(n){n&&L(r)}}}function Wn(t){let e,r;return e=new Bt({props:{$$slots:{default:[Rn,({props:n})=>({27:n}),({props:n})=>[n?134217728:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(n){F(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const l={};o[0]&134217728|o[1]&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){r||(w(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Un(t){let e=(t[27].name||"Untitled movement")+"",r;return{c(){r=ke(e)},l(n){r=Ee(n,e)},m(n,o){T(n,r,o)},p(n,o){o[0]&134217728&&e!==(e=(n[27].name||"Untitled movement")+"")&&Ye(r,e)},d(n){n&&L(r)}}}function Vn(t){let e,r;return e=new Bt({props:{$$slots:{default:[Un,({props:n})=>({27:n}),({props:n})=>[n?134217728:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(n){F(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const l={};o[0]&134217728|o[1]&2&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){r||(w(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Jn(t){let e,r,n,o,l,i;return e=new Ke({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":ht(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Wn]},$$scope:{ctx:t}}}),e.$on("click",t[7]),n=new Ke({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":ht(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Vn]},$$scope:{ctx:t}}}),n.$on("click",t[7]),l=new Or({props:{id:"jat-arrow",filter:["all",["has","angle"],["!=",["get","kind"],"pedestrian"]],paint:{"text-color":["get","color"],"text-halo-color":"black","text-halo-width":1},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){A(e.$$.fragment),r=N(),A(n.$$.fragment),o=N(),A(l.$$.fragment)},l(a){F(e.$$.fragment,a),r=D(a),F(n.$$.fragment,a),o=D(a),F(l.$$.fragment,a)},m(a,u){S(e,a,u),T(a,r,u),S(n,a,u),T(a,o,u),S(l,a,u),i=!0},p(a,u){const g={};u[1]&2&&(g.$$scope={dirty:u,ctx:a}),e.$set(g);const d={};u[1]&2&&(d.$$scope={dirty:u,ctx:a}),n.$set(d)},i(a){i||(w(e.$$.fragment,a),w(n.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(n.$$.fragment,a),C(l.$$.fragment,a),i=!1},d(a){a&&(L(r),L(o)),j(e,a),j(n,a),j(l,a)}}}function Kn(t){let e,r;return e=new Ke({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){A(e.$$.fragment)},l(n){F(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p:ir,i(n){r||(w(e.$$.fragment,n),r=!0)},o(n){C(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Zn(t){let e,r,n,o,l,i,a,u=Be(t[2].jat.movements),g=[];for(let f=0;f<u.length;f+=1)g[f]=Pt(Et(t,u,f));const d=f=>C(g[f],1,1,()=>{g[f]=null});return r=new mt({props:{data:t[8](t[2].jat.movements),$$slots:{default:[Jn]},$$scope:{ctx:t}}}),o=new mt({props:{data:t[5],$$slots:{default:[Kn]},$$scope:{ctx:t}}}),i=new yr({props:{map:t[3]}}),{c(){for(let f=0;f<g.length;f+=1)g[f].c();e=N(),A(r.$$.fragment),n=N(),A(o.$$.fragment),l=N(),A(i.$$.fragment)},l(f){for(let p=0;p<g.length;p+=1)g[p].l(f);e=D(f),F(r.$$.fragment,f),n=D(f),F(o.$$.fragment,f),l=D(f),F(i.$$.fragment,f)},m(f,p){for(let c=0;c<g.length;c+=1)g[c]&&g[c].m(f,p);T(f,e,p),S(r,f,p),T(f,n,p),S(o,f,p),T(f,l,p),S(i,f,p),a=!0},p(f,p){if(p[0]&68){u=Be(f[2].jat.movements);let s;for(s=0;s<u.length;s+=1){const h=Et(f,u,s);g[s]?(g[s].p(h,p),w(g[s],1)):(g[s]=Pt(h),g[s].c(),w(g[s],1),g[s].m(e.parentNode,e))}for(Ie(),s=u.length;s<g.length;s+=1)d(s);Ae()}const c={};p[0]&4&&(c.data=f[8](f[2].jat.movements)),p[1]&2&&(c.$$scope={dirty:p,ctx:f}),r.$set(c);const k={};p[0]&32&&(k.data=f[5]),p[1]&2&&(k.$$scope={dirty:p,ctx:f}),o.$set(k);const E={};p[0]&8&&(E.map=f[3]),i.$set(E)},i(f){if(!a){for(let p=0;p<u.length;p+=1)w(g[p]);w(r.$$.fragment,f),w(o.$$.fragment,f),w(i.$$.fragment,f),a=!0}},o(f){g=g.filter(Boolean);for(let p=0;p<g.length;p+=1)C(g[p]);C(r.$$.fragment,f),C(o.$$.fragment,f),C(i.$$.fragment,f),a=!1},d(f){f&&(L(e),L(n),L(l)),At(g,f),j(r,f),j(o,f),j(i,f)}}}function Qn(t){let e,r,n,o,l,i,a,u,g,d,f;const p=[qn,Bn],c=[];function k(h,v){return h[0]==null?0:1}n=k(t),o=c[n]=p[n](t);function E(h){t[22](h)}let s={$$slots:{default:[Zn]},$$scope:{ctx:t}};return t[3]!==void 0&&(s.map=t[3]),a=new sr({props:s}),Q.push(()=>ne(a,"map",E)),{c(){e=V("div"),r=V("div"),o.c(),l=N(),i=V("div"),A(a.$$.fragment),this.h()},l(h){e=J(h,"DIV",{style:!0});var v=X(e);r=J(v,"DIV",{style:!0});var M=X(r);o.l(M),M.forEach(L),l=D(v),i=J(v,"DIV",{style:!0});var B=X(i);F(a.$$.fragment,B),B.forEach(L),v.forEach(L),this.h()},h(){U(r,"width","30%"),U(r,"overflow-y","scroll"),U(r,"padding","10px"),U(i,"position","relative"),U(i,"width","100%"),U(e,"display","flex"),U(e,"height","80vh")},m(h,v){T(h,e,v),ye(e,r),c[n].m(r,null),ye(e,l),ye(e,i),S(a,i,null),g=!0,d||(f=Se(jn,"keydown",t[11]),d=!0)},p(h,v){let M=n;n=k(h),n===M?c[n].p(h,v):(Ie(),C(c[M],1,1,()=>{c[M]=null}),Ae(),o=c[n],o?o.p(h,v):(o=c[n]=p[n](h),o.c()),w(o,1),o.m(r,null));const B={};v[0]&44|v[1]&2&&(B.$$scope={dirty:v,ctx:h}),!u&&v[0]&8&&(u=!0,B.map=h[3],re(()=>u=!1)),a.$set(B)},i(h){g||(w(o),w(a.$$.fragment,h),g=!0)},o(h){C(o),C(a.$$.fragment,h),g=!1},d(h){h&&L(e),c[n].d(),j(a),d=!1,f()}}}function Xn(t,e,r){let n,o;ge(t,te,b=>r(2,o=b));let l,i=null,a=null,u=!1;function g(b,z,me){let P={type:"FeatureCollection",features:[]},oe=z??me;return oe!=null&&P.features.push(k(b.jat.movements[oe],oe)),P}function d(b){r(0,i=b),r(1,a=null)}function f(b){if(!u){for(let z of l.queryRenderedFeatures(b.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(i!=null){r(0,i=null);return}It(te,o.jat.movements=[...o.jat.movements,{point1:b.lngLat.toArray(),point2:ln(b.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",color:"green",name:"",notes:""}],o),r(0,i=o.jat.movements.length-1),r(1,a=null)}}function p(b){d(b.detail.features[0].id)}Tt(()=>{l.on("click",f),h(!1)}),Ot(()=>{l.off("click",f)});function c(b){return{type:"FeatureCollection",features:b.flatMap((z,me)=>[k(z,me),E(z,b.length+me)])}}function k(b,z){return{type:"Feature",id:z,properties:{name:b.name,kind:b.kind,color:_e[b.color].background},geometry:{type:"LineString",coordinates:[b.point1,b.point2]}}}function E(b,z){return{type:"Feature",id:z,properties:{kind:b.kind,color:_e[b.color].background,angle:In(b.point1,b.point2)},geometry:{type:"Point",coordinates:b.point2}}}function s(){window.confirm("Delete this movement?")&&(o.jat.movements.splice(i,1),te.set(o),r(0,i=null))}function h(b){o.jat.movements.length>0&&l.fitBounds(hr(c(o.jat.movements)),{padding:20,animate:b})}function v(b){i!=null&&b.key=="Escape"?(b.stopPropagation(),r(0,i=null)):i!=null&&b.key=="Delete"&&s()}const M=()=>h(!0);function B(b){u=b,r(4,u)}const Y=b=>d(b),x=b=>r(1,a=b),G=()=>r(1,a=null),K=()=>r(0,i=null);function q(b,z){t.$$.not_equal(z.point1,b)&&(z.point1=b,te.set(o))}const $=b=>d(b);function y(b,z){t.$$.not_equal(z.point2,b)&&(z.point2=b,te.set(o))}const _=b=>d(b);function ce(b){l=b,r(3,l)}return t.$$.update=()=>{t.$$.dirty[0]&7&&r(5,n=g(o,i,a))},[i,a,o,l,u,n,d,p,c,s,h,v,M,B,Y,x,G,K,q,$,y,_,ce]}class co extends Le{constructor(e){super(),Ce(this,e,Xn,Qn,we,{},null,[-1,-1])}}export{co as component};
