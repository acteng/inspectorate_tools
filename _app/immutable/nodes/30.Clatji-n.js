import{s as be,v as Z,x as ee,l as Ge,u as ze,m as Ne,o as De,H as K,E as mt,i as T,f as C,a9 as er,a8 as tr,k as he,U as Tt,a7 as Ot,N as It,e as Q,c as Y,b as re,r as pe,a as H,g as R,w as X,h as de,z as Se,p as rr,q as jt,t as ve,d as we,j as xe,B as nr,n as or}from"../chunks/scheduler.Bsni_e59.js";import{S as ke,i as Ee,e as te,c as j,a as A,m as S,t as E,b as L,d as F,g as Te,f as Oe}from"../chunks/index.CCfAUppz.js";import{L as At,g as St,e as ir,m as ge,i as lr,f as Ft,M as ar,a as sr,G as ht,h as gt}from"../chunks/MapLibreMap.Cuf09bxL.js";import{e as Be}from"../chunks/each.BmgwAlbi.js";import{c as Ae}from"../chunks/colors.CYEpEtTL.js";import{D as ur}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as fr,S as cr}from"../chunks/WarningButton.D9QeV9gM.js";import{a as mr,B as hr,G as gr,S as pr,c as dr,M as pt}from"../chunks/GeoreferenceLayer.B0TUMqgx.js";import{s as x}from"../chunks/data.D_GmLpD5.js";import{p as yr}from"../chunks/index.C8Pez0sc.js";import{S as dt}from"../chunks/Select.bLRJACqI.js";import{T as _r}from"../chunks/TextArea.DbePhW6L.js";import{T as br}from"../chunks/TextInput.CHbK327s.js";function vr(t){let e;const r=t[15].default,n=Ge(r,t,t[23],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&8388608)&&ze(n,r,o,o[23],e?De(r,o[23],l,null):Ne(o[23]),null)},i(o){e||(E(n,o),e=!0)},o(o){L(n,o),e=!1},d(o){n&&n.d(o)}}}function wr(t){let e,r,n;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[vr]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new At({props:l}),Z.push(()=>te(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){j(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){S(e,i,a),n=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],ee(()=>r=!1)),e.$set(s)},i(i){n||(E(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function kr(t,e,r){let{$$slots:n={},$$scope:o}=e,{id:l=St("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:h=void 0}=e,{paint:b}=e,{layout:u=void 0}=e,{filter:p=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:M=void 0}=e,{hoverCursor:d=void 0}=e,{manageHoverState:f=!1}=e,{hovered:g=null}=e,{eventsIfTopMost:k=!1}=e,{interactive:P=!0}=e;function q(v){g=v,r(0,g)}function y(v){K.call(this,t,v)}function z(v){K.call(this,t,v)}function N(v){K.call(this,t,v)}function W(v){K.call(this,t,v)}function B(v){K.call(this,t,v)}function J(v){K.call(this,t,v)}return t.$$set=v=>{"id"in v&&r(1,l=v.id),"source"in v&&r(2,i=v.source),"sourceLayer"in v&&r(3,a=v.sourceLayer),"beforeId"in v&&r(4,s=v.beforeId),"beforeLayerType"in v&&r(5,h=v.beforeLayerType),"paint"in v&&r(6,b=v.paint),"layout"in v&&r(7,u=v.layout),"filter"in v&&r(8,p=v.filter),"minzoom"in v&&r(9,_=v.minzoom),"maxzoom"in v&&r(10,M=v.maxzoom),"hoverCursor"in v&&r(11,d=v.hoverCursor),"manageHoverState"in v&&r(12,f=v.manageHoverState),"hovered"in v&&r(0,g=v.hovered),"eventsIfTopMost"in v&&r(13,k=v.eventsIfTopMost),"interactive"in v&&r(14,P=v.interactive),"$$scope"in v&&r(23,o=v.$$scope)},[g,l,i,a,s,h,b,u,p,_,M,d,f,k,P,n,q,y,z,N,W,B,J,o]}class Ze extends ke{constructor(e){super(),Ee(this,e,kr,wr,be,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Er=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),yt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function _t(t){let e,r,n=(t[4]||t[3]instanceof ge.Marker)&&bt(t);return{c(){e=Q("div"),n&&n.c()},l(o){e=Y(o,"DIV",{});var l=re(e);n&&n.l(l),l.forEach(C)},m(o,l){T(o,e,l),n&&n.m(e,null),t[32](e),r=!0},p(o,l){o[4]||o[3]instanceof ge.Marker?n?(n.p(o,l),l[0]&24&&E(n,1)):(n=bt(o),n.c(),E(n,1),n.m(e,null)):n&&(Te(),L(n,1,1,()=>{n=null}),Oe())},i(o){r||(E(n),r=!0)},o(o){L(n),r=!1},d(o){o&&C(e),n&&n.d(),t[32](null)}}}function bt(t){let e;const r=t[30].default,n=Ge(r,t,t[29],yt);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l[0]&536870933)&&ze(n,r,o,o[29],e?De(r,o[29],l,Er):Ne(o[29]),yt)},i(o){e||(E(n,o),e=!0)},o(o){L(n,o),e=!1},d(o){n&&n.d(o)}}}function Cr(t){let e,r,n=t[9].default&&_t(t);return{c(){n&&n.c(),e=mt()},l(o){n&&n.l(o),e=mt()},m(o,l){n&&n.m(o,l),T(o,e,l),r=!0},p(o,l){o[9].default?n?(n.p(o,l),l[0]&512&&E(n,1)):(n=_t(o),n.c(),E(n,1),n.m(e.parentNode,e)):n&&(Te(),L(n,1,1,()=>{n=null}),Oe())},i(o){r||(E(n),r=!0)},o(o){L(n),r=!1},d(o){o&&C(e),n&&n.d(o)}}}function Lr(t,e,r){let n,o,l,i,a,s,{$$slots:h={},$$scope:b}=e;const u=er(h);let{closeButton:p=void 0}=e,{closeOnClickOutside:_=!0}=e,{closeOnClickInside:M=!1}=e,{closeOnMove:d=!1}=e,{openOn:f="click"}=e,{openIfTopMost:g=!0}=e,{focusAfterOpen:k=!0}=e,{anchor:P=void 0}=e,{offset:q=void 0}=e,{popupClass:y=void 0}=e,{maxWidth:z=void 0}=e,{lngLat:N=void 0}=e,{html:W=void 0}=e,{open:B=!1}=e;const J=tr(),{map:v,popupTarget:w,layerEvent:fe,layer:Ie,eventTopMost:Ve}=ir();he(t,v,m=>r(2,l=m)),he(t,w,m=>r(3,a=m)),he(t,fe,m=>r(28,i=m)),he(t,Ie,m=>r(35,s=m));const Je=["click","dblclick","contextmenu"];let c,G=!1,D;function oe(){if(!c)return;let m=c.getElement();!m||m===D||(D=m,f==="hover"&&(D.style.pointerEvents="none"),D.addEventListener("mouseenter",()=>{r(24,G=!0)},{passive:!0}),D.addEventListener("mouseleave",()=>{r(24,G=!1)},{passive:!0}),D.addEventListener("click",()=>{M&&r(0,B=!1)},{passive:!0}))}Tt(()=>{if(l)return l.on("click",je),l.on("contextmenu",je),typeof a=="string"&&(l.on("click",a,ue),l.on("dblclick",a,ue),l.on("contextmenu",a,ue),l.on("mousemove",a,ct),l.on("mouseleave",a,ft),l.on("touchstart",a,st),l.on("touchend",a,ut)),()=>{l!=null&&l.loaded()&&(c==null||c.remove(),l.off("click",je),l.off("contextmenu",je),a instanceof ge.Marker?a.getPopup()===c&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,ue),l.off("dblclick",a,ue),l.off("contextmenu",a,ue),l.off("mousemove",a,ct),l.off("mouseleave",a,ft),l.off("touchstart",a,st),l.off("touchend",a,ut)))}});function ce(m){return g?!("marker"in m)&&!lr(m)&&Ve(m)!==s:!1}let $=null,ne="normal";function ue(m){m.type===f&&(ce(m)||("layerType"in m?m.layerType==="deckgl"?(r(10,N=m.coordinate),r(4,$=m.object?[m.object]:null)):(r(10,N=m.lngLat),r(4,$=m.features??[])):(r(10,N=m.lngLat),r(4,$=m.features??[])),setTimeout(()=>r(0,B=!0))))}let me=null;function st(m){me=m.point}function ut(m){if(!me||f!=="hover")return;let Xe=me.dist(m.point);me=null,Xe<3&&(r(10,N=m.lngLat),r(4,$=m.features??[]),c.isOpen()?r(25,ne="justOpened"):(r(25,ne="opening"),r(0,B=!0)))}function ft(m){f!=="hover"||me||ne!=="normal"||(r(0,B=!1),r(4,$=null))}function ct(m){if(!(f!=="hover"||me||ne!=="normal")){if(ce(m)){r(0,B=!1),r(4,$=null);return}r(0,B=!0),r(4,$=m.features??[]),r(10,N=m.lngLat)}}function je(m){if(ne==="justOpened"){r(25,ne="normal");return}if(!_)return;let Xe=[D,a instanceof ge.Marker?a==null?void 0:a.getElement():null];B&&c.isOpen()&&!Xe.some(Ke=>Ke==null?void 0:Ke.contains(m.originalEvent.target))&&(m.type==="contextmenu"&&f==="contextmenu"||m.type!=="contextmenu")&&r(0,B=!1)}Ot(()=>{l&&(c!=null&&c.isOpen())&&c.remove()});let Ce;const $t=()=>r(0,B=!1);function xt(m){Z[m?"unshift":"push"](()=>{Ce=m,r(1,Ce)})}return t.$$set=m=>{"closeButton"in m&&r(11,p=m.closeButton),"closeOnClickOutside"in m&&r(12,_=m.closeOnClickOutside),"closeOnClickInside"in m&&r(13,M=m.closeOnClickInside),"closeOnMove"in m&&r(14,d=m.closeOnMove),"openOn"in m&&r(15,f=m.openOn),"openIfTopMost"in m&&r(16,g=m.openIfTopMost),"focusAfterOpen"in m&&r(17,k=m.focusAfterOpen),"anchor"in m&&r(18,P=m.anchor),"offset"in m&&r(19,q=m.offset),"popupClass"in m&&r(20,y=m.popupClass),"maxWidth"in m&&r(21,z=m.maxWidth),"lngLat"in m&&r(10,N=m.lngLat),"html"in m&&r(22,W=m.html),"open"in m&&r(0,B=m.open),"$$scope"in m&&r(29,b=m.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&r(27,n=p??(!_&&!M)),t.$$.dirty[0]&146685952&&(c||(r(23,c=new ge.Popup({closeButton:n,closeOnClick:!1,closeOnMove:d,focusAfterOpen:k,maxWidth:z,className:y,anchor:P,offset:q})),D=c.getElement(),c.on("open",()=>{r(0,B=!0),oe(),J("open",c)}),c.on("close",()=>{r(0,B=!1),J("close",c)}),c.on("hover",()=>{J("hover",c)}))),t.$$.dirty[0]&8421384&&c&&a instanceof ge.Marker&&(f==="click"?a.setPopup(c):a.getPopup()===c&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Je.includes(f)&&(i==null?void 0:i.type)===f&&(ue(i),It(fe,i=null,i)),t.$$.dirty[0]&268468224&&r(26,o=f==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&f==="hover"&&fe&&(o&&i&&(i.layerType==="deckgl"?(r(10,N=i.coordinate),r(4,$=i.object?[i.object]:null)):(r(10,N=i.lngLat),r(4,$=i.features??[]))),r(0,B=(o||G)??!1)),t.$$.dirty[0]&12582914&&(Ce?c.setDOMContent(Ce):W&&c.setHTML(W)),t.$$.dirty[0]&8389632&&N&&c.setLngLat(N),t.$$.dirty[0]&41943045&&l){let m=c.isOpen();B&&!m?(c.addTo(l),ne==="opening"&&r(25,ne="justOpened")):!B&&m&&c.remove()}},[B,Ce,l,a,$,v,w,fe,Ie,u,N,p,_,M,d,f,g,k,P,q,y,z,W,c,G,ne,o,n,i,b,h,$t,xt]}class Mr extends ke{constructor(e){super(),Ee(this,e,Lr,Cr,be,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Pr(t){let e;const r=t[16].default,n=Ge(r,t,t[24],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,l){n&&n.m(o,l),e=!0},p(o,l){n&&n.p&&(!e||l&16777216)&&ze(n,r,o,o[24],e?De(r,o[24],l,null):Ne(o[24]),null)},i(o){e||(E(n,o),e=!0)},o(o){L(n,o),e=!1},d(o){n&&n.d(o)}}}function Tr(t){let e,r,n;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Pr]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new At({props:l}),Z.push(()=>te(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){j(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){S(e,i,a),n=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!r&&a&1&&(r=!0,s.hovered=i[0],ee(()=>r=!1)),e.$set(s)},i(i){n||(E(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Or(t,e,r){let{$$slots:n={},$$scope:o}=e,{id:l=St("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:h=void 0}=e,{paint:b=void 0}=e,{layout:u=void 0}=e,{filter:p=void 0}=e,{applyToClusters:_=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:d=void 0}=e,{hoverCursor:f=void 0}=e,{manageHoverState:g=!1}=e,{hovered:k=null}=e,{eventsIfTopMost:P=!1}=e,{interactive:q=!0}=e;function y(w){k=w,r(0,k)}function z(w){K.call(this,t,w)}function N(w){K.call(this,t,w)}function W(w){K.call(this,t,w)}function B(w){K.call(this,t,w)}function J(w){K.call(this,t,w)}function v(w){K.call(this,t,w)}return t.$$set=w=>{"id"in w&&r(1,l=w.id),"source"in w&&r(2,i=w.source),"sourceLayer"in w&&r(3,a=w.sourceLayer),"beforeId"in w&&r(4,s=w.beforeId),"beforeLayerType"in w&&r(5,h=w.beforeLayerType),"paint"in w&&r(6,b=w.paint),"layout"in w&&r(7,u=w.layout),"filter"in w&&r(8,p=w.filter),"applyToClusters"in w&&r(9,_=w.applyToClusters),"minzoom"in w&&r(10,M=w.minzoom),"maxzoom"in w&&r(11,d=w.maxzoom),"hoverCursor"in w&&r(12,f=w.hoverCursor),"manageHoverState"in w&&r(13,g=w.manageHoverState),"hovered"in w&&r(0,k=w.hovered),"eventsIfTopMost"in w&&r(14,P=w.eventsIfTopMost),"interactive"in w&&r(15,q=w.interactive),"$$scope"in w&&r(24,o=w.$$scope)},[k,l,i,a,s,h,b,u,p,_,M,d,f,g,P,q,n,y,z,N,W,B,J,v,o]}class Ir extends ke{constructor(e){super(),Ee(this,e,Or,Tr,be,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const jr=t=>({props:t&8}),vt=t=>({props:Fr(t[3])});function Ar(t){let e,r;const n=t[1].default,o=Ge(n,t,t[2],vt);return{c(){e=Q("div"),o&&o.c(),this.h()},l(l){e=Y(l,"DIV",{class:!0});var i=re(e);o&&o.l(i),i.forEach(C),this.h()},h(){pe(e,"class","govuk-prose")},m(l,i){T(l,e,i),o&&o.m(e,null),r=!0},p(l,i){o&&o.p&&(!r||i&12)&&ze(o,n,l,l[2],r?De(n,l[2],i,jr):Ne(l[2]),vt)},i(l){r||(E(o,l),r=!0)},o(l){L(o,l),r=!1},d(l){l&&C(e),o&&o.d(l)}}}function Sr(t){let e,r;return e=new Mr({props:{openOn:t[0],$$slots:{default:[Ar,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:t}}}),{c(){j(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,[o]){const l={};o&1&&(l.openOn=n[0]),o&12&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){r||(E(e.$$.fragment,n),r=!0)},o(n){L(e.$$.fragment,n),r=!1},d(n){F(e,n)}}}function Fr(t){return t?t[0].properties??{}:{}}function Br(t,e,r){let{$$slots:n={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&r(0,l=i.openOn),"$$scope"in i&&r(2,o=i.$$scope)},[l,n,o]}class Bt extends ke{constructor(e){super(),Ee(this,e,Br,Sr,be,{openOn:0})}}var qr=Object.defineProperty,O=(t,e)=>qr(t,"name",{value:e,configurable:!0}),Gr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Le(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Qe(e),o=Qe(r);return n.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Le(e,r))return!1;const l=e;let i=r;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[n],i[n]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[n],i[i.length-(1+n)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],r[0])){o=l;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,r){return Le(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?Ft(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Le(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};O(Gr,"GeojsonEquality");function Le(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}O(Le,"sameLength");function Qe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}O(Qe,"explode");var U=63710088e-1,qt={centimeters:U*100,centimetres:U*100,degrees:360/(2*Math.PI),feet:U*3.28084,inches:U*39.37,kilometers:U/1e3,kilometres:U/1e3,meters:U,metres:U,miles:U/1609.344,millimeters:U*1e3,millimetres:U*1e3,nauticalmiles:U/1852,radians:1,yards:U*1.0936},wt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ie(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}O(ie,"feature");function zr(t,e,r={}){switch(t){case"Point":return He(e).geometry;case"LineString":return tt(e).geometry;case"Polygon":return et(e).geometry;case"MultiPoint":return zt(e).geometry;case"MultiLineString":return Gt(e).geometry;case"MultiPolygon":return Nt(e).geometry;default:throw new Error(t+" is invalid")}}O(zr,"geometry");function He(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ye(t[0])||!ye(t[1]))throw new Error("coordinates must contain numbers");return ie({type:"Point",coordinates:t},e,r)}O(He,"point");function Nr(t,e,r={}){return Re(t.map(n=>He(n,e)),r)}O(Nr,"points");function et(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ie({type:"Polygon",coordinates:t},e,r)}O(et,"polygon");function Dr(t,e,r={}){return Re(t.map(n=>et(n,e)),r)}O(Dr,"polygons");function tt(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ie({type:"LineString",coordinates:t},e,r)}O(tt,"lineString");function Hr(t,e,r={}){return Re(t.map(n=>tt(n,e)),r)}O(Hr,"lineStrings");function Re(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}O(Re,"featureCollection");function Gt(t,e,r={}){return ie({type:"MultiLineString",coordinates:t},e,r)}O(Gt,"multiLineString");function zt(t,e,r={}){return ie({type:"MultiPoint",coordinates:t},e,r)}O(zt,"multiPoint");function Nt(t,e,r={}){return ie({type:"MultiPolygon",coordinates:t},e,r)}O(Nt,"multiPolygon");function Rr(t,e,r={}){return ie({type:"GeometryCollection",geometries:t},e,r)}O(Rr,"geometryCollection");function Wr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}O(Wr,"round");function Dt(t,e="kilometers"){const r=qt[e];if(!r)throw new Error(e+" units is invalid");return t*r}O(Dt,"radiansToLength");function We(t,e="kilometers"){const r=qt[e];if(!r)throw new Error(e+" units is invalid");return t/r}O(We,"lengthToRadians");function Ur(t,e){return qe(We(t,e))}O(Ur,"lengthToDegrees");function Vr(t){let e=t%360;return e<0&&(e+=360),e}O(Vr,"bearingToAzimuth");function qe(t){return t%(2*Math.PI)*180/Math.PI}O(qe,"radiansToDegrees");function Fe(t){return t%360*Math.PI/180}O(Fe,"degreesToRadians");function Jr(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Dt(We(t,e),r)}O(Jr,"convertLength");function Xr(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=wt[e];if(!n)throw new Error("invalid original units");const o=wt[r];if(!o)throw new Error("invalid final units");return t/n*o}O(Xr,"convertArea");function ye(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}O(ye,"isNumber");function Kr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}O(Kr,"isObject");function Zr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ye(e))throw new Error("bbox must only contain numbers")})}O(Zr,"validateBBox");function Qr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}O(Qr,"validateId");var Yr=Object.defineProperty,le=(t,e)=>Yr(t,"name",{value:e,configurable:!0});function Ht(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}le(Ht,"getCoord");function $r(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}le($r,"getCoords");function Rt(t){if(t.length>1&&ye(t[0])&&ye(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Rt(t[0]);throw new Error("coordinates must only contain numbers")}le(Rt,"containsNumber");function xr(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}le(xr,"geojsonType");function en(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}le(en,"featureOf");function tn(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}le(tn,"collectionOf");function rn(t){return t.type==="Feature"?t.geometry:t}le(rn,"getGeom");function nn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}le(nn,"getType");var on=Object.defineProperty,ln=(t,e)=>on(t,"name",{value:e,configurable:!0});function Wt(t,e,r,n={}){const o=Ht(t),l=Fe(o[0]),i=Fe(o[1]),a=Fe(r),s=We(e,n.units),h=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),b=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(h)),u=qe(b),p=qe(h);return He([u,p],n.properties)}ln(Wt,"destination");var an=Wt,sn=Object.defineProperty,I=(t,e)=>sn(t,"name",{value:e,configurable:!0}),un=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Me(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Ye(e),o=Ye(r);return n.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Me(e,r))return!1;const l=e;let i=r;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[n],i[n]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[n],i[i.length-(1+n)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,r){let n,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],r[0])){o=l;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,r){return Me(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?Ft(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Me(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};I(un,"GeojsonEquality");function Me(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}I(Me,"sameLength");function Ye(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}I(Ye,"explode");var V=63710088e-1,Ut={centimeters:V*100,centimetres:V*100,degrees:360/(2*Math.PI),feet:V*3.28084,inches:V*39.37,kilometers:V/1e3,kilometres:V/1e3,meters:V,metres:V,miles:V/1609.344,millimeters:V*1e3,millimetres:V*1e3,nauticalmiles:V/1852,radians:1,yards:V*1.0936},kt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ae(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}I(ae,"feature");function fn(t,e,r={}){switch(t){case"Point":return rt(e).geometry;case"LineString":return ot(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return Jt(e).geometry;case"MultiLineString":return Vt(e).geometry;case"MultiPolygon":return Xt(e).geometry;default:throw new Error(t+" is invalid")}}I(fn,"geometry");function rt(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!_e(t[0])||!_e(t[1]))throw new Error("coordinates must contain numbers");return ae({type:"Point",coordinates:t},e,r)}I(rt,"point");function cn(t,e,r={}){return Ue(t.map(n=>rt(n,e)),r)}I(cn,"points");function nt(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ae({type:"Polygon",coordinates:t},e,r)}I(nt,"polygon");function mn(t,e,r={}){return Ue(t.map(n=>nt(n,e)),r)}I(mn,"polygons");function ot(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ae({type:"LineString",coordinates:t},e,r)}I(ot,"lineString");function hn(t,e,r={}){return Ue(t.map(n=>ot(n,e)),r)}I(hn,"lineStrings");function Ue(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}I(Ue,"featureCollection");function Vt(t,e,r={}){return ae({type:"MultiLineString",coordinates:t},e,r)}I(Vt,"multiLineString");function Jt(t,e,r={}){return ae({type:"MultiPoint",coordinates:t},e,r)}I(Jt,"multiPoint");function Xt(t,e,r={}){return ae({type:"MultiPolygon",coordinates:t},e,r)}I(Xt,"multiPolygon");function gn(t,e,r={}){return ae({type:"GeometryCollection",geometries:t},e,r)}I(gn,"geometryCollection");function pn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}I(pn,"round");function Kt(t,e="kilometers"){const r=Ut[e];if(!r)throw new Error(e+" units is invalid");return t*r}I(Kt,"radiansToLength");function it(t,e="kilometers"){const r=Ut[e];if(!r)throw new Error(e+" units is invalid");return t/r}I(it,"lengthToRadians");function dn(t,e){return lt(it(t,e))}I(dn,"lengthToDegrees");function yn(t){let e=t%360;return e<0&&(e+=360),e}I(yn,"bearingToAzimuth");function lt(t){return t%(2*Math.PI)*180/Math.PI}I(lt,"radiansToDegrees");function Pe(t){return t%360*Math.PI/180}I(Pe,"degreesToRadians");function _n(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Kt(it(t,e),r)}I(_n,"convertLength");function bn(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=kt[e];if(!n)throw new Error("invalid original units");const o=kt[r];if(!o)throw new Error("invalid final units");return t/n*o}I(bn,"convertArea");function _e(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}I(_e,"isNumber");function vn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}I(vn,"isObject");function wn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!_e(e))throw new Error("bbox must only contain numbers")})}I(wn,"validateBBox");function kn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}I(kn,"validateId");var En=Object.defineProperty,se=(t,e)=>En(t,"name",{value:e,configurable:!0});function $e(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}se($e,"getCoord");function Cn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}se(Cn,"getCoords");function Zt(t){if(t.length>1&&_e(t[0])&&_e(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Zt(t[0]);throw new Error("coordinates must only contain numbers")}se(Zt,"containsNumber");function Ln(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}se(Ln,"geojsonType");function Mn(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}se(Mn,"featureOf");function Pn(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}se(Pn,"collectionOf");function Tn(t){return t.type==="Feature"?t.geometry:t}se(Tn,"getGeom");function On(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}se(On,"getType");var In=Object.defineProperty,Qt=(t,e)=>In(t,"name",{value:e,configurable:!0});function at(t,e,r={}){if(r.final===!0)return Yt(t,e);const n=$e(t),o=$e(e),l=Pe(n[0]),i=Pe(o[0]),a=Pe(n[1]),s=Pe(o[1]),h=Math.sin(i-l)*Math.cos(s),b=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return lt(Math.atan2(h,b))}Qt(at,"bearing");function Yt(t,e){let r=at(e,t);return r=(r+180)%360,r}Qt(Yt,"calculateFinalBearing");var jn=at;function An(t){let e,r,n,o,l,i,a,s,h,b,u,p;function _(y){t[4](y)}let M={label:"Name"};t[1].jat.movements[t[0]].name!==void 0&&(M.value=t[1].jat.movements[t[0]].name),e=new br({props:M}),Z.push(()=>te(e,"value",_));function d(y){t[5](y)}let f={label:"Movement",choices:t[2]};t[1].jat.movements[t[0]].kind!==void 0&&(f.value=t[1].jat.movements[t[0]].kind),o=new dt({props:f}),Z.push(()=>te(o,"value",d));function g(y){t[6](y)}let k={label:"Score",choices:t[3]};t[1].jat.movements[t[0]].score!==void 0&&(k.value=t[1].jat.movements[t[0]].score),a=new dt({props:k}),Z.push(()=>te(a,"value",g));function P(y){t[7](y)}let q={label:"Comments"};return t[1].jat.movements[t[0]].notes!==void 0&&(q.value=t[1].jat.movements[t[0]].notes),b=new _r({props:q}),Z.push(()=>te(b,"value",P)),{c(){j(e.$$.fragment),n=H(),j(o.$$.fragment),i=H(),j(a.$$.fragment),h=H(),j(b.$$.fragment)},l(y){A(e.$$.fragment,y),n=R(y),A(o.$$.fragment,y),i=R(y),A(a.$$.fragment,y),h=R(y),A(b.$$.fragment,y)},m(y,z){S(e,y,z),T(y,n,z),S(o,y,z),T(y,i,z),S(a,y,z),T(y,h,z),S(b,y,z),p=!0},p(y,[z]){const N={};!r&&z&3&&(r=!0,N.value=y[1].jat.movements[y[0]].name,ee(()=>r=!1)),e.$set(N);const W={};!l&&z&3&&(l=!0,W.value=y[1].jat.movements[y[0]].kind,ee(()=>l=!1)),o.$set(W);const B={};!s&&z&3&&(s=!0,B.value=y[1].jat.movements[y[0]].score,ee(()=>s=!1)),a.$set(B);const J={};!u&&z&3&&(u=!0,J.value=y[1].jat.movements[y[0]].notes,ee(()=>u=!1)),b.$set(J)},i(y){p||(E(e.$$.fragment,y),E(o.$$.fragment,y),E(a.$$.fragment,y),E(b.$$.fragment,y),p=!0)},o(y){L(e.$$.fragment,y),L(o.$$.fragment,y),L(a.$$.fragment,y),L(b.$$.fragment,y),p=!1},d(y){y&&(C(n),C(i),C(h)),F(e,y),F(o,y),F(a,y),F(b,y)}}}function Sn(t,e,r){let n;he(t,x,u=>r(1,n=u));let{idx:o}=e,l=yr(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(u){t.$$.not_equal(n.jat.movements[o].name,u)&&(n.jat.movements[o].name=u,x.set(n))}function s(u){t.$$.not_equal(n.jat.movements[o].kind,u)&&(n.jat.movements[o].kind=u,x.set(n))}function h(u){t.$$.not_equal(n.jat.movements[o].score,u)&&(n.jat.movements[o].score=u,x.set(n))}function b(u){t.$$.not_equal(n.jat.movements[o].notes,u)&&(n.jat.movements[o].notes=u,x.set(n))}return t.$$set=u=>{"idx"in u&&r(0,o=u.idx)},[o,n,l,i,a,s,h,b]}class Fn extends ke{constructor(e){super(),Ee(this,e,Sn,An,be,{idx:0})}}const{window:Bn}=sr;function Et(t,e,r){const n=t.slice();return n[31]=e[r],n[32]=e,n[33]=r,n}function Ct(t,e,r){const n=t.slice();return n[31]=e[r],n[33]=r,n}function qn(t){let e,r,n,o,l,i;return e=new ur({props:{$$slots:{default:[zn]},$$scope:{ctx:t}}}),e.$on("click",t[18]),n=new fr({props:{$$slots:{default:[Nn]},$$scope:{ctx:t}}}),n.$on("click",t[10]),l=new Fn({props:{idx:t[0]}}),{c(){j(e.$$.fragment),r=H(),j(n.$$.fragment),o=H(),j(l.$$.fragment)},l(a){A(e.$$.fragment,a),r=R(a),A(n.$$.fragment,a),o=R(a),A(l.$$.fragment,a)},m(a,s){S(e,a,s),T(a,r,s),S(n,a,s),T(a,o,s),S(l,a,s),i=!0},p(a,s){const h={};s[1]&16&&(h.$$scope={dirty:s,ctx:a}),e.$set(h);const b={};s[1]&16&&(b.$$scope={dirty:s,ctx:a}),n.$set(b);const u={};s[0]&1&&(u.idx=a[0]),l.$set(u)},i(a){i||(E(e.$$.fragment,a),E(n.$$.fragment,a),E(l.$$.fragment,a),i=!0)},o(a){L(e.$$.fragment,a),L(n.$$.fragment,a),L(l.$$.fragment,a),i=!1},d(a){a&&(C(r),C(o)),F(e,a),F(n,a),F(l,a)}}}function Gn(t){let e,r,n,o,l,i,a,s,h="Movements",b,u,p;e=new cr({props:{$$slots:{default:[Dn]},$$scope:{ctx:t}}}),e.$on("click",t[13]),n=new hr({}),l=new gr({});let _=t[3]&&Lt(t),M=Be(t[2].jat.movements),d=[];for(let f=0;f<M.length;f+=1)d[f]=Mt(Ct(t,M,f));return{c(){j(e.$$.fragment),r=H(),j(n.$$.fragment),o=H(),j(l.$$.fragment),i=H(),_&&_.c(),a=H(),s=Q("h3"),s.textContent=h,b=H(),u=Q("ol");for(let f=0;f<d.length;f+=1)d[f].c()},l(f){A(e.$$.fragment,f),r=R(f),A(n.$$.fragment,f),o=R(f),A(l.$$.fragment,f),i=R(f),_&&_.l(f),a=R(f),s=Y(f,"H3",{"data-svelte-h":!0}),rr(s)!=="svelte-1dc52s8"&&(s.textContent=h),b=R(f),u=Y(f,"OL",{});var g=re(u);for(let k=0;k<d.length;k+=1)d[k].l(g);g.forEach(C)},m(f,g){S(e,f,g),T(f,r,g),S(n,f,g),T(f,o,g),S(l,f,g),T(f,i,g),_&&_.m(f,g),T(f,a,g),T(f,s,g),T(f,b,g),T(f,u,g);for(let k=0;k<d.length;k+=1)d[k]&&d[k].m(u,null);p=!0},p(f,g){const k={};if(g[1]&16&&(k.$$scope={dirty:g,ctx:f}),e.$set(k),f[3]?_?(_.p(f,g),g[0]&8&&E(_,1)):(_=Lt(f),_.c(),E(_,1),_.m(a.parentNode,a)):_&&(Te(),L(_,1,1,()=>{_=null}),Oe()),g[0]&134){M=Be(f[2].jat.movements);let P;for(P=0;P<M.length;P+=1){const q=Ct(f,M,P);d[P]?d[P].p(q,g):(d[P]=Mt(q),d[P].c(),d[P].m(u,null))}for(;P<d.length;P+=1)d[P].d(1);d.length=M.length}},i(f){p||(E(e.$$.fragment,f),E(n.$$.fragment,f),E(l.$$.fragment,f),E(_),p=!0)},o(f){L(e.$$.fragment,f),L(n.$$.fragment,f),L(l.$$.fragment,f),L(_),p=!1},d(f){f&&(C(r),C(o),C(i),C(a),C(s),C(b),C(u)),F(e,f),F(n,f),F(l,f),_&&_.d(f),jt(d,f)}}}function zn(t){let e;return{c(){e=ve("Save")},l(r){e=we(r,"Save")},m(r,n){T(r,e,n)},d(r){r&&C(e)}}}function Nn(t){let e;return{c(){e=ve("Delete")},l(r){e=we(r,"Delete")},m(r,n){T(r,e,n)},d(r){r&&C(e)}}}function Dn(t){let e;return{c(){e=ve("Zoom to fit")},l(r){e=we(r,"Zoom to fit")},m(r,n){T(r,e,n)},d(r){r&&C(e)}}}function Lt(t){let e,r,n;function o(i){t[14](i)}let l={map:t[3]};return t[4]!==void 0&&(l.enabled=t[4]),e=new pr({props:l}),Z.push(()=>te(e,"enabled",o)),{c(){j(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){S(e,i,a),n=!0},p(i,a){const s={};a[0]&8&&(s.map=i[3]),!r&&a[0]&16&&(r=!0,s.enabled=i[4],ee(()=>r=!1)),e.$set(s)},i(i){n||(E(e.$$.fragment,i),n=!0)},o(i){L(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function Mt(t){let e,r,n=(t[31].name||"Unnamed movement")+"",o,l,i,a;function s(){return t[15](t[33])}function h(){return t[16](t[33])}return{c(){e=Q("li"),r=Q("a"),o=ve(n),l=H(),this.h()},l(b){e=Y(b,"LI",{});var u=re(e);r=Y(u,"A",{href:!0});var p=re(r);o=we(p,n),p.forEach(C),l=R(u),u.forEach(C),this.h()},h(){pe(r,"href","#")},m(b,u){T(b,e,u),de(e,r),de(r,o),de(e,l),i||(a=[Se(r,"click",s),Se(r,"mouseenter",h),Se(r,"mouseleave",t[17])],i=!0)},p(b,u){t=b,u[0]&4&&n!==(n=(t[31].name||"Unnamed movement")+"")&&xe(o,n)},d(b){b&&C(e),i=!1,nr(a)}}}function Hn(t){let e,r;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0,style:!0}),re(e).forEach(C),this.h()},h(){pe(e,"class","dot svelte-1kvjd2"),pe(e,"style",r=`background-color: ${t[6][t[31].score]}`),X(e,"opacity",t[31].kind=="pedestrian"?"0%":"100%")},m(n,o){T(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${n[6][n[31].score]}`)&&pe(e,"style",r);const l=o[0]&4;(o[0]&4||l)&&X(e,"opacity",n[31].kind=="pedestrian"?"0%":"100%")},d(n){n&&C(e)}}}function Rn(t){let e;return{c(){e=Q("span"),this.h()},l(r){e=Y(r,"SPAN",{class:!0}),re(e).forEach(C),this.h()},h(){pe(e,"class","dot svelte-1kvjd2"),X(e,"background-color",t[6][t[31].score]),X(e,"opacity","0%")},m(r,n){T(r,e,n)},p(r,n){n[0]&4&&X(e,"background-color",r[6][r[31].score])},d(r){r&&C(e)}}}function Pt(t){let e,r,n,o,l,i;function a(d){t[19](d,t[31])}function s(){return t[20](t[33])}function h(){return t[21](t[33])}let b={draggable:!0,$$slots:{default:[Hn]},$$scope:{ctx:t}};t[31].point1!==void 0&&(b.lngLat=t[31].point1),e=new pt({props:b}),Z.push(()=>te(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",h);function u(d){t[22](d,t[31])}function p(){return t[23](t[33])}function _(){return t[24](t[33])}let M={draggable:!0,$$slots:{default:[Rn]},$$scope:{ctx:t}};return t[31].point2!==void 0&&(M.lngLat=t[31].point2),o=new pt({props:M}),Z.push(()=>te(o,"lngLat",u)),o.$on("dragend",p),o.$on("click",_),{c(){j(e.$$.fragment),n=H(),j(o.$$.fragment)},l(d){A(e.$$.fragment,d),n=R(d),A(o.$$.fragment,d)},m(d,f){S(e,d,f),T(d,n,f),S(o,d,f),i=!0},p(d,f){t=d;const g={};f[0]&4|f[1]&16&&(g.$$scope={dirty:f,ctx:t}),!r&&f[0]&4&&(r=!0,g.lngLat=t[31].point1,ee(()=>r=!1)),e.$set(g);const k={};f[0]&4|f[1]&16&&(k.$$scope={dirty:f,ctx:t}),!l&&f[0]&4&&(l=!0,k.lngLat=t[31].point2,ee(()=>l=!1)),o.$set(k)},i(d){i||(E(e.$$.fragment,d),E(o.$$.fragment,d),i=!0)},o(d){L(e.$$.fragment,d),L(o.$$.fragment,d),i=!1},d(d){d&&C(n),F(e,d),F(o,d)}}}function Wn(t){let e=(t[30].name||"Untitled movement")+"",r;return{c(){r=ve(e)},l(n){r=we(n,e)},m(n,o){T(n,r,o)},p(n,o){o[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&xe(r,e)},d(n){n&&C(r)}}}function Un(t){let e,r;return e=new Bt({props:{$$slots:{default:[Wn,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){j(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const l={};o[0]&1073741824|o[1]&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){r||(E(e.$$.fragment,n),r=!0)},o(n){L(e.$$.fragment,n),r=!1},d(n){F(e,n)}}}function Vn(t){let e=(t[30].name||"Untitled movement")+"",r;return{c(){r=ve(e)},l(n){r=we(n,e)},m(n,o){T(n,r,o)},p(n,o){o[0]&1073741824&&e!==(e=(n[30].name||"Untitled movement")+"")&&xe(r,e)},d(n){n&&C(r)}}}function Jn(t){let e,r;return e=new Bt({props:{$$slots:{default:[Vn,({props:n})=>({30:n}),({props:n})=>[n?1073741824:0]]},$$scope:{ctx:t}}}),{c(){j(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const l={};o[0]&1073741824|o[1]&16&&(l.$$scope={dirty:o,ctx:n}),e.$set(l)},i(n){r||(E(e.$$.fragment,n),r=!0)},o(n){L(e.$$.fragment,n),r=!1},d(n){F(e,n)}}}function Xn(t){let e,r,n,o,l,i;return e=new Ze({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":gt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Un]},$$scope:{ctx:t}}}),e.$on("click",t[8]),n=new Ze({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":gt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Jn]},$$scope:{ctx:t}}}),n.$on("click",t[8]),l=new Ir({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){j(e.$$.fragment),r=H(),j(n.$$.fragment),o=H(),j(l.$$.fragment)},l(a){A(e.$$.fragment,a),r=R(a),A(n.$$.fragment,a),o=R(a),A(l.$$.fragment,a)},m(a,s){S(e,a,s),T(a,r,s),S(n,a,s),T(a,o,s),S(l,a,s),i=!0},p(a,s){const h={};s[1]&16&&(h.$$scope={dirty:s,ctx:a}),e.$set(h);const b={};s[1]&16&&(b.$$scope={dirty:s,ctx:a}),n.$set(b)},i(a){i||(E(e.$$.fragment,a),E(n.$$.fragment,a),E(l.$$.fragment,a),i=!0)},o(a){L(e.$$.fragment,a),L(n.$$.fragment,a),L(l.$$.fragment,a),i=!1},d(a){a&&(C(r),C(o)),F(e,a),F(n,a),F(l,a)}}}function Kn(t){let e,r;return e=new Ze({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){j(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p:or,i(n){r||(E(e.$$.fragment,n),r=!0)},o(n){L(e.$$.fragment,n),r=!1},d(n){F(e,n)}}}function Zn(t){let e,r,n,o,l,i,a,s=Be(t[2].jat.movements),h=[];for(let u=0;u<s.length;u+=1)h[u]=Pt(Et(t,s,u));const b=u=>L(h[u],1,1,()=>{h[u]=null});return r=new ht({props:{data:t[9](t[2].jat.movements),$$slots:{default:[Xn]},$$scope:{ctx:t}}}),o=new ht({props:{data:t[5],$$slots:{default:[Kn]},$$scope:{ctx:t}}}),i=new dr({props:{map:t[3]}}),{c(){for(let u=0;u<h.length;u+=1)h[u].c();e=H(),j(r.$$.fragment),n=H(),j(o.$$.fragment),l=H(),j(i.$$.fragment)},l(u){for(let p=0;p<h.length;p+=1)h[p].l(u);e=R(u),A(r.$$.fragment,u),n=R(u),A(o.$$.fragment,u),l=R(u),A(i.$$.fragment,u)},m(u,p){for(let _=0;_<h.length;_+=1)h[_]&&h[_].m(u,p);T(u,e,p),S(r,u,p),T(u,n,p),S(o,u,p),T(u,l,p),S(i,u,p),a=!0},p(u,p){if(p[0]&196){s=Be(u[2].jat.movements);let f;for(f=0;f<s.length;f+=1){const g=Et(u,s,f);h[f]?(h[f].p(g,p),E(h[f],1)):(h[f]=Pt(g),h[f].c(),E(h[f],1),h[f].m(e.parentNode,e))}for(Te(),f=s.length;f<h.length;f+=1)b(f);Oe()}const _={};p[0]&4&&(_.data=u[9](u[2].jat.movements)),p[1]&16&&(_.$$scope={dirty:p,ctx:u}),r.$set(_);const M={};p[0]&32&&(M.data=u[5]),p[1]&16&&(M.$$scope={dirty:p,ctx:u}),o.$set(M);const d={};p[0]&8&&(d.map=u[3]),i.$set(d)},i(u){if(!a){for(let p=0;p<s.length;p+=1)E(h[p]);E(r.$$.fragment,u),E(o.$$.fragment,u),E(i.$$.fragment,u),a=!0}},o(u){h=h.filter(Boolean);for(let p=0;p<h.length;p+=1)L(h[p]);L(r.$$.fragment,u),L(o.$$.fragment,u),L(i.$$.fragment,u),a=!1},d(u){u&&(C(e),C(n),C(l)),jt(h,u),F(r,u),F(o,u),F(i,u)}}}function Qn(t){let e,r,n,o,l,i,a,s,h,b,u;const p=[Gn,qn],_=[];function M(g,k){return g[0]==null?0:1}n=M(t),o=_[n]=p[n](t);function d(g){t[25](g)}let f={$$slots:{default:[Zn]},$$scope:{ctx:t}};return t[3]!==void 0&&(f.map=t[3]),a=new ar({props:f}),Z.push(()=>te(a,"map",d)),{c(){e=Q("div"),r=Q("div"),o.c(),l=H(),i=Q("div"),j(a.$$.fragment),this.h()},l(g){e=Y(g,"DIV",{style:!0});var k=re(e);r=Y(k,"DIV",{style:!0});var P=re(r);o.l(P),P.forEach(C),l=R(k),i=Y(k,"DIV",{style:!0});var q=re(i);A(a.$$.fragment,q),q.forEach(C),k.forEach(C),this.h()},h(){X(r,"width","30%"),X(r,"overflow-y","scroll"),X(r,"padding","10px"),X(i,"position","relative"),X(i,"width","100%"),X(e,"display","flex"),X(e,"height","80vh")},m(g,k){T(g,e,k),de(e,r),_[n].m(r,null),de(e,l),de(e,i),S(a,i,null),h=!0,b||(u=Se(Bn,"keydown",t[12]),b=!0)},p(g,k){let P=n;n=M(g),n===P?_[n].p(g,k):(Te(),L(_[P],1,1,()=>{_[P]=null}),Oe(),o=_[n],o?o.p(g,k):(o=_[n]=p[n](g),o.c()),E(o,1),o.m(r,null));const q={};k[0]&44|k[1]&16&&(q.$$scope={dirty:k,ctx:g}),!s&&k[0]&8&&(s=!0,q.map=g[3],ee(()=>s=!1)),a.$set(q)},i(g){h||(E(o),E(a.$$.fragment,g),h=!0)},o(g){L(o),L(a.$$.fragment,g),h=!1},d(g){g&&C(e),_[n].d(),F(a),b=!1,u()}}}function Yn(t,e,r){let n,o;he(t,x,c=>r(2,o=c));let l,i=null,a=null,s=!1,h={0:Ae.red.background,1:Ae.amber.background,2:Ae.green.background,X:Ae.critical.background};function b(c,G,D){let oe={type:"FeatureCollection",features:[]},ce=G??D;return ce!=null&&oe.features.push(d(c.jat.movements[ce],ce)),oe}function u(c){r(0,i=c),r(1,a=null)}function p(c){if(!s){for(let G of l.queryRenderedFeatures(c.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(i!=null){r(0,i=null);return}It(x,o.jat.movements=[...o.jat.movements,{point1:c.lngLat.toArray(),point2:an(c.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),r(0,i=o.jat.movements.length-1),r(1,a=null)}}function _(c){u(c.detail.features[0].id)}Tt(()=>{l.on("click",p),k(!1)}),Ot(()=>{l.off("click",p)});function M(c){let G={type:"FeatureCollection",features:c.map((D,oe)=>d(D,oe))};for(let D of c)if(G.features.push(f(D,G.features.length)),D.kind=="pedestrian"){let oe={...D,point1:D.point2,point2:D.point1};G.features.push(f(oe,G.features.length))}return G}function d(c,G){return{type:"Feature",id:G,properties:{name:c.name,kind:c.kind,color:h[c.score]},geometry:{type:"LineString",coordinates:[c.point1,c.point2]}}}function f(c,G){return{type:"Feature",id:G,properties:{kind:c.kind,color:h[c.score],angle:jn(c.point1,c.point2)},geometry:{type:"Point",coordinates:c.point2}}}function g(){window.confirm("Delete this movement?")&&(o.jat.movements.splice(i,1),x.set(o),r(0,i=null))}function k(c){o.jat.movements.length>0&&l.fitBounds(mr(M(o.jat.movements)),{padding:20,animate:c})}function P(c){i!=null&&c.key=="Escape"?(c.stopPropagation(),r(0,i=null)):i!=null&&c.key=="Delete"&&g()}const q=()=>k(!0);function y(c){s=c,r(4,s)}const z=c=>u(c),N=c=>r(1,a=c),W=()=>r(1,a=null),B=()=>r(0,i=null);function J(c,G){t.$$.not_equal(G.point1,c)&&(G.point1=c,x.set(o))}const v=c=>u(c),w=c=>u(c);function fe(c,G){t.$$.not_equal(G.point2,c)&&(G.point2=c,x.set(o))}const Ie=c=>u(c),Ve=c=>u(c);function Je(c){l=c,r(3,l)}return t.$$.update=()=>{t.$$.dirty[0]&7&&r(5,n=b(o,i,a))},[i,a,o,l,s,n,h,u,_,M,g,k,P,q,y,z,N,W,B,J,v,w,fe,Ie,Ve,Je]}class ho extends ke{constructor(e){super(),Ee(this,e,Yn,Qn,be,{},null,[-1,-1])}}export{ho as component};
