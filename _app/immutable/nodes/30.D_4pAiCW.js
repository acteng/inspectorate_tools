import{s as Ie,v as Z,e as K,t as x,a as N,c as z,b as J,d as ee,f as $,g as B,r as O,w as le,i as y,h as W,x as Q,k as Se,U as Ne,j as _e,N as $e,z as ce,a7 as Xe,E as Ee,p as ke,q as he,B as Ke,n as xe,R as we,S as Ce}from"../chunks/scheduler.Bsni_e59.js";import{S as Be,i as De,e as X,c as q,a as M,m as T,t as k,g as ue,b as C,f as pe,d as P}from"../chunks/index.CCfAUppz.js";import{s as ve,b as be,g as et,a as tt,B as nt,G as it,R as lt,S as ot,c as st,M as ze}from"../chunks/GeoreferenceLayer.B9TQ_Ppd.js";import{e as fe}from"../chunks/each.BmgwAlbi.js";import{c as rt,p as at}from"../chunks/colors.CYEpEtTL.js";import{p as Je}from"../chunks/index.C0tIRxM4.js";import{S as Ae,W as ft}from"../chunks/WarningButton.D9QeV9gM.js";import{S as ye}from"../chunks/Select.bLRJACqI.js";import{T as Ye}from"../chunks/TextArea.DbePhW6L.js";import{T as Ze}from"../chunks/TextInput.CHbK327s.js";import{s as R}from"../chunks/data.DWB5O-Zk.js";import{Y as Qe}from"../chunks/YesNo.BKZq0SKT.js";import{D as ct}from"../chunks/DefaultButton.DyQsHGbh.js";import{M as ut,G as pt}from"../chunks/MapLibreMap.BQdhKO5Y.js";import{C as _t}from"../chunks/CircleLayer.BelXAozX.js";function je(t){let n,i;return n=new Ae({props:{$$slots:{default:[mt]},$$scope:{ctx:t}}}),n.$on("click",t[4]),{c(){q(n.$$.fragment)},l(e){M(n.$$.fragment,e)},m(e,o){T(n,e,o),i=!0},p(e,o){const p={};o&2050&&(p.$$scope={dirty:o,ctx:e}),n.$set(p)},i(e){i||(k(n.$$.fragment,e),i=!0)},o(e){C(n.$$.fragment,e),i=!1},d(e){P(n,e)}}}function mt(t){let n,i;return{c(){n=x("Use lookup: "),i=x(t[1])},l(e){n=ee(e,"Use lookup: "),i=ee(e,t[1])},m(e,o){y(e,n,o),y(e,i,o)},p(e,o){o&2&&_e(i,e[1])},d(e){e&&($(n),$(i))}}}function gt(t){let n,i,e,o,p,c,_,f,b,m,d,h,s,a,L,w,g,I,D,S,te,H,V,A,Y;function ae(l){t[5](l)}let ne={label:"Critical Issue",emptyOption:!0,choices:t[3]};t[2].criticalIssues[t[0]].criticalIssue!==void 0&&(ne.value=t[2].criticalIssues[t[0]].criticalIssue),m=new ye({props:ne}),Z.push(()=>X(m,"value",ae));function F(l){t[6](l)}let ie={label:"Stage",emptyOption:!0,choices:Je(["Existing","Design"])};t[2].criticalIssues[t[0]].stage!==void 0&&(ie.value=t[2].criticalIssues[t[0]].stage),s=new ye({props:ie}),Z.push(()=>X(s,"value",F));function G(l){t[7](l)}let u={label:"Location Name"};t[2].criticalIssues[t[0]].locationName!==void 0&&(u.value=t[2].criticalIssues[t[0]].locationName),w=new Ze({props:u}),Z.push(()=>X(w,"value",G));let r=t[1]&&t[1]!="Loading"&&t[1]!=t[2].criticalIssues[t[0]].locationName&&je(t);function j(l){t[8](l)}let U={label:"Resolved by Design"};t[2].criticalIssues[t[0]].resolved!==void 0&&(U.value=t[2].criticalIssues[t[0]].resolved),S=new Qe({props:U}),Z.push(()=>X(S,"value",j));function E(l){t[9](l)}let oe={label:"Commentary & Feedback"};return t[2].criticalIssues[t[0]].notes!==void 0&&(oe.value=t[2].criticalIssues[t[0]].notes),V=new Ye({props:oe}),Z.push(()=>X(V,"value",E)),{c(){n=K("div"),i=K("a"),e=x("Google StreetView"),p=N(),c=K("a"),_=x("Bing Streetside"),b=N(),q(m.$$.fragment),h=N(),q(s.$$.fragment),L=N(),q(w.$$.fragment),I=N(),r&&r.c(),D=N(),q(S.$$.fragment),H=N(),q(V.$$.fragment),this.h()},l(l){n=z(l,"DIV",{style:!0});var v=J(n);i=z(v,"A",{href:!0,target:!0});var se=J(i);e=ee(se,"Google StreetView"),se.forEach($),p=B(v),c=z(v,"A",{href:!0,target:!0});var re=J(c);_=ee(re,"Bing Streetside"),re.forEach($),v.forEach($),b=B(l),M(m.$$.fragment,l),h=B(l),M(s.$$.fragment,l),L=B(l),M(w.$$.fragment,l),I=B(l),r&&r.l(l),D=B(l),M(S.$$.fragment,l),H=B(l),M(V.$$.fragment,l),this.h()},h(){O(i,"href",o=ve(t[2].criticalIssues[t[0]].point)),O(i,"target","_blank"),O(c,"href",f=be(t[2].criticalIssues[t[0]].point)),O(c,"target","_blank"),le(n,"display","flex"),le(n,"justify-content","space-evenly")},m(l,v){y(l,n,v),W(n,i),W(i,e),W(n,p),W(n,c),W(c,_),y(l,b,v),T(m,l,v),y(l,h,v),T(s,l,v),y(l,L,v),T(w,l,v),y(l,I,v),r&&r.m(l,v),y(l,D,v),T(S,l,v),y(l,H,v),T(V,l,v),Y=!0},p(l,[v]){(!Y||v&5&&o!==(o=ve(l[2].criticalIssues[l[0]].point)))&&O(i,"href",o),(!Y||v&5&&f!==(f=be(l[2].criticalIssues[l[0]].point)))&&O(c,"href",f);const se={};!d&&v&5&&(d=!0,se.value=l[2].criticalIssues[l[0]].criticalIssue,Q(()=>d=!1)),m.$set(se);const re={};!a&&v&5&&(a=!0,re.value=l[2].criticalIssues[l[0]].stage,Q(()=>a=!1)),s.$set(re);const me={};!g&&v&5&&(g=!0,me.value=l[2].criticalIssues[l[0]].locationName,Q(()=>g=!1)),w.$set(me),l[1]&&l[1]!="Loading"&&l[1]!=l[2].criticalIssues[l[0]].locationName?r?(r.p(l,v),v&7&&k(r,1)):(r=je(l),r.c(),k(r,1),r.m(D.parentNode,D)):r&&(ue(),C(r,1,1,()=>{r=null}),pe());const ge={};!te&&v&5&&(te=!0,ge.value=l[2].criticalIssues[l[0]].resolved,Q(()=>te=!1)),S.$set(ge);const de={};!A&&v&5&&(A=!0,de.value=l[2].criticalIssues[l[0]].notes,Q(()=>A=!1)),V.$set(de)},i(l){Y||(k(m.$$.fragment,l),k(s.$$.fragment,l),k(w.$$.fragment,l),k(r),k(S.$$.fragment,l),k(V.$$.fragment,l),Y=!0)},o(l){C(m.$$.fragment,l),C(s.$$.fragment,l),C(w.$$.fragment,l),C(r),C(S.$$.fragment,l),C(V.$$.fragment,l),Y=!1},d(l){l&&($(n),$(b),$(h),$(L),$(I),$(D),$(H)),P(m,l),P(s,l),P(w,l),r&&r.d(l),P(S,l),P(V,l)}}}function dt(t,n,i){let e;Se(t,R,a=>i(2,e=a));let{idx:o}=n,p=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],c="Loading";Ne(async()=>{await _(e.criticalIssues[o].point)});async function _(a){let L=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let g=await(await fetch(L)).json();i(1,c=g.address.road??g.display_name)}catch(w){return console.log(`Location lookup failed: ${w}`),""}}function f(){$e(R,e.criticalIssues[o].locationName=c,e)}function b(a){t.$$.not_equal(e.criticalIssues[o].criticalIssue,a)&&(e.criticalIssues[o].criticalIssue=a,R.set(e))}function m(a){t.$$.not_equal(e.criticalIssues[o].stage,a)&&(e.criticalIssues[o].stage=a,R.set(e))}function d(a){t.$$.not_equal(e.criticalIssues[o].locationName,a)&&(e.criticalIssues[o].locationName=a,R.set(e))}function h(a){t.$$.not_equal(e.criticalIssues[o].resolved,a)&&(e.criticalIssues[o].resolved=a,R.set(e))}function s(a){t.$$.not_equal(e.criticalIssues[o].notes,a)&&(e.criticalIssues[o].notes=a,R.set(e))}return t.$$set=a=>{"idx"in a&&i(0,o=a.idx)},[o,c,e,p,f,b,m,d,h,s]}class $t extends Be{constructor(n){super(),De(this,n,dt,gt,Ie,{idx:0})}}function qe(t){let n,i;return n=new Ae({props:{$$slots:{default:[ht]},$$scope:{ctx:t}}}),n.$on("click",t[4]),{c(){q(n.$$.fragment)},l(e){M(n.$$.fragment,e)},m(e,o){T(n,e,o),i=!0},p(e,o){const p={};o&2050&&(p.$$scope={dirty:o,ctx:e}),n.$set(p)},i(e){i||(k(n.$$.fragment,e),i=!0)},o(e){C(n.$$.fragment,e),i=!1},d(e){P(n,e)}}}function ht(t){let n,i;return{c(){n=x("Use lookup: "),i=x(t[1])},l(e){n=ee(e,"Use lookup: "),i=ee(e,t[1])},m(e,o){y(e,n,o),y(e,i,o)},p(e,o){o&2&&_e(i,e[1])},d(e){e&&($(n),$(i))}}}function vt(t){let n,i,e,o,p,c,_,f,b,m,d,h,s,a,L,w,g,I,D,S,te,H,V,A,Y;function ae(l){t[5](l)}let ne={label:"Policy Conflict",emptyOption:!0,choices:t[3]};t[2].policyConflictLog[t[0]].conflict!==void 0&&(ne.value=t[2].policyConflictLog[t[0]].conflict),m=new ye({props:ne}),Z.push(()=>X(m,"value",ae));function F(l){t[6](l)}let ie={label:"Stage",emptyOption:!0,choices:Je(["Existing","Design"])};t[2].policyConflictLog[t[0]].stage!==void 0&&(ie.value=t[2].policyConflictLog[t[0]].stage),s=new ye({props:ie}),Z.push(()=>X(s,"value",F));function G(l){t[7](l)}let u={label:"Location Name"};t[2].policyConflictLog[t[0]].locationName!==void 0&&(u.value=t[2].policyConflictLog[t[0]].locationName),w=new Ze({props:u}),Z.push(()=>X(w,"value",G));let r=t[1]&&t[1]!="Loading"&&t[1]!=t[2].policyConflictLog[t[0]].locationName&&qe(t);function j(l){t[8](l)}let U={label:"Resolved by Design"};t[2].policyConflictLog[t[0]].resolved!==void 0&&(U.value=t[2].policyConflictLog[t[0]].resolved),S=new Qe({props:U}),Z.push(()=>X(S,"value",j));function E(l){t[9](l)}let oe={label:"Commentary & Feedback"};return t[2].policyConflictLog[t[0]].notes!==void 0&&(oe.value=t[2].policyConflictLog[t[0]].notes),V=new Ye({props:oe}),Z.push(()=>X(V,"value",E)),{c(){n=K("div"),i=K("a"),e=x("Google StreetView"),p=N(),c=K("a"),_=x("Bing Streetside"),b=N(),q(m.$$.fragment),h=N(),q(s.$$.fragment),L=N(),q(w.$$.fragment),I=N(),r&&r.c(),D=N(),q(S.$$.fragment),H=N(),q(V.$$.fragment),this.h()},l(l){n=z(l,"DIV",{style:!0});var v=J(n);i=z(v,"A",{href:!0,target:!0});var se=J(i);e=ee(se,"Google StreetView"),se.forEach($),p=B(v),c=z(v,"A",{href:!0,target:!0});var re=J(c);_=ee(re,"Bing Streetside"),re.forEach($),v.forEach($),b=B(l),M(m.$$.fragment,l),h=B(l),M(s.$$.fragment,l),L=B(l),M(w.$$.fragment,l),I=B(l),r&&r.l(l),D=B(l),M(S.$$.fragment,l),H=B(l),M(V.$$.fragment,l),this.h()},h(){O(i,"href",o=ve(t[2].policyConflictLog[t[0]].point)),O(i,"target","_blank"),O(c,"href",f=be(t[2].policyConflictLog[t[0]].point)),O(c,"target","_blank"),le(n,"display","flex"),le(n,"justify-content","space-evenly")},m(l,v){y(l,n,v),W(n,i),W(i,e),W(n,p),W(n,c),W(c,_),y(l,b,v),T(m,l,v),y(l,h,v),T(s,l,v),y(l,L,v),T(w,l,v),y(l,I,v),r&&r.m(l,v),y(l,D,v),T(S,l,v),y(l,H,v),T(V,l,v),Y=!0},p(l,[v]){(!Y||v&5&&o!==(o=ve(l[2].policyConflictLog[l[0]].point)))&&O(i,"href",o),(!Y||v&5&&f!==(f=be(l[2].policyConflictLog[l[0]].point)))&&O(c,"href",f);const se={};!d&&v&5&&(d=!0,se.value=l[2].policyConflictLog[l[0]].conflict,Q(()=>d=!1)),m.$set(se);const re={};!a&&v&5&&(a=!0,re.value=l[2].policyConflictLog[l[0]].stage,Q(()=>a=!1)),s.$set(re);const me={};!g&&v&5&&(g=!0,me.value=l[2].policyConflictLog[l[0]].locationName,Q(()=>g=!1)),w.$set(me),l[1]&&l[1]!="Loading"&&l[1]!=l[2].policyConflictLog[l[0]].locationName?r?(r.p(l,v),v&7&&k(r,1)):(r=qe(l),r.c(),k(r,1),r.m(D.parentNode,D)):r&&(ue(),C(r,1,1,()=>{r=null}),pe());const ge={};!te&&v&5&&(te=!0,ge.value=l[2].policyConflictLog[l[0]].resolved,Q(()=>te=!1)),S.$set(ge);const de={};!A&&v&5&&(A=!0,de.value=l[2].policyConflictLog[l[0]].notes,Q(()=>A=!1)),V.$set(de)},i(l){Y||(k(m.$$.fragment,l),k(s.$$.fragment,l),k(w.$$.fragment,l),k(r),k(S.$$.fragment,l),k(V.$$.fragment,l),Y=!0)},o(l){C(m.$$.fragment,l),C(s.$$.fragment,l),C(w.$$.fragment,l),C(r),C(S.$$.fragment,l),C(V.$$.fragment,l),Y=!1},d(l){l&&($(n),$(b),$(h),$(L),$(I),$(D),$(H)),P(m,l),P(s,l),P(w,l),r&&r.d(l),P(S,l),P(V,l)}}}function bt(t,n,i){let e;Se(t,R,a=>i(2,e=a));let{idx:o}=n,p=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]],c="Loading";Ne(async()=>{await _(e.policyConflictLog[o].point)});async function _(a){let L=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let g=await(await fetch(L)).json();i(1,c=g.address.road??g.display_name)}catch(w){return console.log(`Location lookup failed: ${w}`),""}}function f(){$e(R,e.policyConflictLog[o].locationName=c,e)}function b(a){t.$$.not_equal(e.policyConflictLog[o].conflict,a)&&(e.policyConflictLog[o].conflict=a,R.set(e))}function m(a){t.$$.not_equal(e.policyConflictLog[o].stage,a)&&(e.policyConflictLog[o].stage=a,R.set(e))}function d(a){t.$$.not_equal(e.policyConflictLog[o].locationName,a)&&(e.policyConflictLog[o].locationName=a,R.set(e))}function h(a){t.$$.not_equal(e.policyConflictLog[o].resolved,a)&&(e.policyConflictLog[o].resolved=a,R.set(e))}function s(a){t.$$.not_equal(e.policyConflictLog[o].notes,a)&&(e.policyConflictLog[o].notes=a,R.set(e))}return t.$$set=a=>{"idx"in a&&i(0,o=a.idx)},[o,c,e,p,f,b,m,d,h,s]}class yt extends Be{constructor(n){super(),De(this,n,bt,vt,Ie,{idx:0})}}const{window:kt}=et;function Me(t,n,i){const e=t.slice();return e[29]=n[i],e[30]=n,e[31]=i,e}function Te(t,n,i){const e=t.slice();return e[32]=n[i],e[33]=n,e[31]=i,e}function Pe(t,n,i){const e=t.slice();return e[29]=n[i],e[31]=i,e}function Ve(t,n,i){const e=t.slice();return e[32]=n[i],e[31]=i,e}function wt(t){let n,i,e,o,p,c,_,f;n=new ct({props:{$$slots:{default:[Lt]},$$scope:{ctx:t}}}),n.$on("click",t[20]),e=new ft({props:{$$slots:{default:[It]},$$scope:{ctx:t}}}),e.$on("click",t[8]);const b=[Nt,St],m=[];function d(h,s){return h[0].kind=="critical"?0:1}return p=d(t),c=m[p]=b[p](t),{c(){q(n.$$.fragment),i=N(),q(e.$$.fragment),o=N(),c.c(),_=Ee()},l(h){M(n.$$.fragment,h),i=B(h),M(e.$$.fragment,h),o=B(h),c.l(h),_=Ee()},m(h,s){T(n,h,s),y(h,i,s),T(e,h,s),y(h,o,s),m[p].m(h,s),y(h,_,s),f=!0},p(h,s){const a={};s[1]&32&&(a.$$scope={dirty:s,ctx:h}),n.$set(a);const L={};s[1]&32&&(L.$$scope={dirty:s,ctx:h}),e.$set(L);let w=p;p=d(h),p===w?m[p].p(h,s):(ue(),C(m[w],1,1,()=>{m[w]=null}),pe(),c=m[p],c?c.p(h,s):(c=m[p]=b[p](h),c.c()),k(c,1),c.m(_.parentNode,_))},i(h){f||(k(n.$$.fragment,h),k(e.$$.fragment,h),k(c),f=!0)},o(h){C(n.$$.fragment,h),C(e.$$.fragment,h),C(c),f=!1},d(h){h&&($(i),$(o),$(_)),P(n,h),P(e,h),m[p].d(h)}}}function Ct(t){let n,i,e,o,p,c,_,f,b,m,d,h="Click the map to add a pin, or select a pin to fill out data",s,a,L="Critical Issues",w,g,I,D,S="Policy Conflicts",te,H,V;n=new Ae({props:{$$slots:{default:[Bt]},$$scope:{ctx:t}}}),n.$on("click",t[11]),e=new nt({}),p=new it({});let A=t[3]&&Fe(t);function Y(u){t[13](u)}let ae={legend:"Create new pins",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};t[4]!==void 0&&(ae.value=t[4]),f=new lt({props:ae}),Z.push(()=>X(f,"value",Y));let ne=fe(t[2].criticalIssues),F=[];for(let u=0;u<ne.length;u+=1)F[u]=Ge(Ve(t,ne,u));let ie=fe(t[2].policyConflictLog),G=[];for(let u=0;u<ie.length;u+=1)G[u]=Oe(Pe(t,ie,u));return{c(){q(n.$$.fragment),i=N(),q(e.$$.fragment),o=N(),q(p.$$.fragment),c=N(),A&&A.c(),_=N(),q(f.$$.fragment),m=N(),d=K("p"),d.textContent=h,s=N(),a=K("h3"),a.textContent=L,w=N(),g=K("ol");for(let u=0;u<F.length;u+=1)F[u].c();I=N(),D=K("h3"),D.textContent=S,te=N(),H=K("ol");for(let u=0;u<G.length;u+=1)G[u].c()},l(u){M(n.$$.fragment,u),i=B(u),M(e.$$.fragment,u),o=B(u),M(p.$$.fragment,u),c=B(u),A&&A.l(u),_=B(u),M(f.$$.fragment,u),m=B(u),d=z(u,"P",{"data-svelte-h":!0}),ke(d)!=="svelte-sv95ee"&&(d.textContent=h),s=B(u),a=z(u,"H3",{"data-svelte-h":!0}),ke(a)!=="svelte-1qhh5xr"&&(a.textContent=L),w=B(u),g=z(u,"OL",{});var r=J(g);for(let U=0;U<F.length;U+=1)F[U].l(r);r.forEach($),I=B(u),D=z(u,"H3",{"data-svelte-h":!0}),ke(D)!=="svelte-eyxzjx"&&(D.textContent=S),te=B(u),H=z(u,"OL",{});var j=J(H);for(let U=0;U<G.length;U+=1)G[U].l(j);j.forEach($)},m(u,r){T(n,u,r),y(u,i,r),T(e,u,r),y(u,o,r),T(p,u,r),y(u,c,r),A&&A.m(u,r),y(u,_,r),T(f,u,r),y(u,m,r),y(u,d,r),y(u,s,r),y(u,a,r),y(u,w,r),y(u,g,r);for(let j=0;j<F.length;j+=1)F[j]&&F[j].m(g,null);y(u,I,r),y(u,D,r),y(u,te,r),y(u,H,r);for(let j=0;j<G.length;j+=1)G[j]&&G[j].m(H,null);V=!0},p(u,r){const j={};r[1]&32&&(j.$$scope={dirty:r,ctx:u}),n.$set(j),u[3]?A?(A.p(u,r),r[0]&8&&k(A,1)):(A=Fe(u),A.c(),k(A,1),A.m(_.parentNode,_)):A&&(ue(),C(A,1,1,()=>{A=null}),pe());const U={};if(!b&&r[0]&16&&(b=!0,U.value=u[4],Q(()=>b=!1)),f.$set(U),r[0]&134){ne=fe(u[2].criticalIssues);let E;for(E=0;E<ne.length;E+=1){const oe=Ve(u,ne,E);F[E]?F[E].p(oe,r):(F[E]=Ge(oe),F[E].c(),F[E].m(g,null))}for(;E<F.length;E+=1)F[E].d(1);F.length=ne.length}if(r[0]&134){ie=fe(u[2].policyConflictLog);let E;for(E=0;E<ie.length;E+=1){const oe=Pe(u,ie,E);G[E]?G[E].p(oe,r):(G[E]=Oe(oe),G[E].c(),G[E].m(H,null))}for(;E<G.length;E+=1)G[E].d(1);G.length=ie.length}},i(u){V||(k(n.$$.fragment,u),k(e.$$.fragment,u),k(p.$$.fragment,u),k(A),k(f.$$.fragment,u),V=!0)},o(u){C(n.$$.fragment,u),C(e.$$.fragment,u),C(p.$$.fragment,u),C(A),C(f.$$.fragment,u),V=!1},d(u){u&&($(i),$(o),$(c),$(_),$(m),$(d),$(s),$(a),$(w),$(g),$(I),$(D),$(te),$(H)),P(n,u),P(e,u),P(p,u),A&&A.d(u),P(f,u),he(F,u),he(G,u)}}}function Lt(t){let n;return{c(){n=x("Save")},l(i){n=ee(i,"Save")},m(i,e){y(i,n,e)},d(i){i&&$(n)}}}function It(t){let n;return{c(){n=x("Delete")},l(i){n=ee(i,"Delete")},m(i,e){y(i,n,e)},d(i){i&&$(n)}}}function St(t){let n,i;return n=new yt({props:{idx:t[0].idx}}),{c(){q(n.$$.fragment)},l(e){M(n.$$.fragment,e)},m(e,o){T(n,e,o),i=!0},p(e,o){const p={};o[0]&1&&(p.idx=e[0].idx),n.$set(p)},i(e){i||(k(n.$$.fragment,e),i=!0)},o(e){C(n.$$.fragment,e),i=!1},d(e){P(n,e)}}}function Nt(t){let n,i;return n=new $t({props:{idx:t[0].idx}}),{c(){q(n.$$.fragment)},l(e){M(n.$$.fragment,e)},m(e,o){T(n,e,o),i=!0},p(e,o){const p={};o[0]&1&&(p.idx=e[0].idx),n.$set(p)},i(e){i||(k(n.$$.fragment,e),i=!0)},o(e){C(n.$$.fragment,e),i=!1},d(e){P(n,e)}}}function Bt(t){let n;return{c(){n=x("Zoom to fit")},l(i){n=ee(i,"Zoom to fit")},m(i,e){y(i,n,e)},d(i){i&&$(n)}}}function Fe(t){let n,i,e;function o(c){t[12](c)}let p={map:t[3]};return t[5]!==void 0&&(p.enabled=t[5]),n=new ot({props:p}),Z.push(()=>X(n,"enabled",o)),{c(){q(n.$$.fragment)},l(c){M(n.$$.fragment,c)},m(c,_){T(n,c,_),e=!0},p(c,_){const f={};_[0]&8&&(f.map=c[3]),!i&&_[0]&32&&(i=!0,f.enabled=c[5],Q(()=>i=!1)),n.$set(f)},i(c){e||(k(n.$$.fragment,c),e=!0)},o(c){C(n.$$.fragment,c),e=!1},d(c){P(n,c)}}}function Ge(t){let n,i,e=Ue(t[32])+"",o,p,c,_;function f(){return t[14](t[31])}function b(){return t[15](t[31])}return{c(){n=K("li"),i=K("a"),o=x(e),p=N(),this.h()},l(m){n=z(m,"LI",{});var d=J(n);i=z(d,"A",{href:!0});var h=J(i);o=ee(h,e),h.forEach($),p=B(d),d.forEach($),this.h()},h(){O(i,"href","#")},m(m,d){y(m,n,d),W(n,i),W(i,o),W(n,p),c||(_=[ce(i,"click",f),ce(i,"mouseenter",b),ce(i,"mouseleave",t[16])],c=!0)},p(m,d){t=m,d[0]&4&&e!==(e=Ue(t[32])+"")&&_e(o,e)},d(m){m&&$(n),c=!1,Ke(_)}}}function Oe(t){let n,i,e=He(t[29])+"",o,p,c,_;function f(){return t[17](t[31])}function b(){return t[18](t[31])}return{c(){n=K("li"),i=K("a"),o=x(e),p=N(),this.h()},l(m){n=z(m,"LI",{});var d=J(n);i=z(d,"A",{href:!0});var h=J(i);o=ee(h,e),h.forEach($),p=B(d),d.forEach($),this.h()},h(){O(i,"href","#")},m(m,d){y(m,n,d),W(n,i),W(i,o),W(n,p),c||(_=[ce(i,"click",f),ce(i,"mouseenter",b),ce(i,"mouseleave",t[19])],c=!0)},p(m,d){t=m,d[0]&4&&e!==(e=He(t[29])+"")&&_e(o,e)},d(m){m&&$(n),c=!1,Ke(_)}}}function Dt(t){let n,i,e,o=t[32].criticalIssue+"",p;return{c(){n=we("svg"),i=we("polygon"),e=we("text"),p=x(o),this.h()},l(c){n=Ce(c,"svg",{width:!0,height:!0,xmlns:!0});var _=J(n);i=Ce(_,"polygon",{points:!0,fill:!0,class:!0}),J(i).forEach($),e=Ce(_,"text",{x:!0,y:!0});var f=J(e);p=ee(f,o),f.forEach($),_.forEach($),this.h()},h(){O(i,"points","20,0 0,40 40,40"),O(i,"fill",rt.critical.background),O(i,"class","svelte-996go8"),O(e,"x","13"),O(e,"y","30"),le(e,"fill","white"),O(n,"width","40"),O(n,"height","40"),O(n,"xmlns","http://www.w3.org/2000/svg")},m(c,_){y(c,n,_),W(n,i),W(n,e),W(e,p)},p(c,_){_[0]&4&&o!==(o=c[32].criticalIssue+"")&&_e(p,o)},d(c){c&&$(n)}}}function We(t){let n,i,e;function o(f){t[21](f,t[32])}function p(){return t[22](t[31])}function c(){return t[23](t[31])}let _={draggable:!0,$$slots:{default:[Dt]},$$scope:{ctx:t}};return t[32].point!==void 0&&(_.lngLat=t[32].point),n=new ze({props:_}),Z.push(()=>X(n,"lngLat",o)),n.$on("click",p),n.$on("dragend",c),{c(){q(n.$$.fragment)},l(f){M(n.$$.fragment,f)},m(f,b){T(n,f,b),e=!0},p(f,b){t=f;const m={};b[0]&4|b[1]&32&&(m.$$scope={dirty:b,ctx:t}),!i&&b[0]&4&&(i=!0,m.lngLat=t[32].point,Q(()=>i=!1)),n.$set(m)},i(f){e||(k(n.$$.fragment,f),e=!0)},o(f){C(n.$$.fragment,f),e=!1},d(f){P(n,f)}}}function At(t){let n,i=t[29].conflict+"",e;return{c(){n=K("span"),e=x(i),this.h()},l(o){n=z(o,"SPAN",{class:!0});var p=J(n);e=ee(p,i),p.forEach($),this.h()},h(){O(n,"class","dot svelte-996go8"),le(n,"background",at)},m(o,p){y(o,n,p),W(n,e)},p(o,p){p[0]&4&&i!==(i=o[29].conflict+"")&&_e(e,i)},d(o){o&&$(n)}}}function Re(t){let n,i,e;function o(f){t[24](f,t[29])}function p(){return t[25](t[31])}function c(){return t[26](t[31])}let _={draggable:!0,$$slots:{default:[At]},$$scope:{ctx:t}};return t[29].point!==void 0&&(_.lngLat=t[29].point),n=new ze({props:_}),Z.push(()=>X(n,"lngLat",o)),n.$on("click",p),n.$on("dragend",c),{c(){q(n.$$.fragment)},l(f){M(n.$$.fragment,f)},m(f,b){T(n,f,b),e=!0},p(f,b){t=f;const m={};b[0]&4|b[1]&32&&(m.$$scope={dirty:b,ctx:t}),!i&&b[0]&4&&(i=!0,m.lngLat=t[29].point,Q(()=>i=!1)),n.$set(m)},i(f){e||(k(n.$$.fragment,f),e=!0)},o(f){C(n.$$.fragment,f),e=!1},d(f){P(n,f)}}}function Et(t){let n,i;return n=new _t({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){q(n.$$.fragment)},l(e){M(n.$$.fragment,e)},m(e,o){T(n,e,o),i=!0},p:xe,i(e){i||(k(n.$$.fragment,e),i=!0)},o(e){C(n.$$.fragment,e),i=!1},d(e){P(n,e)}}}function jt(t){let n,i,e,o,p,c,_=fe(t[2].criticalIssues),f=[];for(let s=0;s<_.length;s+=1)f[s]=We(Te(t,_,s));const b=s=>C(f[s],1,1,()=>{f[s]=null});let m=fe(t[2].policyConflictLog),d=[];for(let s=0;s<m.length;s+=1)d[s]=Re(Me(t,m,s));const h=s=>C(d[s],1,1,()=>{d[s]=null});return e=new pt({props:{data:t[6],$$slots:{default:[Et]},$$scope:{ctx:t}}}),p=new st({props:{map:t[3]}}),{c(){for(let s=0;s<f.length;s+=1)f[s].c();n=N();for(let s=0;s<d.length;s+=1)d[s].c();i=N(),q(e.$$.fragment),o=N(),q(p.$$.fragment)},l(s){for(let a=0;a<f.length;a+=1)f[a].l(s);n=B(s);for(let a=0;a<d.length;a+=1)d[a].l(s);i=B(s),M(e.$$.fragment,s),o=B(s),M(p.$$.fragment,s)},m(s,a){for(let L=0;L<f.length;L+=1)f[L]&&f[L].m(s,a);y(s,n,a);for(let L=0;L<d.length;L+=1)d[L]&&d[L].m(s,a);y(s,i,a),T(e,s,a),y(s,o,a),T(p,s,a),c=!0},p(s,a){if(a[0]&132){_=fe(s[2].criticalIssues);let g;for(g=0;g<_.length;g+=1){const I=Te(s,_,g);f[g]?(f[g].p(I,a),k(f[g],1)):(f[g]=We(I),f[g].c(),k(f[g],1),f[g].m(n.parentNode,n))}for(ue(),g=_.length;g<f.length;g+=1)b(g);pe()}if(a[0]&132){m=fe(s[2].policyConflictLog);let g;for(g=0;g<m.length;g+=1){const I=Me(s,m,g);d[g]?(d[g].p(I,a),k(d[g],1)):(d[g]=Re(I),d[g].c(),k(d[g],1),d[g].m(i.parentNode,i))}for(ue(),g=m.length;g<d.length;g+=1)h(g);pe()}const L={};a[0]&64&&(L.data=s[6]),a[1]&32&&(L.$$scope={dirty:a,ctx:s}),e.$set(L);const w={};a[0]&8&&(w.map=s[3]),p.$set(w)},i(s){if(!c){for(let a=0;a<_.length;a+=1)k(f[a]);for(let a=0;a<m.length;a+=1)k(d[a]);k(e.$$.fragment,s),k(p.$$.fragment,s),c=!0}},o(s){f=f.filter(Boolean);for(let a=0;a<f.length;a+=1)C(f[a]);d=d.filter(Boolean);for(let a=0;a<d.length;a+=1)C(d[a]);C(e.$$.fragment,s),C(p.$$.fragment,s),c=!1},d(s){s&&($(n),$(i),$(o)),he(f,s),he(d,s),P(e,s),P(p,s)}}}function qt(t){let n,i,e,o,p,c,_,f,b,m,d;const h=[Ct,wt],s=[];function a(g,I){return g[0]==null?0:1}e=a(t),o=s[e]=h[e](t);function L(g){t[27](g)}let w={$$slots:{default:[jt]},$$scope:{ctx:t}};return t[3]!==void 0&&(w.map=t[3]),_=new ut({props:w}),Z.push(()=>X(_,"map",L)),{c(){n=K("div"),i=K("div"),o.c(),p=N(),c=K("div"),q(_.$$.fragment),this.h()},l(g){n=z(g,"DIV",{style:!0});var I=J(n);i=z(I,"DIV",{style:!0});var D=J(i);o.l(D),D.forEach($),p=B(I),c=z(I,"DIV",{style:!0});var S=J(c);M(_.$$.fragment,S),S.forEach($),I.forEach($),this.h()},h(){le(i,"width","30%"),le(i,"overflow-y","scroll"),le(i,"padding","10px"),le(c,"position","relative"),le(c,"width","70%"),le(n,"display","flex"),le(n,"height","600px")},m(g,I){y(g,n,I),W(n,i),s[e].m(i,null),W(n,p),W(n,c),T(_,c,null),b=!0,m||(d=ce(kt,"keydown",t[10]),m=!0)},p(g,I){let D=e;e=a(g),e===D?s[e].p(g,I):(ue(),C(s[D],1,1,()=>{s[D]=null}),pe(),o=s[e],o?o.p(g,I):(o=s[e]=h[e](g),o.c()),k(o,1),o.m(i,null));const S={};I[0]&76|I[1]&32&&(S.$$scope={dirty:I,ctx:g}),!f&&I[0]&8&&(f=!0,S.map=g[3],Q(()=>f=!1)),_.$set(S)},i(g){b||(k(o),k(_.$$.fragment,g),b=!0)},o(g){C(o),C(_.$$.fragment,g),b=!1},d(g){g&&$(n),s[e].d(),P(_),m=!1,d()}}}function Mt(t,n,i){let e={type:"FeatureCollection",features:[]},o=n??i;if(o!=null){let p=o.kind=="critical"?t.criticalIssues:t.policyConflictLog;e.features.push(Le(p[o.idx].point))}return e}function Le(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}}function Ue(t){return`${t.criticalIssue||"Unknown critical"}: ${t.locationName||"???"}`}function He(t){return`${t.conflict||"Unknown conflict"}: ${t.locationName||"???"}`}function Tt(t,n,i){let e,o;Se(t,R,r=>i(2,o=r));let p,c="critical",_=null,f=null,b=!1;function m(r){i(0,_=r),i(1,f=null)}function d(r){if(!b){if(_!=null){i(0,_=null);return}c=="critical"?($e(R,o.criticalIssues=[...o.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:r.lngLat.toArray(),locationName:"",resolved:"",notes:""}],o),i(0,_={kind:"critical",idx:o.criticalIssues.length-1})):($e(R,o.policyConflictLog=[...o.policyConflictLog,{id:"TODO",conflict:"",stage:"",point:r.lngLat.toArray(),locationName:"",resolved:"",notes:""}],o),i(0,_={kind:"conflict",idx:o.policyConflictLog.length-1})),i(1,f=null)}}Ne(()=>{p.on("click",d),s()}),Xe(()=>{p.off("click",d)});function h(){window.confirm("Delete this entry?")&&(_.kind=="critical"?(o.criticalIssues.splice(_.idx,1),R.set(o)):(o.policyConflictLog.splice(_.idx,1),R.set(o)),i(0,_=null))}function s(r){let j={type:"FeatureCollection",features:[...o.criticalIssues.map(U=>Le(U.point)),...o.policyConflictLog.map(U=>Le(U.point))]};j.features.length>0&&p.fitBounds(tt(j),{padding:20,animate:!0})}function a(r){_!=null&&r.key=="Escape"&&(r.stopPropagation(),i(0,_=null))}const L=()=>s();function w(r){b=r,i(5,b)}function g(r){c=r,i(4,c)}const I=r=>m({kind:"critical",idx:r}),D=r=>i(1,f={kind:"critical",idx:r}),S=()=>i(1,f=null),te=r=>m({kind:"conflict",idx:r}),H=r=>i(1,f={kind:"conflict",idx:r}),V=()=>i(1,f=null),A=()=>i(0,_=null);function Y(r,j){t.$$.not_equal(j.point,r)&&(j.point=r,R.set(o))}const ae=r=>m({kind:"critical",idx:r}),ne=r=>m({kind:"critical",idx:r});function F(r,j){t.$$.not_equal(j.point,r)&&(j.point=r,R.set(o))}const ie=r=>m({kind:"conflict",idx:r}),G=r=>m({kind:"conflict",idx:r});function u(r){p=r,i(3,p)}return t.$$.update=()=>{t.$$.dirty[0]&7&&i(6,e=Mt(o,_,f))},[_,f,o,p,c,b,e,m,h,s,a,L,w,g,I,D,S,te,H,V,A,Y,ae,ne,F,ie,G,u]}class Xt extends Be{constructor(n){super(),De(this,n,Tt,qt,Ie,{},null,[-1,-1])}}export{Xt as component};
