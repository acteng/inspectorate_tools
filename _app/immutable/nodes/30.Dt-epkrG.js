import{s as pe,v as O,a as L,g as B,i as k,x as R,f as h,k as me,T as $e,t as E,d as T,j as H,M as _e,e as j,c as q,b as G,w as V,h as M,U as ye,r as de,p as Ce,q as ge,n as Le}from"../chunks/scheduler.DPCwhvxW.js";import{S as he,i as ve,e as U,c as D,a as S,m as A,t as b,g as J,b as I,f as K,d as N}from"../chunks/index.D5OyLhbv.js";import{e as z}from"../chunks/each.CNvoU69T.js";import{p as Be}from"../chunks/index.ddY1ibuK.js";import{S as be,W as De}from"../chunks/WarningButton.CTAeB0E0.js";import{S as ie}from"../chunks/Select.B6qliB7L.js";import{T as Se}from"../chunks/TextArea.C3ai9qbf.js";import{T as Ae}from"../chunks/TextInput.DWhRcOPv.js";import{s as W}from"../chunks/data.4jHBVBls.js";import{Y as Ne}from"../chunks/YesNo.CQJ9Hj-4.js";import{D as Me}from"../chunks/DefaultButton.DHC0T5FW.js";import{b as Ee,B as Te,G as Pe,a as We,M as je}from"../chunks/GeoreferenceLayer.COfZjTiZ.js";import{M as qe,G as Fe}from"../chunks/MapLibreMap.BDicqlrM.js";import{C as Ge}from"../chunks/CircleLayer.TJmsCvKs.js";function ae(s){let t,n;return t=new be({props:{$$slots:{default:[Ve]},$$scope:{ctx:s}}}),t.$on("click",s[4]),{c(){D(t.$$.fragment)},l(e){S(t.$$.fragment,e)},m(e,a){A(t,e,a),n=!0},p(e,a){const p={};a&2050&&(p.$$scope={dirty:a,ctx:e}),t.$set(p)},i(e){n||(b(t.$$.fragment,e),n=!0)},o(e){I(t.$$.fragment,e),n=!1},d(e){N(t,e)}}}function Ve(s){let t,n;return{c(){t=E("Use lookup: "),n=E(s[1])},l(e){t=T(e,"Use lookup: "),n=T(e,s[1])},m(e,a){k(e,t,a),k(e,n,a)},p(e,a){a&2&&H(n,e[1])},d(e){e&&(h(t),h(n))}}}function Oe(s){let t,n,e,a,p,r,_,u,l,m,c,f,$,i,v,g;function d(o){s[5](o)}let w={label:"Critical Issue",emptyOption:!0,choices:s[3]};s[2].criticalIssues[s[0]].criticalIssue!==void 0&&(w.value=s[2].criticalIssues[s[0]].criticalIssue),t=new ie({props:w}),O.push(()=>U(t,"value",d));function F(o){s[6](o)}let P={label:"Stage",emptyOption:!0,choices:Be(["Existing","Design"])};s[2].criticalIssues[s[0]].stage!==void 0&&(P.value=s[2].criticalIssues[s[0]].stage),a=new ie({props:P}),O.push(()=>U(a,"value",F));function ke(o){s[7](o)}let Z={label:"Location Name"};s[2].criticalIssues[s[0]].locationName!==void 0&&(Z.value=s[2].criticalIssues[s[0]].locationName),_=new Ae({props:Z}),O.push(()=>U(_,"value",ke));let y=s[1]&&s[1]!="Loading"&&s[1]!=s[2].criticalIssues[s[0]].locationName&&ae(s);function Ie(o){s[8](o)}let Q={label:"Resolved by Design"};s[2].criticalIssues[s[0]].resolved!==void 0&&(Q.value=s[2].criticalIssues[s[0]].resolved),c=new Ne({props:Q}),O.push(()=>U(c,"value",Ie));function we(o){s[9](o)}let X={label:"Commentary & Feedback"};return s[2].criticalIssues[s[0]].notes!==void 0&&(X.value=s[2].criticalIssues[s[0]].notes),i=new Se({props:X}),O.push(()=>U(i,"value",we)),{c(){D(t.$$.fragment),e=L(),D(a.$$.fragment),r=L(),D(_.$$.fragment),l=L(),y&&y.c(),m=L(),D(c.$$.fragment),$=L(),D(i.$$.fragment)},l(o){S(t.$$.fragment,o),e=B(o),S(a.$$.fragment,o),r=B(o),S(_.$$.fragment,o),l=B(o),y&&y.l(o),m=B(o),S(c.$$.fragment,o),$=B(o),S(i.$$.fragment,o)},m(o,C){A(t,o,C),k(o,e,C),A(a,o,C),k(o,r,C),A(_,o,C),k(o,l,C),y&&y.m(o,C),k(o,m,C),A(c,o,C),k(o,$,C),A(i,o,C),g=!0},p(o,[C]){const x={};!n&&C&5&&(n=!0,x.value=o[2].criticalIssues[o[0]].criticalIssue,R(()=>n=!1)),t.$set(x);const ee={};!p&&C&5&&(p=!0,ee.value=o[2].criticalIssues[o[0]].stage,R(()=>p=!1)),a.$set(ee);const te={};!u&&C&5&&(u=!0,te.value=o[2].criticalIssues[o[0]].locationName,R(()=>u=!1)),_.$set(te),o[1]&&o[1]!="Loading"&&o[1]!=o[2].criticalIssues[o[0]].locationName?y?(y.p(o,C),C&7&&b(y,1)):(y=ae(o),y.c(),b(y,1),y.m(m.parentNode,m)):y&&(J(),I(y,1,1,()=>{y=null}),K());const se={};!f&&C&5&&(f=!0,se.value=o[2].criticalIssues[o[0]].resolved,R(()=>f=!1)),c.$set(se);const ne={};!v&&C&5&&(v=!0,ne.value=o[2].criticalIssues[o[0]].notes,R(()=>v=!1)),i.$set(ne)},i(o){g||(b(t.$$.fragment,o),b(a.$$.fragment,o),b(_.$$.fragment,o),b(y),b(c.$$.fragment,o),b(i.$$.fragment,o),g=!0)},o(o){I(t.$$.fragment,o),I(a.$$.fragment,o),I(_.$$.fragment,o),I(y),I(c.$$.fragment,o),I(i.$$.fragment,o),g=!1},d(o){o&&(h(e),h(r),h(l),h(m),h($)),N(t,o),N(a,o),N(_,o),y&&y.d(o),N(c,o),N(i,o)}}}function Re(s,t,n){let e;me(s,W,i=>n(2,e=i));let{idx:a}=t,p=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],r="Loading";$e(async()=>{await _(e.criticalIssues[a].point)});async function _(i){let v=`https://nominatim.openstreetmap.org/reverse?lon=${i[0]}&lat=${i[1]}&format=json`;try{let d=await(await fetch(v)).json();n(1,r=d.address.road??d.display_name)}catch(g){return console.log(`Location lookup failed: ${g}`),""}}function u(){_e(W,e.criticalIssues[a].locationName=r,e)}function l(i){s.$$.not_equal(e.criticalIssues[a].criticalIssue,i)&&(e.criticalIssues[a].criticalIssue=i,W.set(e))}function m(i){s.$$.not_equal(e.criticalIssues[a].stage,i)&&(e.criticalIssues[a].stage=i,W.set(e))}function c(i){s.$$.not_equal(e.criticalIssues[a].locationName,i)&&(e.criticalIssues[a].locationName=i,W.set(e))}function f(i){s.$$.not_equal(e.criticalIssues[a].resolved,i)&&(e.criticalIssues[a].resolved=i,W.set(e))}function $(i){s.$$.not_equal(e.criticalIssues[a].notes,i)&&(e.criticalIssues[a].notes=i,W.set(e))}return s.$$set=i=>{"idx"in i&&n(0,a=i.idx)},[a,r,e,p,u,l,m,c,f,$]}class Ue extends he{constructor(t){super(),ve(this,t,Re,Oe,pe,{idx:0})}}function le(s,t,n){const e=s.slice();return e[13]=t[n],e[14]=t,e[15]=n,e}function re(s,t,n){const e=s.slice();return e[13]=t[n],e}function He(s){let t,n,e,a,p,r,_,u,l,m;return p=new Me({props:{$$slots:{default:[Ke]},$$scope:{ctx:s}}}),p.$on("click",s[7]),_=new De({props:{$$slots:{default:[ze]},$$scope:{ctx:s}}}),_.$on("click",s[4]),l=new Ue({props:{idx:s[1]}}),{c(){t=j("p"),n=E("Editing "),e=E(s[1]),a=L(),D(p.$$.fragment),r=L(),D(_.$$.fragment),u=L(),D(l.$$.fragment)},l(c){t=q(c,"P",{});var f=G(t);n=T(f,"Editing "),e=T(f,s[1]),f.forEach(h),a=B(c),S(p.$$.fragment,c),r=B(c),S(_.$$.fragment,c),u=B(c),S(l.$$.fragment,c)},m(c,f){k(c,t,f),M(t,n),M(t,e),k(c,a,f),A(p,c,f),k(c,r,f),A(_,c,f),k(c,u,f),A(l,c,f),m=!0},p(c,f){(!m||f&2)&&H(e,c[1]);const $={};f&262144&&($.$$scope={dirty:f,ctx:c}),p.$set($);const i={};f&262144&&(i.$$scope={dirty:f,ctx:c}),_.$set(i);const v={};f&2&&(v.idx=c[1]),l.$set(v)},i(c){m||(b(p.$$.fragment,c),b(_.$$.fragment,c),b(l.$$.fragment,c),m=!0)},o(c){I(p.$$.fragment,c),I(_.$$.fragment,c),I(l.$$.fragment,c),m=!1},d(c){c&&(h(t),h(a),h(r),h(u)),N(p,c),N(_,c),N(l,c)}}}function Je(s){let t,n,e,a,p,r,_,u="Click the map to add a pin, or click a pin to fill out data",l,m,c;t=new be({props:{$$slots:{default:[Ye]},$$scope:{ctx:s}}}),t.$on("click",s[6]),e=new Te({}),p=new Pe({});let f=z(s[2].criticalIssues),$=[];for(let i=0;i<f.length;i+=1)$[i]=oe(re(s,f,i));return{c(){D(t.$$.fragment),n=L(),D(e.$$.fragment),a=L(),D(p.$$.fragment),r=L(),_=j("p"),_.textContent=u,l=L(),m=j("ol");for(let i=0;i<$.length;i+=1)$[i].c()},l(i){S(t.$$.fragment,i),n=B(i),S(e.$$.fragment,i),a=B(i),S(p.$$.fragment,i),r=B(i),_=q(i,"P",{"data-svelte-h":!0}),Ce(_)!=="svelte-1rxcdnm"&&(_.textContent=u),l=B(i),m=q(i,"OL",{});var v=G(m);for(let g=0;g<$.length;g+=1)$[g].l(v);v.forEach(h)},m(i,v){A(t,i,v),k(i,n,v),A(e,i,v),k(i,a,v),A(p,i,v),k(i,r,v),k(i,_,v),k(i,l,v),k(i,m,v);for(let g=0;g<$.length;g+=1)$[g]&&$[g].m(m,null);c=!0},p(i,v){const g={};if(v&262144&&(g.$$scope={dirty:v,ctx:i}),t.$set(g),v&4){f=z(i[2].criticalIssues);let d;for(d=0;d<f.length;d+=1){const w=re(i,f,d);$[d]?$[d].p(w,v):($[d]=oe(w),$[d].c(),$[d].m(m,null))}for(;d<$.length;d+=1)$[d].d(1);$.length=f.length}},i(i){c||(b(t.$$.fragment,i),b(e.$$.fragment,i),b(p.$$.fragment,i),c=!0)},o(i){I(t.$$.fragment,i),I(e.$$.fragment,i),I(p.$$.fragment,i),c=!1},d(i){i&&(h(n),h(a),h(r),h(_),h(l),h(m)),N(t,i),N(e,i),N(p,i),ge($,i)}}}function Ke(s){let t;return{c(){t=E("Save")},l(n){t=T(n,"Save")},m(n,e){k(n,t,e)},d(n){n&&h(t)}}}function ze(s){let t;return{c(){t=E("Delete")},l(n){t=T(n,"Delete")},m(n,e){k(n,t,e)},d(n){n&&h(t)}}}function Ye(s){let t;return{c(){t=E("Zoom to fit")},l(n){t=T(n,"Zoom to fit")},m(n,e){k(n,t,e)},d(n){n&&h(t)}}}function oe(s){let t,n,e=s[13].criticalIssue+"",a,p,r=s[13].stage+"",_,u,l=s[13].locationName+"",m,c;return{c(){t=j("li"),n=E("Critical issue: type="),a=E(e),p=E(", stage="),_=E(r),u=E(", at "),m=E(l),c=L()},l(f){t=q(f,"LI",{});var $=G(t);n=T($,"Critical issue: type="),a=T($,e),p=T($,", stage="),_=T($,r),u=T($,", at "),m=T($,l),c=B($),$.forEach(h)},m(f,$){k(f,t,$),M(t,n),M(t,a),M(t,p),M(t,_),M(t,u),M(t,m),M(t,c)},p(f,$){$&4&&e!==(e=f[13].criticalIssue+"")&&H(a,e),$&4&&r!==(r=f[13].stage+"")&&H(_,r),$&4&&l!==(l=f[13].locationName+"")&&H(m,l)},d(f){f&&h(t)}}}function fe(s){let t;return{c(){t=j("div"),this.h()},l(n){t=q(n,"DIV",{class:!0}),G(t).forEach(h),this.h()},h(){de(t,"class","block-map svelte-8x13pw")},m(n,e){k(n,t,e)},d(n){n&&h(t)}}}function Ze(s){let t,n,e=s[13].criticalIssue+"",a;return{c(){t=j("span"),n=E("C"),a=E(e),this.h()},l(p){t=q(p,"SPAN",{class:!0});var r=G(t);n=T(r,"C"),a=T(r,e),r.forEach(h),this.h()},h(){de(t,"class","dot svelte-8x13pw")},m(p,r){k(p,t,r),M(t,n),M(t,a)},p(p,r){r&4&&e!==(e=p[13].criticalIssue+"")&&H(a,e)},d(p){p&&h(t)}}}function ce(s){let t,n,e;function a(u){s[8](u,s[13])}function p(){return s[9](s[15])}function r(){return s[10](s[15])}let _={draggable:!0,$$slots:{default:[Ze]},$$scope:{ctx:s}};return s[13].point!==void 0&&(_.lngLat=s[13].point),t=new je({props:_}),O.push(()=>U(t,"lngLat",a)),t.$on("click",p),t.$on("dragend",r),{c(){D(t.$$.fragment)},l(u){S(t.$$.fragment,u)},m(u,l){A(t,u,l),e=!0},p(u,l){s=u;const m={};l&262148&&(m.$$scope={dirty:l,ctx:s}),!n&&l&4&&(n=!0,m.lngLat=s[13].point,R(()=>n=!1)),t.$set(m)},i(u){e||(b(t.$$.fragment,u),e=!0)},o(u){I(t.$$.fragment,u),e=!1},d(u){N(t,u)}}}function ue(s){let t,n;return t=new Fe({props:{data:Y(s[2].criticalIssues[s[1]].point),$$slots:{default:[Qe]},$$scope:{ctx:s}}}),{c(){D(t.$$.fragment)},l(e){S(t.$$.fragment,e)},m(e,a){A(t,e,a),n=!0},p(e,a){const p={};a&6&&(p.data=Y(e[2].criticalIssues[e[1]].point)),a&262144&&(p.$$scope={dirty:a,ctx:e}),t.$set(p)},i(e){n||(b(t.$$.fragment,e),n=!0)},o(e){I(t.$$.fragment,e),n=!1},d(e){N(t,e)}}}function Qe(s){let t,n;return t=new Ge({props:{paint:{"circle-radius":20,"circle-color":"yellow"}}}),{c(){D(t.$$.fragment)},l(e){S(t.$$.fragment,e)},m(e,a){A(t,e,a),n=!0},p:Le,i(e){n||(b(t.$$.fragment,e),n=!0)},o(e){I(t.$$.fragment,e),n=!1},d(e){N(t,e)}}}function Xe(s){let t,n,e,a,p=z(s[2].criticalIssues),r=[];for(let l=0;l<p.length;l+=1)r[l]=ce(le(s,p,l));const _=l=>I(r[l],1,1,()=>{r[l]=null});let u=s[1]!=null&&ue(s);return e=new We({props:{map:s[0]}}),{c(){for(let l=0;l<r.length;l+=1)r[l].c();t=L(),u&&u.c(),n=L(),D(e.$$.fragment)},l(l){for(let m=0;m<r.length;m+=1)r[m].l(l);t=B(l),u&&u.l(l),n=B(l),S(e.$$.fragment,l)},m(l,m){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(l,m);k(l,t,m),u&&u.m(l,m),k(l,n,m),A(e,l,m),a=!0},p(l,m){if(m&12){p=z(l[2].criticalIssues);let f;for(f=0;f<p.length;f+=1){const $=le(l,p,f);r[f]?(r[f].p($,m),b(r[f],1)):(r[f]=ce($),r[f].c(),b(r[f],1),r[f].m(t.parentNode,t))}for(J(),f=p.length;f<r.length;f+=1)_(f);K()}l[1]!=null?u?(u.p(l,m),m&2&&b(u,1)):(u=ue(l),u.c(),b(u,1),u.m(n.parentNode,n)):u&&(J(),I(u,1,1,()=>{u=null}),K());const c={};m&1&&(c.map=l[0]),e.$set(c)},i(l){if(!a){for(let m=0;m<p.length;m+=1)b(r[m]);b(u),b(e.$$.fragment,l),a=!0}},o(l){r=r.filter(Boolean);for(let m=0;m<r.length;m+=1)I(r[m]);I(u),I(e.$$.fragment,l),a=!1},d(l){l&&(h(t),h(n)),ge(r,l),u&&u.d(l),N(e,l)}}}function xe(s){let t,n,e,a,p,r,_,u,l,m;const c=[Je,He],f=[];function $(d,w){return d[1]==null?0:1}e=$(s),a=f[e]=c[e](s);let i=s[1]!=null&&fe();function v(d){s[11](d)}let g={$$slots:{default:[Xe]},$$scope:{ctx:s}};return s[0]!==void 0&&(g.map=s[0]),u=new qe({props:g}),O.push(()=>U(u,"map",v)),{c(){t=j("div"),n=j("div"),a.c(),p=L(),r=j("div"),i&&i.c(),_=L(),D(u.$$.fragment),this.h()},l(d){t=q(d,"DIV",{style:!0});var w=G(t);n=q(w,"DIV",{style:!0});var F=G(n);a.l(F),F.forEach(h),p=B(w),r=q(w,"DIV",{style:!0});var P=G(r);i&&i.l(P),_=B(P),S(u.$$.fragment,P),P.forEach(h),w.forEach(h),this.h()},h(){V(n,"width","30%"),V(n,"overflow-y","scroll"),V(n,"padding","10px"),V(r,"position","relative"),V(r,"width","70%"),V(t,"display","flex"),V(t,"height","600px")},m(d,w){k(d,t,w),M(t,n),f[e].m(n,null),M(t,p),M(t,r),i&&i.m(r,null),M(r,_),A(u,r,null),m=!0},p(d,[w]){let F=e;e=$(d),e===F?f[e].p(d,w):(J(),I(f[F],1,1,()=>{f[F]=null}),K(),a=f[e],a?a.p(d,w):(a=f[e]=c[e](d),a.c()),b(a,1),a.m(n,null)),d[1]!=null?i||(i=fe(),i.c(),i.m(r,_)):i&&(i.d(1),i=null);const P={};w&262151&&(P.$$scope={dirty:w,ctx:d}),!l&&w&1&&(l=!0,P.map=d[0],R(()=>l=!1)),u.$set(P)},i(d){m||(b(a),b(u.$$.fragment,d),m=!0)},o(d){I(a),I(u.$$.fragment,d),m=!1},d(d){d&&h(t),f[e].d(),i&&i.d(),N(u)}}}function Y(s){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:s}}}function et(s,t,n){let e;me(s,W,g=>n(2,e=g));let a,p=null;function r(g){n(1,p=g)}function _(g){_e(W,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:g.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),n(1,p=e.criticalIssues.length-1)}$e(()=>{a.on("click",_),l()}),ye(()=>{a.off("click",_)});function u(){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(p,1),W.set(e),n(1,p=null))}function l(g){if(e.criticalIssues.length>0){let d={type:"FeatureCollection",features:e.criticalIssues.map(w=>Y(w.point))};a.fitBounds(Ee(d),{padding:20,animate:!0})}}const m=()=>l(),c=()=>n(1,p=null);function f(g,d){s.$$.not_equal(d.point,g)&&(d.point=g,W.set(e))}const $=g=>r(g),i=g=>r(g);function v(g){a=g,n(0,a)}return[a,p,e,r,u,l,m,c,f,$,i,v]}class _t extends he{constructor(t){super(),ve(this,t,et,xe,pe,{})}}export{_t as component};
