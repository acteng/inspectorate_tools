import{s as je,v as Q,w as Y,l as Vt,u as Wt,m as Zt,o as Qt,G as ye,k as Be,U as Yt,T as Te,a as z,g as D,i as k,f as $,q as Pe,n as Oe,e as x,t as K,c as ee,b as ne,d as X,r as Ne,x as Z,h as le,j as me,z as xt,D as ce,p as rt}from"../chunks/scheduler.BBS-fkhU.js";import{S as Ae,i as Me,e as te,c as T,a as q,m as B,t as w,b as v,d as O,g as ae,f as se}from"../chunks/index.B8H3ypVf.js";import{e as ue}from"../chunks/each.D79A5KlB.js";import{B as en}from"../chunks/ButtonGroup.fhy-VJbf.js";import{W as Et,S as fe}from"../chunks/WarningButton.CaqyhU7y.js";import{T as Ve}from"../chunks/TextInput.C_aBwF72.js";import{s as V}from"../chunks/data.ylsfYrtw.js";import{L as tn,d as nn,e as Ct,M as rn,b as on,C as ln,G as ot,f as He,h as it,c as an,P as Lt,g as sn}from"../chunks/index.N7jFJ-KB.js";import{c as Se}from"../chunks/colors.CYEpEtTL.js";import{M as un,a as fn,b as Ie,R as Pt,B as mn,G as cn,C as gn,S as pn}from"../chunks/GeoreferenceLayer.BQRltcNz.js";import{D as dn,C as _n}from"../chunks/DefaultButton.Pbp5mObw.js";import{T as At}from"../chunks/TextArea.Ck6ITb4v.js";import{p as Mt}from"../chunks/index.BaFgF3ph.js";import{S as hn}from"../chunks/Select.DqyoFzIJ.js";function $n(t){let e;const n=t[16].default,r=Vt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Wt(r,n,o,o[24],e?Qt(n,o[24],l,null):Zt(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){v(r,o),e=!1},d(o){r&&r.d(o)}}}function bn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[$n]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new tn({props:l}),Q.push(()=>te(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){T(e.$$.fragment)},l(i){q(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],Y(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){v(e.$$.fragment,i),r=!1},d(i){O(e,i)}}}function wn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=nn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:g=void 0}=e,{layout:p=void 0}=e,{filter:f=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:F=void 0}=e,{hoverCursor:b=void 0}=e,{manageHoverState:E=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:_=!0}=e;function h(j){N=j,n(0,N)}function c(j){ye.call(this,t,j)}function A(j){ye.call(this,t,j)}function G(j){ye.call(this,t,j)}function P(j){ye.call(this,t,j)}function M(j){ye.call(this,t,j)}function he(j){ye.call(this,t,j)}return t.$$set=j=>{"id"in j&&n(1,l=j.id),"source"in j&&n(2,i=j.source),"sourceLayer"in j&&n(3,a=j.sourceLayer),"beforeId"in j&&n(4,s=j.beforeId),"beforeLayerType"in j&&n(5,m=j.beforeLayerType),"paint"in j&&n(6,g=j.paint),"layout"in j&&n(7,p=j.layout),"filter"in j&&n(8,f=j.filter),"applyToClusters"in j&&n(9,C=j.applyToClusters),"minzoom"in j&&n(10,L=j.minzoom),"maxzoom"in j&&n(11,F=j.maxzoom),"hoverCursor"in j&&n(12,b=j.hoverCursor),"manageHoverState"in j&&n(13,E=j.manageHoverState),"hovered"in j&&n(0,N=j.hovered),"eventsIfTopMost"in j&&n(14,u=j.eventsIfTopMost),"interactive"in j&&n(15,_=j.interactive),"$$scope"in j&&n(24,o=j.$$scope)},[N,l,i,a,s,m,g,p,f,C,L,F,b,E,u,_,r,h,c,A,G,P,M,he,o]}class yn extends Ae{constructor(e){super(),Me(this,e,wn,bn,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var vn=Object.defineProperty,H=(t,e)=>vn(t,"name",{value:e,configurable:!0}),kn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ee(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Je(e),o=Je(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ee(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ee(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ct(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ee(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};H(kn,"GeojsonEquality");function Ee(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}H(Ee,"sameLength");function Je(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}H(Je,"explode");var oe=63710088e-1,St={centimeters:oe*100,centimetres:oe*100,degrees:360/(2*Math.PI),feet:oe*3.28084,inches:oe*39.37,kilometers:oe/1e3,kilometres:oe/1e3,meters:oe,metres:oe,miles:oe/1609.344,millimeters:oe*1e3,millimetres:oe*1e3,nauticalmiles:oe/1852,radians:1,yards:oe*1.0936},lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ge(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}H(ge,"feature");function jn(t,e,n={}){switch(t){case"Point":return Ge(e).geometry;case"LineString":return Ze(e).geometry;case"Polygon":return We(e).geometry;case"MultiPoint":return Ft(e).geometry;case"MultiLineString":return It(e).geometry;case"MultiPolygon":return Tt(e).geometry;default:throw new Error(t+" is invalid")}}H(jn,"geometry");function Ge(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ve(t[0])||!ve(t[1]))throw new Error("coordinates must contain numbers");return ge({type:"Point",coordinates:t},e,n)}H(Ge,"point");function En(t,e,n={}){return ze(t.map(r=>Ge(r,e)),n)}H(En,"points");function We(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ge({type:"Polygon",coordinates:t},e,n)}H(We,"polygon");function Cn(t,e,n={}){return ze(t.map(r=>We(r,e)),n)}H(Cn,"polygons");function Ze(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ge({type:"LineString",coordinates:t},e,n)}H(Ze,"lineString");function Ln(t,e,n={}){return ze(t.map(r=>Ze(r,e)),n)}H(Ln,"lineStrings");function ze(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}H(ze,"featureCollection");function It(t,e,n={}){return ge({type:"MultiLineString",coordinates:t},e,n)}H(It,"multiLineString");function Ft(t,e,n={}){return ge({type:"MultiPoint",coordinates:t},e,n)}H(Ft,"multiPoint");function Tt(t,e,n={}){return ge({type:"MultiPolygon",coordinates:t},e,n)}H(Tt,"multiPolygon");function Pn(t,e,n={}){return ge({type:"GeometryCollection",geometries:t},e,n)}H(Pn,"geometryCollection");function An(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}H(An,"round");function qt(t,e="kilometers"){const n=St[e];if(!n)throw new Error(e+" units is invalid");return t*n}H(qt,"radiansToLength");function De(t,e="kilometers"){const n=St[e];if(!n)throw new Error(e+" units is invalid");return t/n}H(De,"lengthToRadians");function Mn(t,e){return qe(De(t,e))}H(Mn,"lengthToDegrees");function Sn(t){let e=t%360;return e<0&&(e+=360),e}H(Sn,"bearingToAzimuth");function qe(t){return t%(2*Math.PI)*180/Math.PI}H(qe,"radiansToDegrees");function Fe(t){return t%360*Math.PI/180}H(Fe,"degreesToRadians");function In(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return qt(De(t,e),n)}H(In,"convertLength");function Fn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=lt[e];if(!r)throw new Error("invalid original units");const o=lt[n];if(!o)throw new Error("invalid final units");return t/r*o}H(Fn,"convertArea");function ve(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}H(ve,"isNumber");function Tn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}H(Tn,"isObject");function qn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ve(e))throw new Error("bbox must only contain numbers")})}H(qn,"validateBBox");function Bn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}H(Bn,"validateId");var On=Object.defineProperty,pe=(t,e)=>On(t,"name",{value:e,configurable:!0});function Bt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}pe(Bt,"getCoord");function Nn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}pe(Nn,"getCoords");function Ot(t){if(t.length>1&&ve(t[0])&&ve(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ot(t[0]);throw new Error("coordinates must only contain numbers")}pe(Ot,"containsNumber");function Gn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}pe(Gn,"geojsonType");function zn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}pe(zn,"featureOf");function Dn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}pe(Dn,"collectionOf");function Rn(t){return t.type==="Feature"?t.geometry:t}pe(Rn,"getGeom");function Un(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}pe(Un,"getType");var Hn=Object.defineProperty,Jn=(t,e)=>Hn(t,"name",{value:e,configurable:!0});function Nt(t,e,n,r={}){const o=Bt(t),l=Fe(o[0]),i=Fe(o[1]),a=Fe(n),s=De(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),g=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),p=qe(g),f=qe(m);return Ge([p,f],r.properties)}Jn(Nt,"destination");var at=Nt,Kn=Object.defineProperty,J=(t,e)=>Kn(t,"name",{value:e,configurable:!0}),Xn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ce(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ke(e),o=Ke(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ce(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ce(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ct(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ce(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(Xn,"GeojsonEquality");function Ce(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(Ce,"sameLength");function Ke(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(Ke,"explode");var ie=63710088e-1,Gt={centimeters:ie*100,centimetres:ie*100,degrees:360/(2*Math.PI),feet:ie*3.28084,inches:ie*39.37,kilometers:ie/1e3,kilometres:ie/1e3,meters:ie,metres:ie,miles:ie/1609.344,millimeters:ie*1e3,millimetres:ie*1e3,nauticalmiles:ie/1852,radians:1,yards:ie*1.0936},st={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function de(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J(de,"feature");function Vn(t,e,n={}){switch(t){case"Point":return Qe(e).geometry;case"LineString":return xe(e).geometry;case"Polygon":return Ye(e).geometry;case"MultiPoint":return Dt(e).geometry;case"MultiLineString":return zt(e).geometry;case"MultiPolygon":return Rt(e).geometry;default:throw new Error(t+" is invalid")}}J(Vn,"geometry");function Qe(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ke(t[0])||!ke(t[1]))throw new Error("coordinates must contain numbers");return de({type:"Point",coordinates:t},e,n)}J(Qe,"point");function Wn(t,e,n={}){return Re(t.map(r=>Qe(r,e)),n)}J(Wn,"points");function Ye(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return de({type:"Polygon",coordinates:t},e,n)}J(Ye,"polygon");function Zn(t,e,n={}){return Re(t.map(r=>Ye(r,e)),n)}J(Zn,"polygons");function xe(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return de({type:"LineString",coordinates:t},e,n)}J(xe,"lineString");function Qn(t,e,n={}){return Re(t.map(r=>xe(r,e)),n)}J(Qn,"lineStrings");function Re(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(Re,"featureCollection");function zt(t,e,n={}){return de({type:"MultiLineString",coordinates:t},e,n)}J(zt,"multiLineString");function Dt(t,e,n={}){return de({type:"MultiPoint",coordinates:t},e,n)}J(Dt,"multiPoint");function Rt(t,e,n={}){return de({type:"MultiPolygon",coordinates:t},e,n)}J(Rt,"multiPolygon");function Yn(t,e,n={}){return de({type:"GeometryCollection",geometries:t},e,n)}J(Yn,"geometryCollection");function xn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J(xn,"round");function Ut(t,e="kilometers"){const n=Gt[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(Ut,"radiansToLength");function et(t,e="kilometers"){const n=Gt[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(et,"lengthToRadians");function er(t,e){return tt(et(t,e))}J(er,"lengthToDegrees");function tr(t){let e=t%360;return e<0&&(e+=360),e}J(tr,"bearingToAzimuth");function tt(t){return t%(2*Math.PI)*180/Math.PI}J(tt,"radiansToDegrees");function Le(t){return t%360*Math.PI/180}J(Le,"degreesToRadians");function nr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Ut(et(t,e),n)}J(nr,"convertLength");function rr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=st[e];if(!r)throw new Error("invalid original units");const o=st[n];if(!o)throw new Error("invalid final units");return t/r*o}J(rr,"convertArea");function ke(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(ke,"isNumber");function or(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(or,"isObject");function ir(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ke(e))throw new Error("bbox must only contain numbers")})}J(ir,"validateBBox");function lr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(lr,"validateId");var ar=Object.defineProperty,_e=(t,e)=>ar(t,"name",{value:e,configurable:!0});function Xe(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}_e(Xe,"getCoord");function sr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}_e(sr,"getCoords");function Ht(t){if(t.length>1&&ke(t[0])&&ke(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ht(t[0]);throw new Error("coordinates must only contain numbers")}_e(Ht,"containsNumber");function ur(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}_e(ur,"geojsonType");function fr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}_e(fr,"featureOf");function mr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}_e(mr,"collectionOf");function cr(t){return t.type==="Feature"?t.geometry:t}_e(cr,"getGeom");function gr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}_e(gr,"getType");var pr=Object.defineProperty,Jt=(t,e)=>pr(t,"name",{value:e,configurable:!0});function nt(t,e,n={}){if(n.final===!0)return Kt(t,e);const r=Xe(t),o=Xe(e),l=Le(r[0]),i=Le(o[0]),a=Le(r[1]),s=Le(o[1]),m=Math.sin(i-l)*Math.cos(s),g=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return tt(Math.atan2(m,g))}Jt(nt,"bearing");function Kt(t,e){let n=nt(e,t);return n=(n+180)%360,n}Jt(Kt,"calculateFinalBearing");var dr=nt;function ut(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function ft(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function _r(t){let e,n=Pr(t[36])+"",r;return{c(){e=x("span"),r=K(n),this.h()},l(o){e=ee(o,"SPAN",{class:!0});var l=ne(e);r=X(l,n),l.forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),Z(e,"color","#4472c4"),Z(e,"background-color","white")},m(o,l){k(o,e,l),le(e,r)},p:Oe,d(o){o&&$(e)}}}function mt(t){let e,n,r;function o(s){t[17](s,t[37])}function l(){return t[18](t[36])}function i(){return t[19](t[36])}let a={draggable:!0,$$slots:{default:[_r]},$$scope:{ctx:t}};return t[37].point!==void 0&&(a.lngLat=t[37].point),e=new Ie({props:a}),Q.push(()=>te(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){T(e.$$.fragment)},l(s){q(e.$$.fragment,s)},m(s,m){B(e,s,m),r=!0},p(s,m){t=s;const g={};m[1]&256&&(g.$$scope={dirty:m,ctx:t}),!n&&m[0]&11&&(n=!0,g.lngLat=t[37].point,Y(()=>n=!1)),e.$set(g)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){v(e.$$.fragment,s),r=!1},d(s){O(e,s)}}}function hr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ne(e).forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),Z(e,"background-color",t[6][t[34].score]),Z(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){k(n,e,r)},p(n,r){r[0]&11&&Z(e,"background-color",n[6][n[34].score]),r[0]&11&&Z(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&$(e)}}}function $r(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ne(e).forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),Z(e,"background-color",t[6][t[34].score])},m(n,r){k(n,e,r)},p(n,r){r[0]&11&&Z(e,"background-color",n[6][n[34].score])},d(n){n&&$(e)}}}function br(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ne(e).forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),Z(e,"background-color",t[6][t[34].score]),Z(e,"opacity","0%")},m(n,r){k(n,e,r)},p(n,r){r[0]&11&&Z(e,"background-color",n[6][n[34].score])},d(n){n&&$(e)}}}function ct(t){let e,n,r,o,l,i,a,s,m;function g(c){t[20](c,t[34])}function p(){return t[21](t[36])}function f(){return t[22](t[36])}let C={draggable:!0,$$slots:{default:[hr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(C.lngLat=t[34].point1),e=new Ie({props:C}),Q.push(()=>te(e,"lngLat",g)),e.$on("dragend",p),e.$on("click",f);function L(c){t[23](c,t[34])}function F(){return t[24](t[36])}function b(){return t[25](t[36])}let E={draggable:!0,$$slots:{default:[$r]},$$scope:{ctx:t}};t[34].point2!==void 0&&(E.lngLat=t[34].point2),o=new Ie({props:E}),Q.push(()=>te(o,"lngLat",L)),o.$on("dragend",F),o.$on("click",b);function N(c){t[26](c,t[34])}function u(){return t[27](t[36])}function _(){return t[28](t[36])}let h={draggable:!0,$$slots:{default:[br]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(h.lngLat=t[34].point3),a=new Ie({props:h}),Q.push(()=>te(a,"lngLat",N)),a.$on("dragend",u),a.$on("click",_),{c(){T(e.$$.fragment),r=z(),T(o.$$.fragment),i=z(),T(a.$$.fragment)},l(c){q(e.$$.fragment,c),r=D(c),q(o.$$.fragment,c),i=D(c),q(a.$$.fragment,c)},m(c,A){B(e,c,A),k(c,r,A),B(o,c,A),k(c,i,A),B(a,c,A),m=!0},p(c,A){t=c;const G={};A[0]&11|A[1]&256&&(G.$$scope={dirty:A,ctx:t}),!n&&A[0]&11&&(n=!0,G.lngLat=t[34].point1,Y(()=>n=!1)),e.$set(G);const P={};A[0]&11|A[1]&256&&(P.$$scope={dirty:A,ctx:t}),!l&&A[0]&11&&(l=!0,P.lngLat=t[34].point2,Y(()=>l=!1)),o.$set(P);const M={};A[0]&11|A[1]&256&&(M.$$scope={dirty:A,ctx:t}),!s&&A[0]&11&&(s=!0,M.lngLat=t[34].point3,Y(()=>s=!1)),a.$set(M)},i(c){m||(w(e.$$.fragment,c),w(o.$$.fragment,c),w(a.$$.fragment,c),m=!0)},o(c){v(e.$$.fragment,c),v(o.$$.fragment,c),v(a.$$.fragment,c),m=!1},d(c){c&&($(r),$(i)),O(e,c),O(o,c),O(a,c)}}}function wr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){k(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&me(n,e)},d(r){r&&$(n)}}}function yr(t){let e,n;return e=new Lt({props:{$$slots:{default:[wr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function vr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){k(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&me(n,e)},d(r){r&&$(n)}}}function kr(t){let e,n;return e=new Lt({props:{$$slots:{default:[vr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function jr(t){let e,n,r,o,l,i;return e=new He({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":it(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[yr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new He({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":it(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[kr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new yn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment)},l(a){q(e.$$.fragment,a),n=D(a),q(r.$$.fragment,a),o=D(a),q(l.$$.fragment,a)},m(a,s){B(e,a,s),k(a,n,s),B(r,a,s),k(a,o,s),B(l,a,s),i=!0},p(a,s){const m={};s[1]&256&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const g={};s[1]&256&&(g.$$scope={dirty:s,ctx:a}),r.$set(g)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){v(e.$$.fragment,a),v(r.$$.fragment,a),v(l.$$.fragment,a),i=!1},d(a){a&&($(n),$(o)),O(e,a),O(r,a),O(l,a)}}}function Er(t){let e,n,r,o;return e=new He({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new an({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment)},l(l){q(e.$$.fragment,l),n=D(l),q(r.$$.fragment,l)},m(l,i){B(e,l,i),k(l,n,i),B(r,l,i),o=!0},p:Oe,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){v(e.$$.fragment,l),v(r.$$.fragment,l),o=!1},d(l){l&&$(n),O(e,l),O(r,l)}}}function Cr(t){let e,n,r,o,l,i,a,s,m,g,p,f;e=new un({}),e.$on("click",t[8]),r=new ln({props:{gj:t[3].summary.networkMap,show:t[2]}});let C=ue(t[3].jat[t[0]][t[1]].arms),L=[];for(let u=0;u<C.length;u+=1)L[u]=mt(ft(t,C,u));const F=u=>v(L[u],1,1,()=>{L[u]=null});let b=ue(t[3].jat[t[0]][t[1]].movements),E=[];for(let u=0;u<b.length;u+=1)E[u]=ct(ut(t,b,u));const N=u=>v(E[u],1,1,()=>{E[u]=null});return a=new ot({props:{data:t[10](t[3]),$$slots:{default:[jr]},$$scope:{ctx:t}}}),m=new ot({props:{data:t[5],$$slots:{default:[Er]},$$scope:{ctx:t}}}),p=new fn({props:{map:t[4]}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z();for(let u=0;u<L.length;u+=1)L[u].c();l=z();for(let u=0;u<E.length;u+=1)E[u].c();i=z(),T(a.$$.fragment),s=z(),T(m.$$.fragment),g=z(),T(p.$$.fragment)},l(u){q(e.$$.fragment,u),n=D(u),q(r.$$.fragment,u),o=D(u);for(let _=0;_<L.length;_+=1)L[_].l(u);l=D(u);for(let _=0;_<E.length;_+=1)E[_].l(u);i=D(u),q(a.$$.fragment,u),s=D(u),q(m.$$.fragment,u),g=D(u),q(p.$$.fragment,u)},m(u,_){B(e,u,_),k(u,n,_),B(r,u,_),k(u,o,_);for(let h=0;h<L.length;h+=1)L[h]&&L[h].m(u,_);k(u,l,_);for(let h=0;h<E.length;h+=1)E[h]&&E[h].m(u,_);k(u,i,_),B(a,u,_),k(u,s,_),B(m,u,_),k(u,g,_),B(p,u,_),f=!0},p(u,_){const h={};if(_[0]&8&&(h.gj=u[3].summary.networkMap),_[0]&4&&(h.show=u[2]),r.$set(h),_[0]&139){C=ue(u[3].jat[u[0]][u[1]].arms);let P;for(P=0;P<C.length;P+=1){const M=ft(u,C,P);L[P]?(L[P].p(M,_),w(L[P],1)):(L[P]=mt(M),L[P].c(),w(L[P],1),L[P].m(l.parentNode,l))}for(ae(),P=C.length;P<L.length;P+=1)F(P);se()}if(_[0]&203){b=ue(u[3].jat[u[0]][u[1]].movements);let P;for(P=0;P<b.length;P+=1){const M=ut(u,b,P);E[P]?(E[P].p(M,_),w(E[P],1)):(E[P]=ct(M),E[P].c(),w(E[P],1),E[P].m(i.parentNode,i))}for(ae(),P=b.length;P<E.length;P+=1)N(P);se()}const c={};_[0]&8&&(c.data=u[10](u[3])),_[1]&256&&(c.$$scope={dirty:_,ctx:u}),a.$set(c);const A={};_[0]&32&&(A.data=u[5]),_[1]&256&&(A.$$scope={dirty:_,ctx:u}),m.$set(A);const G={};_[0]&16&&(G.map=u[4]),p.$set(G)},i(u){if(!f){w(e.$$.fragment,u),w(r.$$.fragment,u);for(let _=0;_<C.length;_+=1)w(L[_]);for(let _=0;_<b.length;_+=1)w(E[_]);w(a.$$.fragment,u),w(m.$$.fragment,u),w(p.$$.fragment,u),f=!0}},o(u){v(e.$$.fragment,u),v(r.$$.fragment,u),L=L.filter(Boolean);for(let _=0;_<L.length;_+=1)v(L[_]);E=E.filter(Boolean);for(let _=0;_<E.length;_+=1)v(E[_]);v(a.$$.fragment,u),v(m.$$.fragment,u),v(p.$$.fragment,u),f=!1},d(u){u&&($(n),$(o),$(l),$(i),$(s),$(g)),O(e,u),O(r,u),Pe(L,u),Pe(E,u),O(a,u),O(m,u),O(p,u)}}}function Lr(t){let e,n,r;function o(i){t[29](i)}let l={$$slots:{default:[Cr]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.map=t[4]),e=new rn({props:l}),Q.push(()=>te(e,"map",o)),{c(){T(e.$$.fragment)},l(i){q(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,a){const s={};a[0]&63|a[1]&256&&(s.$$scope={dirty:a,ctx:i}),!n&&a[0]&16&&(n=!0,s.map=i[4],Y(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){v(e.$$.fragment,i),r=!1},d(i){O(e,i)}}}function gt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Pr(t){return String.fromCharCode(t+65)}function Ar(t,e,n){let r,o;Be(t,V,y=>n(3,o=y));let{junctionIdx:l}=e,{stage:i}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:m}=e,{streetviewOn:g}=e,{showContext:p}=e,f,C={0:Se.red.background,1:Se.amber.background,2:Se.green.background,X:Se.critical.background};function L(y,U,re){let be={type:"FeatureCollection",features:[]},we=U??re;return we!=null&&(we.kind=="arm"?be.features.push(gt(y.jat[l][i].arms[we.idx],we.idx)):be.features.push(u(y.jat[l][i].movements[we.idx],we.idx))),be}function F(y){n(11,s=y),n(12,m=null)}function b(y){if(!g){for(let U of f.queryRenderedFeatures(y.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(11,s=null);return}a=="arm"?(Te(V,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:y.detail.lngLat.toArray(),name:""}],o),n(11,s={kind:"arm",idx:o.jat[l][i].arms.length-1})):(Te(V,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:y.detail.lngLat.toArray(),point2:at(y.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:at(y.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(11,s={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(12,m=null)}}function E(y){F({kind:"movement",idx:y.detail.features[0].id})}Yt(()=>{h(!1)});function N(y){let U={type:"FeatureCollection",features:y.jat[l][i].movements.map((re,be)=>u(re,be))};for(let re of y.jat[l][i].movements)if(U.features.push(_(re,U.features.length)),re.kind=="walking & wheeling"){let be={...re,point1:re.point3,point3:re.point1};U.features.push(_(be,U.features.length))}return U}function u(y,U){return{type:"Feature",id:U,properties:{name:y.name,kind:y.kind,color:C[y.score]},geometry:{type:"LineString",coordinates:[y.point1,y.point2,y.point3]}}}function _(y,U){return{type:"Feature",id:U,properties:{kind:y.kind,color:C[y.score],angle:dr(y.point2,y.point3)},geometry:{type:"Point",coordinates:y.point3}}}function h(y){let U=N(o);for(let re of o.jat[l][i].arms)U.features.push(gt(re,U.features.length));for(let re of o.summary.networkMap.features)U.features.push(re);U.features.length>0&&f.fitBounds(on(U),{padding:20,animate:y})}function c(){return f}function A(y,U){t.$$.not_equal(U.point,y)&&(U.point=y,V.set(o))}const G=y=>F({kind:"arm",idx:y}),P=y=>F({kind:"arm",idx:y});function M(y,U){t.$$.not_equal(U.point1,y)&&(U.point1=y,V.set(o))}const he=y=>F({kind:"movement",idx:y}),j=y=>F({kind:"movement",idx:y});function d(y,U){t.$$.not_equal(U.point2,y)&&(U.point2=y,V.set(o))}const S=y=>F({kind:"movement",idx:y}),W=y=>F({kind:"movement",idx:y});function I(y,U){t.$$.not_equal(U.point3,y)&&(U.point3=y,V.set(o))}const R=y=>F({kind:"movement",idx:y}),$e=y=>F({kind:"movement",idx:y});function Xt(y){f=y,n(4,f)}return t.$$set=y=>{"junctionIdx"in y&&n(0,l=y.junctionIdx),"stage"in y&&n(1,i=y.stage),"newKind"in y&&n(13,a=y.newKind),"editing"in y&&n(11,s=y.editing),"hoveringSidebar"in y&&n(12,m=y.hoveringSidebar),"streetviewOn"in y&&n(14,g=y.streetviewOn),"showContext"in y&&n(2,p=y.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=L(o,s,m))},[l,i,p,o,f,r,C,F,b,E,N,s,m,a,g,h,c,A,G,P,M,he,j,d,S,W,I,R,$e,Xt]}class Mr extends Ae{constructor(e){super(),Me(this,e,Ar,Lr,je,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Sr(t){let e,n,r,o,l,i,a,s,m,g,p,f;function C(h){t[5](h)}let L={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(L.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new Ve({props:L}),Q.push(()=>te(e,"value",C));function F(h){t[6](h)}let b={legend:"Movement",choices:Mt(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(b.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Pt({props:b}),Q.push(()=>te(o,"value",F));function E(h){t[7](h)}let N={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(N.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new hn({props:N}),Q.push(()=>te(a,"value",E));function u(h){t[8](h)}let _={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),g=new At({props:_}),Q.push(()=>te(g,"value",u)),{c(){T(e.$$.fragment),r=z(),T(o.$$.fragment),i=z(),T(a.$$.fragment),m=z(),T(g.$$.fragment)},l(h){q(e.$$.fragment,h),r=D(h),q(o.$$.fragment,h),i=D(h),q(a.$$.fragment,h),m=D(h),q(g.$$.fragment,h)},m(h,c){B(e,h,c),k(h,r,c),B(o,h,c),k(h,i,c),B(a,h,c),k(h,m,c),B(g,h,c),f=!0},p(h,[c]){const A={};!n&&c&15&&(n=!0,A.value=h[3].jat[h[0]][h[1]].movements[h[2]].name,Y(()=>n=!1)),e.$set(A);const G={};!l&&c&15&&(l=!0,G.value=h[3].jat[h[0]][h[1]].movements[h[2]].kind,Y(()=>l=!1)),o.$set(G);const P={};!s&&c&15&&(s=!0,P.value=h[3].jat[h[0]][h[1]].movements[h[2]].score,Y(()=>s=!1)),a.$set(P);const M={};!p&&c&15&&(p=!0,M.value=h[3].jat[h[0]][h[1]].movements[h[2]].notes,Y(()=>p=!1)),g.$set(M)},i(h){f||(w(e.$$.fragment,h),w(o.$$.fragment,h),w(a.$$.fragment,h),w(g.$$.fragment,h),f=!0)},o(h){v(e.$$.fragment,h),v(o.$$.fragment,h),v(a.$$.fragment,h),v(g.$$.fragment,h),f=!1},d(h){h&&($(r),$(i),$(m)),O(e,h),O(o,h),O(a,h),O(g,h)}}}function Ir(t,e,n){let r;Be(t,V,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e;Mt(["cycling","walking & wheeling"]);let a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(f){t.$$.not_equal(r.jat[o][l].movements[i].name,f)&&(r.jat[o][l].movements[i].name=f,V.set(r))}function m(f){t.$$.not_equal(r.jat[o][l].movements[i].kind,f)&&(r.jat[o][l].movements[i].kind=f,V.set(r))}function g(f){t.$$.not_equal(r.jat[o][l].movements[i].score,f)&&(r.jat[o][l].movements[i].score=f,V.set(r))}function p(f){t.$$.not_equal(r.jat[o][l].movements[i].notes,f)&&(r.jat[o][l].movements[i].notes=f,V.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,l=f.stage),"idx"in f&&n(2,i=f.idx)},[o,l,i,r,a,s,m,g,p]}class Fr extends Ae{constructor(e){super(),Me(this,e,Ir,Sr,je,{junctionIdx:0,stage:1,idx:2})}}const{window:Tr}=sn;function pt(t,e,n){const r=t.slice();return r[29]=e[n],r[31]=n,r}function dt(t,e,n){const r=t.slice();return r[32]=e[n],r[31]=n,r}function qr(t){let e,n,r,o,l,i,a,s;e=new dn({props:{$$slots:{default:[Or]},$$scope:{ctx:t}}}),e.$on("click",t[25]),r=new Et({props:{$$slots:{default:[Nr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const m=[zr,Gr],g=[];function p(f,C){return f[3].kind=="movement"?0:1}return l=p(t),i=g[l]=m[l](t),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),i.c(),a=ce()},l(f){q(e.$$.fragment,f),n=D(f),q(r.$$.fragment,f),o=D(f),i.l(f),a=ce()},m(f,C){B(e,f,C),k(f,n,C),B(r,f,C),k(f,o,C),g[l].m(f,C),k(f,a,C),s=!0},p(f,C){const L={};C[1]&8&&(L.$$scope={dirty:C,ctx:f}),e.$set(L);const F={};C[1]&8&&(F.$$scope={dirty:C,ctx:f}),r.$set(F);let b=l;l=p(f),l===b?g[l].p(f,C):(ae(),v(g[b],1,1,()=>{g[b]=null}),se(),i=g[l],i?i.p(f,C):(i=g[l]=m[l](f),i.c()),w(i,1),i.m(a.parentNode,a))},i(f){s||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(i),s=!0)},o(f){v(e.$$.fragment,f),v(r.$$.fragment,f),v(i),s=!1},d(f){f&&($(n),$(o),$(a)),O(e,f),O(r,f),g[l].d(f)}}}function Br(t){let e,n,r,o,l,i,a="Arms",s,m,g,p,f,C="Movements",L,F,b,E,N;e=new _n({props:{label:"Tools",$$slots:{default:[Ur]},$$scope:{ctx:t}}});function u(d){t[18](d)}let _={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(_.value=t[2]),r=new Pt({props:_}),Q.push(()=>te(r,"value",u));let h=ue(t[8].jat[t[0]][t[1]].arms),c=[];for(let d=0;d<h.length;d+=1)c[d]=ht(dt(t,h,d));const A=d=>v(c[d],1,1,()=>{c[d]=null});let G=t[8].jat[t[0]][t[9]].arms.length>0&&$t(t),P=ue(t[8].jat[t[0]][t[1]].movements),M=[];for(let d=0;d<P.length;d+=1)M[d]=bt(pt(t,P,d));const he=d=>v(M[d],1,1,()=>{M[d]=null});let j=t[8].jat[t[0]][t[1]].movements.length>0&&wt(t);return{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),l=z(),i=x("h3"),i.textContent=a,s=z(),m=x("ul");for(let d=0;d<c.length;d+=1)c[d].c();g=z(),G&&G.c(),p=z(),f=x("h3"),f.textContent=C,L=z(),F=x("ol");for(let d=0;d<M.length;d+=1)M[d].c();b=z(),j&&j.c(),E=ce()},l(d){q(e.$$.fragment,d),n=D(d),q(r.$$.fragment,d),l=D(d),i=ee(d,"H3",{"data-svelte-h":!0}),rt(i)!=="svelte-ld74qb"&&(i.textContent=a),s=D(d),m=ee(d,"UL",{});var S=ne(m);for(let I=0;I<c.length;I+=1)c[I].l(S);S.forEach($),g=D(d),G&&G.l(d),p=D(d),f=ee(d,"H3",{"data-svelte-h":!0}),rt(f)!=="svelte-1dc52s8"&&(f.textContent=C),L=D(d),F=ee(d,"OL",{});var W=ne(F);for(let I=0;I<M.length;I+=1)M[I].l(W);W.forEach($),b=D(d),j&&j.l(d),E=ce()},m(d,S){B(e,d,S),k(d,n,S),B(r,d,S),k(d,l,S),k(d,i,S),k(d,s,S),k(d,m,S);for(let W=0;W<c.length;W+=1)c[W]&&c[W].m(m,null);k(d,g,S),G&&G.m(d,S),k(d,p,S),k(d,f,S),k(d,L,S),k(d,F,S);for(let W=0;W<M.length;W+=1)M[W]&&M[W].m(F,null);k(d,b,S),j&&j.m(d,S),k(d,E,S),N=!0},p(d,S){const W={};S[0]&224|S[1]&8&&(W.$$scope={dirty:S,ctx:d}),e.$set(W);const I={};if(!o&&S[0]&4&&(o=!0,I.value=d[2],Y(()=>o=!1)),r.$set(I),S[0]&1299){h=ue(d[8].jat[d[0]][d[1]].arms);let R;for(R=0;R<h.length;R+=1){const $e=dt(d,h,R);c[R]?(c[R].p($e,S),w(c[R],1)):(c[R]=ht($e),c[R].c(),w(c[R],1),c[R].m(m,null))}for(ae(),R=h.length;R<c.length;R+=1)A(R);se()}if(d[8].jat[d[0]][d[9]].arms.length>0?G?(G.p(d,S),S[0]&257&&w(G,1)):(G=$t(d),G.c(),w(G,1),G.m(p.parentNode,p)):G&&(ae(),v(G,1,1,()=>{G=null}),se()),S[0]&1299){P=ue(d[8].jat[d[0]][d[1]].movements);let R;for(R=0;R<P.length;R+=1){const $e=pt(d,P,R);M[R]?(M[R].p($e,S),w(M[R],1)):(M[R]=bt($e),M[R].c(),w(M[R],1),M[R].m(F,null))}for(ae(),R=P.length;R<M.length;R+=1)he(R);se()}d[8].jat[d[0]][d[1]].movements.length>0?j?j.p(d,S):(j=wt(d),j.c(),j.m(E.parentNode,E)):j&&(j.d(1),j=null)},i(d){if(!N){w(e.$$.fragment,d),w(r.$$.fragment,d);for(let S=0;S<h.length;S+=1)w(c[S]);w(G);for(let S=0;S<P.length;S+=1)w(M[S]);N=!0}},o(d){v(e.$$.fragment,d),v(r.$$.fragment,d),c=c.filter(Boolean);for(let S=0;S<c.length;S+=1)v(c[S]);v(G),M=M.filter(Boolean);for(let S=0;S<M.length;S+=1)v(M[S]);N=!1},d(d){d&&($(n),$(l),$(i),$(s),$(m),$(g),$(p),$(f),$(L),$(F),$(b),$(E)),O(e,d),O(r,d),Pe(c,d),G&&G.d(d),Pe(M,d),j&&j.d(d)}}}function Or(t){let e;return{c(){e=K("Save")},l(n){e=X(n,"Save")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function Nr(t){let e;return{c(){e=K("Delete")},l(n){e=X(n,"Delete")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function Gr(t){let e,n,r;function o(i){t[26](i)}let l={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new Ve({props:l}),Q.push(()=>te(e,"value",o)),{c(){T(e.$$.fragment)},l(i){q(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&267&&(n=!0,s.value=i[8].jat[i[0]][i[1]].arms[i[3].idx].name,Y(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){v(e.$$.fragment,i),r=!1},d(i){O(e,i)}}}function zr(t){let e,n;return e=new Fr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function Dr(t){let e;return{c(){e=K("Zoom to fit")},l(n){e=X(n,"Zoom to fit")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function _t(t){var i;let e,n,r;function o(a){t[16](a)}let l={map:(i=t[7])==null?void 0:i.getMap()};return t[5]!==void 0&&(l.enabled=t[5]),e=new pn({props:l}),Q.push(()=>te(e,"enabled",o)),{c(){T(e.$$.fragment)},l(a){q(e.$$.fragment,a)},m(a,s){B(e,a,s),r=!0},p(a,s){var g;const m={};s[0]&128&&(m.map=(g=a[7])==null?void 0:g.getMap()),!n&&s[0]&32&&(n=!0,m.enabled=a[5],Y(()=>n=!1)),e.$set(m)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){v(e.$$.fragment,a),r=!1},d(a){O(e,a)}}}function Rr(t){let e;return{c(){e=K("Show scheme context")},l(n){e=X(n,"Show scheme context")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function Ur(t){var F;let e,n,r,o,l,i,a=(F=t[7])==null?void 0:F.getMap(),s,m,g,p;e=new fe({props:{$$slots:{default:[Dr]},$$scope:{ctx:t}}}),e.$on("click",t[15]),r=new mn({}),l=new cn({});let f=a&&_t(t);function C(b){t[17](b)}let L={$$slots:{default:[Rr]},$$scope:{ctx:t}};return t[6]!==void 0&&(L.checked=t[6]),m=new gn({props:L}),Q.push(()=>te(m,"checked",C)),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment),i=z(),f&&f.c(),s=z(),T(m.$$.fragment)},l(b){q(e.$$.fragment,b),n=D(b),q(r.$$.fragment,b),o=D(b),q(l.$$.fragment,b),i=D(b),f&&f.l(b),s=D(b),q(m.$$.fragment,b)},m(b,E){B(e,b,E),k(b,n,E),B(r,b,E),k(b,o,E),B(l,b,E),k(b,i,E),f&&f.m(b,E),k(b,s,E),B(m,b,E),p=!0},p(b,E){var _;const N={};E[1]&8&&(N.$$scope={dirty:E,ctx:b}),e.$set(N),E[0]&128&&(a=(_=b[7])==null?void 0:_.getMap()),a?f?(f.p(b,E),E[0]&128&&w(f,1)):(f=_t(b),f.c(),w(f,1),f.m(s.parentNode,s)):f&&(ae(),v(f,1,1,()=>{f=null}),se());const u={};E[1]&8&&(u.$$scope={dirty:E,ctx:b}),!g&&E[0]&64&&(g=!0,u.checked=b[6],Y(()=>g=!1)),m.$set(u)},i(b){p||(w(e.$$.fragment,b),w(r.$$.fragment,b),w(l.$$.fragment,b),w(f),w(m.$$.fragment,b),p=!0)},o(b){v(e.$$.fragment,b),v(r.$$.fragment,b),v(l.$$.fragment,b),v(f),v(m.$$.fragment,b),p=!1},d(b){b&&($(n),$(o),$(i),$(s)),O(e,b),O(r,b),O(l,b),f&&f.d(b),O(m,b)}}}function Hr(t){let e=Vr(t[31])+"",n,r,o=(t[32].name||"Unnamed arm")+"",l;return{c(){n=K(e),r=K(" - "),l=K(o)},l(i){n=X(i,e),r=X(i," - "),l=X(i,o)},m(i,a){k(i,n,a),k(i,r,a),k(i,l,a)},p(i,a){a[0]&259&&o!==(o=(i[32].name||"Unnamed arm")+"")&&me(l,o)},d(i){i&&($(n),$(r),$(l))}}}function ht(t){let e,n,r,o;function l(){return t[19](t[31])}function i(){return t[20](t[31])}return n=new fe({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[21]),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(a){e=ee(a,"LI",{});var s=ne(e);q(n.$$.fragment,s),r=D(s),s.forEach($)},m(a,s){k(a,e,s),B(n,e,null),le(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&8&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){v(n.$$.fragment,a),o=!1},d(a){a&&$(e),O(n)}}}function $t(t){let e,n;return e=new fe({props:{$$slots:{default:[Jr]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[1]&8&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function Jr(t){let e,n;return{c(){e=K("Copy arms from "),n=K(t[9])},l(r){e=X(r,"Copy arms from "),n=X(r,t[9])},m(r,o){k(r,e,o),k(r,n,o)},p:Oe,d(r){r&&($(e),$(n))}}}function Kr(t){let e=(t[29].name||"Unnamed movement")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){k(r,n,o)},p(r,o){o[0]&259&&e!==(e=(r[29].name||"Unnamed movement")+"")&&me(n,e)},d(r){r&&$(n)}}}function bt(t){let e,n,r,o;function l(){return t[22](t[31])}function i(){return t[23](t[31])}return n=new fe({props:{$$slots:{default:[Kr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[24]),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(a){e=ee(a,"LI",{});var s=ne(e);q(n.$$.fragment,s),r=D(s),s.forEach($)},m(a,s){k(a,e,s),B(n,e,null),le(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&8&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){v(n.$$.fragment,a),o=!1},d(a){a&&$(e),O(n)}}}function wt(t){let e,n,r=yt(t[8].jat[t[0]][t[1]])+"",o,l;return{c(){e=x("p"),n=K("Total JAT score: "),o=K(r),l=K("%")},l(i){e=ee(i,"P",{});var a=ne(e);n=X(a,"Total JAT score: "),o=X(a,r),l=X(a,"%"),a.forEach($)},m(i,a){k(i,e,a),le(e,n),le(e,o),le(e,l)},p(i,a){a[0]&259&&r!==(r=yt(i[8].jat[i[0]][i[1]])+"")&&me(o,r)},d(i){i&&$(e)}}}function Xr(t){let e,n,r,o,l,i,a,s,m,g,p,f,C,L;function F(c){t[14](c)}let b={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(b.value=t[8].jat[t[0]][t[1]].notes),e=new At({props:b}),Q.push(()=>te(e,"value",F));const E=[Br,qr],N=[];function u(c,A){return c[3]==null?0:1}i=u(t),a=N[i]=E[i](t);function _(c){t[28](c)}let h={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(h.editing=t[3]),g=new Mr({props:h}),t[27](g),Q.push(()=>te(g,"editing",_)),{c(){T(e.$$.fragment),r=z(),o=x("div"),l=x("div"),a.c(),s=z(),m=x("div"),T(g.$$.fragment),this.h()},l(c){q(e.$$.fragment,c),r=D(c),o=ee(c,"DIV",{style:!0});var A=ne(o);l=ee(A,"DIV",{style:!0});var G=ne(l);a.l(G),G.forEach($),s=D(A),m=ee(A,"DIV",{style:!0});var P=ne(m);q(g.$$.fragment,P),P.forEach($),A.forEach($),this.h()},h(){Z(l,"width","30%"),Z(l,"overflow-y","scroll"),Z(l,"padding","10px"),Z(l,"border","1px solid black"),Z(m,"position","relative"),Z(m,"width","100%"),Z(o,"display","flex"),Z(o,"height","80vh")},m(c,A){B(e,c,A),k(c,r,A),k(c,o,A),le(o,l),N[i].m(l,null),le(o,s),le(o,m),B(g,m,null),f=!0,C||(L=xt(Tr,"keydown",t[12]),C=!0)},p(c,A){const G={};!n&&A[0]&259&&(n=!0,G.value=c[8].jat[c[0]][c[1]].notes,Y(()=>n=!1)),e.$set(G);let P=i;i=u(c),i===P?N[i].p(c,A):(ae(),v(N[P],1,1,()=>{N[P]=null}),se(),a=N[i],a?a.p(c,A):(a=N[i]=E[i](c),a.c()),w(a,1),a.m(l,null));const M={};A[0]&1&&(M.junctionIdx=c[0]),A[0]&2&&(M.stage=c[1]),A[0]&4&&(M.newKind=c[2]),A[0]&16&&(M.hoveringSidebar=c[4]),A[0]&32&&(M.streetviewOn=c[5]),A[0]&64&&(M.showContext=c[6]),!p&&A[0]&8&&(p=!0,M.editing=c[3],Y(()=>p=!1)),g.$set(M)},i(c){f||(w(e.$$.fragment,c),w(a),w(g.$$.fragment,c),f=!0)},o(c){v(e.$$.fragment,c),v(a),v(g.$$.fragment,c),f=!1},d(c){c&&($(r),$(o)),O(e,c),N[i].d(),t[27](null),O(g),C=!1,L()}}}function Vr(t){return String.fromCharCode(t+65)}function yt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function Wr(t,e,n){let r;Be(t,V,I=>n(8,r=I));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",a="arm",s=null,m=null,g=!1,p=!0,f=null;function C(I){n(3,s=I),n(4,m=null)}function L(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][l].movements.splice(s.idx,1),V.set(r)):(r.jat[o][l].arms.splice(s.idx,1),V.set(r)),n(3,s=null))}function F(I){s!=null&&I.key=="Escape"?(I.stopPropagation(),n(3,s=null)):s!=null&&I.key=="Delete"&&L()}function b(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(Te(V,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),V.set(r))}function E(I){t.$$.not_equal(r.jat[o][l].notes,I)&&(r.jat[o][l].notes=I,V.set(r))}const N=()=>f==null?void 0:f.zoom(!0);function u(I){g=I,n(5,g)}function _(I){p=I,n(6,p)}function h(I){a=I,n(2,a)}const c=I=>C({kind:"arm",idx:I}),A=I=>n(4,m={kind:"arm",idx:I}),G=()=>n(4,m=null),P=I=>C({kind:"movement",idx:I}),M=I=>n(4,m={kind:"movement",idx:I}),he=()=>n(4,m=null),j=()=>n(3,s=null);function d(I){t.$$.not_equal(r.jat[o][l].arms[s.idx].name,I)&&(r.jat[o][l].arms[s.idx].name=I,V.set(r))}function S(I){Q[I?"unshift":"push"](()=>{f=I,n(7,f)})}function W(I){s=I,n(3,s)}return t.$$set=I=>{"junctionIdx"in I&&n(0,o=I.junctionIdx),"stage"in I&&n(1,l=I.stage)},[o,l,a,s,m,g,p,f,r,i,C,L,F,b,E,N,u,_,h,c,A,G,P,M,he,j,d,S,W]}class Zr extends Ae{constructor(e){super(),Me(this,e,Wr,Xr,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function vt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function Qr(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,g,p,f,C=t[0].stage,L,F;s=new en({props:{$$slots:{default:[io]},$$scope:{ctx:t}}});function b(u){t[9](u)}let E={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(E.value=t[1].jat[t[0].idx].name),g=new Ve({props:E}),Q.push(()=>te(g,"value",b));let N=kt(t);return{c(){e=x("h2"),r=K(n),o=K(" - "),i=K(l),a=z(),T(s.$$.fragment),m=z(),T(g.$$.fragment),f=z(),N.c(),L=ce()},l(u){e=ee(u,"H2",{});var _=ne(e);r=X(_,n),o=X(_," - "),i=X(_,l),_.forEach($),a=D(u),q(s.$$.fragment,u),m=D(u),q(g.$$.fragment,u),f=D(u),N.l(u),L=ce()},m(u,_){k(u,e,_),le(e,r),le(e,o),le(e,i),k(u,a,_),B(s,u,_),k(u,m,_),B(g,u,_),k(u,f,_),N.m(u,_),k(u,L,_),F=!0},p(u,_){(!F||_&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&me(r,n),(!F||_&1)&&l!==(l=u[0].stage+"")&&me(i,l);const h={};_&8193&&(h.$$scope={dirty:_,ctx:u}),s.$set(h);const c={};!p&&_&3&&(p=!0,c.value=u[1].jat[u[0].idx].name,Y(()=>p=!1)),g.$set(c),_&1&&je(C,C=u[0].stage)?(ae(),v(N,1,1,Oe),se(),N=kt(u),N.c(),w(N,1),N.m(L.parentNode,L)):N.p(u,_)},i(u){F||(w(s.$$.fragment,u),w(g.$$.fragment,u),w(N),F=!0)},o(u){v(s.$$.fragment,u),v(g.$$.fragment,u),v(N),F=!1},d(u){u&&($(e),$(a),$(m),$(f),$(L)),O(s,u),O(g,u),N.d(u)}}}function Yr(t){let e,n,r,o;e=new fe({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=ue(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=jt(vt(t,l,s));const a=s=>v(i[s],1,1,()=>{i[s]=null});return{c(){T(e.$$.fragment),n=z(),r=x("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){q(e.$$.fragment,s),n=D(s),r=ee(s,"OL",{});var m=ne(r);for(let g=0;g<i.length;g+=1)i[g].l(m);m.forEach($)},m(s,m){B(e,s,m),k(s,n,m),k(s,r,m);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(r,null);o=!0},p(s,m){const g={};if(m&8192&&(g.$$scope={dirty:m,ctx:s}),e.$set(g),m&3){l=ue(s[1].jat);let p;for(p=0;p<l.length;p+=1){const f=vt(s,l,p);i[p]?(i[p].p(f,m),w(i[p],1)):(i[p]=jt(f),i[p].c(),w(i[p],1),i[p].m(r,null))}for(ae(),p=l.length;p<i.length;p+=1)a(p);se()}},i(s){if(!o){w(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(s){v(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)v(i[m]);o=!1},d(s){s&&($(n),$(r)),O(e,s),Pe(i,s)}}}function xr(t){let e;return{c(){e=K("Back to all junctions")},l(n){e=X(n,"Back to all junctions")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function eo(t){let e,n;return e=new fe({props:{$$slots:{default:[no]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function to(t){let e,n;return e=new fe({props:{$$slots:{default:[ro]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function no(t){let e;return{c(){e=K("Edit Proposed")},l(n){e=X(n,"Edit Proposed")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function ro(t){let e;return{c(){e=K("Edit Existing")},l(n){e=X(n,"Edit Existing")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function oo(t){let e;return{c(){e=K("Delete")},l(n){e=X(n,"Delete")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function io(t){let e,n,r,o,l,i,a;e=new fe({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const s=[to,eo],m=[];function g(p,f){return p[0].stage=="proposed"?0:1}return r=g(t),o=m[r]=s[r](t),i=new Et({props:{$$slots:{default:[oo]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){T(e.$$.fragment),n=z(),o.c(),l=z(),T(i.$$.fragment)},l(p){q(e.$$.fragment,p),n=D(p),o.l(p),l=D(p),q(i.$$.fragment,p)},m(p,f){B(e,p,f),k(p,n,f),m[r].m(p,f),k(p,l,f),B(i,p,f),a=!0},p(p,f){const C={};f&8192&&(C.$$scope={dirty:f,ctx:p}),e.$set(C);let L=r;r=g(p),r===L?m[r].p(p,f):(ae(),v(m[L],1,1,()=>{m[L]=null}),se(),o=m[r],o?o.p(p,f):(o=m[r]=s[r](p),o.c()),w(o,1),o.m(l.parentNode,l));const F={};f&8192&&(F.$$scope={dirty:f,ctx:p}),i.$set(F)},i(p){a||(w(e.$$.fragment,p),w(o),w(i.$$.fragment,p),a=!0)},o(p){v(e.$$.fragment,p),v(o),v(i.$$.fragment,p),a=!1},d(p){p&&($(n),$(l)),O(e,p),m[r].d(p),O(i,p)}}}function kt(t){let e,n;return e=new Zr({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){T(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){O(e,r)}}}function lo(t){let e;return{c(){e=K("Add new junction")},l(n){e=X(n,"Add new junction")},m(n,r){k(n,e,r)},d(n){n&&$(e)}}}function ao(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=K(e)},l(r){n=X(r,e)},m(r,o){k(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&me(n,e)},d(r){r&&$(n)}}}function jt(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new fe({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(i){e=ee(i,"LI",{});var a=ne(e);q(n.$$.fragment,a),r=D(a),a.forEach($)},m(i,a){k(i,e,a),B(n,e,null),le(e,r),o=!0},p(i,a){t=i;const s={};a&8194&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){v(n.$$.fragment,i),o=!1},d(i){i&&$(e),O(n)}}}function so(t){let e,n,r,o;const l=[Yr,Qr],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=ce()},l(s){n&&n.l(s),r=ce()},m(s,m){~e&&i[e].m(s,m),k(s,r,m),o=!0},p(s,[m]){let g=e;e=a(s),e===g?~e&&i[e].p(s,m):(n&&(ae(),v(i[g],1,1,()=>{i[g]=null}),se()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){v(n),o=!1},d(s){s&&$(r),~e&&i[e].d(s)}}}function Ue(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function uo(t,e,n){let r;Be(t,V,C=>n(1,r=C));let o={kind:"list"};function l(){Te(V,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(C){window.confirm("Delete this junction?")&&(r.jat.splice(C,1),V.set(r),n(0,o={kind:"list"}))}const a=C=>n(0,o={kind:"edit",idx:C,stage:"existing"}),s=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Ue(o),stage:"existing"}),g=()=>n(0,o={kind:"edit",idx:Ue(o),stage:"proposed"}),p=()=>i(Ue(o));function f(C){t.$$.not_equal(r.jat[o.idx].name,C)&&(r.jat[o.idx].name=C,V.set(r))}return[o,r,l,i,a,s,m,g,p,f]}class Lo extends Ae{constructor(e){super(),Me(this,e,uo,so,je,{})}}export{Lo as component};
