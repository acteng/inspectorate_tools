import{s as Z,a7 as Ce,U as Q,a8 as _e,v as V,a as L,g as D,i as y,x as O,f as b,k as be,t as M,d as T,j as H,M as he,e as q,c as F,b as U,w as G,h as N,r as Le,p as De,q as ve,n as Ee}from"../chunks/scheduler.B7j0yCxK.js";import{S as X,i as x,e as R,c as E,a as B,m as A,t as v,g as J,b as k,f as K,d as S}from"../chunks/index.XB8Z82Lq.js";import{e as z}from"../chunks/each.DailaNde.js";import{p as Be}from"../chunks/index.BfKH25cX.js";import{S as ke,W as Ae}from"../chunks/WarningButton.B6bztyBx.js";import{S as oe}from"../chunks/Select.BI--2Y59.js";import{T as Se}from"../chunks/TextArea.B5U8rwtQ.js";import{T as Ne}from"../chunks/TextInput.TwgkkvWf.js";import{s as W}from"../chunks/data.Xt8mrhyR.js";import{Y as Me}from"../chunks/YesNo.DihrQgJX.js";import{D as Te}from"../chunks/DefaultButton.COX8w4NZ.js";import{b as Pe,B as We,G as je,a as qe}from"../chunks/GeoreferenceLayer.CIPbQiNK.js";import{m as fe,M as Fe,G as Ge}from"../chunks/MapLibreMap.DF99VfAp.js";import{C as Ve}from"../chunks/CircleLayer.C6oUi34b.js";function Oe(n,t,i){let e=Ce(),{map:a}=t,{position:m}=t,r=null;return Q(()=>{r=new fe.Marker({draggable:!0}).setLngLat(new fe.LngLat(m[0],m[1])).addTo(a),r.on("dragstart",()=>{a.getCanvas().style.cursor="grabbing"}),r.on("drag",()=>{i(0,m=r.getLngLat().toArray())}),r.on("dragend",()=>{a.getCanvas().style.cursor="inherit",e("dragEnd")}),r.getElement().addEventListener("click",g=>{g.stopPropagation(),e("click")})}),_e(()=>{r==null||r.remove()}),n.$$set=g=>{"map"in g&&i(1,a=g.map),"position"in g&&i(0,m=g.position)},[m,a]}class Re extends X{constructor(t){super(),x(this,t,Oe,null,Z,{map:1,position:0})}}function ce(n){let t,i;return t=new ke({props:{$$slots:{default:[Ue]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){E(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,a){A(t,e,a),i=!0},p(e,a){const m={};a&2050&&(m.$$scope={dirty:a,ctx:e}),t.$set(m)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){k(t.$$.fragment,e),i=!1},d(e){S(t,e)}}}function Ue(n){let t,i;return{c(){t=M("Use lookup: "),i=M(n[1])},l(e){t=T(e,"Use lookup: "),i=T(e,n[1])},m(e,a){y(e,t,a),y(e,i,a)},p(e,a){a&2&&H(i,e[1])},d(e){e&&(b(t),b(i))}}}function He(n){let t,i,e,a,m,r,g,u,l,p,c,f,d,s,h,_;function $(o){n[5](o)}let I={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(I.value=n[2].criticalIssues[n[0]].criticalIssue),t=new oe({props:I}),V.push(()=>R(t,"value",$));function j(o){n[6](o)}let P={label:"Stage",emptyOption:!0,choices:Be(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(P.value=n[2].criticalIssues[n[0]].stage),a=new oe({props:P}),V.push(()=>R(a,"value",j));function ye(o){n[7](o)}let ee={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(ee.value=n[2].criticalIssues[n[0]].locationName),g=new Ne({props:ee}),V.push(()=>R(g,"value",ye));let w=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&ce(n);function Ie(o){n[8](o)}let te={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(te.value=n[2].criticalIssues[n[0]].resolved),c=new Me({props:te}),V.push(()=>R(c,"value",Ie));function we(o){n[9](o)}let ne={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(ne.value=n[2].criticalIssues[n[0]].notes),s=new Se({props:ne}),V.push(()=>R(s,"value",we)),{c(){E(t.$$.fragment),e=L(),E(a.$$.fragment),r=L(),E(g.$$.fragment),l=L(),w&&w.c(),p=L(),E(c.$$.fragment),d=L(),E(s.$$.fragment)},l(o){B(t.$$.fragment,o),e=D(o),B(a.$$.fragment,o),r=D(o),B(g.$$.fragment,o),l=D(o),w&&w.l(o),p=D(o),B(c.$$.fragment,o),d=D(o),B(s.$$.fragment,o)},m(o,C){A(t,o,C),y(o,e,C),A(a,o,C),y(o,r,C),A(g,o,C),y(o,l,C),w&&w.m(o,C),y(o,p,C),A(c,o,C),y(o,d,C),A(s,o,C),_=!0},p(o,[C]){const ie={};!i&&C&5&&(i=!0,ie.value=o[2].criticalIssues[o[0]].criticalIssue,O(()=>i=!1)),t.$set(ie);const se={};!m&&C&5&&(m=!0,se.value=o[2].criticalIssues[o[0]].stage,O(()=>m=!1)),a.$set(se);const ae={};!u&&C&5&&(u=!0,ae.value=o[2].criticalIssues[o[0]].locationName,O(()=>u=!1)),g.$set(ae),o[1]&&o[1]!="Loading"&&o[1]!=o[2].criticalIssues[o[0]].locationName?w?(w.p(o,C),C&7&&v(w,1)):(w=ce(o),w.c(),v(w,1),w.m(p.parentNode,p)):w&&(J(),k(w,1,1,()=>{w=null}),K());const le={};!f&&C&5&&(f=!0,le.value=o[2].criticalIssues[o[0]].resolved,O(()=>f=!1)),c.$set(le);const re={};!h&&C&5&&(h=!0,re.value=o[2].criticalIssues[o[0]].notes,O(()=>h=!1)),s.$set(re)},i(o){_||(v(t.$$.fragment,o),v(a.$$.fragment,o),v(g.$$.fragment,o),v(w),v(c.$$.fragment,o),v(s.$$.fragment,o),_=!0)},o(o){k(t.$$.fragment,o),k(a.$$.fragment,o),k(g.$$.fragment,o),k(w),k(c.$$.fragment,o),k(s.$$.fragment,o),_=!1},d(o){o&&(b(e),b(r),b(l),b(p),b(d)),S(t,o),S(a,o),S(g,o),w&&w.d(o),S(c,o),S(s,o)}}}function Je(n,t,i){let e;be(n,W,s=>i(2,e=s));let{idx:a}=t,m=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],r="Loading";Q(async()=>{await g(e.criticalIssues[a].point)});async function g(s){let h=`https://nominatim.openstreetmap.org/reverse?lon=${s[0]}&lat=${s[1]}&format=json`;try{let $=await(await fetch(h)).json();i(1,r=$.address.road??$.display_name)}catch(_){return console.log(`Location lookup failed: ${_}`),""}}function u(){he(W,e.criticalIssues[a].locationName=r,e)}function l(s){n.$$.not_equal(e.criticalIssues[a].criticalIssue,s)&&(e.criticalIssues[a].criticalIssue=s,W.set(e))}function p(s){n.$$.not_equal(e.criticalIssues[a].stage,s)&&(e.criticalIssues[a].stage=s,W.set(e))}function c(s){n.$$.not_equal(e.criticalIssues[a].locationName,s)&&(e.criticalIssues[a].locationName=s,W.set(e))}function f(s){n.$$.not_equal(e.criticalIssues[a].resolved,s)&&(e.criticalIssues[a].resolved=s,W.set(e))}function d(s){n.$$.not_equal(e.criticalIssues[a].notes,s)&&(e.criticalIssues[a].notes=s,W.set(e))}return n.$$set=s=>{"idx"in s&&i(0,a=s.idx)},[a,r,e,m,u,l,p,c,f,d]}class Ke extends X{constructor(t){super(),x(this,t,Je,He,Z,{idx:0})}}function ue(n,t,i){const e=n.slice();return e[13]=t[i],e[14]=t,e[15]=i,e}function pe(n,t,i){const e=n.slice();return e[13]=t[i],e}function ze(n){let t,i,e,a,m,r,g,u,l,p;return m=new Te({props:{$$slots:{default:[Ze]},$$scope:{ctx:n}}}),m.$on("click",n[7]),g=new Ae({props:{$$slots:{default:[Qe]},$$scope:{ctx:n}}}),g.$on("click",n[4]),l=new Ke({props:{idx:n[1]}}),{c(){t=q("p"),i=M("Editing "),e=M(n[1]),a=L(),E(m.$$.fragment),r=L(),E(g.$$.fragment),u=L(),E(l.$$.fragment)},l(c){t=F(c,"P",{});var f=U(t);i=T(f,"Editing "),e=T(f,n[1]),f.forEach(b),a=D(c),B(m.$$.fragment,c),r=D(c),B(g.$$.fragment,c),u=D(c),B(l.$$.fragment,c)},m(c,f){y(c,t,f),N(t,i),N(t,e),y(c,a,f),A(m,c,f),y(c,r,f),A(g,c,f),y(c,u,f),A(l,c,f),p=!0},p(c,f){(!p||f&2)&&H(e,c[1]);const d={};f&262144&&(d.$$scope={dirty:f,ctx:c}),m.$set(d);const s={};f&262144&&(s.$$scope={dirty:f,ctx:c}),g.$set(s);const h={};f&2&&(h.idx=c[1]),l.$set(h)},i(c){p||(v(m.$$.fragment,c),v(g.$$.fragment,c),v(l.$$.fragment,c),p=!0)},o(c){k(m.$$.fragment,c),k(g.$$.fragment,c),k(l.$$.fragment,c),p=!1},d(c){c&&(b(t),b(a),b(r),b(u)),S(m,c),S(g,c),S(l,c)}}}function Ye(n){let t,i,e,a,m,r,g,u="Click the map to add a pin, or click a pin to fill out data",l,p,c;t=new ke({props:{$$slots:{default:[Xe]},$$scope:{ctx:n}}}),t.$on("click",n[6]),e=new We({}),m=new je({});let f=z(n[2].criticalIssues),d=[];for(let s=0;s<f.length;s+=1)d[s]=me(pe(n,f,s));return{c(){E(t.$$.fragment),i=L(),E(e.$$.fragment),a=L(),E(m.$$.fragment),r=L(),g=q("p"),g.textContent=u,l=L(),p=q("ol");for(let s=0;s<d.length;s+=1)d[s].c()},l(s){B(t.$$.fragment,s),i=D(s),B(e.$$.fragment,s),a=D(s),B(m.$$.fragment,s),r=D(s),g=F(s,"P",{"data-svelte-h":!0}),De(g)!=="svelte-1rxcdnm"&&(g.textContent=u),l=D(s),p=F(s,"OL",{});var h=U(p);for(let _=0;_<d.length;_+=1)d[_].l(h);h.forEach(b)},m(s,h){A(t,s,h),y(s,i,h),A(e,s,h),y(s,a,h),A(m,s,h),y(s,r,h),y(s,g,h),y(s,l,h),y(s,p,h);for(let _=0;_<d.length;_+=1)d[_]&&d[_].m(p,null);c=!0},p(s,h){const _={};if(h&262144&&(_.$$scope={dirty:h,ctx:s}),t.$set(_),h&4){f=z(s[2].criticalIssues);let $;for($=0;$<f.length;$+=1){const I=pe(s,f,$);d[$]?d[$].p(I,h):(d[$]=me(I),d[$].c(),d[$].m(p,null))}for(;$<d.length;$+=1)d[$].d(1);d.length=f.length}},i(s){c||(v(t.$$.fragment,s),v(e.$$.fragment,s),v(m.$$.fragment,s),c=!0)},o(s){k(t.$$.fragment,s),k(e.$$.fragment,s),k(m.$$.fragment,s),c=!1},d(s){s&&(b(i),b(a),b(r),b(g),b(l),b(p)),S(t,s),S(e,s),S(m,s),ve(d,s)}}}function Ze(n){let t;return{c(){t=M("Save")},l(i){t=T(i,"Save")},m(i,e){y(i,t,e)},d(i){i&&b(t)}}}function Qe(n){let t;return{c(){t=M("Delete")},l(i){t=T(i,"Delete")},m(i,e){y(i,t,e)},d(i){i&&b(t)}}}function Xe(n){let t;return{c(){t=M("Zoom to fit")},l(i){t=T(i,"Zoom to fit")},m(i,e){y(i,t,e)},d(i){i&&b(t)}}}function me(n){let t,i,e=n[13].criticalIssue+"",a,m,r=n[13].stage+"",g,u,l=n[13].locationName+"",p,c;return{c(){t=q("li"),i=M("Critical issue: type="),a=M(e),m=M(", stage="),g=M(r),u=M(", at "),p=M(l),c=L()},l(f){t=F(f,"LI",{});var d=U(t);i=T(d,"Critical issue: type="),a=T(d,e),m=T(d,", stage="),g=T(d,r),u=T(d,", at "),p=T(d,l),c=D(d),d.forEach(b)},m(f,d){y(f,t,d),N(t,i),N(t,a),N(t,m),N(t,g),N(t,u),N(t,p),N(t,c)},p(f,d){d&4&&e!==(e=f[13].criticalIssue+"")&&H(a,e),d&4&&r!==(r=f[13].stage+"")&&H(g,r),d&4&&l!==(l=f[13].locationName+"")&&H(p,l)},d(f){f&&b(t)}}}function ge(n){let t;return{c(){t=q("div"),this.h()},l(i){t=F(i,"DIV",{class:!0}),U(t).forEach(b),this.h()},h(){Le(t,"class","block-map svelte-13rr2mh")},m(i,e){y(i,t,e)},d(i){i&&b(t)}}}function de(n){let t,i,e;function a(u){n[8](u,n[13])}function m(){return n[9](n[15])}function r(){return n[10](n[15])}let g={map:n[0]};return n[13].point!==void 0&&(g.position=n[13].point),t=new Re({props:g}),V.push(()=>R(t,"position",a)),t.$on("click",m),t.$on("dragEnd",r),{c(){E(t.$$.fragment)},l(u){B(t.$$.fragment,u)},m(u,l){A(t,u,l),e=!0},p(u,l){n=u;const p={};l&1&&(p.map=n[0]),!i&&l&4&&(i=!0,p.position=n[13].point,O(()=>i=!1)),t.$set(p)},i(u){e||(v(t.$$.fragment,u),e=!0)},o(u){k(t.$$.fragment,u),e=!1},d(u){S(t,u)}}}function $e(n){let t,i;return t=new Ge({props:{data:Y(n[2].criticalIssues[n[1]].point),$$slots:{default:[xe]},$$scope:{ctx:n}}}),{c(){E(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,a){A(t,e,a),i=!0},p(e,a){const m={};a&6&&(m.data=Y(e[2].criticalIssues[e[1]].point)),a&262144&&(m.$$scope={dirty:a,ctx:e}),t.$set(m)},i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){k(t.$$.fragment,e),i=!1},d(e){S(t,e)}}}function xe(n){let t,i;return t=new Ve({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){E(t.$$.fragment)},l(e){B(t.$$.fragment,e)},m(e,a){A(t,e,a),i=!0},p:Ee,i(e){i||(v(t.$$.fragment,e),i=!0)},o(e){k(t.$$.fragment,e),i=!1},d(e){S(t,e)}}}function et(n){let t,i,e,a,m=z(n[2].criticalIssues),r=[];for(let l=0;l<m.length;l+=1)r[l]=de(ue(n,m,l));const g=l=>k(r[l],1,1,()=>{r[l]=null});let u=n[1]!=null&&$e(n);return e=new qe({props:{map:n[0]}}),{c(){for(let l=0;l<r.length;l+=1)r[l].c();t=L(),u&&u.c(),i=L(),E(e.$$.fragment)},l(l){for(let p=0;p<r.length;p+=1)r[p].l(l);t=D(l),u&&u.l(l),i=D(l),B(e.$$.fragment,l)},m(l,p){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(l,p);y(l,t,p),u&&u.m(l,p),y(l,i,p),A(e,l,p),a=!0},p(l,p){if(p&13){m=z(l[2].criticalIssues);let f;for(f=0;f<m.length;f+=1){const d=ue(l,m,f);r[f]?(r[f].p(d,p),v(r[f],1)):(r[f]=de(d),r[f].c(),v(r[f],1),r[f].m(t.parentNode,t))}for(J(),f=m.length;f<r.length;f+=1)g(f);K()}l[1]!=null?u?(u.p(l,p),p&2&&v(u,1)):(u=$e(l),u.c(),v(u,1),u.m(i.parentNode,i)):u&&(J(),k(u,1,1,()=>{u=null}),K());const c={};p&1&&(c.map=l[0]),e.$set(c)},i(l){if(!a){for(let p=0;p<m.length;p+=1)v(r[p]);v(u),v(e.$$.fragment,l),a=!0}},o(l){r=r.filter(Boolean);for(let p=0;p<r.length;p+=1)k(r[p]);k(u),k(e.$$.fragment,l),a=!1},d(l){l&&(b(t),b(i)),ve(r,l),u&&u.d(l),S(e,l)}}}function tt(n){let t,i,e,a,m,r,g,u,l,p;const c=[Ye,ze],f=[];function d($,I){return $[1]==null?0:1}e=d(n),a=f[e]=c[e](n);let s=n[1]!=null&&ge();function h($){n[11]($)}let _={$$slots:{default:[et]},$$scope:{ctx:n}};return n[0]!==void 0&&(_.map=n[0]),u=new Fe({props:_}),V.push(()=>R(u,"map",h)),{c(){t=q("div"),i=q("div"),a.c(),m=L(),r=q("div"),s&&s.c(),g=L(),E(u.$$.fragment),this.h()},l($){t=F($,"DIV",{style:!0});var I=U(t);i=F(I,"DIV",{style:!0});var j=U(i);a.l(j),j.forEach(b),m=D(I),r=F(I,"DIV",{style:!0});var P=U(r);s&&s.l(P),g=D(P),B(u.$$.fragment,P),P.forEach(b),I.forEach(b),this.h()},h(){G(i,"width","30%"),G(i,"overflow-y","scroll"),G(i,"padding","10px"),G(r,"position","relative"),G(r,"width","70%"),G(t,"display","flex"),G(t,"height","600px")},m($,I){y($,t,I),N(t,i),f[e].m(i,null),N(t,m),N(t,r),s&&s.m(r,null),N(r,g),A(u,r,null),p=!0},p($,[I]){let j=e;e=d($),e===j?f[e].p($,I):(J(),k(f[j],1,1,()=>{f[j]=null}),K(),a=f[e],a?a.p($,I):(a=f[e]=c[e]($),a.c()),v(a,1),a.m(i,null)),$[1]!=null?s||(s=ge(),s.c(),s.m(r,g)):s&&(s.d(1),s=null);const P={};I&262151&&(P.$$scope={dirty:I,ctx:$}),!l&&I&1&&(l=!0,P.map=$[0],O(()=>l=!1)),u.$set(P)},i($){p||(v(a),v(u.$$.fragment,$),p=!0)},o($){k(a),k(u.$$.fragment,$),p=!1},d($){$&&b(t),f[e].d(),s&&s.d(),S(u)}}}function Y(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function nt(n,t,i){let e;be(n,W,_=>i(2,e=_));let a,m=null;function r(_){i(1,m=_)}function g(_){he(W,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:_.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),i(1,m=e.criticalIssues.length-1)}Q(()=>{a.on("click",g),l()}),_e(()=>{a.off("click",g)});function u(){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(m,1),W.set(e),i(1,m=null))}function l(_){if(e.criticalIssues.length>0){let $={type:"FeatureCollection",features:e.criticalIssues.map(I=>Y(I.point))};a.fitBounds(Pe($),{padding:20,animate:!0})}}const p=()=>l(),c=()=>i(1,m=null);function f(_,$){n.$$.not_equal($.point,_)&&($.point=_,W.set(e))}const d=_=>r(_),s=_=>r(_);function h(_){a=_,i(0,a)}return[a,m,e,r,u,l,p,c,f,d,s,h]}class _t extends X{constructor(t){super(),x(this,t,nt,tt,Z,{})}}export{_t as component};
