import{s as ne,l as Ee,e as Q,c as U,b as F,f as $,r as S,v as P,i as B,a9 as oe,x as N,u as Se,m as Be,o as Me,Z as Ce,z as ze,a7 as Ae,k as Y,M as ee,Q as se,R as re,h as J,n as te,A as T,a as I,g as q,B as G,q as pe,U as De,a8 as Ie,t as he,d as be}from"../chunks/scheduler.DGmwKwHE.js";import{S as ae,i as le,t as y,b as j,f as Z,c as M,a as C,m as z,e as ve,d as A,g as Le}from"../chunks/index.Bb3HzqPI.js";import{e as x}from"../chunks/each.5Jij472k.js";import{p as ie}from"../chunks/index.Dho2S1sk.js";import{b as qe}from"../chunks/colors.cXDjJPjh.js";import{S as Ne,W as Pe}from"../chunks/WarningButton.CmTmvDGe.js";import{S as fe}from"../chunks/Select.BxvsumuS.js";import{T as Fe}from"../chunks/TextInput.BGWXu-yq.js";import{t as Oe,L as Te}from"../chunks/LineLayer.B5qvS006.js";import{u as Ge,a as Ze,M as Ke,G as Re}from"../chunks/MapLibreMap.5LQGw9kP.js";import{s as D}from"../chunks/data.CfXP5CZZ.js";function Ve(t){let e,l,n,a,s,b,i;const r=t[18].default,_=Ee(r,t,t[17],null);return{c(){e=Q("div"),_&&_.c(),this.h()},l(u){e=U(u,"DIV",{tabindex:!0,role:!0});var o=F(e);_&&_.l(o),o.forEach($),this.h()},h(){S(e,"tabindex",l=t[1]?0:void 0),S(e,"role",n=t[1]?"button":void 0),P(e,"z-index",t[2])},m(u,o){B(u,e,o),_&&_.m(e,null),s=!0,b||(i=[oe(t[6].call(null,e)),oe(a=We.call(null,e,t[0])),N(e,"click",t[19]),N(e,"dblclick",t[20]),N(e,"contextmenu",t[21]),N(e,"mouseenter",t[22]),N(e,"mouseleave",t[23]),N(e,"mousemove",t[24]),N(e,"keydown",t[7])],b=!0)},p(u,[o]){_&&_.p&&(!s||o&131072)&&Se(_,r,u,u[17],s?Me(r,u[17],o,null):Be(u[17]),null),(!s||o&2&&l!==(l=u[1]?0:void 0))&&S(e,"tabindex",l),(!s||o&2&&n!==(n=u[1]?"button":void 0))&&S(e,"role",n),a&&Ce(a.update)&&o&1&&a.update.call(null,u[0]),o&4&&P(e,"z-index",u[2])},i(u){s||(y(_,u),s=!0)},o(u){j(_,u),s=!1},d(u){u&&$(e),_&&_.d(u),b=!1,ze(i)}}}function We(t,e){const l=t.className;function n(a){a?t.className=`${l} ${a}`:t.className=l}return n(e),{update:n}}function Je(t,e,l){let n,a,s,{$$slots:b={},$$scope:i}=e,{lngLat:r}=e,{class:_=void 0}=e,{interactive:u=!0}=e,{asButton:o=!1}=e,{draggable:c=!1}=e,{feature:k=null}=e,{offset:f=void 0}=e,{zIndex:d=void 0}=e,{rotation:v=0}=e,{opacity:w=1}=e;const g=Ae(),{map:p,layerEvent:K,self:h}=Ge();Y(t,p,m=>l(26,s=m)),Y(t,K,m=>l(25,n=m)),Y(t,h,m=>l(16,a=m));function L(m){ee(h,a=new Ze.Marker({element:m,rotation:v,draggable:c,offset:f,opacity:w.toString()}).setLngLat(r).addTo(s),a);const O=()=>E("dragstart"),V=()=>{R(),E("drag")},W=()=>{R(),E("dragend")};return c&&(a.on("dragstart",O),a.on("drag",V),a.on("dragend",W)),{destroy(){c&&(a==null||a.off("dragstart",O),a==null||a.off("drag",V),a==null||a.off("dragend",W)),a==null||a.remove()}}}function R(){let m=a==null?void 0:a.getLngLat();m&&(Array.isArray(r)?l(9,r=[m.lng,m.lat]):r&&"lon"in r?l(9,r={lon:m.lng,lat:m.lat}):l(9,r=m))}function H(m){m.key===" "&&(m.preventDefault(),m.stopPropagation(),E("click"))}function E(m){if(!u)return;let O=a==null?void 0:a.getLngLat();if(!O)return;const V=[O.lng,O.lat];let W={map:s,marker:a,lngLat:V,features:[{type:"Feature",properties:(k==null?void 0:k.properties)??{},geometry:{type:"Point",coordinates:V}}]};ee(K,n={...W,layerType:"marker",type:m},n),g(m,W)}const X=()=>E("click"),$e=()=>E("dblclick"),ke=()=>E("contextmenu"),ye=m=>{E("mouseenter")},we=()=>{E("mouseleave")},je=()=>E("mousemove");return t.$$set=m=>{"lngLat"in m&&l(9,r=m.lngLat),"class"in m&&l(0,_=m.class),"interactive"in m&&l(10,u=m.interactive),"asButton"in m&&l(1,o=m.asButton),"draggable"in m&&l(11,c=m.draggable),"feature"in m&&l(12,k=m.feature),"offset"in m&&l(13,f=m.offset),"zIndex"in m&&l(2,d=m.zIndex),"rotation"in m&&l(14,v=m.rotation),"opacity"in m&&l(15,w=m.opacity),"$$scope"in m&&l(17,i=m.$$scope)},t.$$.update=()=>{t.$$.dirty&66048&&(a==null||a.setLngLat(r)),t.$$.dirty&73728&&(a==null||a.setOffset(f??[0,0])),t.$$.dirty&81920&&(a==null||a.setRotation(v)),t.$$.dirty&98304&&(a==null||a.setOpacity(w.toString()))},[_,o,d,p,K,h,L,H,E,r,u,c,k,f,v,w,a,i,b,X,$e,ke,ye,we,je]}class ue extends ae{constructor(e){super(),le(this,e,Je,Ve,ne,{lngLat:9,class:0,interactive:10,asButton:1,draggable:11,feature:12,offset:13,zIndex:2,rotation:14,opacity:15})}}function ce(t){return Oe(t)}function Qe(t){let e,l;return{c(){e=se("svg"),l=se("polygon"),this.h()},l(n){e=re(n,"svg",{width:!0,height:!0,xmlns:!0});var a=F(e);l=re(a,"polygon",{points:!0,fill:!0,class:!0}),F(l).forEach($),a.forEach($),this.h()},h(){S(l,"points","15,0 0,30 30,30"),S(l,"fill",t[0]),S(l,"class","svelte-19rpncr"),S(e,"width","30"),S(e,"height","30"),S(e,"xmlns","http://www.w3.org/2000/svg")},m(n,a){B(n,e,a),J(e,l)},p(n,[a]){a&1&&S(l,"fill",n[0])},i:te,o:te,d(n){n&&$(e)}}}function Ue(t,e,l){let{color:n}=e;return t.$$set=a=>{"color"in a&&l(0,n=a.color)},[n]}class He extends ae{constructor(e){super(),le(this,e,Ue,Qe,ne,{color:0})}}function ge(t,e,l){const n=t.slice();return n[15]=e[l],n[16]=e,n[17]=l,n}function me(t,e,l){const n=t.slice();return n[15]=e[l],n[18]=e,n[19]=l,n}function Xe(t){let e;return{c(){e=he("Zoom to fit")},l(l){e=be(l,"Zoom to fit")},m(l,n){B(l,e,n)},d(l){l&&$(e)}}}function Ye(t){let e,l;return{c(){e=Q("span"),this.h()},l(n){e=U(n,"SPAN",{class:!0,style:!0}),F(e).forEach($),this.h()},h(){S(e,"class","dot svelte-1tmbx1c"),S(e,"style",l=`background-color: ${t[15].color}`)},m(n,a){B(n,e,a)},p(n,a){a&2&&l!==(l=`background-color: ${n[15].color}`)&&S(e,"style",l)},d(n){n&&$(e)}}}function xe(t){let e,l;return e=new He({props:{color:t[15].color}}),{c(){M(e.$$.fragment)},l(n){C(e.$$.fragment,n)},m(n,a){z(e,n,a),l=!0},p(n,a){const s={};a&2&&(s.color=n[15].color),e.$set(s)},i(n){l||(y(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){A(e,n)}}}function _e(t){let e,l,n,a,s,b;function i(o){t[7](o,t[15])}let r={draggable:!0,$$slots:{default:[Ye]},$$scope:{ctx:t}};t[15].point1!==void 0&&(r.lngLat=t[15].point1),e=new ue({props:r}),T.push(()=>Z(e,"lngLat",i));function _(o){t[8](o,t[15])}let u={draggable:!0,$$slots:{default:[xe]},$$scope:{ctx:t}};return t[15].point2!==void 0&&(u.lngLat=t[15].point2),a=new ue({props:u}),T.push(()=>Z(a,"lngLat",_)),{c(){M(e.$$.fragment),n=I(),M(a.$$.fragment)},l(o){C(e.$$.fragment,o),n=q(o),C(a.$$.fragment,o)},m(o,c){z(e,o,c),B(o,n,c),z(a,o,c),b=!0},p(o,c){t=o;const k={};c&1048578&&(k.$$scope={dirty:c,ctx:t}),!l&&c&2&&(l=!0,k.lngLat=t[15].point1,G(()=>l=!1)),e.$set(k);const f={};c&1048578&&(f.$$scope={dirty:c,ctx:t}),!s&&c&2&&(s=!0,f.lngLat=t[15].point2,G(()=>s=!1)),a.$set(f)},i(o){b||(y(e.$$.fragment,o),y(a.$$.fragment,o),b=!0)},o(o){j(e.$$.fragment,o),j(a.$$.fragment,o),b=!1},d(o){o&&$(n),A(e,o),A(a,o)}}}function et(t){let e,l;return e=new Te({props:{paint:{"line-width":6,"line-color":["get","color"]}}}),{c(){M(e.$$.fragment)},l(n){C(e.$$.fragment,n)},m(n,a){z(e,n,a),l=!0},p:te,i(n){l||(y(e.$$.fragment,n),l=!0)},o(n){j(e.$$.fragment,n),l=!1},d(n){A(e,n)}}}function tt(t){let e,l,n,a=x(t[1].jat.movements),s=[];for(let i=0;i<a.length;i+=1)s[i]=_e(me(t,a,i));const b=i=>j(s[i],1,1,()=>{s[i]=null});return l=new Re({props:{data:t[4](t[1].jat.movements),$$slots:{default:[et]},$$scope:{ctx:t}}}),{c(){for(let i=0;i<s.length;i+=1)s[i].c();e=I(),M(l.$$.fragment)},l(i){for(let r=0;r<s.length;r+=1)s[r].l(i);e=q(i),C(l.$$.fragment,i)},m(i,r){for(let _=0;_<s.length;_+=1)s[_]&&s[_].m(i,r);B(i,e,r),z(l,i,r),n=!0},p(i,r){if(r&2){a=x(i[1].jat.movements);let u;for(u=0;u<a.length;u+=1){const o=me(i,a,u);s[u]?(s[u].p(o,r),y(s[u],1)):(s[u]=_e(o),s[u].c(),y(s[u],1),s[u].m(e.parentNode,e))}for(Le(),u=a.length;u<s.length;u+=1)b(u);ve()}const _={};r&2&&(_.data=i[4](i[1].jat.movements)),r&1048576&&(_.$$scope={dirty:r,ctx:i}),l.$set(_)},i(i){if(!n){for(let r=0;r<a.length;r+=1)y(s[r]);y(l.$$.fragment,i),n=!0}},o(i){s=s.filter(Boolean);for(let r=0;r<s.length;r+=1)j(s[r]);j(l.$$.fragment,i),n=!1},d(i){i&&$(e),pe(s,i),A(l,i)}}}function nt(t){let e;return{c(){e=he("Delete")},l(l){e=be(l,"Delete")},m(l,n){B(l,e,n)},d(l){l&&$(e)}}}function de(t){let e,l,n,a,s,b,i,r,_,u,o,c,k;function f(h){t[10](h,t[15])}let d={label:"Name"};t[15].name!==void 0&&(d.value=t[15].name),l=new Fe({props:d}),T.push(()=>Z(l,"value",f));function v(h){t[11](h,t[15])}let w={label:"Kind",choices:t[2]};t[15].kind!==void 0&&(w.value=t[15].kind),s=new fe({props:w}),T.push(()=>Z(s,"value",v));function g(h){t[12](h,t[15])}let p={label:"Color",choices:t[3]};t[15].color!==void 0&&(p.value=t[15].color),r=new fe({props:p}),T.push(()=>Z(r,"value",g));function K(){return t[13](t[17])}return o=new Pe({props:{$$slots:{default:[nt]},$$scope:{ctx:t}}}),o.$on("click",K),{c(){e=Q("li"),M(l.$$.fragment),a=I(),M(s.$$.fragment),i=I(),M(r.$$.fragment),u=I(),M(o.$$.fragment),c=I(),this.h()},l(h){e=U(h,"LI",{style:!0});var L=F(e);C(l.$$.fragment,L),a=q(L),C(s.$$.fragment,L),i=q(L),C(r.$$.fragment,L),u=q(L),C(o.$$.fragment,L),c=q(L),L.forEach($),this.h()},h(){P(e,"display","flex"),P(e,"justify-content","space-evenly")},m(h,L){B(h,e,L),z(l,e,null),J(e,a),z(s,e,null),J(e,i),z(r,e,null),J(e,u),z(o,e,null),J(e,c),k=!0},p(h,L){t=h;const R={};!n&&L&2&&(n=!0,R.value=t[15].name,G(()=>n=!1)),l.$set(R);const H={};!b&&L&2&&(b=!0,H.value=t[15].kind,G(()=>b=!1)),s.$set(H);const E={};!_&&L&2&&(_=!0,E.value=t[15].color,G(()=>_=!1)),r.$set(E);const X={};L&1048576&&(X.$$scope={dirty:L,ctx:t}),o.$set(X)},i(h){k||(y(l.$$.fragment,h),y(s.$$.fragment,h),y(r.$$.fragment,h),y(o.$$.fragment,h),k=!0)},o(h){j(l.$$.fragment,h),j(s.$$.fragment,h),j(r.$$.fragment,h),j(o.$$.fragment,h),k=!1},d(h){h&&$(e),A(l),A(s),A(r),A(o)}}}function at(t){let e,l,n,a,s,b,i,r;e=new Ne({props:{$$slots:{default:[Xe]},$$scope:{ctx:t}}}),e.$on("click",t[6]);function _(f){t[9](f)}let u={$$slots:{default:[tt]},$$scope:{ctx:t}};t[0]!==void 0&&(u.map=t[0]),a=new Ke({props:u}),T.push(()=>Z(a,"map",_));let o=x(t[1].jat.movements),c=[];for(let f=0;f<o.length;f+=1)c[f]=de(ge(t,o,f));const k=f=>j(c[f],1,1,()=>{c[f]=null});return{c(){M(e.$$.fragment),l=I(),n=Q("div"),M(a.$$.fragment),b=I(),i=Q("ol");for(let f=0;f<c.length;f+=1)c[f].c();this.h()},l(f){C(e.$$.fragment,f),l=q(f),n=U(f,"DIV",{style:!0});var d=F(n);C(a.$$.fragment,d),d.forEach($),b=q(f),i=U(f,"OL",{});var v=F(i);for(let w=0;w<c.length;w+=1)c[w].l(v);v.forEach($),this.h()},h(){P(n,"position","relative"),P(n,"width","100%"),P(n,"height","600px")},m(f,d){z(e,f,d),B(f,l,d),B(f,n,d),z(a,n,null),B(f,b,d),B(f,i,d);for(let v=0;v<c.length;v+=1)c[v]&&c[v].m(i,null);r=!0},p(f,[d]){const v={};d&1048576&&(v.$$scope={dirty:d,ctx:f}),e.$set(v);const w={};if(d&1048578&&(w.$$scope={dirty:d,ctx:f}),!s&&d&1&&(s=!0,w.map=f[0],G(()=>s=!1)),a.$set(w),d&46){o=x(f[1].jat.movements);let g;for(g=0;g<o.length;g+=1){const p=ge(f,o,g);c[g]?(c[g].p(p,d),y(c[g],1)):(c[g]=de(p),c[g].c(),y(c[g],1),c[g].m(i,null))}for(Le(),g=o.length;g<c.length;g+=1)k(g);ve()}},i(f){if(!r){y(e.$$.fragment,f),y(a.$$.fragment,f);for(let d=0;d<o.length;d+=1)y(c[d]);r=!0}},o(f){j(e.$$.fragment,f),j(a.$$.fragment,f),c=c.filter(Boolean);for(let d=0;d<c.length;d+=1)j(c[d]);r=!1},d(f){f&&($(l),$(n),$(b),$(i)),A(e,f),A(a),pe(c,f)}}}function lt(t,e,l){let n;Y(t,D,g=>l(1,n=g));let a,s=ie(["cycling-straight","cycling-turn","pedestrian"]),b=ie(["green","amber","red","critical"]);function i(g){ee(D,n.jat.movements=[...n.jat.movements,{point1:g.lngLat.toArray(),point2:g.lngLat.toArray(),kind:"cycling-straight",color:"green",name:"",notes:""}],n)}De(()=>{a.on("click",i),n.jat.movements.length>0&&a.fitBounds(ce(r(n.jat.movements)),{padding:20,animate:!1})}),Ie(()=>{a.off("click",i)});function r(g){return{type:"FeatureCollection",features:g.map(p=>({type:"Feature",properties:{kind:p.kind,color:qe[p.color].background},geometry:{type:"LineString",coordinates:[p.point1,p.point2]}}))}}function _(g){n.jat.movements.splice(g,1),D.set(n)}function u(){n.jat.movements.length>0&&a.fitBounds(ce(r(n.jat.movements)),{padding:20,animate:!0})}function o(g,p){t.$$.not_equal(p.point1,g)&&(p.point1=g,D.set(n))}function c(g,p){t.$$.not_equal(p.point2,g)&&(p.point2=g,D.set(n))}function k(g){a=g,l(0,a)}function f(g,p){t.$$.not_equal(p.name,g)&&(p.name=g,D.set(n))}function d(g,p){t.$$.not_equal(p.kind,g)&&(p.kind=g,D.set(n))}function v(g,p){t.$$.not_equal(p.color,g)&&(p.color=g,D.set(n))}return[a,n,s,b,r,_,u,o,c,k,f,d,v,g=>_(g)]}class pt extends ae{constructor(e){super(),le(this,e,lt,at,ne,{})}}export{pt as component};
