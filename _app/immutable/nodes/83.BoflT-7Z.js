import{s as we,v as Y,e as K,t as le,a as N,c as z,b as J,d as ie,f as v,g as D,r as W,w as X,i as I,h as U,x as Z,k as Ce,z as He,U as Ke,N as Be,E as _e,p as ve,q as ge,j as he,n as ze,R as be,S as ke}from"../chunks/scheduler.BV_JqZpr.js";import{S as Le,i as Ie,e as Q,c as q,a as j,m as M,t as C,b as S,d as P,f as ae,g as fe}from"../chunks/index.DDJL-Wug.js";import{M as Je,g as Ye,G as Ze}from"../chunks/MapLibreMap.CrdVPIM5.js";import{e as re}from"../chunks/each.Cp9qZMvj.js";import{c as Qe,p as Xe}from"../chunks/colors.CYEpEtTL.js";import{p as Ge}from"../chunks/index.CxH7ze3R.js";import{S as me}from"../chunks/Select.C1vp33wH.js";import{T as We}from"../chunks/TextArea.e-LUVmrn.js";import{T as Re}from"../chunks/TextInput.Daolq3gG.js";import{s as O}from"../chunks/data.CpSBfHOd.js";import{s as $e,b as de,a as xe,R as et,B as tt,G as nt,M as lt,c as it,S as ot,d as Oe,C as st}from"../chunks/GeoreferenceLayer.j1vtpAuJ.js";import{Y as Ue}from"../chunks/YesNo.Ck_62BUo.js";import{C as rt}from"../chunks/CollapsibleCard.UC1DOObh.js";import{D as at}from"../chunks/DefaultButton.DCHkaEOp.js";import{W as ft,S as Se}from"../chunks/WarningButton.Ck9VEuu1.js";function ct(t){let e,l,n,i,c,f,r,a,p,s,m,d,g,T,u,$,b,E,h,V,R,L,ee,F;function A(o){t[3](o)}let oe={label:"Critical Issue",emptyOption:!0,choices:t[2]};t[1].criticalIssues[t[0]].criticalIssue!==void 0&&(oe.value=t[1].criticalIssues[t[0]].criticalIssue),s=new me({props:oe}),Y.push(()=>Q(s,"value",A));function _(o){t[4](o)}let y={label:"Stage",emptyOption:!0,choices:Ge(["Existing","Design"])};t[1].criticalIssues[t[0]].stage!==void 0&&(y.value=t[1].criticalIssues[t[0]].stage),g=new me({props:y}),Y.push(()=>Q(g,"value",_));function G(o){t[5](o)}let H={label:"Location Name"};t[1].criticalIssues[t[0]].locationName!==void 0&&(H.value=t[1].criticalIssues[t[0]].locationName),$=new Re({props:H}),Y.push(()=>Q($,"value",G));function B(o){t[6](o)}let k={label:"Resolved by Design"};t[1].criticalIssues[t[0]].resolved!==void 0&&(k.value=t[1].criticalIssues[t[0]].resolved),h=new Ue({props:k}),Y.push(()=>Q(h,"value",B));function x(o){t[7](o)}let se={label:"Commentary & Feedback"};return t[1].criticalIssues[t[0]].notes!==void 0&&(se.value=t[1].criticalIssues[t[0]].notes),L=new We({props:se}),Y.push(()=>Q(L,"value",x)),{c(){e=K("div"),l=K("a"),n=le("Google StreetView"),c=N(),f=K("a"),r=le("Bing Streetside"),p=N(),q(s.$$.fragment),d=N(),q(g.$$.fragment),u=N(),q($.$$.fragment),E=N(),q(h.$$.fragment),R=N(),q(L.$$.fragment),this.h()},l(o){e=z(o,"DIV",{style:!0});var w=J(e);l=z(w,"A",{href:!0,target:!0});var te=J(l);n=ie(te,"Google StreetView"),te.forEach(v),c=D(w),f=z(w,"A",{href:!0,target:!0});var ne=J(f);r=ie(ne,"Bing Streetside"),ne.forEach(v),w.forEach(v),p=D(o),j(s.$$.fragment,o),d=D(o),j(g.$$.fragment,o),u=D(o),j($.$$.fragment,o),E=D(o),j(h.$$.fragment,o),R=D(o),j(L.$$.fragment,o),this.h()},h(){W(l,"href",i=$e(t[1].criticalIssues[t[0]].point)),W(l,"target","_blank"),W(f,"href",a=de(t[1].criticalIssues[t[0]].point)),W(f,"target","_blank"),X(e,"display","flex"),X(e,"justify-content","space-evenly")},m(o,w){I(o,e,w),U(e,l),U(l,n),U(e,c),U(e,f),U(f,r),I(o,p,w),M(s,o,w),I(o,d,w),M(g,o,w),I(o,u,w),M($,o,w),I(o,E,w),M(h,o,w),I(o,R,w),M(L,o,w),F=!0},p(o,[w]){(!F||w&3&&i!==(i=$e(o[1].criticalIssues[o[0]].point)))&&W(l,"href",i),(!F||w&3&&a!==(a=de(o[1].criticalIssues[o[0]].point)))&&W(f,"href",a);const te={};!m&&w&3&&(m=!0,te.value=o[1].criticalIssues[o[0]].criticalIssue,Z(()=>m=!1)),s.$set(te);const ne={};!T&&w&3&&(T=!0,ne.value=o[1].criticalIssues[o[0]].stage,Z(()=>T=!1)),g.$set(ne);const ce={};!b&&w&3&&(b=!0,ce.value=o[1].criticalIssues[o[0]].locationName,Z(()=>b=!1)),$.$set(ce);const ue={};!V&&w&3&&(V=!0,ue.value=o[1].criticalIssues[o[0]].resolved,Z(()=>V=!1)),h.$set(ue);const pe={};!ee&&w&3&&(ee=!0,pe.value=o[1].criticalIssues[o[0]].notes,Z(()=>ee=!1)),L.$set(pe)},i(o){F||(C(s.$$.fragment,o),C(g.$$.fragment,o),C($.$$.fragment,o),C(h.$$.fragment,o),C(L.$$.fragment,o),F=!0)},o(o){S(s.$$.fragment,o),S(g.$$.fragment,o),S($.$$.fragment,o),S(h.$$.fragment,o),S(L.$$.fragment,o),F=!1},d(o){o&&(v(e),v(p),v(d),v(u),v(E),v(R)),P(s,o),P(g,o),P($,o),P(h,o),P(L,o)}}}function ut(t,e,l){let n;Ce(t,O,m=>l(1,n=m));let{idx:i}=e,c=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]];function f(m){t.$$.not_equal(n.criticalIssues[i].criticalIssue,m)&&(n.criticalIssues[i].criticalIssue=m,O.set(n))}function r(m){t.$$.not_equal(n.criticalIssues[i].stage,m)&&(n.criticalIssues[i].stage=m,O.set(n))}function a(m){t.$$.not_equal(n.criticalIssues[i].locationName,m)&&(n.criticalIssues[i].locationName=m,O.set(n))}function p(m){t.$$.not_equal(n.criticalIssues[i].resolved,m)&&(n.criticalIssues[i].resolved=m,O.set(n))}function s(m){t.$$.not_equal(n.criticalIssues[i].notes,m)&&(n.criticalIssues[i].notes=m,O.set(n))}return t.$$set=m=>{"idx"in m&&l(0,i=m.idx)},[i,n,c,f,r,a,p,s]}class pt extends Le{constructor(e){super(),Ie(this,e,ut,ct,we,{idx:0})}}function _t(t){let e,l,n,i,c,f,r,a,p,s,m,d,g,T,u,$,b,E,h,V,R,L,ee,F;function A(o){t[3](o)}let oe={label:"Policy Conflict",emptyOption:!0,choices:t[2]};t[1].policyConflictLog[t[0]].conflict!==void 0&&(oe.value=t[1].policyConflictLog[t[0]].conflict),s=new me({props:oe}),Y.push(()=>Q(s,"value",A));function _(o){t[4](o)}let y={label:"Stage",emptyOption:!0,choices:Ge(["Existing","Design"])};t[1].policyConflictLog[t[0]].stage!==void 0&&(y.value=t[1].policyConflictLog[t[0]].stage),g=new me({props:y}),Y.push(()=>Q(g,"value",_));function G(o){t[5](o)}let H={label:"Location Name"};t[1].policyConflictLog[t[0]].locationName!==void 0&&(H.value=t[1].policyConflictLog[t[0]].locationName),$=new Re({props:H}),Y.push(()=>Q($,"value",G));function B(o){t[6](o)}let k={label:"Resolved by Design"};t[1].policyConflictLog[t[0]].resolved!==void 0&&(k.value=t[1].policyConflictLog[t[0]].resolved),h=new Ue({props:k}),Y.push(()=>Q(h,"value",B));function x(o){t[7](o)}let se={label:"Commentary & Feedback"};return t[1].policyConflictLog[t[0]].notes!==void 0&&(se.value=t[1].policyConflictLog[t[0]].notes),L=new We({props:se}),Y.push(()=>Q(L,"value",x)),{c(){e=K("div"),l=K("a"),n=le("Google StreetView"),c=N(),f=K("a"),r=le("Bing Streetside"),p=N(),q(s.$$.fragment),d=N(),q(g.$$.fragment),u=N(),q($.$$.fragment),E=N(),q(h.$$.fragment),R=N(),q(L.$$.fragment),this.h()},l(o){e=z(o,"DIV",{style:!0});var w=J(e);l=z(w,"A",{href:!0,target:!0});var te=J(l);n=ie(te,"Google StreetView"),te.forEach(v),c=D(w),f=z(w,"A",{href:!0,target:!0});var ne=J(f);r=ie(ne,"Bing Streetside"),ne.forEach(v),w.forEach(v),p=D(o),j(s.$$.fragment,o),d=D(o),j(g.$$.fragment,o),u=D(o),j($.$$.fragment,o),E=D(o),j(h.$$.fragment,o),R=D(o),j(L.$$.fragment,o),this.h()},h(){W(l,"href",i=$e(t[1].policyConflictLog[t[0]].point)),W(l,"target","_blank"),W(f,"href",a=de(t[1].policyConflictLog[t[0]].point)),W(f,"target","_blank"),X(e,"display","flex"),X(e,"justify-content","space-evenly")},m(o,w){I(o,e,w),U(e,l),U(l,n),U(e,c),U(e,f),U(f,r),I(o,p,w),M(s,o,w),I(o,d,w),M(g,o,w),I(o,u,w),M($,o,w),I(o,E,w),M(h,o,w),I(o,R,w),M(L,o,w),F=!0},p(o,[w]){(!F||w&3&&i!==(i=$e(o[1].policyConflictLog[o[0]].point)))&&W(l,"href",i),(!F||w&3&&a!==(a=de(o[1].policyConflictLog[o[0]].point)))&&W(f,"href",a);const te={};!m&&w&3&&(m=!0,te.value=o[1].policyConflictLog[o[0]].conflict,Z(()=>m=!1)),s.$set(te);const ne={};!T&&w&3&&(T=!0,ne.value=o[1].policyConflictLog[o[0]].stage,Z(()=>T=!1)),g.$set(ne);const ce={};!b&&w&3&&(b=!0,ce.value=o[1].policyConflictLog[o[0]].locationName,Z(()=>b=!1)),$.$set(ce);const ue={};!V&&w&3&&(V=!0,ue.value=o[1].policyConflictLog[o[0]].resolved,Z(()=>V=!1)),h.$set(ue);const pe={};!ee&&w&3&&(ee=!0,pe.value=o[1].policyConflictLog[o[0]].notes,Z(()=>ee=!1)),L.$set(pe)},i(o){F||(C(s.$$.fragment,o),C(g.$$.fragment,o),C($.$$.fragment,o),C(h.$$.fragment,o),C(L.$$.fragment,o),F=!0)},o(o){S(s.$$.fragment,o),S(g.$$.fragment,o),S($.$$.fragment,o),S(h.$$.fragment,o),S(L.$$.fragment,o),F=!1},d(o){o&&(v(e),v(p),v(d),v(u),v(E),v(R)),P(s,o),P(g,o),P($,o),P(h,o),P(L,o)}}}function gt(t,e,l){let n;Ce(t,O,m=>l(1,n=m));let{idx:i}=e,c=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]];function f(m){t.$$.not_equal(n.policyConflictLog[i].conflict,m)&&(n.policyConflictLog[i].conflict=m,O.set(n))}function r(m){t.$$.not_equal(n.policyConflictLog[i].stage,m)&&(n.policyConflictLog[i].stage=m,O.set(n))}function a(m){t.$$.not_equal(n.policyConflictLog[i].locationName,m)&&(n.policyConflictLog[i].locationName=m,O.set(n))}function p(m){t.$$.not_equal(n.policyConflictLog[i].resolved,m)&&(n.policyConflictLog[i].resolved=m,O.set(n))}function s(m){t.$$.not_equal(n.policyConflictLog[i].notes,m)&&(n.policyConflictLog[i].notes=m,O.set(n))}return t.$$set=m=>{"idx"in m&&l(0,i=m.idx)},[i,n,c,f,r,a,p,s]}class mt extends Le{constructor(e){super(),Ie(this,e,gt,_t,we,{idx:0})}}const{window:$t}=Ye;function Ee(t,e,l){const n=t.slice();return n[29]=e[l],n[30]=e,n[31]=l,n}function Ae(t,e,l){const n=t.slice();return n[32]=e[l],n[33]=e,n[31]=l,n}function Ne(t,e,l){const n=t.slice();return n[29]=e[l],n[31]=l,n}function De(t,e,l){const n=t.slice();return n[32]=e[l],n[31]=l,n}function dt(t){let e,l,n,i,c,f,r,a;e=new at({props:{$$slots:{default:[vt]},$$scope:{ctx:t}}}),e.$on("click",t[21]),n=new ft({props:{$$slots:{default:[bt]},$$scope:{ctx:t}}}),n.$on("click",t[9]);const p=[yt,kt],s=[];function m(d,g){return d[0].kind=="critical"?0:1}return c=m(t),f=s[c]=p[c](t),{c(){q(e.$$.fragment),l=N(),q(n.$$.fragment),i=N(),f.c(),r=_e()},l(d){j(e.$$.fragment,d),l=D(d),j(n.$$.fragment,d),i=D(d),f.l(d),r=_e()},m(d,g){M(e,d,g),I(d,l,g),M(n,d,g),I(d,i,g),s[c].m(d,g),I(d,r,g),a=!0},p(d,g){const T={};g[1]&32&&(T.$$scope={dirty:g,ctx:d}),e.$set(T);const u={};g[1]&32&&(u.$$scope={dirty:g,ctx:d}),n.$set(u);let $=c;c=m(d),c===$?s[c].p(d,g):(fe(),S(s[$],1,1,()=>{s[$]=null}),ae(),f=s[c],f?f.p(d,g):(f=s[c]=p[c](d),f.c()),C(f,1),f.m(r.parentNode,r))},i(d){a||(C(e.$$.fragment,d),C(n.$$.fragment,d),C(f),a=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(f),a=!1},d(d){d&&(v(l),v(i),v(r)),P(e,d),P(n,d),s[c].d(d)}}}function ht(t){let e,l,n,i,c,f,r="Click the map to add a problem, or select a problem to fill out data",a,p,s="Critical Issues",m,d,g,T,u="Policy Conflicts",$,b,E;e=new rt({props:{label:"Tools",$$slots:{default:[Ct]},$$scope:{ctx:t}}});function h(_){t[14](_)}let V={legend:"Create new problems",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};t[4]!==void 0&&(V.value=t[4]),n=new et({props:V}),Y.push(()=>Q(n,"value",h));let R=re(t[2].criticalIssues),L=[];for(let _=0;_<R.length;_+=1)L[_]=je(De(t,R,_));const ee=_=>S(L[_],1,1,()=>{L[_]=null});let F=re(t[2].policyConflictLog),A=[];for(let _=0;_<F.length;_+=1)A[_]=Me(Ne(t,F,_));const oe=_=>S(A[_],1,1,()=>{A[_]=null});return{c(){q(e.$$.fragment),l=N(),q(n.$$.fragment),c=N(),f=K("p"),f.textContent=r,a=N(),p=K("h3"),p.textContent=s,m=N(),d=K("ol");for(let _=0;_<L.length;_+=1)L[_].c();g=N(),T=K("h3"),T.textContent=u,$=N(),b=K("ol");for(let _=0;_<A.length;_+=1)A[_].c()},l(_){j(e.$$.fragment,_),l=D(_),j(n.$$.fragment,_),c=D(_),f=z(_,"P",{"data-svelte-h":!0}),ve(f)!=="svelte-12ba5j2"&&(f.textContent=r),a=D(_),p=z(_,"H3",{"data-svelte-h":!0}),ve(p)!=="svelte-1qhh5xr"&&(p.textContent=s),m=D(_),d=z(_,"OL",{});var y=J(d);for(let H=0;H<L.length;H+=1)L[H].l(y);y.forEach(v),g=D(_),T=z(_,"H3",{"data-svelte-h":!0}),ve(T)!=="svelte-eyxzjx"&&(T.textContent=u),$=D(_),b=z(_,"OL",{});var G=J(b);for(let H=0;H<A.length;H+=1)A[H].l(G);G.forEach(v)},m(_,y){M(e,_,y),I(_,l,y),M(n,_,y),I(_,c,y),I(_,f,y),I(_,a,y),I(_,p,y),I(_,m,y),I(_,d,y);for(let G=0;G<L.length;G+=1)L[G]&&L[G].m(d,null);I(_,g,y),I(_,T,y),I(_,$,y),I(_,b,y);for(let G=0;G<A.length;G+=1)A[G]&&A[G].m(b,null);E=!0},p(_,y){const G={};y[0]&40|y[1]&32&&(G.$$scope={dirty:y,ctx:_}),e.$set(G);const H={};if(!i&&y[0]&16&&(i=!0,H.value=_[4],Z(()=>i=!1)),n.$set(H),y[0]&134){R=re(_[2].criticalIssues);let B;for(B=0;B<R.length;B+=1){const k=De(_,R,B);L[B]?(L[B].p(k,y),C(L[B],1)):(L[B]=je(k),L[B].c(),C(L[B],1),L[B].m(d,null))}for(fe(),B=R.length;B<L.length;B+=1)ee(B);ae()}if(y[0]&134){F=re(_[2].policyConflictLog);let B;for(B=0;B<F.length;B+=1){const k=Ne(_,F,B);A[B]?(A[B].p(k,y),C(A[B],1)):(A[B]=Me(k),A[B].c(),C(A[B],1),A[B].m(b,null))}for(fe(),B=F.length;B<A.length;B+=1)oe(B);ae()}},i(_){if(!E){C(e.$$.fragment,_),C(n.$$.fragment,_);for(let y=0;y<R.length;y+=1)C(L[y]);for(let y=0;y<F.length;y+=1)C(A[y]);E=!0}},o(_){S(e.$$.fragment,_),S(n.$$.fragment,_),L=L.filter(Boolean);for(let y=0;y<L.length;y+=1)S(L[y]);A=A.filter(Boolean);for(let y=0;y<A.length;y+=1)S(A[y]);E=!1},d(_){_&&(v(l),v(c),v(f),v(a),v(p),v(m),v(d),v(g),v(T),v($),v(b)),P(e,_),P(n,_),ge(L,_),ge(A,_)}}}function vt(t){let e;return{c(){e=le("Save")},l(l){e=ie(l,"Save")},m(l,n){I(l,e,n)},d(l){l&&v(e)}}}function bt(t){let e;return{c(){e=le("Delete")},l(l){e=ie(l,"Delete")},m(l,n){I(l,e,n)},d(l){l&&v(e)}}}function kt(t){let e,l;return e=new mt({props:{idx:t[0].idx}}),{c(){q(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,i){M(e,n,i),l=!0},p(n,i){const c={};i[0]&1&&(c.idx=n[0].idx),e.$set(c)},i(n){l||(C(e.$$.fragment,n),l=!0)},o(n){S(e.$$.fragment,n),l=!1},d(n){P(e,n)}}}function yt(t){let e,l;return e=new pt({props:{idx:t[0].idx}}),{c(){q(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,i){M(e,n,i),l=!0},p(n,i){const c={};i[0]&1&&(c.idx=n[0].idx),e.$set(c)},i(n){l||(C(e.$$.fragment,n),l=!0)},o(n){S(e.$$.fragment,n),l=!1},d(n){P(e,n)}}}function wt(t){let e;return{c(){e=le("Zoom to fit")},l(l){e=ie(l,"Zoom to fit")},m(l,n){I(l,e,n)},d(l){l&&v(e)}}}function qe(t){let e,l,n;function i(f){t[13](f)}let c={map:t[3]};return t[5]!==void 0&&(c.enabled=t[5]),e=new ot({props:c}),Y.push(()=>Q(e,"enabled",i)),{c(){q(e.$$.fragment)},l(f){j(e.$$.fragment,f)},m(f,r){M(e,f,r),n=!0},p(f,r){const a={};r[0]&8&&(a.map=f[3]),!l&&r[0]&32&&(l=!0,a.enabled=f[5],Z(()=>l=!1)),e.$set(a)},i(f){n||(C(e.$$.fragment,f),n=!0)},o(f){S(e.$$.fragment,f),n=!1},d(f){P(e,f)}}}function Ct(t){let e,l,n,i,c,f,r,a;e=new Se({props:{$$slots:{default:[wt]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new tt({}),c=new nt({});let p=t[3]&&qe(t);return{c(){q(e.$$.fragment),l=N(),q(n.$$.fragment),i=N(),q(c.$$.fragment),f=N(),p&&p.c(),r=_e()},l(s){j(e.$$.fragment,s),l=D(s),j(n.$$.fragment,s),i=D(s),j(c.$$.fragment,s),f=D(s),p&&p.l(s),r=_e()},m(s,m){M(e,s,m),I(s,l,m),M(n,s,m),I(s,i,m),M(c,s,m),I(s,f,m),p&&p.m(s,m),I(s,r,m),a=!0},p(s,m){const d={};m[1]&32&&(d.$$scope={dirty:m,ctx:s}),e.$set(d),s[3]?p?(p.p(s,m),m[0]&8&&C(p,1)):(p=qe(s),p.c(),C(p,1),p.m(r.parentNode,r)):p&&(fe(),S(p,1,1,()=>{p=null}),ae())},i(s){a||(C(e.$$.fragment,s),C(n.$$.fragment,s),C(c.$$.fragment,s),C(p),a=!0)},o(s){S(e.$$.fragment,s),S(n.$$.fragment,s),S(c.$$.fragment,s),S(p),a=!1},d(s){s&&(v(l),v(i),v(f),v(r)),P(e,s),P(n,s),P(c,s),p&&p.d(s)}}}function Lt(t){let e=Ve(t[32])+"",l;return{c(){l=le(e)},l(n){l=ie(n,e)},m(n,i){I(n,l,i)},p(n,i){i[0]&4&&e!==(e=Ve(n[32])+"")&&he(l,e)},d(n){n&&v(l)}}}function je(t){let e,l,n,i;function c(){return t[15](t[31])}function f(){return t[16](t[31])}return l=new Se({props:{$$slots:{default:[Lt]},$$scope:{ctx:t}}}),l.$on("click",c),l.$on("mouseenter",f),l.$on("mouseleave",t[17]),{c(){e=K("li"),q(l.$$.fragment),n=N()},l(r){e=z(r,"LI",{});var a=J(e);j(l.$$.fragment,a),n=D(a),a.forEach(v)},m(r,a){I(r,e,a),M(l,e,null),U(e,n),i=!0},p(r,a){t=r;const p={};a[0]&4|a[1]&32&&(p.$$scope={dirty:a,ctx:t}),l.$set(p)},i(r){i||(C(l.$$.fragment,r),i=!0)},o(r){S(l.$$.fragment,r),i=!1},d(r){r&&v(e),P(l)}}}function It(t){let e=Fe(t[29])+"",l;return{c(){l=le(e)},l(n){l=ie(n,e)},m(n,i){I(n,l,i)},p(n,i){i[0]&4&&e!==(e=Fe(n[29])+"")&&he(l,e)},d(n){n&&v(l)}}}function Me(t){let e,l,n,i;function c(){return t[18](t[31])}function f(){return t[19](t[31])}return l=new Se({props:{$$slots:{default:[It]},$$scope:{ctx:t}}}),l.$on("click",c),l.$on("mouseenter",f),l.$on("mouseleave",t[20]),{c(){e=K("li"),q(l.$$.fragment),n=N()},l(r){e=z(r,"LI",{});var a=J(e);j(l.$$.fragment,a),n=D(a),a.forEach(v)},m(r,a){I(r,e,a),M(l,e,null),U(e,n),i=!0},p(r,a){t=r;const p={};a[0]&4|a[1]&32&&(p.$$scope={dirty:a,ctx:t}),l.$set(p)},i(r){i||(C(l.$$.fragment,r),i=!0)},o(r){S(l.$$.fragment,r),i=!1},d(r){r&&v(e),P(l)}}}function St(t){let e,l,n,i=t[32].criticalIssue+"",c;return{c(){e=be("svg"),l=be("polygon"),n=be("text"),c=le(i),this.h()},l(f){e=ke(f,"svg",{width:!0,height:!0,xmlns:!0});var r=J(e);l=ke(r,"polygon",{points:!0,fill:!0,class:!0}),J(l).forEach(v),n=ke(r,"text",{x:!0,y:!0});var a=J(n);c=ie(a,i),a.forEach(v),r.forEach(v),this.h()},h(){W(l,"points","20,0 0,40 40,40"),W(l,"fill",Qe.critical.background),W(l,"class","svelte-ktyu3j"),W(n,"x","13"),W(n,"y","30"),X(n,"fill","white"),W(e,"width","40"),W(e,"height","40"),W(e,"xmlns","http://www.w3.org/2000/svg")},m(f,r){I(f,e,r),U(e,l),U(e,n),U(n,c)},p(f,r){r[0]&4&&i!==(i=f[32].criticalIssue+"")&&he(c,i)},d(f){f&&v(e)}}}function Pe(t){let e,l,n;function i(a){t[22](a,t[32])}function c(){return t[23](t[31])}function f(){return t[24](t[31])}let r={draggable:!0,$$slots:{default:[St]},$$scope:{ctx:t}};return t[32].point!==void 0&&(r.lngLat=t[32].point),e=new Oe({props:r}),Y.push(()=>Q(e,"lngLat",i)),e.$on("click",c),e.$on("dragend",f),{c(){q(e.$$.fragment)},l(a){j(e.$$.fragment,a)},m(a,p){M(e,a,p),n=!0},p(a,p){t=a;const s={};p[0]&4|p[1]&32&&(s.$$scope={dirty:p,ctx:t}),!l&&p[0]&4&&(l=!0,s.lngLat=t[32].point,Z(()=>l=!1)),e.$set(s)},i(a){n||(C(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){P(e,a)}}}function Bt(t){let e,l=t[29].conflict+"",n;return{c(){e=K("span"),n=le(l),this.h()},l(i){e=z(i,"SPAN",{class:!0});var c=J(e);n=ie(c,l),c.forEach(v),this.h()},h(){W(e,"class","dot svelte-ktyu3j"),X(e,"background",Xe)},m(i,c){I(i,e,c),U(e,n)},p(i,c){c[0]&4&&l!==(l=i[29].conflict+"")&&he(n,l)},d(i){i&&v(e)}}}function Te(t){let e,l,n;function i(a){t[25](a,t[29])}function c(){return t[26](t[31])}function f(){return t[27](t[31])}let r={draggable:!0,$$slots:{default:[Bt]},$$scope:{ctx:t}};return t[29].point!==void 0&&(r.lngLat=t[29].point),e=new Oe({props:r}),Y.push(()=>Q(e,"lngLat",i)),e.$on("click",c),e.$on("dragend",f),{c(){q(e.$$.fragment)},l(a){j(e.$$.fragment,a)},m(a,p){M(e,a,p),n=!0},p(a,p){t=a;const s={};p[0]&4|p[1]&32&&(s.$$scope={dirty:p,ctx:t}),!l&&p[0]&4&&(l=!0,s.lngLat=t[29].point,Z(()=>l=!1)),e.$set(s)},i(a){n||(C(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){P(e,a)}}}function Et(t){let e,l;return e=new st({props:{paint:{"circle-radius":30,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){q(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,i){M(e,n,i),l=!0},p:ze,i(n){l||(C(e.$$.fragment,n),l=!0)},o(n){S(e.$$.fragment,n),l=!1},d(n){P(e,n)}}}function At(t){let e,l,n,i,c,f,r,a;e=new lt({}),e.$on("click",t[8]);let p=re(t[2].criticalIssues),s=[];for(let u=0;u<p.length;u+=1)s[u]=Pe(Ae(t,p,u));const m=u=>S(s[u],1,1,()=>{s[u]=null});let d=re(t[2].policyConflictLog),g=[];for(let u=0;u<d.length;u+=1)g[u]=Te(Ee(t,d,u));const T=u=>S(g[u],1,1,()=>{g[u]=null});return c=new Ze({props:{data:t[6],$$slots:{default:[Et]},$$scope:{ctx:t}}}),r=new it({props:{map:t[3]}}),{c(){q(e.$$.fragment),l=N();for(let u=0;u<s.length;u+=1)s[u].c();n=N();for(let u=0;u<g.length;u+=1)g[u].c();i=N(),q(c.$$.fragment),f=N(),q(r.$$.fragment)},l(u){j(e.$$.fragment,u),l=D(u);for(let $=0;$<s.length;$+=1)s[$].l(u);n=D(u);for(let $=0;$<g.length;$+=1)g[$].l(u);i=D(u),j(c.$$.fragment,u),f=D(u),j(r.$$.fragment,u)},m(u,$){M(e,u,$),I(u,l,$);for(let b=0;b<s.length;b+=1)s[b]&&s[b].m(u,$);I(u,n,$);for(let b=0;b<g.length;b+=1)g[b]&&g[b].m(u,$);I(u,i,$),M(c,u,$),I(u,f,$),M(r,u,$),a=!0},p(u,$){if($[0]&132){p=re(u[2].criticalIssues);let h;for(h=0;h<p.length;h+=1){const V=Ae(u,p,h);s[h]?(s[h].p(V,$),C(s[h],1)):(s[h]=Pe(V),s[h].c(),C(s[h],1),s[h].m(n.parentNode,n))}for(fe(),h=p.length;h<s.length;h+=1)m(h);ae()}if($[0]&132){d=re(u[2].policyConflictLog);let h;for(h=0;h<d.length;h+=1){const V=Ee(u,d,h);g[h]?(g[h].p(V,$),C(g[h],1)):(g[h]=Te(V),g[h].c(),C(g[h],1),g[h].m(i.parentNode,i))}for(fe(),h=d.length;h<g.length;h+=1)T(h);ae()}const b={};$[0]&64&&(b.data=u[6]),$[1]&32&&(b.$$scope={dirty:$,ctx:u}),c.$set(b);const E={};$[0]&8&&(E.map=u[3]),r.$set(E)},i(u){if(!a){C(e.$$.fragment,u);for(let $=0;$<p.length;$+=1)C(s[$]);for(let $=0;$<d.length;$+=1)C(g[$]);C(c.$$.fragment,u),C(r.$$.fragment,u),a=!0}},o(u){S(e.$$.fragment,u),s=s.filter(Boolean);for(let $=0;$<s.length;$+=1)S(s[$]);g=g.filter(Boolean);for(let $=0;$<g.length;$+=1)S(g[$]);S(c.$$.fragment,u),S(r.$$.fragment,u),a=!1},d(u){u&&(v(l),v(n),v(i),v(f)),P(e,u),ge(s,u),ge(g,u),P(c,u),P(r,u)}}}function Nt(t){let e,l,n,i,c,f,r,a,p,s,m;const d=[ht,dt],g=[];function T(b,E){return b[0]==null?0:1}n=T(t),i=g[n]=d[n](t);function u(b){t[28](b)}let $={$$slots:{default:[At]},$$scope:{ctx:t}};return t[3]!==void 0&&($.map=t[3]),r=new Je({props:$}),Y.push(()=>Q(r,"map",u)),{c(){e=K("div"),l=K("div"),i.c(),c=N(),f=K("div"),q(r.$$.fragment),this.h()},l(b){e=z(b,"DIV",{style:!0});var E=J(e);l=z(E,"DIV",{style:!0});var h=J(l);i.l(h),h.forEach(v),c=D(E),f=z(E,"DIV",{style:!0});var V=J(f);j(r.$$.fragment,V),V.forEach(v),E.forEach(v),this.h()},h(){X(l,"width","30%"),X(l,"overflow-y","scroll"),X(l,"padding","10px"),X(l,"border","1px solid black"),X(f,"position","relative"),X(f,"width","70%"),X(e,"display","flex"),X(e,"height","80vh")},m(b,E){I(b,e,E),U(e,l),g[n].m(l,null),U(e,c),U(e,f),M(r,f,null),p=!0,s||(m=He($t,"keydown",t[11]),s=!0)},p(b,E){let h=n;n=T(b),n===h?g[n].p(b,E):(fe(),S(g[h],1,1,()=>{g[h]=null}),ae(),i=g[n],i?i.p(b,E):(i=g[n]=d[n](b),i.c()),C(i,1),i.m(l,null));const V={};E[0]&76|E[1]&32&&(V.$$scope={dirty:E,ctx:b}),!a&&E[0]&8&&(a=!0,V.map=b[3],Z(()=>a=!1)),r.$set(V)},i(b){p||(C(i),C(r.$$.fragment,b),p=!0)},o(b){S(i),S(r.$$.fragment,b),p=!1},d(b){b&&v(e),g[n].d(),P(r),s=!1,m()}}}function Dt(t,e,l){let n={type:"FeatureCollection",features:[]},i=e??l;if(i!=null){let c=i.kind=="critical"?t.criticalIssues:t.policyConflictLog;n.features.push(ye(c[i.idx].point))}return n}function ye(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}}function Ve(t){return`${t.criticalIssue||"Unknown critical"}: ${t.locationName||"???"}`}function Fe(t){return`${t.conflict||"Unknown conflict"}: ${t.locationName||"???"}`}function qt(t,e,l){let n,i;Ce(t,O,k=>l(2,i=k));let c,f="critical",r=null,a=null,p=!1;function s(k){l(0,r=k),l(1,a=null)}function m(k){if(!p){if(r!=null){l(0,r=null);return}f=="critical"?(Be(O,i.criticalIssues=[...i.criticalIssues,{criticalIssue:"",stage:"",point:k.detail.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,r={kind:"critical",idx:i.criticalIssues.length-1})):(Be(O,i.policyConflictLog=[...i.policyConflictLog,{conflict:"",stage:"",point:k.detail.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,r={kind:"conflict",idx:i.policyConflictLog.length-1})),l(1,a=null)}}Ke(()=>{g(!1)});function d(){window.confirm("Delete this entry?")&&(r.kind=="critical"?(i.criticalIssues.splice(r.idx,1),O.set(i)):(i.policyConflictLog.splice(r.idx,1),O.set(i)),l(0,r=null))}function g(k){let x={type:"FeatureCollection",features:[...i.criticalIssues.map(se=>ye(se.point)),...i.policyConflictLog.map(se=>ye(se.point))]};x.features.length>0&&c.fitBounds(xe(x),{padding:20,animate:k})}function T(k){r!=null&&k.key=="Escape"?(k.stopPropagation(),l(0,r=null)):r!=null&&k.key=="Delete"&&d()}const u=()=>g(!0);function $(k){p=k,l(5,p)}function b(k){f=k,l(4,f)}const E=k=>s({kind:"critical",idx:k}),h=k=>l(1,a={kind:"critical",idx:k}),V=()=>l(1,a=null),R=k=>s({kind:"conflict",idx:k}),L=k=>l(1,a={kind:"conflict",idx:k}),ee=()=>l(1,a=null),F=()=>l(0,r=null);function A(k,x){t.$$.not_equal(x.point,k)&&(x.point=k,O.set(i))}const oe=k=>s({kind:"critical",idx:k}),_=k=>s({kind:"critical",idx:k});function y(k,x){t.$$.not_equal(x.point,k)&&(x.point=k,O.set(i))}const G=k=>s({kind:"conflict",idx:k}),H=k=>s({kind:"conflict",idx:k});function B(k){c=k,l(3,c)}return t.$$.update=()=>{t.$$.dirty[0]&7&&l(6,n=Dt(i,r,a))},[r,a,i,c,f,p,n,s,m,d,g,T,u,$,b,E,h,V,R,L,ee,F,A,oe,_,y,G,H,B]}class Yt extends Le{constructor(e){super(),Ie(this,e,qt,Nt,we,{},null,[-1,-1])}}export{Yt as component};
