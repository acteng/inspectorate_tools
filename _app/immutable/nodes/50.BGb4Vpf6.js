import{s as Ee,r as ue,w as _e,l as wt,u as jt,m as Ct,o as yt,C as Le,k as ze,S as Ut,U as Ne,a as B,g as O,i as j,f as d,J as De,Z as Ft,e as V,c as X,b as Z,q as Y,h as y,D as pe,H as Mt,v as W,N as qe,t as q,O as Re,d as R,n as Ie,p as Ue,j as fe,y as Lt,a0 as xe,V as Bt}from"../chunks/scheduler.BupgUPYD.js";import{S as Ae,i as Pe,e as ge,c as A,a as P,m as D,t as h,b as w,d as U,g as $e,f as he}from"../chunks/index.DdWFotL4.js";import{e as be}from"../chunks/each.DPGgJC1I.js";import{B as Ot}from"../chunks/ButtonGroup.BCNwrOPZ.js";import{D as We,C as zt}from"../chunks/DefaultButton.B9e1GVo9.js";import"../chunks/index.CEASgbiX.js";import{S as Be}from"../chunks/SecondaryButton.DDaC9gF3.js";import{T as Ze}from"../chunks/TextInput.CAOAM16L.js";import{W as Ke}from"../chunks/WarningButton.DFY34J1l.js";import{s as x}from"../chunks/data.Co9IPGML.js";import{g as qt}from"../chunks/globals.D0QH3NT1.js";import{c as et}from"../chunks/index.C4Rm4QUS.js";import{a as Rt,c as Ht,j as Se,v as Gt,w as St,x as Je,M as Jt,b as Vt,G as tt,L as Ve,h as nt,C as Xt,y as Wt}from"../chunks/index.BTbaNm7T.js";import{g as Xe,t as Zt}from"../chunks/index.CeZDS9iU.js";import{c as ye}from"../chunks/colors.DaC397qr.js";import{G as Kt,I as He,p as Qt}from"../chunks/pan.CJ1j09Yw.js";import{M as Yt,G as xt,S as en,C as Qe}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DKN0Xut7.js";import{M as Oe,B as tn,C as nn}from"../chunks/Marker.D2TYHHax.js";import"../chunks/index.CiNZ9aHE.js";import"../chunks/paths.BPlFKJb9.js";import"../chunks/entry.BiUt2O3u.js";import{R as ln}from"../chunks/RouteMapLayer.Ib-YB4ZS.js";import{P as It}from"../chunks/Popup.C2TW7EQz.js";import{T as Et}from"../chunks/TextArea.D3GlehnM.js";import{R as lt}from"../chunks/Radio.saNIbuzG.js";function on(n){let e;const t=n[16].default,l=wt(t,n,n[24],null);return{c(){l&&l.c()},l(o){l&&l.l(o)},m(o,a){l&&l.m(o,a),e=!0},p(o,a){l&&l.p&&(!e||a&16777216)&&jt(l,t,o,o[24],e?yt(t,o[24],a,null):Ct(o[24]),null)},i(o){e||(h(l,o),e=!0)},o(o){w(l,o),e=!1},d(o){l&&l.d(o)}}}function rn(n){let e,t,l;function o(r){n[17](r)}let a={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[on]},$$scope:{ctx:n}};return n[0]!==void 0&&(a.hovered=n[0]),e=new Rt({props:a}),ue.push(()=>ge(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),l=!0},p(r,[i]){const s={};i&2&&(s.id=r[1]),i&4&&(s.source=r[2]),i&8&&(s.sourceLayer=r[3]),i&16&&(s.beforeId=r[4]),i&32&&(s.beforeLayerType=r[5]),i&64&&(s.paint=r[6]),i&128&&(s.layout=r[7]),i&256&&(s.filter=r[8]),i&512&&(s.applyToClusters=r[9]),i&1024&&(s.minzoom=r[10]),i&2048&&(s.maxzoom=r[11]),i&4096&&(s.hoverCursor=r[12]),i&8192&&(s.manageHoverState=r[13]),i&16384&&(s.eventsIfTopMost=r[14]),i&32768&&(s.interactive=r[15]),i&16777216&&(s.$$scope={dirty:i,ctx:r}),!t&&i&1&&(t=!0,s.hovered=r[0],_e(()=>t=!1)),e.$set(s)},i(r){l||(h(e.$$.fragment,r),l=!0)},o(r){w(e.$$.fragment,r),l=!1},d(r){U(e,r)}}}function an(n,e,t){let{$$slots:l={},$$scope:o}=e,{id:a=Ht("symbol")}=e,{source:r=void 0}=e,{sourceLayer:i=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:m=void 0}=e,{layout:g=void 0}=e,{filter:_=void 0}=e,{applyToClusters:b=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:z=void 0}=e,{hoverCursor:C=void 0}=e,{manageHoverState:J=!1}=e,{hovered:p=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:N=!0}=e;function f(M){p=M,t(0,p)}function c(M){Le.call(this,n,M)}function T(M){Le.call(this,n,M)}function le(M){Le.call(this,n,M)}function ee(M){Le.call(this,n,M)}function te(M){Le.call(this,n,M)}function H(M){Le.call(this,n,M)}return n.$$set=M=>{"id"in M&&t(1,a=M.id),"source"in M&&t(2,r=M.source),"sourceLayer"in M&&t(3,i=M.sourceLayer),"beforeId"in M&&t(4,s=M.beforeId),"beforeLayerType"in M&&t(5,u=M.beforeLayerType),"paint"in M&&t(6,m=M.paint),"layout"in M&&t(7,g=M.layout),"filter"in M&&t(8,_=M.filter),"applyToClusters"in M&&t(9,b=M.applyToClusters),"minzoom"in M&&t(10,E=M.minzoom),"maxzoom"in M&&t(11,z=M.maxzoom),"hoverCursor"in M&&t(12,C=M.hoverCursor),"manageHoverState"in M&&t(13,J=M.manageHoverState),"hovered"in M&&t(0,p=M.hovered),"eventsIfTopMost"in M&&t(14,v=M.eventsIfTopMost),"interactive"in M&&t(15,N=M.interactive),"$$scope"in M&&t(24,o=M.$$scope)},[p,a,r,i,s,u,m,g,_,b,E,z,C,J,v,N,l,f,c,T,le,ee,te,H,o]}class sn extends Ae{constructor(e){super(),Pe(this,e,an,rn,Ee,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var fn=Object.defineProperty,un=(n,e)=>fn(n,"name",{value:e,configurable:!0});function Tt(n,e,t,l={}){const o=Xe(n),a=Se(o[0]),r=Se(o[1]),i=Se(t),s=Gt(e,l.units),u=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(i)),m=a+Math.atan2(Math.sin(i)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(u)),g=Je(m),_=Je(u);return St([g,_],l.properties)}un(Tt,"destination");var Fe=Tt,mn=Object.defineProperty,Nt=(n,e)=>mn(n,"name",{value:e,configurable:!0});function Ye(n,e,t={}){if(t.final===!0)return At(n,e);const l=Xe(n),o=Xe(e),a=Se(l[0]),r=Se(o[0]),i=Se(l[1]),s=Se(o[1]),u=Math.sin(r-a)*Math.cos(s),m=Math.cos(i)*Math.sin(s)-Math.sin(i)*Math.cos(s)*Math.cos(r-a);return Je(Math.atan2(u,m))}Nt(Ye,"bearing");function At(n,e){let t=Ye(e,n);return t=(t+180)%360,t}Nt(At,"calculateFinalBearing");var Te=Ye;const cn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function ot(n,e,t){const l=n.slice();return l[36]=e[t],l[37]=e,l[38]=t,l}function rt(n,e,t){const l=n.slice();return l[39]=e[t],l[40]=e,l[38]=t,l}function at(n){let e,t,l,o,a,r,i;return t=new He({props:{$$slots:{default:[dn]},$$scope:{ctx:n}}}),t.$on("click",function(){Ft(n[5])&&n[5].apply(this,arguments)}),o=new He({props:{$$slots:{default:[hn]},$$scope:{ctx:n}}}),o.$on("click",n[17]),r=new He({props:{$$slots:{default:[kn]},$$scope:{ctx:n}}}),r.$on("click",n[18]),{c(){e=V("div"),A(t.$$.fragment),l=B(),A(o.$$.fragment),a=B(),A(r.$$.fragment),this.h()},l(s){e=X(s,"DIV",{class:!0});var u=Z(e);P(t.$$.fragment,u),l=O(u),P(o.$$.fragment,u),a=O(u),P(r.$$.fragment,u),u.forEach(d),this.h()},h(){Y(e,"class","control-panel svelte-1w3m76d")},m(s,u){j(s,e,u),D(t,e,null),y(e,l),D(o,e,null),y(e,a),D(r,e,null),i=!0},p(s,u){n=s;const m={};u[0]&1|u[1]&1024&&(m.$$scope={dirty:u,ctx:n}),t.$set(m);const g={};u[0]&1|u[1]&1024&&(g.$$scope={dirty:u,ctx:n}),o.$set(g);const _={};u[0]&1|u[1]&1024&&(_.$$scope={dirty:u,ctx:n}),r.$set(_)},i(s){i||(h(t.$$.fragment,s),h(o.$$.fragment,s),h(r.$$.fragment,s),i=!0)},o(s){w(t.$$.fragment,s),w(o.$$.fragment,s),w(r.$$.fragment,s),i=!1},d(s){s&&d(e),U(t),U(o),U(r)}}}function _n(n){let e;return{c(){e=q("Move map")},l(t){e=R(t,"Move map")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function gn(n){let e,t="Move map";return{c(){e=V("u"),e.textContent=t},l(l){e=X(l,"U",{"data-svelte-h":!0}),Ue(e)!=="svelte-1719ytd"&&(e.textContent=t)},m(l,o){j(l,e,o)},d(l){l&&d(e)}}}function dn(n){let e,t,l,o;function a(s,u){return s[0].mode=="select"?gn:_n}let r=a(n),i=r(n);return{c(){e=V("img"),l=B(),i.c(),o=pe(),this.h()},l(s){e=X(s,"IMG",{src:!0,alt:!0,style:!0}),l=O(s),i.l(s),o=pe(),this.h()},h(){Mt(e.src,t=Qt)||Y(e,"src",t),Y(e,"alt","Move map"),W(e,"vertical-align","middle")},m(s,u){j(s,e,u),j(s,l,u),i.m(s,u),j(s,o,u)},p(s,u){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(d(e),d(l),d(o)),i.d(s)}}}function pn(n){let e;return{c(){e=q("New arm")},l(t){e=R(t,"New arm")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function $n(n){let e,t="New arm";return{c(){e=V("u"),e.textContent=t},l(l){e=X(l,"U",{"data-svelte-h":!0}),Ue(e)!=="svelte-1typ7gq"&&(e.textContent=t)},m(l,o){j(l,e,o)},d(l){l&&d(e)}}}function hn(n){let e,t,l,o,a,r;function i(m,g){return m[0].mode=="new-arm"?$n:pn}let s=i(n),u=s(n);return{c(){e=qe("svg"),t=qe("circle"),l=qe("text"),o=q("A"),a=B(),u.c(),r=pe(),this.h()},l(m){e=Re(m,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var g=Z(e);t=Re(g,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Z(t).forEach(d),l=Re(g,"text",{x:!0,y:!0,fill:!0});var _=Z(l);o=R(_,"A"),_.forEach(d),g.forEach(d),a=O(m),u.l(m),r=pe(),this.h()},h(){Y(t,"cx","12"),Y(t,"cy","12"),Y(t,"r","12"),Y(t,"fill","white"),Y(l,"x","6"),Y(l,"y","16"),Y(l,"fill","#4472c4"),Y(e,"width","24"),Y(e,"height","24"),Y(e,"xmlns","http://www.w3.org/2000/svg"),W(e,"vertical-align","middle")},m(m,g){j(m,e,g),y(e,t),y(e,l),y(l,o),j(m,a,g),u.m(m,g),j(m,r,g)},p(m,g){s!==(s=i(m))&&(u.d(1),u=s(m),u&&(u.c(),u.m(r.parentNode,r)))},d(m){m&&(d(e),d(a),d(r)),u.d(m)}}}function vn(n){let e;return{c(){e=q("New movement")},l(t){e=R(t,"New movement")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function bn(n){let e,t="New movement";return{c(){e=V("u"),e.textContent=t},l(l){e=X(l,"U",{"data-svelte-h":!0}),Ue(e)!=="svelte-o92ucp"&&(e.textContent=t)},m(l,o){j(l,e,o)},d(l){l&&d(e)}}}function kn(n){let e,t,l,o;function a(s,u){return s[0].mode=="new-movement"?bn:vn}let r=a(n),i=r(n);return{c(){e=V("img"),l=B(),i.c(),o=pe(),this.h()},l(s){e=X(s,"IMG",{src:!0,alt:!0,style:!0}),l=O(s),i.l(s),o=pe(),this.h()},h(){Mt(e.src,t=cn)||Y(e,"src",t),Y(e,"alt","New movement"),W(e,"vertical-align","middle")},m(s,u){j(s,e,u),j(s,l,u),i.m(s,u),j(s,o,u)},p(s,u){r!==(r=a(s))&&(i.d(1),i=r(s),i&&(i.c(),i.m(o.parentNode,o)))},d(s){s&&(d(e),d(l),d(o)),i.d(s)}}}function wn(n){let e,t=Pn(n[38])+"",l;return{c(){e=V("span"),l=q(t),this.h()},l(o){e=X(o,"SPAN",{class:!0});var a=Z(e);l=R(a,t),a.forEach(d),this.h()},h(){Y(e,"class","dot svelte-1w3m76d"),W(e,"color","#4472c4"),W(e,"background-color","white")},m(o,a){j(o,e,a),y(e,l)},p:Ie,d(o){o&&d(e)}}}function it(n){let e,t,l;function o(s){n[19](s,n[39])}function a(){return n[20](n[38])}function r(){return n[21](n[38])}let i={draggable:!0,$$slots:{default:[wn]},$$scope:{ctx:n}};return n[39].point!==void 0&&(i.lngLat=n[39].point),e=new Oe({props:i}),ue.push(()=>ge(e,"lngLat",o)),e.$on("dragend",a),e.$on("click",r),{c(){A(e.$$.fragment)},l(s){P(e.$$.fragment,s)},m(s,u){D(e,s,u),l=!0},p(s,u){n=s;const m={};u[1]&1024&&(m.$$scope={dirty:u,ctx:n}),!t&&u[0]&70&&(t=!0,m.lngLat=n[39].point,_e(()=>t=!1)),e.$set(m)},i(s){l||(h(e.$$.fragment,s),l=!0)},o(s){w(e.$$.fragment,s),l=!1},d(s){U(e,s)}}}function jn(n){let e;return{c(){e=V("span"),this.h()},l(t){e=X(t,"SPAN",{class:!0}),Z(e).forEach(d),this.h()},h(){Y(e,"class","dot svelte-1w3m76d"),W(e,"background-color",n[9][n[36].score]),W(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(t,l){j(t,e,l)},p(t,l){l[0]&70&&W(e,"background-color",t[9][t[36].score]),l[0]&70&&W(e,"opacity",t[36].kind=="walking & wheeling"?"0%":"100%")},d(t){t&&d(e)}}}function Cn(n){let e;return{c(){e=V("span"),this.h()},l(t){e=X(t,"SPAN",{class:!0}),Z(e).forEach(d),this.h()},h(){Y(e,"class","dot svelte-1w3m76d"),W(e,"background-color",n[9][n[36].score])},m(t,l){j(t,e,l)},p(t,l){l[0]&70&&W(e,"background-color",t[9][t[36].score])},d(t){t&&d(e)}}}function yn(n){let e;return{c(){e=V("span"),this.h()},l(t){e=X(t,"SPAN",{class:!0}),Z(e).forEach(d),this.h()},h(){Y(e,"class","dot svelte-1w3m76d"),W(e,"background-color",n[9][n[36].score]),W(e,"opacity","0%")},m(t,l){j(t,e,l)},p(t,l){l[0]&70&&W(e,"background-color",t[9][t[36].score])},d(t){t&&d(e)}}}function st(n){let e,t,l,o,a,r,i,s,u;function m(c){n[22](c,n[36])}function g(){return n[23](n[38])}function _(){return n[24](n[38])}let b={draggable:!0,$$slots:{default:[jn]},$$scope:{ctx:n}};n[36].point1!==void 0&&(b.lngLat=n[36].point1),e=new Oe({props:b}),ue.push(()=>ge(e,"lngLat",m)),e.$on("dragend",g),e.$on("click",_);function E(c){n[25](c,n[36])}function z(){return n[26](n[38])}function C(){return n[27](n[38])}let J={draggable:!0,$$slots:{default:[Cn]},$$scope:{ctx:n}};n[36].point2!==void 0&&(J.lngLat=n[36].point2),o=new Oe({props:J}),ue.push(()=>ge(o,"lngLat",E)),o.$on("dragend",z),o.$on("click",C);function p(c){n[28](c,n[36])}function v(){return n[29](n[38])}function N(){return n[30](n[38])}let f={draggable:!0,$$slots:{default:[yn]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(f.lngLat=n[36].point3),i=new Oe({props:f}),ue.push(()=>ge(i,"lngLat",p)),i.$on("dragend",v),i.$on("click",N),{c(){A(e.$$.fragment),l=B(),A(o.$$.fragment),r=B(),A(i.$$.fragment)},l(c){P(e.$$.fragment,c),l=O(c),P(o.$$.fragment,c),r=O(c),P(i.$$.fragment,c)},m(c,T){D(e,c,T),j(c,l,T),D(o,c,T),j(c,r,T),D(i,c,T),u=!0},p(c,T){n=c;const le={};T[0]&70|T[1]&1024&&(le.$$scope={dirty:T,ctx:n}),!t&&T[0]&70&&(t=!0,le.lngLat=n[36].point1,_e(()=>t=!1)),e.$set(le);const ee={};T[0]&70|T[1]&1024&&(ee.$$scope={dirty:T,ctx:n}),!a&&T[0]&70&&(a=!0,ee.lngLat=n[36].point2,_e(()=>a=!1)),o.$set(ee);const te={};T[0]&70|T[1]&1024&&(te.$$scope={dirty:T,ctx:n}),!s&&T[0]&70&&(s=!0,te.lngLat=n[36].point3,_e(()=>s=!1)),i.$set(te)},i(c){u||(h(e.$$.fragment,c),h(o.$$.fragment,c),h(i.$$.fragment,c),u=!0)},o(c){w(e.$$.fragment,c),w(o.$$.fragment,c),w(i.$$.fragment,c),u=!1},d(c){c&&(d(l),d(r)),U(e,c),U(o,c),U(i,c)}}}function Mn(n){let e=(n[35].name||"Untitled movement")+"",t;return{c(){t=q(e)},l(l){t=R(l,e)},m(l,o){j(l,t,o)},p(l,o){o[1]&16&&e!==(e=(l[35].name||"Untitled movement")+"")&&fe(t,e)},d(l){l&&d(t)}}}function Ln(n){let e,t;return e=new It({props:{$$slots:{default:[Mn,({props:l})=>({35:l}),({props:l})=>[0,l?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,o){D(e,l,o),t=!0},p(l,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){U(e,l)}}}function Sn(n){let e=(n[35].name||"Untitled movement")+"",t;return{c(){t=q(e)},l(l){t=R(l,e)},m(l,o){j(l,t,o)},p(l,o){o[1]&16&&e!==(e=(l[35].name||"Untitled movement")+"")&&fe(t,e)},d(l){l&&d(t)}}}function In(n){let e,t;return e=new It({props:{$$slots:{default:[Sn,({props:l})=>({35:l}),({props:l})=>[0,l?16:0]]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,o){D(e,l,o),t=!0},p(l,o){const a={};o[1]&1040&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){U(e,l)}}}function En(n){let e,t,l,o,a,r;return e=new Ve({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":nt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Ln]},$$scope:{ctx:n}}}),e.$on("click",n[11]),l=new Ve({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":nt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[In]},$$scope:{ctx:n}}}),l.$on("click",n[11]),a=new sn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){A(e.$$.fragment),t=B(),A(l.$$.fragment),o=B(),A(a.$$.fragment)},l(i){P(e.$$.fragment,i),t=O(i),P(l.$$.fragment,i),o=O(i),P(a.$$.fragment,i)},m(i,s){D(e,i,s),j(i,t,s),D(l,i,s),j(i,o,s),D(a,i,s),r=!0},p(i,s){const u={};s[1]&1024&&(u.$$scope={dirty:s,ctx:i}),e.$set(u);const m={};s[1]&1024&&(m.$$scope={dirty:s,ctx:i}),l.$set(m)},i(i){r||(h(e.$$.fragment,i),h(l.$$.fragment,i),h(a.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),w(l.$$.fragment,i),w(a.$$.fragment,i),r=!1},d(i){i&&(d(t),d(o)),U(e,i),U(l,i),U(a,i)}}}function Tn(n){let e,t,l,o;return e=new Ve({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),l=new Xt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){A(e.$$.fragment),t=B(),A(l.$$.fragment)},l(a){P(e.$$.fragment,a),t=O(a),P(l.$$.fragment,a)},m(a,r){D(e,a,r),j(a,t,r),D(l,a,r),o=!0},p:Ie,i(a){o||(h(e.$$.fragment,a),h(l.$$.fragment,a),o=!0)},o(a){w(e.$$.fragment,a),w(l.$$.fragment,a),o=!1},d(a){a&&d(t),U(e,a),U(l,a)}}}function Nn(n){let e,t,l,o,a,r,i,s,u,m,g,_,b;e=new Yt({}),e.$on("click",n[10]);let E=n[0].mode!="editing"&&at(n);o=new ln({props:{show:n[3],id:"route-map"}}),r=new Kt({props:{map:n[7],beforeId:"route-map"}});let z=be(n[6].jat[n[1]][n[2]].arms),C=[];for(let f=0;f<z.length;f+=1)C[f]=it(rt(n,z,f));const J=f=>w(C[f],1,1,()=>{C[f]=null});let p=be(n[6].jat[n[1]][n[2]].movements),v=[];for(let f=0;f<p.length;f+=1)v[f]=st(ot(n,p,f));const N=f=>w(v[f],1,1,()=>{v[f]=null});return m=new tt({props:{data:n[12](n[6]),$$slots:{default:[En]},$$scope:{ctx:n}}}),_=new tt({props:{data:n[8],$$slots:{default:[Tn]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment),t=B(),E&&E.c(),l=B(),A(o.$$.fragment),a=B(),A(r.$$.fragment),i=B();for(let f=0;f<C.length;f+=1)C[f].c();s=B();for(let f=0;f<v.length;f+=1)v[f].c();u=B(),A(m.$$.fragment),g=B(),A(_.$$.fragment)},l(f){P(e.$$.fragment,f),t=O(f),E&&E.l(f),l=O(f),P(o.$$.fragment,f),a=O(f),P(r.$$.fragment,f),i=O(f);for(let c=0;c<C.length;c+=1)C[c].l(f);s=O(f);for(let c=0;c<v.length;c+=1)v[c].l(f);u=O(f),P(m.$$.fragment,f),g=O(f),P(_.$$.fragment,f)},m(f,c){D(e,f,c),j(f,t,c),E&&E.m(f,c),j(f,l,c),D(o,f,c),j(f,a,c),D(r,f,c),j(f,i,c);for(let T=0;T<C.length;T+=1)C[T]&&C[T].m(f,c);j(f,s,c);for(let T=0;T<v.length;T+=1)v[T]&&v[T].m(f,c);j(f,u,c),D(m,f,c),j(f,g,c),D(_,f,c),b=!0},p(f,c){f[0].mode!="editing"?E?(E.p(f,c),c[0]&1&&h(E,1)):(E=at(f),E.c(),h(E,1),E.m(l.parentNode,l)):E&&($e(),w(E,1,1,()=>{E=null}),he());const T={};c[0]&8&&(T.show=f[3]),o.$set(T);const le={};if(c[0]&128&&(le.map=f[7]),r.$set(le),c[0]&86){z=be(f[6].jat[f[1]][f[2]].arms);let H;for(H=0;H<z.length;H+=1){const M=rt(f,z,H);C[H]?(C[H].p(M,c),h(C[H],1)):(C[H]=it(M),C[H].c(),h(C[H],1),C[H].m(s.parentNode,s))}for($e(),H=z.length;H<C.length;H+=1)J(H);he()}if(c[0]&598){p=be(f[6].jat[f[1]][f[2]].movements);let H;for(H=0;H<p.length;H+=1){const M=ot(f,p,H);v[H]?(v[H].p(M,c),h(v[H],1)):(v[H]=st(M),v[H].c(),h(v[H],1),v[H].m(u.parentNode,u))}for($e(),H=p.length;H<v.length;H+=1)N(H);he()}const ee={};c[0]&64&&(ee.data=f[12](f[6])),c[1]&1024&&(ee.$$scope={dirty:c,ctx:f}),m.$set(ee);const te={};c[0]&256&&(te.data=f[8]),c[1]&1024&&(te.$$scope={dirty:c,ctx:f}),_.$set(te)},i(f){if(!b){h(e.$$.fragment,f),h(E),h(o.$$.fragment,f),h(r.$$.fragment,f);for(let c=0;c<z.length;c+=1)h(C[c]);for(let c=0;c<p.length;c+=1)h(v[c]);h(m.$$.fragment,f),h(_.$$.fragment,f),b=!0}},o(f){w(e.$$.fragment,f),w(E),w(o.$$.fragment,f),w(r.$$.fragment,f),C=C.filter(Boolean);for(let c=0;c<C.length;c+=1)w(C[c]);v=v.filter(Boolean);for(let c=0;c<v.length;c+=1)w(v[c]);w(m.$$.fragment,f),w(_.$$.fragment,f),b=!1},d(f){f&&(d(t),d(l),d(a),d(i),d(s),d(u),d(g)),U(e,f),E&&E.d(f),U(o,f),U(r,f),De(C,f),De(v,f),U(m,f),U(_,f)}}}function An(n){let e,t,l;function o(r){n[31](r)}let a={$$slots:{default:[Nn]},$$scope:{ctx:n}};return n[7]!==void 0&&(a.map=n[7]),e=new Jt({props:a}),ue.push(()=>ge(e,"map",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),l=!0},p(r,i){const s={};i[0]&511|i[1]&1024&&(s.$$scope={dirty:i,ctx:r}),!t&&i[0]&128&&(t=!0,s.map=r[7],_e(()=>t=!1)),e.$set(s)},i(r){l||(h(e.$$.fragment,r),l=!0)},o(r){w(e.$$.fragment,r),l=!1},d(r){U(e,r)}}}function ft(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Pn(n){return String.fromCharCode(n+65)}function Dn(n,e,t){let l,o;ze(n,x,$=>t(6,o=$));let{junctionIdx:a}=e,{stage:r}=e,{mode:i}=e,{hoveringSidebar:s}=e,{streetviewOn:u}=e,{showRoute:m}=e,{select:g}=e,{stopEditing:_}=e,b,E={0:ye.red.background,1:ye.amber.background,2:ye.green.background,X:ye.critical.background};function z($,S,me){let Q={type:"FeatureCollection",features:[]},de=S.mode=="editing"?S.id:me;return de!=null&&(de.kind=="arm"?Q.features.push(ft($.jat[a][r].arms[de.idx],de.idx)):Q.features.push(v($.jat[a][r].movements[de.idx],de.idx))),Q}async function C($){if(!u){for(let S of b.queryRenderedFeatures($.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i.mode!="select"){if(i.mode=="editing"){await _();return}i.mode=="new-arm"?(Ne(x,o.jat[a][r].arms=[...o.jat[a][r].arms,{point:$.detail.lngLat.toArray(),name:""}],o),await g({kind:"arm",idx:o.jat[a][r].arms.length-1})):(Ne(x,o.jat[a][r].movements=[...o.jat[a][r].movements,{point1:$.detail.lngLat.toArray(),point2:Fe($.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Fe($.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await g({kind:"movement",idx:o.jat[a][r].movements.length-1}))}}}async function J($){await g({kind:"movement",idx:$.detail.features[0].id})}Ut(()=>{f(!1)});function p($){let S={type:"FeatureCollection",features:$.jat[a][r].movements.map((me,Q)=>v(me,Q))};for(let me of $.jat[a][r].movements)if(S.features.push(N(me,S.features.length)),me.kind=="walking & wheeling"){let Q={...me,point1:me.point3,point3:me.point1};S.features.push(N(Q,S.features.length))}return S}function v($,S){return{type:"Feature",id:S,properties:{name:$.name,kind:$.kind,color:E[$.score]},geometry:{type:"LineString",coordinates:[$.point1,$.point2,$.point3]}}}function N($,S){return{type:"Feature",id:S,properties:{kind:$.kind,color:E[$.score],angle:Te($.point2,$.point3)},geometry:{type:"Point",coordinates:$.point3}}}function f($){let S=p(o);for(let me of o.jat[a][r].arms)S.features.push(ft(me,S.features.length));for(let me of o.summary.networkMap.features)S.features.push(me);S.features.length>0&&b.fitBounds(Vt(S),{padding:20,animate:$})}function c(){return b}const T=()=>t(0,i={mode:"new-arm"}),le=()=>t(0,i={mode:"new-movement"});function ee($,S){n.$$.not_equal(S.point,$)&&(S.point=$,x.set(o))}const te=$=>g({kind:"arm",idx:$}),H=$=>g({kind:"arm",idx:$});function M($,S){n.$$.not_equal(S.point1,$)&&(S.point1=$,x.set(o))}const ie=$=>g({kind:"movement",idx:$}),ve=$=>g({kind:"movement",idx:$});function we($,S){n.$$.not_equal(S.point2,$)&&(S.point2=$,x.set(o))}const F=$=>g({kind:"movement",idx:$}),K=$=>g({kind:"movement",idx:$});function ae($,S){n.$$.not_equal(S.point3,$)&&(S.point3=$,x.set(o))}const oe=$=>g({kind:"movement",idx:$}),se=$=>g({kind:"movement",idx:$});function L($){b=$,t(7,b)}return n.$$set=$=>{"junctionIdx"in $&&t(1,a=$.junctionIdx),"stage"in $&&t(2,r=$.stage),"mode"in $&&t(0,i=$.mode),"hoveringSidebar"in $&&t(13,s=$.hoveringSidebar),"streetviewOn"in $&&t(14,u=$.streetviewOn),"showRoute"in $&&t(3,m=$.showRoute),"select"in $&&t(4,g=$.select),"stopEditing"in $&&t(5,_=$.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&8257&&t(8,l=z(o,i,s))},[i,a,r,m,g,_,o,b,l,E,C,J,p,s,u,f,c,T,le,ee,te,H,M,ie,ve,we,F,K,ae,oe,se,L]}class Un extends Ae{constructor(e){super(),Pe(this,e,Dn,An,Ee,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showRoute:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Fn(n){let e,t,l,o,a,r,i,s,u,m,g,_;function b(f){n[5](f)}let E={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(E.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new Ze({props:E}),ue.push(()=>ge(e,"value",b));function z(f){n[6](f)}let C={label:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(C.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),o=new lt({props:C}),ue.push(()=>ge(o,"value",z));function J(f){n[7](f)}let p={label:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(p.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),i=new lt({props:p}),ue.push(()=>ge(i,"value",J));function v(f){n[8](f)}let N={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(N.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),m=new Et({props:N}),ue.push(()=>ge(m,"value",v)),{c(){A(e.$$.fragment),l=B(),A(o.$$.fragment),r=B(),A(i.$$.fragment),u=B(),A(m.$$.fragment)},l(f){P(e.$$.fragment,f),l=O(f),P(o.$$.fragment,f),r=O(f),P(i.$$.fragment,f),u=O(f),P(m.$$.fragment,f)},m(f,c){D(e,f,c),j(f,l,c),D(o,f,c),j(f,r,c),D(i,f,c),j(f,u,c),D(m,f,c),_=!0},p(f,[c]){const T={};!t&&c&15&&(t=!0,T.value=f[3].jat[f[0]][f[1]].movements[f[2]].name,_e(()=>t=!1)),e.$set(T);const le={};!a&&c&15&&(a=!0,le.value=f[3].jat[f[0]][f[1]].movements[f[2]].kind,_e(()=>a=!1)),o.$set(le);const ee={};!s&&c&15&&(s=!0,ee.value=f[3].jat[f[0]][f[1]].movements[f[2]].score,_e(()=>s=!1)),i.$set(ee);const te={};!g&&c&15&&(g=!0,te.value=f[3].jat[f[0]][f[1]].movements[f[2]].notes,_e(()=>g=!1)),m.$set(te)},i(f){_||(h(e.$$.fragment,f),h(o.$$.fragment,f),h(i.$$.fragment,f),h(m.$$.fragment,f),_=!0)},o(f){w(e.$$.fragment,f),w(o.$$.fragment,f),w(i.$$.fragment,f),w(m.$$.fragment,f),_=!1},d(f){f&&(d(l),d(r),d(u)),U(e,f),U(o,f),U(i,f),U(m,f)}}}function Bn(n,e,t){let l;ze(n,x,_=>t(3,l=_));let{junctionIdx:o}=e,{stage:a}=e,{idx:r}=e,i=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){n.$$.not_equal(l.jat[o][a].movements[r].name,_)&&(l.jat[o][a].movements[r].name=_,x.set(l))}function u(_){n.$$.not_equal(l.jat[o][a].movements[r].kind,_)&&(l.jat[o][a].movements[r].kind=_,x.set(l))}function m(_){n.$$.not_equal(l.jat[o][a].movements[r].score,_)&&(l.jat[o][a].movements[r].score=_,x.set(l))}function g(_){n.$$.not_equal(l.jat[o][a].movements[r].notes,_)&&(l.jat[o][a].movements[r].notes=_,x.set(l))}return n.$$set=_=>{"junctionIdx"in _&&t(0,o=_.junctionIdx),"stage"in _&&t(1,a=_.stage),"idx"in _&&t(2,r=_.idx)},[o,a,r,l,i,s,u,m,g]}class On extends Ae{constructor(e){super(),Pe(this,e,Bn,Fn,Ee,{junctionIdx:0,stage:1,idx:2})}}function ke(n){if(n.movements.length==0)return"No movements added";let e=0,t=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],t+=2;let l=e/t*100;return`${Math.round(l)}%`}var zn=Object.defineProperty,qn=(n,e)=>zn(n,"name",{value:e,configurable:!0});function Pt(n,e={}){const t=Wt(n),l=(t[0]+t[2])/2,o=(t[1]+t[3])/2;return St([l,o],e.properties,e)}qn(Pt,"center");var Rn=Pt;function Hn(n){let e=Rn({type:"FeatureCollection",features:n.map(l=>({type:"Feature",geometry:{type:"Point",coordinates:l.point},properties:{}}))}).geometry.coordinates;n.sort((l,o)=>ut(Te(e,o.point))-ut(Te(e,l.point)));let t=[];for(let l=0;l<n.length;l++){let o=n[l],a=Te(o.point,e),r=1;for(let i of Jn(l,n.length)){let s=n[i],u=Te(e,s.point),m=Gn(o.point,e,r++),g=Zt(o.point,e),_=Fe(m,.5*g,a).geometry.coordinates,b=Fe(_,.2*g,u).geometry.coordinates;t.push({point1:m,point2:_,point3:b,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return t}function Gn(n,e,t){let l=.003,a=Te(n,e)-90,r=l*t;return Fe(n,r,a).geometry.coordinates}function ut(n){return(n+360)%360}function Jn(n,e){let t=[];for(let l=n+1;l<e;l++)t.push(l);for(let l=0;l<n;l++)t.push(l);return t}const{window:Vn}=qt;function mt(n,e,t){const l=n.slice();l[34]=e[t],l[37]=t;const o=l[16][l[34].score];return l[35]=o,l}function ct(n,e,t){const l=n.slice();return l[38]=e[t],l[37]=t,l}function Xn(n){let e,t,l,o,a,r,i,s;e=new We({props:{$$slots:{default:[Zn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),l=new Ke({props:{$$slots:{default:[Kn]},$$scope:{ctx:n}}}),l.$on("click",n[12]);const u=[Yn,Qn],m=[];function g(_,b){return _[2].id.kind=="movement"?0:1}return a=g(n),r=m[a]=u[a](n),{c(){A(e.$$.fragment),t=B(),A(l.$$.fragment),o=B(),r.c(),i=pe()},l(_){P(e.$$.fragment,_),t=O(_),P(l.$$.fragment,_),o=O(_),r.l(_),i=pe()},m(_,b){D(e,_,b),j(_,t,b),D(l,_,b),j(_,o,b),m[a].m(_,b),j(_,i,b),s=!0},p(_,b){const E={};b[1]&2&&(E.$$scope={dirty:b,ctx:_}),e.$set(E);const z={};b[1]&2&&(z.$$scope={dirty:b,ctx:_}),l.$set(z);let C=a;a=g(_),a===C?m[a].p(_,b):($e(),w(m[C],1,1,()=>{m[C]=null}),he(),r=m[a],r?r.p(_,b):(r=m[a]=u[a](_),r.c()),h(r,1),r.m(i.parentNode,i))},i(_){s||(h(e.$$.fragment,_),h(l.$$.fragment,_),h(r),s=!0)},o(_){w(e.$$.fragment,_),w(l.$$.fragment,_),w(r),s=!1},d(_){_&&(d(t),d(o),d(i)),U(e,_),U(l,_),m[a].d(_)}}}function Wn(n){let e,t,l,o,a,r,i,s=n[8].jat[n[0]].name+"",u,m,g,_,b,E="Arms",z,C,J,p,v="Movements",N,f,c,T,le,ee,te=(n[8].jat[n[0]].name||"Untitled junction")+"",H,M,ie=ke(n[8].jat[n[0]][n[1]])+"",ve,we,F,K,ae,oe;const se=n[18].default,L=wt(se,n,n[32],null);g=new zt({props:{label:"Map tools",$$slots:{default:[ll]},$$scope:{ctx:n}}});let $=be(n[8].jat[n[0]][n[1]].arms),S=[];for(let k=0;k<$.length;k+=1)S[k]=_t(ct(n,$,k));const me=k=>w(S[k],1,1,()=>{S[k]=null});let Q=n[8].jat[n[0]][n[9]].arms.length>0&&gt(n);F=new Be({props:{disabled:n[8].jat[n[0]][n[1]].arms.length<2,$$slots:{default:[rl]},$$scope:{ctx:n}}}),F.$on("click",n[17]);let de=be(n[8].jat[n[0]][n[1]].movements),ne=[];for(let k=0;k<de.length;k+=1)ne[k]=dt(mt(n,de,k));const Dt=k=>w(ne[k],1,1,()=>{ne[k]=null});let re=n[8].jat[n[0]][n[9]].movements.length>0&&pt(n);return{c(){L&&L.c(),e=B(),t=V("div"),l=V("p"),o=V("b"),a=q("Currently editing "),r=q(n[1]),i=q(` junction
            `),u=q(s),m=B(),A(g.$$.fragment),_=B(),b=V("h3"),b.textContent=E,z=B();for(let k=0;k<S.length;k+=1)S[k].c();C=B(),Q&&Q.c(),J=B(),p=V("h3"),p.textContent=v,N=B(),f=V("p"),c=q("Total JAT score for "),T=q(n[1]),le=B(),ee=V("u"),H=q(te),M=q(`
          : `),ve=q(ie),we=B(),A(F.$$.fragment),K=B();for(let k=0;k<ne.length;k+=1)ne[k].c();ae=B(),re&&re.c(),this.h()},l(k){L&&L.l(k),e=O(k),t=X(k,"DIV",{class:!0});var I=Z(t);l=X(I,"P",{});var ce=Z(l);o=X(ce,"B",{});var je=Z(o);a=R(je,"Currently editing "),r=R(je,n[1]),i=R(je,` junction
            `),u=R(je,s),je.forEach(d),ce.forEach(d),m=O(I),P(g.$$.fragment,I),_=O(I),b=X(I,"H3",{"data-svelte-h":!0}),Ue(b)!=="svelte-ld74qb"&&(b.textContent=E),z=O(I);for(let Me=0;Me<S.length;Me+=1)S[Me].l(I);C=O(I),Q&&Q.l(I),J=O(I),p=X(I,"H3",{"data-svelte-h":!0}),Ue(p)!=="svelte-1dc52s8"&&(p.textContent=v),N=O(I),f=X(I,"P",{});var G=Z(f);c=R(G,"Total JAT score for "),T=R(G,n[1]),le=O(G),ee=X(G,"U",{});var Ce=Z(ee);H=R(Ce,te),Ce.forEach(d),M=R(G,`
          : `),ve=R(G,ie),G.forEach(d),we=O(I),P(F.$$.fragment,I),K=O(I);for(let Me=0;Me<ne.length;Me+=1)ne[Me].l(I);ae=O(I),re&&re.l(I),I.forEach(d),this.h()},h(){Y(t,"class","govuk-tabs__panel")},m(k,I){L&&L.m(k,I),j(k,e,I),j(k,t,I),y(t,l),y(l,o),y(o,a),y(o,r),y(o,i),y(o,u),y(t,m),D(g,t,null),y(t,_),y(t,b),y(t,z);for(let ce=0;ce<S.length;ce+=1)S[ce]&&S[ce].m(t,null);y(t,C),Q&&Q.m(t,null),y(t,J),y(t,p),y(t,N),y(t,f),y(f,c),y(f,T),y(f,le),y(f,ee),y(ee,H),y(f,M),y(f,ve),y(t,we),D(F,t,null),y(t,K);for(let ce=0;ce<ne.length;ce+=1)ne[ce]&&ne[ce].m(t,null);y(t,ae),re&&re.m(t,null),oe=!0},p(k,I){L&&L.p&&(!oe||I[1]&2)&&jt(L,se,k,k[32],oe?yt(se,k[32],I,null):Ct(k[32]),null),(!oe||I[0]&2)&&fe(r,k[1]),(!oe||I[0]&257)&&s!==(s=k[8].jat[k[0]].name+"")&&fe(u,s);const ce={};if(I[0]&112|I[1]&2&&(ce.$$scope={dirty:I,ctx:k}),g.$set(ce),I[0]&1291){$=be(k[8].jat[k[0]][k[1]].arms);let G;for(G=0;G<$.length;G+=1){const Ce=ct(k,$,G);S[G]?(S[G].p(Ce,I),h(S[G],1)):(S[G]=_t(Ce),S[G].c(),h(S[G],1),S[G].m(t,C))}for($e(),G=$.length;G<S.length;G+=1)me(G);he()}k[8].jat[k[0]][k[9]].arms.length>0?Q?(Q.p(k,I),I[0]&257&&h(Q,1)):(Q=gt(k),Q.c(),h(Q,1),Q.m(t,J)):Q&&($e(),w(Q,1,1,()=>{Q=null}),he()),(!oe||I[0]&2)&&fe(T,k[1]),(!oe||I[0]&257)&&te!==(te=(k[8].jat[k[0]].name||"Untitled junction")+"")&&fe(H,te),(!oe||I[0]&259)&&ie!==(ie=ke(k[8].jat[k[0]][k[1]])+"")&&fe(ve,ie);const je={};if(I[0]&259&&(je.disabled=k[8].jat[k[0]][k[1]].arms.length<2),I[1]&2&&(je.$$scope={dirty:I,ctx:k}),F.$set(je),I[0]&66827){de=be(k[8].jat[k[0]][k[1]].movements);let G;for(G=0;G<de.length;G+=1){const Ce=mt(k,de,G);ne[G]?(ne[G].p(Ce,I),h(ne[G],1)):(ne[G]=dt(Ce),ne[G].c(),h(ne[G],1),ne[G].m(t,ae))}for($e(),G=de.length;G<ne.length;G+=1)Dt(G);he()}k[8].jat[k[0]][k[9]].movements.length>0?re?(re.p(k,I),I[0]&257&&h(re,1)):(re=pt(k),re.c(),h(re,1),re.m(t,null)):re&&($e(),w(re,1,1,()=>{re=null}),he())},i(k){if(!oe){h(L,k),h(g.$$.fragment,k);for(let I=0;I<$.length;I+=1)h(S[I]);h(Q),h(F.$$.fragment,k);for(let I=0;I<de.length;I+=1)h(ne[I]);h(re),oe=!0}},o(k){w(L,k),w(g.$$.fragment,k),S=S.filter(Boolean);for(let I=0;I<S.length;I+=1)w(S[I]);w(Q),w(F.$$.fragment,k),ne=ne.filter(Boolean);for(let I=0;I<ne.length;I+=1)w(ne[I]);w(re),oe=!1},d(k){k&&(d(e),d(t)),L&&L.d(k),U(g),De(S,k),Q&&Q.d(),U(F),De(ne,k),re&&re.d()}}}function Zn(n){let e;return{c(){e=q("Save")},l(t){e=R(t,"Save")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function Kn(n){let e;return{c(){e=q("Delete")},l(t){e=R(t,"Delete")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function Qn(n){let e,t,l;function o(r){n[29](r)}let a={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(a.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new Ze({props:a}),ue.push(()=>ge(e,"value",o)),{c(){A(e.$$.fragment)},l(r){P(e.$$.fragment,r)},m(r,i){D(e,r,i),l=!0},p(r,i){const s={};!t&&i[0]&263&&(t=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,_e(()=>t=!1)),e.$set(s)},i(r){l||(h(e.$$.fragment,r),l=!0)},o(r){w(e.$$.fragment,r),l=!1},d(r){U(e,r)}}}function Yn(n){let e,t,l,o,a,r;return e=new On({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),l=new We({props:{$$slots:{default:[xn]},$$scope:{ctx:n}}}),l.$on("click",n[11]),a=new Ke({props:{$$slots:{default:[el]},$$scope:{ctx:n}}}),a.$on("click",n[12]),{c(){A(e.$$.fragment),t=B(),A(l.$$.fragment),o=B(),A(a.$$.fragment)},l(i){P(e.$$.fragment,i),t=O(i),P(l.$$.fragment,i),o=O(i),P(a.$$.fragment,i)},m(i,s){D(e,i,s),j(i,t,s),D(l,i,s),j(i,o,s),D(a,i,s),r=!0},p(i,s){const u={};s[0]&1&&(u.junctionIdx=i[0]),s[0]&2&&(u.stage=i[1]),s[0]&4&&(u.idx=i[2].id.idx),e.$set(u);const m={};s[1]&2&&(m.$$scope={dirty:s,ctx:i}),l.$set(m);const g={};s[1]&2&&(g.$$scope={dirty:s,ctx:i}),a.$set(g)},i(i){r||(h(e.$$.fragment,i),h(l.$$.fragment,i),h(a.$$.fragment,i),r=!0)},o(i){w(e.$$.fragment,i),w(l.$$.fragment,i),w(a.$$.fragment,i),r=!1},d(i){i&&(d(t),d(o)),U(e,i),U(l,i),U(a,i)}}}function xn(n){let e;return{c(){e=q("Save")},l(t){e=R(t,"Save")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function el(n){let e;return{c(){e=q("Delete")},l(t){e=R(t,"Delete")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function tl(n){let e;return{c(){e=q("Zoom to fit")},l(t){e=R(t,"Zoom to fit")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function nl(n){let e;return{c(){e=q("Show route")},l(t){e=R(t,"Show route")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function ll(n){var J;let e,t,l,o,a,r,i,s,u,m,g,_;e=new Be({props:{$$slots:{default:[tl]},$$scope:{ctx:n}}}),e.$on("click",n[20]),l=new tn({}),a=new xt({});function b(p){n[21](p)}let E={map:(J=n[6])==null?void 0:J.getMap()};n[4]!==void 0&&(E.enabled=n[4]),i=new en({props:E}),ue.push(()=>ge(i,"enabled",b));function z(p){n[22](p)}let C={$$slots:{default:[nl]},$$scope:{ctx:n}};return n[5]!==void 0&&(C.checked=n[5]),m=new nn({props:C}),ue.push(()=>ge(m,"checked",z)),{c(){A(e.$$.fragment),t=B(),A(l.$$.fragment),o=B(),A(a.$$.fragment),r=B(),A(i.$$.fragment),u=B(),A(m.$$.fragment)},l(p){P(e.$$.fragment,p),t=O(p),P(l.$$.fragment,p),o=O(p),P(a.$$.fragment,p),r=O(p),P(i.$$.fragment,p),u=O(p),P(m.$$.fragment,p)},m(p,v){D(e,p,v),j(p,t,v),D(l,p,v),j(p,o,v),D(a,p,v),j(p,r,v),D(i,p,v),j(p,u,v),D(m,p,v),_=!0},p(p,v){var T;const N={};v[1]&2&&(N.$$scope={dirty:v,ctx:p}),e.$set(N);const f={};v[0]&64&&(f.map=(T=p[6])==null?void 0:T.getMap()),!s&&v[0]&16&&(s=!0,f.enabled=p[4],_e(()=>s=!1)),i.$set(f);const c={};v[1]&2&&(c.$$scope={dirty:v,ctx:p}),!g&&v[0]&32&&(g=!0,c.checked=p[5],_e(()=>g=!1)),m.$set(c)},i(p){_||(h(e.$$.fragment,p),h(l.$$.fragment,p),h(a.$$.fragment,p),h(i.$$.fragment,p),h(m.$$.fragment,p),_=!0)},o(p){w(e.$$.fragment,p),w(l.$$.fragment,p),w(a.$$.fragment,p),w(i.$$.fragment,p),w(m.$$.fragment,p),_=!1},d(p){p&&(d(t),d(o),d(r),d(u)),U(e,p),U(l,p),U(a,p),U(i,p),U(m,p)}}}function _t(n){let e,t;function l(){return n[23](n[37])}function o(){return n[24](n[37])}return e=new Qe({props:{name:`${$t(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",l),e.$on("mouseenter",o),e.$on("mouseleave",n[25]),{c(){A(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,r){D(e,a,r),t=!0},p(a,r){n=a;const i={};r[0]&259&&(i.name=`${$t(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(i)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){U(e,a)}}}function gt(n){let e,t;return e=new Be({props:{$$slots:{default:[ol]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,o){D(e,l,o),t=!0},p(l,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){U(e,l)}}}function ol(n){let e,t;return{c(){e=q("Copy arms from "),t=q(n[9])},l(l){e=R(l,"Copy arms from "),t=R(l,n[9])},m(l,o){j(l,e,o),j(l,t,o)},p:Ie,d(l){l&&(d(e),d(t))}}}function rl(n){let e;return{c(){e=q("Generate cycling movements between all arms")},l(t){e=R(t,"Generate cycling movements between all arms")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function al(n){let e,t,l,o=n[34].score+"",a,r,i,s=et(n[34].kind)+"",u;return{c(){e=V("div"),t=V("span"),l=q("Score: "),a=q(o),r=B(),i=V("span"),u=q(s),this.h()},l(m){e=X(m,"DIV",{style:!0});var g=Z(e);t=X(g,"SPAN",{style:!0});var _=Z(t);l=R(_,"Score: "),a=R(_,o),_.forEach(d),r=O(g),i=X(g,"SPAN",{});var b=Z(i);u=R(b,s),b.forEach(d),g.forEach(d),this.h()},h(){W(t,"padding","4px"),W(t,"color",n[35].font),W(t,"background-color",n[35].background),W(e,"width","100%"),W(e,"display","flex"),W(e,"justify-content","space-between")},m(m,g){j(m,e,g),y(e,t),y(t,l),y(t,a),y(e,r),y(e,i),y(i,u)},p(m,g){g[0]&259&&o!==(o=m[34].score+"")&&fe(a,o),g[0]&259&&W(t,"color",m[35].font),g[0]&259&&W(t,"background-color",m[35].background),g[0]&259&&s!==(s=et(m[34].kind)+"")&&fe(u,s)},d(m){m&&d(e)}}}function dt(n){let e,t;function l(){return n[26](n[37])}function o(){return n[27](n[37])}return e=new Qe({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[al]},$$scope:{ctx:n}}}),e.$on("click",l),e.$on("mouseenter",o),e.$on("mouseleave",n[28]),{c(){A(e.$$.fragment)},l(a){P(e.$$.fragment,a)},m(a,r){D(e,a,r),t=!0},p(a,r){n=a;const i={};r[0]&259&&(i.name=n[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(i.$$scope={dirty:r,ctx:n}),e.$set(i)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){U(e,a)}}}function pt(n){let e,t;return e=new Be({props:{$$slots:{default:[il]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,o){D(e,l,o),t=!0},p(l,o){const a={};o[1]&2&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){U(e,l)}}}function il(n){let e,t;return{c(){e=q("Copy movements from "),t=q(n[9])},l(l){e=R(l,"Copy movements from "),t=R(l,n[9])},m(l,o){j(l,e,o),j(l,t,o)},p:Ie,d(l){l&&(d(e),d(t))}}}function sl(n){let e,t,l,o,a,r,i,s=ke(n[8].jat[n[0]].existing)+"",u,m,g,_=ke(n[8].jat[n[0]].proposed)+"",b,E,z,C,J,p,v,N,f,c,T,le,ee;function te(F){n[19](F)}let H={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(H.value=n[8].jat[n[0]][n[1]].notes),t=new Et({props:H}),ue.push(()=>ge(t,"value",te));const M=[Wn,Xn],ie=[];function ve(F,K){return F[2].mode!="editing"?0:1}p=ve(n),v=ie[p]=M[p](n);let we={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showRoute:n[5],select:n[10],stopEditing:n[11]};return c=new Un({props:we}),n[31](c),{c(){e=V("div"),A(t.$$.fragment),o=B(),a=V("p"),r=q("Total JAT score: "),i=V("b"),u=q(s),m=q(`
    existing,
    `),g=V("b"),b=q(_),E=q(`
    proposed`),z=B(),C=V("div"),J=V("div"),v.c(),N=B(),f=V("div"),A(c.$$.fragment),this.h()},l(F){e=X(F,"DIV",{class:!0});var K=Z(e);P(t.$$.fragment,K),o=O(K),a=X(K,"P",{});var ae=Z(a);r=R(ae,"Total JAT score: "),i=X(ae,"B",{});var oe=Z(i);u=R(oe,s),oe.forEach(d),m=R(ae,`
    existing,
    `),g=X(ae,"B",{});var se=Z(g);b=R(se,_),se.forEach(d),E=R(ae,`
    proposed`),ae.forEach(d),K.forEach(d),z=O(F),C=X(F,"DIV",{style:!0});var L=Z(C);J=X(L,"DIV",{style:!0});var $=Z(J);v.l($),$.forEach(d),N=O(L),f=X(L,"DIV",{style:!0});var S=Z(f);P(c.$$.fragment,S),S.forEach(d),L.forEach(d),this.h()},h(){Y(e,"class","govuk-width-container"),W(J,"width","30%"),W(J,"overflow-y","scroll"),W(J,"padding","10px"),W(J,"border","1px solid black"),W(f,"position","relative"),W(f,"width","100%"),W(C,"display","flex"),W(C,"height","80vh")},m(F,K){j(F,e,K),D(t,e,null),y(e,o),y(e,a),y(a,r),y(a,i),y(i,u),y(a,m),y(a,g),y(g,b),y(a,E),j(F,z,K),j(F,C,K),y(C,J),ie[p].m(J,null),n[30](J),y(C,N),y(C,f),D(c,f,null),T=!0,le||(ee=Lt(Vn,"keydown",n[13]),le=!0)},p(F,K){const ae={};K[0]&2&&(ae.label="Commentary / Notes about "+F[1]+" junction"),!l&&K[0]&259&&(l=!0,ae.value=F[8].jat[F[0]][F[1]].notes,_e(()=>l=!1)),t.$set(ae),(!T||K[0]&257)&&s!==(s=ke(F[8].jat[F[0]].existing)+"")&&fe(u,s),(!T||K[0]&257)&&_!==(_=ke(F[8].jat[F[0]].proposed)+"")&&fe(b,_);let oe=p;p=ve(F),p===oe?ie[p].p(F,K):($e(),w(ie[oe],1,1,()=>{ie[oe]=null}),he(),v=ie[p],v?v.p(F,K):(v=ie[p]=M[p](F),v.c()),h(v,1),v.m(J,null));const se={};K[0]&1&&(se.junctionIdx=F[0]),K[0]&2&&(se.stage=F[1]),K[0]&4&&(se.mode=F[2]),K[0]&8&&(se.hoveringSidebar=F[3]),K[0]&16&&(se.streetviewOn=F[4]),K[0]&32&&(se.showRoute=F[5]),c.$set(se)},i(F){T||(h(t.$$.fragment,F),h(v),h(c.$$.fragment,F),T=!0)},o(F){w(t.$$.fragment,F),w(v),w(c.$$.fragment,F),T=!1},d(F){F&&(d(e),d(z),d(C)),U(t),ie[p].d(),n[30](null),n[31](null),U(c),le=!1,ee()}}}function $t(n){return String.fromCharCode(n+65)}function fl(n,e,t){let l;ze(n,x,L=>t(8,l=L));let{$$slots:o={},$$scope:a}=e,{junctionIdx:r}=e,{stage:i}=e,s=i=="existing"?"proposed":"existing",u={mode:"select"},m=null,g=null,_=!1,b=!0,E=null,z;async function C(L){m=z.scrollTop,t(2,u={mode:"editing",id:L}),t(3,g=null),await xe(),t(7,z.scrollTop=0,z)}async function J(){t(2,u={mode:"select"}),m!=null&&(await xe(),t(7,z.scrollTop=m,z),m=null)}function p(){u.mode=="editing"&&window.confirm(`Delete this ${u.id.kind}?`)&&(u.id.kind=="movement"?(l.jat[r][i].movements.splice(u.id.idx,1),x.set(l)):(l.jat[r][i].arms.splice(u.id.idx,1),x.set(l)),J())}function v(L){if(u.mode!="editing")return;let $=L.target.tagName,S=$=="INPUT"||$=="TEXTAREA";L.key=="Escape"||L.key=="Enter"&&!S?(L.stopPropagation(),J()):L.key=="Delete"&&!S&&(L.stopPropagation(),p())}function N(){l.jat[r][i].arms.length>0&&!window.confirm("Overwrite arms?")||(Ne(x,l.jat[r][i].arms=JSON.parse(JSON.stringify(l.jat[r][s].arms)),l),x.set(l))}function f(){l.jat[r][i].movements.length>0&&!window.confirm("Overwrite movements?")||(Ne(x,l.jat[r][i].movements=JSON.parse(JSON.stringify(l.jat[r][s].movements)),l),x.set(l))}let c={0:ye.red,1:ye.amber,2:ye.green,X:ye.critical};function T(){l.jat[r][i].movements.length>0&&!window.confirm("Overwrite all movements?")||Ne(x,l.jat[r][i].movements=Hn(l.jat[r][i].arms),l)}function le(L){n.$$.not_equal(l.jat[r][i].notes,L)&&(l.jat[r][i].notes=L,x.set(l))}const ee=()=>E==null?void 0:E.zoom(!0);function te(L){_=L,t(4,_)}function H(L){b=L,t(5,b)}const M=L=>C({kind:"arm",idx:L}),ie=L=>t(3,g={kind:"arm",idx:L}),ve=()=>t(3,g=null),we=L=>C({kind:"movement",idx:L}),F=L=>t(3,g={kind:"movement",idx:L}),K=()=>t(3,g=null);function ae(L){n.$$.not_equal(l.jat[r][i].arms[u.id.idx].name,L)&&(l.jat[r][i].arms[u.id.idx].name=L,x.set(l))}function oe(L){ue[L?"unshift":"push"](()=>{z=L,t(7,z)})}function se(L){ue[L?"unshift":"push"](()=>{E=L,t(6,E)})}return n.$$set=L=>{"junctionIdx"in L&&t(0,r=L.junctionIdx),"stage"in L&&t(1,i=L.stage),"$$scope"in L&&t(32,a=L.$$scope)},[r,i,u,g,_,b,E,z,l,s,C,J,p,v,N,f,c,T,o,le,ee,te,H,M,ie,ve,we,F,K,ae,oe,se,a]}class ul extends Ae{constructor(e){super(),Pe(this,e,fl,sl,Ee,{junctionIdx:0,stage:1},null,[-1,-1])}}function ml(n){let e,t,l,o,a;return{c(){e=V("li"),t=V("a"),l=q(n[0]),this.h()},l(r){e=X(r,"LI",{class:!0});var i=Z(e);t=X(i,"A",{class:!0,href:!0});var s=Z(t);l=R(s,n[0]),s.forEach(d),i.forEach(d),this.h()},h(){Y(t,"class","govuk-tabs__tab"),Y(t,"href","#"),Y(e,"class","govuk-tabs__list-item")},m(r,i){j(r,e,i),y(e,t),y(t,l),o||(a=Lt(t,"click",Bt(n[2])),o=!0)},p(r,i){i&1&&fe(l,r[0])},d(r){r&&d(e),o=!1,a()}}}function cl(n){let e,t;return{c(){e=V("li"),t=q(n[0]),this.h()},l(l){e=X(l,"LI",{class:!0});var o=Z(e);t=R(o,n[0]),o.forEach(d),this.h()},h(){Y(e,"class","govuk-tabs__list-item govuk-tabs__list-item--selected")},m(l,o){j(l,e,o),y(e,t)},p(l,o){o&1&&fe(t,l[0])},d(l){l&&d(e)}}}function _l(n){let e;function t(a,r){return a[1]?cl:ml}let l=t(n),o=l(n);return{c(){o.c(),e=pe()},l(a){o.l(a),e=pe()},m(a,r){o.m(a,r),j(a,e,r)},p(a,[r]){l===(l=t(a))&&o?o.p(a,r):(o.d(1),o=l(a),o&&(o.c(),o.m(e.parentNode,e)))},i:Ie,o:Ie,d(a){a&&d(e),o.d(a)}}}function gl(n,e,t){let{label:l}=e,{isCurrent:o}=e;function a(r){Le.call(this,n,r)}return n.$$set=r=>{"label"in r&&t(0,l=r.label),"isCurrent"in r&&t(1,o=r.isCurrent)},[l,o,a]}class ht extends Ae{constructor(e){super(),Pe(this,e,gl,_l,Ee,{label:0,isCurrent:1})}}function vt(n,e,t){const l=n.slice();return l[10]=e[t],l[12]=t,l}function dl(n){let e,t,l=(n[1].jat[n[0].idx].name||"Untitled junction")+"",o,a,r=n[0].stage+"",i,s,u,m,g,_,b,E=n[0].stage,z,C;u=new Ot({props:{$$slots:{default:[vl]},$$scope:{ctx:n}}});function J(N){n[7](N)}let p={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(p.value=n[1].jat[n[0].idx].name),g=new Ze({props:p}),ue.push(()=>ge(g,"value",J));let v=bt(n);return{c(){e=V("div"),t=V("h2"),o=q(l),a=q(" - "),i=q(r),s=B(),A(u.$$.fragment),m=B(),A(g.$$.fragment),b=B(),v.c(),z=pe(),this.h()},l(N){e=X(N,"DIV",{class:!0});var f=Z(e);t=X(f,"H2",{});var c=Z(t);o=R(c,l),a=R(c," - "),i=R(c,r),c.forEach(d),s=O(f),P(u.$$.fragment,f),m=O(f),P(g.$$.fragment,f),f.forEach(d),b=O(N),v.l(N),z=pe(),this.h()},h(){Y(e,"class","govuk-width-container")},m(N,f){j(N,e,f),y(e,t),y(t,o),y(t,a),y(t,i),y(e,s),D(u,e,null),y(e,m),D(g,e,null),j(N,b,f),v.m(N,f),j(N,z,f),C=!0},p(N,f){(!C||f&3)&&l!==(l=(N[1].jat[N[0].idx].name||"Untitled junction")+"")&&fe(o,l),(!C||f&1)&&r!==(r=N[0].stage+"")&&fe(i,r);const c={};f&8193&&(c.$$scope={dirty:f,ctx:N}),u.$set(c);const T={};!_&&f&3&&(_=!0,T.value=N[1].jat[N[0].idx].name,_e(()=>_=!1)),g.$set(T),f&1&&Ee(E,E=N[0].stage)?($e(),w(v,1,1,Ie),he(),v=bt(N),v.c(),h(v,1),v.m(z.parentNode,z)):v.p(N,f)},i(N){C||(h(u.$$.fragment,N),h(g.$$.fragment,N),h(v),C=!0)},o(N){w(u.$$.fragment,N),w(g.$$.fragment,N),w(v),C=!1},d(N){N&&(d(e),d(b),d(z)),U(u),U(g),v.d(N)}}}function pl(n){let e,t,l,o;t=new We({props:{$$slots:{default:[kl]},$$scope:{ctx:n}}}),t.$on("click",n[2]);let a=be(n[1].jat),r=[];for(let s=0;s<a.length;s+=1)r[s]=kt(vt(n,a,s));const i=s=>w(r[s],1,1,()=>{r[s]=null});return{c(){e=V("div"),A(t.$$.fragment),l=B();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=X(s,"DIV",{class:!0});var u=Z(e);P(t.$$.fragment,u),l=O(u);for(let m=0;m<r.length;m+=1)r[m].l(u);u.forEach(d),this.h()},h(){Y(e,"class","govuk-width-container")},m(s,u){j(s,e,u),D(t,e,null),y(e,l);for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(e,null);o=!0},p(s,u){const m={};if(u&8192&&(m.$$scope={dirty:u,ctx:s}),t.$set(m),u&3){a=be(s[1].jat);let g;for(g=0;g<a.length;g+=1){const _=vt(s,a,g);r[g]?(r[g].p(_,u),h(r[g],1)):(r[g]=kt(_),r[g].c(),h(r[g],1),r[g].m(e,null))}for($e(),g=a.length;g<r.length;g+=1)i(g);he()}},i(s){if(!o){h(t.$$.fragment,s);for(let u=0;u<a.length;u+=1)h(r[u]);o=!0}},o(s){w(t.$$.fragment,s),r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)w(r[u]);o=!1},d(s){s&&d(e),U(t),De(r,s)}}}function $l(n){let e;return{c(){e=q("Back to all junctions")},l(t){e=R(t,"Back to all junctions")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function hl(n){let e;return{c(){e=q("Delete junction")},l(t){e=R(t,"Delete junction")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function vl(n){let e,t,l,o;return e=new Be({props:{$$slots:{default:[$l]},$$scope:{ctx:n}}}),e.$on("click",n[5]),l=new Ke({props:{$$slots:{default:[hl]},$$scope:{ctx:n}}}),l.$on("click",n[6]),{c(){A(e.$$.fragment),t=B(),A(l.$$.fragment)},l(a){P(e.$$.fragment,a),t=O(a),P(l.$$.fragment,a)},m(a,r){D(e,a,r),j(a,t,r),D(l,a,r),o=!0},p(a,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:a}),e.$set(i);const s={};r&8192&&(s.$$scope={dirty:r,ctx:a}),l.$set(s)},i(a){o||(h(e.$$.fragment,a),h(l.$$.fragment,a),o=!0)},o(a){w(e.$$.fragment,a),w(l.$$.fragment,a),o=!1},d(a){a&&d(t),U(e,a),U(l,a)}}}function bl(n){let e,t,l,o,a;return t=new ht({props:{label:"Existing",isCurrent:n[0].stage=="existing"}}),t.$on("click",n[8]),o=new ht({props:{label:"Proposed",isCurrent:n[0].stage=="proposed"}}),o.$on("click",n[9]),{c(){e=V("ul"),A(t.$$.fragment),l=B(),A(o.$$.fragment),this.h()},l(r){e=X(r,"UL",{class:!0,style:!0});var i=Z(e);P(t.$$.fragment,i),l=O(i),P(o.$$.fragment,i),i.forEach(d),this.h()},h(){Y(e,"class","govuk-tabs__list"),W(e,"list-style-type","none")},m(r,i){j(r,e,i),D(t,e,null),y(e,l),D(o,e,null),a=!0},p(r,i){const s={};i&1&&(s.isCurrent=r[0].stage=="existing"),t.$set(s);const u={};i&1&&(u.isCurrent=r[0].stage=="proposed"),o.$set(u)},i(r){a||(h(t.$$.fragment,r),h(o.$$.fragment,r),a=!0)},o(r){w(t.$$.fragment,r),w(o.$$.fragment,r),a=!1},d(r){r&&d(e),U(t),U(o)}}}function bt(n){let e,t;return e=new ul({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[bl]},$$scope:{ctx:n}}}),{c(){A(e.$$.fragment)},l(l){P(e.$$.fragment,l)},m(l,o){D(e,l,o),t=!0},p(l,o){const a={};o&1&&(a.junctionIdx=l[0].idx),o&1&&(a.stage=l[0].stage),o&8193&&(a.$$scope={dirty:o,ctx:l}),e.$set(a)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){w(e.$$.fragment,l),t=!1},d(l){U(e,l)}}}function kl(n){let e;return{c(){e=q("Add new junction")},l(t){e=R(t,"Add new junction")},m(t,l){j(t,e,l)},d(t){t&&d(e)}}}function wl(n){let e,t,l,o=ke(n[10].existing)+"",a,r,i,s,u=ke(n[10].proposed)+"",m,g;return{c(){e=V("div"),t=V("span"),l=q("Existing: "),a=q(o),r=B(),i=V("span"),s=q("Proposed: "),m=q(u),g=B(),this.h()},l(_){e=X(_,"DIV",{style:!0});var b=Z(e);t=X(b,"SPAN",{});var E=Z(t);l=R(E,"Existing: "),a=R(E,o),E.forEach(d),r=O(b),i=X(b,"SPAN",{});var z=Z(i);s=R(z,"Proposed: "),m=R(z,u),z.forEach(d),b.forEach(d),g=O(_),this.h()},h(){W(e,"width","100%"),W(e,"display","flex"),W(e,"justify-content","space-between")},m(_,b){j(_,e,b),y(e,t),y(t,l),y(t,a),y(e,r),y(e,i),y(i,s),y(i,m),j(_,g,b)},p(_,b){b&2&&o!==(o=ke(_[10].existing)+"")&&fe(a,o),b&2&&u!==(u=ke(_[10].proposed)+"")&&fe(m,u)},d(_){_&&(d(e),d(g))}}}function kt(n){let e,t;function l(){return n[4](n[12])}return e=new Qe({props:{name:n[10].name||"Untitled junction",$$slots:{default:[wl]},$$scope:{ctx:n}}}),e.$on("click",l),{c(){A(e.$$.fragment)},l(o){P(e.$$.fragment,o)},m(o,a){D(e,o,a),t=!0},p(o,a){n=o;const r={};a&2&&(r.name=n[10].name||"Untitled junction"),a&8194&&(r.$$scope={dirty:a,ctx:n}),e.$set(r)},i(o){t||(h(e.$$.fragment,o),t=!0)},o(o){w(e.$$.fragment,o),t=!1},d(o){U(e,o)}}}function jl(n){let e,t,l,o;const a=[pl,dl],r=[];function i(s,u){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=i(n))&&(t=r[e]=a[e](n)),{c(){t&&t.c(),l=pe()},l(s){t&&t.l(s),l=pe()},m(s,u){~e&&r[e].m(s,u),j(s,l,u),o=!0},p(s,[u]){let m=e;e=i(s),e===m?~e&&r[e].p(s,u):(t&&($e(),w(r[m],1,1,()=>{r[m]=null}),he()),~e?(t=r[e],t?t.p(s,u):(t=r[e]=a[e](s),t.c()),h(t,1),t.m(l.parentNode,l)):t=null)},i(s){o||(h(t),o=!0)},o(s){w(t),o=!1},d(s){s&&d(l),~e&&r[e].d(s)}}}function Ge(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Cl(n,e,t){let l;ze(n,x,b=>t(1,l=b));let o={kind:"list"};function a(){Ne(x,l.jat=[...l.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],l),t(0,o={kind:"edit",idx:l.jat.length-1,stage:"existing"})}function r(b){window.confirm("Delete this junction?")&&(l.jat.splice(b,1),x.set(l),t(0,o={kind:"list"}))}const i=b=>t(0,o={kind:"edit",idx:b,stage:"existing"}),s=()=>t(0,o={kind:"list"}),u=()=>r(Ge(o));function m(b){n.$$.not_equal(l.jat[o.idx].name,b)&&(l.jat[o.idx].name=b,x.set(l))}return[o,l,a,r,i,s,u,m,()=>t(0,o={kind:"edit",idx:Ge(o),stage:"existing"}),()=>t(0,o={kind:"edit",idx:Ge(o),stage:"proposed"})]}class Kl extends Ae{constructor(e){super(),Pe(this,e,Cl,jl,Ee,{})}}export{Kl as component};
