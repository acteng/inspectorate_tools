import{s as K,e as W,a as v,c as J,m as j,g as k,i as g,f as C,k as N,t as D,d as O}from"../chunks/scheduler.BJ06nkRu.js";import{S as M,i as U,c as w,a as b,m as S,t as _,b as L,d as P}from"../chunks/index.Dmc4uC9p.js";import{e as B}from"../chunks/da_log.sYbQnp3G.js";import{s as H}from"../chunks/data.Dx5wfgY1.js";import{D as G}from"../chunks/DefaultButton.CRXvyloG.js";/* empty css                                                               */import{T as I}from"../chunks/TextArea.dqrL6eGj.js";import{E as V}from"../chunks/exceljs.min.BuyXGIGS.js";import{g as q,a as X}from"../chunks/lists.djxH55N_.js";const z=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function Q(e){console.log("Loading blank route check xlsx");let t=await(await fetch(z)).arrayBuffer(),l=new V.Workbook;await l.xlsx.load(t),l.eachSheet((u,r)=>{u.conditionalFormattings=[]}),Y(e,l),Z(e,l),ee(e,l),te(e,l),y(e.safetyCheck,l,"3.1 Safety Check",["J","K","L","M"],d([[13,28]])),y(e.streetCheck,l,"4.1 Street Check",["J","K","L","M"],d([[13,19],[23,25],[29,34],[38,43],[47,50]])),y(e.streetPlacemakingCheck,l,"4.2 Street Placemaking Check",["I","J","K","L"],d([[13,15],[19,21],[25,34],[38,47]])),y(e.pathCheck,l,"5.1 Path Check",["J","K","L","M"],d([[15,19],[23,33],[37,40],[44,48],[52,56]])),y(e.pathPlacemakingCheck,l,"5.2 Path Placemaking Check",["I","J","K","L"],d([[12,14],[20,22],[26,29],[33,41]])),le(e,l),l.getWorksheet("5.1 Path Check").getCell("D7").value=e.horseRiders,l.getWorksheet("7.1 Results Summary").getCell("G7").value=e.resultsReviewStatement,console.log("Writing route check xlsx");let o=await l.xlsx.writeBuffer();ae(o,"out.xlsx")}function Y(e,n){let t=n.getWorksheet("1. Summary of Scheme");t.getCell("C6").value=e.summary.dateDesignReview,t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.assessedRouteLengthKm,t.getCell("C19").value=e.summary.totalRouteLengthKm,t.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(t.getCell("D22").value="Path Check")}function Z(e,n){let t=n.getWorksheet("2.1 Policy Check");for(let l=0;l<6;l++)t.getCell("D"+(8+l)).value=e.policyCheck[l].existing,t.getCell("E"+(8+l)).value=e.policyCheck[l].proposed,t.getCell("F"+(8+l)).value=e.policyCheck[l].commentary}function ee(e,n){let t=n.getWorksheet("2.2 Policy Conflict Log");for(let[l,o]of e.policyConflictLog.entries())t.getCell("F"+(8+l)).value=q(o.conflict),t.getCell("H"+(8+l)).value=o.stage,t.getCell("I"+(8+l)).value=F(o.point),t.getCell("J"+(8+l)).value=o.locationName,t.getCell("K"+(8+l)).value=o.resolved,t.getCell("L"+(8+l)).value=o.notes}function te(e,n){let t=n.getWorksheet("3.2 Critical Issues Log");for(let[l,o]of e.criticalIssues.entries())t.getCell("F"+(8+l)).value=X(o.criticalIssue),t.getCell("H"+(8+l)).value=o.stage,t.getCell("I"+(8+l)).value=F(o.point),t.getCell("J"+(8+l)).value=o.locationName,t.getCell("K"+(8+l)).value=o.resolved,t.getCell("L"+(8+l)).value=o.notes}function y(e,n,t,l,o){let u=n.getWorksheet(t);if(o.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${t}`);for(let r=0;r<e.existingScores.length;r++){let s=o[r];u.getCell(l[0]+s).value=E(e.existingScores[r]),u.getCell(l[1]+s).value=e.existingScoreNotes[r],u.getCell(l[2]+s).value=E(e.proposedScores[r]),u.getCell(l[3]+s).value=e.proposedScoreNotes[r]}}function le(e,n){let t=n.getWorksheet("6. JAT Check"),l=0;for(let o of e.jat)for(let u of[o.existing,o.proposed]){let r=h("H",l*5);t.getCell(h(r,1)+"9").value=o.name,t.getCell(h(r,1)+"10").value=u.notes;for(let[s,i]of u.movements.filter(f=>f.kind=="walking & wheeling").entries())t.getCell(r+(13+s)).value=i.name,t.getCell(h(r,2)+(13+s)).value=A(i.score),t.getCell(h(r,3)+(13+s)).value=i.notes;for(let[s,i]of u.movements.filter(f=>f.kind=="cycling").entries())t.getCell(r+(26+s)).value=i.name,t.getCell(h(r,2)+(26+s)).value=A(i.score),t.getCell(h(r,3)+(26+s)).value=i.notes;l++}}function h(e,n){return ne(oe(e)+n)}function oe(e){let n=0;for(let t=0;t<e.length;t++)n*=26,n+=e.charCodeAt(t)-65+1;return n-1}function ne(e){let n="";for(e+=1;e>0;){let t=(e-1)%26;n=String.fromCharCode(t+65)+n,e=Math.floor((e-1)/26)}return n}function d(e){let n=[];for(let[t,l]of e)for(let o=t;o<=l;o++)n.push(o);return n}function E(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function A(e){return{0:0,1:1,2:2,X:e}[e]}function F(e){return`${e[1]}, ${e[0]}`}function ae(e,n){let t=new Blob([e],{type:"application/octet-stream"}),l=URL.createObjectURL(t),o=document.createElement("a");o.href=l,o.download=n,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(l)}function re(e){let n;return{c(){n=D("Convert to .xlsx (takes a few seconds)")},l(t){n=O(t,"Convert to .xlsx (takes a few seconds)")},m(t,l){g(t,n,l)},d(t){t&&C(n)}}}function ie(e){let n,t=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,l,o,u,r,s,i,f,c,$,p,R=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9</i>`,x;return o=new I({props:{label:"TSV output, just the one row of values",value:e[3]}}),r=new I({props:{label:"TSV output with header",value:`${e[2]}
${e[3]}
`}}),i=new I({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(e[1]),null,"  ")}}),c=new G({props:{$$slots:{default:[re]},$$scope:{ctx:e}}}),c.$on("click",e[4]),{c(){n=W("p"),n.textContent=t,l=v(),w(o.$$.fragment),u=v(),w(r.$$.fragment),s=v(),w(i.$$.fragment),f=v(),w(c.$$.fragment),$=v(),p=W("p"),p.innerHTML=R},l(a){n=J(a,"P",{"data-svelte-h":!0}),j(n)!=="svelte-5ssfe3"&&(n.textContent=t),l=k(a),b(o.$$.fragment,a),u=k(a),b(r.$$.fragment,a),s=k(a),b(i.$$.fragment,a),f=k(a),b(c.$$.fragment,a),$=k(a),p=J(a,"P",{"data-svelte-h":!0}),j(p)!=="svelte-6hhtkc"&&(p.innerHTML=R)},m(a,m){g(a,n,m),g(a,l,m),S(o,a,m),g(a,u,m),S(r,a,m),g(a,s,m),S(i,a,m),g(a,f,m),S(c,a,m),g(a,$,m),g(a,p,m),x=!0},p(a,[m]){const T={};m&64&&(T.$$scope={dirty:m,ctx:a}),c.$set(T)},i(a){x||(_(o.$$.fragment,a),_(r.$$.fragment,a),_(i.$$.fragment,a),_(c.$$.fragment,a),x=!0)},o(a){L(o.$$.fragment,a),L(r.$$.fragment,a),L(i.$$.fragment,a),L(c.$$.fragment,a),x=!1},d(a){a&&(C(n),C(l),C(u),C(s),C(f),C($),C(p)),P(o,a),P(r,a),P(i,a),P(c,a)}}}function se(e,n,t){let l;N(e,H,i=>t(0,l=i));let o=B(l),u=o.map(i=>i[0]).join("	"),r=o.map(i=>`"${i[1]}"`).join("	");return[l,o,u,r,()=>Q(l)]}class ke extends M{constructor(n){super(),U(this,n,se,ie,K,{})}}export{ke as component};
