import{s as ye,v as x,x as ne,l as Re,u as Ue,m as Je,o as Ke,H as se,E as pe,i as L,f as b,a9 as hn,a8 as pn,k as he,U as Rt,a7 as Ut,N as Be,e as Q,c as Y,b as oe,r as We,a as z,g as D,q as qe,n as it,t as K,d as W,w as ee,h as ae,j as be,z as bn,p as yt}from"../chunks/scheduler.Bsni_e59.js";import{S as ve,i as we,e as re,c as A,a as S,m as F,t as y,b as C,d as B,g as ue,f as fe}from"../chunks/index.CCfAUppz.js";import{e as ce}from"../chunks/each.ChCadThl.js";import{W as Jt,S as ge}from"../chunks/WarningButton.D9QeV9gM.js";import{T as lt}from"../chunks/TextInput.CHbK327s.js";import{s as Z}from"../chunks/data.BglLXZFt.js";import{L as Kt,a as Wt,e as yn,m as Me,i as vn,f as Vt,M as wn,G as vt,h as wt,g as kn}from"../chunks/MapLibreMap.BkmyDhLI.js";import{c as Ge}from"../chunks/colors.CYEpEtTL.js";import{a as jn,c as Cn,M as et,C as Ln,R as En,B as $n,G as Mn,S as Pn}from"../chunks/GeoreferenceLayer.CMWElfEA.js";import{C as In}from"../chunks/CollapsibleCard.DoOZ0Bze.js";import{D as On}from"../chunks/DefaultButton.DyQsHGbh.js";import{T as Xt}from"../chunks/TextArea.DbePhW6L.js";import{p as Tn}from"../chunks/index.DHsT-xDz.js";import{S as kt}from"../chunks/Select.N7F_8zcJ.js";function An(t){let e;const n=t[15].default,r=Re(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&Ue(r,n,o,o[23],e?Ke(n,o[23],l,null):Je(o[23]),null)},i(o){e||(y(r,o),e=!0)},o(o){C(r,o),e=!1},d(o){r&&r.d(o)}}}function Sn(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[An]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Kt({props:l}),x.push(()=>re(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],ne(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function Fn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Wt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:m}=e,{layout:v=void 0}=e,{filter:c=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:h=void 0}=e,{hoverCursor:f=void 0}=e,{manageHoverState:p=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:R=!0}=e;function M(P){I=P,n(0,I)}function w(P){se.call(this,t,P)}function E(P){se.call(this,t,P)}function q(P){se.call(this,t,P)}function V(P){se.call(this,t,P)}function G(P){se.call(this,t,P)}function T(P){se.call(this,t,P)}return t.$$set=P=>{"id"in P&&n(1,l=P.id),"source"in P&&n(2,i=P.source),"sourceLayer"in P&&n(3,a=P.sourceLayer),"beforeId"in P&&n(4,s=P.beforeId),"beforeLayerType"in P&&n(5,g=P.beforeLayerType),"paint"in P&&n(6,m=P.paint),"layout"in P&&n(7,v=P.layout),"filter"in P&&n(8,c=P.filter),"minzoom"in P&&n(9,d=P.minzoom),"maxzoom"in P&&n(10,h=P.maxzoom),"hoverCursor"in P&&n(11,f=P.hoverCursor),"manageHoverState"in P&&n(12,p=P.manageHoverState),"hovered"in P&&n(0,I=P.hovered),"eventsIfTopMost"in P&&n(13,N=P.eventsIfTopMost),"interactive"in P&&n(14,R=P.interactive),"$$scope"in P&&n(23,o=P.$$scope)},[I,l,i,a,s,g,m,v,c,d,h,f,p,N,R,r,M,w,E,q,V,G,T,o]}class tt extends ve{constructor(e){super(),we(this,e,Fn,Sn,ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Bn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),jt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function Ct(t){let e,n,r=(t[4]||t[3]instanceof Me.Marker)&&Lt(t);return{c(){e=Q("div"),r&&r.c()},l(o){e=Y(o,"DIV",{});var l=oe(e);r&&r.l(l),l.forEach(b)},m(o,l){L(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof Me.Marker?r?(r.p(o,l),l[0]&24&&y(r,1)):(r=Lt(o),r.c(),y(r,1),r.m(e,null)):r&&(ue(),C(r,1,1,()=>{r=null}),fe())},i(o){n||(y(r),n=!0)},o(o){C(r),n=!1},d(o){o&&b(e),r&&r.d(),t[32](null)}}}function Lt(t){let e;const n=t[30].default,r=Re(n,t,t[29],jt);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&Ue(r,n,o,o[29],e?Ke(n,o[29],l,Bn):Je(o[29]),jt)},i(o){e||(y(r,o),e=!0)},o(o){C(r,o),e=!1},d(o){r&&r.d(o)}}}function qn(t){let e,n,r=t[9].default&&Ct(t);return{c(){r&&r.c(),e=pe()},l(o){r&&r.l(o),e=pe()},m(o,l){r&&r.m(o,l),L(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&y(r,1)):(r=Ct(o),r.c(),y(r,1),r.m(e.parentNode,e)):r&&(ue(),C(r,1,1,()=>{r=null}),fe())},i(o){n||(y(r),n=!0)},o(o){C(r),n=!1},d(o){o&&b(e),r&&r.d(o)}}}function Nn(t,e,n){let r,o,l,i,a,s,{$$slots:g={},$$scope:m}=e;const v=hn(g);let{closeButton:c=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:h=!1}=e,{closeOnMove:f=!1}=e,{openOn:p="click"}=e,{openIfTopMost:I=!0}=e,{focusAfterOpen:N=!0}=e,{anchor:R=void 0}=e,{offset:M=void 0}=e,{popupClass:w=void 0}=e,{maxWidth:E=void 0}=e,{lngLat:q=void 0}=e,{html:V=void 0}=e,{open:G=!1}=e;const T=pn(),{map:P,popupTarget:j,layerEvent:te,layer:$,eventTopMost:Oe}=yn();he(t,P,k=>n(2,l=k)),he(t,j,k=>n(3,a=k)),he(t,te,k=>n(28,i=k)),he(t,$,k=>n(35,s=k));const u=["click","dblclick","contextmenu"];let _,H=!1,X;function O(){if(!_)return;let k=_.getElement();!k||k===X||(X=k,p==="hover"&&(X.style.pointerEvents="none"),X.addEventListener("mouseenter",()=>{n(24,H=!0)},{passive:!0}),X.addEventListener("mouseleave",()=>{n(24,H=!1)},{passive:!0}),X.addEventListener("click",()=>{h&&n(0,G=!1)},{passive:!0}))}Rt(()=>{if(l)return l.on("click",Ne),l.on("contextmenu",Ne),typeof a=="string"&&(l.on("click",a,Ee),l.on("dblclick",a,Ee),l.on("contextmenu",a,Ee),l.on("mousemove",a,bt),l.on("mouseleave",a,pt),l.on("touchstart",a,_t),l.on("touchend",a,ht)),()=>{l!=null&&l.loaded()&&(_==null||_.remove(),l.off("click",Ne),l.off("contextmenu",Ne),a instanceof Me.Marker?a.getPopup()===_&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,Ee),l.off("dblclick",a,Ee),l.off("contextmenu",a,Ee),l.off("mousemove",a,bt),l.off("mouseleave",a,pt),l.off("touchstart",a,_t),l.off("touchend",a,ht)))}});function _e(k){return I?!("marker"in k)&&!vn(k)&&Oe(k)!==s:!1}let me=null,de="normal";function Ee(k){k.type===p&&(_e(k)||("layerType"in k?k.layerType==="deckgl"?(n(10,q=k.coordinate),n(4,me=k.object?[k.object]:null)):(n(10,q=k.lngLat),n(4,me=k.features??[])):(n(10,q=k.lngLat),n(4,me=k.features??[])),setTimeout(()=>n(0,G=!0))))}let $e=null;function _t(k){$e=k.point}function ht(k){if(!$e||p!=="hover")return;let Ye=$e.dist(k.point);$e=null,Ye<3&&(n(10,q=k.lngLat),n(4,me=k.features??[]),_.isOpen()?n(25,de="justOpened"):(n(25,de="opening"),n(0,G=!0)))}function pt(k){p!=="hover"||$e||de!=="normal"||(n(0,G=!1),n(4,me=null))}function bt(k){if(!(p!=="hover"||$e||de!=="normal")){if(_e(k)){n(0,G=!1),n(4,me=null);return}n(0,G=!0),n(4,me=k.features??[]),n(10,q=k.lngLat)}}function Ne(k){if(de==="justOpened"){n(25,de="normal");return}if(!d)return;let Ye=[X,a instanceof Me.Marker?a==null?void 0:a.getElement():null];G&&_.isOpen()&&!Ye.some(xe=>xe==null?void 0:xe.contains(k.originalEvent.target))&&(k.type==="contextmenu"&&p==="contextmenu"||k.type!=="contextmenu")&&n(0,G=!1)}Ut(()=>{l&&(_!=null&&_.isOpen())&&_.remove()});let Te;const dn=()=>n(0,G=!1);function _n(k){x[k?"unshift":"push"](()=>{Te=k,n(1,Te)})}return t.$$set=k=>{"closeButton"in k&&n(11,c=k.closeButton),"closeOnClickOutside"in k&&n(12,d=k.closeOnClickOutside),"closeOnClickInside"in k&&n(13,h=k.closeOnClickInside),"closeOnMove"in k&&n(14,f=k.closeOnMove),"openOn"in k&&n(15,p=k.openOn),"openIfTopMost"in k&&n(16,I=k.openIfTopMost),"focusAfterOpen"in k&&n(17,N=k.focusAfterOpen),"anchor"in k&&n(18,R=k.anchor),"offset"in k&&n(19,M=k.offset),"popupClass"in k&&n(20,w=k.popupClass),"maxWidth"in k&&n(21,E=k.maxWidth),"lngLat"in k&&n(10,q=k.lngLat),"html"in k&&n(22,V=k.html),"open"in k&&n(0,G=k.open),"$$scope"in k&&n(29,m=k.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=c??(!d&&!h)),t.$$.dirty[0]&146685952&&(_||(n(23,_=new Me.Popup({closeButton:r,closeOnClick:!1,closeOnMove:f,focusAfterOpen:N,maxWidth:E,className:w,anchor:R,offset:M})),X=_.getElement(),_.on("open",()=>{n(0,G=!0),O(),T("open",_)}),_.on("close",()=>{n(0,G=!1),T("close",_)}),_.on("hover",()=>{T("hover",_)}))),t.$$.dirty[0]&8421384&&_&&a instanceof Me.Marker&&(p==="click"?a.setPopup(_):a.getPopup()===_&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&u.includes(p)&&(i==null?void 0:i.type)===p&&(Ee(i),Be(te,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=p==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&p==="hover"&&te&&(o&&i&&(i.layerType==="deckgl"?(n(10,q=i.coordinate),n(4,me=i.object?[i.object]:null)):(n(10,q=i.lngLat),n(4,me=i.features??[]))),n(0,G=(o||H)??!1)),t.$$.dirty[0]&12582914&&(Te?_.setDOMContent(Te):V&&_.setHTML(V)),t.$$.dirty[0]&8389632&&q&&_.setLngLat(q),t.$$.dirty[0]&41943045&&l){let k=_.isOpen();G&&!k?(_.addTo(l),de==="opening"&&n(25,de="justOpened")):!G&&k&&_.remove()}},[G,Te,l,a,me,P,j,te,$,v,q,c,d,h,f,p,I,N,R,M,w,E,V,_,H,de,o,r,i,m,g,dn,_n]}class Gn extends ve{constructor(e){super(),we(this,e,Nn,qn,ye,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function zn(t){let e;const n=t[16].default,r=Re(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Ue(r,n,o,o[24],e?Ke(n,o[24],l,null):Je(o[24]),null)},i(o){e||(y(r,o),e=!0)},o(o){C(r,o),e=!1},d(o){r&&r.d(o)}}}function Dn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[zn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Kt({props:l}),x.push(()=>re(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],ne(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function Hn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Wt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:m=void 0}=e,{layout:v=void 0}=e,{filter:c=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:h=void 0}=e,{maxzoom:f=void 0}=e,{hoverCursor:p=void 0}=e,{manageHoverState:I=!1}=e,{hovered:N=null}=e,{eventsIfTopMost:R=!1}=e,{interactive:M=!0}=e;function w(j){N=j,n(0,N)}function E(j){se.call(this,t,j)}function q(j){se.call(this,t,j)}function V(j){se.call(this,t,j)}function G(j){se.call(this,t,j)}function T(j){se.call(this,t,j)}function P(j){se.call(this,t,j)}return t.$$set=j=>{"id"in j&&n(1,l=j.id),"source"in j&&n(2,i=j.source),"sourceLayer"in j&&n(3,a=j.sourceLayer),"beforeId"in j&&n(4,s=j.beforeId),"beforeLayerType"in j&&n(5,g=j.beforeLayerType),"paint"in j&&n(6,m=j.paint),"layout"in j&&n(7,v=j.layout),"filter"in j&&n(8,c=j.filter),"applyToClusters"in j&&n(9,d=j.applyToClusters),"minzoom"in j&&n(10,h=j.minzoom),"maxzoom"in j&&n(11,f=j.maxzoom),"hoverCursor"in j&&n(12,p=j.hoverCursor),"manageHoverState"in j&&n(13,I=j.manageHoverState),"hovered"in j&&n(0,N=j.hovered),"eventsIfTopMost"in j&&n(14,R=j.eventsIfTopMost),"interactive"in j&&n(15,M=j.interactive),"$$scope"in j&&n(24,o=j.$$scope)},[N,l,i,a,s,g,m,v,c,d,h,f,p,I,R,M,r,w,E,q,V,G,T,P,o]}class Rn extends ve{constructor(e){super(),we(this,e,Hn,Dn,ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Un=t=>({props:t&8}),Et=t=>({props:Wn(t[3])});function Jn(t){let e,n;const r=t[1].default,o=Re(r,t,t[2],Et);return{c(){e=Q("div"),o&&o.c(),this.h()},l(l){e=Y(l,"DIV",{class:!0});var i=oe(e);o&&o.l(i),i.forEach(b),this.h()},h(){We(e,"class","govuk-prose")},m(l,i){L(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&Ue(o,r,l,l[2],n?Ke(r,l[2],i,Un):Je(l[2]),Et)},i(l){n||(y(o,l),n=!0)},o(l){C(o,l),n=!1},d(l){l&&b(e),o&&o.d(l)}}}function Kn(t){let e,n;return e=new Gn({props:{openOn:t[0],$$slots:{default:[Jn,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function Wn(t){return t?t[0].properties??{}:{}}function Vn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Zt extends ve{constructor(e){super(),we(this,e,Vn,Kn,ye,{openOn:0})}}var Xn=Object.defineProperty,U=(t,e)=>Xn(t,"name",{value:e,configurable:!0}),Zn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ae(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=nt(e),o=nt(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ae(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ae(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Vt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ae(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};U(Zn,"GeojsonEquality");function Ae(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}U(Ae,"sameLength");function nt(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}U(nt,"explode");var ie=63710088e-1,Qt={centimeters:ie*100,centimetres:ie*100,degrees:360/(2*Math.PI),feet:ie*3.28084,inches:ie*39.37,kilometers:ie/1e3,kilometres:ie/1e3,meters:ie,metres:ie,miles:ie/1609.344,millimeters:ie*1e3,millimetres:ie*1e3,nauticalmiles:ie/1852,radians:1,yards:ie*1.0936},$t={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ke(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}U(ke,"feature");function Qn(t,e,n={}){switch(t){case"Point":return Ve(e).geometry;case"LineString":return st(e).geometry;case"Polygon":return at(e).geometry;case"MultiPoint":return xt(e).geometry;case"MultiLineString":return Yt(e).geometry;case"MultiPolygon":return en(e).geometry;default:throw new Error(t+" is invalid")}}U(Qn,"geometry");function Ve(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pe(t[0])||!Pe(t[1]))throw new Error("coordinates must contain numbers");return ke({type:"Point",coordinates:t},e,n)}U(Ve,"point");function Yn(t,e,n={}){return Xe(t.map(r=>Ve(r,e)),n)}U(Yn,"points");function at(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ke({type:"Polygon",coordinates:t},e,n)}U(at,"polygon");function xn(t,e,n={}){return Xe(t.map(r=>at(r,e)),n)}U(xn,"polygons");function st(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ke({type:"LineString",coordinates:t},e,n)}U(st,"lineString");function er(t,e,n={}){return Xe(t.map(r=>st(r,e)),n)}U(er,"lineStrings");function Xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}U(Xe,"featureCollection");function Yt(t,e,n={}){return ke({type:"MultiLineString",coordinates:t},e,n)}U(Yt,"multiLineString");function xt(t,e,n={}){return ke({type:"MultiPoint",coordinates:t},e,n)}U(xt,"multiPoint");function en(t,e,n={}){return ke({type:"MultiPolygon",coordinates:t},e,n)}U(en,"multiPolygon");function tr(t,e,n={}){return ke({type:"GeometryCollection",geometries:t},e,n)}U(tr,"geometryCollection");function nr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}U(nr,"round");function tn(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t*n}U(tn,"radiansToLength");function Ze(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t/n}U(Ze,"lengthToRadians");function rr(t,e){return He(Ze(t,e))}U(rr,"lengthToDegrees");function or(t){let e=t%360;return e<0&&(e+=360),e}U(or,"bearingToAzimuth");function He(t){return t%(2*Math.PI)*180/Math.PI}U(He,"radiansToDegrees");function De(t){return t%360*Math.PI/180}U(De,"degreesToRadians");function ir(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return tn(Ze(t,e),n)}U(ir,"convertLength");function lr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=$t[e];if(!r)throw new Error("invalid original units");const o=$t[n];if(!o)throw new Error("invalid final units");return t/r*o}U(lr,"convertArea");function Pe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}U(Pe,"isNumber");function ar(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}U(ar,"isObject");function sr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Pe(e))throw new Error("bbox must only contain numbers")})}U(sr,"validateBBox");function ur(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}U(ur,"validateId");var fr=Object.defineProperty,je=(t,e)=>fr(t,"name",{value:e,configurable:!0});function nn(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}je(nn,"getCoord");function mr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}je(mr,"getCoords");function rn(t){if(t.length>1&&Pe(t[0])&&Pe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return rn(t[0]);throw new Error("coordinates must only contain numbers")}je(rn,"containsNumber");function cr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}je(cr,"geojsonType");function gr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}je(gr,"featureOf");function dr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}je(dr,"collectionOf");function _r(t){return t.type==="Feature"?t.geometry:t}je(_r,"getGeom");function hr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}je(hr,"getType");var pr=Object.defineProperty,br=(t,e)=>pr(t,"name",{value:e,configurable:!0});function on(t,e,n,r={}){const o=nn(t),l=De(o[0]),i=De(o[1]),a=De(n),s=Ze(e,r.units),g=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),m=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(g)),v=He(m),c=He(g);return Ve([v,c],r.properties)}br(on,"destination");var yr=on,vr=Object.defineProperty,J=(t,e)=>vr(t,"name",{value:e,configurable:!0}),wr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Se(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=rt(e),o=rt(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Se(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Se(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Vt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Se(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(wr,"GeojsonEquality");function Se(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(Se,"sameLength");function rt(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(rt,"explode");var le=63710088e-1,ln={centimeters:le*100,centimetres:le*100,degrees:360/(2*Math.PI),feet:le*3.28084,inches:le*39.37,kilometers:le/1e3,kilometres:le/1e3,meters:le,metres:le,miles:le/1609.344,millimeters:le*1e3,millimetres:le*1e3,nauticalmiles:le/1852,radians:1,yards:le*1.0936},Mt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ce(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J(Ce,"feature");function kr(t,e,n={}){switch(t){case"Point":return ut(e).geometry;case"LineString":return mt(e).geometry;case"Polygon":return ft(e).geometry;case"MultiPoint":return sn(e).geometry;case"MultiLineString":return an(e).geometry;case"MultiPolygon":return un(e).geometry;default:throw new Error(t+" is invalid")}}J(kr,"geometry");function ut(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ie(t[0])||!Ie(t[1]))throw new Error("coordinates must contain numbers");return Ce({type:"Point",coordinates:t},e,n)}J(ut,"point");function jr(t,e,n={}){return Qe(t.map(r=>ut(r,e)),n)}J(jr,"points");function ft(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return Ce({type:"Polygon",coordinates:t},e,n)}J(ft,"polygon");function Cr(t,e,n={}){return Qe(t.map(r=>ft(r,e)),n)}J(Cr,"polygons");function mt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Ce({type:"LineString",coordinates:t},e,n)}J(mt,"lineString");function Lr(t,e,n={}){return Qe(t.map(r=>mt(r,e)),n)}J(Lr,"lineStrings");function Qe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(Qe,"featureCollection");function an(t,e,n={}){return Ce({type:"MultiLineString",coordinates:t},e,n)}J(an,"multiLineString");function sn(t,e,n={}){return Ce({type:"MultiPoint",coordinates:t},e,n)}J(sn,"multiPoint");function un(t,e,n={}){return Ce({type:"MultiPolygon",coordinates:t},e,n)}J(un,"multiPolygon");function Er(t,e,n={}){return Ce({type:"GeometryCollection",geometries:t},e,n)}J(Er,"geometryCollection");function $r(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J($r,"round");function fn(t,e="kilometers"){const n=ln[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(fn,"radiansToLength");function ct(t,e="kilometers"){const n=ln[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(ct,"lengthToRadians");function Mr(t,e){return gt(ct(t,e))}J(Mr,"lengthToDegrees");function Pr(t){let e=t%360;return e<0&&(e+=360),e}J(Pr,"bearingToAzimuth");function gt(t){return t%(2*Math.PI)*180/Math.PI}J(gt,"radiansToDegrees");function Fe(t){return t%360*Math.PI/180}J(Fe,"degreesToRadians");function Ir(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return fn(ct(t,e),n)}J(Ir,"convertLength");function Or(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Mt[e];if(!r)throw new Error("invalid original units");const o=Mt[n];if(!o)throw new Error("invalid final units");return t/r*o}J(Or,"convertArea");function Ie(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(Ie,"isNumber");function Tr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(Tr,"isObject");function Ar(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ie(e))throw new Error("bbox must only contain numbers")})}J(Ar,"validateBBox");function Sr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(Sr,"validateId");var Fr=Object.defineProperty,Le=(t,e)=>Fr(t,"name",{value:e,configurable:!0});function ot(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Le(ot,"getCoord");function Br(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Le(Br,"getCoords");function mn(t){if(t.length>1&&Ie(t[0])&&Ie(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return mn(t[0]);throw new Error("coordinates must only contain numbers")}Le(mn,"containsNumber");function qr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}Le(qr,"geojsonType");function Nr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}Le(Nr,"featureOf");function Gr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}Le(Gr,"collectionOf");function zr(t){return t.type==="Feature"?t.geometry:t}Le(zr,"getGeom");function Dr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Le(Dr,"getType");var Hr=Object.defineProperty,cn=(t,e)=>Hr(t,"name",{value:e,configurable:!0});function dt(t,e,n={}){if(n.final===!0)return gn(t,e);const r=ot(t),o=ot(e),l=Fe(r[0]),i=Fe(o[0]),a=Fe(r[1]),s=Fe(o[1]),g=Math.sin(i-l)*Math.cos(s),m=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return gt(Math.atan2(g,m))}cn(dt,"bearing");function gn(t,e){let n=dt(e,t);return n=(n+180)%360,n}cn(gn,"calculateFinalBearing");var Rr=dt;function Pt(t,e,n){const r=t.slice();return r[30]=e[n],r[31]=e,r[32]=n,r}function It(t,e,n){const r=t.slice();return r[33]=e[n],r[34]=e,r[32]=n,r}function Ur(t){let e,n=to(t[32])+"",r;return{c(){e=Q("span"),r=K(n),this.h()},l(o){e=Y(o,"SPAN",{class:!0});var l=oe(e);r=W(l,n),l.forEach(b),this.h()},h(){We(e,"class","dot svelte-o3xbby"),ee(e,"color","#4472c4"),ee(e,"background-color","white")},m(o,l){L(o,e,l),ae(e,r)},p:it,d(o){o&&b(e)}}}function Ot(t){let e,n,r;function o(s){t[15](s,t[33])}function l(){return t[16](t[32])}function i(){return t[17](t[32])}let a={draggable:!0,$$slots:{default:[Ur]},$$scope:{ctx:t}};return t[33].point!==void 0&&(a.lngLat=t[33].point),e=new et({props:a}),x.push(()=>re(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){A(e.$$.fragment)},l(s){S(e.$$.fragment,s)},m(s,g){F(e,s,g),r=!0},p(s,g){t=s;const m={};g[1]&16&&(m.$$scope={dirty:g,ctx:t}),!n&&g[0]&7&&(n=!0,m.lngLat=t[33].point,ne(()=>n=!1)),e.$set(m)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){C(e.$$.fragment,s),r=!1},d(s){B(e,s)}}}function Jr(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){We(e,"class","dot svelte-o3xbby"),ee(e,"background-color",t[5][t[30].score]),ee(e,"opacity",t[30].kind=="pedestrian"?"0%":"100%")},m(n,r){L(n,e,r)},p(n,r){r[0]&7&&ee(e,"background-color",n[5][n[30].score]),r[0]&7&&ee(e,"opacity",n[30].kind=="pedestrian"?"0%":"100%")},d(n){n&&b(e)}}}function Kr(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){We(e,"class","dot svelte-o3xbby"),ee(e,"background-color",t[5][t[30].score]),ee(e,"opacity","0%")},m(n,r){L(n,e,r)},p(n,r){r[0]&7&&ee(e,"background-color",n[5][n[30].score])},d(n){n&&b(e)}}}function Tt(t){let e,n,r,o,l,i;function a(f){t[18](f,t[30])}function s(){return t[19](t[32])}function g(){return t[20](t[32])}let m={draggable:!0,$$slots:{default:[Jr]},$$scope:{ctx:t}};t[30].point1!==void 0&&(m.lngLat=t[30].point1),e=new et({props:m}),x.push(()=>re(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",g);function v(f){t[21](f,t[30])}function c(){return t[22](t[32])}function d(){return t[23](t[32])}let h={draggable:!0,$$slots:{default:[Kr]},$$scope:{ctx:t}};return t[30].point2!==void 0&&(h.lngLat=t[30].point2),o=new et({props:h}),x.push(()=>re(o,"lngLat",v)),o.$on("dragend",c),o.$on("click",d),{c(){A(e.$$.fragment),r=z(),A(o.$$.fragment)},l(f){S(e.$$.fragment,f),r=D(f),S(o.$$.fragment,f)},m(f,p){F(e,f,p),L(f,r,p),F(o,f,p),i=!0},p(f,p){t=f;const I={};p[0]&7|p[1]&16&&(I.$$scope={dirty:p,ctx:t}),!n&&p[0]&7&&(n=!0,I.lngLat=t[30].point1,ne(()=>n=!1)),e.$set(I);const N={};p[0]&7|p[1]&16&&(N.$$scope={dirty:p,ctx:t}),!l&&p[0]&7&&(l=!0,N.lngLat=t[30].point2,ne(()=>l=!1)),o.$set(N)},i(f){i||(y(e.$$.fragment,f),y(o.$$.fragment,f),i=!0)},o(f){C(e.$$.fragment,f),C(o.$$.fragment,f),i=!1},d(f){f&&b(r),B(e,f),B(o,f)}}}function Wr(t){let e=(t[29].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=W(r,e)},m(r,o){L(r,n,o)},p(r,o){o[0]&536870912&&e!==(e=(r[29].name||"Untitled movement")+"")&&be(n,e)},d(r){r&&b(n)}}}function Vr(t){let e,n;return e=new Zt({props:{$$slots:{default:[Wr,({props:r})=>({29:r}),({props:r})=>[r?536870912:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function Xr(t){let e=(t[29].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=W(r,e)},m(r,o){L(r,n,o)},p(r,o){o[0]&536870912&&e!==(e=(r[29].name||"Untitled movement")+"")&&be(n,e)},d(r){r&&b(n)}}}function Zr(t){let e,n;return e=new Zt({props:{$$slots:{default:[Xr,({props:r})=>({29:r}),({props:r})=>[r?536870912:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[0]&536870912|o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function Qr(t){let e,n,r,o,l,i;return e=new tt({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":wt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[7]),r=new tt({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":wt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Zr]},$$scope:{ctx:t}}}),r.$on("click",t[7]),l=new Rn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment)},l(a){S(e.$$.fragment,a),n=D(a),S(r.$$.fragment,a),o=D(a),S(l.$$.fragment,a)},m(a,s){F(e,a,s),L(a,n,s),F(r,a,s),L(a,o,s),F(l,a,s),i=!0},p(a,s){const g={};s[1]&16&&(g.$$scope={dirty:s,ctx:a}),e.$set(g);const m={};s[1]&16&&(m.$$scope={dirty:s,ctx:a}),r.$set(m)},i(a){i||(y(e.$$.fragment,a),y(r.$$.fragment,a),y(l.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(r.$$.fragment,a),C(l.$$.fragment,a),i=!1},d(a){a&&(b(n),b(o)),B(e,a),B(r,a),B(l,a)}}}function Yr(t){let e,n,r,o;return e=new tt({props:{paint:{"line-width":15,"line-color":"yellow"}}}),r=new Ln({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-color":"yellow","circle-radius":20}}}),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment)},l(l){S(e.$$.fragment,l),n=D(l),S(r.$$.fragment,l)},m(l,i){F(e,l,i),L(l,n,i),F(r,l,i),o=!0},p:it,i(l){o||(y(e.$$.fragment,l),y(r.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(r.$$.fragment,l),o=!1},d(l){l&&b(n),B(e,l),B(r,l)}}}function xr(t){let e,n,r,o,l,i,a,s,g=ce(t[2].jat[t[0]][t[1]].arms),m=[];for(let f=0;f<g.length;f+=1)m[f]=Ot(It(t,g,f));const v=f=>C(m[f],1,1,()=>{m[f]=null});let c=ce(t[2].jat[t[0]][t[1]].movements),d=[];for(let f=0;f<c.length;f+=1)d[f]=Tt(Pt(t,c,f));const h=f=>C(d[f],1,1,()=>{d[f]=null});return r=new vt({props:{data:t[8](t[2]),$$slots:{default:[Qr]},$$scope:{ctx:t}}}),l=new vt({props:{data:t[4],$$slots:{default:[Yr]},$$scope:{ctx:t}}}),a=new Cn({props:{map:t[3]}}),{c(){for(let f=0;f<m.length;f+=1)m[f].c();e=z();for(let f=0;f<d.length;f+=1)d[f].c();n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment),i=z(),A(a.$$.fragment)},l(f){for(let p=0;p<m.length;p+=1)m[p].l(f);e=D(f);for(let p=0;p<d.length;p+=1)d[p].l(f);n=D(f),S(r.$$.fragment,f),o=D(f),S(l.$$.fragment,f),i=D(f),S(a.$$.fragment,f)},m(f,p){for(let I=0;I<m.length;I+=1)m[I]&&m[I].m(f,p);L(f,e,p);for(let I=0;I<d.length;I+=1)d[I]&&d[I].m(f,p);L(f,n,p),F(r,f,p),L(f,o,p),F(l,f,p),L(f,i,p),F(a,f,p),s=!0},p(f,p){if(p[0]&71){g=ce(f[2].jat[f[0]][f[1]].arms);let M;for(M=0;M<g.length;M+=1){const w=It(f,g,M);m[M]?(m[M].p(w,p),y(m[M],1)):(m[M]=Ot(w),m[M].c(),y(m[M],1),m[M].m(e.parentNode,e))}for(ue(),M=g.length;M<m.length;M+=1)v(M);fe()}if(p[0]&103){c=ce(f[2].jat[f[0]][f[1]].movements);let M;for(M=0;M<c.length;M+=1){const w=Pt(f,c,M);d[M]?(d[M].p(w,p),y(d[M],1)):(d[M]=Tt(w),d[M].c(),y(d[M],1),d[M].m(n.parentNode,n))}for(ue(),M=c.length;M<d.length;M+=1)h(M);fe()}const I={};p[0]&4&&(I.data=f[8](f[2])),p[1]&16&&(I.$$scope={dirty:p,ctx:f}),r.$set(I);const N={};p[0]&16&&(N.data=f[4]),p[1]&16&&(N.$$scope={dirty:p,ctx:f}),l.$set(N);const R={};p[0]&8&&(R.map=f[3]),a.$set(R)},i(f){if(!s){for(let p=0;p<g.length;p+=1)y(m[p]);for(let p=0;p<c.length;p+=1)y(d[p]);y(r.$$.fragment,f),y(l.$$.fragment,f),y(a.$$.fragment,f),s=!0}},o(f){m=m.filter(Boolean);for(let p=0;p<m.length;p+=1)C(m[p]);d=d.filter(Boolean);for(let p=0;p<d.length;p+=1)C(d[p]);C(r.$$.fragment,f),C(l.$$.fragment,f),C(a.$$.fragment,f),s=!1},d(f){f&&(b(e),b(n),b(o),b(i)),qe(m,f),qe(d,f),B(r,f),B(l,f),B(a,f)}}}function eo(t){let e,n,r;function o(i){t[24](i)}let l={$$slots:{default:[xr]},$$scope:{ctx:t}};return t[3]!==void 0&&(l.map=t[3]),e=new wn({props:l}),x.push(()=>re(e,"map",o)),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,a){const s={};a[0]&31|a[1]&16&&(s.$$scope={dirty:a,ctx:i}),!n&&a[0]&8&&(n=!0,s.map=i[3],ne(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function At(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function to(t){return String.fromCharCode(t+65)}function no(t,e,n){let r,o;he(t,Z,u=>n(2,o=u));let{junctionIdx:l}=e,{stage:i}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:g}=e,{streetviewOn:m}=e,v,c={0:Ge.red.background,1:Ge.amber.background,2:Ge.green.background,X:Ge.critical.background};function d(u,_,H){let X={type:"FeatureCollection",features:[]},O=_??H;return O!=null&&(O.kind=="arm"?X.features.push(At(u.jat[l][i].arms[O.idx],O.idx)):X.features.push(N(u.jat[l][i].movements[O.idx],O.idx))),X}function h(u){n(9,s=u),n(10,g=null)}function f(u){if(!m){for(let _ of v.queryRenderedFeatures(u.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(s!=null){n(9,s=null);return}a=="arm"?(Be(Z,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:u.lngLat.toArray(),name:""}],o),n(9,s={kind:"arm",idx:o.jat[l][i].arms.length-1})):(Be(Z,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:u.lngLat.toArray(),point2:yr(u.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(9,s={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(10,g=null)}}function p(u){h({kind:"movement",idx:u.detail.features[0].id})}Rt(()=>{v.on("click",f),M(!1)}),Ut(()=>{v.off("click",f)});function I(u){let _={type:"FeatureCollection",features:u.jat[l][i].movements.map((H,X)=>N(H,X))};for(let H of u.jat[l][i].movements)if(_.features.push(R(H,_.features.length)),H.kind=="pedestrian"){let X={...H,point1:H.point2,point2:H.point1};_.features.push(R(X,_.features.length))}for(let H of u.jat[l][i].arms)_.features.push(At(H,_.features.length));return _}function N(u,_){return{type:"Feature",id:_,properties:{name:u.name,kind:u.kind,color:c[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2]}}}function R(u,_){return{type:"Feature",id:_,properties:{kind:u.kind,color:c[u.score],angle:Rr(u.point1,u.point2)},geometry:{type:"Point",coordinates:u.point2}}}function M(u){let _=I(o);_.features.length>0&&v.fitBounds(jn(_),{padding:20,animate:u})}function w(){return v}function E(u,_){t.$$.not_equal(_.point,u)&&(_.point=u,Z.set(o))}const q=u=>h({kind:"arm",idx:u}),V=u=>h({kind:"arm",idx:u});function G(u,_){t.$$.not_equal(_.point1,u)&&(_.point1=u,Z.set(o))}const T=u=>h({kind:"movement",idx:u}),P=u=>h({kind:"movement",idx:u});function j(u,_){t.$$.not_equal(_.point2,u)&&(_.point2=u,Z.set(o))}const te=u=>h({kind:"movement",idx:u}),$=u=>h({kind:"movement",idx:u});function Oe(u){v=u,n(3,v)}return t.$$set=u=>{"junctionIdx"in u&&n(0,l=u.junctionIdx),"stage"in u&&n(1,i=u.stage),"newKind"in u&&n(11,a=u.newKind),"editing"in u&&n(9,s=u.editing),"hoveringSidebar"in u&&n(10,g=u.hoveringSidebar),"streetviewOn"in u&&n(12,m=u.streetviewOn)},t.$$.update=()=>{t.$$.dirty[0]&1540&&n(4,r=d(o,s,g))},[l,i,o,v,r,c,h,p,I,s,g,a,m,M,w,E,q,V,G,T,P,j,te,$,Oe]}class ro extends ve{constructor(e){super(),we(this,e,no,eo,ye,{junctionIdx:0,stage:1,newKind:11,editing:9,hoveringSidebar:10,streetviewOn:12,zoom:13,getMap:14},null,[-1,-1])}get zoom(){return this.$$.ctx[13]}get getMap(){return this.$$.ctx[14]}}function oo(t){let e,n,r,o,l,i,a,s,g,m,v,c;function d(w){t[6](w)}let h={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(h.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new lt({props:h}),x.push(()=>re(e,"value",d));function f(w){t[7](w)}let p={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(p.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new kt({props:p}),x.push(()=>re(o,"value",f));function I(w){t[8](w)}let N={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(N.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new kt({props:N}),x.push(()=>re(a,"value",I));function R(w){t[9](w)}let M={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(M.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),m=new Xt({props:M}),x.push(()=>re(m,"value",R)),{c(){A(e.$$.fragment),r=z(),A(o.$$.fragment),i=z(),A(a.$$.fragment),g=z(),A(m.$$.fragment)},l(w){S(e.$$.fragment,w),r=D(w),S(o.$$.fragment,w),i=D(w),S(a.$$.fragment,w),g=D(w),S(m.$$.fragment,w)},m(w,E){F(e,w,E),L(w,r,E),F(o,w,E),L(w,i,E),F(a,w,E),L(w,g,E),F(m,w,E),c=!0},p(w,[E]){const q={};!n&&E&15&&(n=!0,q.value=w[3].jat[w[0]][w[1]].movements[w[2]].name,ne(()=>n=!1)),e.$set(q);const V={};!l&&E&15&&(l=!0,V.value=w[3].jat[w[0]][w[1]].movements[w[2]].kind,ne(()=>l=!1)),o.$set(V);const G={};!s&&E&15&&(s=!0,G.value=w[3].jat[w[0]][w[1]].movements[w[2]].score,ne(()=>s=!1)),a.$set(G);const T={};!v&&E&15&&(v=!0,T.value=w[3].jat[w[0]][w[1]].movements[w[2]].notes,ne(()=>v=!1)),m.$set(T)},i(w){c||(y(e.$$.fragment,w),y(o.$$.fragment,w),y(a.$$.fragment,w),y(m.$$.fragment,w),c=!0)},o(w){C(e.$$.fragment,w),C(o.$$.fragment,w),C(a.$$.fragment,w),C(m.$$.fragment,w),c=!1},d(w){w&&(b(r),b(i),b(g)),B(e,w),B(o,w),B(a,w),B(m,w)}}}function io(t,e,n){let r;he(t,Z,d=>n(3,r=d));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=Tn(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function g(d){t.$$.not_equal(r.jat[o][l].movements[i].name,d)&&(r.jat[o][l].movements[i].name=d,Z.set(r))}function m(d){t.$$.not_equal(r.jat[o][l].movements[i].kind,d)&&(r.jat[o][l].movements[i].kind=d,Z.set(r))}function v(d){t.$$.not_equal(r.jat[o][l].movements[i].score,d)&&(r.jat[o][l].movements[i].score=d,Z.set(r))}function c(d){t.$$.not_equal(r.jat[o][l].movements[i].notes,d)&&(r.jat[o][l].movements[i].notes=d,Z.set(r))}return t.$$set=d=>{"junctionIdx"in d&&n(0,o=d.junctionIdx),"stage"in d&&n(1,l=d.stage),"idx"in d&&n(2,i=d.idx)},[o,l,i,r,a,s,g,m,v,c]}class lo extends ve{constructor(e){super(),we(this,e,io,oo,ye,{junctionIdx:0,stage:1,idx:2})}}const{window:ao}=kn;function St(t,e,n){const r=t.slice();return r[27]=e[n],r[29]=n,r}function Ft(t,e,n){const r=t.slice();return r[30]=e[n],r[29]=n,r}function so(t){let e,n,r,o,l,i,a,s;e=new On({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[23]),r=new Jt({props:{$$slots:{default:[mo]},$$scope:{ctx:t}}}),r.$on("click",t[10]);const g=[go,co],m=[];function v(c,d){return c[3].kind=="movement"?0:1}return l=v(t),i=m[l]=g[l](t),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),i.c(),a=pe()},l(c){S(e.$$.fragment,c),n=D(c),S(r.$$.fragment,c),o=D(c),i.l(c),a=pe()},m(c,d){F(e,c,d),L(c,n,d),F(r,c,d),L(c,o,d),m[l].m(c,d),L(c,a,d),s=!0},p(c,d){const h={};d[1]&2&&(h.$$scope={dirty:d,ctx:c}),e.$set(h);const f={};d[1]&2&&(f.$$scope={dirty:d,ctx:c}),r.$set(f);let p=l;l=v(c),l===p?m[l].p(c,d):(ue(),C(m[p],1,1,()=>{m[p]=null}),fe(),i=m[l],i?i.p(c,d):(i=m[l]=g[l](c),i.c()),y(i,1),i.m(a.parentNode,a))},i(c){s||(y(e.$$.fragment,c),y(r.$$.fragment,c),y(i),s=!0)},o(c){C(e.$$.fragment,c),C(r.$$.fragment,c),C(i),s=!1},d(c){c&&(b(n),b(o),b(a)),B(e,c),B(r,c),m[l].d(c)}}}function uo(t){let e,n,r,o,l,i,a="Arms",s,g,m,v,c,d="Movements",h,f,p,I,N,R=zt(t[7].jat[t[0]][t[1]])+"",M,w,E;e=new In({props:{label:"Tools",$$slots:{default:[ho]},$$scope:{ctx:t}}});function q(u){t[16](u)}let V={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(V.value=t[2]),r=new En({props:V}),x.push(()=>re(r,"value",q));let G=ce(t[7].jat[t[0]][t[1]].arms),T=[];for(let u=0;u<G.length;u+=1)T[u]=qt(Ft(t,G,u));const P=u=>C(T[u],1,1,()=>{T[u]=null});let j=t[7].jat[t[0]][t[8]].arms.length>0&&Nt(t),te=ce(t[7].jat[t[0]][t[1]].movements),$=[];for(let u=0;u<te.length;u+=1)$[u]=Gt(St(t,te,u));const Oe=u=>C($[u],1,1,()=>{$[u]=null});return{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),l=z(),i=Q("h3"),i.textContent=a,s=z(),g=Q("ul");for(let u=0;u<T.length;u+=1)T[u].c();m=z(),j&&j.c(),v=z(),c=Q("h3"),c.textContent=d,h=z(),f=Q("ol");for(let u=0;u<$.length;u+=1)$[u].c();p=z(),I=Q("p"),N=K("Total JAT score: "),M=K(R),w=K("%")},l(u){S(e.$$.fragment,u),n=D(u),S(r.$$.fragment,u),l=D(u),i=Y(u,"H3",{"data-svelte-h":!0}),yt(i)!=="svelte-ld74qb"&&(i.textContent=a),s=D(u),g=Y(u,"UL",{});var _=oe(g);for(let O=0;O<T.length;O+=1)T[O].l(_);_.forEach(b),m=D(u),j&&j.l(u),v=D(u),c=Y(u,"H3",{"data-svelte-h":!0}),yt(c)!=="svelte-1dc52s8"&&(c.textContent=d),h=D(u),f=Y(u,"OL",{});var H=oe(f);for(let O=0;O<$.length;O+=1)$[O].l(H);H.forEach(b),p=D(u),I=Y(u,"P",{});var X=oe(I);N=W(X,"Total JAT score: "),M=W(X,R),w=W(X,"%"),X.forEach(b)},m(u,_){F(e,u,_),L(u,n,_),F(r,u,_),L(u,l,_),L(u,i,_),L(u,s,_),L(u,g,_);for(let H=0;H<T.length;H+=1)T[H]&&T[H].m(g,null);L(u,m,_),j&&j.m(u,_),L(u,v,_),L(u,c,_),L(u,h,_),L(u,f,_);for(let H=0;H<$.length;H+=1)$[H]&&$[H].m(f,null);L(u,p,_),L(u,I,_),ae(I,N),ae(I,M),ae(I,w),E=!0},p(u,_){const H={};_[0]&96|_[1]&2&&(H.$$scope={dirty:_,ctx:u}),e.$set(H);const X={};if(!o&&_[0]&4&&(o=!0,X.value=u[2],ne(()=>o=!1)),r.$set(X),_[0]&659){G=ce(u[7].jat[u[0]][u[1]].arms);let O;for(O=0;O<G.length;O+=1){const _e=Ft(u,G,O);T[O]?(T[O].p(_e,_),y(T[O],1)):(T[O]=qt(_e),T[O].c(),y(T[O],1),T[O].m(g,null))}for(ue(),O=G.length;O<T.length;O+=1)P(O);fe()}if(u[7].jat[u[0]][u[8]].arms.length>0?j?(j.p(u,_),_[0]&129&&y(j,1)):(j=Nt(u),j.c(),y(j,1),j.m(v.parentNode,v)):j&&(ue(),C(j,1,1,()=>{j=null}),fe()),_[0]&659){te=ce(u[7].jat[u[0]][u[1]].movements);let O;for(O=0;O<te.length;O+=1){const _e=St(u,te,O);$[O]?($[O].p(_e,_),y($[O],1)):($[O]=Gt(_e),$[O].c(),y($[O],1),$[O].m(f,null))}for(ue(),O=te.length;O<$.length;O+=1)Oe(O);fe()}(!E||_[0]&131)&&R!==(R=zt(u[7].jat[u[0]][u[1]])+"")&&be(M,R)},i(u){if(!E){y(e.$$.fragment,u),y(r.$$.fragment,u);for(let _=0;_<G.length;_+=1)y(T[_]);y(j);for(let _=0;_<te.length;_+=1)y($[_]);E=!0}},o(u){C(e.$$.fragment,u),C(r.$$.fragment,u),T=T.filter(Boolean);for(let _=0;_<T.length;_+=1)C(T[_]);C(j),$=$.filter(Boolean);for(let _=0;_<$.length;_+=1)C($[_]);E=!1},d(u){u&&(b(n),b(l),b(i),b(s),b(g),b(m),b(v),b(c),b(h),b(f),b(p),b(I)),B(e,u),B(r,u),qe(T,u),j&&j.d(u),qe($,u)}}}function fo(t){let e;return{c(){e=K("Save")},l(n){e=W(n,"Save")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function mo(t){let e;return{c(){e=K("Delete")},l(n){e=W(n,"Delete")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function co(t){let e,n,r;function o(i){t[24](i)}let l={label:"Arm Name"};return t[7].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[7].jat[t[0]][t[1]].arms[t[3].idx].name),e=new lt({props:l}),x.push(()=>re(e,"value",o)),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&139&&(n=!0,s.value=i[7].jat[i[0]][i[1]].arms[i[3].idx].name,ne(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function go(t){let e,n;return e=new lo({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function _o(t){let e;return{c(){e=K("Zoom to fit")},l(n){e=W(n,"Zoom to fit")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function Bt(t){var i;let e,n,r;function o(a){t[15](a)}let l={map:(i=t[6])==null?void 0:i.getMap()};return t[5]!==void 0&&(l.enabled=t[5]),e=new Pn({props:l}),x.push(()=>re(e,"enabled",o)),{c(){A(e.$$.fragment)},l(a){S(e.$$.fragment,a)},m(a,s){F(e,a,s),r=!0},p(a,s){var m;const g={};s[0]&64&&(g.map=(m=a[6])==null?void 0:m.getMap()),!n&&s[0]&32&&(n=!0,g.enabled=a[5],ne(()=>n=!1)),e.$set(g)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){C(e.$$.fragment,a),r=!1},d(a){B(e,a)}}}function ho(t){var v;let e,n,r,o,l,i,a=(v=t[6])==null?void 0:v.getMap(),s,g;e=new ge({props:{$$slots:{default:[_o]},$$scope:{ctx:t}}}),e.$on("click",t[14]),r=new $n({}),l=new Mn({});let m=a&&Bt(t);return{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment),i=z(),m&&m.c(),s=pe()},l(c){S(e.$$.fragment,c),n=D(c),S(r.$$.fragment,c),o=D(c),S(l.$$.fragment,c),i=D(c),m&&m.l(c),s=pe()},m(c,d){F(e,c,d),L(c,n,d),F(r,c,d),L(c,o,d),F(l,c,d),L(c,i,d),m&&m.m(c,d),L(c,s,d),g=!0},p(c,d){var f;const h={};d[1]&2&&(h.$$scope={dirty:d,ctx:c}),e.$set(h),d[0]&64&&(a=(f=c[6])==null?void 0:f.getMap()),a?m?(m.p(c,d),d[0]&64&&y(m,1)):(m=Bt(c),m.c(),y(m,1),m.m(s.parentNode,s)):m&&(ue(),C(m,1,1,()=>{m=null}),fe())},i(c){g||(y(e.$$.fragment,c),y(r.$$.fragment,c),y(l.$$.fragment,c),y(m),g=!0)},o(c){C(e.$$.fragment,c),C(r.$$.fragment,c),C(l.$$.fragment,c),C(m),g=!1},d(c){c&&(b(n),b(o),b(i),b(s)),B(e,c),B(r,c),B(l,c),m&&m.d(c)}}}function po(t){let e=wo(t[29])+"",n,r,o=(t[30].name||"Unnamed arm")+"",l;return{c(){n=K(e),r=K(" - "),l=K(o)},l(i){n=W(i,e),r=W(i," - "),l=W(i,o)},m(i,a){L(i,n,a),L(i,r,a),L(i,l,a)},p(i,a){a[0]&131&&o!==(o=(i[30].name||"Unnamed arm")+"")&&be(l,o)},d(i){i&&(b(n),b(r),b(l))}}}function qt(t){let e,n,r,o;function l(){return t[17](t[29])}function i(){return t[18](t[29])}return n=new ge({props:{$$slots:{default:[po]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[19]),{c(){e=Q("li"),A(n.$$.fragment),r=z()},l(a){e=Y(a,"LI",{});var s=oe(e);S(n.$$.fragment,s),r=D(s),s.forEach(b)},m(a,s){L(a,e,s),F(n,e,null),ae(e,r),o=!0},p(a,s){t=a;const g={};s[0]&131|s[1]&2&&(g.$$scope={dirty:s,ctx:t}),n.$set(g)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){C(n.$$.fragment,a),o=!1},d(a){a&&b(e),B(n)}}}function Nt(t){let e,n;return e=new ge({props:{$$slots:{default:[bo]},$$scope:{ctx:t}}}),e.$on("click",t[12]),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&2&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function bo(t){let e,n;return{c(){e=K("Copy arms from "),n=K(t[8])},l(r){e=W(r,"Copy arms from "),n=W(r,t[8])},m(r,o){L(r,e,o),L(r,n,o)},p:it,d(r){r&&(b(e),b(n))}}}function yo(t){let e=(t[27].name||"Unnamed movement")+"",n;return{c(){n=K(e)},l(r){n=W(r,e)},m(r,o){L(r,n,o)},p(r,o){o[0]&131&&e!==(e=(r[27].name||"Unnamed movement")+"")&&be(n,e)},d(r){r&&b(n)}}}function Gt(t){let e,n,r,o;function l(){return t[20](t[29])}function i(){return t[21](t[29])}return n=new ge({props:{$$slots:{default:[yo]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[22]),{c(){e=Q("li"),A(n.$$.fragment),r=z()},l(a){e=Y(a,"LI",{});var s=oe(e);S(n.$$.fragment,s),r=D(s),s.forEach(b)},m(a,s){L(a,e,s),F(n,e,null),ae(e,r),o=!0},p(a,s){t=a;const g={};s[0]&131|s[1]&2&&(g.$$scope={dirty:s,ctx:t}),n.$set(g)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){C(n.$$.fragment,a),o=!1},d(a){a&&b(e),B(n)}}}function vo(t){let e,n,r,o,l,i,a,s,g,m,v,c,d,h;function f(E){t[13](E)}let p={label:"Commentary / Notes"};t[7].jat[t[0]][t[1]].notes!==void 0&&(p.value=t[7].jat[t[0]][t[1]].notes),e=new Xt({props:p}),x.push(()=>re(e,"value",f));const I=[uo,so],N=[];function R(E,q){return E[3]==null?0:1}i=R(t),a=N[i]=I[i](t);function M(E){t[26](E)}let w={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5]};return t[3]!==void 0&&(w.editing=t[3]),m=new ro({props:w}),t[25](m),x.push(()=>re(m,"editing",M)),{c(){A(e.$$.fragment),r=z(),o=Q("div"),l=Q("div"),a.c(),s=z(),g=Q("div"),A(m.$$.fragment),this.h()},l(E){S(e.$$.fragment,E),r=D(E),o=Y(E,"DIV",{style:!0});var q=oe(o);l=Y(q,"DIV",{style:!0});var V=oe(l);a.l(V),V.forEach(b),s=D(q),g=Y(q,"DIV",{style:!0});var G=oe(g);S(m.$$.fragment,G),G.forEach(b),q.forEach(b),this.h()},h(){ee(l,"width","30%"),ee(l,"overflow-y","scroll"),ee(l,"padding","10px"),ee(l,"border","1px solid black"),ee(g,"position","relative"),ee(g,"width","100%"),ee(o,"display","flex"),ee(o,"height","80vh")},m(E,q){F(e,E,q),L(E,r,q),L(E,o,q),ae(o,l),N[i].m(l,null),ae(o,s),ae(o,g),F(m,g,null),c=!0,d||(h=bn(ao,"keydown",t[11]),d=!0)},p(E,q){const V={};!n&&q[0]&131&&(n=!0,V.value=E[7].jat[E[0]][E[1]].notes,ne(()=>n=!1)),e.$set(V);let G=i;i=R(E),i===G?N[i].p(E,q):(ue(),C(N[G],1,1,()=>{N[G]=null}),fe(),a=N[i],a?a.p(E,q):(a=N[i]=I[i](E),a.c()),y(a,1),a.m(l,null));const T={};q[0]&1&&(T.junctionIdx=E[0]),q[0]&2&&(T.stage=E[1]),q[0]&4&&(T.newKind=E[2]),q[0]&16&&(T.hoveringSidebar=E[4]),q[0]&32&&(T.streetviewOn=E[5]),!v&&q[0]&8&&(v=!0,T.editing=E[3],ne(()=>v=!1)),m.$set(T)},i(E){c||(y(e.$$.fragment,E),y(a),y(m.$$.fragment,E),c=!0)},o(E){C(e.$$.fragment,E),C(a),C(m.$$.fragment,E),c=!1},d(E){E&&(b(r),b(o)),B(e,E),N[i].d(),t[25](null),B(m),d=!1,h()}}}function wo(t){return String.fromCharCode(t+65)}function zt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function ko(t,e,n){let r;he(t,Z,$=>n(7,r=$));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",a="arm",s=null,g=null,m=!1,v=null;function c($){n(3,s=$),n(4,g=null)}function d(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][l].movements.splice(s.idx,1),Z.set(r)):(r.jat[o][l].arms.splice(s.idx,1),Z.set(r)),n(3,s=null))}function h($){s!=null&&$.key=="Escape"?($.stopPropagation(),n(3,s=null)):s!=null&&$.key=="Delete"&&d()}function f(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(Be(Z,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),Z.set(r))}function p($){t.$$.not_equal(r.jat[o][l].notes,$)&&(r.jat[o][l].notes=$,Z.set(r))}const I=()=>v==null?void 0:v.zoom(!0);function N($){m=$,n(5,m)}function R($){a=$,n(2,a)}const M=$=>c({kind:"arm",idx:$}),w=$=>n(4,g={kind:"arm",idx:$}),E=()=>n(4,g=null),q=$=>c({kind:"movement",idx:$}),V=$=>n(4,g={kind:"movement",idx:$}),G=()=>n(4,g=null),T=()=>n(3,s=null);function P($){t.$$.not_equal(r.jat[o][l].arms[s.idx].name,$)&&(r.jat[o][l].arms[s.idx].name=$,Z.set(r))}function j($){x[$?"unshift":"push"](()=>{v=$,n(6,v)})}function te($){s=$,n(3,s)}return t.$$set=$=>{"junctionIdx"in $&&n(0,o=$.junctionIdx),"stage"in $&&n(1,l=$.stage)},[o,l,a,s,g,m,v,r,i,c,d,h,f,p,I,N,R,M,w,E,q,V,G,T,P,j,te]}class jo extends ve{constructor(e){super(),we(this,e,ko,vo,ye,{junctionIdx:0,stage:1},null,[-1,-1])}}function Dt(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function Co(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,g,m,v;return s=new ge({props:{$$slots:{default:[$o]},$$scope:{ctx:t}}}),s.$on("click",t[10]),m=new jo({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=Q("h2"),r=K(n),o=K(" - "),i=K(l),a=z(),A(s.$$.fragment),g=z(),A(m.$$.fragment)},l(c){e=Y(c,"H2",{});var d=oe(e);r=W(d,n),o=W(d," - "),i=W(d,l),d.forEach(b),a=D(c),S(s.$$.fragment,c),g=D(c),S(m.$$.fragment,c)},m(c,d){L(c,e,d),ae(e,r),ae(e,o),ae(e,i),L(c,a,d),F(s,c,d),L(c,g,d),F(m,c,d),v=!0},p(c,d){(!v||d&3)&&n!==(n=(c[1].jat[c[0].idx].name||"Untitled junction")+"")&&be(r,n),(!v||d&1)&&l!==(l=c[0].stage+"")&&be(i,l);const h={};d&16384&&(h.$$scope={dirty:d,ctx:c}),s.$set(h);const f={};d&1&&(f.junctionIdx=c[0].idx),d&1&&(f.stage=c[0].stage),m.$set(f)},i(c){v||(y(s.$$.fragment,c),y(m.$$.fragment,c),v=!0)},o(c){C(s.$$.fragment,c),C(m.$$.fragment,c),v=!1},d(c){c&&(b(e),b(a),b(g)),B(s,c),B(m,c)}}}function Lo(t){let e,n,r,o,l,i,a,s,g,m,v;e=new ge({props:{$$slots:{default:[Mo]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new Jt({props:{$$slots:{default:[Po]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function c(h){t[7](h)}let d={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(d.value=t[1].jat[t[0].idx].name),l=new lt({props:d}),x.push(()=>re(l,"value",c)),s=new ge({props:{$$slots:{default:[Io]},$$scope:{ctx:t}}}),s.$on("click",t[8]),m=new ge({props:{$$slots:{default:[Oo]},$$scope:{ctx:t}}}),m.$on("click",t[9]),{c(){A(e.$$.fragment),n=z(),A(r.$$.fragment),o=z(),A(l.$$.fragment),a=z(),A(s.$$.fragment),g=z(),A(m.$$.fragment)},l(h){S(e.$$.fragment,h),n=D(h),S(r.$$.fragment,h),o=D(h),S(l.$$.fragment,h),a=D(h),S(s.$$.fragment,h),g=D(h),S(m.$$.fragment,h)},m(h,f){F(e,h,f),L(h,n,f),F(r,h,f),L(h,o,f),F(l,h,f),L(h,a,f),F(s,h,f),L(h,g,f),F(m,h,f),v=!0},p(h,f){const p={};f&16384&&(p.$$scope={dirty:f,ctx:h}),e.$set(p);const I={};f&16384&&(I.$$scope={dirty:f,ctx:h}),r.$set(I);const N={};!i&&f&3&&(i=!0,N.value=h[1].jat[h[0].idx].name,ne(()=>i=!1)),l.$set(N);const R={};f&16384&&(R.$$scope={dirty:f,ctx:h}),s.$set(R);const M={};f&16384&&(M.$$scope={dirty:f,ctx:h}),m.$set(M)},i(h){v||(y(e.$$.fragment,h),y(r.$$.fragment,h),y(l.$$.fragment,h),y(s.$$.fragment,h),y(m.$$.fragment,h),v=!0)},o(h){C(e.$$.fragment,h),C(r.$$.fragment,h),C(l.$$.fragment,h),C(s.$$.fragment,h),C(m.$$.fragment,h),v=!1},d(h){h&&(b(n),b(o),b(a),b(g)),B(e,h),B(r,h),B(l,h),B(s,h),B(m,h)}}}function Eo(t){let e,n,r,o;e=new ge({props:{$$slots:{default:[To]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=ce(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Ht(Dt(t,l,s));const a=s=>C(i[s],1,1,()=>{i[s]=null});return{c(){A(e.$$.fragment),n=z(),r=Q("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){S(e.$$.fragment,s),n=D(s),r=Y(s,"OL",{});var g=oe(r);for(let m=0;m<i.length;m+=1)i[m].l(g);g.forEach(b)},m(s,g){F(e,s,g),L(s,n,g),L(s,r,g);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(r,null);o=!0},p(s,g){const m={};if(g&16384&&(m.$$scope={dirty:g,ctx:s}),e.$set(m),g&3){l=ce(s[1].jat);let v;for(v=0;v<l.length;v+=1){const c=Dt(s,l,v);i[v]?(i[v].p(c,g),y(i[v],1)):(i[v]=Ht(c),i[v].c(),y(i[v],1),i[v].m(r,null))}for(ue(),v=l.length;v<i.length;v+=1)a(v);fe()}},i(s){if(!o){y(e.$$.fragment,s);for(let g=0;g<l.length;g+=1)y(i[g]);o=!0}},o(s){C(e.$$.fragment,s),i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)C(i[g]);o=!1},d(s){s&&(b(n),b(r)),B(e,s),qe(i,s)}}}function $o(t){let e;return{c(){e=K("Back")},l(n){e=W(n,"Back")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function Mo(t){let e;return{c(){e=K("Back to all junctions")},l(n){e=W(n,"Back to all junctions")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function Po(t){let e;return{c(){e=K("Delete")},l(n){e=W(n,"Delete")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function Io(t){let e;return{c(){e=K("Existing")},l(n){e=W(n,"Existing")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function Oo(t){let e;return{c(){e=K("Proposed")},l(n){e=W(n,"Proposed")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function To(t){let e;return{c(){e=K("Add new junction")},l(n){e=W(n,"Add new junction")},m(n,r){L(n,e,r)},d(n){n&&b(e)}}}function Ao(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=K(e)},l(r){n=W(r,e)},m(r,o){L(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&be(n,e)},d(r){r&&b(n)}}}function Ht(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new ge({props:{$$slots:{default:[Ao]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=Q("li"),A(n.$$.fragment),r=z()},l(i){e=Y(i,"LI",{});var a=oe(e);S(n.$$.fragment,a),r=D(a),a.forEach(b)},m(i,a){L(i,e,a),F(n,e,null),ae(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(y(n.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),o=!1},d(i){i&&b(e),B(n)}}}function So(t){let e,n,r,o;const l=[Eo,Lo,Co],i=[];function a(s,g){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=pe()},l(s){n&&n.l(s),r=pe()},m(s,g){~e&&i[e].m(s,g),L(s,r,g),o=!0},p(s,[g]){let m=e;e=a(s),e===m?~e&&i[e].p(s,g):(n&&(ue(),C(i[m],1,1,()=>{i[m]=null}),fe()),~e?(n=i[e],n?n.p(s,g):(n=i[e]=l[e](s),n.c()),y(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(y(n),o=!0)},o(s){C(n),o=!1},d(s){s&&b(r),~e&&i[e].d(s)}}}function ze(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function Fo(t,e,n){let r;he(t,Z,h=>n(1,r=h));let o={kind:"list"};function l(){Be(Z,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(h){window.confirm("Delete this junction?")&&(r.jat.splice(h,1),Z.set(r),n(0,o={kind:"list"}))}const a=h=>n(0,o={kind:"junction",idx:h}),s=()=>n(0,o={kind:"list"}),g=()=>i(ze(o));function m(h){t.$$.not_equal(r.jat[o.idx].name,h)&&(r.jat[o.idx].name=h,Z.set(r))}return[o,r,l,i,a,s,g,m,()=>n(0,o={kind:"map",idx:ze(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:ze(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:ze(o)})]}class Yo extends ve{constructor(e){super(),we(this,e,Fo,So,ye,{})}}export{Yo as component};
