import{s as de,v as ee,x as oe,l as De,u as He,m as Re,o as Ue,H as re,E as Ne,i as M,f as v,a9 as sn,a8 as un,k as ge,U as Ft,a7 as Bt,N as rt,e as Z,c as Q,b as te,r as je,a as N,g as z,w as ne,h as se,z as Ge,p as fn,q as ot,t as V,d as X,j as Le,B as cn,n as mn}from"../chunks/scheduler.Bsni_e59.js";import{S as pe,i as _e,e as ie,c as T,a as O,m as A,t as w,b as E,d as S,g as ye,f as be}from"../chunks/index.CCfAUppz.js";import{e as Ce}from"../chunks/each.BmgwAlbi.js";import{W as qt,S as he}from"../chunks/WarningButton.D9QeV9gM.js";import{T as Gt}from"../chunks/TextInput.CHbK327s.js";import{s as K}from"../chunks/data.Cq3GlGl9.js";import{L as $t,g as Nt,e as gn,m as Ee,i as hn,f as zt,M as dn,a as pn,G as _t,h as yt}from"../chunks/MapLibreMap.Dp33fYeB.js";import{c as Be}from"../chunks/colors.CYEpEtTL.js";import{D as _n}from"../chunks/DefaultButton.DyQsHGbh.js";import{T as Dt}from"../chunks/TextArea.DbePhW6L.js";import{a as yn,B as bn,G as vn,S as wn,c as kn,M as bt}from"../chunks/GeoreferenceLayer.B_yis1vX.js";import{p as En}from"../chunks/index.Dydj76fQ.js";import{S as vt}from"../chunks/Select.bLRJACqI.js";function jn(t){let e;const n=t[15].default,r=De(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&He(r,n,o,o[23],e?Ue(n,o[23],l,null):Re(o[23]),null)},i(o){e||(w(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function Ln(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[jn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new $t({props:l}),ee.push(()=>ie(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){T(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){A(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Cn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Nt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:m}=e,{layout:u=void 0}=e,{filter:g=void 0}=e,{minzoom:h=void 0}=e,{maxzoom:d=void 0}=e,{hoverCursor:p=void 0}=e,{manageHoverState:f=!1}=e,{hovered:C=null}=e,{eventsIfTopMost:P=!1}=e,{interactive:F=!0}=e;function D(j){C=j,n(0,C)}function y(j){re.call(this,t,j)}function k(j){re.call(this,t,j)}function I(j){re.call(this,t,j)}function U(j){re.call(this,t,j)}function q(j){re.call(this,t,j)}function W(j){re.call(this,t,j)}return t.$$set=j=>{"id"in j&&n(1,l=j.id),"source"in j&&n(2,i=j.source),"sourceLayer"in j&&n(3,a=j.sourceLayer),"beforeId"in j&&n(4,s=j.beforeId),"beforeLayerType"in j&&n(5,c=j.beforeLayerType),"paint"in j&&n(6,m=j.paint),"layout"in j&&n(7,u=j.layout),"filter"in j&&n(8,g=j.filter),"minzoom"in j&&n(9,h=j.minzoom),"maxzoom"in j&&n(10,d=j.maxzoom),"hoverCursor"in j&&n(11,p=j.hoverCursor),"manageHoverState"in j&&n(12,f=j.manageHoverState),"hovered"in j&&n(0,C=j.hovered),"eventsIfTopMost"in j&&n(13,P=j.eventsIfTopMost),"interactive"in j&&n(14,F=j.interactive),"$$scope"in j&&n(23,o=j.$$scope)},[C,l,i,a,s,c,m,u,g,h,d,p,f,P,F,r,D,y,k,I,U,q,W,o]}class xe extends pe{constructor(e){super(),_e(this,e,Cn,Ln,de,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Mn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),wt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function kt(t){let e,n,r=(t[4]||t[3]instanceof Ee.Marker)&&Et(t);return{c(){e=Z("div"),r&&r.c()},l(o){e=Q(o,"DIV",{});var l=te(e);r&&r.l(l),l.forEach(v)},m(o,l){M(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof Ee.Marker?r?(r.p(o,l),l[0]&24&&w(r,1)):(r=Et(o),r.c(),w(r,1),r.m(e,null)):r&&(ye(),E(r,1,1,()=>{r=null}),be())},i(o){n||(w(r),n=!0)},o(o){E(r),n=!1},d(o){o&&v(e),r&&r.d(),t[32](null)}}}function Et(t){let e;const n=t[30].default,r=De(n,t,t[29],wt);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&He(r,n,o,o[29],e?Ue(n,o[29],l,Mn):Re(o[29]),wt)},i(o){e||(w(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function Pn(t){let e,n,r=t[9].default&&kt(t);return{c(){r&&r.c(),e=Ne()},l(o){r&&r.l(o),e=Ne()},m(o,l){r&&r.m(o,l),M(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&w(r,1)):(r=kt(o),r.c(),w(r,1),r.m(e.parentNode,e)):r&&(ye(),E(r,1,1,()=>{r=null}),be())},i(o){n||(w(r),n=!0)},o(o){E(r),n=!1},d(o){o&&v(e),r&&r.d(o)}}}function In(t,e,n){let r,o,l,i,a,s,{$$slots:c={},$$scope:m}=e;const u=sn(c);let{closeButton:g=void 0}=e,{closeOnClickOutside:h=!0}=e,{closeOnClickInside:d=!1}=e,{closeOnMove:p=!1}=e,{openOn:f="click"}=e,{openIfTopMost:C=!0}=e,{focusAfterOpen:P=!0}=e,{anchor:F=void 0}=e,{offset:D=void 0}=e,{popupClass:y=void 0}=e,{maxWidth:k=void 0}=e,{lngLat:I=void 0}=e,{html:U=void 0}=e,{open:q=!1}=e;const W=un(),{map:j,popupTarget:L,layerEvent:ve,layer:Se,eventTopMost:Ke}=gn();ge(t,j,_=>n(2,l=_)),ge(t,L,_=>n(3,a=_)),ge(t,ve,_=>n(28,i=_)),ge(t,Se,_=>n(35,s=_));const Ze=["click","dblclick","contextmenu"];let B,we=!1,ae;function b(){if(!B)return;let _=B.getElement();!_||_===ae||(ae=_,f==="hover"&&(ae.style.pointerEvents="none"),ae.addEventListener("mouseenter",()=>{n(24,we=!0)},{passive:!0}),ae.addEventListener("mouseleave",()=>{n(24,we=!1)},{passive:!0}),ae.addEventListener("click",()=>{d&&n(0,q=!1)},{passive:!0}))}Ft(()=>{if(l)return l.on("click",Fe),l.on("contextmenu",Fe),typeof a=="string"&&(l.on("click",a,le),l.on("dblclick",a,le),l.on("contextmenu",a,le),l.on("mousemove",a,pt),l.on("mouseleave",a,dt),l.on("touchstart",a,gt),l.on("touchend",a,ht)),()=>{l!=null&&l.loaded()&&(B==null||B.remove(),l.off("click",Fe),l.off("contextmenu",Fe),a instanceof Ee.Marker?a.getPopup()===B&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,le),l.off("dblclick",a,le),l.off("contextmenu",a,le),l.off("mousemove",a,pt),l.off("mouseleave",a,dt),l.off("touchstart",a,gt),l.off("touchend",a,ht)))}});function H(_){return C?!("marker"in _)&&!hn(_)&&Ke(_)!==s:!1}let R=null,J="normal";function le(_){_.type===f&&(H(_)||("layerType"in _?_.layerType==="deckgl"?(n(10,I=_.coordinate),n(4,R=_.object?[_.object]:null)):(n(10,I=_.lngLat),n(4,R=_.features??[])):(n(10,I=_.lngLat),n(4,R=_.features??[])),setTimeout(()=>n(0,q=!0))))}let ke=null;function gt(_){ke=_.point}function ht(_){if(!ke||f!=="hover")return;let Qe=ke.dist(_.point);ke=null,Qe<3&&(n(10,I=_.lngLat),n(4,R=_.features??[]),B.isOpen()?n(25,J="justOpened"):(n(25,J="opening"),n(0,q=!0)))}function dt(_){f!=="hover"||ke||J!=="normal"||(n(0,q=!1),n(4,R=null))}function pt(_){if(!(f!=="hover"||ke||J!=="normal")){if(H(_)){n(0,q=!1),n(4,R=null);return}n(0,q=!0),n(4,R=_.features??[]),n(10,I=_.lngLat)}}function Fe(_){if(J==="justOpened"){n(25,J="normal");return}if(!h)return;let Qe=[ae,a instanceof Ee.Marker?a==null?void 0:a.getElement():null];q&&B.isOpen()&&!Qe.some(Ye=>Ye==null?void 0:Ye.contains(_.originalEvent.target))&&(_.type==="contextmenu"&&f==="contextmenu"||_.type!=="contextmenu")&&n(0,q=!1)}Bt(()=>{l&&(B!=null&&B.isOpen())&&B.remove()});let Ie;const ln=()=>n(0,q=!1);function an(_){ee[_?"unshift":"push"](()=>{Ie=_,n(1,Ie)})}return t.$$set=_=>{"closeButton"in _&&n(11,g=_.closeButton),"closeOnClickOutside"in _&&n(12,h=_.closeOnClickOutside),"closeOnClickInside"in _&&n(13,d=_.closeOnClickInside),"closeOnMove"in _&&n(14,p=_.closeOnMove),"openOn"in _&&n(15,f=_.openOn),"openIfTopMost"in _&&n(16,C=_.openIfTopMost),"focusAfterOpen"in _&&n(17,P=_.focusAfterOpen),"anchor"in _&&n(18,F=_.anchor),"offset"in _&&n(19,D=_.offset),"popupClass"in _&&n(20,y=_.popupClass),"maxWidth"in _&&n(21,k=_.maxWidth),"lngLat"in _&&n(10,I=_.lngLat),"html"in _&&n(22,U=_.html),"open"in _&&n(0,q=_.open),"$$scope"in _&&n(29,m=_.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=g??(!h&&!d)),t.$$.dirty[0]&146685952&&(B||(n(23,B=new Ee.Popup({closeButton:r,closeOnClick:!1,closeOnMove:p,focusAfterOpen:P,maxWidth:k,className:y,anchor:F,offset:D})),ae=B.getElement(),B.on("open",()=>{n(0,q=!0),b(),W("open",B)}),B.on("close",()=>{n(0,q=!1),W("close",B)}),B.on("hover",()=>{W("hover",B)}))),t.$$.dirty[0]&8421384&&B&&a instanceof Ee.Marker&&(f==="click"?a.setPopup(B):a.getPopup()===B&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Ze.includes(f)&&(i==null?void 0:i.type)===f&&(le(i),rt(ve,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=f==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&f==="hover"&&ve&&(o&&i&&(i.layerType==="deckgl"?(n(10,I=i.coordinate),n(4,R=i.object?[i.object]:null)):(n(10,I=i.lngLat),n(4,R=i.features??[]))),n(0,q=(o||we)??!1)),t.$$.dirty[0]&12582914&&(Ie?B.setDOMContent(Ie):U&&B.setHTML(U)),t.$$.dirty[0]&8389632&&I&&B.setLngLat(I),t.$$.dirty[0]&41943045&&l){let _=B.isOpen();q&&!_?(B.addTo(l),J==="opening"&&n(25,J="justOpened")):!q&&_&&B.remove()}},[q,Ie,l,a,R,j,L,ve,Se,u,I,g,h,d,p,f,C,P,F,D,y,k,U,B,we,J,o,r,i,m,c,ln,an]}class Tn extends pe{constructor(e){super(),_e(this,e,In,Pn,de,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function On(t){let e;const n=t[16].default,r=De(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&He(r,n,o,o[24],e?Ue(n,o[24],l,null):Re(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function An(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[On]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new $t({props:l}),ee.push(()=>ie(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){T(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){A(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Sn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Nt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:m=void 0}=e,{layout:u=void 0}=e,{filter:g=void 0}=e,{applyToClusters:h=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:p=void 0}=e,{hoverCursor:f=void 0}=e,{manageHoverState:C=!1}=e,{hovered:P=null}=e,{eventsIfTopMost:F=!1}=e,{interactive:D=!0}=e;function y(L){P=L,n(0,P)}function k(L){re.call(this,t,L)}function I(L){re.call(this,t,L)}function U(L){re.call(this,t,L)}function q(L){re.call(this,t,L)}function W(L){re.call(this,t,L)}function j(L){re.call(this,t,L)}return t.$$set=L=>{"id"in L&&n(1,l=L.id),"source"in L&&n(2,i=L.source),"sourceLayer"in L&&n(3,a=L.sourceLayer),"beforeId"in L&&n(4,s=L.beforeId),"beforeLayerType"in L&&n(5,c=L.beforeLayerType),"paint"in L&&n(6,m=L.paint),"layout"in L&&n(7,u=L.layout),"filter"in L&&n(8,g=L.filter),"applyToClusters"in L&&n(9,h=L.applyToClusters),"minzoom"in L&&n(10,d=L.minzoom),"maxzoom"in L&&n(11,p=L.maxzoom),"hoverCursor"in L&&n(12,f=L.hoverCursor),"manageHoverState"in L&&n(13,C=L.manageHoverState),"hovered"in L&&n(0,P=L.hovered),"eventsIfTopMost"in L&&n(14,F=L.eventsIfTopMost),"interactive"in L&&n(15,D=L.interactive),"$$scope"in L&&n(24,o=L.$$scope)},[P,l,i,a,s,c,m,u,g,h,d,p,f,C,F,D,r,y,k,I,U,q,W,j,o]}class Fn extends pe{constructor(e){super(),_e(this,e,Sn,An,de,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Bn=t=>({props:t&8}),jt=t=>({props:$n(t[3])});function qn(t){let e,n;const r=t[1].default,o=De(r,t,t[2],jt);return{c(){e=Z("div"),o&&o.c(),this.h()},l(l){e=Q(l,"DIV",{class:!0});var i=te(e);o&&o.l(i),i.forEach(v),this.h()},h(){je(e,"class","govuk-prose")},m(l,i){M(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&He(o,r,l,l[2],n?Ue(r,l[2],i,Bn):Re(l[2]),jt)},i(l){n||(w(o,l),n=!0)},o(l){E(o,l),n=!1},d(l){l&&v(e),o&&o.d(l)}}}function Gn(t){let e,n;return e=new Tn({props:{openOn:t[0],$$slots:{default:[qn,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function $n(t){return t?t[0].properties??{}:{}}function Nn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Ht extends pe{constructor(e){super(),_e(this,e,Nn,Gn,de,{openOn:0})}}var zn=Object.defineProperty,G=(t,e)=>zn(t,"name",{value:e,configurable:!0}),Dn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Te(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=et(e),o=et(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Te(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Te(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Te(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};G(Dn,"GeojsonEquality");function Te(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}G(Te,"sameLength");function et(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}G(et,"explode");var Y=63710088e-1,Rt={centimeters:Y*100,centimetres:Y*100,degrees:360/(2*Math.PI),feet:Y*3.28084,inches:Y*39.37,kilometers:Y/1e3,kilometres:Y/1e3,meters:Y,metres:Y,miles:Y/1609.344,millimeters:Y*1e3,millimetres:Y*1e3,nauticalmiles:Y/1852,radians:1,yards:Y*1.0936},Lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ue(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}G(ue,"feature");function Hn(t,e,n={}){switch(t){case"Point":return We(e).geometry;case"LineString":return lt(e).geometry;case"Polygon":return it(e).geometry;case"MultiPoint":return Wt(e).geometry;case"MultiLineString":return Ut(e).geometry;case"MultiPolygon":return Jt(e).geometry;default:throw new Error(t+" is invalid")}}G(Hn,"geometry");function We(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Me(t[0])||!Me(t[1]))throw new Error("coordinates must contain numbers");return ue({type:"Point",coordinates:t},e,n)}G(We,"point");function Rn(t,e,n={}){return Je(t.map(r=>We(r,e)),n)}G(Rn,"points");function it(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ue({type:"Polygon",coordinates:t},e,n)}G(it,"polygon");function Un(t,e,n={}){return Je(t.map(r=>it(r,e)),n)}G(Un,"polygons");function lt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ue({type:"LineString",coordinates:t},e,n)}G(lt,"lineString");function Wn(t,e,n={}){return Je(t.map(r=>lt(r,e)),n)}G(Wn,"lineStrings");function Je(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}G(Je,"featureCollection");function Ut(t,e,n={}){return ue({type:"MultiLineString",coordinates:t},e,n)}G(Ut,"multiLineString");function Wt(t,e,n={}){return ue({type:"MultiPoint",coordinates:t},e,n)}G(Wt,"multiPoint");function Jt(t,e,n={}){return ue({type:"MultiPolygon",coordinates:t},e,n)}G(Jt,"multiPolygon");function Jn(t,e,n={}){return ue({type:"GeometryCollection",geometries:t},e,n)}G(Jn,"geometryCollection");function Vn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}G(Vn,"round");function Vt(t,e="kilometers"){const n=Rt[e];if(!n)throw new Error(e+" units is invalid");return t*n}G(Vt,"radiansToLength");function Ve(t,e="kilometers"){const n=Rt[e];if(!n)throw new Error(e+" units is invalid");return t/n}G(Ve,"lengthToRadians");function Xn(t,e){return ze(Ve(t,e))}G(Xn,"lengthToDegrees");function Kn(t){let e=t%360;return e<0&&(e+=360),e}G(Kn,"bearingToAzimuth");function ze(t){return t%(2*Math.PI)*180/Math.PI}G(ze,"radiansToDegrees");function $e(t){return t%360*Math.PI/180}G($e,"degreesToRadians");function Zn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Vt(Ve(t,e),n)}G(Zn,"convertLength");function Qn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Lt[e];if(!r)throw new Error("invalid original units");const o=Lt[n];if(!o)throw new Error("invalid final units");return t/r*o}G(Qn,"convertArea");function Me(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}G(Me,"isNumber");function Yn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}G(Yn,"isObject");function xn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Me(e))throw new Error("bbox must only contain numbers")})}G(xn,"validateBBox");function er(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}G(er,"validateId");var tr=Object.defineProperty,fe=(t,e)=>tr(t,"name",{value:e,configurable:!0});function Xt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}fe(Xt,"getCoord");function nr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}fe(nr,"getCoords");function Kt(t){if(t.length>1&&Me(t[0])&&Me(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Kt(t[0]);throw new Error("coordinates must only contain numbers")}fe(Kt,"containsNumber");function rr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}fe(rr,"geojsonType");function or(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}fe(or,"featureOf");function ir(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}fe(ir,"collectionOf");function lr(t){return t.type==="Feature"?t.geometry:t}fe(lr,"getGeom");function ar(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}fe(ar,"getType");var sr=Object.defineProperty,ur=(t,e)=>sr(t,"name",{value:e,configurable:!0});function Zt(t,e,n,r={}){const o=Xt(t),l=$e(o[0]),i=$e(o[1]),a=$e(n),s=Ve(e,r.units),c=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),m=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(c)),u=ze(m),g=ze(c);return We([u,g],r.properties)}ur(Zt,"destination");var fr=Zt,cr=Object.defineProperty,$=(t,e)=>cr(t,"name",{value:e,configurable:!0}),mr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Oe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=tt(e),o=tt(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Oe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Oe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Oe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};$(mr,"GeojsonEquality");function Oe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}$(Oe,"sameLength");function tt(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}$(tt,"explode");var x=63710088e-1,Qt={centimeters:x*100,centimetres:x*100,degrees:360/(2*Math.PI),feet:x*3.28084,inches:x*39.37,kilometers:x/1e3,kilometres:x/1e3,meters:x,metres:x,miles:x/1609.344,millimeters:x*1e3,millimetres:x*1e3,nauticalmiles:x/1852,radians:1,yards:x*1.0936},Ct={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ce(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}$(ce,"feature");function gr(t,e,n={}){switch(t){case"Point":return at(e).geometry;case"LineString":return ut(e).geometry;case"Polygon":return st(e).geometry;case"MultiPoint":return xt(e).geometry;case"MultiLineString":return Yt(e).geometry;case"MultiPolygon":return en(e).geometry;default:throw new Error(t+" is invalid")}}$(gr,"geometry");function at(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pe(t[0])||!Pe(t[1]))throw new Error("coordinates must contain numbers");return ce({type:"Point",coordinates:t},e,n)}$(at,"point");function hr(t,e,n={}){return Xe(t.map(r=>at(r,e)),n)}$(hr,"points");function st(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ce({type:"Polygon",coordinates:t},e,n)}$(st,"polygon");function dr(t,e,n={}){return Xe(t.map(r=>st(r,e)),n)}$(dr,"polygons");function ut(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ce({type:"LineString",coordinates:t},e,n)}$(ut,"lineString");function pr(t,e,n={}){return Xe(t.map(r=>ut(r,e)),n)}$(pr,"lineStrings");function Xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}$(Xe,"featureCollection");function Yt(t,e,n={}){return ce({type:"MultiLineString",coordinates:t},e,n)}$(Yt,"multiLineString");function xt(t,e,n={}){return ce({type:"MultiPoint",coordinates:t},e,n)}$(xt,"multiPoint");function en(t,e,n={}){return ce({type:"MultiPolygon",coordinates:t},e,n)}$(en,"multiPolygon");function _r(t,e,n={}){return ce({type:"GeometryCollection",geometries:t},e,n)}$(_r,"geometryCollection");function yr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}$(yr,"round");function tn(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t*n}$(tn,"radiansToLength");function ft(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t/n}$(ft,"lengthToRadians");function br(t,e){return ct(ft(t,e))}$(br,"lengthToDegrees");function vr(t){let e=t%360;return e<0&&(e+=360),e}$(vr,"bearingToAzimuth");function ct(t){return t%(2*Math.PI)*180/Math.PI}$(ct,"radiansToDegrees");function Ae(t){return t%360*Math.PI/180}$(Ae,"degreesToRadians");function wr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return tn(ft(t,e),n)}$(wr,"convertLength");function kr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Ct[e];if(!r)throw new Error("invalid original units");const o=Ct[n];if(!o)throw new Error("invalid final units");return t/r*o}$(kr,"convertArea");function Pe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}$(Pe,"isNumber");function Er(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}$(Er,"isObject");function jr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Pe(e))throw new Error("bbox must only contain numbers")})}$(jr,"validateBBox");function Lr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}$(Lr,"validateId");var Cr=Object.defineProperty,me=(t,e)=>Cr(t,"name",{value:e,configurable:!0});function nt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}me(nt,"getCoord");function Mr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}me(Mr,"getCoords");function nn(t){if(t.length>1&&Pe(t[0])&&Pe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return nn(t[0]);throw new Error("coordinates must only contain numbers")}me(nn,"containsNumber");function Pr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}me(Pr,"geojsonType");function Ir(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}me(Ir,"featureOf");function Tr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}me(Tr,"collectionOf");function Or(t){return t.type==="Feature"?t.geometry:t}me(Or,"getGeom");function Ar(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}me(Ar,"getType");var Sr=Object.defineProperty,rn=(t,e)=>Sr(t,"name",{value:e,configurable:!0});function mt(t,e,n={}){if(n.final===!0)return on(t,e);const r=nt(t),o=nt(e),l=Ae(r[0]),i=Ae(o[0]),a=Ae(r[1]),s=Ae(o[1]),c=Math.sin(i-l)*Math.cos(s),m=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ct(Math.atan2(c,m))}rn(mt,"bearing");function on(t,e){let n=mt(e,t);return n=(n+180)%360,n}rn(on,"calculateFinalBearing");var Fr=mt;function Br(t){let e,n,r,o,l,i,a,s,c,m,u,g;function h(y){t[6](y)}let d={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new Gt({props:d}),ee.push(()=>ie(e,"value",h));function p(y){t[7](y)}let f={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(f.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new vt({props:f}),ee.push(()=>ie(o,"value",p));function C(y){t[8](y)}let P={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(P.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new vt({props:P}),ee.push(()=>ie(a,"value",C));function F(y){t[9](y)}let D={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(D.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),m=new Dt({props:D}),ee.push(()=>ie(m,"value",F)),{c(){T(e.$$.fragment),r=N(),T(o.$$.fragment),i=N(),T(a.$$.fragment),c=N(),T(m.$$.fragment)},l(y){O(e.$$.fragment,y),r=z(y),O(o.$$.fragment,y),i=z(y),O(a.$$.fragment,y),c=z(y),O(m.$$.fragment,y)},m(y,k){A(e,y,k),M(y,r,k),A(o,y,k),M(y,i,k),A(a,y,k),M(y,c,k),A(m,y,k),g=!0},p(y,[k]){const I={};!n&&k&15&&(n=!0,I.value=y[3].jat[y[0]][y[1]].movements[y[2]].name,oe(()=>n=!1)),e.$set(I);const U={};!l&&k&15&&(l=!0,U.value=y[3].jat[y[0]][y[1]].movements[y[2]].kind,oe(()=>l=!1)),o.$set(U);const q={};!s&&k&15&&(s=!0,q.value=y[3].jat[y[0]][y[1]].movements[y[2]].score,oe(()=>s=!1)),a.$set(q);const W={};!u&&k&15&&(u=!0,W.value=y[3].jat[y[0]][y[1]].movements[y[2]].notes,oe(()=>u=!1)),m.$set(W)},i(y){g||(w(e.$$.fragment,y),w(o.$$.fragment,y),w(a.$$.fragment,y),w(m.$$.fragment,y),g=!0)},o(y){E(e.$$.fragment,y),E(o.$$.fragment,y),E(a.$$.fragment,y),E(m.$$.fragment,y),g=!1},d(y){y&&(v(r),v(i),v(c)),S(e,y),S(o,y),S(a,y),S(m,y)}}}function qr(t,e,n){let r;ge(t,K,h=>n(3,r=h));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=En(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function c(h){t.$$.not_equal(r.jat[o][l].movements[i].name,h)&&(r.jat[o][l].movements[i].name=h,K.set(r))}function m(h){t.$$.not_equal(r.jat[o][l].movements[i].kind,h)&&(r.jat[o][l].movements[i].kind=h,K.set(r))}function u(h){t.$$.not_equal(r.jat[o][l].movements[i].score,h)&&(r.jat[o][l].movements[i].score=h,K.set(r))}function g(h){t.$$.not_equal(r.jat[o][l].movements[i].notes,h)&&(r.jat[o][l].movements[i].notes=h,K.set(r))}return t.$$set=h=>{"junctionIdx"in h&&n(0,o=h.junctionIdx),"stage"in h&&n(1,l=h.stage),"idx"in h&&n(2,i=h.idx)},[o,l,i,r,a,s,c,m,u,g]}class Gr extends pe{constructor(e){super(),_e(this,e,qr,Br,de,{junctionIdx:0,stage:1,idx:2})}}const{window:$r}=pn;function Mt(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function Pt(t,e,n){const r=t.slice();return r[34]=e[n],r[36]=n,r}function Nr(t){let e,n,r,o,l,i;return e=new _n({props:{$$slots:{default:[Dr]},$$scope:{ctx:t}}}),e.$on("click",t[21]),r=new qt({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),r.$on("click",t[12]),l=new Gr({props:{junctionIdx:t[0],stage:t[1],idx:t[2]}}),{c(){T(e.$$.fragment),n=N(),T(r.$$.fragment),o=N(),T(l.$$.fragment)},l(a){O(e.$$.fragment,a),n=z(a),O(r.$$.fragment,a),o=z(a),O(l.$$.fragment,a)},m(a,s){A(e,a,s),M(a,n,s),A(r,a,s),M(a,o,s),A(l,a,s),i=!0},p(a,s){const c={};s[1]&128&&(c.$$scope={dirty:s,ctx:a}),e.$set(c);const m={};s[1]&128&&(m.$$scope={dirty:s,ctx:a}),r.$set(m);const u={};s[0]&1&&(u.junctionIdx=a[0]),s[0]&2&&(u.stage=a[1]),s[0]&4&&(u.idx=a[2]),l.$set(u)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(l.$$.fragment,a),i=!1},d(a){a&&(v(n),v(o)),S(e,a),S(r,a),S(l,a)}}}function zr(t){let e,n,r,o,l,i,a,s,c="Movements",m,u,g;e=new he({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new bn({}),l=new vn({});let h=t[5]&&It(t),d=Ce(t[4].jat[t[0]][t[1]].movements),p=[];for(let f=0;f<d.length;f+=1)p[f]=Tt(Pt(t,d,f));return{c(){T(e.$$.fragment),n=N(),T(r.$$.fragment),o=N(),T(l.$$.fragment),i=N(),h&&h.c(),a=N(),s=Z("h3"),s.textContent=c,m=N(),u=Z("ol");for(let f=0;f<p.length;f+=1)p[f].c()},l(f){O(e.$$.fragment,f),n=z(f),O(r.$$.fragment,f),o=z(f),O(l.$$.fragment,f),i=z(f),h&&h.l(f),a=z(f),s=Q(f,"H3",{"data-svelte-h":!0}),fn(s)!=="svelte-1dc52s8"&&(s.textContent=c),m=z(f),u=Q(f,"OL",{});var C=te(u);for(let P=0;P<p.length;P+=1)p[P].l(C);C.forEach(v)},m(f,C){A(e,f,C),M(f,n,C),A(r,f,C),M(f,o,C),A(l,f,C),M(f,i,C),h&&h.m(f,C),M(f,a,C),M(f,s,C),M(f,m,C),M(f,u,C);for(let P=0;P<p.length;P+=1)p[P]&&p[P].m(u,null);g=!0},p(f,C){const P={};if(C[1]&128&&(P.$$scope={dirty:C,ctx:f}),e.$set(P),f[5]?h?(h.p(f,C),C[0]&32&&w(h,1)):(h=It(f),h.c(),w(h,1),h.m(a.parentNode,a)):h&&(ye(),E(h,1,1,()=>{h=null}),be()),C[0]&539){d=Ce(f[4].jat[f[0]][f[1]].movements);let F;for(F=0;F<d.length;F+=1){const D=Pt(f,d,F);p[F]?p[F].p(D,C):(p[F]=Tt(D),p[F].c(),p[F].m(u,null))}for(;F<p.length;F+=1)p[F].d(1);p.length=d.length}},i(f){g||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(l.$$.fragment,f),w(h),g=!0)},o(f){E(e.$$.fragment,f),E(r.$$.fragment,f),E(l.$$.fragment,f),E(h),g=!1},d(f){f&&(v(n),v(o),v(i),v(a),v(s),v(m),v(u)),S(e,f),S(r,f),S(l,f),h&&h.d(f),ot(p,f)}}}function Dr(t){let e;return{c(){e=V("Save")},l(n){e=X(n,"Save")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function Hr(t){let e;return{c(){e=V("Delete")},l(n){e=X(n,"Delete")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function Rr(t){let e;return{c(){e=V("Zoom to fit")},l(n){e=X(n,"Zoom to fit")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function It(t){let e,n,r;function o(i){t[17](i)}let l={map:t[5]};return t[6]!==void 0&&(l.enabled=t[6]),e=new wn({props:l}),ee.push(()=>ie(e,"enabled",o)),{c(){T(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){A(e,i,a),r=!0},p(i,a){const s={};a[0]&32&&(s.map=i[5]),!n&&a[0]&64&&(n=!0,s.enabled=i[6],oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Tt(t){let e,n,r=(t[34].name||"Unnamed movement")+"",o,l,i,a;function s(){return t[18](t[36])}function c(){return t[19](t[36])}return{c(){e=Z("li"),n=Z("a"),o=V(r),l=N(),this.h()},l(m){e=Q(m,"LI",{});var u=te(e);n=Q(u,"A",{href:!0});var g=te(n);o=X(g,r),g.forEach(v),l=z(u),u.forEach(v),this.h()},h(){je(n,"href","#")},m(m,u){M(m,e,u),se(e,n),se(n,o),se(e,l),i||(a=[Ge(n,"click",s),Ge(n,"mouseenter",c),Ge(n,"mouseleave",t[20])],i=!0)},p(m,u){t=m,u[0]&19&&r!==(r=(t[34].name||"Unnamed movement")+"")&&Le(o,r)},d(m){m&&v(e),i=!1,cn(a)}}}function Ur(t){let e,n;return{c(){e=Z("span"),this.h()},l(r){e=Q(r,"SPAN",{class:!0,style:!0}),te(e).forEach(v),this.h()},h(){je(e,"class","dot svelte-1kvjd2"),je(e,"style",n=`background-color: ${t[8][t[34].score]}`),ne(e,"opacity",t[34].kind=="pedestrian"?"0%":"100%")},m(r,o){M(r,e,o)},p(r,o){o[0]&19&&n!==(n=`background-color: ${r[8][r[34].score]}`)&&je(e,"style",n);const l=o[0]&19;(o[0]&19||l)&&ne(e,"opacity",r[34].kind=="pedestrian"?"0%":"100%")},d(r){r&&v(e)}}}function Wr(t){let e;return{c(){e=Z("span"),this.h()},l(n){e=Q(n,"SPAN",{class:!0}),te(e).forEach(v),this.h()},h(){je(e,"class","dot svelte-1kvjd2"),ne(e,"background-color",t[8][t[34].score]),ne(e,"opacity","0%")},m(n,r){M(n,e,r)},p(n,r){r[0]&19&&ne(e,"background-color",n[8][n[34].score])},d(n){n&&v(e)}}}function Ot(t){let e,n,r,o,l,i;function a(p){t[22](p,t[34])}function s(){return t[23](t[36])}function c(){return t[24](t[36])}let m={draggable:!0,$$slots:{default:[Ur]},$$scope:{ctx:t}};t[34].point1!==void 0&&(m.lngLat=t[34].point1),e=new bt({props:m}),ee.push(()=>ie(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",c);function u(p){t[25](p,t[34])}function g(){return t[26](t[36])}function h(){return t[27](t[36])}let d={draggable:!0,$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[34].point2!==void 0&&(d.lngLat=t[34].point2),o=new bt({props:d}),ee.push(()=>ie(o,"lngLat",u)),o.$on("dragend",g),o.$on("click",h),{c(){T(e.$$.fragment),r=N(),T(o.$$.fragment)},l(p){O(e.$$.fragment,p),r=z(p),O(o.$$.fragment,p)},m(p,f){A(e,p,f),M(p,r,f),A(o,p,f),i=!0},p(p,f){t=p;const C={};f[0]&19|f[1]&128&&(C.$$scope={dirty:f,ctx:t}),!n&&f[0]&19&&(n=!0,C.lngLat=t[34].point1,oe(()=>n=!1)),e.$set(C);const P={};f[0]&19|f[1]&128&&(P.$$scope={dirty:f,ctx:t}),!l&&f[0]&19&&(l=!0,P.lngLat=t[34].point2,oe(()=>l=!1)),o.$set(P)},i(p){i||(w(e.$$.fragment,p),w(o.$$.fragment,p),i=!0)},o(p){E(e.$$.fragment,p),E(o.$$.fragment,p),i=!1},d(p){p&&v(r),S(e,p),S(o,p)}}}function Jr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){M(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&Le(n,e)},d(r){r&&v(n)}}}function Vr(t){let e,n;return e=new Ht({props:{$$slots:{default:[Jr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p(r,o){const l={};o[1]&132&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Xr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){M(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&Le(n,e)},d(r){r&&v(n)}}}function Kr(t){let e,n;return e=new Ht({props:{$$slots:{default:[Xr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p(r,o){const l={};o[1]&132&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Zr(t){let e,n,r,o,l,i;return e=new xe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":yt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[10]),r=new xe({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":yt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Kr]},$$scope:{ctx:t}}}),r.$on("click",t[10]),l=new Fn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){T(e.$$.fragment),n=N(),T(r.$$.fragment),o=N(),T(l.$$.fragment)},l(a){O(e.$$.fragment,a),n=z(a),O(r.$$.fragment,a),o=z(a),O(l.$$.fragment,a)},m(a,s){A(e,a,s),M(a,n,s),A(r,a,s),M(a,o,s),A(l,a,s),i=!0},p(a,s){const c={};s[1]&128&&(c.$$scope={dirty:s,ctx:a}),e.$set(c);const m={};s[1]&128&&(m.$$scope={dirty:s,ctx:a}),r.$set(m)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(l.$$.fragment,a),i=!1},d(a){a&&(v(n),v(o)),S(e,a),S(r,a),S(l,a)}}}function Qr(t){let e,n;return e=new xe({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p:mn,i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Yr(t){let e,n,r,o,l,i,a,s=Ce(t[4].jat[t[0]][t[1]].movements),c=[];for(let u=0;u<s.length;u+=1)c[u]=Ot(Mt(t,s,u));const m=u=>E(c[u],1,1,()=>{c[u]=null});return n=new _t({props:{data:t[11](t[4].jat[t[0]][t[1]].movements),$$slots:{default:[Zr]},$$scope:{ctx:t}}}),o=new _t({props:{data:t[7],$$slots:{default:[Qr]},$$scope:{ctx:t}}}),i=new kn({props:{map:t[5]}}),{c(){for(let u=0;u<c.length;u+=1)c[u].c();e=N(),T(n.$$.fragment),r=N(),T(o.$$.fragment),l=N(),T(i.$$.fragment)},l(u){for(let g=0;g<c.length;g+=1)c[g].l(u);e=z(u),O(n.$$.fragment,u),r=z(u),O(o.$$.fragment,u),l=z(u),O(i.$$.fragment,u)},m(u,g){for(let h=0;h<c.length;h+=1)c[h]&&c[h].m(u,g);M(u,e,g),A(n,u,g),M(u,r,g),A(o,u,g),M(u,l,g),A(i,u,g),a=!0},p(u,g){if(g[0]&787){s=Ce(u[4].jat[u[0]][u[1]].movements);let f;for(f=0;f<s.length;f+=1){const C=Mt(u,s,f);c[f]?(c[f].p(C,g),w(c[f],1)):(c[f]=Ot(C),c[f].c(),w(c[f],1),c[f].m(e.parentNode,e))}for(ye(),f=s.length;f<c.length;f+=1)m(f);be()}const h={};g[0]&19&&(h.data=u[11](u[4].jat[u[0]][u[1]].movements)),g[1]&128&&(h.$$scope={dirty:g,ctx:u}),n.$set(h);const d={};g[0]&128&&(d.data=u[7]),g[1]&128&&(d.$$scope={dirty:g,ctx:u}),o.$set(d);const p={};g[0]&32&&(p.map=u[5]),i.$set(p)},i(u){if(!a){for(let g=0;g<s.length;g+=1)w(c[g]);w(n.$$.fragment,u),w(o.$$.fragment,u),w(i.$$.fragment,u),a=!0}},o(u){c=c.filter(Boolean);for(let g=0;g<c.length;g+=1)E(c[g]);E(n.$$.fragment,u),E(o.$$.fragment,u),E(i.$$.fragment,u),a=!1},d(u){u&&(v(e),v(r),v(l)),ot(c,u),S(n,u),S(o,u),S(i,u)}}}function xr(t){let e,n,r,o,l,i,a,s,c,m,u,g,h,d;function p(k){t[15](k)}let f={label:"Commentary / Notes"};t[4].jat[t[0]][t[1]].notes!==void 0&&(f.value=t[4].jat[t[0]][t[1]].notes),e=new Dt({props:f}),ee.push(()=>ie(e,"value",p));const C=[zr,Nr],P=[];function F(k,I){return k[2]==null?0:1}i=F(t),a=P[i]=C[i](t);function D(k){t[28](k)}let y={$$slots:{default:[Yr]},$$scope:{ctx:t}};return t[5]!==void 0&&(y.map=t[5]),m=new dn({props:y}),ee.push(()=>ie(m,"map",D)),{c(){T(e.$$.fragment),r=N(),o=Z("div"),l=Z("div"),a.c(),s=N(),c=Z("div"),T(m.$$.fragment),this.h()},l(k){O(e.$$.fragment,k),r=z(k),o=Q(k,"DIV",{style:!0});var I=te(o);l=Q(I,"DIV",{style:!0});var U=te(l);a.l(U),U.forEach(v),s=z(I),c=Q(I,"DIV",{style:!0});var q=te(c);O(m.$$.fragment,q),q.forEach(v),I.forEach(v),this.h()},h(){ne(l,"width","30%"),ne(l,"overflow-y","scroll"),ne(l,"padding","10px"),ne(c,"position","relative"),ne(c,"width","100%"),ne(o,"display","flex"),ne(o,"height","80vh")},m(k,I){A(e,k,I),M(k,r,I),M(k,o,I),se(o,l),P[i].m(l,null),se(o,s),se(o,c),A(m,c,null),g=!0,h||(d=Ge($r,"keydown",t[14]),h=!0)},p(k,I){const U={};!n&&I[0]&19&&(n=!0,U.value=k[4].jat[k[0]][k[1]].notes,oe(()=>n=!1)),e.$set(U);let q=i;i=F(k),i===q?P[i].p(k,I):(ye(),E(P[q],1,1,()=>{P[q]=null}),be(),a=P[i],a?a.p(k,I):(a=P[i]=C[i](k),a.c()),w(a,1),a.m(l,null));const W={};I[0]&179|I[1]&128&&(W.$$scope={dirty:I,ctx:k}),!u&&I[0]&32&&(u=!0,W.map=k[5],oe(()=>u=!1)),m.$set(W)},i(k){g||(w(e.$$.fragment,k),w(a),w(m.$$.fragment,k),g=!0)},o(k){E(e.$$.fragment,k),E(a),E(m.$$.fragment,k),g=!1},d(k){k&&(v(r),v(o)),S(e,k),P[i].d(),S(m),h=!1,d()}}}function eo(t,e,n){let r,o;ge(t,K,b=>n(4,o=b));let{junctionIdx:l}=e,{stage:i}=e,a,s=null,c=null,m=!1,u={0:Be.red.background,1:Be.amber.background,2:Be.green.background,X:Be.critical.background};function g(b,H,R){let J={type:"FeatureCollection",features:[]},le=H??R;return le!=null&&J.features.push(C(b.jat[l][i].movements[le],le)),J}function h(b){n(2,s=b),n(3,c=null)}function d(b){if(!m){for(let H of a.queryRenderedFeatures(b.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(s!=null){n(2,s=null);return}rt(K,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:b.lngLat.toArray(),point2:fr(b.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(2,s=o.jat[l][i].movements.length-1),n(3,c=null)}}function p(b){h(b.detail.features[0].id)}Ft(()=>{a.on("click",d),D(!1)}),Bt(()=>{a.off("click",d)});function f(b){let H={type:"FeatureCollection",features:b.map((R,J)=>C(R,J))};for(let R of b)if(H.features.push(P(R,H.features.length)),R.kind=="pedestrian"){let J={...R,point1:R.point2,point2:R.point1};H.features.push(P(J,H.features.length))}return H}function C(b,H){return{type:"Feature",id:H,properties:{name:b.name,kind:b.kind,color:u[b.score]},geometry:{type:"LineString",coordinates:[b.point1,b.point2]}}}function P(b,H){return{type:"Feature",id:H,properties:{kind:b.kind,color:u[b.score],angle:Fr(b.point1,b.point2)},geometry:{type:"Point",coordinates:b.point2}}}function F(){window.confirm("Delete this movement?")&&(o.jat[l][i].movements.splice(s,1),K.set(o),n(2,s=null))}function D(b){o.jat[l][i].movements.length>0&&a.fitBounds(yn(f(o.jat[l][i].movements)),{padding:20,animate:b})}function y(b){s!=null&&b.key=="Escape"?(b.stopPropagation(),n(2,s=null)):s!=null&&b.key=="Delete"&&F()}function k(b){t.$$.not_equal(o.jat[l][i].notes,b)&&(o.jat[l][i].notes=b,K.set(o))}const I=()=>D(!0);function U(b){m=b,n(6,m)}const q=b=>h(b),W=b=>n(3,c=b),j=()=>n(3,c=null),L=()=>n(2,s=null);function ve(b,H){t.$$.not_equal(H.point1,b)&&(H.point1=b,K.set(o))}const Se=b=>h(b),Ke=b=>h(b);function Ze(b,H){t.$$.not_equal(H.point2,b)&&(H.point2=b,K.set(o))}const B=b=>h(b),we=b=>h(b);function ae(b){a=b,n(5,a)}return t.$$set=b=>{"junctionIdx"in b&&n(0,l=b.junctionIdx),"stage"in b&&n(1,i=b.stage)},t.$$.update=()=>{t.$$.dirty[0]&28&&n(7,r=g(o,s,c))},[l,i,s,c,o,a,m,r,u,h,p,f,F,D,y,k,I,U,q,W,j,L,ve,Se,Ke,Ze,B,we,ae]}class to extends pe{constructor(e){super(),_e(this,e,eo,xr,de,{junctionIdx:0,stage:1},null,[-1,-1])}}function At(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function no(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,c,m,u;return s=new he({props:{$$slots:{default:[io]},$$scope:{ctx:t}}}),s.$on("click",t[10]),m=new to({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=Z("h2"),r=V(n),o=V(" - "),i=V(l),a=N(),T(s.$$.fragment),c=N(),T(m.$$.fragment)},l(g){e=Q(g,"H2",{});var h=te(e);r=X(h,n),o=X(h," - "),i=X(h,l),h.forEach(v),a=z(g),O(s.$$.fragment,g),c=z(g),O(m.$$.fragment,g)},m(g,h){M(g,e,h),se(e,r),se(e,o),se(e,i),M(g,a,h),A(s,g,h),M(g,c,h),A(m,g,h),u=!0},p(g,h){(!u||h&3)&&n!==(n=(g[1].jat[g[0].idx].name||"Untitled junction")+"")&&Le(r,n),(!u||h&1)&&l!==(l=g[0].stage+"")&&Le(i,l);const d={};h&16384&&(d.$$scope={dirty:h,ctx:g}),s.$set(d);const p={};h&1&&(p.junctionIdx=g[0].idx),h&1&&(p.stage=g[0].stage),m.$set(p)},i(g){u||(w(s.$$.fragment,g),w(m.$$.fragment,g),u=!0)},o(g){E(s.$$.fragment,g),E(m.$$.fragment,g),u=!1},d(g){g&&(v(e),v(a),v(c)),S(s,g),S(m,g)}}}function ro(t){let e,n,r,o,l,i,a,s,c,m,u;e=new he({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new qt({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function g(d){t[7](d)}let h={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(h.value=t[1].jat[t[0].idx].name),l=new Gt({props:h}),ee.push(()=>ie(l,"value",g)),s=new he({props:{$$slots:{default:[so]},$$scope:{ctx:t}}}),s.$on("click",t[8]),m=new he({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),m.$on("click",t[9]),{c(){T(e.$$.fragment),n=N(),T(r.$$.fragment),o=N(),T(l.$$.fragment),a=N(),T(s.$$.fragment),c=N(),T(m.$$.fragment)},l(d){O(e.$$.fragment,d),n=z(d),O(r.$$.fragment,d),o=z(d),O(l.$$.fragment,d),a=z(d),O(s.$$.fragment,d),c=z(d),O(m.$$.fragment,d)},m(d,p){A(e,d,p),M(d,n,p),A(r,d,p),M(d,o,p),A(l,d,p),M(d,a,p),A(s,d,p),M(d,c,p),A(m,d,p),u=!0},p(d,p){const f={};p&16384&&(f.$$scope={dirty:p,ctx:d}),e.$set(f);const C={};p&16384&&(C.$$scope={dirty:p,ctx:d}),r.$set(C);const P={};!i&&p&3&&(i=!0,P.value=d[1].jat[d[0].idx].name,oe(()=>i=!1)),l.$set(P);const F={};p&16384&&(F.$$scope={dirty:p,ctx:d}),s.$set(F);const D={};p&16384&&(D.$$scope={dirty:p,ctx:d}),m.$set(D)},i(d){u||(w(e.$$.fragment,d),w(r.$$.fragment,d),w(l.$$.fragment,d),w(s.$$.fragment,d),w(m.$$.fragment,d),u=!0)},o(d){E(e.$$.fragment,d),E(r.$$.fragment,d),E(l.$$.fragment,d),E(s.$$.fragment,d),E(m.$$.fragment,d),u=!1},d(d){d&&(v(n),v(o),v(a),v(c)),S(e,d),S(r,d),S(l,d),S(s,d),S(m,d)}}}function oo(t){let e,n,r,o;e=new he({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=Ce(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=St(At(t,l,s));const a=s=>E(i[s],1,1,()=>{i[s]=null});return{c(){T(e.$$.fragment),n=N(),r=Z("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){O(e.$$.fragment,s),n=z(s),r=Q(s,"OL",{});var c=te(r);for(let m=0;m<i.length;m+=1)i[m].l(c);c.forEach(v)},m(s,c){A(e,s,c),M(s,n,c),M(s,r,c);for(let m=0;m<i.length;m+=1)i[m]&&i[m].m(r,null);o=!0},p(s,c){const m={};if(c&16384&&(m.$$scope={dirty:c,ctx:s}),e.$set(m),c&3){l=Ce(s[1].jat);let u;for(u=0;u<l.length;u+=1){const g=At(s,l,u);i[u]?(i[u].p(g,c),w(i[u],1)):(i[u]=St(g),i[u].c(),w(i[u],1),i[u].m(r,null))}for(ye(),u=l.length;u<i.length;u+=1)a(u);be()}},i(s){if(!o){w(e.$$.fragment,s);for(let c=0;c<l.length;c+=1)w(i[c]);o=!0}},o(s){E(e.$$.fragment,s),i=i.filter(Boolean);for(let c=0;c<i.length;c+=1)E(i[c]);o=!1},d(s){s&&(v(n),v(r)),S(e,s),ot(i,s)}}}function io(t){let e;return{c(){e=V("Back")},l(n){e=X(n,"Back")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function lo(t){let e;return{c(){e=V("Back to all junctions")},l(n){e=X(n,"Back to all junctions")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function ao(t){let e;return{c(){e=V("Delete")},l(n){e=X(n,"Delete")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function so(t){let e;return{c(){e=V("Existing")},l(n){e=X(n,"Existing")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function uo(t){let e;return{c(){e=V("Proposed")},l(n){e=X(n,"Proposed")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function fo(t){let e;return{c(){e=V("Add new junction")},l(n){e=X(n,"Add new junction")},m(n,r){M(n,e,r)},d(n){n&&v(e)}}}function co(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){M(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&Le(n,e)},d(r){r&&v(n)}}}function St(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new he({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=Z("li"),T(n.$$.fragment),r=N()},l(i){e=Q(i,"LI",{});var a=te(e);O(n.$$.fragment,a),r=z(a),a.forEach(v)},m(i,a){M(i,e,a),A(n,e,null),se(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){E(n.$$.fragment,i),o=!1},d(i){i&&v(e),S(n)}}}function mo(t){let e,n,r,o;const l=[oo,ro,no],i=[];function a(s,c){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=Ne()},l(s){n&&n.l(s),r=Ne()},m(s,c){~e&&i[e].m(s,c),M(s,r,c),o=!0},p(s,[c]){let m=e;e=a(s),e===m?~e&&i[e].p(s,c):(n&&(ye(),E(i[m],1,1,()=>{i[m]=null}),be()),~e?(n=i[e],n?n.p(s,c):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){E(n),o=!1},d(s){s&&v(r),~e&&i[e].d(s)}}}function qe(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function go(t,e,n){let r;ge(t,K,d=>n(1,r=d));let o={kind:"list"};function l(){rt(K,r.jat=[...r.jat,{name:"",existing:{movements:[],notes:""},proposed:{movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(d){window.confirm("Delete this junction?")&&(r.jat.splice(d,1),K.set(r),n(0,o={kind:"list"}))}const a=d=>n(0,o={kind:"junction",idx:d}),s=()=>n(0,o={kind:"list"}),c=()=>i(qe(o));function m(d){t.$$.not_equal(r.jat[o.idx].name,d)&&(r.jat[o.idx].name=d,K.set(r))}return[o,r,l,i,a,s,c,m,()=>n(0,o={kind:"map",idx:qe(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:qe(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:qe(o)})]}class To extends pe{constructor(e){super(),_e(this,e,go,mo,de,{})}}export{To as component};
