import{s as ge,l as Ve,e as T,a as E,c as V,b as R,g as N,f as v,r as I,w as ie,i as C,h as S,z as oe,u as je,m as Me,o as Pe,B as Se,H as lt,a8 as pt,t as Y,d as Z,y as we,j as pe,q as be,O as gt,C as Ge,v as X,E as Ce,x,a9 as it,k as Be,U as qe,N as Le,p as Ee,n as mt,R as Ne,S as De}from"../chunks/scheduler.BV_JqZpr.js";import{S as me,i as de,t as w,b as L,c as j,a as M,m as P,d as G,e as ee,g as ce,f as _e}from"../chunks/index.DDJL-Wug.js";import{e as fe}from"../chunks/each.DPttds9k.js";import{c as dt,p as ht}from"../chunks/colors.CYEpEtTL.js";import{p as ot}from"../chunks/index.CHGyWvXl.js";import{S as Te,W as $t}from"../chunks/WarningButton.Ck9VEuu1.js";import{S as Ie}from"../chunks/Select.CsgDAO5u.js";import{T as st}from"../chunks/TextArea.BH4PHWGI.js";import{T as rt}from"../chunks/TextInput.XULGbN7s.js";import{s as K}from"../chunks/data.BUqxnV5Q.js";import{s as ke,b as ye,a as vt,B as bt,G as kt,c as yt,M as at}from"../chunks/GeoreferenceLayer.aO7-9gSU.js";import{Y as ft}from"../chunks/YesNo.DCJCMqV4.js";import{D as wt}from"../chunks/DefaultButton.DCHkaEOp.js";import{v as ut,E as Ct}from"../chunks/FormElement.DdgtvYg6.js";import{M as Lt,G as It}from"../chunks/MapLibreMap.D4TVTeLt.js";import{C as St}from"../chunks/CircleLayer.9_xuu0ie.js";const ct=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global,Et=t=>({}),Fe=t=>({});function Nt(t){let e,l,n,i,g,a,p,f,b;const _=t[5].default,u=Ve(_,t,t[4],null),c=t[5].right,o=Ve(c,t,t[4],Fe);return{c(){e=T("div"),l=T("input"),n=E(),i=T("label"),u&&u.c(),g=E(),a=T("span"),o&&o.c(),this.h()},l(r){e=V(r,"DIV",{class:!0,style:!0});var $=R(e);l=V($,"INPUT",{type:!0,class:!0,id:!0}),n=N($),i=V($,"LABEL",{class:!0,for:!0,title:!0});var k=R(i);u&&u.l(k),k.forEach(v),g=N($),a=V($,"SPAN",{style:!0});var h=R(a);o&&o.l(h),h.forEach(v),$.forEach(v),this.h()},h(){I(l,"type","checkbox"),I(l,"class","govuk-checkboxes__input"),I(l,"id",t[3]),I(i,"class","govuk-label govuk-checkboxes__label"),I(i,"for",t[3]),I(i,"title",t[1]),ie(a,"float","right"),I(e,"class","govuk-checkboxes__item"),I(e,"style",t[2])},m(r,$){C(r,e,$),S(e,l),l.checked=t[0],S(e,n),S(e,i),u&&u.m(i,null),S(e,g),S(e,a),o&&o.m(a,null),p=!0,f||(b=[oe(l,"change",t[7]),oe(l,"change",t[6])],f=!0)},p(r,[$]){$&1&&(l.checked=r[0]),u&&u.p&&(!p||$&16)&&je(u,_,r,r[4],p?Pe(_,r[4],$,null):Me(r[4]),null),(!p||$&2)&&I(i,"title",r[1]),o&&o.p&&(!p||$&16)&&je(o,c,r,r[4],p?Pe(c,r[4],$,Et):Me(r[4]),Fe)},i(r){p||(w(u,r),w(o,r),p=!0)},o(r){L(u,r),L(o,r),p=!1},d(r){r&&v(e),u&&u.d(r),o&&o.d(r),f=!1,Se(b)}}}function Dt(t,e,l){let{$$slots:n={},$$scope:i}=e;const g=pt(n);let{checked:a}=e,{hint:p=null}=e,b=g.right!==void 0?"float: none":"",_=ut();function u(o){lt.call(this,t,o)}function c(){a=this.checked,l(0,a)}return t.$$set=o=>{"checked"in o&&l(0,a=o.checked),"hint"in o&&l(1,p=o.hint),"$$scope"in o&&l(4,i=o.$$scope)},[a,p,b,_,i,n,u,c]}class At extends me{constructor(e){super(),de(this,e,Dt,Nt,ge,{checked:0,hint:1})}}function Oe(t,e,l){const n=t.slice();return n[10]=e[l][0],n[11]=e[l][1],n}function Re(t){let e,l,n,i,g=!1,a,p,f=t[11]+"",b,_,u,c,o,r;return c=gt(t[9][0]),{c(){e=T("div"),l=T("input"),a=E(),p=T("label"),b=Y(f),u=E(),this.h()},l($){e=V($,"DIV",{class:!0});var k=R(e);l=V(k,"INPUT",{class:!0,id:!0,type:!0}),a=N(k),p=V(k,"LABEL",{class:!0,for:!0});var h=R(p);b=Z(h,f),h.forEach(v),u=N(k),k.forEach(v),this.h()},h(){I(l,"class","govuk-radios__input"),I(l,"id",n=t[5]+t[10]),I(l,"type","radio"),l.__value=i=t[10],Ge(l,l.__value),I(p,"class","govuk-label govuk-radios__label"),I(p,"for",_=t[5]+t[10]),I(e,"class","govuk-radios__item"),c.p(l)},m($,k){C($,e,k),S(e,l),l.checked=l.__value===t[0],S(e,a),S(e,p),S(p,b),S(e,u),o||(r=[oe(l,"change",t[8]),oe(l,"change",t[7])],o=!0)},p($,k){k&4&&n!==(n=$[5]+$[10])&&I(l,"id",n),k&4&&i!==(i=$[10])&&(l.__value=i,Ge(l,l.__value),g=!0),(g||k&5)&&(l.checked=l.__value===$[0]),k&4&&f!==(f=$[11]+"")&&pe(b,f),k&4&&_!==(_=$[5]+$[10])&&I(p,"for",_)},d($){$&&v(e),c.r(),o=!1,Se(r)}}}function Bt(t){let e,l,n,i,g,a,p,f,b;a=new Ct({props:{errorMessage:t[4]}});let _=fe(t[2]),u=[];for(let c=0;c<_.length;c+=1)u[c]=Re(Oe(t,_,c));return{c(){e=T("div"),l=T("fieldset"),n=T("legend"),i=Y(t[1]),g=E(),j(a.$$.fragment),p=E(),f=T("div");for(let c=0;c<u.length;c+=1)u[c].c();this.h()},l(c){e=V(c,"DIV",{class:!0});var o=R(e);l=V(o,"FIELDSET",{class:!0});var r=R(l);n=V(r,"LEGEND",{class:!0});var $=R(n);i=Z($,t[1]),$.forEach(v),g=N(r),M(a.$$.fragment,r),p=N(r),f=V(r,"DIV",{class:!0,"data-module":!0});var k=R(f);for(let h=0;h<u.length;h+=1)u[h].l(k);k.forEach(v),r.forEach(v),o.forEach(v),this.h()},h(){I(n,"class","govuk-fieldset__legend govuk-label--s"),I(f,"class","govuk-radios"),I(f,"data-module","govuk-radios"),we(f,"govuk-radios--inline",t[3]),we(f,"govuk-radios--small",t[3]),I(l,"class","govuk-fieldset"),I(e,"class","govuk-form-group")},m(c,o){C(c,e,o),S(e,l),S(l,n),S(n,i),S(l,g),P(a,l,null),S(l,p),S(l,f);for(let r=0;r<u.length;r+=1)u[r]&&u[r].m(f,null);b=!0},p(c,[o]){(!b||o&2)&&pe(i,c[1]);const r={};if(o&16&&(r.errorMessage=c[4]),a.$set(r),o&37){_=fe(c[2]);let $;for($=0;$<_.length;$+=1){const k=Oe(c,_,$);u[$]?u[$].p(k,o):(u[$]=Re(k),u[$].c(),u[$].m(f,null))}for(;$<u.length;$+=1)u[$].d(1);u.length=_.length}(!b||o&8)&&we(f,"govuk-radios--inline",c[3]),(!b||o&8)&&we(f,"govuk-radios--small",c[3])},i(c){b||(w(a.$$.fragment,c),b=!0)},o(c){L(a.$$.fragment,c),b=!1},d(c){c&&v(e),G(a),be(u,c)}}}function qt(t,e,l){let n,{legend:i}=e,{choices:g}=e,{inlineSmall:a=!1}=e,{required:p=!1}=e,{value:f}=e,b=ut();const _=[[]];function u(o){lt.call(this,t,o)}function c(){f=this.__value,l(0,f)}return t.$$set=o=>{"legend"in o&&l(1,i=o.legend),"choices"in o&&l(2,g=o.choices),"inlineSmall"in o&&l(3,a=o.inlineSmall),"required"in o&&l(6,p=o.required),"value"in o&&l(0,f=o.value)},t.$$.update=()=>{t.$$.dirty&65&&l(4,n=p&&f==""?"Required":"")},[f,i,g,a,n,b,p,u,c,_]}class _t extends me{constructor(e){super(),de(this,e,qt,Bt,ge,{legend:1,choices:2,inlineSmall:3,required:6,value:0})}}const{window:Tt}=ct;function Vt(t){let e;return{c(){e=Y("StreetView")},l(l){e=Z(l,"StreetView")},m(l,n){C(l,e,n)},d(l){l&&v(e)}}}function Ue(t){let e,l,n;function i(a){t[5](a)}let g={legend:"Source",choices:[["google","Google StreetView"],["bing","Bing Streetside"]],inlineSmall:!0};return t[1]!==void 0&&(g.value=t[1]),e=new _t({props:g}),X.push(()=>ee(e,"value",i)),{c(){j(e.$$.fragment)},l(a){M(e.$$.fragment,a)},m(a,p){P(e,a,p),n=!0},p(a,p){const f={};!l&&p&2&&(l=!0,f.value=a[1],x(()=>l=!1)),e.$set(f)},i(a){n||(w(e.$$.fragment,a),n=!0)},o(a){L(e.$$.fragment,a),n=!1},d(a){G(e,a)}}}function jt(t){let e,l,n,i,g,a,p;function f(u){t[4](u)}let b={$$slots:{default:[Vt]},$$scope:{ctx:t}};t[0]!==void 0&&(b.checked=t[0]),e=new At({props:b}),X.push(()=>ee(e,"checked",f));let _=t[0]&&Ue(t);return{c(){j(e.$$.fragment),n=E(),_&&_.c(),i=Ce()},l(u){M(e.$$.fragment,u),n=N(u),_&&_.l(u),i=Ce()},m(u,c){P(e,u,c),C(u,n,c),_&&_.m(u,c),C(u,i,c),g=!0,a||(p=oe(Tt,"keydown",t[2]),a=!0)},p(u,[c]){const o={};c&512&&(o.$$scope={dirty:c,ctx:u}),!l&&c&1&&(l=!0,o.checked=u[0],x(()=>l=!1)),e.$set(o),u[0]?_?(_.p(u,c),c&1&&w(_,1)):(_=Ue(u),_.c(),w(_,1),_.m(i.parentNode,i)):_&&(ce(),L(_,1,1,()=>{_=null}),_e())},i(u){g||(w(e.$$.fragment,u),w(_),g=!0)},o(u){L(e.$$.fragment,u),L(_),g=!1},d(u){u&&(v(n),v(i)),G(e,u),_&&_.d(u),a=!1,p()}}}function Mt(t,e,l){let{map:n}=e,{enabled:i=!1}=e,g="google";function a(){n.on("click",f),n.getCanvas().style.cursor="zoom-in"}function p(){n.off("click",f),n.getCanvas().style.cursor="auto"}it(p);function f(c){window.open(g=="google"?ke(c.lngLat.toArray()):ye(c.lngLat.toArray()),"_blank"),l(0,i=!1)}function b(c){i&&c.key=="Escape"&&l(0,i=!1)}function _(c){i=c,l(0,i)}function u(c){g=c,l(1,g)}return t.$$set=c=>{"map"in c&&l(3,n=c.map),"enabled"in c&&l(0,i=c.enabled)},t.$$.update=()=>{t.$$.dirty&1&&(i?a():p())},[i,g,b,n,_,u]}class Pt extends me{constructor(e){super(),de(this,e,Mt,jt,ge,{map:3,enabled:0})}}function We(t){let e,l;return e=new Te({props:{$$slots:{default:[Gt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){j(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,i){P(e,n,i),l=!0},p(n,i){const g={};i&2050&&(g.$$scope={dirty:i,ctx:n}),e.$set(g)},i(n){l||(w(e.$$.fragment,n),l=!0)},o(n){L(e.$$.fragment,n),l=!1},d(n){G(e,n)}}}function Gt(t){let e,l;return{c(){e=Y("Use lookup: "),l=Y(t[1])},l(n){e=Z(n,"Use lookup: "),l=Z(n,t[1])},m(n,i){C(n,e,i),C(n,l,i)},p(n,i){i&2&&pe(l,n[1])},d(n){n&&(v(e),v(l))}}}function Ft(t){let e,l,n,i,g,a,p,f,b,_,u,c,o,r,$,k,h,D,B,A,te,J,U,q,Q;function ue(s){t[5](s)}let ne={label:"Critical Issue",emptyOption:!0,choices:t[3]};t[2].criticalIssues[t[0]].criticalIssue!==void 0&&(ne.value=t[2].criticalIssues[t[0]].criticalIssue),_=new Ie({props:ne}),X.push(()=>ee(_,"value",ue));function W(s){t[6](s)}let le={label:"Stage",emptyOption:!0,choices:ot(["Existing","Design"])};t[2].criticalIssues[t[0]].stage!==void 0&&(le.value=t[2].criticalIssues[t[0]].stage),o=new Ie({props:le}),X.push(()=>ee(o,"value",W));function H(s){t[7](s)}let d={label:"Location Name"};t[2].criticalIssues[t[0]].locationName!==void 0&&(d.value=t[2].criticalIssues[t[0]].locationName),k=new rt({props:d}),X.push(()=>ee(k,"value",H));let m=t[1]&&t[1]!="Loading"&&t[1]!=t[2].criticalIssues[t[0]].locationName&&We(t);function O(s){t[8](s)}let z={label:"Resolved by Design"};t[2].criticalIssues[t[0]].resolved!==void 0&&(z.value=t[2].criticalIssues[t[0]].resolved),A=new ft({props:z}),X.push(()=>ee(A,"value",O));function F(s){t[9](s)}let se={label:"Commentary & Feedback"};return t[2].criticalIssues[t[0]].notes!==void 0&&(se.value=t[2].criticalIssues[t[0]].notes),U=new st({props:se}),X.push(()=>ee(U,"value",F)),{c(){e=T("div"),l=T("a"),n=Y("Google StreetView"),g=E(),a=T("a"),p=Y("Bing Streetside"),b=E(),j(_.$$.fragment),c=E(),j(o.$$.fragment),$=E(),j(k.$$.fragment),D=E(),m&&m.c(),B=E(),j(A.$$.fragment),J=E(),j(U.$$.fragment),this.h()},l(s){e=V(s,"DIV",{style:!0});var y=R(e);l=V(y,"A",{href:!0,target:!0});var re=R(l);n=Z(re,"Google StreetView"),re.forEach(v),g=N(y),a=V(y,"A",{href:!0,target:!0});var ae=R(a);p=Z(ae,"Bing Streetside"),ae.forEach(v),y.forEach(v),b=N(s),M(_.$$.fragment,s),c=N(s),M(o.$$.fragment,s),$=N(s),M(k.$$.fragment,s),D=N(s),m&&m.l(s),B=N(s),M(A.$$.fragment,s),J=N(s),M(U.$$.fragment,s),this.h()},h(){I(l,"href",i=ke(t[2].criticalIssues[t[0]].point)),I(l,"target","_blank"),I(a,"href",f=ye(t[2].criticalIssues[t[0]].point)),I(a,"target","_blank"),ie(e,"display","flex"),ie(e,"justify-content","space-evenly")},m(s,y){C(s,e,y),S(e,l),S(l,n),S(e,g),S(e,a),S(a,p),C(s,b,y),P(_,s,y),C(s,c,y),P(o,s,y),C(s,$,y),P(k,s,y),C(s,D,y),m&&m.m(s,y),C(s,B,y),P(A,s,y),C(s,J,y),P(U,s,y),Q=!0},p(s,[y]){(!Q||y&5&&i!==(i=ke(s[2].criticalIssues[s[0]].point)))&&I(l,"href",i),(!Q||y&5&&f!==(f=ye(s[2].criticalIssues[s[0]].point)))&&I(a,"href",f);const re={};!u&&y&5&&(u=!0,re.value=s[2].criticalIssues[s[0]].criticalIssue,x(()=>u=!1)),_.$set(re);const ae={};!r&&y&5&&(r=!0,ae.value=s[2].criticalIssues[s[0]].stage,x(()=>r=!1)),o.$set(ae);const he={};!h&&y&5&&(h=!0,he.value=s[2].criticalIssues[s[0]].locationName,x(()=>h=!1)),k.$set(he),s[1]&&s[1]!="Loading"&&s[1]!=s[2].criticalIssues[s[0]].locationName?m?(m.p(s,y),y&7&&w(m,1)):(m=We(s),m.c(),w(m,1),m.m(B.parentNode,B)):m&&(ce(),L(m,1,1,()=>{m=null}),_e());const $e={};!te&&y&5&&(te=!0,$e.value=s[2].criticalIssues[s[0]].resolved,x(()=>te=!1)),A.$set($e);const ve={};!q&&y&5&&(q=!0,ve.value=s[2].criticalIssues[s[0]].notes,x(()=>q=!1)),U.$set(ve)},i(s){Q||(w(_.$$.fragment,s),w(o.$$.fragment,s),w(k.$$.fragment,s),w(m),w(A.$$.fragment,s),w(U.$$.fragment,s),Q=!0)},o(s){L(_.$$.fragment,s),L(o.$$.fragment,s),L(k.$$.fragment,s),L(m),L(A.$$.fragment,s),L(U.$$.fragment,s),Q=!1},d(s){s&&(v(e),v(b),v(c),v($),v(D),v(B),v(J)),G(_,s),G(o,s),G(k,s),m&&m.d(s),G(A,s),G(U,s)}}}function Ot(t,e,l){let n;Be(t,K,r=>l(2,n=r));let{idx:i}=e,g=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],a="Loading";qe(async()=>{await p(n.criticalIssues[i].point)});async function p(r){let $=`https://nominatim.openstreetmap.org/reverse?lon=${r[0]}&lat=${r[1]}&format=json`;try{let h=await(await fetch($)).json();l(1,a=h.address.road??h.display_name)}catch(k){return console.log(`Location lookup failed: ${k}`),""}}function f(){Le(K,n.criticalIssues[i].locationName=a,n)}function b(r){t.$$.not_equal(n.criticalIssues[i].criticalIssue,r)&&(n.criticalIssues[i].criticalIssue=r,K.set(n))}function _(r){t.$$.not_equal(n.criticalIssues[i].stage,r)&&(n.criticalIssues[i].stage=r,K.set(n))}function u(r){t.$$.not_equal(n.criticalIssues[i].locationName,r)&&(n.criticalIssues[i].locationName=r,K.set(n))}function c(r){t.$$.not_equal(n.criticalIssues[i].resolved,r)&&(n.criticalIssues[i].resolved=r,K.set(n))}function o(r){t.$$.not_equal(n.criticalIssues[i].notes,r)&&(n.criticalIssues[i].notes=r,K.set(n))}return t.$$set=r=>{"idx"in r&&l(0,i=r.idx)},[i,a,n,g,f,b,_,u,c,o]}class Rt extends me{constructor(e){super(),de(this,e,Ot,Ft,ge,{idx:0})}}function He(t){let e,l;return e=new Te({props:{$$slots:{default:[Ut]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){j(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,i){P(e,n,i),l=!0},p(n,i){const g={};i&2050&&(g.$$scope={dirty:i,ctx:n}),e.$set(g)},i(n){l||(w(e.$$.fragment,n),l=!0)},o(n){L(e.$$.fragment,n),l=!1},d(n){G(e,n)}}}function Ut(t){let e,l;return{c(){e=Y("Use lookup: "),l=Y(t[1])},l(n){e=Z(n,"Use lookup: "),l=Z(n,t[1])},m(n,i){C(n,e,i),C(n,l,i)},p(n,i){i&2&&pe(l,n[1])},d(n){n&&(v(e),v(l))}}}function Wt(t){let e,l,n,i,g,a,p,f,b,_,u,c,o,r,$,k,h,D,B,A,te,J,U,q,Q;function ue(s){t[5](s)}let ne={label:"Policy Conflict",emptyOption:!0,choices:t[3]};t[2].policyConflictLog[t[0]].conflict!==void 0&&(ne.value=t[2].policyConflictLog[t[0]].conflict),_=new Ie({props:ne}),X.push(()=>ee(_,"value",ue));function W(s){t[6](s)}let le={label:"Stage",emptyOption:!0,choices:ot(["Existing","Design"])};t[2].policyConflictLog[t[0]].stage!==void 0&&(le.value=t[2].policyConflictLog[t[0]].stage),o=new Ie({props:le}),X.push(()=>ee(o,"value",W));function H(s){t[7](s)}let d={label:"Location Name"};t[2].policyConflictLog[t[0]].locationName!==void 0&&(d.value=t[2].policyConflictLog[t[0]].locationName),k=new rt({props:d}),X.push(()=>ee(k,"value",H));let m=t[1]&&t[1]!="Loading"&&t[1]!=t[2].policyConflictLog[t[0]].locationName&&He(t);function O(s){t[8](s)}let z={label:"Resolved by Design"};t[2].policyConflictLog[t[0]].resolved!==void 0&&(z.value=t[2].policyConflictLog[t[0]].resolved),A=new ft({props:z}),X.push(()=>ee(A,"value",O));function F(s){t[9](s)}let se={label:"Commentary & Feedback"};return t[2].policyConflictLog[t[0]].notes!==void 0&&(se.value=t[2].policyConflictLog[t[0]].notes),U=new st({props:se}),X.push(()=>ee(U,"value",F)),{c(){e=T("div"),l=T("a"),n=Y("Google StreetView"),g=E(),a=T("a"),p=Y("Bing Streetside"),b=E(),j(_.$$.fragment),c=E(),j(o.$$.fragment),$=E(),j(k.$$.fragment),D=E(),m&&m.c(),B=E(),j(A.$$.fragment),J=E(),j(U.$$.fragment),this.h()},l(s){e=V(s,"DIV",{style:!0});var y=R(e);l=V(y,"A",{href:!0,target:!0});var re=R(l);n=Z(re,"Google StreetView"),re.forEach(v),g=N(y),a=V(y,"A",{href:!0,target:!0});var ae=R(a);p=Z(ae,"Bing Streetside"),ae.forEach(v),y.forEach(v),b=N(s),M(_.$$.fragment,s),c=N(s),M(o.$$.fragment,s),$=N(s),M(k.$$.fragment,s),D=N(s),m&&m.l(s),B=N(s),M(A.$$.fragment,s),J=N(s),M(U.$$.fragment,s),this.h()},h(){I(l,"href",i=ke(t[2].policyConflictLog[t[0]].point)),I(l,"target","_blank"),I(a,"href",f=ye(t[2].policyConflictLog[t[0]].point)),I(a,"target","_blank"),ie(e,"display","flex"),ie(e,"justify-content","space-evenly")},m(s,y){C(s,e,y),S(e,l),S(l,n),S(e,g),S(e,a),S(a,p),C(s,b,y),P(_,s,y),C(s,c,y),P(o,s,y),C(s,$,y),P(k,s,y),C(s,D,y),m&&m.m(s,y),C(s,B,y),P(A,s,y),C(s,J,y),P(U,s,y),Q=!0},p(s,[y]){(!Q||y&5&&i!==(i=ke(s[2].policyConflictLog[s[0]].point)))&&I(l,"href",i),(!Q||y&5&&f!==(f=ye(s[2].policyConflictLog[s[0]].point)))&&I(a,"href",f);const re={};!u&&y&5&&(u=!0,re.value=s[2].policyConflictLog[s[0]].conflict,x(()=>u=!1)),_.$set(re);const ae={};!r&&y&5&&(r=!0,ae.value=s[2].policyConflictLog[s[0]].stage,x(()=>r=!1)),o.$set(ae);const he={};!h&&y&5&&(h=!0,he.value=s[2].policyConflictLog[s[0]].locationName,x(()=>h=!1)),k.$set(he),s[1]&&s[1]!="Loading"&&s[1]!=s[2].policyConflictLog[s[0]].locationName?m?(m.p(s,y),y&7&&w(m,1)):(m=He(s),m.c(),w(m,1),m.m(B.parentNode,B)):m&&(ce(),L(m,1,1,()=>{m=null}),_e());const $e={};!te&&y&5&&(te=!0,$e.value=s[2].policyConflictLog[s[0]].resolved,x(()=>te=!1)),A.$set($e);const ve={};!q&&y&5&&(q=!0,ve.value=s[2].policyConflictLog[s[0]].notes,x(()=>q=!1)),U.$set(ve)},i(s){Q||(w(_.$$.fragment,s),w(o.$$.fragment,s),w(k.$$.fragment,s),w(m),w(A.$$.fragment,s),w(U.$$.fragment,s),Q=!0)},o(s){L(_.$$.fragment,s),L(o.$$.fragment,s),L(k.$$.fragment,s),L(m),L(A.$$.fragment,s),L(U.$$.fragment,s),Q=!1},d(s){s&&(v(e),v(b),v(c),v($),v(D),v(B),v(J)),G(_,s),G(o,s),G(k,s),m&&m.d(s),G(A,s),G(U,s)}}}function Ht(t,e,l){let n;Be(t,K,r=>l(2,n=r));let{idx:i}=e,g=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]],a="Loading";qe(async()=>{await p(n.policyConflictLog[i].point)});async function p(r){let $=`https://nominatim.openstreetmap.org/reverse?lon=${r[0]}&lat=${r[1]}&format=json`;try{let h=await(await fetch($)).json();l(1,a=h.address.road??h.display_name)}catch(k){return console.log(`Location lookup failed: ${k}`),""}}function f(){Le(K,n.policyConflictLog[i].locationName=a,n)}function b(r){t.$$.not_equal(n.policyConflictLog[i].conflict,r)&&(n.policyConflictLog[i].conflict=r,K.set(n))}function _(r){t.$$.not_equal(n.policyConflictLog[i].stage,r)&&(n.policyConflictLog[i].stage=r,K.set(n))}function u(r){t.$$.not_equal(n.policyConflictLog[i].locationName,r)&&(n.policyConflictLog[i].locationName=r,K.set(n))}function c(r){t.$$.not_equal(n.policyConflictLog[i].resolved,r)&&(n.policyConflictLog[i].resolved=r,K.set(n))}function o(r){t.$$.not_equal(n.policyConflictLog[i].notes,r)&&(n.policyConflictLog[i].notes=r,K.set(n))}return t.$$set=r=>{"idx"in r&&l(0,i=r.idx)},[i,a,n,g,f,b,_,u,c,o]}class Kt extends me{constructor(e){super(),de(this,e,Ht,Wt,ge,{idx:0})}}const{window:zt}=ct;function Ke(t,e,l){const n=t.slice();return n[29]=e[l],n[30]=e,n[31]=l,n}function ze(t,e,l){const n=t.slice();return n[32]=e[l],n[33]=e,n[31]=l,n}function Je(t,e,l){const n=t.slice();return n[29]=e[l],n[31]=l,n}function Ye(t,e,l){const n=t.slice();return n[32]=e[l],n[31]=l,n}function Jt(t){let e,l,n,i,g,a,p,f;e=new wt({props:{$$slots:{default:[Zt]},$$scope:{ctx:t}}}),e.$on("click",t[20]),n=new $t({props:{$$slots:{default:[Qt]},$$scope:{ctx:t}}}),n.$on("click",t[8]);const b=[xt,Xt],_=[];function u(c,o){return c[0].kind=="critical"?0:1}return g=u(t),a=_[g]=b[g](t),{c(){j(e.$$.fragment),l=E(),j(n.$$.fragment),i=E(),a.c(),p=Ce()},l(c){M(e.$$.fragment,c),l=N(c),M(n.$$.fragment,c),i=N(c),a.l(c),p=Ce()},m(c,o){P(e,c,o),C(c,l,o),P(n,c,o),C(c,i,o),_[g].m(c,o),C(c,p,o),f=!0},p(c,o){const r={};o[1]&32&&(r.$$scope={dirty:o,ctx:c}),e.$set(r);const $={};o[1]&32&&($.$$scope={dirty:o,ctx:c}),n.$set($);let k=g;g=u(c),g===k?_[g].p(c,o):(ce(),L(_[k],1,1,()=>{_[k]=null}),_e(),a=_[g],a?a.p(c,o):(a=_[g]=b[g](c),a.c()),w(a,1),a.m(p.parentNode,p))},i(c){f||(w(e.$$.fragment,c),w(n.$$.fragment,c),w(a),f=!0)},o(c){L(e.$$.fragment,c),L(n.$$.fragment,c),L(a),f=!1},d(c){c&&(v(l),v(i),v(p)),G(e,c),G(n,c),_[g].d(c)}}}function Yt(t){let e,l,n,i,g,a,p,f,b,_,u,c="Click the map to add a pin, or select a pin to fill out data",o,r,$="Critical Issues",k,h,D,B,A="Policy Conflicts",te,J,U;e=new Te({props:{$$slots:{default:[en]},$$scope:{ctx:t}}}),e.$on("click",t[11]),n=new bt({}),g=new kt({});let q=t[3]&&Ze(t);function Q(d){t[13](d)}let ue={legend:"Create new pins",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};t[4]!==void 0&&(ue.value=t[4]),f=new _t({props:ue}),X.push(()=>ee(f,"value",Q));let ne=fe(t[2].criticalIssues),W=[];for(let d=0;d<ne.length;d+=1)W[d]=Qe(Ye(t,ne,d));let le=fe(t[2].policyConflictLog),H=[];for(let d=0;d<le.length;d+=1)H[d]=Xe(Je(t,le,d));return{c(){j(e.$$.fragment),l=E(),j(n.$$.fragment),i=E(),j(g.$$.fragment),a=E(),q&&q.c(),p=E(),j(f.$$.fragment),_=E(),u=T("p"),u.textContent=c,o=E(),r=T("h3"),r.textContent=$,k=E(),h=T("ol");for(let d=0;d<W.length;d+=1)W[d].c();D=E(),B=T("h3"),B.textContent=A,te=E(),J=T("ol");for(let d=0;d<H.length;d+=1)H[d].c()},l(d){M(e.$$.fragment,d),l=N(d),M(n.$$.fragment,d),i=N(d),M(g.$$.fragment,d),a=N(d),q&&q.l(d),p=N(d),M(f.$$.fragment,d),_=N(d),u=V(d,"P",{"data-svelte-h":!0}),Ee(u)!=="svelte-sv95ee"&&(u.textContent=c),o=N(d),r=V(d,"H3",{"data-svelte-h":!0}),Ee(r)!=="svelte-1qhh5xr"&&(r.textContent=$),k=N(d),h=V(d,"OL",{});var m=R(h);for(let z=0;z<W.length;z+=1)W[z].l(m);m.forEach(v),D=N(d),B=V(d,"H3",{"data-svelte-h":!0}),Ee(B)!=="svelte-eyxzjx"&&(B.textContent=A),te=N(d),J=V(d,"OL",{});var O=R(J);for(let z=0;z<H.length;z+=1)H[z].l(O);O.forEach(v)},m(d,m){P(e,d,m),C(d,l,m),P(n,d,m),C(d,i,m),P(g,d,m),C(d,a,m),q&&q.m(d,m),C(d,p,m),P(f,d,m),C(d,_,m),C(d,u,m),C(d,o,m),C(d,r,m),C(d,k,m),C(d,h,m);for(let O=0;O<W.length;O+=1)W[O]&&W[O].m(h,null);C(d,D,m),C(d,B,m),C(d,te,m),C(d,J,m);for(let O=0;O<H.length;O+=1)H[O]&&H[O].m(J,null);U=!0},p(d,m){const O={};m[1]&32&&(O.$$scope={dirty:m,ctx:d}),e.$set(O),d[3]?q?(q.p(d,m),m[0]&8&&w(q,1)):(q=Ze(d),q.c(),w(q,1),q.m(p.parentNode,p)):q&&(ce(),L(q,1,1,()=>{q=null}),_e());const z={};if(!b&&m[0]&16&&(b=!0,z.value=d[4],x(()=>b=!1)),f.$set(z),m[0]&134){ne=fe(d[2].criticalIssues);let F;for(F=0;F<ne.length;F+=1){const se=Ye(d,ne,F);W[F]?W[F].p(se,m):(W[F]=Qe(se),W[F].c(),W[F].m(h,null))}for(;F<W.length;F+=1)W[F].d(1);W.length=ne.length}if(m[0]&134){le=fe(d[2].policyConflictLog);let F;for(F=0;F<le.length;F+=1){const se=Je(d,le,F);H[F]?H[F].p(se,m):(H[F]=Xe(se),H[F].c(),H[F].m(J,null))}for(;F<H.length;F+=1)H[F].d(1);H.length=le.length}},i(d){U||(w(e.$$.fragment,d),w(n.$$.fragment,d),w(g.$$.fragment,d),w(q),w(f.$$.fragment,d),U=!0)},o(d){L(e.$$.fragment,d),L(n.$$.fragment,d),L(g.$$.fragment,d),L(q),L(f.$$.fragment,d),U=!1},d(d){d&&(v(l),v(i),v(a),v(p),v(_),v(u),v(o),v(r),v(k),v(h),v(D),v(B),v(te),v(J)),G(e,d),G(n,d),G(g,d),q&&q.d(d),G(f,d),be(W,d),be(H,d)}}}function Zt(t){let e;return{c(){e=Y("Save")},l(l){e=Z(l,"Save")},m(l,n){C(l,e,n)},d(l){l&&v(e)}}}function Qt(t){let e;return{c(){e=Y("Delete")},l(l){e=Z(l,"Delete")},m(l,n){C(l,e,n)},d(l){l&&v(e)}}}function Xt(t){let e,l;return e=new Kt({props:{idx:t[0].idx}}),{c(){j(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,i){P(e,n,i),l=!0},p(n,i){const g={};i[0]&1&&(g.idx=n[0].idx),e.$set(g)},i(n){l||(w(e.$$.fragment,n),l=!0)},o(n){L(e.$$.fragment,n),l=!1},d(n){G(e,n)}}}function xt(t){let e,l;return e=new Rt({props:{idx:t[0].idx}}),{c(){j(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,i){P(e,n,i),l=!0},p(n,i){const g={};i[0]&1&&(g.idx=n[0].idx),e.$set(g)},i(n){l||(w(e.$$.fragment,n),l=!0)},o(n){L(e.$$.fragment,n),l=!1},d(n){G(e,n)}}}function en(t){let e;return{c(){e=Y("Zoom to fit")},l(l){e=Z(l,"Zoom to fit")},m(l,n){C(l,e,n)},d(l){l&&v(e)}}}function Ze(t){let e,l,n;function i(a){t[12](a)}let g={map:t[3]};return t[5]!==void 0&&(g.enabled=t[5]),e=new Pt({props:g}),X.push(()=>ee(e,"enabled",i)),{c(){j(e.$$.fragment)},l(a){M(e.$$.fragment,a)},m(a,p){P(e,a,p),n=!0},p(a,p){const f={};p[0]&8&&(f.map=a[3]),!l&&p[0]&32&&(l=!0,f.enabled=a[5],x(()=>l=!1)),e.$set(f)},i(a){n||(w(e.$$.fragment,a),n=!0)},o(a){L(e.$$.fragment,a),n=!1},d(a){G(e,a)}}}function Qe(t){let e,l,n=tt(t[32])+"",i,g,a,p;function f(){return t[14](t[31])}function b(){return t[15](t[31])}return{c(){e=T("li"),l=T("a"),i=Y(n),g=E(),this.h()},l(_){e=V(_,"LI",{});var u=R(e);l=V(u,"A",{href:!0});var c=R(l);i=Z(c,n),c.forEach(v),g=N(u),u.forEach(v),this.h()},h(){I(l,"href","#")},m(_,u){C(_,e,u),S(e,l),S(l,i),S(e,g),a||(p=[oe(l,"click",f),oe(l,"mouseenter",b),oe(l,"mouseleave",t[16])],a=!0)},p(_,u){t=_,u[0]&4&&n!==(n=tt(t[32])+"")&&pe(i,n)},d(_){_&&v(e),a=!1,Se(p)}}}function Xe(t){let e,l,n=nt(t[29])+"",i,g,a,p;function f(){return t[17](t[31])}function b(){return t[18](t[31])}return{c(){e=T("li"),l=T("a"),i=Y(n),g=E(),this.h()},l(_){e=V(_,"LI",{});var u=R(e);l=V(u,"A",{href:!0});var c=R(l);i=Z(c,n),c.forEach(v),g=N(u),u.forEach(v),this.h()},h(){I(l,"href","#")},m(_,u){C(_,e,u),S(e,l),S(l,i),S(e,g),a||(p=[oe(l,"click",f),oe(l,"mouseenter",b),oe(l,"mouseleave",t[19])],a=!0)},p(_,u){t=_,u[0]&4&&n!==(n=nt(t[29])+"")&&pe(i,n)},d(_){_&&v(e),a=!1,Se(p)}}}function tn(t){let e,l,n,i=t[32].criticalIssue+"",g;return{c(){e=Ne("svg"),l=Ne("polygon"),n=Ne("text"),g=Y(i),this.h()},l(a){e=De(a,"svg",{width:!0,height:!0,xmlns:!0});var p=R(e);l=De(p,"polygon",{points:!0,fill:!0,class:!0}),R(l).forEach(v),n=De(p,"text",{x:!0,y:!0});var f=R(n);g=Z(f,i),f.forEach(v),p.forEach(v),this.h()},h(){I(l,"points","20,0 0,40 40,40"),I(l,"fill",dt.critical.background),I(l,"class","svelte-996go8"),I(n,"x","13"),I(n,"y","30"),ie(n,"fill","white"),I(e,"width","40"),I(e,"height","40"),I(e,"xmlns","http://www.w3.org/2000/svg")},m(a,p){C(a,e,p),S(e,l),S(e,n),S(n,g)},p(a,p){p[0]&4&&i!==(i=a[32].criticalIssue+"")&&pe(g,i)},d(a){a&&v(e)}}}function xe(t){let e,l,n;function i(f){t[21](f,t[32])}function g(){return t[22](t[31])}function a(){return t[23](t[31])}let p={draggable:!0,$$slots:{default:[tn]},$$scope:{ctx:t}};return t[32].point!==void 0&&(p.lngLat=t[32].point),e=new at({props:p}),X.push(()=>ee(e,"lngLat",i)),e.$on("click",g),e.$on("dragend",a),{c(){j(e.$$.fragment)},l(f){M(e.$$.fragment,f)},m(f,b){P(e,f,b),n=!0},p(f,b){t=f;const _={};b[0]&4|b[1]&32&&(_.$$scope={dirty:b,ctx:t}),!l&&b[0]&4&&(l=!0,_.lngLat=t[32].point,x(()=>l=!1)),e.$set(_)},i(f){n||(w(e.$$.fragment,f),n=!0)},o(f){L(e.$$.fragment,f),n=!1},d(f){G(e,f)}}}function nn(t){let e,l=t[29].conflict+"",n;return{c(){e=T("span"),n=Y(l),this.h()},l(i){e=V(i,"SPAN",{class:!0});var g=R(e);n=Z(g,l),g.forEach(v),this.h()},h(){I(e,"class","dot svelte-996go8"),ie(e,"background",ht)},m(i,g){C(i,e,g),S(e,n)},p(i,g){g[0]&4&&l!==(l=i[29].conflict+"")&&pe(n,l)},d(i){i&&v(e)}}}function et(t){let e,l,n;function i(f){t[24](f,t[29])}function g(){return t[25](t[31])}function a(){return t[26](t[31])}let p={draggable:!0,$$slots:{default:[nn]},$$scope:{ctx:t}};return t[29].point!==void 0&&(p.lngLat=t[29].point),e=new at({props:p}),X.push(()=>ee(e,"lngLat",i)),e.$on("click",g),e.$on("dragend",a),{c(){j(e.$$.fragment)},l(f){M(e.$$.fragment,f)},m(f,b){P(e,f,b),n=!0},p(f,b){t=f;const _={};b[0]&4|b[1]&32&&(_.$$scope={dirty:b,ctx:t}),!l&&b[0]&4&&(l=!0,_.lngLat=t[29].point,x(()=>l=!1)),e.$set(_)},i(f){n||(w(e.$$.fragment,f),n=!0)},o(f){L(e.$$.fragment,f),n=!1},d(f){G(e,f)}}}function ln(t){let e,l;return e=new St({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){j(e.$$.fragment)},l(n){M(e.$$.fragment,n)},m(n,i){P(e,n,i),l=!0},p:mt,i(n){l||(w(e.$$.fragment,n),l=!0)},o(n){L(e.$$.fragment,n),l=!1},d(n){G(e,n)}}}function on(t){let e,l,n,i,g,a,p=fe(t[2].criticalIssues),f=[];for(let o=0;o<p.length;o+=1)f[o]=xe(ze(t,p,o));const b=o=>L(f[o],1,1,()=>{f[o]=null});let _=fe(t[2].policyConflictLog),u=[];for(let o=0;o<_.length;o+=1)u[o]=et(Ke(t,_,o));const c=o=>L(u[o],1,1,()=>{u[o]=null});return n=new It({props:{data:t[6],$$slots:{default:[ln]},$$scope:{ctx:t}}}),g=new yt({props:{map:t[3]}}),{c(){for(let o=0;o<f.length;o+=1)f[o].c();e=E();for(let o=0;o<u.length;o+=1)u[o].c();l=E(),j(n.$$.fragment),i=E(),j(g.$$.fragment)},l(o){for(let r=0;r<f.length;r+=1)f[r].l(o);e=N(o);for(let r=0;r<u.length;r+=1)u[r].l(o);l=N(o),M(n.$$.fragment,o),i=N(o),M(g.$$.fragment,o)},m(o,r){for(let $=0;$<f.length;$+=1)f[$]&&f[$].m(o,r);C(o,e,r);for(let $=0;$<u.length;$+=1)u[$]&&u[$].m(o,r);C(o,l,r),P(n,o,r),C(o,i,r),P(g,o,r),a=!0},p(o,r){if(r[0]&132){p=fe(o[2].criticalIssues);let h;for(h=0;h<p.length;h+=1){const D=ze(o,p,h);f[h]?(f[h].p(D,r),w(f[h],1)):(f[h]=xe(D),f[h].c(),w(f[h],1),f[h].m(e.parentNode,e))}for(ce(),h=p.length;h<f.length;h+=1)b(h);_e()}if(r[0]&132){_=fe(o[2].policyConflictLog);let h;for(h=0;h<_.length;h+=1){const D=Ke(o,_,h);u[h]?(u[h].p(D,r),w(u[h],1)):(u[h]=et(D),u[h].c(),w(u[h],1),u[h].m(l.parentNode,l))}for(ce(),h=_.length;h<u.length;h+=1)c(h);_e()}const $={};r[0]&64&&($.data=o[6]),r[1]&32&&($.$$scope={dirty:r,ctx:o}),n.$set($);const k={};r[0]&8&&(k.map=o[3]),g.$set(k)},i(o){if(!a){for(let r=0;r<p.length;r+=1)w(f[r]);for(let r=0;r<_.length;r+=1)w(u[r]);w(n.$$.fragment,o),w(g.$$.fragment,o),a=!0}},o(o){f=f.filter(Boolean);for(let r=0;r<f.length;r+=1)L(f[r]);u=u.filter(Boolean);for(let r=0;r<u.length;r+=1)L(u[r]);L(n.$$.fragment,o),L(g.$$.fragment,o),a=!1},d(o){o&&(v(e),v(l),v(i)),be(f,o),be(u,o),G(n,o),G(g,o)}}}function sn(t){let e,l,n,i,g,a,p,f,b,_,u;const c=[Yt,Jt],o=[];function r(h,D){return h[0]==null?0:1}n=r(t),i=o[n]=c[n](t);function $(h){t[27](h)}let k={$$slots:{default:[on]},$$scope:{ctx:t}};return t[3]!==void 0&&(k.map=t[3]),p=new Lt({props:k}),X.push(()=>ee(p,"map",$)),{c(){e=T("div"),l=T("div"),i.c(),g=E(),a=T("div"),j(p.$$.fragment),this.h()},l(h){e=V(h,"DIV",{style:!0});var D=R(e);l=V(D,"DIV",{style:!0});var B=R(l);i.l(B),B.forEach(v),g=N(D),a=V(D,"DIV",{style:!0});var A=R(a);M(p.$$.fragment,A),A.forEach(v),D.forEach(v),this.h()},h(){ie(l,"width","30%"),ie(l,"overflow-y","scroll"),ie(l,"padding","10px"),ie(a,"position","relative"),ie(a,"width","70%"),ie(e,"display","flex"),ie(e,"height","600px")},m(h,D){C(h,e,D),S(e,l),o[n].m(l,null),S(e,g),S(e,a),P(p,a,null),b=!0,_||(u=oe(zt,"keydown",t[10]),_=!0)},p(h,D){let B=n;n=r(h),n===B?o[n].p(h,D):(ce(),L(o[B],1,1,()=>{o[B]=null}),_e(),i=o[n],i?i.p(h,D):(i=o[n]=c[n](h),i.c()),w(i,1),i.m(l,null));const A={};D[0]&76|D[1]&32&&(A.$$scope={dirty:D,ctx:h}),!f&&D[0]&8&&(f=!0,A.map=h[3],x(()=>f=!1)),p.$set(A)},i(h){b||(w(i),w(p.$$.fragment,h),b=!0)},o(h){L(i),L(p.$$.fragment,h),b=!1},d(h){h&&v(e),o[n].d(),G(p),_=!1,u()}}}function rn(t,e,l){let n={type:"FeatureCollection",features:[]},i=e??l;if(i!=null){let g=i.kind=="critical"?t.criticalIssues:t.policyConflictLog;n.features.push(Ae(g[i.idx].point))}return n}function Ae(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}}function tt(t){return`${t.criticalIssue||"Unknown critical"}: ${t.locationName||"???"}`}function nt(t){return`${t.conflict||"Unknown conflict"}: ${t.locationName||"???"}`}function an(t,e,l){let n,i;Be(t,K,m=>l(2,i=m));let g,a="critical",p=null,f=null,b=!1;function _(m){l(0,p=m),l(1,f=null)}function u(m){if(!b){if(p!=null){l(0,p=null);return}a=="critical"?(Le(K,i.criticalIssues=[...i.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:m.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,p={kind:"critical",idx:i.criticalIssues.length-1})):(Le(K,i.policyConflictLog=[...i.policyConflictLog,{id:"TODO",conflict:"",stage:"",point:m.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,p={kind:"conflict",idx:i.policyConflictLog.length-1})),l(1,f=null)}}qe(()=>{g.on("click",u),o()}),it(()=>{g.off("click",u)});function c(){window.confirm("Delete this entry?")&&(p.kind=="critical"?(i.criticalIssues.splice(p.idx,1),K.set(i)):(i.policyConflictLog.splice(p.idx,1),K.set(i)),l(0,p=null))}function o(m){let O={type:"FeatureCollection",features:[...i.criticalIssues.map(z=>Ae(z.point)),...i.policyConflictLog.map(z=>Ae(z.point))]};O.features.length>0&&g.fitBounds(vt(O),{padding:20,animate:!0})}function r(m){p!=null&&m.key=="Escape"&&(m.stopPropagation(),l(0,p=null))}const $=()=>o();function k(m){b=m,l(5,b)}function h(m){a=m,l(4,a)}const D=m=>_({kind:"critical",idx:m}),B=m=>l(1,f={kind:"critical",idx:m}),A=()=>l(1,f=null),te=m=>_({kind:"conflict",idx:m}),J=m=>l(1,f={kind:"conflict",idx:m}),U=()=>l(1,f=null),q=()=>l(0,p=null);function Q(m,O){t.$$.not_equal(O.point,m)&&(O.point=m,K.set(i))}const ue=m=>_({kind:"critical",idx:m}),ne=m=>_({kind:"critical",idx:m});function W(m,O){t.$$.not_equal(O.point,m)&&(O.point=m,K.set(i))}const le=m=>_({kind:"conflict",idx:m}),H=m=>_({kind:"conflict",idx:m});function d(m){g=m,l(3,g)}return t.$$.update=()=>{t.$$.dirty[0]&7&&l(6,n=rn(i,p,f))},[p,f,i,g,a,b,n,_,c,o,r,$,k,h,D,B,A,te,J,U,q,Q,ue,ne,W,le,H,d]}class Ln extends me{constructor(e){super(),de(this,e,an,sn,ge,{},null,[-1,-1])}}export{Ln as component};
