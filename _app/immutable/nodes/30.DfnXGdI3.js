import{s as je,p as Z,r as x,l as Vt,u as Xt,m as Wt,o as Zt,I as we,k as Be,V as Qt,w as Te,a as O,g as N,i as E,f as $,z as Pe,n as Oe,e as Q,t as J,c as Y,b as te,d as K,A as Ne,q as X,h as oe,j as ce,C as Yt,y as fe,x as rt}from"../chunks/scheduler.BJRqm_YT.js";import{S as Ae,i as Me,e as ee,c as S,a as I,m as F,t as y,b as k,d as T,g as le,f as ae}from"../chunks/index.18SuDt2z.js";import{e as ue}from"../chunks/each.DzPajqWo.js";import{B as xt}from"../chunks/ButtonGroup.GoD7OmK5.js";import{S as me}from"../chunks/SecondaryButton.2stnaXwc.js";import{T as Xe}from"../chunks/TextInput.BDjywaHi.js";import{W as Et}from"../chunks/WarningButton.Dm1EdBVd.js";import{s as V}from"../chunks/data.BPwItbCw.js";import{L as en,g as tn,M as nn,G as ot,h as it,b as rn}from"../chunks/MapLibreMap.Ck6raeBt.js";import{e as Ct}from"../chunks/index.d-adz-yj.js";import{c as Se}from"../chunks/colors.CYEpEtTL.js";import{a as on,M as ln,c as an,d as Ie,R as Lt,B as sn,G as un,S as fn}from"../chunks/GeoreferenceLayer.BjR3prr7.js";import{C as mn}from"../chunks/CircleLayer.CsINg6ln.js";import{L as He,P as Pt}from"../chunks/Popup.JzSHupLb.js";import{C as cn}from"../chunks/CollapsibleCard.Cs5L5FHJ.js";import{D as gn}from"../chunks/DefaultButton.DUqytxqy.js";import{T as At}from"../chunks/TextArea.CDFsaoN6.js";import{p as Mt}from"../chunks/index.CLbx_zmS.js";import{S as pn}from"../chunks/Select.BZaUknG-.js";function dn(t){let e;const n=t[16].default,r=Vt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Xt(r,n,o,o[24],e?Zt(n,o[24],l,null):Wt(o[24]),null)},i(o){e||(y(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function _n(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[dn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new en({props:l}),Z.push(()=>ee(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){S(e.$$.fragment)},l(i){I(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],x(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){T(e,i)}}}function hn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=tn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:c=void 0}=e,{layout:p=void 0}=e,{filter:u=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:A=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:U=void 0}=e,{manageHoverState:g=!1}=e,{hovered:_=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:q=!0}=e;function b(j){_=j,n(0,_)}function f(j){we.call(this,t,j)}function P(j){we.call(this,t,j)}function B(j){we.call(this,t,j)}function H(j){we.call(this,t,j)}function M(j){we.call(this,t,j)}function he(j){we.call(this,t,j)}return t.$$set=j=>{"id"in j&&n(1,l=j.id),"source"in j&&n(2,i=j.source),"sourceLayer"in j&&n(3,a=j.sourceLayer),"beforeId"in j&&n(4,s=j.beforeId),"beforeLayerType"in j&&n(5,m=j.beforeLayerType),"paint"in j&&n(6,c=j.paint),"layout"in j&&n(7,p=j.layout),"filter"in j&&n(8,u=j.filter),"applyToClusters"in j&&n(9,C=j.applyToClusters),"minzoom"in j&&n(10,A=j.minzoom),"maxzoom"in j&&n(11,L=j.maxzoom),"hoverCursor"in j&&n(12,U=j.hoverCursor),"manageHoverState"in j&&n(13,g=j.manageHoverState),"hovered"in j&&n(0,_=j.hovered),"eventsIfTopMost"in j&&n(14,v=j.eventsIfTopMost),"interactive"in j&&n(15,q=j.interactive),"$$scope"in j&&n(24,o=j.$$scope)},[_,l,i,a,s,m,c,p,u,C,A,L,U,g,v,q,r,b,f,P,B,H,M,he,o]}class $n extends Ae{constructor(e){super(),Me(this,e,hn,_n,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var bn=Object.defineProperty,D=(t,e)=>bn(t,"name",{value:e,configurable:!0}),yn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ee(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Je(e),o=Je(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ee(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ee(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ct(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ee(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};D(yn,"GeojsonEquality");function Ee(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}D(Ee,"sameLength");function Je(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}D(Je,"explode");var ne=63710088e-1,St={centimeters:ne*100,centimetres:ne*100,degrees:360/(2*Math.PI),feet:ne*3.28084,inches:ne*39.37,kilometers:ne/1e3,kilometres:ne/1e3,meters:ne,metres:ne,miles:ne/1609.344,millimeters:ne*1e3,millimetres:ne*1e3,nauticalmiles:ne/1852,radians:1,yards:ne*1.0936},lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ge(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}D(ge,"feature");function wn(t,e,n={}){switch(t){case"Point":return Ge(e).geometry;case"LineString":return Ze(e).geometry;case"Polygon":return We(e).geometry;case"MultiPoint":return Ft(e).geometry;case"MultiLineString":return It(e).geometry;case"MultiPolygon":return Tt(e).geometry;default:throw new Error(t+" is invalid")}}D(wn,"geometry");function Ge(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ve(t[0])||!ve(t[1]))throw new Error("coordinates must contain numbers");return ge({type:"Point",coordinates:t},e,n)}D(Ge,"point");function vn(t,e,n={}){return ze(t.map(r=>Ge(r,e)),n)}D(vn,"points");function We(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ge({type:"Polygon",coordinates:t},e,n)}D(We,"polygon");function kn(t,e,n={}){return ze(t.map(r=>We(r,e)),n)}D(kn,"polygons");function Ze(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ge({type:"LineString",coordinates:t},e,n)}D(Ze,"lineString");function jn(t,e,n={}){return ze(t.map(r=>Ze(r,e)),n)}D(jn,"lineStrings");function ze(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}D(ze,"featureCollection");function It(t,e,n={}){return ge({type:"MultiLineString",coordinates:t},e,n)}D(It,"multiLineString");function Ft(t,e,n={}){return ge({type:"MultiPoint",coordinates:t},e,n)}D(Ft,"multiPoint");function Tt(t,e,n={}){return ge({type:"MultiPolygon",coordinates:t},e,n)}D(Tt,"multiPolygon");function En(t,e,n={}){return ge({type:"GeometryCollection",geometries:t},e,n)}D(En,"geometryCollection");function Cn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}D(Cn,"round");function qt(t,e="kilometers"){const n=St[e];if(!n)throw new Error(e+" units is invalid");return t*n}D(qt,"radiansToLength");function De(t,e="kilometers"){const n=St[e];if(!n)throw new Error(e+" units is invalid");return t/n}D(De,"lengthToRadians");function Ln(t,e){return qe(De(t,e))}D(Ln,"lengthToDegrees");function Pn(t){let e=t%360;return e<0&&(e+=360),e}D(Pn,"bearingToAzimuth");function qe(t){return t%(2*Math.PI)*180/Math.PI}D(qe,"radiansToDegrees");function Fe(t){return t%360*Math.PI/180}D(Fe,"degreesToRadians");function An(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return qt(De(t,e),n)}D(An,"convertLength");function Mn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=lt[e];if(!r)throw new Error("invalid original units");const o=lt[n];if(!o)throw new Error("invalid final units");return t/r*o}D(Mn,"convertArea");function ve(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}D(ve,"isNumber");function Sn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}D(Sn,"isObject");function In(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ve(e))throw new Error("bbox must only contain numbers")})}D(In,"validateBBox");function Fn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}D(Fn,"validateId");var Tn=Object.defineProperty,pe=(t,e)=>Tn(t,"name",{value:e,configurable:!0});function Bt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}pe(Bt,"getCoord");function qn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}pe(qn,"getCoords");function Ot(t){if(t.length>1&&ve(t[0])&&ve(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ot(t[0]);throw new Error("coordinates must only contain numbers")}pe(Ot,"containsNumber");function Bn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}pe(Bn,"geojsonType");function On(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}pe(On,"featureOf");function Nn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}pe(Nn,"collectionOf");function Gn(t){return t.type==="Feature"?t.geometry:t}pe(Gn,"getGeom");function zn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}pe(zn,"getType");var Dn=Object.defineProperty,Rn=(t,e)=>Dn(t,"name",{value:e,configurable:!0});function Nt(t,e,n,r={}){const o=Bt(t),l=Fe(o[0]),i=Fe(o[1]),a=Fe(n),s=De(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),p=qe(c),u=qe(m);return Ge([p,u],r.properties)}Rn(Nt,"destination");var at=Nt,Un=Object.defineProperty,R=(t,e)=>Un(t,"name",{value:e,configurable:!0}),Hn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ce(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ke(e),o=Ke(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ce(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ce(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ct(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ce(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};R(Hn,"GeojsonEquality");function Ce(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}R(Ce,"sameLength");function Ke(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}R(Ke,"explode");var re=63710088e-1,Gt={centimeters:re*100,centimetres:re*100,degrees:360/(2*Math.PI),feet:re*3.28084,inches:re*39.37,kilometers:re/1e3,kilometres:re/1e3,meters:re,metres:re,miles:re/1609.344,millimeters:re*1e3,millimetres:re*1e3,nauticalmiles:re/1852,radians:1,yards:re*1.0936},st={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function de(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}R(de,"feature");function Jn(t,e,n={}){switch(t){case"Point":return Qe(e).geometry;case"LineString":return xe(e).geometry;case"Polygon":return Ye(e).geometry;case"MultiPoint":return Dt(e).geometry;case"MultiLineString":return zt(e).geometry;case"MultiPolygon":return Rt(e).geometry;default:throw new Error(t+" is invalid")}}R(Jn,"geometry");function Qe(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ke(t[0])||!ke(t[1]))throw new Error("coordinates must contain numbers");return de({type:"Point",coordinates:t},e,n)}R(Qe,"point");function Kn(t,e,n={}){return Re(t.map(r=>Qe(r,e)),n)}R(Kn,"points");function Ye(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return de({type:"Polygon",coordinates:t},e,n)}R(Ye,"polygon");function Vn(t,e,n={}){return Re(t.map(r=>Ye(r,e)),n)}R(Vn,"polygons");function xe(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return de({type:"LineString",coordinates:t},e,n)}R(xe,"lineString");function Xn(t,e,n={}){return Re(t.map(r=>xe(r,e)),n)}R(Xn,"lineStrings");function Re(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}R(Re,"featureCollection");function zt(t,e,n={}){return de({type:"MultiLineString",coordinates:t},e,n)}R(zt,"multiLineString");function Dt(t,e,n={}){return de({type:"MultiPoint",coordinates:t},e,n)}R(Dt,"multiPoint");function Rt(t,e,n={}){return de({type:"MultiPolygon",coordinates:t},e,n)}R(Rt,"multiPolygon");function Wn(t,e,n={}){return de({type:"GeometryCollection",geometries:t},e,n)}R(Wn,"geometryCollection");function Zn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}R(Zn,"round");function Ut(t,e="kilometers"){const n=Gt[e];if(!n)throw new Error(e+" units is invalid");return t*n}R(Ut,"radiansToLength");function et(t,e="kilometers"){const n=Gt[e];if(!n)throw new Error(e+" units is invalid");return t/n}R(et,"lengthToRadians");function Qn(t,e){return tt(et(t,e))}R(Qn,"lengthToDegrees");function Yn(t){let e=t%360;return e<0&&(e+=360),e}R(Yn,"bearingToAzimuth");function tt(t){return t%(2*Math.PI)*180/Math.PI}R(tt,"radiansToDegrees");function Le(t){return t%360*Math.PI/180}R(Le,"degreesToRadians");function xn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Ut(et(t,e),n)}R(xn,"convertLength");function er(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=st[e];if(!r)throw new Error("invalid original units");const o=st[n];if(!o)throw new Error("invalid final units");return t/r*o}R(er,"convertArea");function ke(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}R(ke,"isNumber");function tr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}R(tr,"isObject");function nr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ke(e))throw new Error("bbox must only contain numbers")})}R(nr,"validateBBox");function rr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}R(rr,"validateId");var or=Object.defineProperty,_e=(t,e)=>or(t,"name",{value:e,configurable:!0});function Ve(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}_e(Ve,"getCoord");function ir(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}_e(ir,"getCoords");function Ht(t){if(t.length>1&&ke(t[0])&&ke(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ht(t[0]);throw new Error("coordinates must only contain numbers")}_e(Ht,"containsNumber");function lr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}_e(lr,"geojsonType");function ar(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}_e(ar,"featureOf");function sr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}_e(sr,"collectionOf");function ur(t){return t.type==="Feature"?t.geometry:t}_e(ur,"getGeom");function fr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}_e(fr,"getType");var mr=Object.defineProperty,Jt=(t,e)=>mr(t,"name",{value:e,configurable:!0});function nt(t,e,n={}){if(n.final===!0)return Kt(t,e);const r=Ve(t),o=Ve(e),l=Le(r[0]),i=Le(o[0]),a=Le(r[1]),s=Le(o[1]),m=Math.sin(i-l)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return tt(Math.atan2(m,c))}Jt(nt,"bearing");function Kt(t,e){let n=nt(e,t);return n=(n+180)%360,n}Jt(Kt,"calculateFinalBearing");var cr=nt;function ut(t,e,n){const r=t.slice();return r[33]=e[n],r[34]=e,r[35]=n,r}function ft(t,e,n){const r=t.slice();return r[36]=e[n],r[37]=e,r[35]=n,r}function gr(t){let e,n=Er(t[35])+"",r;return{c(){e=Q("span"),r=J(n),this.h()},l(o){e=Y(o,"SPAN",{class:!0});var l=te(e);r=K(l,n),l.forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(o,l){E(o,e,l),oe(e,r)},p:Oe,d(o){o&&$(e)}}}function mt(t){let e,n,r;function o(s){t[16](s,t[36])}function l(){return t[17](t[35])}function i(){return t[18](t[35])}let a={draggable:!0,$$slots:{default:[gr]},$$scope:{ctx:t}};return t[36].point!==void 0&&(a.lngLat=t[36].point),e=new Ie({props:a}),Z.push(()=>ee(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){S(e.$$.fragment)},l(s){I(e.$$.fragment,s)},m(s,m){F(e,s,m),r=!0},p(s,m){t=s;const c={};m[1]&128&&(c.$$scope={dirty:m,ctx:t}),!n&&m[0]&7&&(n=!0,c.lngLat=t[36].point,x(()=>n=!1)),e.$set(c)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){T(e,s)}}}function pr(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),te(e).forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"background-color",t[5][t[33].score]),X(e,"opacity",t[33].kind=="walking & wheeling"?"0%":"100%")},m(n,r){E(n,e,r)},p(n,r){r[0]&7&&X(e,"background-color",n[5][n[33].score]),r[0]&7&&X(e,"opacity",n[33].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&$(e)}}}function dr(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),te(e).forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"background-color",t[5][t[33].score])},m(n,r){E(n,e,r)},p(n,r){r[0]&7&&X(e,"background-color",n[5][n[33].score])},d(n){n&&$(e)}}}function _r(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),te(e).forEach($),this.h()},h(){Ne(e,"class","dot svelte-1qktznf"),X(e,"background-color",t[5][t[33].score]),X(e,"opacity","0%")},m(n,r){E(n,e,r)},p(n,r){r[0]&7&&X(e,"background-color",n[5][n[33].score])},d(n){n&&$(e)}}}function ct(t){let e,n,r,o,l,i,a,s,m;function c(f){t[19](f,t[33])}function p(){return t[20](t[35])}function u(){return t[21](t[35])}let C={draggable:!0,$$slots:{default:[pr]},$$scope:{ctx:t}};t[33].point1!==void 0&&(C.lngLat=t[33].point1),e=new Ie({props:C}),Z.push(()=>ee(e,"lngLat",c)),e.$on("dragend",p),e.$on("click",u);function A(f){t[22](f,t[33])}function L(){return t[23](t[35])}function U(){return t[24](t[35])}let g={draggable:!0,$$slots:{default:[dr]},$$scope:{ctx:t}};t[33].point2!==void 0&&(g.lngLat=t[33].point2),o=new Ie({props:g}),Z.push(()=>ee(o,"lngLat",A)),o.$on("dragend",L),o.$on("click",U);function _(f){t[25](f,t[33])}function v(){return t[26](t[35])}function q(){return t[27](t[35])}let b={draggable:!0,$$slots:{default:[_r]},$$scope:{ctx:t}};return t[33].point3!==void 0&&(b.lngLat=t[33].point3),a=new Ie({props:b}),Z.push(()=>ee(a,"lngLat",_)),a.$on("dragend",v),a.$on("click",q),{c(){S(e.$$.fragment),r=O(),S(o.$$.fragment),i=O(),S(a.$$.fragment)},l(f){I(e.$$.fragment,f),r=N(f),I(o.$$.fragment,f),i=N(f),I(a.$$.fragment,f)},m(f,P){F(e,f,P),E(f,r,P),F(o,f,P),E(f,i,P),F(a,f,P),m=!0},p(f,P){t=f;const B={};P[0]&7|P[1]&128&&(B.$$scope={dirty:P,ctx:t}),!n&&P[0]&7&&(n=!0,B.lngLat=t[33].point1,x(()=>n=!1)),e.$set(B);const H={};P[0]&7|P[1]&128&&(H.$$scope={dirty:P,ctx:t}),!l&&P[0]&7&&(l=!0,H.lngLat=t[33].point2,x(()=>l=!1)),o.$set(H);const M={};P[0]&7|P[1]&128&&(M.$$scope={dirty:P,ctx:t}),!s&&P[0]&7&&(s=!0,M.lngLat=t[33].point3,x(()=>s=!1)),a.$set(M)},i(f){m||(y(e.$$.fragment,f),y(o.$$.fragment,f),y(a.$$.fragment,f),m=!0)},o(f){k(e.$$.fragment,f),k(o.$$.fragment,f),k(a.$$.fragment,f),m=!1},d(f){f&&($(r),$(i)),T(e,f),T(o,f),T(a,f)}}}function hr(t){let e=(t[32].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=K(r,e)},m(r,o){E(r,n,o)},p(r,o){o[1]&2&&e!==(e=(r[32].name||"Untitled movement")+"")&&ce(n,e)},d(r){r&&$(n)}}}function $r(t){let e,n;return e=new Pt({props:{$$slots:{default:[hr,({props:r})=>({32:r}),({props:r})=>[0,r?2:0]]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&130&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function br(t){let e=(t[32].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=K(r,e)},m(r,o){E(r,n,o)},p(r,o){o[1]&2&&e!==(e=(r[32].name||"Untitled movement")+"")&&ce(n,e)},d(r){r&&$(n)}}}function yr(t){let e,n;return e=new Pt({props:{$$slots:{default:[br,({props:r})=>({32:r}),({props:r})=>[0,r?2:0]]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&130&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function wr(t){let e,n,r,o,l,i;return e=new He({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":it(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[$r]},$$scope:{ctx:t}}}),e.$on("click",t[8]),r=new He({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":it(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[yr]},$$scope:{ctx:t}}}),r.$on("click",t[8]),l=new $n({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){S(e.$$.fragment),n=O(),S(r.$$.fragment),o=O(),S(l.$$.fragment)},l(a){I(e.$$.fragment,a),n=N(a),I(r.$$.fragment,a),o=N(a),I(l.$$.fragment,a)},m(a,s){F(e,a,s),E(a,n,s),F(r,a,s),E(a,o,s),F(l,a,s),i=!0},p(a,s){const m={};s[1]&128&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const c={};s[1]&128&&(c.$$scope={dirty:s,ctx:a}),r.$set(c)},i(a){i||(y(e.$$.fragment,a),y(r.$$.fragment,a),y(l.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),k(r.$$.fragment,a),k(l.$$.fragment,a),i=!1},d(a){a&&($(n),$(o)),T(e,a),T(r,a),T(l,a)}}}function vr(t){let e,n,r,o;return e=new He({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new mn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){S(e.$$.fragment),n=O(),S(r.$$.fragment)},l(l){I(e.$$.fragment,l),n=N(l),I(r.$$.fragment,l)},m(l,i){F(e,l,i),E(l,n,i),F(r,l,i),o=!0},p:Oe,i(l){o||(y(e.$$.fragment,l),y(r.$$.fragment,l),o=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),o=!1},d(l){l&&$(n),T(e,l),T(r,l)}}}function kr(t){let e,n,r,o,l,i,a,s,m,c;e=new ln({}),e.$on("click",t[7]);let p=ue(t[2].jat[t[0]][t[1]].arms),u=[];for(let g=0;g<p.length;g+=1)u[g]=mt(ft(t,p,g));const C=g=>k(u[g],1,1,()=>{u[g]=null});let A=ue(t[2].jat[t[0]][t[1]].movements),L=[];for(let g=0;g<A.length;g+=1)L[g]=ct(ut(t,A,g));const U=g=>k(L[g],1,1,()=>{L[g]=null});return l=new ot({props:{data:t[9](t[2]),$$slots:{default:[wr]},$$scope:{ctx:t}}}),a=new ot({props:{data:t[4],$$slots:{default:[vr]},$$scope:{ctx:t}}}),m=new an({props:{map:t[3]}}),{c(){S(e.$$.fragment),n=O();for(let g=0;g<u.length;g+=1)u[g].c();r=O();for(let g=0;g<L.length;g+=1)L[g].c();o=O(),S(l.$$.fragment),i=O(),S(a.$$.fragment),s=O(),S(m.$$.fragment)},l(g){I(e.$$.fragment,g),n=N(g);for(let _=0;_<u.length;_+=1)u[_].l(g);r=N(g);for(let _=0;_<L.length;_+=1)L[_].l(g);o=N(g),I(l.$$.fragment,g),i=N(g),I(a.$$.fragment,g),s=N(g),I(m.$$.fragment,g)},m(g,_){F(e,g,_),E(g,n,_);for(let v=0;v<u.length;v+=1)u[v]&&u[v].m(g,_);E(g,r,_);for(let v=0;v<L.length;v+=1)L[v]&&L[v].m(g,_);E(g,o,_),F(l,g,_),E(g,i,_),F(a,g,_),E(g,s,_),F(m,g,_),c=!0},p(g,_){if(_[0]&71){p=ue(g[2].jat[g[0]][g[1]].arms);let f;for(f=0;f<p.length;f+=1){const P=ft(g,p,f);u[f]?(u[f].p(P,_),y(u[f],1)):(u[f]=mt(P),u[f].c(),y(u[f],1),u[f].m(r.parentNode,r))}for(le(),f=p.length;f<u.length;f+=1)C(f);ae()}if(_[0]&103){A=ue(g[2].jat[g[0]][g[1]].movements);let f;for(f=0;f<A.length;f+=1){const P=ut(g,A,f);L[f]?(L[f].p(P,_),y(L[f],1)):(L[f]=ct(P),L[f].c(),y(L[f],1),L[f].m(o.parentNode,o))}for(le(),f=A.length;f<L.length;f+=1)U(f);ae()}const v={};_[0]&4&&(v.data=g[9](g[2])),_[1]&128&&(v.$$scope={dirty:_,ctx:g}),l.$set(v);const q={};_[0]&16&&(q.data=g[4]),_[1]&128&&(q.$$scope={dirty:_,ctx:g}),a.$set(q);const b={};_[0]&8&&(b.map=g[3]),m.$set(b)},i(g){if(!c){y(e.$$.fragment,g);for(let _=0;_<p.length;_+=1)y(u[_]);for(let _=0;_<A.length;_+=1)y(L[_]);y(l.$$.fragment,g),y(a.$$.fragment,g),y(m.$$.fragment,g),c=!0}},o(g){k(e.$$.fragment,g),u=u.filter(Boolean);for(let _=0;_<u.length;_+=1)k(u[_]);L=L.filter(Boolean);for(let _=0;_<L.length;_+=1)k(L[_]);k(l.$$.fragment,g),k(a.$$.fragment,g),k(m.$$.fragment,g),c=!1},d(g){g&&($(n),$(r),$(o),$(i),$(s)),T(e,g),Pe(u,g),Pe(L,g),T(l,g),T(a,g),T(m,g)}}}function jr(t){let e,n,r;function o(i){t[28](i)}let l={$$slots:{default:[kr]},$$scope:{ctx:t}};return t[3]!==void 0&&(l.map=t[3]),e=new nn({props:l}),Z.push(()=>ee(e,"map",o)),{c(){S(e.$$.fragment)},l(i){I(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,a){const s={};a[0]&31|a[1]&128&&(s.$$scope={dirty:a,ctx:i}),!n&&a[0]&8&&(n=!0,s.map=i[3],x(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){T(e,i)}}}function gt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Er(t){return String.fromCharCode(t+65)}function Cr(t,e,n){let r,o;Be(t,V,w=>n(2,o=w));let{junctionIdx:l}=e,{stage:i}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:m}=e,{streetviewOn:c}=e,p,u={0:Se.red.background,1:Se.amber.background,2:Se.green.background,X:Se.critical.background};function C(w,z,se){let be={type:"FeatureCollection",features:[]},ye=z??se;return ye!=null&&(ye.kind=="arm"?be.features.push(gt(w.jat[l][i].arms[ye.idx],ye.idx)):be.features.push(_(w.jat[l][i].movements[ye.idx],ye.idx))),be}function A(w){n(10,s=w),n(11,m=null)}function L(w){if(!c){for(let z of p.queryRenderedFeatures(w.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(10,s=null);return}a=="arm"?(Te(V,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:w.detail.lngLat.toArray(),name:""}],o),n(10,s={kind:"arm",idx:o.jat[l][i].arms.length-1})):(Te(V,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:w.detail.lngLat.toArray(),point2:at(w.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:at(w.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(10,s={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(11,m=null)}}function U(w){A({kind:"movement",idx:w.detail.features[0].id})}Qt(()=>{q(!1)});function g(w){let z={type:"FeatureCollection",features:w.jat[l][i].movements.map((se,be)=>_(se,be))};for(let se of w.jat[l][i].movements)if(z.features.push(v(se,z.features.length)),se.kind=="walking & wheeling"){let be={...se,point1:se.point3,point3:se.point1};z.features.push(v(be,z.features.length))}for(let se of w.jat[l][i].arms)z.features.push(gt(se,z.features.length));return z}function _(w,z){return{type:"Feature",id:z,properties:{name:w.name,kind:w.kind,color:u[w.score]},geometry:{type:"LineString",coordinates:[w.point1,w.point2,w.point3]}}}function v(w,z){return{type:"Feature",id:z,properties:{kind:w.kind,color:u[w.score],angle:cr(w.point2,w.point3)},geometry:{type:"Point",coordinates:w.point3}}}function q(w){let z=g(o);z.features.length>0&&p.fitBounds(on(z),{padding:20,animate:w})}function b(){return p}function f(w,z){t.$$.not_equal(z.point,w)&&(z.point=w,V.set(o))}const P=w=>A({kind:"arm",idx:w}),B=w=>A({kind:"arm",idx:w});function H(w,z){t.$$.not_equal(z.point1,w)&&(z.point1=w,V.set(o))}const M=w=>A({kind:"movement",idx:w}),he=w=>A({kind:"movement",idx:w});function j(w,z){t.$$.not_equal(z.point2,w)&&(z.point2=w,V.set(o))}const d=w=>A({kind:"movement",idx:w}),h=w=>A({kind:"movement",idx:w});function W(w,z){t.$$.not_equal(z.point3,w)&&(z.point3=w,V.set(o))}const ie=w=>A({kind:"movement",idx:w}),G=w=>A({kind:"movement",idx:w});function $e(w){p=w,n(3,p)}return t.$$set=w=>{"junctionIdx"in w&&n(0,l=w.junctionIdx),"stage"in w&&n(1,i=w.stage),"newKind"in w&&n(12,a=w.newKind),"editing"in w&&n(10,s=w.editing),"hoveringSidebar"in w&&n(11,m=w.hoveringSidebar),"streetviewOn"in w&&n(13,c=w.streetviewOn)},t.$$.update=()=>{t.$$.dirty[0]&3076&&n(4,r=C(o,s,m))},[l,i,o,p,r,u,A,L,U,g,s,m,a,c,q,b,f,P,B,H,M,he,j,d,h,W,ie,G,$e]}class Lr extends Ae{constructor(e){super(),Me(this,e,Cr,jr,je,{junctionIdx:0,stage:1,newKind:12,editing:10,hoveringSidebar:11,streetviewOn:13,zoom:14,getMap:15},null,[-1,-1])}get zoom(){return this.$$.ctx[14]}get getMap(){return this.$$.ctx[15]}}function Pr(t){let e,n,r,o,l,i,a,s,m,c,p,u;function C(b){t[5](b)}let A={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(A.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new Xe({props:A}),Z.push(()=>ee(e,"value",C));function L(b){t[6](b)}let U={legend:"Movement",choices:Mt(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(U.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Lt({props:U}),Z.push(()=>ee(o,"value",L));function g(b){t[7](b)}let _={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new pn({props:_}),Z.push(()=>ee(a,"value",g));function v(b){t[8](b)}let q={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(q.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),c=new At({props:q}),Z.push(()=>ee(c,"value",v)),{c(){S(e.$$.fragment),r=O(),S(o.$$.fragment),i=O(),S(a.$$.fragment),m=O(),S(c.$$.fragment)},l(b){I(e.$$.fragment,b),r=N(b),I(o.$$.fragment,b),i=N(b),I(a.$$.fragment,b),m=N(b),I(c.$$.fragment,b)},m(b,f){F(e,b,f),E(b,r,f),F(o,b,f),E(b,i,f),F(a,b,f),E(b,m,f),F(c,b,f),u=!0},p(b,[f]){const P={};!n&&f&15&&(n=!0,P.value=b[3].jat[b[0]][b[1]].movements[b[2]].name,x(()=>n=!1)),e.$set(P);const B={};!l&&f&15&&(l=!0,B.value=b[3].jat[b[0]][b[1]].movements[b[2]].kind,x(()=>l=!1)),o.$set(B);const H={};!s&&f&15&&(s=!0,H.value=b[3].jat[b[0]][b[1]].movements[b[2]].score,x(()=>s=!1)),a.$set(H);const M={};!p&&f&15&&(p=!0,M.value=b[3].jat[b[0]][b[1]].movements[b[2]].notes,x(()=>p=!1)),c.$set(M)},i(b){u||(y(e.$$.fragment,b),y(o.$$.fragment,b),y(a.$$.fragment,b),y(c.$$.fragment,b),u=!0)},o(b){k(e.$$.fragment,b),k(o.$$.fragment,b),k(a.$$.fragment,b),k(c.$$.fragment,b),u=!1},d(b){b&&($(r),$(i),$(m)),T(e,b),T(o,b),T(a,b),T(c,b)}}}function Ar(t,e,n){let r;Be(t,V,u=>n(3,r=u));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e;Mt(["cycling","walking & wheeling"]);let a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(u){t.$$.not_equal(r.jat[o][l].movements[i].name,u)&&(r.jat[o][l].movements[i].name=u,V.set(r))}function m(u){t.$$.not_equal(r.jat[o][l].movements[i].kind,u)&&(r.jat[o][l].movements[i].kind=u,V.set(r))}function c(u){t.$$.not_equal(r.jat[o][l].movements[i].score,u)&&(r.jat[o][l].movements[i].score=u,V.set(r))}function p(u){t.$$.not_equal(r.jat[o][l].movements[i].notes,u)&&(r.jat[o][l].movements[i].notes=u,V.set(r))}return t.$$set=u=>{"junctionIdx"in u&&n(0,o=u.junctionIdx),"stage"in u&&n(1,l=u.stage),"idx"in u&&n(2,i=u.idx)},[o,l,i,r,a,s,m,c,p]}class Mr extends Ae{constructor(e){super(),Me(this,e,Ar,Pr,je,{junctionIdx:0,stage:1,idx:2})}}const{window:Sr}=rn;function pt(t,e,n){const r=t.slice();return r[27]=e[n],r[29]=n,r}function dt(t,e,n){const r=t.slice();return r[30]=e[n],r[29]=n,r}function Ir(t){let e,n,r,o,l,i,a,s;e=new gn({props:{$$slots:{default:[Tr]},$$scope:{ctx:t}}}),e.$on("click",t[23]),r=new Et({props:{$$slots:{default:[qr]},$$scope:{ctx:t}}}),r.$on("click",t[10]);const m=[Or,Br],c=[];function p(u,C){return u[3].kind=="movement"?0:1}return l=p(t),i=c[l]=m[l](t),{c(){S(e.$$.fragment),n=O(),S(r.$$.fragment),o=O(),i.c(),a=fe()},l(u){I(e.$$.fragment,u),n=N(u),I(r.$$.fragment,u),o=N(u),i.l(u),a=fe()},m(u,C){F(e,u,C),E(u,n,C),F(r,u,C),E(u,o,C),c[l].m(u,C),E(u,a,C),s=!0},p(u,C){const A={};C[1]&2&&(A.$$scope={dirty:C,ctx:u}),e.$set(A);const L={};C[1]&2&&(L.$$scope={dirty:C,ctx:u}),r.$set(L);let U=l;l=p(u),l===U?c[l].p(u,C):(le(),k(c[U],1,1,()=>{c[U]=null}),ae(),i=c[l],i?i.p(u,C):(i=c[l]=m[l](u),i.c()),y(i,1),i.m(a.parentNode,a))},i(u){s||(y(e.$$.fragment,u),y(r.$$.fragment,u),y(i),s=!0)},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),k(i),s=!1},d(u){u&&($(n),$(o),$(a)),T(e,u),T(r,u),c[l].d(u)}}}function Fr(t){let e,n,r,o,l,i,a="Arms",s,m,c,p,u,C="Movements",A,L,U,g,_;e=new cn({props:{label:"Tools",$$slots:{default:[Gr]},$$scope:{ctx:t}}});function v(d){t[16](d)}let q={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(q.value=t[2]),r=new Lt({props:q}),Z.push(()=>ee(r,"value",v));let b=ue(t[7].jat[t[0]][t[1]].arms),f=[];for(let d=0;d<b.length;d+=1)f[d]=ht(dt(t,b,d));const P=d=>k(f[d],1,1,()=>{f[d]=null});let B=t[7].jat[t[0]][t[8]].arms.length>0&&$t(t),H=ue(t[7].jat[t[0]][t[1]].movements),M=[];for(let d=0;d<H.length;d+=1)M[d]=bt(pt(t,H,d));const he=d=>k(M[d],1,1,()=>{M[d]=null});let j=t[7].jat[t[0]][t[1]].movements.length>0&&yt(t);return{c(){S(e.$$.fragment),n=O(),S(r.$$.fragment),l=O(),i=Q("h3"),i.textContent=a,s=O(),m=Q("ul");for(let d=0;d<f.length;d+=1)f[d].c();c=O(),B&&B.c(),p=O(),u=Q("h3"),u.textContent=C,A=O(),L=Q("ol");for(let d=0;d<M.length;d+=1)M[d].c();U=O(),j&&j.c(),g=fe()},l(d){I(e.$$.fragment,d),n=N(d),I(r.$$.fragment,d),l=N(d),i=Y(d,"H3",{"data-svelte-h":!0}),rt(i)!=="svelte-ld74qb"&&(i.textContent=a),s=N(d),m=Y(d,"UL",{});var h=te(m);for(let ie=0;ie<f.length;ie+=1)f[ie].l(h);h.forEach($),c=N(d),B&&B.l(d),p=N(d),u=Y(d,"H3",{"data-svelte-h":!0}),rt(u)!=="svelte-1dc52s8"&&(u.textContent=C),A=N(d),L=Y(d,"OL",{});var W=te(L);for(let ie=0;ie<M.length;ie+=1)M[ie].l(W);W.forEach($),U=N(d),j&&j.l(d),g=fe()},m(d,h){F(e,d,h),E(d,n,h),F(r,d,h),E(d,l,h),E(d,i,h),E(d,s,h),E(d,m,h);for(let W=0;W<f.length;W+=1)f[W]&&f[W].m(m,null);E(d,c,h),B&&B.m(d,h),E(d,p,h),E(d,u,h),E(d,A,h),E(d,L,h);for(let W=0;W<M.length;W+=1)M[W]&&M[W].m(L,null);E(d,U,h),j&&j.m(d,h),E(d,g,h),_=!0},p(d,h){const W={};h[0]&96|h[1]&2&&(W.$$scope={dirty:h,ctx:d}),e.$set(W);const ie={};if(!o&&h[0]&4&&(o=!0,ie.value=d[2],x(()=>o=!1)),r.$set(ie),h[0]&659){b=ue(d[7].jat[d[0]][d[1]].arms);let G;for(G=0;G<b.length;G+=1){const $e=dt(d,b,G);f[G]?(f[G].p($e,h),y(f[G],1)):(f[G]=ht($e),f[G].c(),y(f[G],1),f[G].m(m,null))}for(le(),G=b.length;G<f.length;G+=1)P(G);ae()}if(d[7].jat[d[0]][d[8]].arms.length>0?B?(B.p(d,h),h[0]&129&&y(B,1)):(B=$t(d),B.c(),y(B,1),B.m(p.parentNode,p)):B&&(le(),k(B,1,1,()=>{B=null}),ae()),h[0]&659){H=ue(d[7].jat[d[0]][d[1]].movements);let G;for(G=0;G<H.length;G+=1){const $e=pt(d,H,G);M[G]?(M[G].p($e,h),y(M[G],1)):(M[G]=bt($e),M[G].c(),y(M[G],1),M[G].m(L,null))}for(le(),G=H.length;G<M.length;G+=1)he(G);ae()}d[7].jat[d[0]][d[1]].movements.length>0?j?j.p(d,h):(j=yt(d),j.c(),j.m(g.parentNode,g)):j&&(j.d(1),j=null)},i(d){if(!_){y(e.$$.fragment,d),y(r.$$.fragment,d);for(let h=0;h<b.length;h+=1)y(f[h]);y(B);for(let h=0;h<H.length;h+=1)y(M[h]);_=!0}},o(d){k(e.$$.fragment,d),k(r.$$.fragment,d),f=f.filter(Boolean);for(let h=0;h<f.length;h+=1)k(f[h]);k(B),M=M.filter(Boolean);for(let h=0;h<M.length;h+=1)k(M[h]);_=!1},d(d){d&&($(n),$(l),$(i),$(s),$(m),$(c),$(p),$(u),$(A),$(L),$(U),$(g)),T(e,d),T(r,d),Pe(f,d),B&&B.d(d),Pe(M,d),j&&j.d(d)}}}function Tr(t){let e;return{c(){e=J("Save")},l(n){e=K(n,"Save")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function qr(t){let e;return{c(){e=J("Delete")},l(n){e=K(n,"Delete")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function Br(t){let e,n,r;function o(i){t[24](i)}let l={label:"Arm Name"};return t[7].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[7].jat[t[0]][t[1]].arms[t[3].idx].name),e=new Xe({props:l}),Z.push(()=>ee(e,"value",o)),{c(){S(e.$$.fragment)},l(i){I(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&139&&(n=!0,s.value=i[7].jat[i[0]][i[1]].arms[i[3].idx].name,x(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){T(e,i)}}}function Or(t){let e,n;return e=new Mr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Nr(t){let e;return{c(){e=J("Zoom to fit")},l(n){e=K(n,"Zoom to fit")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function _t(t){var i;let e,n,r;function o(a){t[15](a)}let l={map:(i=t[6])==null?void 0:i.getMap()};return t[5]!==void 0&&(l.enabled=t[5]),e=new fn({props:l}),Z.push(()=>ee(e,"enabled",o)),{c(){S(e.$$.fragment)},l(a){I(e.$$.fragment,a)},m(a,s){F(e,a,s),r=!0},p(a,s){var c;const m={};s[0]&64&&(m.map=(c=a[6])==null?void 0:c.getMap()),!n&&s[0]&32&&(n=!0,m.enabled=a[5],x(()=>n=!1)),e.$set(m)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){T(e,a)}}}function Gr(t){var p;let e,n,r,o,l,i,a=(p=t[6])==null?void 0:p.getMap(),s,m;e=new me({props:{$$slots:{default:[Nr]},$$scope:{ctx:t}}}),e.$on("click",t[14]),r=new sn({}),l=new un({});let c=a&&_t(t);return{c(){S(e.$$.fragment),n=O(),S(r.$$.fragment),o=O(),S(l.$$.fragment),i=O(),c&&c.c(),s=fe()},l(u){I(e.$$.fragment,u),n=N(u),I(r.$$.fragment,u),o=N(u),I(l.$$.fragment,u),i=N(u),c&&c.l(u),s=fe()},m(u,C){F(e,u,C),E(u,n,C),F(r,u,C),E(u,o,C),F(l,u,C),E(u,i,C),c&&c.m(u,C),E(u,s,C),m=!0},p(u,C){var L;const A={};C[1]&2&&(A.$$scope={dirty:C,ctx:u}),e.$set(A),C[0]&64&&(a=(L=u[6])==null?void 0:L.getMap()),a?c?(c.p(u,C),C[0]&64&&y(c,1)):(c=_t(u),c.c(),y(c,1),c.m(s.parentNode,s)):c&&(le(),k(c,1,1,()=>{c=null}),ae())},i(u){m||(y(e.$$.fragment,u),y(r.$$.fragment,u),y(l.$$.fragment,u),y(c),m=!0)},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),k(l.$$.fragment,u),k(c),m=!1},d(u){u&&($(n),$(o),$(i),$(s)),T(e,u),T(r,u),T(l,u),c&&c.d(u)}}}function zr(t){let e=Hr(t[29])+"",n,r,o=(t[30].name||"Unnamed arm")+"",l;return{c(){n=J(e),r=J(" - "),l=J(o)},l(i){n=K(i,e),r=K(i," - "),l=K(i,o)},m(i,a){E(i,n,a),E(i,r,a),E(i,l,a)},p(i,a){a[0]&131&&o!==(o=(i[30].name||"Unnamed arm")+"")&&ce(l,o)},d(i){i&&($(n),$(r),$(l))}}}function ht(t){let e,n,r,o;function l(){return t[17](t[29])}function i(){return t[18](t[29])}return n=new me({props:{$$slots:{default:[zr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[19]),{c(){e=Q("li"),S(n.$$.fragment),r=O()},l(a){e=Y(a,"LI",{});var s=te(e);I(n.$$.fragment,s),r=N(s),s.forEach($)},m(a,s){E(a,e,s),F(n,e,null),oe(e,r),o=!0},p(a,s){t=a;const m={};s[0]&131|s[1]&2&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&$(e),T(n)}}}function $t(t){let e,n;return e=new me({props:{$$slots:{default:[Dr]},$$scope:{ctx:t}}}),e.$on("click",t[12]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&2&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Dr(t){let e,n;return{c(){e=J("Copy arms from "),n=J(t[8])},l(r){e=K(r,"Copy arms from "),n=K(r,t[8])},m(r,o){E(r,e,o),E(r,n,o)},p:Oe,d(r){r&&($(e),$(n))}}}function Rr(t){let e=(t[27].name||"Unnamed movement")+"",n;return{c(){n=J(e)},l(r){n=K(r,e)},m(r,o){E(r,n,o)},p(r,o){o[0]&131&&e!==(e=(r[27].name||"Unnamed movement")+"")&&ce(n,e)},d(r){r&&$(n)}}}function bt(t){let e,n,r,o;function l(){return t[20](t[29])}function i(){return t[21](t[29])}return n=new me({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[22]),{c(){e=Q("li"),S(n.$$.fragment),r=O()},l(a){e=Y(a,"LI",{});var s=te(e);I(n.$$.fragment,s),r=N(s),s.forEach($)},m(a,s){E(a,e,s),F(n,e,null),oe(e,r),o=!0},p(a,s){t=a;const m={};s[0]&131|s[1]&2&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&$(e),T(n)}}}function yt(t){let e,n,r=wt(t[7].jat[t[0]][t[1]])+"",o,l;return{c(){e=Q("p"),n=J("Total JAT score: "),o=J(r),l=J("%")},l(i){e=Y(i,"P",{});var a=te(e);n=K(a,"Total JAT score: "),o=K(a,r),l=K(a,"%"),a.forEach($)},m(i,a){E(i,e,a),oe(e,n),oe(e,o),oe(e,l)},p(i,a){a[0]&131&&r!==(r=wt(i[7].jat[i[0]][i[1]])+"")&&ce(o,r)},d(i){i&&$(e)}}}function Ur(t){let e,n,r,o,l,i,a,s,m,c,p,u,C,A;function L(f){t[13](f)}let U={label:"Commentary / Notes"};t[7].jat[t[0]][t[1]].notes!==void 0&&(U.value=t[7].jat[t[0]][t[1]].notes),e=new At({props:U}),Z.push(()=>ee(e,"value",L));const g=[Fr,Ir],_=[];function v(f,P){return f[3]==null?0:1}i=v(t),a=_[i]=g[i](t);function q(f){t[26](f)}let b={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5]};return t[3]!==void 0&&(b.editing=t[3]),c=new Lr({props:b}),t[25](c),Z.push(()=>ee(c,"editing",q)),{c(){S(e.$$.fragment),r=O(),o=Q("div"),l=Q("div"),a.c(),s=O(),m=Q("div"),S(c.$$.fragment),this.h()},l(f){I(e.$$.fragment,f),r=N(f),o=Y(f,"DIV",{style:!0});var P=te(o);l=Y(P,"DIV",{style:!0});var B=te(l);a.l(B),B.forEach($),s=N(P),m=Y(P,"DIV",{style:!0});var H=te(m);I(c.$$.fragment,H),H.forEach($),P.forEach($),this.h()},h(){X(l,"width","30%"),X(l,"overflow-y","scroll"),X(l,"padding","10px"),X(l,"border","1px solid black"),X(m,"position","relative"),X(m,"width","100%"),X(o,"display","flex"),X(o,"height","80vh")},m(f,P){F(e,f,P),E(f,r,P),E(f,o,P),oe(o,l),_[i].m(l,null),oe(o,s),oe(o,m),F(c,m,null),u=!0,C||(A=Yt(Sr,"keydown",t[11]),C=!0)},p(f,P){const B={};!n&&P[0]&131&&(n=!0,B.value=f[7].jat[f[0]][f[1]].notes,x(()=>n=!1)),e.$set(B);let H=i;i=v(f),i===H?_[i].p(f,P):(le(),k(_[H],1,1,()=>{_[H]=null}),ae(),a=_[i],a?a.p(f,P):(a=_[i]=g[i](f),a.c()),y(a,1),a.m(l,null));const M={};P[0]&1&&(M.junctionIdx=f[0]),P[0]&2&&(M.stage=f[1]),P[0]&4&&(M.newKind=f[2]),P[0]&16&&(M.hoveringSidebar=f[4]),P[0]&32&&(M.streetviewOn=f[5]),!p&&P[0]&8&&(p=!0,M.editing=f[3],x(()=>p=!1)),c.$set(M)},i(f){u||(y(e.$$.fragment,f),y(a),y(c.$$.fragment,f),u=!0)},o(f){k(e.$$.fragment,f),k(a),k(c.$$.fragment,f),u=!1},d(f){f&&($(r),$(o)),T(e,f),_[i].d(),t[25](null),T(c),C=!1,A()}}}function Hr(t){return String.fromCharCode(t+65)}function wt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function Jr(t,e,n){let r;Be(t,V,h=>n(7,r=h));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",a="arm",s=null,m=null,c=!1,p=null;function u(h){n(3,s=h),n(4,m=null)}function C(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][l].movements.splice(s.idx,1),V.set(r)):(r.jat[o][l].arms.splice(s.idx,1),V.set(r)),n(3,s=null))}function A(h){s!=null&&h.key=="Escape"?(h.stopPropagation(),n(3,s=null)):s!=null&&h.key=="Delete"&&C()}function L(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(Te(V,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),V.set(r))}function U(h){t.$$.not_equal(r.jat[o][l].notes,h)&&(r.jat[o][l].notes=h,V.set(r))}const g=()=>p==null?void 0:p.zoom(!0);function _(h){c=h,n(5,c)}function v(h){a=h,n(2,a)}const q=h=>u({kind:"arm",idx:h}),b=h=>n(4,m={kind:"arm",idx:h}),f=()=>n(4,m=null),P=h=>u({kind:"movement",idx:h}),B=h=>n(4,m={kind:"movement",idx:h}),H=()=>n(4,m=null),M=()=>n(3,s=null);function he(h){t.$$.not_equal(r.jat[o][l].arms[s.idx].name,h)&&(r.jat[o][l].arms[s.idx].name=h,V.set(r))}function j(h){Z[h?"unshift":"push"](()=>{p=h,n(6,p)})}function d(h){s=h,n(3,s)}return t.$$set=h=>{"junctionIdx"in h&&n(0,o=h.junctionIdx),"stage"in h&&n(1,l=h.stage)},[o,l,a,s,m,c,p,r,i,u,C,A,L,U,g,_,v,q,b,f,P,B,H,M,he,j,d]}class Kr extends Ae{constructor(e){super(),Me(this,e,Jr,Ur,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function vt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function Vr(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,c,p,u,C=t[0].stage,A,L;s=new xt({props:{$$slots:{default:[to]},$$scope:{ctx:t}}});function U(v){t[9](v)}let g={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(g.value=t[1].jat[t[0].idx].name),c=new Xe({props:g}),Z.push(()=>ee(c,"value",U));let _=kt(t);return{c(){e=Q("h2"),r=J(n),o=J(" - "),i=J(l),a=O(),S(s.$$.fragment),m=O(),S(c.$$.fragment),u=O(),_.c(),A=fe()},l(v){e=Y(v,"H2",{});var q=te(e);r=K(q,n),o=K(q," - "),i=K(q,l),q.forEach($),a=N(v),I(s.$$.fragment,v),m=N(v),I(c.$$.fragment,v),u=N(v),_.l(v),A=fe()},m(v,q){E(v,e,q),oe(e,r),oe(e,o),oe(e,i),E(v,a,q),F(s,v,q),E(v,m,q),F(c,v,q),E(v,u,q),_.m(v,q),E(v,A,q),L=!0},p(v,q){(!L||q&3)&&n!==(n=(v[1].jat[v[0].idx].name||"Untitled junction")+"")&&ce(r,n),(!L||q&1)&&l!==(l=v[0].stage+"")&&ce(i,l);const b={};q&8193&&(b.$$scope={dirty:q,ctx:v}),s.$set(b);const f={};!p&&q&3&&(p=!0,f.value=v[1].jat[v[0].idx].name,x(()=>p=!1)),c.$set(f),q&1&&je(C,C=v[0].stage)?(le(),k(_,1,1,Oe),ae(),_=kt(v),_.c(),y(_,1),_.m(A.parentNode,A)):_.p(v,q)},i(v){L||(y(s.$$.fragment,v),y(c.$$.fragment,v),y(_),L=!0)},o(v){k(s.$$.fragment,v),k(c.$$.fragment,v),k(_),L=!1},d(v){v&&($(e),$(a),$(m),$(u),$(A)),T(s,v),T(c,v),_.d(v)}}}function Xr(t){let e,n,r,o;e=new me({props:{$$slots:{default:[no]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=ue(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=jt(vt(t,l,s));const a=s=>k(i[s],1,1,()=>{i[s]=null});return{c(){S(e.$$.fragment),n=O(),r=Q("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){I(e.$$.fragment,s),n=N(s),r=Y(s,"OL",{});var m=te(r);for(let c=0;c<i.length;c+=1)i[c].l(m);m.forEach($)},m(s,m){F(e,s,m),E(s,n,m),E(s,r,m);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(r,null);o=!0},p(s,m){const c={};if(m&8192&&(c.$$scope={dirty:m,ctx:s}),e.$set(c),m&3){l=ue(s[1].jat);let p;for(p=0;p<l.length;p+=1){const u=vt(s,l,p);i[p]?(i[p].p(u,m),y(i[p],1)):(i[p]=jt(u),i[p].c(),y(i[p],1),i[p].m(r,null))}for(le(),p=l.length;p<i.length;p+=1)a(p);ae()}},i(s){if(!o){y(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)y(i[m]);o=!0}},o(s){k(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)k(i[m]);o=!1},d(s){s&&($(n),$(r)),T(e,s),Pe(i,s)}}}function Wr(t){let e;return{c(){e=J("Back to all junctions")},l(n){e=K(n,"Back to all junctions")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function Zr(t){let e,n;return e=new me({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Qr(t){let e,n;return e=new me({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Yr(t){let e;return{c(){e=J("Edit Proposed")},l(n){e=K(n,"Edit Proposed")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function xr(t){let e;return{c(){e=J("Edit Existing")},l(n){e=K(n,"Edit Existing")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function eo(t){let e;return{c(){e=J("Delete")},l(n){e=K(n,"Delete")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function to(t){let e,n,r,o,l,i,a;e=new me({props:{$$slots:{default:[Wr]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const s=[Qr,Zr],m=[];function c(p,u){return p[0].stage=="proposed"?0:1}return r=c(t),o=m[r]=s[r](t),i=new Et({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){S(e.$$.fragment),n=O(),o.c(),l=O(),S(i.$$.fragment)},l(p){I(e.$$.fragment,p),n=N(p),o.l(p),l=N(p),I(i.$$.fragment,p)},m(p,u){F(e,p,u),E(p,n,u),m[r].m(p,u),E(p,l,u),F(i,p,u),a=!0},p(p,u){const C={};u&8192&&(C.$$scope={dirty:u,ctx:p}),e.$set(C);let A=r;r=c(p),r===A?m[r].p(p,u):(le(),k(m[A],1,1,()=>{m[A]=null}),ae(),o=m[r],o?o.p(p,u):(o=m[r]=s[r](p),o.c()),y(o,1),o.m(l.parentNode,l));const L={};u&8192&&(L.$$scope={dirty:u,ctx:p}),i.$set(L)},i(p){a||(y(e.$$.fragment,p),y(o),y(i.$$.fragment,p),a=!0)},o(p){k(e.$$.fragment,p),k(o),k(i.$$.fragment,p),a=!1},d(p){p&&($(n),$(l)),T(e,p),m[r].d(p),T(i,p)}}}function kt(t){let e,n;return e=new Kr({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function no(t){let e;return{c(){e=J("Add new junction")},l(n){e=K(n,"Add new junction")},m(n,r){E(n,e,r)},d(n){n&&$(e)}}}function ro(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=J(e)},l(r){n=K(r,e)},m(r,o){E(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&ce(n,e)},d(r){r&&$(n)}}}function jt(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new me({props:{$$slots:{default:[ro]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=Q("li"),S(n.$$.fragment),r=O()},l(i){e=Y(i,"LI",{});var a=te(e);I(n.$$.fragment,a),r=N(a),a.forEach($)},m(i,a){E(i,e,a),F(n,e,null),oe(e,r),o=!0},p(i,a){t=i;const s={};a&8194&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(y(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&$(e),T(n)}}}function oo(t){let e,n,r,o;const l=[Xr,Vr],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=fe()},l(s){n&&n.l(s),r=fe()},m(s,m){~e&&i[e].m(s,m),E(s,r,m),o=!0},p(s,[m]){let c=e;e=a(s),e===c?~e&&i[e].p(s,m):(n&&(le(),k(i[c],1,1,()=>{i[c]=null}),ae()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),y(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(y(n),o=!0)},o(s){k(n),o=!1},d(s){s&&$(r),~e&&i[e].d(s)}}}function Ue(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function io(t,e,n){let r;Be(t,V,C=>n(1,r=C));let o={kind:"list"};function l(){Te(V,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(C){window.confirm("Delete this junction?")&&(r.jat.splice(C,1),V.set(r),n(0,o={kind:"list"}))}const a=C=>n(0,o={kind:"edit",idx:C,stage:"existing"}),s=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Ue(o),stage:"existing"}),c=()=>n(0,o={kind:"edit",idx:Ue(o),stage:"proposed"}),p=()=>i(Ue(o));function u(C){t.$$.not_equal(r.jat[o.idx].name,C)&&(r.jat[o.idx].name=C,V.set(r))}return[o,r,l,i,a,s,m,c,p,u]}class Po extends Ae{constructor(e){super(),Me(this,e,io,oo,je,{})}}export{Po as component};
