import{s as Ce,v as X,x,l as xe,u as et,m as tt,o as nt,H as _e,e as K,t as te,a as B,c as J,b as Y,d as ne,f as $,g as A,r as F,w as le,i as C,h as G,k as De,U as Be,j as pe,N as ve,z as ue,a7 as it,E as Ee,p as Ie,q as $e,B as Ke,n as lt,R as Se,S as Te}from"../chunks/scheduler.Bsni_e59.js";import{S as we,i as Le,e as ee,c as q,a as z,m as H,t as k,b as L,d as P,g as ce,f as me}from"../chunks/index.CCfAUppz.js";import{L as ot,g as rt,M as st,a as at,G as ft}from"../chunks/MapLibreMap.BfR-6czK.js";import{e as fe}from"../chunks/each.BmgwAlbi.js";import{c as ut,p as ct}from"../chunks/colors.CYEpEtTL.js";import{p as Je}from"../chunks/index.yH8gHwky.js";import{S as Ae,W as mt}from"../chunks/WarningButton.D9QeV9gM.js";import{S as be}from"../chunks/Select.bLRJACqI.js";import{T as Ye}from"../chunks/TextArea.DbePhW6L.js";import{T as Ze}from"../chunks/TextInput.CHbK327s.js";import{s as W}from"../chunks/data.Cg3qNhLw.js";import{s as ye,b as ke,a as _t,B as pt,G as gt,R as dt,S as ht,c as vt,M as Qe}from"../chunks/GeoreferenceLayer.Bx3M17y-.js";import{Y as Xe}from"../chunks/YesNo.BixfGTmT.js";import{D as $t}from"../chunks/DefaultButton.DyQsHGbh.js";function bt(t){let e;const i=t[16].default,n=xe(i,t,t[24],null);return{c(){n&&n.c()},l(l){n&&n.l(l)},m(l,m){n&&n.m(l,m),e=!0},p(l,m){n&&n.p&&(!e||m&16777216)&&et(n,i,l,l[24],e?nt(i,l[24],m,null):tt(l[24]),null)},i(l){e||(k(n,l),e=!0)},o(l){L(n,l),e=!1},d(l){n&&n.d(l)}}}function yt(t){let e,i,n;function l(r){t[17](r)}let m={id:t[1],type:"circle",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[bt]},$$scope:{ctx:t}};return t[0]!==void 0&&(m.hovered=t[0]),e=new ot({props:m}),X.push(()=>ee(e,"hovered",l)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){q(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,c){H(e,r,c),n=!0},p(r,[c]){const s={};c&2&&(s.id=r[1]),c&4&&(s.source=r[2]),c&8&&(s.sourceLayer=r[3]),c&16&&(s.beforeId=r[4]),c&32&&(s.beforeLayerType=r[5]),c&64&&(s.paint=r[6]),c&128&&(s.layout=r[7]),c&256&&(s.filter=r[8]),c&512&&(s.applyToClusters=r[9]),c&1024&&(s.minzoom=r[10]),c&2048&&(s.maxzoom=r[11]),c&4096&&(s.hoverCursor=r[12]),c&8192&&(s.manageHoverState=r[13]),c&16384&&(s.eventsIfTopMost=r[14]),c&32768&&(s.interactive=r[15]),c&16777216&&(s.$$scope={dirty:c,ctx:r}),!i&&c&1&&(i=!0,s.hovered=r[0],x(()=>i=!1)),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){P(e,r)}}}function kt(t,e,i){let{$$slots:n={},$$scope:l}=e,{id:m=rt("circle")}=e,{source:r=void 0}=e,{sourceLayer:c=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:y=void 0}=e,{paint:p}=e,{layout:d=void 0}=e,{filter:v=void 0}=e,{applyToClusters:a=void 0}=e,{minzoom:u=void 0}=e,{maxzoom:S=void 0}=e,{hoverCursor:w=void 0}=e,{manageHoverState:g=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:N=!1}=e,{interactive:T=!0}=e;function Z(h){I=h,i(0,I)}function O(h){_e.call(this,t,h)}function M(h){_e.call(this,t,h)}function D(h){_e.call(this,t,h)}function U(h){_e.call(this,t,h)}function ae(h){_e.call(this,t,h)}function Q(h){_e.call(this,t,h)}return t.$$set=h=>{"id"in h&&i(1,m=h.id),"source"in h&&i(2,r=h.source),"sourceLayer"in h&&i(3,c=h.sourceLayer),"beforeId"in h&&i(4,s=h.beforeId),"beforeLayerType"in h&&i(5,y=h.beforeLayerType),"paint"in h&&i(6,p=h.paint),"layout"in h&&i(7,d=h.layout),"filter"in h&&i(8,v=h.filter),"applyToClusters"in h&&i(9,a=h.applyToClusters),"minzoom"in h&&i(10,u=h.minzoom),"maxzoom"in h&&i(11,S=h.maxzoom),"hoverCursor"in h&&i(12,w=h.hoverCursor),"manageHoverState"in h&&i(13,g=h.manageHoverState),"hovered"in h&&i(0,I=h.hovered),"eventsIfTopMost"in h&&i(14,N=h.eventsIfTopMost),"interactive"in h&&i(15,T=h.interactive),"$$scope"in h&&i(24,l=h.$$scope)},[I,m,r,c,s,y,p,d,v,a,u,S,w,g,N,T,n,Z,O,M,D,U,ae,Q,l]}class Ct extends we{constructor(e){super(),Le(this,e,kt,yt,Ce,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}function Me(t){let e,i;return e=new Ae({props:{$$slots:{default:[wt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){q(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){H(e,n,l),i=!0},p(n,l){const m={};l&2050&&(m.$$scope={dirty:l,ctx:n}),e.$set(m)},i(n){i||(k(e.$$.fragment,n),i=!0)},o(n){L(e.$$.fragment,n),i=!1},d(n){P(e,n)}}}function wt(t){let e,i;return{c(){e=te("Use lookup: "),i=te(t[1])},l(n){e=ne(n,"Use lookup: "),i=ne(n,t[1])},m(n,l){C(n,e,l),C(n,i,l)},p(n,l){l&2&&pe(i,n[1])},d(n){n&&($(e),$(i))}}}function Lt(t){let e,i,n,l,m,r,c,s,y,p,d,v,a,u,S,w,g,I,N,T,Z,O,M,D,U;function ae(o){t[5](o)}let Q={label:"Critical Issue",emptyOption:!0,choices:t[3]};t[2].criticalIssues[t[0]].criticalIssue!==void 0&&(Q.value=t[2].criticalIssues[t[0]].criticalIssue),p=new be({props:Q}),X.push(()=>ee(p,"value",ae));function h(o){t[6](o)}let ie={label:"Stage",emptyOption:!0,choices:Je(["Existing","Design"])};t[2].criticalIssues[t[0]].stage!==void 0&&(ie.value=t[2].criticalIssues[t[0]].stage),a=new be({props:ie}),X.push(()=>ee(a,"value",h));function V(o){t[7](o)}let _={label:"Location Name"};t[2].criticalIssues[t[0]].locationName!==void 0&&(_.value=t[2].criticalIssues[t[0]].locationName),w=new Ze({props:_}),X.push(()=>ee(w,"value",V));let f=t[1]&&t[1]!="Loading"&&t[1]!=t[2].criticalIssues[t[0]].locationName&&Me(t);function j(o){t[8](o)}let R={label:"Resolved by Design"};t[2].criticalIssues[t[0]].resolved!==void 0&&(R.value=t[2].criticalIssues[t[0]].resolved),T=new Xe({props:R}),X.push(()=>ee(T,"value",j));function E(o){t[9](o)}let oe={label:"Commentary & Feedback"};return t[2].criticalIssues[t[0]].notes!==void 0&&(oe.value=t[2].criticalIssues[t[0]].notes),M=new Ye({props:oe}),X.push(()=>ee(M,"value",E)),{c(){e=K("div"),i=K("a"),n=te("Google StreetView"),m=B(),r=K("a"),c=te("Bing Streetside"),y=B(),q(p.$$.fragment),v=B(),q(a.$$.fragment),S=B(),q(w.$$.fragment),I=B(),f&&f.c(),N=B(),q(T.$$.fragment),O=B(),q(M.$$.fragment),this.h()},l(o){e=J(o,"DIV",{style:!0});var b=Y(e);i=J(b,"A",{href:!0,target:!0});var re=Y(i);n=ne(re,"Google StreetView"),re.forEach($),m=A(b),r=J(b,"A",{href:!0,target:!0});var se=Y(r);c=ne(se,"Bing Streetside"),se.forEach($),b.forEach($),y=A(o),z(p.$$.fragment,o),v=A(o),z(a.$$.fragment,o),S=A(o),z(w.$$.fragment,o),I=A(o),f&&f.l(o),N=A(o),z(T.$$.fragment,o),O=A(o),z(M.$$.fragment,o),this.h()},h(){F(i,"href",l=ye(t[2].criticalIssues[t[0]].point)),F(i,"target","_blank"),F(r,"href",s=ke(t[2].criticalIssues[t[0]].point)),F(r,"target","_blank"),le(e,"display","flex"),le(e,"justify-content","space-evenly")},m(o,b){C(o,e,b),G(e,i),G(i,n),G(e,m),G(e,r),G(r,c),C(o,y,b),H(p,o,b),C(o,v,b),H(a,o,b),C(o,S,b),H(w,o,b),C(o,I,b),f&&f.m(o,b),C(o,N,b),H(T,o,b),C(o,O,b),H(M,o,b),U=!0},p(o,[b]){(!U||b&5&&l!==(l=ye(o[2].criticalIssues[o[0]].point)))&&F(i,"href",l),(!U||b&5&&s!==(s=ke(o[2].criticalIssues[o[0]].point)))&&F(r,"href",s);const re={};!d&&b&5&&(d=!0,re.value=o[2].criticalIssues[o[0]].criticalIssue,x(()=>d=!1)),p.$set(re);const se={};!u&&b&5&&(u=!0,se.value=o[2].criticalIssues[o[0]].stage,x(()=>u=!1)),a.$set(se);const ge={};!g&&b&5&&(g=!0,ge.value=o[2].criticalIssues[o[0]].locationName,x(()=>g=!1)),w.$set(ge),o[1]&&o[1]!="Loading"&&o[1]!=o[2].criticalIssues[o[0]].locationName?f?(f.p(o,b),b&7&&k(f,1)):(f=Me(o),f.c(),k(f,1),f.m(N.parentNode,N)):f&&(ce(),L(f,1,1,()=>{f=null}),me());const de={};!Z&&b&5&&(Z=!0,de.value=o[2].criticalIssues[o[0]].resolved,x(()=>Z=!1)),T.$set(de);const he={};!D&&b&5&&(D=!0,he.value=o[2].criticalIssues[o[0]].notes,x(()=>D=!1)),M.$set(he)},i(o){U||(k(p.$$.fragment,o),k(a.$$.fragment,o),k(w.$$.fragment,o),k(f),k(T.$$.fragment,o),k(M.$$.fragment,o),U=!0)},o(o){L(p.$$.fragment,o),L(a.$$.fragment,o),L(w.$$.fragment,o),L(f),L(T.$$.fragment,o),L(M.$$.fragment,o),U=!1},d(o){o&&($(e),$(y),$(v),$(S),$(I),$(N),$(O)),P(p,o),P(a,o),P(w,o),f&&f.d(o),P(T,o),P(M,o)}}}function It(t,e,i){let n;De(t,W,u=>i(2,n=u));let{idx:l}=e,m=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],r="Loading";Be(async()=>{await c(n.criticalIssues[l].point)});async function c(u){let S=`https://nominatim.openstreetmap.org/reverse?lon=${u[0]}&lat=${u[1]}&format=json`;try{let g=await(await fetch(S)).json();i(1,r=g.address.road??g.display_name)}catch(w){return console.log(`Location lookup failed: ${w}`),""}}function s(){ve(W,n.criticalIssues[l].locationName=r,n)}function y(u){t.$$.not_equal(n.criticalIssues[l].criticalIssue,u)&&(n.criticalIssues[l].criticalIssue=u,W.set(n))}function p(u){t.$$.not_equal(n.criticalIssues[l].stage,u)&&(n.criticalIssues[l].stage=u,W.set(n))}function d(u){t.$$.not_equal(n.criticalIssues[l].locationName,u)&&(n.criticalIssues[l].locationName=u,W.set(n))}function v(u){t.$$.not_equal(n.criticalIssues[l].resolved,u)&&(n.criticalIssues[l].resolved=u,W.set(n))}function a(u){t.$$.not_equal(n.criticalIssues[l].notes,u)&&(n.criticalIssues[l].notes=u,W.set(n))}return t.$$set=u=>{"idx"in u&&i(0,l=u.idx)},[l,r,n,m,s,y,p,d,v,a]}class St extends we{constructor(e){super(),Le(this,e,It,Lt,Ce,{idx:0})}}function je(t){let e,i;return e=new Ae({props:{$$slots:{default:[Tt]},$$scope:{ctx:t}}}),e.$on("click",t[4]),{c(){q(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){H(e,n,l),i=!0},p(n,l){const m={};l&2050&&(m.$$scope={dirty:l,ctx:n}),e.$set(m)},i(n){i||(k(e.$$.fragment,n),i=!0)},o(n){L(e.$$.fragment,n),i=!1},d(n){P(e,n)}}}function Tt(t){let e,i;return{c(){e=te("Use lookup: "),i=te(t[1])},l(n){e=ne(n,"Use lookup: "),i=ne(n,t[1])},m(n,l){C(n,e,l),C(n,i,l)},p(n,l){l&2&&pe(i,n[1])},d(n){n&&($(e),$(i))}}}function Nt(t){let e,i,n,l,m,r,c,s,y,p,d,v,a,u,S,w,g,I,N,T,Z,O,M,D,U;function ae(o){t[5](o)}let Q={label:"Policy Conflict",emptyOption:!0,choices:t[3]};t[2].policyConflictLog[t[0]].conflict!==void 0&&(Q.value=t[2].policyConflictLog[t[0]].conflict),p=new be({props:Q}),X.push(()=>ee(p,"value",ae));function h(o){t[6](o)}let ie={label:"Stage",emptyOption:!0,choices:Je(["Existing","Design"])};t[2].policyConflictLog[t[0]].stage!==void 0&&(ie.value=t[2].policyConflictLog[t[0]].stage),a=new be({props:ie}),X.push(()=>ee(a,"value",h));function V(o){t[7](o)}let _={label:"Location Name"};t[2].policyConflictLog[t[0]].locationName!==void 0&&(_.value=t[2].policyConflictLog[t[0]].locationName),w=new Ze({props:_}),X.push(()=>ee(w,"value",V));let f=t[1]&&t[1]!="Loading"&&t[1]!=t[2].policyConflictLog[t[0]].locationName&&je(t);function j(o){t[8](o)}let R={label:"Resolved by Design"};t[2].policyConflictLog[t[0]].resolved!==void 0&&(R.value=t[2].policyConflictLog[t[0]].resolved),T=new Xe({props:R}),X.push(()=>ee(T,"value",j));function E(o){t[9](o)}let oe={label:"Commentary & Feedback"};return t[2].policyConflictLog[t[0]].notes!==void 0&&(oe.value=t[2].policyConflictLog[t[0]].notes),M=new Ye({props:oe}),X.push(()=>ee(M,"value",E)),{c(){e=K("div"),i=K("a"),n=te("Google StreetView"),m=B(),r=K("a"),c=te("Bing Streetside"),y=B(),q(p.$$.fragment),v=B(),q(a.$$.fragment),S=B(),q(w.$$.fragment),I=B(),f&&f.c(),N=B(),q(T.$$.fragment),O=B(),q(M.$$.fragment),this.h()},l(o){e=J(o,"DIV",{style:!0});var b=Y(e);i=J(b,"A",{href:!0,target:!0});var re=Y(i);n=ne(re,"Google StreetView"),re.forEach($),m=A(b),r=J(b,"A",{href:!0,target:!0});var se=Y(r);c=ne(se,"Bing Streetside"),se.forEach($),b.forEach($),y=A(o),z(p.$$.fragment,o),v=A(o),z(a.$$.fragment,o),S=A(o),z(w.$$.fragment,o),I=A(o),f&&f.l(o),N=A(o),z(T.$$.fragment,o),O=A(o),z(M.$$.fragment,o),this.h()},h(){F(i,"href",l=ye(t[2].policyConflictLog[t[0]].point)),F(i,"target","_blank"),F(r,"href",s=ke(t[2].policyConflictLog[t[0]].point)),F(r,"target","_blank"),le(e,"display","flex"),le(e,"justify-content","space-evenly")},m(o,b){C(o,e,b),G(e,i),G(i,n),G(e,m),G(e,r),G(r,c),C(o,y,b),H(p,o,b),C(o,v,b),H(a,o,b),C(o,S,b),H(w,o,b),C(o,I,b),f&&f.m(o,b),C(o,N,b),H(T,o,b),C(o,O,b),H(M,o,b),U=!0},p(o,[b]){(!U||b&5&&l!==(l=ye(o[2].policyConflictLog[o[0]].point)))&&F(i,"href",l),(!U||b&5&&s!==(s=ke(o[2].policyConflictLog[o[0]].point)))&&F(r,"href",s);const re={};!d&&b&5&&(d=!0,re.value=o[2].policyConflictLog[o[0]].conflict,x(()=>d=!1)),p.$set(re);const se={};!u&&b&5&&(u=!0,se.value=o[2].policyConflictLog[o[0]].stage,x(()=>u=!1)),a.$set(se);const ge={};!g&&b&5&&(g=!0,ge.value=o[2].policyConflictLog[o[0]].locationName,x(()=>g=!1)),w.$set(ge),o[1]&&o[1]!="Loading"&&o[1]!=o[2].policyConflictLog[o[0]].locationName?f?(f.p(o,b),b&7&&k(f,1)):(f=je(o),f.c(),k(f,1),f.m(N.parentNode,N)):f&&(ce(),L(f,1,1,()=>{f=null}),me());const de={};!Z&&b&5&&(Z=!0,de.value=o[2].policyConflictLog[o[0]].resolved,x(()=>Z=!1)),T.$set(de);const he={};!D&&b&5&&(D=!0,he.value=o[2].policyConflictLog[o[0]].notes,x(()=>D=!1)),M.$set(he)},i(o){U||(k(p.$$.fragment,o),k(a.$$.fragment,o),k(w.$$.fragment,o),k(f),k(T.$$.fragment,o),k(M.$$.fragment,o),U=!0)},o(o){L(p.$$.fragment,o),L(a.$$.fragment,o),L(w.$$.fragment,o),L(f),L(T.$$.fragment,o),L(M.$$.fragment,o),U=!1},d(o){o&&($(e),$(y),$(v),$(S),$(I),$(N),$(O)),P(p,o),P(a,o),P(w,o),f&&f.d(o),P(T,o),P(M,o)}}}function Dt(t,e,i){let n;De(t,W,u=>i(2,n=u));let{idx:l}=e,m=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]],r="Loading";Be(async()=>{await c(n.policyConflictLog[l].point)});async function c(u){let S=`https://nominatim.openstreetmap.org/reverse?lon=${u[0]}&lat=${u[1]}&format=json`;try{let g=await(await fetch(S)).json();i(1,r=g.address.road??g.display_name)}catch(w){return console.log(`Location lookup failed: ${w}`),""}}function s(){ve(W,n.policyConflictLog[l].locationName=r,n)}function y(u){t.$$.not_equal(n.policyConflictLog[l].conflict,u)&&(n.policyConflictLog[l].conflict=u,W.set(n))}function p(u){t.$$.not_equal(n.policyConflictLog[l].stage,u)&&(n.policyConflictLog[l].stage=u,W.set(n))}function d(u){t.$$.not_equal(n.policyConflictLog[l].locationName,u)&&(n.policyConflictLog[l].locationName=u,W.set(n))}function v(u){t.$$.not_equal(n.policyConflictLog[l].resolved,u)&&(n.policyConflictLog[l].resolved=u,W.set(n))}function a(u){t.$$.not_equal(n.policyConflictLog[l].notes,u)&&(n.policyConflictLog[l].notes=u,W.set(n))}return t.$$set=u=>{"idx"in u&&i(0,l=u.idx)},[l,r,n,m,s,y,p,d,v,a]}class Bt extends we{constructor(e){super(),Le(this,e,Dt,Nt,Ce,{idx:0})}}const{window:At}=at;function qe(t,e,i){const n=t.slice();return n[29]=e[i],n[30]=e,n[31]=i,n}function ze(t,e,i){const n=t.slice();return n[32]=e[i],n[33]=e,n[31]=i,n}function He(t,e,i){const n=t.slice();return n[29]=e[i],n[31]=i,n}function Pe(t,e,i){const n=t.slice();return n[32]=e[i],n[31]=i,n}function Et(t){let e,i,n,l,m,r,c,s;e=new $t({props:{$$slots:{default:[jt]},$$scope:{ctx:t}}}),e.$on("click",t[20]),n=new mt({props:{$$slots:{default:[qt]},$$scope:{ctx:t}}}),n.$on("click",t[8]);const y=[Ht,zt],p=[];function d(v,a){return v[0].kind=="critical"?0:1}return m=d(t),r=p[m]=y[m](t),{c(){q(e.$$.fragment),i=B(),q(n.$$.fragment),l=B(),r.c(),c=Ee()},l(v){z(e.$$.fragment,v),i=A(v),z(n.$$.fragment,v),l=A(v),r.l(v),c=Ee()},m(v,a){H(e,v,a),C(v,i,a),H(n,v,a),C(v,l,a),p[m].m(v,a),C(v,c,a),s=!0},p(v,a){const u={};a[1]&32&&(u.$$scope={dirty:a,ctx:v}),e.$set(u);const S={};a[1]&32&&(S.$$scope={dirty:a,ctx:v}),n.$set(S);let w=m;m=d(v),m===w?p[m].p(v,a):(ce(),L(p[w],1,1,()=>{p[w]=null}),me(),r=p[m],r?r.p(v,a):(r=p[m]=y[m](v),r.c()),k(r,1),r.m(c.parentNode,c))},i(v){s||(k(e.$$.fragment,v),k(n.$$.fragment,v),k(r),s=!0)},o(v){L(e.$$.fragment,v),L(n.$$.fragment,v),L(r),s=!1},d(v){v&&($(i),$(l),$(c)),P(e,v),P(n,v),p[m].d(v)}}}function Mt(t){let e,i,n,l,m,r,c,s,y,p,d,v="Click the map to add a pin, or select a pin to fill out data",a,u,S="Critical Issues",w,g,I,N,T="Policy Conflicts",Z,O,M;e=new Ae({props:{$$slots:{default:[Pt]},$$scope:{ctx:t}}}),e.$on("click",t[11]),n=new pt({}),m=new gt({});let D=t[3]&&Ve(t);function U(_){t[13](_)}let ae={legend:"Create new pins",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};t[4]!==void 0&&(ae.value=t[4]),s=new dt({props:ae}),X.push(()=>ee(s,"value",U));let Q=fe(t[2].criticalIssues),h=[];for(let _=0;_<Q.length;_+=1)h[_]=Fe(Pe(t,Q,_));let ie=fe(t[2].policyConflictLog),V=[];for(let _=0;_<ie.length;_+=1)V[_]=Ge(He(t,ie,_));return{c(){q(e.$$.fragment),i=B(),q(n.$$.fragment),l=B(),q(m.$$.fragment),r=B(),D&&D.c(),c=B(),q(s.$$.fragment),p=B(),d=K("p"),d.textContent=v,a=B(),u=K("h3"),u.textContent=S,w=B(),g=K("ol");for(let _=0;_<h.length;_+=1)h[_].c();I=B(),N=K("h3"),N.textContent=T,Z=B(),O=K("ol");for(let _=0;_<V.length;_+=1)V[_].c()},l(_){z(e.$$.fragment,_),i=A(_),z(n.$$.fragment,_),l=A(_),z(m.$$.fragment,_),r=A(_),D&&D.l(_),c=A(_),z(s.$$.fragment,_),p=A(_),d=J(_,"P",{"data-svelte-h":!0}),Ie(d)!=="svelte-sv95ee"&&(d.textContent=v),a=A(_),u=J(_,"H3",{"data-svelte-h":!0}),Ie(u)!=="svelte-1qhh5xr"&&(u.textContent=S),w=A(_),g=J(_,"OL",{});var f=Y(g);for(let R=0;R<h.length;R+=1)h[R].l(f);f.forEach($),I=A(_),N=J(_,"H3",{"data-svelte-h":!0}),Ie(N)!=="svelte-eyxzjx"&&(N.textContent=T),Z=A(_),O=J(_,"OL",{});var j=Y(O);for(let R=0;R<V.length;R+=1)V[R].l(j);j.forEach($)},m(_,f){H(e,_,f),C(_,i,f),H(n,_,f),C(_,l,f),H(m,_,f),C(_,r,f),D&&D.m(_,f),C(_,c,f),H(s,_,f),C(_,p,f),C(_,d,f),C(_,a,f),C(_,u,f),C(_,w,f),C(_,g,f);for(let j=0;j<h.length;j+=1)h[j]&&h[j].m(g,null);C(_,I,f),C(_,N,f),C(_,Z,f),C(_,O,f);for(let j=0;j<V.length;j+=1)V[j]&&V[j].m(O,null);M=!0},p(_,f){const j={};f[1]&32&&(j.$$scope={dirty:f,ctx:_}),e.$set(j),_[3]?D?(D.p(_,f),f[0]&8&&k(D,1)):(D=Ve(_),D.c(),k(D,1),D.m(c.parentNode,c)):D&&(ce(),L(D,1,1,()=>{D=null}),me());const R={};if(!y&&f[0]&16&&(y=!0,R.value=_[4],x(()=>y=!1)),s.$set(R),f[0]&134){Q=fe(_[2].criticalIssues);let E;for(E=0;E<Q.length;E+=1){const oe=Pe(_,Q,E);h[E]?h[E].p(oe,f):(h[E]=Fe(oe),h[E].c(),h[E].m(g,null))}for(;E<h.length;E+=1)h[E].d(1);h.length=Q.length}if(f[0]&134){ie=fe(_[2].policyConflictLog);let E;for(E=0;E<ie.length;E+=1){const oe=He(_,ie,E);V[E]?V[E].p(oe,f):(V[E]=Ge(oe),V[E].c(),V[E].m(O,null))}for(;E<V.length;E+=1)V[E].d(1);V.length=ie.length}},i(_){M||(k(e.$$.fragment,_),k(n.$$.fragment,_),k(m.$$.fragment,_),k(D),k(s.$$.fragment,_),M=!0)},o(_){L(e.$$.fragment,_),L(n.$$.fragment,_),L(m.$$.fragment,_),L(D),L(s.$$.fragment,_),M=!1},d(_){_&&($(i),$(l),$(r),$(c),$(p),$(d),$(a),$(u),$(w),$(g),$(I),$(N),$(Z),$(O)),P(e,_),P(n,_),P(m,_),D&&D.d(_),P(s,_),$e(h,_),$e(V,_)}}}function jt(t){let e;return{c(){e=te("Save")},l(i){e=ne(i,"Save")},m(i,n){C(i,e,n)},d(i){i&&$(e)}}}function qt(t){let e;return{c(){e=te("Delete")},l(i){e=ne(i,"Delete")},m(i,n){C(i,e,n)},d(i){i&&$(e)}}}function zt(t){let e,i;return e=new Bt({props:{idx:t[0].idx}}),{c(){q(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){H(e,n,l),i=!0},p(n,l){const m={};l[0]&1&&(m.idx=n[0].idx),e.$set(m)},i(n){i||(k(e.$$.fragment,n),i=!0)},o(n){L(e.$$.fragment,n),i=!1},d(n){P(e,n)}}}function Ht(t){let e,i;return e=new St({props:{idx:t[0].idx}}),{c(){q(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){H(e,n,l),i=!0},p(n,l){const m={};l[0]&1&&(m.idx=n[0].idx),e.$set(m)},i(n){i||(k(e.$$.fragment,n),i=!0)},o(n){L(e.$$.fragment,n),i=!1},d(n){P(e,n)}}}function Pt(t){let e;return{c(){e=te("Zoom to fit")},l(i){e=ne(i,"Zoom to fit")},m(i,n){C(i,e,n)},d(i){i&&$(e)}}}function Ve(t){let e,i,n;function l(r){t[12](r)}let m={map:t[3]};return t[5]!==void 0&&(m.enabled=t[5]),e=new ht({props:m}),X.push(()=>ee(e,"enabled",l)),{c(){q(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,c){H(e,r,c),n=!0},p(r,c){const s={};c[0]&8&&(s.map=r[3]),!i&&c[0]&32&&(i=!0,s.enabled=r[5],x(()=>i=!1)),e.$set(s)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){P(e,r)}}}function Fe(t){let e,i,n=Re(t[32])+"",l,m,r,c;function s(){return t[14](t[31])}function y(){return t[15](t[31])}return{c(){e=K("li"),i=K("a"),l=te(n),m=B(),this.h()},l(p){e=J(p,"LI",{});var d=Y(e);i=J(d,"A",{href:!0});var v=Y(i);l=ne(v,n),v.forEach($),m=A(d),d.forEach($),this.h()},h(){F(i,"href","#")},m(p,d){C(p,e,d),G(e,i),G(i,l),G(e,m),r||(c=[ue(i,"click",s),ue(i,"mouseenter",y),ue(i,"mouseleave",t[16])],r=!0)},p(p,d){t=p,d[0]&4&&n!==(n=Re(t[32])+"")&&pe(l,n)},d(p){p&&$(e),r=!1,Ke(c)}}}function Ge(t){let e,i,n=Ue(t[29])+"",l,m,r,c;function s(){return t[17](t[31])}function y(){return t[18](t[31])}return{c(){e=K("li"),i=K("a"),l=te(n),m=B(),this.h()},l(p){e=J(p,"LI",{});var d=Y(e);i=J(d,"A",{href:!0});var v=Y(i);l=ne(v,n),v.forEach($),m=A(d),d.forEach($),this.h()},h(){F(i,"href","#")},m(p,d){C(p,e,d),G(e,i),G(i,l),G(e,m),r||(c=[ue(i,"click",s),ue(i,"mouseenter",y),ue(i,"mouseleave",t[19])],r=!0)},p(p,d){t=p,d[0]&4&&n!==(n=Ue(t[29])+"")&&pe(l,n)},d(p){p&&$(e),r=!1,Ke(c)}}}function Vt(t){let e,i,n,l=t[32].criticalIssue+"",m;return{c(){e=Se("svg"),i=Se("polygon"),n=Se("text"),m=te(l),this.h()},l(r){e=Te(r,"svg",{width:!0,height:!0,xmlns:!0});var c=Y(e);i=Te(c,"polygon",{points:!0,fill:!0,class:!0}),Y(i).forEach($),n=Te(c,"text",{x:!0,y:!0});var s=Y(n);m=ne(s,l),s.forEach($),c.forEach($),this.h()},h(){F(i,"points","20,0 0,40 40,40"),F(i,"fill",ut.critical.background),F(i,"class","svelte-996go8"),F(n,"x","13"),F(n,"y","30"),le(n,"fill","white"),F(e,"width","40"),F(e,"height","40"),F(e,"xmlns","http://www.w3.org/2000/svg")},m(r,c){C(r,e,c),G(e,i),G(e,n),G(n,m)},p(r,c){c[0]&4&&l!==(l=r[32].criticalIssue+"")&&pe(m,l)},d(r){r&&$(e)}}}function Oe(t){let e,i,n;function l(s){t[21](s,t[32])}function m(){return t[22](t[31])}function r(){return t[23](t[31])}let c={draggable:!0,$$slots:{default:[Vt]},$$scope:{ctx:t}};return t[32].point!==void 0&&(c.lngLat=t[32].point),e=new Qe({props:c}),X.push(()=>ee(e,"lngLat",l)),e.$on("click",m),e.$on("dragend",r),{c(){q(e.$$.fragment)},l(s){z(e.$$.fragment,s)},m(s,y){H(e,s,y),n=!0},p(s,y){t=s;const p={};y[0]&4|y[1]&32&&(p.$$scope={dirty:y,ctx:t}),!i&&y[0]&4&&(i=!0,p.lngLat=t[32].point,x(()=>i=!1)),e.$set(p)},i(s){n||(k(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){P(e,s)}}}function Ft(t){let e,i=t[29].conflict+"",n;return{c(){e=K("span"),n=te(i),this.h()},l(l){e=J(l,"SPAN",{class:!0});var m=Y(e);n=ne(m,i),m.forEach($),this.h()},h(){F(e,"class","dot svelte-996go8"),le(e,"background",ct)},m(l,m){C(l,e,m),G(e,n)},p(l,m){m[0]&4&&i!==(i=l[29].conflict+"")&&pe(n,i)},d(l){l&&$(e)}}}function We(t){let e,i,n;function l(s){t[24](s,t[29])}function m(){return t[25](t[31])}function r(){return t[26](t[31])}let c={draggable:!0,$$slots:{default:[Ft]},$$scope:{ctx:t}};return t[29].point!==void 0&&(c.lngLat=t[29].point),e=new Qe({props:c}),X.push(()=>ee(e,"lngLat",l)),e.$on("click",m),e.$on("dragend",r),{c(){q(e.$$.fragment)},l(s){z(e.$$.fragment,s)},m(s,y){H(e,s,y),n=!0},p(s,y){t=s;const p={};y[0]&4|y[1]&32&&(p.$$scope={dirty:y,ctx:t}),!i&&y[0]&4&&(i=!0,p.lngLat=t[29].point,x(()=>i=!1)),e.$set(p)},i(s){n||(k(e.$$.fragment,s),n=!0)},o(s){L(e.$$.fragment,s),n=!1},d(s){P(e,s)}}}function Gt(t){let e,i;return e=new Ct({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){q(e.$$.fragment)},l(n){z(e.$$.fragment,n)},m(n,l){H(e,n,l),i=!0},p:lt,i(n){i||(k(e.$$.fragment,n),i=!0)},o(n){L(e.$$.fragment,n),i=!1},d(n){P(e,n)}}}function Ot(t){let e,i,n,l,m,r,c=fe(t[2].criticalIssues),s=[];for(let a=0;a<c.length;a+=1)s[a]=Oe(ze(t,c,a));const y=a=>L(s[a],1,1,()=>{s[a]=null});let p=fe(t[2].policyConflictLog),d=[];for(let a=0;a<p.length;a+=1)d[a]=We(qe(t,p,a));const v=a=>L(d[a],1,1,()=>{d[a]=null});return n=new ft({props:{data:t[6],$$slots:{default:[Gt]},$$scope:{ctx:t}}}),m=new vt({props:{map:t[3]}}),{c(){for(let a=0;a<s.length;a+=1)s[a].c();e=B();for(let a=0;a<d.length;a+=1)d[a].c();i=B(),q(n.$$.fragment),l=B(),q(m.$$.fragment)},l(a){for(let u=0;u<s.length;u+=1)s[u].l(a);e=A(a);for(let u=0;u<d.length;u+=1)d[u].l(a);i=A(a),z(n.$$.fragment,a),l=A(a),z(m.$$.fragment,a)},m(a,u){for(let S=0;S<s.length;S+=1)s[S]&&s[S].m(a,u);C(a,e,u);for(let S=0;S<d.length;S+=1)d[S]&&d[S].m(a,u);C(a,i,u),H(n,a,u),C(a,l,u),H(m,a,u),r=!0},p(a,u){if(u[0]&132){c=fe(a[2].criticalIssues);let g;for(g=0;g<c.length;g+=1){const I=ze(a,c,g);s[g]?(s[g].p(I,u),k(s[g],1)):(s[g]=Oe(I),s[g].c(),k(s[g],1),s[g].m(e.parentNode,e))}for(ce(),g=c.length;g<s.length;g+=1)y(g);me()}if(u[0]&132){p=fe(a[2].policyConflictLog);let g;for(g=0;g<p.length;g+=1){const I=qe(a,p,g);d[g]?(d[g].p(I,u),k(d[g],1)):(d[g]=We(I),d[g].c(),k(d[g],1),d[g].m(i.parentNode,i))}for(ce(),g=p.length;g<d.length;g+=1)v(g);me()}const S={};u[0]&64&&(S.data=a[6]),u[1]&32&&(S.$$scope={dirty:u,ctx:a}),n.$set(S);const w={};u[0]&8&&(w.map=a[3]),m.$set(w)},i(a){if(!r){for(let u=0;u<c.length;u+=1)k(s[u]);for(let u=0;u<p.length;u+=1)k(d[u]);k(n.$$.fragment,a),k(m.$$.fragment,a),r=!0}},o(a){s=s.filter(Boolean);for(let u=0;u<s.length;u+=1)L(s[u]);d=d.filter(Boolean);for(let u=0;u<d.length;u+=1)L(d[u]);L(n.$$.fragment,a),L(m.$$.fragment,a),r=!1},d(a){a&&($(e),$(i),$(l)),$e(s,a),$e(d,a),P(n,a),P(m,a)}}}function Wt(t){let e,i,n,l,m,r,c,s,y,p,d;const v=[Mt,Et],a=[];function u(g,I){return g[0]==null?0:1}n=u(t),l=a[n]=v[n](t);function S(g){t[27](g)}let w={$$slots:{default:[Ot]},$$scope:{ctx:t}};return t[3]!==void 0&&(w.map=t[3]),c=new st({props:w}),X.push(()=>ee(c,"map",S)),{c(){e=K("div"),i=K("div"),l.c(),m=B(),r=K("div"),q(c.$$.fragment),this.h()},l(g){e=J(g,"DIV",{style:!0});var I=Y(e);i=J(I,"DIV",{style:!0});var N=Y(i);l.l(N),N.forEach($),m=A(I),r=J(I,"DIV",{style:!0});var T=Y(r);z(c.$$.fragment,T),T.forEach($),I.forEach($),this.h()},h(){le(i,"width","30%"),le(i,"overflow-y","scroll"),le(i,"padding","10px"),le(r,"position","relative"),le(r,"width","70%"),le(e,"display","flex"),le(e,"height","600px")},m(g,I){C(g,e,I),G(e,i),a[n].m(i,null),G(e,m),G(e,r),H(c,r,null),y=!0,p||(d=ue(At,"keydown",t[10]),p=!0)},p(g,I){let N=n;n=u(g),n===N?a[n].p(g,I):(ce(),L(a[N],1,1,()=>{a[N]=null}),me(),l=a[n],l?l.p(g,I):(l=a[n]=v[n](g),l.c()),k(l,1),l.m(i,null));const T={};I[0]&76|I[1]&32&&(T.$$scope={dirty:I,ctx:g}),!s&&I[0]&8&&(s=!0,T.map=g[3],x(()=>s=!1)),c.$set(T)},i(g){y||(k(l),k(c.$$.fragment,g),y=!0)},o(g){L(l),L(c.$$.fragment,g),y=!1},d(g){g&&$(e),a[n].d(),P(c),p=!1,d()}}}function Rt(t,e,i){let n={type:"FeatureCollection",features:[]},l=e??i;if(l!=null){let m=l.kind=="critical"?t.criticalIssues:t.policyConflictLog;n.features.push(Ne(m[l.idx].point))}return n}function Ne(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}}function Re(t){return`${t.criticalIssue||"Unknown critical"}: ${t.locationName||"???"}`}function Ue(t){return`${t.conflict||"Unknown conflict"}: ${t.locationName||"???"}`}function Ut(t,e,i){let n,l;De(t,W,f=>i(2,l=f));let m,r="critical",c=null,s=null,y=!1;function p(f){i(0,c=f),i(1,s=null)}function d(f){if(!y){if(c!=null){i(0,c=null);return}r=="critical"?(ve(W,l.criticalIssues=[...l.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:f.lngLat.toArray(),locationName:"",resolved:"",notes:""}],l),i(0,c={kind:"critical",idx:l.criticalIssues.length-1})):(ve(W,l.policyConflictLog=[...l.policyConflictLog,{id:"TODO",conflict:"",stage:"",point:f.lngLat.toArray(),locationName:"",resolved:"",notes:""}],l),i(0,c={kind:"conflict",idx:l.policyConflictLog.length-1})),i(1,s=null)}}Be(()=>{m.on("click",d),a()}),it(()=>{m.off("click",d)});function v(){window.confirm("Delete this entry?")&&(c.kind=="critical"?(l.criticalIssues.splice(c.idx,1),W.set(l)):(l.policyConflictLog.splice(c.idx,1),W.set(l)),i(0,c=null))}function a(f){let j={type:"FeatureCollection",features:[...l.criticalIssues.map(R=>Ne(R.point)),...l.policyConflictLog.map(R=>Ne(R.point))]};j.features.length>0&&m.fitBounds(_t(j),{padding:20,animate:!0})}function u(f){c!=null&&f.key=="Escape"?(f.stopPropagation(),i(0,c=null)):c!=null&&f.key=="Delete"&&v()}const S=()=>a();function w(f){y=f,i(5,y)}function g(f){r=f,i(4,r)}const I=f=>p({kind:"critical",idx:f}),N=f=>i(1,s={kind:"critical",idx:f}),T=()=>i(1,s=null),Z=f=>p({kind:"conflict",idx:f}),O=f=>i(1,s={kind:"conflict",idx:f}),M=()=>i(1,s=null),D=()=>i(0,c=null);function U(f,j){t.$$.not_equal(j.point,f)&&(j.point=f,W.set(l))}const ae=f=>p({kind:"critical",idx:f}),Q=f=>p({kind:"critical",idx:f});function h(f,j){t.$$.not_equal(j.point,f)&&(j.point=f,W.set(l))}const ie=f=>p({kind:"conflict",idx:f}),V=f=>p({kind:"conflict",idx:f});function _(f){m=f,i(3,m)}return t.$$.update=()=>{t.$$.dirty[0]&7&&i(6,n=Rt(l,c,s))},[c,s,l,m,r,y,n,p,v,a,u,S,w,g,I,N,T,Z,O,M,D,U,ae,Q,h,ie,V,_]}class an extends we{constructor(e){super(),Le(this,e,Ut,Wt,Ce,{},null,[-1,-1])}}export{an as component};
