import{s as oe,R as H,S as Q,b as V,f as w,r as D,i as A,h as q,n as R,v as T,e as O,a as B,c as P,g as C,w as F,x as W,q as ae,k as pe,U as me,a8 as $e,t as le,d as se,M as ge}from"../chunks/scheduler.d-ZThAIN.js";import{S as ie,i as fe,e as Z,c as y,a as j,m as S,t as b,f as ue,b as k,d as M,g as ce}from"../chunks/index.BKLGIcjh.js";import{e as J}from"../chunks/each.5I2k8VTY.js";import{p as X}from"../chunks/index.R2MjMSdN.js";import{c as _e}from"../chunks/colors.B_b9C5xD.js";import{S as he,W as de}from"../chunks/WarningButton.CXBTrJR0.js";import{S as Y}from"../chunks/Select.DYDTV9Cm.js";import{T as ve}from"../chunks/TextInput.DLFUCrlZ.js";import{B as be,G as ke,b as we,a as Le,M as x}from"../chunks/GeoreferenceLayer.9a2G4un5.js";import{M as ye,G as je}from"../chunks/MapLibreMap.wUSntUEv.js";import{L as Se}from"../chunks/LineLayer.CPHfNEyN.js";import{s as N}from"../chunks/data.C6NqCBaE.js";function Me(r){let e,n;return{c(){e=H("svg"),n=H("polygon"),this.h()},l(t){e=Q(t,"svg",{width:!0,height:!0,xmlns:!0});var l=V(e);n=Q(l,"polygon",{points:!0,fill:!0,class:!0}),V(n).forEach(w),l.forEach(w),this.h()},h(){D(n,"points","15,0 0,30 30,30"),D(n,"fill",r[0]),D(n,"class","svelte-19rpncr"),D(e,"width","30"),D(e,"height","30"),D(e,"xmlns","http://www.w3.org/2000/svg")},m(t,l){A(t,e,l),q(e,n)},p(t,[l]){l&1&&D(n,"fill",t[0])},i:R,o:R,d(t){t&&w(e)}}}function Ee(r,e,n){let{color:t}=e;return r.$$set=l=>{"color"in l&&n(0,t=l.color)},[t]}class qe extends ie{constructor(e){super(),fe(this,e,Ee,Me,oe,{color:0})}}function ee(r,e,n){const t=r.slice();return t[16]=e[n],t[17]=e,t[18]=n,t}function te(r,e,n){const t=r.slice();return t[16]=e[n],t[19]=e,t[20]=n,t}function Be(r){let e;return{c(){e=le("Zoom to fit")},l(n){e=se(n,"Zoom to fit")},m(n,t){A(n,e,t)},d(n){n&&w(e)}}}function Ce(r){let e;return{c(){e=le("Delete")},l(n){e=se(n,"Delete")},m(n,t){A(n,e,t)},d(n){n&&w(e)}}}function ne(r){let e,n,t,l,m,h,f,d,a,u,s,g,$;function L(i){r[8](i,r[16])}let E={label:"Name"};r[16].name!==void 0&&(E.value=r[16].name),n=new ve({props:E}),T.push(()=>Z(n,"value",L));function _(i){r[9](i,r[16])}let K={label:"Kind",choices:r[2]};r[16].kind!==void 0&&(K.value=r[16].kind),m=new Y({props:K}),T.push(()=>Z(m,"value",_));function z(i){r[10](i,r[16])}let c={label:"Color",choices:r[3]};r[16].color!==void 0&&(c.value=r[16].color),d=new Y({props:c}),T.push(()=>Z(d,"value",z));function o(){return r[11](r[20])}return s=new de({props:{$$slots:{default:[Ce]},$$scope:{ctx:r}}}),s.$on("click",o),{c(){e=O("li"),y(n.$$.fragment),l=B(),y(m.$$.fragment),f=B(),y(d.$$.fragment),u=B(),y(s.$$.fragment),g=B()},l(i){e=P(i,"LI",{});var p=V(e);j(n.$$.fragment,p),l=C(p),j(m.$$.fragment,p),f=C(p),j(d.$$.fragment,p),u=C(p),j(s.$$.fragment,p),g=C(p),p.forEach(w)},m(i,p){A(i,e,p),S(n,e,null),q(e,l),S(m,e,null),q(e,f),S(d,e,null),q(e,u),S(s,e,null),q(e,g),$=!0},p(i,p){r=i;const G={};!t&&p&2&&(t=!0,G.value=r[16].name,W(()=>t=!1)),n.$set(G);const v={};!h&&p&2&&(h=!0,v.value=r[16].kind,W(()=>h=!1)),m.$set(v);const I={};!a&&p&2&&(a=!0,I.value=r[16].color,W(()=>a=!1)),d.$set(I);const U={};p&2097152&&(U.$$scope={dirty:p,ctx:r}),s.$set(U)},i(i){$||(b(n.$$.fragment,i),b(m.$$.fragment,i),b(d.$$.fragment,i),b(s.$$.fragment,i),$=!0)},o(i){k(n.$$.fragment,i),k(m.$$.fragment,i),k(d.$$.fragment,i),k(s.$$.fragment,i),$=!1},d(i){i&&w(e),M(n),M(m),M(d),M(s)}}}function De(r){let e,n;return{c(){e=O("span"),this.h()},l(t){e=P(t,"SPAN",{class:!0,style:!0}),V(e).forEach(w),this.h()},h(){D(e,"class","dot svelte-1tmbx1c"),D(e,"style",n=`background-color: ${r[16].color}`)},m(t,l){A(t,e,l)},p(t,l){l&2&&n!==(n=`background-color: ${t[16].color}`)&&D(e,"style",n)},d(t){t&&w(e)}}}function Ge(r){let e,n;return e=new qe({props:{color:r[16].color}}),{c(){y(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,l){S(e,t,l),n=!0},p(t,l){const m={};l&2&&(m.color=t[16].color),e.$set(m)},i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function re(r){let e,n,t,l,m,h;function f(s){r[12](s,r[16])}let d={draggable:!0,$$slots:{default:[De]},$$scope:{ctx:r}};r[16].point1!==void 0&&(d.lngLat=r[16].point1),e=new x({props:d}),T.push(()=>Z(e,"lngLat",f));function a(s){r[13](s,r[16])}let u={draggable:!0,$$slots:{default:[Ge]},$$scope:{ctx:r}};return r[16].point2!==void 0&&(u.lngLat=r[16].point2),l=new x({props:u}),T.push(()=>Z(l,"lngLat",a)),{c(){y(e.$$.fragment),t=B(),y(l.$$.fragment)},l(s){j(e.$$.fragment,s),t=C(s),j(l.$$.fragment,s)},m(s,g){S(e,s,g),A(s,t,g),S(l,s,g),h=!0},p(s,g){r=s;const $={};g&2097154&&($.$$scope={dirty:g,ctx:r}),!n&&g&2&&(n=!0,$.lngLat=r[16].point1,W(()=>n=!1)),e.$set($);const L={};g&2097154&&(L.$$scope={dirty:g,ctx:r}),!m&&g&2&&(m=!0,L.lngLat=r[16].point2,W(()=>m=!1)),l.$set(L)},i(s){h||(b(e.$$.fragment,s),b(l.$$.fragment,s),h=!0)},o(s){k(e.$$.fragment,s),k(l.$$.fragment,s),h=!1},d(s){s&&w(t),M(e,s),M(l,s)}}}function Ie(r){let e,n;return e=new Se({props:{paint:{"line-width":6,"line-color":["get","color"]}}}),{c(){y(e.$$.fragment)},l(t){j(e.$$.fragment,t)},m(t,l){S(e,t,l),n=!0},p:R,i(t){n||(b(e.$$.fragment,t),n=!0)},o(t){k(e.$$.fragment,t),n=!1},d(t){M(e,t)}}}function Ae(r){let e,n,t,l,m,h=J(r[1].jat.movements),f=[];for(let a=0;a<h.length;a+=1)f[a]=re(ee(r,h,a));const d=a=>k(f[a],1,1,()=>{f[a]=null});return n=new je({props:{data:r[4](r[1].jat.movements),$$slots:{default:[Ie]},$$scope:{ctx:r}}}),l=new Le({props:{map:r[0]}}),{c(){for(let a=0;a<f.length;a+=1)f[a].c();e=B(),y(n.$$.fragment),t=B(),y(l.$$.fragment)},l(a){for(let u=0;u<f.length;u+=1)f[u].l(a);e=C(a),j(n.$$.fragment,a),t=C(a),j(l.$$.fragment,a)},m(a,u){for(let s=0;s<f.length;s+=1)f[s]&&f[s].m(a,u);A(a,e,u),S(n,a,u),A(a,t,u),S(l,a,u),m=!0},p(a,u){if(u&2){h=J(a[1].jat.movements);let $;for($=0;$<h.length;$+=1){const L=ee(a,h,$);f[$]?(f[$].p(L,u),b(f[$],1)):(f[$]=re(L),f[$].c(),b(f[$],1),f[$].m(e.parentNode,e))}for(ce(),$=h.length;$<f.length;$+=1)d($);ue()}const s={};u&2&&(s.data=a[4](a[1].jat.movements)),u&2097152&&(s.$$scope={dirty:u,ctx:a}),n.$set(s);const g={};u&1&&(g.map=a[0]),l.$set(g)},i(a){if(!m){for(let u=0;u<h.length;u+=1)b(f[u]);b(n.$$.fragment,a),b(l.$$.fragment,a),m=!0}},o(a){f=f.filter(Boolean);for(let u=0;u<f.length;u+=1)k(f[u]);k(n.$$.fragment,a),k(l.$$.fragment,a),m=!1},d(a){a&&(w(e),w(t)),ae(f,a),M(n,a),M(l,a)}}}function Ne(r){let e,n,t,l,m,h,f,d,a,u,s,g,$,L;t=new he({props:{$$slots:{default:[Be]},$$scope:{ctx:r}}}),t.$on("click",r[7]),m=new be({}),f=new ke({});let E=J(r[1].jat.movements),_=[];for(let o=0;o<E.length;o+=1)_[o]=ne(te(r,E,o));const K=o=>k(_[o],1,1,()=>{_[o]=null});function z(o){r[14](o)}let c={$$slots:{default:[Ae]},$$scope:{ctx:r}};return r[0]!==void 0&&(c.map=r[0]),g=new ye({props:c}),T.push(()=>Z(g,"map",z)),{c(){e=O("div"),n=O("div"),y(t.$$.fragment),l=B(),y(m.$$.fragment),h=B(),y(f.$$.fragment),d=B(),a=O("ol");for(let o=0;o<_.length;o+=1)_[o].c();u=B(),s=O("div"),y(g.$$.fragment),this.h()},l(o){e=P(o,"DIV",{style:!0});var i=V(e);n=P(i,"DIV",{style:!0});var p=V(n);j(t.$$.fragment,p),l=C(p),j(m.$$.fragment,p),h=C(p),j(f.$$.fragment,p),d=C(p),a=P(p,"OL",{});var G=V(a);for(let I=0;I<_.length;I+=1)_[I].l(G);G.forEach(w),p.forEach(w),u=C(i),s=P(i,"DIV",{style:!0});var v=V(s);j(g.$$.fragment,v),v.forEach(w),i.forEach(w),this.h()},h(){F(n,"width","30%"),F(n,"overflow-y","scroll"),F(n,"padding","10px"),F(s,"position","relative"),F(s,"width","100%"),F(e,"display","flex"),F(e,"height","600px")},m(o,i){A(o,e,i),q(e,n),S(t,n,null),q(n,l),S(m,n,null),q(n,h),S(f,n,null),q(n,d),q(n,a);for(let p=0;p<_.length;p+=1)_[p]&&_[p].m(a,null);q(e,u),q(e,s),S(g,s,null),L=!0},p(o,[i]){const p={};if(i&2097152&&(p.$$scope={dirty:i,ctx:o}),t.$set(p),i&46){E=J(o[1].jat.movements);let v;for(v=0;v<E.length;v+=1){const I=te(o,E,v);_[v]?(_[v].p(I,i),b(_[v],1)):(_[v]=ne(I),_[v].c(),b(_[v],1),_[v].m(a,null))}for(ce(),v=E.length;v<_.length;v+=1)K(v);ue()}const G={};i&2097155&&(G.$$scope={dirty:i,ctx:o}),!$&&i&1&&($=!0,G.map=o[0],W(()=>$=!1)),g.$set(G)},i(o){if(!L){b(t.$$.fragment,o),b(m.$$.fragment,o),b(f.$$.fragment,o);for(let i=0;i<E.length;i+=1)b(_[i]);b(g.$$.fragment,o),L=!0}},o(o){k(t.$$.fragment,o),k(m.$$.fragment,o),k(f.$$.fragment,o),_=_.filter(Boolean);for(let i=0;i<_.length;i+=1)k(_[i]);k(g.$$.fragment,o),L=!1},d(o){o&&w(e),M(t),M(m),M(f),ae(_,o),M(g)}}}function Ve(r,e,n){let t;pe(r,N,c=>n(1,t=c));let l,m=X(["cycling-straight","cycling-turn","pedestrian"]),h=X(["green","amber","red","critical"]);function f(c){ge(N,t.jat.movements=[...t.jat.movements,{point1:c.lngLat.toArray(),point2:c.lngLat.toArray(),kind:"cycling-straight",color:"green",name:"",notes:""}],t)}me(()=>{l.on("click",f),u(!1)}),$e(()=>{l.off("click",f)});function d(c){return{type:"FeatureCollection",features:c.map(o=>({type:"Feature",properties:{kind:o.kind,color:_e[o.color].background},geometry:{type:"LineString",coordinates:[o.point1,o.point2]}}))}}function a(c){t.jat.movements.splice(c,1),N.set(t)}function u(c){t.jat.movements.length>0&&l.fitBounds(we(d(t.jat.movements)),{padding:20,animate:c})}const s=()=>u(!0);function g(c,o){r.$$.not_equal(o.name,c)&&(o.name=c,N.set(t))}function $(c,o){r.$$.not_equal(o.kind,c)&&(o.kind=c,N.set(t))}function L(c,o){r.$$.not_equal(o.color,c)&&(o.color=c,N.set(t))}const E=c=>a(c);function _(c,o){r.$$.not_equal(o.point1,c)&&(o.point1=c,N.set(t))}function K(c,o){r.$$.not_equal(o.point2,c)&&(o.point2=c,N.set(t))}function z(c){l=c,n(0,l)}return[l,t,m,h,d,a,u,s,g,$,L,E,_,K,z]}class Qe extends ie{constructor(e){super(),fe(this,e,Ve,Ne,oe,{})}}export{Qe as component};
