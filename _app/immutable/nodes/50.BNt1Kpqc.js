import{s as N,e as J,a as v,c as F,m as A,g as k,i as g,f as C,k as E,t as D,d as M}from"../chunks/scheduler.D-L5_EKR.js";import{S as B,i as H,c as w,a as S,m as _,t as b,b as L,d as P}from"../chunks/index.DlIJmOlE.js";import{e as O}from"../chunks/da_log.RErDbOgf.js";import{c as V,s as G}from"../chunks/data.DrS79xns.js";import{D as U}from"../chunks/DefaultButton.UUTmMvUR.js";/* empty css                                                               */import{T as I}from"../chunks/TextArea.2b1Cppq0.js";import{E as q}from"../chunks/exceljs.min.BuyXGIGS.js";import{g as X,a as z}from"../chunks/lists.djxH55N_.js";import{d as Q}from"../chunks/index.CgyBQtog.js";const Y=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function Z(e,a){console.log("Loading blank route check xlsx");let o=await(await fetch(Y)).arrayBuffer(),l=new q.Workbook;await l.xlsx.load(o),l.eachSheet((n,i)=>{n.conditionalFormattings=[]}),ee(e,l),te(e,l),le(e,l),oe(e,l),y(e.safetyCheck,l,"3.1 Safety Check",["J","K","L","M"],$([[13,28]])),y(e.streetCheck,l,"4.1 Street Check",["J","K","L","M"],$([[13,19],[23,25],[29,34],[38,43],[47,50]])),y(e.streetPlacemakingCheck,l,"4.2 Street Placemaking Check",["I","J","K","L"],$([[13,15],[19,21],[25,34],[38,47]])),y(e.pathCheck,l,"5.1 Path Check",["J","K","L","M"],$([[15,19],[23,33],[37,40],[44,48],[52,56]])),y(e.pathPlacemakingCheck,l,"5.2 Path Placemaking Check",["I","J","K","L"],$([[12,14],[20,22],[26,29],[33,41]])),ae(e,l),l.getWorksheet("5.1 Path Check").getCell("D7").value=e.horseRiders,l.getWorksheet("7.1 Results Summary").getCell("G7").value=e.resultsReviewStatement,console.log("Writing route check xlsx");let s=await l.xlsx.writeBuffer();Q(s,`route_check_${a}.xlsx`)}function ee(e,a){let t=a.getWorksheet("1. Summary of Scheme");t.getCell("C6").value=e.summary.dateDesignReview,t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.assessedRouteLengthKm,t.getCell("C19").value=e.summary.totalRouteLengthKm,t.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(t.getCell("D22").value="Path Check")}function te(e,a){let t=a.getWorksheet("2.1 Policy Check");for(let o=0;o<6;o++)t.getCell("D"+(8+o)).value=e.policyCheck[o].existing,t.getCell("E"+(8+o)).value=e.policyCheck[o].proposed,t.getCell("F"+(8+o)).value=e.policyCheck[o].commentary}function le(e,a){let t=a.getWorksheet("2.2 Policy Conflict Log");for(let[o,l]of e.policyConflictLog.entries())t.getCell("F"+(8+o)).value=X(l.conflict),t.getCell("H"+(8+o)).value=l.stage,t.getCell("I"+(8+o)).value=R(l.point),t.getCell("J"+(8+o)).value=l.locationName,t.getCell("K"+(8+o)).value=l.resolved,t.getCell("L"+(8+o)).value=l.notes}function oe(e,a){let t=a.getWorksheet("3.2 Critical Issues Log");for(let[o,l]of e.criticalIssues.entries())t.getCell("F"+(8+o)).value=z(l.criticalIssue),t.getCell("H"+(8+o)).value=l.stage,t.getCell("I"+(8+o)).value=R(l.point),t.getCell("J"+(8+o)).value=l.locationName,t.getCell("K"+(8+o)).value=l.resolved,t.getCell("L"+(8+o)).value=l.notes}function y(e,a,t,o,l){let s=a.getWorksheet(t);if(l.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${t}`);for(let n=0;n<e.existingScores.length;n++){let i=l[n];s.getCell(o[0]+i).value=j(e.existingScores[n]),s.getCell(o[1]+i).value=e.existingScoreNotes[n],s.getCell(o[2]+i).value=j(e.proposedScores[n]),s.getCell(o[3]+i).value=e.proposedScoreNotes[n]}}function ae(e,a){let t=a.getWorksheet("6. JAT Check"),o=0;for(let l of e.jat)for(let s of[l.existing,l.proposed]){let n=h("H",o*5);t.getCell(h(n,1)+"9").value=l.name,t.getCell(h(n,1)+"10").value=s.notes;for(let[i,m]of s.movements.filter(u=>u.kind=="walking & wheeling").entries())t.getCell(n+(13+i)).value=m.name,t.getCell(h(n,2)+(13+i)).value=K(m.score),t.getCell(h(n,3)+(13+i)).value=m.notes;for(let[i,m]of s.movements.filter(u=>u.kind=="cycling").entries())t.getCell(n+(26+i)).value=m.name,t.getCell(h(n,2)+(26+i)).value=K(m.score),t.getCell(h(n,3)+(26+i)).value=m.notes;o++}}function h(e,a){return ne(re(e)+a)}function re(e){let a=0;for(let t=0;t<e.length;t++)a*=26,a+=e.charCodeAt(t)-65+1;return a-1}function ne(e){let a="";for(e+=1;e>0;){let t=(e-1)%26;a=String.fromCharCode(t+65)+a,e=Math.floor((e-1)/26)}return a}function $(e){let a=[];for(let[t,o]of e)for(let l=t;l<=o;l++)a.push(l);return a}function j(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function K(e){return{0:0,1:1,2:2,X:e}[e]}function R(e){return`${e[1]}, ${e[0]}`}function ie(e){let a;return{c(){a=D("Convert to .xlsx (takes a few seconds)")},l(t){a=M(t,"Convert to .xlsx (takes a few seconds)")},m(t,o){g(t,a,o)},d(t){t&&C(a)}}}function se(e){let a,t=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,o,l,s,n,i,m,u,f,d,p,T=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9</i>`,x;return l=new I({props:{label:"TSV output, just the one row of values",value:e[2]}}),n=new I({props:{label:"TSV output with header",value:`${e[1]}
${e[2]}
`}}),m=new I({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(e[0]),null,"  ")}}),f=new U({props:{$$slots:{default:[ie]},$$scope:{ctx:e}}}),f.$on("click",e[3]),{c(){a=J("p"),a.textContent=t,o=v(),w(l.$$.fragment),s=v(),w(n.$$.fragment),i=v(),w(m.$$.fragment),u=v(),w(f.$$.fragment),d=v(),p=J("p"),p.innerHTML=T},l(r){a=F(r,"P",{"data-svelte-h":!0}),A(a)!=="svelte-5ssfe3"&&(a.textContent=t),o=k(r),S(l.$$.fragment,r),s=k(r),S(n.$$.fragment,r),i=k(r),S(m.$$.fragment,r),u=k(r),S(f.$$.fragment,r),d=k(r),p=F(r,"P",{"data-svelte-h":!0}),A(p)!=="svelte-6hhtkc"&&(p.innerHTML=T)},m(r,c){g(r,a,c),g(r,o,c),_(l,r,c),g(r,s,c),_(n,r,c),g(r,i,c),_(m,r,c),g(r,u,c),_(f,r,c),g(r,d,c),g(r,p,c),x=!0},p(r,[c]){const W={};c&64&&(W.$$scope={dirty:c,ctx:r}),f.$set(W)},i(r){x||(b(l.$$.fragment,r),b(n.$$.fragment,r),b(m.$$.fragment,r),b(f.$$.fragment,r),x=!0)},o(r){L(l.$$.fragment,r),L(n.$$.fragment,r),L(m.$$.fragment,r),L(f.$$.fragment,r),x=!1},d(r){r&&(C(a),C(o),C(s),C(i),C(u),C(d),C(p)),P(l,r),P(n,r),P(m,r),P(f,r)}}}function ue(e,a,t){let o,l;E(e,V,u=>t(4,o=u)),E(e,G,u=>t(5,l=u));let s=O(l),n=s.map(u=>u[0]).join("	"),i=s.map(u=>`"${u[1]}"`).join("	");async function m(){try{await Z(l,o)}catch(u){window.alert(`Conversion failed: ${u}`)}}return[s,n,i,m]}class $e extends B{constructor(a){super(),H(this,a,ue,se,N,{})}}export{$e as component};
