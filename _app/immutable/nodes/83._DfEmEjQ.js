import{s as we,p as Y,e as U,t as le,a as D,c as z,b as J,d as ie,f as v,g as N,A as W,q as X,i as I,h as H,r as Z,k as Ce,C as Ke,V as Ue,w as Be,y as _e,x as ve,z as me,j as he,n as ze,R as be,S as ke}from"../chunks/scheduler.BJRqm_YT.js";import{S as Le,i as Ie,e as Q,c as q,a as j,m as M,t as C,b as S,d as P,f as ae,g as fe}from"../chunks/index.18SuDt2z.js";import{M as Je,b as Ye,G as Ze}from"../chunks/MapLibreMap.Ck6raeBt.js";import{e as se}from"../chunks/each.DzPajqWo.js";import{c as Qe,p as Xe}from"../chunks/colors.CYEpEtTL.js";import{p as Ge}from"../chunks/index.CLbx_zmS.js";import{S as ge}from"../chunks/Select.BZaUknG-.js";import{T as We}from"../chunks/TextArea.CDFsaoN6.js";import{T as Re}from"../chunks/TextInput.BDjywaHi.js";import{s as O}from"../chunks/data.BPwItbCw.js";import{s as $e,b as de,a as xe,R as et,B as tt,G as nt,M as lt,c as it,S as ot,d as Oe}from"../chunks/GeoreferenceLayer.BjR3prr7.js";import{Y as He}from"../chunks/YesNo.DS6SFX9K.js";import{C as rt}from"../chunks/CollapsibleCard.Cs5L5FHJ.js";import{D as st}from"../chunks/DefaultButton.DUqytxqy.js";import{S as Se}from"../chunks/SecondaryButton.2stnaXwc.js";import{W as at}from"../chunks/WarningButton.Dm1EdBVd.js";import{C as ft}from"../chunks/CircleLayer.CsINg6ln.js";function ct(t){let e,l,n,i,c,f,s,a,p,r,g,d,m,T,u,$,b,A,h,V,R,L,ee,F;function E(o){t[3](o)}let oe={label:"Critical Issue",emptyOption:!0,choices:t[2]};t[1].criticalIssues[t[0]].criticalIssue!==void 0&&(oe.value=t[1].criticalIssues[t[0]].criticalIssue),r=new ge({props:oe}),Y.push(()=>Q(r,"value",E));function _(o){t[4](o)}let y={label:"Stage",emptyOption:!0,choices:Ge(["Existing","Design"])};t[1].criticalIssues[t[0]].stage!==void 0&&(y.value=t[1].criticalIssues[t[0]].stage),m=new ge({props:y}),Y.push(()=>Q(m,"value",_));function G(o){t[5](o)}let K={label:"Location Name"};t[1].criticalIssues[t[0]].locationName!==void 0&&(K.value=t[1].criticalIssues[t[0]].locationName),$=new Re({props:K}),Y.push(()=>Q($,"value",G));function B(o){t[6](o)}let k={label:"Resolved by Design"};t[1].criticalIssues[t[0]].resolved!==void 0&&(k.value=t[1].criticalIssues[t[0]].resolved),h=new He({props:k}),Y.push(()=>Q(h,"value",B));function x(o){t[7](o)}let re={label:"Commentary & Feedback"};return t[1].criticalIssues[t[0]].notes!==void 0&&(re.value=t[1].criticalIssues[t[0]].notes),L=new We({props:re}),Y.push(()=>Q(L,"value",x)),{c(){e=U("div"),l=U("a"),n=le("Google StreetView"),c=D(),f=U("a"),s=le("Bing Streetside"),p=D(),q(r.$$.fragment),d=D(),q(m.$$.fragment),u=D(),q($.$$.fragment),A=D(),q(h.$$.fragment),R=D(),q(L.$$.fragment),this.h()},l(o){e=z(o,"DIV",{style:!0});var w=J(e);l=z(w,"A",{href:!0,target:!0});var te=J(l);n=ie(te,"Google StreetView"),te.forEach(v),c=N(w),f=z(w,"A",{href:!0,target:!0});var ne=J(f);s=ie(ne,"Bing Streetside"),ne.forEach(v),w.forEach(v),p=N(o),j(r.$$.fragment,o),d=N(o),j(m.$$.fragment,o),u=N(o),j($.$$.fragment,o),A=N(o),j(h.$$.fragment,o),R=N(o),j(L.$$.fragment,o),this.h()},h(){W(l,"href",i=$e(t[1].criticalIssues[t[0]].point)),W(l,"target","_blank"),W(f,"href",a=de(t[1].criticalIssues[t[0]].point)),W(f,"target","_blank"),X(e,"display","flex"),X(e,"justify-content","space-evenly")},m(o,w){I(o,e,w),H(e,l),H(l,n),H(e,c),H(e,f),H(f,s),I(o,p,w),M(r,o,w),I(o,d,w),M(m,o,w),I(o,u,w),M($,o,w),I(o,A,w),M(h,o,w),I(o,R,w),M(L,o,w),F=!0},p(o,[w]){(!F||w&3&&i!==(i=$e(o[1].criticalIssues[o[0]].point)))&&W(l,"href",i),(!F||w&3&&a!==(a=de(o[1].criticalIssues[o[0]].point)))&&W(f,"href",a);const te={};!g&&w&3&&(g=!0,te.value=o[1].criticalIssues[o[0]].criticalIssue,Z(()=>g=!1)),r.$set(te);const ne={};!T&&w&3&&(T=!0,ne.value=o[1].criticalIssues[o[0]].stage,Z(()=>T=!1)),m.$set(ne);const ce={};!b&&w&3&&(b=!0,ce.value=o[1].criticalIssues[o[0]].locationName,Z(()=>b=!1)),$.$set(ce);const ue={};!V&&w&3&&(V=!0,ue.value=o[1].criticalIssues[o[0]].resolved,Z(()=>V=!1)),h.$set(ue);const pe={};!ee&&w&3&&(ee=!0,pe.value=o[1].criticalIssues[o[0]].notes,Z(()=>ee=!1)),L.$set(pe)},i(o){F||(C(r.$$.fragment,o),C(m.$$.fragment,o),C($.$$.fragment,o),C(h.$$.fragment,o),C(L.$$.fragment,o),F=!0)},o(o){S(r.$$.fragment,o),S(m.$$.fragment,o),S($.$$.fragment,o),S(h.$$.fragment,o),S(L.$$.fragment,o),F=!1},d(o){o&&(v(e),v(p),v(d),v(u),v(A),v(R)),P(r,o),P(m,o),P($,o),P(h,o),P(L,o)}}}function ut(t,e,l){let n;Ce(t,O,g=>l(1,n=g));let{idx:i}=e,c=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]];function f(g){t.$$.not_equal(n.criticalIssues[i].criticalIssue,g)&&(n.criticalIssues[i].criticalIssue=g,O.set(n))}function s(g){t.$$.not_equal(n.criticalIssues[i].stage,g)&&(n.criticalIssues[i].stage=g,O.set(n))}function a(g){t.$$.not_equal(n.criticalIssues[i].locationName,g)&&(n.criticalIssues[i].locationName=g,O.set(n))}function p(g){t.$$.not_equal(n.criticalIssues[i].resolved,g)&&(n.criticalIssues[i].resolved=g,O.set(n))}function r(g){t.$$.not_equal(n.criticalIssues[i].notes,g)&&(n.criticalIssues[i].notes=g,O.set(n))}return t.$$set=g=>{"idx"in g&&l(0,i=g.idx)},[i,n,c,f,s,a,p,r]}class pt extends Le{constructor(e){super(),Ie(this,e,ut,ct,we,{idx:0})}}function _t(t){let e,l,n,i,c,f,s,a,p,r,g,d,m,T,u,$,b,A,h,V,R,L,ee,F;function E(o){t[3](o)}let oe={label:"Policy Conflict",emptyOption:!0,choices:t[2]};t[1].policyConflictLog[t[0]].conflict!==void 0&&(oe.value=t[1].policyConflictLog[t[0]].conflict),r=new ge({props:oe}),Y.push(()=>Q(r,"value",E));function _(o){t[4](o)}let y={label:"Stage",emptyOption:!0,choices:Ge(["Existing","Design"])};t[1].policyConflictLog[t[0]].stage!==void 0&&(y.value=t[1].policyConflictLog[t[0]].stage),m=new ge({props:y}),Y.push(()=>Q(m,"value",_));function G(o){t[5](o)}let K={label:"Location Name"};t[1].policyConflictLog[t[0]].locationName!==void 0&&(K.value=t[1].policyConflictLog[t[0]].locationName),$=new Re({props:K}),Y.push(()=>Q($,"value",G));function B(o){t[6](o)}let k={label:"Resolved by Design"};t[1].policyConflictLog[t[0]].resolved!==void 0&&(k.value=t[1].policyConflictLog[t[0]].resolved),h=new He({props:k}),Y.push(()=>Q(h,"value",B));function x(o){t[7](o)}let re={label:"Commentary & Feedback"};return t[1].policyConflictLog[t[0]].notes!==void 0&&(re.value=t[1].policyConflictLog[t[0]].notes),L=new We({props:re}),Y.push(()=>Q(L,"value",x)),{c(){e=U("div"),l=U("a"),n=le("Google StreetView"),c=D(),f=U("a"),s=le("Bing Streetside"),p=D(),q(r.$$.fragment),d=D(),q(m.$$.fragment),u=D(),q($.$$.fragment),A=D(),q(h.$$.fragment),R=D(),q(L.$$.fragment),this.h()},l(o){e=z(o,"DIV",{style:!0});var w=J(e);l=z(w,"A",{href:!0,target:!0});var te=J(l);n=ie(te,"Google StreetView"),te.forEach(v),c=N(w),f=z(w,"A",{href:!0,target:!0});var ne=J(f);s=ie(ne,"Bing Streetside"),ne.forEach(v),w.forEach(v),p=N(o),j(r.$$.fragment,o),d=N(o),j(m.$$.fragment,o),u=N(o),j($.$$.fragment,o),A=N(o),j(h.$$.fragment,o),R=N(o),j(L.$$.fragment,o),this.h()},h(){W(l,"href",i=$e(t[1].policyConflictLog[t[0]].point)),W(l,"target","_blank"),W(f,"href",a=de(t[1].policyConflictLog[t[0]].point)),W(f,"target","_blank"),X(e,"display","flex"),X(e,"justify-content","space-evenly")},m(o,w){I(o,e,w),H(e,l),H(l,n),H(e,c),H(e,f),H(f,s),I(o,p,w),M(r,o,w),I(o,d,w),M(m,o,w),I(o,u,w),M($,o,w),I(o,A,w),M(h,o,w),I(o,R,w),M(L,o,w),F=!0},p(o,[w]){(!F||w&3&&i!==(i=$e(o[1].policyConflictLog[o[0]].point)))&&W(l,"href",i),(!F||w&3&&a!==(a=de(o[1].policyConflictLog[o[0]].point)))&&W(f,"href",a);const te={};!g&&w&3&&(g=!0,te.value=o[1].policyConflictLog[o[0]].conflict,Z(()=>g=!1)),r.$set(te);const ne={};!T&&w&3&&(T=!0,ne.value=o[1].policyConflictLog[o[0]].stage,Z(()=>T=!1)),m.$set(ne);const ce={};!b&&w&3&&(b=!0,ce.value=o[1].policyConflictLog[o[0]].locationName,Z(()=>b=!1)),$.$set(ce);const ue={};!V&&w&3&&(V=!0,ue.value=o[1].policyConflictLog[o[0]].resolved,Z(()=>V=!1)),h.$set(ue);const pe={};!ee&&w&3&&(ee=!0,pe.value=o[1].policyConflictLog[o[0]].notes,Z(()=>ee=!1)),L.$set(pe)},i(o){F||(C(r.$$.fragment,o),C(m.$$.fragment,o),C($.$$.fragment,o),C(h.$$.fragment,o),C(L.$$.fragment,o),F=!0)},o(o){S(r.$$.fragment,o),S(m.$$.fragment,o),S($.$$.fragment,o),S(h.$$.fragment,o),S(L.$$.fragment,o),F=!1},d(o){o&&(v(e),v(p),v(d),v(u),v(A),v(R)),P(r,o),P(m,o),P($,o),P(h,o),P(L,o)}}}function mt(t,e,l){let n;Ce(t,O,g=>l(1,n=g));let{idx:i}=e,c=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]];function f(g){t.$$.not_equal(n.policyConflictLog[i].conflict,g)&&(n.policyConflictLog[i].conflict=g,O.set(n))}function s(g){t.$$.not_equal(n.policyConflictLog[i].stage,g)&&(n.policyConflictLog[i].stage=g,O.set(n))}function a(g){t.$$.not_equal(n.policyConflictLog[i].locationName,g)&&(n.policyConflictLog[i].locationName=g,O.set(n))}function p(g){t.$$.not_equal(n.policyConflictLog[i].resolved,g)&&(n.policyConflictLog[i].resolved=g,O.set(n))}function r(g){t.$$.not_equal(n.policyConflictLog[i].notes,g)&&(n.policyConflictLog[i].notes=g,O.set(n))}return t.$$set=g=>{"idx"in g&&l(0,i=g.idx)},[i,n,c,f,s,a,p,r]}class gt extends Le{constructor(e){super(),Ie(this,e,mt,_t,we,{idx:0})}}const{window:$t}=Ye;function Ae(t,e,l){const n=t.slice();return n[29]=e[l],n[30]=e,n[31]=l,n}function Ee(t,e,l){const n=t.slice();return n[32]=e[l],n[33]=e,n[31]=l,n}function De(t,e,l){const n=t.slice();return n[29]=e[l],n[31]=l,n}function Ne(t,e,l){const n=t.slice();return n[32]=e[l],n[31]=l,n}function dt(t){let e,l,n,i,c,f,s,a;e=new st({props:{$$slots:{default:[vt]},$$scope:{ctx:t}}}),e.$on("click",t[21]),n=new at({props:{$$slots:{default:[bt]},$$scope:{ctx:t}}}),n.$on("click",t[9]);const p=[yt,kt],r=[];function g(d,m){return d[0].kind=="critical"?0:1}return c=g(t),f=r[c]=p[c](t),{c(){q(e.$$.fragment),l=D(),q(n.$$.fragment),i=D(),f.c(),s=_e()},l(d){j(e.$$.fragment,d),l=N(d),j(n.$$.fragment,d),i=N(d),f.l(d),s=_e()},m(d,m){M(e,d,m),I(d,l,m),M(n,d,m),I(d,i,m),r[c].m(d,m),I(d,s,m),a=!0},p(d,m){const T={};m[1]&32&&(T.$$scope={dirty:m,ctx:d}),e.$set(T);const u={};m[1]&32&&(u.$$scope={dirty:m,ctx:d}),n.$set(u);let $=c;c=g(d),c===$?r[c].p(d,m):(fe(),S(r[$],1,1,()=>{r[$]=null}),ae(),f=r[c],f?f.p(d,m):(f=r[c]=p[c](d),f.c()),C(f,1),f.m(s.parentNode,s))},i(d){a||(C(e.$$.fragment,d),C(n.$$.fragment,d),C(f),a=!0)},o(d){S(e.$$.fragment,d),S(n.$$.fragment,d),S(f),a=!1},d(d){d&&(v(l),v(i),v(s)),P(e,d),P(n,d),r[c].d(d)}}}function ht(t){let e,l,n,i,c,f,s="Click the map to add a problem, or select a problem to fill out data",a,p,r="Critical Issues",g,d,m,T,u="Policy Conflicts",$,b,A;e=new rt({props:{label:"Tools",$$slots:{default:[Ct]},$$scope:{ctx:t}}});function h(_){t[14](_)}let V={legend:"Create new problems",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};t[4]!==void 0&&(V.value=t[4]),n=new et({props:V}),Y.push(()=>Q(n,"value",h));let R=se(t[2].criticalIssues),L=[];for(let _=0;_<R.length;_+=1)L[_]=je(Ne(t,R,_));const ee=_=>S(L[_],1,1,()=>{L[_]=null});let F=se(t[2].policyConflictLog),E=[];for(let _=0;_<F.length;_+=1)E[_]=Me(De(t,F,_));const oe=_=>S(E[_],1,1,()=>{E[_]=null});return{c(){q(e.$$.fragment),l=D(),q(n.$$.fragment),c=D(),f=U("p"),f.textContent=s,a=D(),p=U("h3"),p.textContent=r,g=D(),d=U("ol");for(let _=0;_<L.length;_+=1)L[_].c();m=D(),T=U("h3"),T.textContent=u,$=D(),b=U("ol");for(let _=0;_<E.length;_+=1)E[_].c()},l(_){j(e.$$.fragment,_),l=N(_),j(n.$$.fragment,_),c=N(_),f=z(_,"P",{"data-svelte-h":!0}),ve(f)!=="svelte-12ba5j2"&&(f.textContent=s),a=N(_),p=z(_,"H3",{"data-svelte-h":!0}),ve(p)!=="svelte-1qhh5xr"&&(p.textContent=r),g=N(_),d=z(_,"OL",{});var y=J(d);for(let K=0;K<L.length;K+=1)L[K].l(y);y.forEach(v),m=N(_),T=z(_,"H3",{"data-svelte-h":!0}),ve(T)!=="svelte-eyxzjx"&&(T.textContent=u),$=N(_),b=z(_,"OL",{});var G=J(b);for(let K=0;K<E.length;K+=1)E[K].l(G);G.forEach(v)},m(_,y){M(e,_,y),I(_,l,y),M(n,_,y),I(_,c,y),I(_,f,y),I(_,a,y),I(_,p,y),I(_,g,y),I(_,d,y);for(let G=0;G<L.length;G+=1)L[G]&&L[G].m(d,null);I(_,m,y),I(_,T,y),I(_,$,y),I(_,b,y);for(let G=0;G<E.length;G+=1)E[G]&&E[G].m(b,null);A=!0},p(_,y){const G={};y[0]&40|y[1]&32&&(G.$$scope={dirty:y,ctx:_}),e.$set(G);const K={};if(!i&&y[0]&16&&(i=!0,K.value=_[4],Z(()=>i=!1)),n.$set(K),y[0]&134){R=se(_[2].criticalIssues);let B;for(B=0;B<R.length;B+=1){const k=Ne(_,R,B);L[B]?(L[B].p(k,y),C(L[B],1)):(L[B]=je(k),L[B].c(),C(L[B],1),L[B].m(d,null))}for(fe(),B=R.length;B<L.length;B+=1)ee(B);ae()}if(y[0]&134){F=se(_[2].policyConflictLog);let B;for(B=0;B<F.length;B+=1){const k=De(_,F,B);E[B]?(E[B].p(k,y),C(E[B],1)):(E[B]=Me(k),E[B].c(),C(E[B],1),E[B].m(b,null))}for(fe(),B=F.length;B<E.length;B+=1)oe(B);ae()}},i(_){if(!A){C(e.$$.fragment,_),C(n.$$.fragment,_);for(let y=0;y<R.length;y+=1)C(L[y]);for(let y=0;y<F.length;y+=1)C(E[y]);A=!0}},o(_){S(e.$$.fragment,_),S(n.$$.fragment,_),L=L.filter(Boolean);for(let y=0;y<L.length;y+=1)S(L[y]);E=E.filter(Boolean);for(let y=0;y<E.length;y+=1)S(E[y]);A=!1},d(_){_&&(v(l),v(c),v(f),v(a),v(p),v(g),v(d),v(m),v(T),v($),v(b)),P(e,_),P(n,_),me(L,_),me(E,_)}}}function vt(t){let e;return{c(){e=le("Save")},l(l){e=ie(l,"Save")},m(l,n){I(l,e,n)},d(l){l&&v(e)}}}function bt(t){let e;return{c(){e=le("Delete")},l(l){e=ie(l,"Delete")},m(l,n){I(l,e,n)},d(l){l&&v(e)}}}function kt(t){let e,l;return e=new gt({props:{idx:t[0].idx}}),{c(){q(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,i){M(e,n,i),l=!0},p(n,i){const c={};i[0]&1&&(c.idx=n[0].idx),e.$set(c)},i(n){l||(C(e.$$.fragment,n),l=!0)},o(n){S(e.$$.fragment,n),l=!1},d(n){P(e,n)}}}function yt(t){let e,l;return e=new pt({props:{idx:t[0].idx}}),{c(){q(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,i){M(e,n,i),l=!0},p(n,i){const c={};i[0]&1&&(c.idx=n[0].idx),e.$set(c)},i(n){l||(C(e.$$.fragment,n),l=!0)},o(n){S(e.$$.fragment,n),l=!1},d(n){P(e,n)}}}function wt(t){let e;return{c(){e=le("Zoom to fit")},l(l){e=ie(l,"Zoom to fit")},m(l,n){I(l,e,n)},d(l){l&&v(e)}}}function qe(t){let e,l,n;function i(f){t[13](f)}let c={map:t[3]};return t[5]!==void 0&&(c.enabled=t[5]),e=new ot({props:c}),Y.push(()=>Q(e,"enabled",i)),{c(){q(e.$$.fragment)},l(f){j(e.$$.fragment,f)},m(f,s){M(e,f,s),n=!0},p(f,s){const a={};s[0]&8&&(a.map=f[3]),!l&&s[0]&32&&(l=!0,a.enabled=f[5],Z(()=>l=!1)),e.$set(a)},i(f){n||(C(e.$$.fragment,f),n=!0)},o(f){S(e.$$.fragment,f),n=!1},d(f){P(e,f)}}}function Ct(t){let e,l,n,i,c,f,s,a;e=new Se({props:{$$slots:{default:[wt]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new tt({}),c=new nt({});let p=t[3]&&qe(t);return{c(){q(e.$$.fragment),l=D(),q(n.$$.fragment),i=D(),q(c.$$.fragment),f=D(),p&&p.c(),s=_e()},l(r){j(e.$$.fragment,r),l=N(r),j(n.$$.fragment,r),i=N(r),j(c.$$.fragment,r),f=N(r),p&&p.l(r),s=_e()},m(r,g){M(e,r,g),I(r,l,g),M(n,r,g),I(r,i,g),M(c,r,g),I(r,f,g),p&&p.m(r,g),I(r,s,g),a=!0},p(r,g){const d={};g[1]&32&&(d.$$scope={dirty:g,ctx:r}),e.$set(d),r[3]?p?(p.p(r,g),g[0]&8&&C(p,1)):(p=qe(r),p.c(),C(p,1),p.m(s.parentNode,s)):p&&(fe(),S(p,1,1,()=>{p=null}),ae())},i(r){a||(C(e.$$.fragment,r),C(n.$$.fragment,r),C(c.$$.fragment,r),C(p),a=!0)},o(r){S(e.$$.fragment,r),S(n.$$.fragment,r),S(c.$$.fragment,r),S(p),a=!1},d(r){r&&(v(l),v(i),v(f),v(s)),P(e,r),P(n,r),P(c,r),p&&p.d(r)}}}function Lt(t){let e=Ve(t[32])+"",l;return{c(){l=le(e)},l(n){l=ie(n,e)},m(n,i){I(n,l,i)},p(n,i){i[0]&4&&e!==(e=Ve(n[32])+"")&&he(l,e)},d(n){n&&v(l)}}}function je(t){let e,l,n,i;function c(){return t[15](t[31])}function f(){return t[16](t[31])}return l=new Se({props:{$$slots:{default:[Lt]},$$scope:{ctx:t}}}),l.$on("click",c),l.$on("mouseenter",f),l.$on("mouseleave",t[17]),{c(){e=U("li"),q(l.$$.fragment),n=D()},l(s){e=z(s,"LI",{});var a=J(e);j(l.$$.fragment,a),n=N(a),a.forEach(v)},m(s,a){I(s,e,a),M(l,e,null),H(e,n),i=!0},p(s,a){t=s;const p={};a[0]&4|a[1]&32&&(p.$$scope={dirty:a,ctx:t}),l.$set(p)},i(s){i||(C(l.$$.fragment,s),i=!0)},o(s){S(l.$$.fragment,s),i=!1},d(s){s&&v(e),P(l)}}}function It(t){let e=Fe(t[29])+"",l;return{c(){l=le(e)},l(n){l=ie(n,e)},m(n,i){I(n,l,i)},p(n,i){i[0]&4&&e!==(e=Fe(n[29])+"")&&he(l,e)},d(n){n&&v(l)}}}function Me(t){let e,l,n,i;function c(){return t[18](t[31])}function f(){return t[19](t[31])}return l=new Se({props:{$$slots:{default:[It]},$$scope:{ctx:t}}}),l.$on("click",c),l.$on("mouseenter",f),l.$on("mouseleave",t[20]),{c(){e=U("li"),q(l.$$.fragment),n=D()},l(s){e=z(s,"LI",{});var a=J(e);j(l.$$.fragment,a),n=N(a),a.forEach(v)},m(s,a){I(s,e,a),M(l,e,null),H(e,n),i=!0},p(s,a){t=s;const p={};a[0]&4|a[1]&32&&(p.$$scope={dirty:a,ctx:t}),l.$set(p)},i(s){i||(C(l.$$.fragment,s),i=!0)},o(s){S(l.$$.fragment,s),i=!1},d(s){s&&v(e),P(l)}}}function St(t){let e,l,n,i=t[32].criticalIssue+"",c;return{c(){e=be("svg"),l=be("polygon"),n=be("text"),c=le(i),this.h()},l(f){e=ke(f,"svg",{width:!0,height:!0,xmlns:!0});var s=J(e);l=ke(s,"polygon",{points:!0,fill:!0,class:!0}),J(l).forEach(v),n=ke(s,"text",{x:!0,y:!0});var a=J(n);c=ie(a,i),a.forEach(v),s.forEach(v),this.h()},h(){W(l,"points","20,0 0,40 40,40"),W(l,"fill",Qe.critical.background),W(l,"class","svelte-ktyu3j"),W(n,"x","13"),W(n,"y","30"),X(n,"fill","white"),W(e,"width","40"),W(e,"height","40"),W(e,"xmlns","http://www.w3.org/2000/svg")},m(f,s){I(f,e,s),H(e,l),H(e,n),H(n,c)},p(f,s){s[0]&4&&i!==(i=f[32].criticalIssue+"")&&he(c,i)},d(f){f&&v(e)}}}function Pe(t){let e,l,n;function i(a){t[22](a,t[32])}function c(){return t[23](t[31])}function f(){return t[24](t[31])}let s={draggable:!0,$$slots:{default:[St]},$$scope:{ctx:t}};return t[32].point!==void 0&&(s.lngLat=t[32].point),e=new Oe({props:s}),Y.push(()=>Q(e,"lngLat",i)),e.$on("click",c),e.$on("dragend",f),{c(){q(e.$$.fragment)},l(a){j(e.$$.fragment,a)},m(a,p){M(e,a,p),n=!0},p(a,p){t=a;const r={};p[0]&4|p[1]&32&&(r.$$scope={dirty:p,ctx:t}),!l&&p[0]&4&&(l=!0,r.lngLat=t[32].point,Z(()=>l=!1)),e.$set(r)},i(a){n||(C(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){P(e,a)}}}function Bt(t){let e,l=t[29].conflict+"",n;return{c(){e=U("span"),n=le(l),this.h()},l(i){e=z(i,"SPAN",{class:!0});var c=J(e);n=ie(c,l),c.forEach(v),this.h()},h(){W(e,"class","dot svelte-ktyu3j"),X(e,"background",Xe)},m(i,c){I(i,e,c),H(e,n)},p(i,c){c[0]&4&&l!==(l=i[29].conflict+"")&&he(n,l)},d(i){i&&v(e)}}}function Te(t){let e,l,n;function i(a){t[25](a,t[29])}function c(){return t[26](t[31])}function f(){return t[27](t[31])}let s={draggable:!0,$$slots:{default:[Bt]},$$scope:{ctx:t}};return t[29].point!==void 0&&(s.lngLat=t[29].point),e=new Oe({props:s}),Y.push(()=>Q(e,"lngLat",i)),e.$on("click",c),e.$on("dragend",f),{c(){q(e.$$.fragment)},l(a){j(e.$$.fragment,a)},m(a,p){M(e,a,p),n=!0},p(a,p){t=a;const r={};p[0]&4|p[1]&32&&(r.$$scope={dirty:p,ctx:t}),!l&&p[0]&4&&(l=!0,r.lngLat=t[29].point,Z(()=>l=!1)),e.$set(r)},i(a){n||(C(e.$$.fragment,a),n=!0)},o(a){S(e.$$.fragment,a),n=!1},d(a){P(e,a)}}}function At(t){let e,l;return e=new ft({props:{paint:{"circle-radius":30,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){q(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,i){M(e,n,i),l=!0},p:ze,i(n){l||(C(e.$$.fragment,n),l=!0)},o(n){S(e.$$.fragment,n),l=!1},d(n){P(e,n)}}}function Et(t){let e,l,n,i,c,f,s,a;e=new lt({}),e.$on("click",t[8]);let p=se(t[2].criticalIssues),r=[];for(let u=0;u<p.length;u+=1)r[u]=Pe(Ee(t,p,u));const g=u=>S(r[u],1,1,()=>{r[u]=null});let d=se(t[2].policyConflictLog),m=[];for(let u=0;u<d.length;u+=1)m[u]=Te(Ae(t,d,u));const T=u=>S(m[u],1,1,()=>{m[u]=null});return c=new Ze({props:{data:t[6],$$slots:{default:[At]},$$scope:{ctx:t}}}),s=new it({props:{map:t[3]}}),{c(){q(e.$$.fragment),l=D();for(let u=0;u<r.length;u+=1)r[u].c();n=D();for(let u=0;u<m.length;u+=1)m[u].c();i=D(),q(c.$$.fragment),f=D(),q(s.$$.fragment)},l(u){j(e.$$.fragment,u),l=N(u);for(let $=0;$<r.length;$+=1)r[$].l(u);n=N(u);for(let $=0;$<m.length;$+=1)m[$].l(u);i=N(u),j(c.$$.fragment,u),f=N(u),j(s.$$.fragment,u)},m(u,$){M(e,u,$),I(u,l,$);for(let b=0;b<r.length;b+=1)r[b]&&r[b].m(u,$);I(u,n,$);for(let b=0;b<m.length;b+=1)m[b]&&m[b].m(u,$);I(u,i,$),M(c,u,$),I(u,f,$),M(s,u,$),a=!0},p(u,$){if($[0]&132){p=se(u[2].criticalIssues);let h;for(h=0;h<p.length;h+=1){const V=Ee(u,p,h);r[h]?(r[h].p(V,$),C(r[h],1)):(r[h]=Pe(V),r[h].c(),C(r[h],1),r[h].m(n.parentNode,n))}for(fe(),h=p.length;h<r.length;h+=1)g(h);ae()}if($[0]&132){d=se(u[2].policyConflictLog);let h;for(h=0;h<d.length;h+=1){const V=Ae(u,d,h);m[h]?(m[h].p(V,$),C(m[h],1)):(m[h]=Te(V),m[h].c(),C(m[h],1),m[h].m(i.parentNode,i))}for(fe(),h=d.length;h<m.length;h+=1)T(h);ae()}const b={};$[0]&64&&(b.data=u[6]),$[1]&32&&(b.$$scope={dirty:$,ctx:u}),c.$set(b);const A={};$[0]&8&&(A.map=u[3]),s.$set(A)},i(u){if(!a){C(e.$$.fragment,u);for(let $=0;$<p.length;$+=1)C(r[$]);for(let $=0;$<d.length;$+=1)C(m[$]);C(c.$$.fragment,u),C(s.$$.fragment,u),a=!0}},o(u){S(e.$$.fragment,u),r=r.filter(Boolean);for(let $=0;$<r.length;$+=1)S(r[$]);m=m.filter(Boolean);for(let $=0;$<m.length;$+=1)S(m[$]);S(c.$$.fragment,u),S(s.$$.fragment,u),a=!1},d(u){u&&(v(l),v(n),v(i),v(f)),P(e,u),me(r,u),me(m,u),P(c,u),P(s,u)}}}function Dt(t){let e,l,n,i,c,f,s,a,p,r,g;const d=[ht,dt],m=[];function T(b,A){return b[0]==null?0:1}n=T(t),i=m[n]=d[n](t);function u(b){t[28](b)}let $={$$slots:{default:[Et]},$$scope:{ctx:t}};return t[3]!==void 0&&($.map=t[3]),s=new Je({props:$}),Y.push(()=>Q(s,"map",u)),{c(){e=U("div"),l=U("div"),i.c(),c=D(),f=U("div"),q(s.$$.fragment),this.h()},l(b){e=z(b,"DIV",{style:!0});var A=J(e);l=z(A,"DIV",{style:!0});var h=J(l);i.l(h),h.forEach(v),c=N(A),f=z(A,"DIV",{style:!0});var V=J(f);j(s.$$.fragment,V),V.forEach(v),A.forEach(v),this.h()},h(){X(l,"width","30%"),X(l,"overflow-y","scroll"),X(l,"padding","10px"),X(l,"border","1px solid black"),X(f,"position","relative"),X(f,"width","70%"),X(e,"display","flex"),X(e,"height","80vh")},m(b,A){I(b,e,A),H(e,l),m[n].m(l,null),H(e,c),H(e,f),M(s,f,null),p=!0,r||(g=Ke($t,"keydown",t[11]),r=!0)},p(b,A){let h=n;n=T(b),n===h?m[n].p(b,A):(fe(),S(m[h],1,1,()=>{m[h]=null}),ae(),i=m[n],i?i.p(b,A):(i=m[n]=d[n](b),i.c()),C(i,1),i.m(l,null));const V={};A[0]&76|A[1]&32&&(V.$$scope={dirty:A,ctx:b}),!a&&A[0]&8&&(a=!0,V.map=b[3],Z(()=>a=!1)),s.$set(V)},i(b){p||(C(i),C(s.$$.fragment,b),p=!0)},o(b){S(i),S(s.$$.fragment,b),p=!1},d(b){b&&v(e),m[n].d(),P(s),r=!1,g()}}}function Nt(t,e,l){let n={type:"FeatureCollection",features:[]},i=e??l;if(i!=null){let c=i.kind=="critical"?t.criticalIssues:t.policyConflictLog;n.features.push(ye(c[i.idx].point))}return n}function ye(t){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:t}}}function Ve(t){return`${t.criticalIssue||"Unknown critical"}: ${t.locationName||"???"}`}function Fe(t){return`${t.conflict||"Unknown conflict"}: ${t.locationName||"???"}`}function qt(t,e,l){let n,i;Ce(t,O,k=>l(2,i=k));let c,f="critical",s=null,a=null,p=!1;function r(k){l(0,s=k),l(1,a=null)}function g(k){if(!p){if(s!=null){l(0,s=null);return}f=="critical"?(Be(O,i.criticalIssues=[...i.criticalIssues,{criticalIssue:"",stage:"",point:k.detail.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,s={kind:"critical",idx:i.criticalIssues.length-1})):(Be(O,i.policyConflictLog=[...i.policyConflictLog,{conflict:"",stage:"",point:k.detail.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,s={kind:"conflict",idx:i.policyConflictLog.length-1})),l(1,a=null)}}Ue(()=>{m(!1)});function d(){window.confirm("Delete this entry?")&&(s.kind=="critical"?(i.criticalIssues.splice(s.idx,1),O.set(i)):(i.policyConflictLog.splice(s.idx,1),O.set(i)),l(0,s=null))}function m(k){let x={type:"FeatureCollection",features:[...i.criticalIssues.map(re=>ye(re.point)),...i.policyConflictLog.map(re=>ye(re.point))]};x.features.length>0&&c.fitBounds(xe(x),{padding:20,animate:k})}function T(k){s!=null&&k.key=="Escape"?(k.stopPropagation(),l(0,s=null)):s!=null&&k.key=="Delete"&&d()}const u=()=>m(!0);function $(k){p=k,l(5,p)}function b(k){f=k,l(4,f)}const A=k=>r({kind:"critical",idx:k}),h=k=>l(1,a={kind:"critical",idx:k}),V=()=>l(1,a=null),R=k=>r({kind:"conflict",idx:k}),L=k=>l(1,a={kind:"conflict",idx:k}),ee=()=>l(1,a=null),F=()=>l(0,s=null);function E(k,x){t.$$.not_equal(x.point,k)&&(x.point=k,O.set(i))}const oe=k=>r({kind:"critical",idx:k}),_=k=>r({kind:"critical",idx:k});function y(k,x){t.$$.not_equal(x.point,k)&&(x.point=k,O.set(i))}const G=k=>r({kind:"conflict",idx:k}),K=k=>r({kind:"conflict",idx:k});function B(k){c=k,l(3,c)}return t.$$.update=()=>{t.$$.dirty[0]&7&&l(6,n=Nt(i,s,a))},[s,a,i,c,f,p,n,r,g,d,m,T,u,$,b,A,h,V,R,L,ee,F,E,oe,_,y,G,K,B]}class Qt extends Le{constructor(e){super(),Ie(this,e,qt,Dt,we,{},null,[-1,-1])}}export{Qt as component};
