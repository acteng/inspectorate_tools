import{s as Pe,v as te,w as ne,l as xt,u as en,m as tn,o as nn,G as Ee,k as Re,U as rn,T as qe,a as B,g as N,i as v,f as y,q as Oe,n as Ae,e as x,t as J,c as ee,b as ie,d as H,r as Je,x as Y,h as oe,j as de,z as on,D as be,p as ft}from"../chunks/scheduler.BBS-fkhU.js";import{S as Be,i as Ne,e as re,c as S,a as I,m as F,t as w,b as k,d as T,g as ce,f as ge}from"../chunks/index.B8H3ypVf.js";import{e as pe}from"../chunks/each.D79A5KlB.js";import{B as ln}from"../chunks/ButtonGroup.fhy-VJbf.js";import{W as St,S as _e}from"../chunks/WarningButton.CaqyhU7y.js";import{T as tt}from"../chunks/TextInput.C_aBwF72.js";import{s as Q}from"../chunks/data.BccAH0b_.js";import{L as an,d as sn,e as It,M as un,b as fn,C as mn,G as mt,f as Qe,h as ct,c as cn,P as Ft,g as gn}from"../chunks/index.DVvl5aud.js";import{c as Ge}from"../chunks/colors.CYEpEtTL.js";import{M as pn,a as dn,b as ze,R as Tt,B as _n,G as hn,S as $n,C as bn}from"../chunks/GeoreferenceLayer.Cu3DiKBo.js";import{D as yn,C as wn}from"../chunks/DefaultButton.Pbp5mObw.js";import{T as qt}from"../chunks/TextArea.Ck6ITb4v.js";import{p as Ot}from"../chunks/index.Ugf0Jx6o.js";import{S as vn}from"../chunks/Select.DqyoFzIJ.js";function kn(t){let e;const n=t[16].default,r=xt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&en(r,n,o,o[24],e?nn(n,o[24],l,null):tn(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function jn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[kn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new an({props:l}),te.push(()=>re(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){S(e.$$.fragment)},l(i){I(e.$$.fragment,i)},m(i,s){F(e,i,s),r=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ne(()=>n=!1)),e.$set(a)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){T(e,i)}}}function En(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=sn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:g=void 0}=e,{layout:d=void 0}=e,{filter:f=void 0}=e,{applyToClusters:j=void 0}=e,{minzoom:E=void 0}=e,{maxzoom:O=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:M=!1}=e,{hovered:b=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:_=!0}=e;function h(A){b=A,n(0,b)}function p(A){Ee.call(this,t,A)}function C(A){Ee.call(this,t,A)}function K(A){Ee.call(this,t,A)}function P(A){Ee.call(this,t,A)}function U(A){Ee.call(this,t,A)}function me(A){Ee.call(this,t,A)}return t.$$set=A=>{"id"in A&&n(1,l=A.id),"source"in A&&n(2,i=A.source),"sourceLayer"in A&&n(3,s=A.sourceLayer),"beforeId"in A&&n(4,a=A.beforeId),"beforeLayerType"in A&&n(5,m=A.beforeLayerType),"paint"in A&&n(6,g=A.paint),"layout"in A&&n(7,d=A.layout),"filter"in A&&n(8,f=A.filter),"applyToClusters"in A&&n(9,j=A.applyToClusters),"minzoom"in A&&n(10,E=A.minzoom),"maxzoom"in A&&n(11,O=A.maxzoom),"hoverCursor"in A&&n(12,D=A.hoverCursor),"manageHoverState"in A&&n(13,M=A.manageHoverState),"hovered"in A&&n(0,b=A.hovered),"eventsIfTopMost"in A&&n(14,u=A.eventsIfTopMost),"interactive"in A&&n(15,_=A.interactive),"$$scope"in A&&n(24,o=A.$$scope)},[b,l,i,s,a,m,g,d,f,j,E,O,D,M,u,_,r,h,p,C,K,P,U,me,o]}class Cn extends Be{constructor(e){super(),Ne(this,e,En,jn,Pe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ln=Object.defineProperty,X=(t,e)=>Ln(t,"name",{value:e,configurable:!0}),Pn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ie(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ye(e),o=Ye(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ie(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const a=this.fixStartIndex(i,l);if(a)i=a;else return!1}const s=this.compareCoord(l[r],i[r]);return this.direction||s?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ie(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?It(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ie(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};X(Pn,"GeojsonEquality");function Ie(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}X(Ie,"sameLength");function Ye(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}X(Ye,"explode");var ue=63710088e-1,Bt={centimeters:ue*100,centimetres:ue*100,degrees:360/(2*Math.PI),feet:ue*3.28084,inches:ue*39.37,kilometers:ue/1e3,kilometres:ue/1e3,meters:ue,metres:ue,miles:ue/1609.344,millimeters:ue*1e3,millimetres:ue*1e3,nauticalmiles:ue/1852,radians:1,yards:ue*1.0936},gt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ye(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}X(ye,"feature");function An(t,e,n={}){switch(t){case"Point":return He(e).geometry;case"LineString":return rt(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return Gt(e).geometry;case"MultiLineString":return Nt(e).geometry;case"MultiPolygon":return zt(e).geometry;default:throw new Error(t+" is invalid")}}X(An,"geometry");function He(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ce(t[0])||!Ce(t[1]))throw new Error("coordinates must contain numbers");return ye({type:"Point",coordinates:t},e,n)}X(He,"point");function Mn(t,e,n={}){return Ke(t.map(r=>He(r,e)),n)}X(Mn,"points");function nt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ye({type:"Polygon",coordinates:t},e,n)}X(nt,"polygon");function Sn(t,e,n={}){return Ke(t.map(r=>nt(r,e)),n)}X(Sn,"polygons");function rt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ye({type:"LineString",coordinates:t},e,n)}X(rt,"lineString");function In(t,e,n={}){return Ke(t.map(r=>rt(r,e)),n)}X(In,"lineStrings");function Ke(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}X(Ke,"featureCollection");function Nt(t,e,n={}){return ye({type:"MultiLineString",coordinates:t},e,n)}X(Nt,"multiLineString");function Gt(t,e,n={}){return ye({type:"MultiPoint",coordinates:t},e,n)}X(Gt,"multiPoint");function zt(t,e,n={}){return ye({type:"MultiPolygon",coordinates:t},e,n)}X(zt,"multiPolygon");function Fn(t,e,n={}){return ye({type:"GeometryCollection",geometries:t},e,n)}X(Fn,"geometryCollection");function Tn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}X(Tn,"round");function Dt(t,e="kilometers"){const n=Bt[e];if(!n)throw new Error(e+" units is invalid");return t*n}X(Dt,"radiansToLength");function Xe(t,e="kilometers"){const n=Bt[e];if(!n)throw new Error(e+" units is invalid");return t/n}X(Xe,"lengthToRadians");function qn(t,e){return Ue(Xe(t,e))}X(qn,"lengthToDegrees");function On(t){let e=t%360;return e<0&&(e+=360),e}X(On,"bearingToAzimuth");function Ue(t){return t%(2*Math.PI)*180/Math.PI}X(Ue,"radiansToDegrees");function De(t){return t%360*Math.PI/180}X(De,"degreesToRadians");function Bn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Dt(Xe(t,e),n)}X(Bn,"convertLength");function Nn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=gt[e];if(!r)throw new Error("invalid original units");const o=gt[n];if(!o)throw new Error("invalid final units");return t/r*o}X(Nn,"convertArea");function Ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}X(Ce,"isNumber");function Gn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}X(Gn,"isObject");function zn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ce(e))throw new Error("bbox must only contain numbers")})}X(zn,"validateBBox");function Dn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}X(Dn,"validateId");var Un=Object.defineProperty,we=(t,e)=>Un(t,"name",{value:e,configurable:!0});function Ut(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}we(Ut,"getCoord");function Rn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}we(Rn,"getCoords");function Rt(t){if(t.length>1&&Ce(t[0])&&Ce(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Rt(t[0]);throw new Error("coordinates must only contain numbers")}we(Rt,"containsNumber");function Jn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}we(Jn,"geojsonType");function Hn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}we(Hn,"featureOf");function Kn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}we(Kn,"collectionOf");function Xn(t){return t.type==="Feature"?t.geometry:t}we(Xn,"getGeom");function Vn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}we(Vn,"getType");var Wn=Object.defineProperty,Zn=(t,e)=>Wn(t,"name",{value:e,configurable:!0});function Jt(t,e,n,r={}){const o=Ut(t),l=De(o[0]),i=De(o[1]),s=De(n),a=Xe(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),g=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(m)),d=Ue(g),f=Ue(m);return He([d,f],r.properties)}Zn(Jt,"destination");var pt=Jt,Qn=Object.defineProperty,V=(t,e)=>Qn(t,"name",{value:e,configurable:!0}),Yn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Fe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=xe(e),o=xe(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Fe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const a=this.fixStartIndex(i,l);if(a)i=a;else return!1}const s=this.compareCoord(l[r],i[r]);return this.direction||s?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Fe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?It(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Fe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};V(Yn,"GeojsonEquality");function Fe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}V(Fe,"sameLength");function xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}V(xe,"explode");var fe=63710088e-1,Ht={centimeters:fe*100,centimetres:fe*100,degrees:360/(2*Math.PI),feet:fe*3.28084,inches:fe*39.37,kilometers:fe/1e3,kilometres:fe/1e3,meters:fe,metres:fe,miles:fe/1609.344,millimeters:fe*1e3,millimetres:fe*1e3,nauticalmiles:fe/1852,radians:1,yards:fe*1.0936},dt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ve(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}V(ve,"feature");function xn(t,e,n={}){switch(t){case"Point":return ot(e).geometry;case"LineString":return lt(e).geometry;case"Polygon":return it(e).geometry;case"MultiPoint":return Xt(e).geometry;case"MultiLineString":return Kt(e).geometry;case"MultiPolygon":return Vt(e).geometry;default:throw new Error(t+" is invalid")}}V(xn,"geometry");function ot(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Le(t[0])||!Le(t[1]))throw new Error("coordinates must contain numbers");return ve({type:"Point",coordinates:t},e,n)}V(ot,"point");function er(t,e,n={}){return Ve(t.map(r=>ot(r,e)),n)}V(er,"points");function it(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ve({type:"Polygon",coordinates:t},e,n)}V(it,"polygon");function tr(t,e,n={}){return Ve(t.map(r=>it(r,e)),n)}V(tr,"polygons");function lt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ve({type:"LineString",coordinates:t},e,n)}V(lt,"lineString");function nr(t,e,n={}){return Ve(t.map(r=>lt(r,e)),n)}V(nr,"lineStrings");function Ve(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}V(Ve,"featureCollection");function Kt(t,e,n={}){return ve({type:"MultiLineString",coordinates:t},e,n)}V(Kt,"multiLineString");function Xt(t,e,n={}){return ve({type:"MultiPoint",coordinates:t},e,n)}V(Xt,"multiPoint");function Vt(t,e,n={}){return ve({type:"MultiPolygon",coordinates:t},e,n)}V(Vt,"multiPolygon");function rr(t,e,n={}){return ve({type:"GeometryCollection",geometries:t},e,n)}V(rr,"geometryCollection");function or(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}V(or,"round");function Wt(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t*n}V(Wt,"radiansToLength");function at(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t/n}V(at,"lengthToRadians");function ir(t,e){return st(at(t,e))}V(ir,"lengthToDegrees");function lr(t){let e=t%360;return e<0&&(e+=360),e}V(lr,"bearingToAzimuth");function st(t){return t%(2*Math.PI)*180/Math.PI}V(st,"radiansToDegrees");function Te(t){return t%360*Math.PI/180}V(Te,"degreesToRadians");function ar(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Wt(at(t,e),n)}V(ar,"convertLength");function sr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=dt[e];if(!r)throw new Error("invalid original units");const o=dt[n];if(!o)throw new Error("invalid final units");return t/r*o}V(sr,"convertArea");function Le(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}V(Le,"isNumber");function ur(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}V(ur,"isObject");function fr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Le(e))throw new Error("bbox must only contain numbers")})}V(fr,"validateBBox");function mr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}V(mr,"validateId");var cr=Object.defineProperty,ke=(t,e)=>cr(t,"name",{value:e,configurable:!0});function et(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ke(et,"getCoord");function gr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ke(gr,"getCoords");function Zt(t){if(t.length>1&&Le(t[0])&&Le(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Zt(t[0]);throw new Error("coordinates must only contain numbers")}ke(Zt,"containsNumber");function pr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ke(pr,"geojsonType");function dr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ke(dr,"featureOf");function _r(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ke(_r,"collectionOf");function hr(t){return t.type==="Feature"?t.geometry:t}ke(hr,"getGeom");function $r(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ke($r,"getType");var br=Object.defineProperty,Qt=(t,e)=>br(t,"name",{value:e,configurable:!0});function ut(t,e,n={}){if(n.final===!0)return Yt(t,e);const r=et(t),o=et(e),l=Te(r[0]),i=Te(o[0]),s=Te(r[1]),a=Te(o[1]),m=Math.sin(i-l)*Math.cos(a),g=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return st(Math.atan2(m,g))}Qt(ut,"bearing");function Yt(t,e){let n=ut(e,t);return n=(n+180)%360,n}Qt(Yt,"calculateFinalBearing");var yr=ut;function _t(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function ht(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function wr(t){let e,n=Fr(t[36])+"",r;return{c(){e=x("span"),r=J(n),this.h()},l(o){e=ee(o,"SPAN",{class:!0});var l=ie(e);r=H(l,n),l.forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(o,l){v(o,e,l),oe(e,r)},p:Ae,d(o){o&&y(e)}}}function $t(t){let e,n,r;function o(a){t[17](a,t[37])}function l(){return t[18](t[36])}function i(){return t[19](t[36])}let s={draggable:!0,$$slots:{default:[wr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(s.lngLat=t[37].point),e=new ze({props:s}),te.push(()=>re(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){S(e.$$.fragment)},l(a){I(e.$$.fragment,a)},m(a,m){F(e,a,m),r=!0},p(a,m){t=a;const g={};m[1]&256&&(g.$$scope={dirty:m,ctx:t}),!n&&m[0]&11&&(n=!0,g.lngLat=t[37].point,ne(()=>n=!1)),e.$set(g)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){T(e,a)}}}function vr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score]),Y(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score]),r[0]&11&&Y(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&y(e)}}}function kr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score])},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score])},d(n){n&&y(e)}}}function jr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score]),Y(e,"opacity","0%")},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score])},d(n){n&&y(e)}}}function bt(t){let e,n,r,o,l,i,s,a,m;function g(p){t[20](p,t[34])}function d(){return t[21](t[36])}function f(){return t[22](t[36])}let j={draggable:!0,$$slots:{default:[vr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(j.lngLat=t[34].point1),e=new ze({props:j}),te.push(()=>re(e,"lngLat",g)),e.$on("dragend",d),e.$on("click",f);function E(p){t[23](p,t[34])}function O(){return t[24](t[36])}function D(){return t[25](t[36])}let M={draggable:!0,$$slots:{default:[kr]},$$scope:{ctx:t}};t[34].point2!==void 0&&(M.lngLat=t[34].point2),o=new ze({props:M}),te.push(()=>re(o,"lngLat",E)),o.$on("dragend",O),o.$on("click",D);function b(p){t[26](p,t[34])}function u(){return t[27](t[36])}function _(){return t[28](t[36])}let h={draggable:!0,$$slots:{default:[jr]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(h.lngLat=t[34].point3),s=new ze({props:h}),te.push(()=>re(s,"lngLat",b)),s.$on("dragend",u),s.$on("click",_),{c(){S(e.$$.fragment),r=B(),S(o.$$.fragment),i=B(),S(s.$$.fragment)},l(p){I(e.$$.fragment,p),r=N(p),I(o.$$.fragment,p),i=N(p),I(s.$$.fragment,p)},m(p,C){F(e,p,C),v(p,r,C),F(o,p,C),v(p,i,C),F(s,p,C),m=!0},p(p,C){t=p;const K={};C[0]&11|C[1]&256&&(K.$$scope={dirty:C,ctx:t}),!n&&C[0]&11&&(n=!0,K.lngLat=t[34].point1,ne(()=>n=!1)),e.$set(K);const P={};C[0]&11|C[1]&256&&(P.$$scope={dirty:C,ctx:t}),!l&&C[0]&11&&(l=!0,P.lngLat=t[34].point2,ne(()=>l=!1)),o.$set(P);const U={};C[0]&11|C[1]&256&&(U.$$scope={dirty:C,ctx:t}),!a&&C[0]&11&&(a=!0,U.lngLat=t[34].point3,ne(()=>a=!1)),s.$set(U)},i(p){m||(w(e.$$.fragment,p),w(o.$$.fragment,p),w(s.$$.fragment,p),m=!0)},o(p){k(e.$$.fragment,p),k(o.$$.fragment,p),k(s.$$.fragment,p),m=!1},d(p){p&&(y(r),y(i)),T(e,p),T(o,p),T(s,p)}}}function Er(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&de(n,e)},d(r){r&&y(n)}}}function Cr(t){let e,n;return e=new Ft({props:{$$slots:{default:[Er,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Lr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&de(n,e)},d(r){r&&y(n)}}}function Pr(t){let e,n;return e=new Ft({props:{$$slots:{default:[Lr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Ar(t){let e,n,r,o,l,i;return e=new Qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":ct(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Cr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new Qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":ct(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Pr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new Cn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){S(e.$$.fragment),n=B(),S(r.$$.fragment),o=B(),S(l.$$.fragment)},l(s){I(e.$$.fragment,s),n=N(s),I(r.$$.fragment,s),o=N(s),I(l.$$.fragment,s)},m(s,a){F(e,s,a),v(s,n,a),F(r,s,a),v(s,o,a),F(l,s,a),i=!0},p(s,a){const m={};a[1]&256&&(m.$$scope={dirty:a,ctx:s}),e.$set(m);const g={};a[1]&256&&(g.$$scope={dirty:a,ctx:s}),r.$set(g)},i(s){i||(w(e.$$.fragment,s),w(r.$$.fragment,s),w(l.$$.fragment,s),i=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),k(l.$$.fragment,s),i=!1},d(s){s&&(y(n),y(o)),T(e,s),T(r,s),T(l,s)}}}function Mr(t){let e,n,r,o;return e=new Qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new cn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){S(e.$$.fragment),n=B(),S(r.$$.fragment)},l(l){I(e.$$.fragment,l),n=N(l),I(r.$$.fragment,l)},m(l,i){F(e,l,i),v(l,n,i),F(r,l,i),o=!0},p:Ae,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),o=!1},d(l){l&&y(n),T(e,l),T(r,l)}}}function Sr(t){let e,n,r,o,l,i,s,a,m,g,d,f;e=new pn({}),e.$on("click",t[8]),r=new mn({props:{gj:t[3].summary.networkMap,show:t[2]}});let j=pe(t[3].jat[t[0]][t[1]].arms),E=[];for(let u=0;u<j.length;u+=1)E[u]=$t(ht(t,j,u));const O=u=>k(E[u],1,1,()=>{E[u]=null});let D=pe(t[3].jat[t[0]][t[1]].movements),M=[];for(let u=0;u<D.length;u+=1)M[u]=bt(_t(t,D,u));const b=u=>k(M[u],1,1,()=>{M[u]=null});return s=new mt({props:{data:t[10](t[3]),$$slots:{default:[Ar]},$$scope:{ctx:t}}}),m=new mt({props:{data:t[5],$$slots:{default:[Mr]},$$scope:{ctx:t}}}),d=new dn({props:{map:t[4]}}),{c(){S(e.$$.fragment),n=B(),S(r.$$.fragment),o=B();for(let u=0;u<E.length;u+=1)E[u].c();l=B();for(let u=0;u<M.length;u+=1)M[u].c();i=B(),S(s.$$.fragment),a=B(),S(m.$$.fragment),g=B(),S(d.$$.fragment)},l(u){I(e.$$.fragment,u),n=N(u),I(r.$$.fragment,u),o=N(u);for(let _=0;_<E.length;_+=1)E[_].l(u);l=N(u);for(let _=0;_<M.length;_+=1)M[_].l(u);i=N(u),I(s.$$.fragment,u),a=N(u),I(m.$$.fragment,u),g=N(u),I(d.$$.fragment,u)},m(u,_){F(e,u,_),v(u,n,_),F(r,u,_),v(u,o,_);for(let h=0;h<E.length;h+=1)E[h]&&E[h].m(u,_);v(u,l,_);for(let h=0;h<M.length;h+=1)M[h]&&M[h].m(u,_);v(u,i,_),F(s,u,_),v(u,a,_),F(m,u,_),v(u,g,_),F(d,u,_),f=!0},p(u,_){const h={};if(_[0]&8&&(h.gj=u[3].summary.networkMap),_[0]&4&&(h.show=u[2]),r.$set(h),_[0]&139){j=pe(u[3].jat[u[0]][u[1]].arms);let P;for(P=0;P<j.length;P+=1){const U=ht(u,j,P);E[P]?(E[P].p(U,_),w(E[P],1)):(E[P]=$t(U),E[P].c(),w(E[P],1),E[P].m(l.parentNode,l))}for(ce(),P=j.length;P<E.length;P+=1)O(P);ge()}if(_[0]&203){D=pe(u[3].jat[u[0]][u[1]].movements);let P;for(P=0;P<D.length;P+=1){const U=_t(u,D,P);M[P]?(M[P].p(U,_),w(M[P],1)):(M[P]=bt(U),M[P].c(),w(M[P],1),M[P].m(i.parentNode,i))}for(ce(),P=D.length;P<M.length;P+=1)b(P);ge()}const p={};_[0]&8&&(p.data=u[10](u[3])),_[1]&256&&(p.$$scope={dirty:_,ctx:u}),s.$set(p);const C={};_[0]&32&&(C.data=u[5]),_[1]&256&&(C.$$scope={dirty:_,ctx:u}),m.$set(C);const K={};_[0]&16&&(K.map=u[4]),d.$set(K)},i(u){if(!f){w(e.$$.fragment,u),w(r.$$.fragment,u);for(let _=0;_<j.length;_+=1)w(E[_]);for(let _=0;_<D.length;_+=1)w(M[_]);w(s.$$.fragment,u),w(m.$$.fragment,u),w(d.$$.fragment,u),f=!0}},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),E=E.filter(Boolean);for(let _=0;_<E.length;_+=1)k(E[_]);M=M.filter(Boolean);for(let _=0;_<M.length;_+=1)k(M[_]);k(s.$$.fragment,u),k(m.$$.fragment,u),k(d.$$.fragment,u),f=!1},d(u){u&&(y(n),y(o),y(l),y(i),y(a),y(g)),T(e,u),T(r,u),Oe(E,u),Oe(M,u),T(s,u),T(m,u),T(d,u)}}}function Ir(t){let e,n,r;function o(i){t[29](i)}let l={$$slots:{default:[Sr]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.map=t[4]),e=new un({props:l}),te.push(()=>re(e,"map",o)),{c(){S(e.$$.fragment)},l(i){I(e.$$.fragment,i)},m(i,s){F(e,i,s),r=!0},p(i,s){const a={};s[0]&63|s[1]&256&&(a.$$scope={dirty:s,ctx:i}),!n&&s[0]&16&&(n=!0,a.map=i[4],ne(()=>n=!1)),e.$set(a)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){T(e,i)}}}function yt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Fr(t){return String.fromCharCode(t+65)}function Tr(t,e,n){let r,o;Re(t,Q,$=>n(3,o=$));let{junctionIdx:l}=e,{stage:i}=e,{newKind:s}=e,{editing:a}=e,{hoveringSidebar:m}=e,{streetviewOn:g}=e,{showContext:d}=e,f,j={0:Ge.red.background,1:Ge.amber.background,2:Ge.green.background,X:Ge.critical.background};function E($,G,z){let he={type:"FeatureCollection",features:[]},W=G??z;return W!=null&&(W.kind=="arm"?he.features.push(yt($.jat[l][i].arms[W.idx],W.idx)):he.features.push(u($.jat[l][i].movements[W.idx],W.idx))),he}function O($){n(11,a=$),n(12,m=null)}function D($){if(!g){for(let G of f.queryRenderedFeatures($.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a!=null){n(11,a=null);return}s=="arm"?(qe(Q,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:$.detail.lngLat.toArray(),name:""}],o),n(11,a={kind:"arm",idx:o.jat[l][i].arms.length-1})):(qe(Q,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:$.detail.lngLat.toArray(),point2:pt($.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:pt($.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(11,a={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(12,m=null)}}function M($){O({kind:"movement",idx:$.detail.features[0].id})}rn(()=>{h(!1)});function b($){let G={type:"FeatureCollection",features:$.jat[l][i].movements.map((z,he)=>u(z,he))};for(let z of $.jat[l][i].movements)if(G.features.push(_(z,G.features.length)),z.kind=="walking & wheeling"){let he={...z,point1:z.point3,point3:z.point1};G.features.push(_(he,G.features.length))}return G}function u($,G){return{type:"Feature",id:G,properties:{name:$.name,kind:$.kind,color:j[$.score]},geometry:{type:"LineString",coordinates:[$.point1,$.point2,$.point3]}}}function _($,G){return{type:"Feature",id:G,properties:{kind:$.kind,color:j[$.score],angle:yr($.point2,$.point3)},geometry:{type:"Point",coordinates:$.point3}}}function h($){let G=b(o);for(let z of o.jat[l][i].arms)G.features.push(yt(z,G.features.length));for(let z of o.summary.networkMap.features)G.features.push(z);G.features.length>0&&f.fitBounds(fn(G),{padding:20,animate:$})}function p(){return f}function C($,G){t.$$.not_equal(G.point,$)&&(G.point=$,Q.set(o))}const K=$=>O({kind:"arm",idx:$}),P=$=>O({kind:"arm",idx:$});function U($,G){t.$$.not_equal(G.point1,$)&&(G.point1=$,Q.set(o))}const me=$=>O({kind:"movement",idx:$}),A=$=>O({kind:"movement",idx:$});function $e($,G){t.$$.not_equal(G.point2,$)&&(G.point2=$,Q.set(o))}const le=$=>O({kind:"movement",idx:$}),Me=$=>O({kind:"movement",idx:$});function je($,G){t.$$.not_equal(G.point3,$)&&(G.point3=$,Q.set(o))}const q=$=>O({kind:"movement",idx:$}),Z=$=>O({kind:"movement",idx:$});function We($){f=$,n(4,f)}return t.$$set=$=>{"junctionIdx"in $&&n(0,l=$.junctionIdx),"stage"in $&&n(1,i=$.stage),"newKind"in $&&n(13,s=$.newKind),"editing"in $&&n(11,a=$.editing),"hoveringSidebar"in $&&n(12,m=$.hoveringSidebar),"streetviewOn"in $&&n(14,g=$.streetviewOn),"showContext"in $&&n(2,d=$.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=E(o,a,m))},[l,i,d,o,f,r,j,O,D,M,b,a,m,s,g,h,p,C,K,P,U,me,A,$e,le,Me,je,q,Z,We]}class qr extends Be{constructor(e){super(),Ne(this,e,Tr,Ir,Pe,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Or(t){let e,n,r,o,l,i,s,a,m,g,d,f;function j(h){t[5](h)}let E={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(E.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new tt({props:E}),te.push(()=>re(e,"value",j));function O(h){t[6](h)}let D={legend:"Movement",choices:Ot(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(D.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Tt({props:D}),te.push(()=>re(o,"value",O));function M(h){t[7](h)}let b={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(b.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),s=new vn({props:b}),te.push(()=>re(s,"value",M));function u(h){t[8](h)}let _={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),g=new qt({props:_}),te.push(()=>re(g,"value",u)),{c(){S(e.$$.fragment),r=B(),S(o.$$.fragment),i=B(),S(s.$$.fragment),m=B(),S(g.$$.fragment)},l(h){I(e.$$.fragment,h),r=N(h),I(o.$$.fragment,h),i=N(h),I(s.$$.fragment,h),m=N(h),I(g.$$.fragment,h)},m(h,p){F(e,h,p),v(h,r,p),F(o,h,p),v(h,i,p),F(s,h,p),v(h,m,p),F(g,h,p),f=!0},p(h,[p]){const C={};!n&&p&15&&(n=!0,C.value=h[3].jat[h[0]][h[1]].movements[h[2]].name,ne(()=>n=!1)),e.$set(C);const K={};!l&&p&15&&(l=!0,K.value=h[3].jat[h[0]][h[1]].movements[h[2]].kind,ne(()=>l=!1)),o.$set(K);const P={};!a&&p&15&&(a=!0,P.value=h[3].jat[h[0]][h[1]].movements[h[2]].score,ne(()=>a=!1)),s.$set(P);const U={};!d&&p&15&&(d=!0,U.value=h[3].jat[h[0]][h[1]].movements[h[2]].notes,ne(()=>d=!1)),g.$set(U)},i(h){f||(w(e.$$.fragment,h),w(o.$$.fragment,h),w(s.$$.fragment,h),w(g.$$.fragment,h),f=!0)},o(h){k(e.$$.fragment,h),k(o.$$.fragment,h),k(s.$$.fragment,h),k(g.$$.fragment,h),f=!1},d(h){h&&(y(r),y(i),y(m)),T(e,h),T(o,h),T(s,h),T(g,h)}}}function Br(t,e,n){let r;Re(t,Q,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e;Ot(["cycling","walking & wheeling"]);let s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(f){t.$$.not_equal(r.jat[o][l].movements[i].name,f)&&(r.jat[o][l].movements[i].name=f,Q.set(r))}function m(f){t.$$.not_equal(r.jat[o][l].movements[i].kind,f)&&(r.jat[o][l].movements[i].kind=f,Q.set(r))}function g(f){t.$$.not_equal(r.jat[o][l].movements[i].score,f)&&(r.jat[o][l].movements[i].score=f,Q.set(r))}function d(f){t.$$.not_equal(r.jat[o][l].movements[i].notes,f)&&(r.jat[o][l].movements[i].notes=f,Q.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,l=f.stage),"idx"in f&&n(2,i=f.idx)},[o,l,i,r,s,a,m,g,d]}class Nr extends Be{constructor(e){super(),Ne(this,e,Br,Or,Pe,{junctionIdx:0,stage:1,idx:2})}}const{window:Gr}=gn;function wt(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function vt(t,e,n){const r=t.slice();return r[33]=e[n],r[32]=n,r}function zr(t){let e,n,r,o,l,i,s,a;e=new yn({props:{$$slots:{default:[Ur]},$$scope:{ctx:t}}}),e.$on("click",t[26]),r=new St({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const m=[Hr,Jr],g=[];function d(f,j){return f[3].kind=="movement"?0:1}return l=d(t),i=g[l]=m[l](t),{c(){S(e.$$.fragment),n=B(),S(r.$$.fragment),o=B(),i.c(),s=be()},l(f){I(e.$$.fragment,f),n=N(f),I(r.$$.fragment,f),o=N(f),i.l(f),s=be()},m(f,j){F(e,f,j),v(f,n,j),F(r,f,j),v(f,o,j),g[l].m(f,j),v(f,s,j),a=!0},p(f,j){const E={};j[1]&16&&(E.$$scope={dirty:j,ctx:f}),e.$set(E);const O={};j[1]&16&&(O.$$scope={dirty:j,ctx:f}),r.$set(O);let D=l;l=d(f),l===D?g[l].p(f,j):(ce(),k(g[D],1,1,()=>{g[D]=null}),ge(),i=g[l],i?i.p(f,j):(i=g[l]=m[l](f),i.c()),w(i,1),i.m(s.parentNode,s))},i(f){a||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(i),a=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(i),a=!1},d(f){f&&(y(n),y(o),y(s)),T(e,f),T(r,f),g[l].d(f)}}}function Dr(t){let e,n,r,o,l,i,s,a=(t[8].jat[t[0]].name||"Untitled junction")+"",m,g,d,f,j,E,O,D="Arms",M,b,u,_,h,p="Movements",C,K,P,U,me;e=new wn({props:{label:"Tools",$$slots:{default:[Vr]},$$scope:{ctx:t}}});function A(c,L){return c[8].jat[c[0]][c[1]].movements.length>0?Zr:Wr}let $e=A(t),le=$e(t);function Me(c){t[19](c)}let je={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(je.value=t[2]),f=new Tt({props:je}),te.push(()=>re(f,"value",Me));let q=pe(t[8].jat[t[0]][t[1]].arms),Z=[];for(let c=0;c<q.length;c+=1)Z[c]=kt(vt(t,q,c));const We=c=>k(Z[c],1,1,()=>{Z[c]=null});let $=t[8].jat[t[0]][t[9]].arms.length>0&&jt(t),G=pe(t[8].jat[t[0]][t[1]].movements),z=[];for(let c=0;c<G.length;c+=1)z[c]=Et(wt(t,G,c));const he=c=>k(z[c],1,1,()=>{z[c]=null});let W=t[8].jat[t[0]][t[9]].movements.length>0&&Ct(t);return{c(){S(e.$$.fragment),n=B(),r=x("p"),o=J("Total JAT score for "),l=J(t[1]),i=B(),s=x("u"),m=J(a),g=J(`
        :
        `),le.c(),d=B(),S(f.$$.fragment),E=B(),O=x("h3"),O.textContent=D,M=B(),b=x("ul");for(let c=0;c<Z.length;c+=1)Z[c].c();u=B(),$&&$.c(),_=B(),h=x("h3"),h.textContent=p,C=B(),K=x("ol");for(let c=0;c<z.length;c+=1)z[c].c();P=B(),W&&W.c(),U=be()},l(c){I(e.$$.fragment,c),n=N(c),r=ee(c,"P",{});var L=ie(r);o=H(L,"Total JAT score for "),l=H(L,t[1]),i=N(L),s=ee(L,"U",{});var ae=ie(s);m=H(ae,a),ae.forEach(y),g=H(L,`
        :
        `),le.l(L),L.forEach(y),d=N(c),I(f.$$.fragment,c),E=N(c),O=ee(c,"H3",{"data-svelte-h":!0}),ft(O)!=="svelte-ld74qb"&&(O.textContent=D),M=N(c),b=ee(c,"UL",{});var Se=ie(b);for(let se=0;se<Z.length;se+=1)Z[se].l(Se);Se.forEach(y),u=N(c),$&&$.l(c),_=N(c),h=ee(c,"H3",{"data-svelte-h":!0}),ft(h)!=="svelte-1dc52s8"&&(h.textContent=p),C=N(c),K=ee(c,"OL",{});var R=ie(K);for(let se=0;se<z.length;se+=1)z[se].l(R);R.forEach(y),P=N(c),W&&W.l(c),U=be()},m(c,L){F(e,c,L),v(c,n,L),v(c,r,L),oe(r,o),oe(r,l),oe(r,i),oe(r,s),oe(s,m),oe(r,g),le.m(r,null),v(c,d,L),F(f,c,L),v(c,E,L),v(c,O,L),v(c,M,L),v(c,b,L);for(let ae=0;ae<Z.length;ae+=1)Z[ae]&&Z[ae].m(b,null);v(c,u,L),$&&$.m(c,L),v(c,_,L),v(c,h,L),v(c,C,L),v(c,K,L);for(let ae=0;ae<z.length;ae+=1)z[ae]&&z[ae].m(K,null);v(c,P,L),W&&W.m(c,L),v(c,U,L),me=!0},p(c,L){const ae={};L[0]&224|L[1]&16&&(ae.$$scope={dirty:L,ctx:c}),e.$set(ae),(!me||L[0]&2)&&de(l,c[1]),(!me||L[0]&257)&&a!==(a=(c[8].jat[c[0]].name||"Untitled junction")+"")&&de(m,a),$e===($e=A(c))&&le?le.p(c,L):(le.d(1),le=$e(c),le&&(le.c(),le.m(r,null)));const Se={};if(!j&&L[0]&4&&(j=!0,Se.value=c[2],ne(()=>j=!1)),f.$set(Se),L[0]&1299){q=pe(c[8].jat[c[0]][c[1]].arms);let R;for(R=0;R<q.length;R+=1){const se=vt(c,q,R);Z[R]?(Z[R].p(se,L),w(Z[R],1)):(Z[R]=kt(se),Z[R].c(),w(Z[R],1),Z[R].m(b,null))}for(ce(),R=q.length;R<Z.length;R+=1)We(R);ge()}if(c[8].jat[c[0]][c[9]].arms.length>0?$?($.p(c,L),L[0]&257&&w($,1)):($=jt(c),$.c(),w($,1),$.m(_.parentNode,_)):$&&(ce(),k($,1,1,()=>{$=null}),ge()),L[0]&1299){G=pe(c[8].jat[c[0]][c[1]].movements);let R;for(R=0;R<G.length;R+=1){const se=wt(c,G,R);z[R]?(z[R].p(se,L),w(z[R],1)):(z[R]=Et(se),z[R].c(),w(z[R],1),z[R].m(K,null))}for(ce(),R=G.length;R<z.length;R+=1)he(R);ge()}c[8].jat[c[0]][c[9]].movements.length>0?W?(W.p(c,L),L[0]&257&&w(W,1)):(W=Ct(c),W.c(),w(W,1),W.m(U.parentNode,U)):W&&(ce(),k(W,1,1,()=>{W=null}),ge())},i(c){if(!me){w(e.$$.fragment,c),w(f.$$.fragment,c);for(let L=0;L<q.length;L+=1)w(Z[L]);w($);for(let L=0;L<G.length;L+=1)w(z[L]);w(W),me=!0}},o(c){k(e.$$.fragment,c),k(f.$$.fragment,c),Z=Z.filter(Boolean);for(let L=0;L<Z.length;L+=1)k(Z[L]);k($),z=z.filter(Boolean);for(let L=0;L<z.length;L+=1)k(z[L]);k(W),me=!1},d(c){c&&(y(n),y(r),y(d),y(E),y(O),y(M),y(b),y(u),y(_),y(h),y(C),y(K),y(P),y(U)),T(e,c),le.d(),T(f,c),Oe(Z,c),$&&$.d(c),Oe(z,c),W&&W.d(c)}}}function Ur(t){let e;return{c(){e=J("Save")},l(n){e=H(n,"Save")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Rr(t){let e;return{c(){e=J("Delete")},l(n){e=H(n,"Delete")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Jr(t){let e,n,r;function o(i){t[27](i)}let l={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new tt({props:l}),te.push(()=>re(e,"value",o)),{c(){S(e.$$.fragment)},l(i){I(e.$$.fragment,i)},m(i,s){F(e,i,s),r=!0},p(i,s){const a={};!n&&s[0]&267&&(n=!0,a.value=i[8].jat[i[0]][i[1]].arms[i[3].idx].name,ne(()=>n=!1)),e.$set(a)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){T(e,i)}}}function Hr(t){let e,n;return e=new Nr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Kr(t){let e;return{c(){e=J("Zoom to fit")},l(n){e=H(n,"Zoom to fit")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Xr(t){let e;return{c(){e=J("Show scheme context")},l(n){e=H(n,"Show scheme context")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Vr(t){var M;let e,n,r,o,l,i,s,a,m,g,d,f;e=new _e({props:{$$slots:{default:[Kr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new _n({}),l=new hn({});function j(b){t[17](b)}let E={map:(M=t[7])==null?void 0:M.getMap()};t[5]!==void 0&&(E.enabled=t[5]),s=new $n({props:E}),te.push(()=>re(s,"enabled",j));function O(b){t[18](b)}let D={$$slots:{default:[Xr]},$$scope:{ctx:t}};return t[6]!==void 0&&(D.checked=t[6]),g=new bn({props:D}),te.push(()=>re(g,"checked",O)),{c(){S(e.$$.fragment),n=B(),S(r.$$.fragment),o=B(),S(l.$$.fragment),i=B(),S(s.$$.fragment),m=B(),S(g.$$.fragment)},l(b){I(e.$$.fragment,b),n=N(b),I(r.$$.fragment,b),o=N(b),I(l.$$.fragment,b),i=N(b),I(s.$$.fragment,b),m=N(b),I(g.$$.fragment,b)},m(b,u){F(e,b,u),v(b,n,u),F(r,b,u),v(b,o,u),F(l,b,u),v(b,i,u),F(s,b,u),v(b,m,u),F(g,b,u),f=!0},p(b,u){var C;const _={};u[1]&16&&(_.$$scope={dirty:u,ctx:b}),e.$set(_);const h={};u[0]&128&&(h.map=(C=b[7])==null?void 0:C.getMap()),!a&&u[0]&32&&(a=!0,h.enabled=b[5],ne(()=>a=!1)),s.$set(h);const p={};u[1]&16&&(p.$$scope={dirty:u,ctx:b}),!d&&u[0]&64&&(d=!0,p.checked=b[6],ne(()=>d=!1)),g.$set(p)},i(b){f||(w(e.$$.fragment,b),w(r.$$.fragment,b),w(l.$$.fragment,b),w(s.$$.fragment,b),w(g.$$.fragment,b),f=!0)},o(b){k(e.$$.fragment,b),k(r.$$.fragment,b),k(l.$$.fragment,b),k(s.$$.fragment,b),k(g.$$.fragment,b),f=!1},d(b){b&&(y(n),y(o),y(i),y(m)),T(e,b),T(r,b),T(l,b),T(s,b),T(g,b)}}}function Wr(t){let e;return{c(){e=J("No movements added")},l(n){e=H(n,"No movements added")},m(n,r){v(n,e,r)},p:Ae,d(n){n&&y(e)}}}function Zr(t){let e=Lt(t[8].jat[t[0]][t[1]]).toFixed(1)+"",n,r;return{c(){n=J(e),r=J("%")},l(o){n=H(o,e),r=H(o,"%")},m(o,l){v(o,n,l),v(o,r,l)},p(o,l){l[0]&259&&e!==(e=Lt(o[8].jat[o[0]][o[1]]).toFixed(1)+"")&&de(n,e)},d(o){o&&(y(n),y(r))}}}function Qr(t){let e=no(t[32])+"",n,r,o=(t[33].name||"Unnamed arm")+"",l;return{c(){n=J(e),r=J(" - "),l=J(o)},l(i){n=H(i,e),r=H(i," - "),l=H(i,o)},m(i,s){v(i,n,s),v(i,r,s),v(i,l,s)},p(i,s){s[0]&259&&o!==(o=(i[33].name||"Unnamed arm")+"")&&de(l,o)},d(i){i&&(y(n),y(r),y(l))}}}function kt(t){let e,n,r,o;function l(){return t[20](t[32])}function i(){return t[21](t[32])}return n=new _e({props:{$$slots:{default:[Qr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[22]),{c(){e=x("li"),S(n.$$.fragment),r=B()},l(s){e=ee(s,"LI",{});var a=ie(e);I(n.$$.fragment,a),r=N(a),a.forEach(y)},m(s,a){v(s,e,a),F(n,e,null),oe(e,r),o=!0},p(s,a){t=s;const m={};a[0]&259|a[1]&16&&(m.$$scope={dirty:a,ctx:t}),n.$set(m)},i(s){o||(w(n.$$.fragment,s),o=!0)},o(s){k(n.$$.fragment,s),o=!1},d(s){s&&y(e),T(n)}}}function jt(t){let e,n;return e=new _e({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function Yr(t){let e,n;return{c(){e=J("Copy arms from "),n=J(t[9])},l(r){e=H(r,"Copy arms from "),n=H(r,t[9])},m(r,o){v(r,e,o),v(r,n,o)},p:Ae,d(r){r&&(y(e),y(n))}}}function xr(t){let e=(t[30].name||"Unnamed movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o[0]&259&&e!==(e=(r[30].name||"Unnamed movement")+"")&&de(n,e)},d(r){r&&y(n)}}}function Et(t){let e,n,r,o;function l(){return t[23](t[32])}function i(){return t[24](t[32])}return n=new _e({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[25]),{c(){e=x("li"),S(n.$$.fragment),r=B()},l(s){e=ee(s,"LI",{});var a=ie(e);I(n.$$.fragment,a),r=N(a),a.forEach(y)},m(s,a){v(s,e,a),F(n,e,null),oe(e,r),o=!0},p(s,a){t=s;const m={};a[0]&259|a[1]&16&&(m.$$scope={dirty:a,ctx:t}),n.$set(m)},i(s){o||(w(n.$$.fragment,s),o=!0)},o(s){k(n.$$.fragment,s),o=!1},d(s){s&&y(e),T(n)}}}function Ct(t){let e,n;return e=new _e({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function eo(t){let e,n;return{c(){e=J("Copy movements from "),n=J(t[9])},l(r){e=H(r,"Copy movements from "),n=H(r,t[9])},m(r,o){v(r,e,o),v(r,n,o)},p:Ae,d(r){r&&(y(e),y(n))}}}function to(t){let e,n,r,o,l,i,s,a,m,g,d,f,j,E;function O(p){t[15](p)}let D={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(D.value=t[8].jat[t[0]][t[1]].notes),e=new qt({props:D}),te.push(()=>re(e,"value",O));const M=[Dr,zr],b=[];function u(p,C){return p[3]==null?0:1}i=u(t),s=b[i]=M[i](t);function _(p){t[29](p)}let h={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(h.editing=t[3]),g=new qr({props:h}),t[28](g),te.push(()=>re(g,"editing",_)),{c(){S(e.$$.fragment),r=B(),o=x("div"),l=x("div"),s.c(),a=B(),m=x("div"),S(g.$$.fragment),this.h()},l(p){I(e.$$.fragment,p),r=N(p),o=ee(p,"DIV",{style:!0});var C=ie(o);l=ee(C,"DIV",{style:!0});var K=ie(l);s.l(K),K.forEach(y),a=N(C),m=ee(C,"DIV",{style:!0});var P=ie(m);I(g.$$.fragment,P),P.forEach(y),C.forEach(y),this.h()},h(){Y(l,"width","30%"),Y(l,"overflow-y","scroll"),Y(l,"padding","10px"),Y(l,"border","1px solid black"),Y(m,"position","relative"),Y(m,"width","100%"),Y(o,"display","flex"),Y(o,"height","80vh")},m(p,C){F(e,p,C),v(p,r,C),v(p,o,C),oe(o,l),b[i].m(l,null),oe(o,a),oe(o,m),F(g,m,null),f=!0,j||(E=on(Gr,"keydown",t[12]),j=!0)},p(p,C){const K={};!n&&C[0]&259&&(n=!0,K.value=p[8].jat[p[0]][p[1]].notes,ne(()=>n=!1)),e.$set(K);let P=i;i=u(p),i===P?b[i].p(p,C):(ce(),k(b[P],1,1,()=>{b[P]=null}),ge(),s=b[i],s?s.p(p,C):(s=b[i]=M[i](p),s.c()),w(s,1),s.m(l,null));const U={};C[0]&1&&(U.junctionIdx=p[0]),C[0]&2&&(U.stage=p[1]),C[0]&4&&(U.newKind=p[2]),C[0]&16&&(U.hoveringSidebar=p[4]),C[0]&32&&(U.streetviewOn=p[5]),C[0]&64&&(U.showContext=p[6]),!d&&C[0]&8&&(d=!0,U.editing=p[3],ne(()=>d=!1)),g.$set(U)},i(p){f||(w(e.$$.fragment,p),w(s),w(g.$$.fragment,p),f=!0)},o(p){k(e.$$.fragment,p),k(s),k(g.$$.fragment,p),f=!1},d(p){p&&(y(r),y(o)),T(e,p),b[i].d(),t[28](null),T(g),j=!1,E()}}}function no(t){return String.fromCharCode(t+65)}function Lt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function ro(t,e,n){let r;Re(t,Q,q=>n(8,r=q));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",s="arm",a=null,m=null,g=!1,d=!0,f=null;function j(q){n(3,a=q),n(4,m=null)}function E(){window.confirm(`Delete this ${a.kind}?`)&&(a.kind=="movement"?(r.jat[o][l].movements.splice(a.idx,1),Q.set(r)):(r.jat[o][l].arms.splice(a.idx,1),Q.set(r)),n(3,a=null))}function O(q){a!=null&&q.key=="Escape"?(q.stopPropagation(),n(3,a=null)):a!=null&&q.key=="Delete"&&E()}function D(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(qe(Q,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),Q.set(r))}function M(){r.jat[o][l].movements.length>0&&!window.confirm("Overwrite movements?")||(qe(Q,r.jat[o][l].movements=JSON.parse(JSON.stringify(r.jat[o][i].movements)),r),Q.set(r))}function b(q){t.$$.not_equal(r.jat[o][l].notes,q)&&(r.jat[o][l].notes=q,Q.set(r))}const u=()=>f==null?void 0:f.zoom(!0);function _(q){g=q,n(5,g)}function h(q){d=q,n(6,d)}function p(q){s=q,n(2,s)}const C=q=>j({kind:"arm",idx:q}),K=q=>n(4,m={kind:"arm",idx:q}),P=()=>n(4,m=null),U=q=>j({kind:"movement",idx:q}),me=q=>n(4,m={kind:"movement",idx:q}),A=()=>n(4,m=null),$e=()=>n(3,a=null);function le(q){t.$$.not_equal(r.jat[o][l].arms[a.idx].name,q)&&(r.jat[o][l].arms[a.idx].name=q,Q.set(r))}function Me(q){te[q?"unshift":"push"](()=>{f=q,n(7,f)})}function je(q){a=q,n(3,a)}return t.$$set=q=>{"junctionIdx"in q&&n(0,o=q.junctionIdx),"stage"in q&&n(1,l=q.stage)},[o,l,s,a,m,g,d,f,r,i,j,E,O,D,M,b,u,_,h,p,C,K,P,U,me,A,$e,le,Me,je]}class oo extends Be{constructor(e){super(),Ne(this,e,ro,to,Pe,{junctionIdx:0,stage:1},null,[-1,-1])}}function Pt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function io(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,s,a,m,g,d,f,j=t[0].stage,E,O;a=new ln({props:{$$slots:{default:[go]},$$scope:{ctx:t}}});function D(u){t[9](u)}let M={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(M.value=t[1].jat[t[0].idx].name),g=new tt({props:M}),te.push(()=>re(g,"value",D));let b=At(t);return{c(){e=x("h2"),r=J(n),o=J(" - "),i=J(l),s=B(),S(a.$$.fragment),m=B(),S(g.$$.fragment),f=B(),b.c(),E=be()},l(u){e=ee(u,"H2",{});var _=ie(e);r=H(_,n),o=H(_," - "),i=H(_,l),_.forEach(y),s=N(u),I(a.$$.fragment,u),m=N(u),I(g.$$.fragment,u),f=N(u),b.l(u),E=be()},m(u,_){v(u,e,_),oe(e,r),oe(e,o),oe(e,i),v(u,s,_),F(a,u,_),v(u,m,_),F(g,u,_),v(u,f,_),b.m(u,_),v(u,E,_),O=!0},p(u,_){(!O||_&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&de(r,n),(!O||_&1)&&l!==(l=u[0].stage+"")&&de(i,l);const h={};_&8193&&(h.$$scope={dirty:_,ctx:u}),a.$set(h);const p={};!d&&_&3&&(d=!0,p.value=u[1].jat[u[0].idx].name,ne(()=>d=!1)),g.$set(p),_&1&&Pe(j,j=u[0].stage)?(ce(),k(b,1,1,Ae),ge(),b=At(u),b.c(),w(b,1),b.m(E.parentNode,E)):b.p(u,_)},i(u){O||(w(a.$$.fragment,u),w(g.$$.fragment,u),w(b),O=!0)},o(u){k(a.$$.fragment,u),k(g.$$.fragment,u),k(b),O=!1},d(u){u&&(y(e),y(s),y(m),y(f),y(E)),T(a,u),T(g,u),b.d(u)}}}function lo(t){let e,n,r,o;e=new _e({props:{$$slots:{default:[po]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=pe(t[1].jat),i=[];for(let a=0;a<l.length;a+=1)i[a]=Mt(Pt(t,l,a));const s=a=>k(i[a],1,1,()=>{i[a]=null});return{c(){S(e.$$.fragment),n=B(),r=x("ol");for(let a=0;a<i.length;a+=1)i[a].c()},l(a){I(e.$$.fragment,a),n=N(a),r=ee(a,"OL",{});var m=ie(r);for(let g=0;g<i.length;g+=1)i[g].l(m);m.forEach(y)},m(a,m){F(e,a,m),v(a,n,m),v(a,r,m);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(r,null);o=!0},p(a,m){const g={};if(m&8192&&(g.$$scope={dirty:m,ctx:a}),e.$set(g),m&3){l=pe(a[1].jat);let d;for(d=0;d<l.length;d+=1){const f=Pt(a,l,d);i[d]?(i[d].p(f,m),w(i[d],1)):(i[d]=Mt(f),i[d].c(),w(i[d],1),i[d].m(r,null))}for(ce(),d=l.length;d<i.length;d+=1)s(d);ge()}},i(a){if(!o){w(e.$$.fragment,a);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(a){k(e.$$.fragment,a),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)k(i[m]);o=!1},d(a){a&&(y(n),y(r)),T(e,a),Oe(i,a)}}}function ao(t){let e;return{c(){e=J("Back to all junctions")},l(n){e=H(n,"Back to all junctions")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function so(t){let e,n;return e=new _e({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function uo(t){let e,n;return e=new _e({props:{$$slots:{default:[mo]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function fo(t){let e;return{c(){e=J("Edit Proposed")},l(n){e=H(n,"Edit Proposed")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function mo(t){let e;return{c(){e=J("Edit Existing")},l(n){e=H(n,"Edit Existing")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function co(t){let e;return{c(){e=J("Delete")},l(n){e=H(n,"Delete")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function go(t){let e,n,r,o,l,i,s;e=new _e({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const a=[uo,so],m=[];function g(d,f){return d[0].stage=="proposed"?0:1}return r=g(t),o=m[r]=a[r](t),i=new St({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){S(e.$$.fragment),n=B(),o.c(),l=B(),S(i.$$.fragment)},l(d){I(e.$$.fragment,d),n=N(d),o.l(d),l=N(d),I(i.$$.fragment,d)},m(d,f){F(e,d,f),v(d,n,f),m[r].m(d,f),v(d,l,f),F(i,d,f),s=!0},p(d,f){const j={};f&8192&&(j.$$scope={dirty:f,ctx:d}),e.$set(j);let E=r;r=g(d),r===E?m[r].p(d,f):(ce(),k(m[E],1,1,()=>{m[E]=null}),ge(),o=m[r],o?o.p(d,f):(o=m[r]=a[r](d),o.c()),w(o,1),o.m(l.parentNode,l));const O={};f&8192&&(O.$$scope={dirty:f,ctx:d}),i.$set(O)},i(d){s||(w(e.$$.fragment,d),w(o),w(i.$$.fragment,d),s=!0)},o(d){k(e.$$.fragment,d),k(o),k(i.$$.fragment,d),s=!1},d(d){d&&(y(n),y(l)),T(e,d),m[r].d(d),T(i,d)}}}function At(t){let e,n;return e=new oo({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){S(e.$$.fragment)},l(r){I(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){T(e,r)}}}function po(t){let e;return{c(){e=J("Add new junction")},l(n){e=H(n,"Add new junction")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function _o(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&de(n,e)},d(r){r&&y(n)}}}function Mt(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new _e({props:{$$slots:{default:[_o]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=x("li"),S(n.$$.fragment),r=B()},l(i){e=ee(i,"LI",{});var s=ie(e);I(n.$$.fragment,s),r=N(s),s.forEach(y)},m(i,s){v(i,e,s),F(n,e,null),oe(e,r),o=!0},p(i,s){t=i;const a={};s&8194&&(a.$$scope={dirty:s,ctx:t}),n.$set(a)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&y(e),T(n)}}}function ho(t){let e,n,r,o;const l=[lo,io],i=[];function s(a,m){return a[0].kind=="list"?0:a[0].kind=="edit"?1:-1}return~(e=s(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=be()},l(a){n&&n.l(a),r=be()},m(a,m){~e&&i[e].m(a,m),v(a,r,m),o=!0},p(a,[m]){let g=e;e=s(a),e===g?~e&&i[e].p(a,m):(n&&(ce(),k(i[g],1,1,()=>{i[g]=null}),ge()),~e?(n=i[e],n?n.p(a,m):(n=i[e]=l[e](a),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(a){o||(w(n),o=!0)},o(a){k(n),o=!1},d(a){a&&y(r),~e&&i[e].d(a)}}}function Ze(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function $o(t,e,n){let r;Re(t,Q,j=>n(1,r=j));let o={kind:"list"};function l(){qe(Q,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(j){window.confirm("Delete this junction?")&&(r.jat.splice(j,1),Q.set(r),n(0,o={kind:"list"}))}const s=j=>n(0,o={kind:"edit",idx:j,stage:"existing"}),a=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"existing"}),g=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"proposed"}),d=()=>i(Ze(o));function f(j){t.$$.not_equal(r.jat[o.idx].name,j)&&(r.jat[o.idx].name=j,Q.set(r))}return[o,r,l,i,s,a,m,g,d,f]}class qo extends Be{constructor(e){super(),Ne(this,e,$o,ho,Pe,{})}}export{qo as component};
