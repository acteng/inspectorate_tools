import{s as pe,e as W,t as Q,a as D,c as R,b as U,d as X,f as b,g as S,r as T,y as fe,i as w,h as j,j as oe,q as re,O as Ve,C as we,z as le,B as ve,H as He,v as z,x as J,k as be,U as ke,N as ue,w as ne,a8 as Ke,E as Ce,p as me,n as ze,R as de,S as $e}from"../chunks/scheduler.6N1D-Kb4.js";import{S as _e,i as ge,c as B,a as A,m as q,t as C,b as L,d as M,e as Y,g as se,f as ae}from"../chunks/index.D0SxPHfj.js";import{e as te}from"../chunks/each.BSDT5Eol.js";import{c as Je,p as Ye}from"../chunks/colors.CYEpEtTL.js";import{p as Oe}from"../chunks/index.D2cVw_od.js";import{S as ye,W as Ze}from"../chunks/WarningButton.t9b5nnFf.js";import{S as ce}from"../chunks/Select.-i-4UYQ_.js";import{T as We}from"../chunks/TextArea.1Sgk8XzS.js";import{T as Re}from"../chunks/TextInput.Rf9dyvs6.js";import{s as F}from"../chunks/data.DG6Us-0q.js";import{Y as Ge}from"../chunks/YesNo.C1kBDd6j.js";import{D as Qe}from"../chunks/DefaultButton.B7Pfn6zT.js";import{E as Xe,v as xe}from"../chunks/FormElement.DvOxJv-F.js";import{b as et,B as tt,G as nt,a as lt,M as Ue}from"../chunks/GeoreferenceLayer.cZ29TSZZ.js";import{M as it,G as ot}from"../chunks/MapLibreMap.RiIYY2WE.js";import{C as st}from"../chunks/CircleLayer.D04ebVCK.js";const at=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function Le(n,t,l){const e=n.slice();return e[10]=t[l][0],e[11]=t[l][1],e}function Ie(n){let t,l,e,i,c=!1,g,u,f=n[11]+"",h,m,p,_,s,a;return _=Ve(n[9][0]),{c(){t=W("div"),l=W("input"),g=D(),u=W("label"),h=Q(f),p=D(),this.h()},l(v){t=R(v,"DIV",{class:!0});var k=U(t);l=R(k,"INPUT",{class:!0,id:!0,type:!0}),g=S(k),u=R(k,"LABEL",{class:!0,for:!0});var d=U(u);h=X(d,f),d.forEach(b),p=S(k),k.forEach(b),this.h()},h(){T(l,"class","govuk-radios__input"),T(l,"id",e=n[5]+n[10]),T(l,"type","radio"),l.__value=i=n[10],we(l,l.__value),T(u,"class","govuk-label govuk-radios__label"),T(u,"for",m=n[5]+n[10]),T(t,"class","govuk-radios__item"),_.p(l)},m(v,k){w(v,t,k),j(t,l),l.checked=l.__value===n[0],j(t,g),j(t,u),j(u,h),j(t,p),s||(a=[le(l,"change",n[8]),le(l,"change",n[7])],s=!0)},p(v,k){k&4&&e!==(e=v[5]+v[10])&&T(l,"id",e),k&4&&i!==(i=v[10])&&(l.__value=i,we(l,l.__value),c=!0),(c||k&5)&&(l.checked=l.__value===v[0]),k&4&&f!==(f=v[11]+"")&&oe(h,f),k&4&&m!==(m=v[5]+v[10])&&T(u,"for",m)},d(v){v&&b(t),_.r(),s=!1,ve(a)}}}function rt(n){let t,l,e,i,c,g,u,f,h;g=new Xe({props:{errorMessage:n[4]}});let m=te(n[2]),p=[];for(let _=0;_<m.length;_+=1)p[_]=Ie(Le(n,m,_));return{c(){t=W("div"),l=W("fieldset"),e=W("legend"),i=Q(n[1]),c=D(),B(g.$$.fragment),u=D(),f=W("div");for(let _=0;_<p.length;_+=1)p[_].c();this.h()},l(_){t=R(_,"DIV",{class:!0});var s=U(t);l=R(s,"FIELDSET",{class:!0});var a=U(l);e=R(a,"LEGEND",{class:!0});var v=U(e);i=X(v,n[1]),v.forEach(b),c=S(a),A(g.$$.fragment,a),u=S(a),f=R(a,"DIV",{class:!0,"data-module":!0});var k=U(f);for(let d=0;d<p.length;d+=1)p[d].l(k);k.forEach(b),a.forEach(b),s.forEach(b),this.h()},h(){T(e,"class","govuk-fieldset__legend govuk-label--s"),T(f,"class","govuk-radios"),T(f,"data-module","govuk-radios"),fe(f,"govuk-radios--inline",n[3]),fe(f,"govuk-radios--small",n[3]),T(l,"class","govuk-fieldset"),T(t,"class","govuk-form-group")},m(_,s){w(_,t,s),j(t,l),j(l,e),j(e,i),j(l,c),q(g,l,null),j(l,u),j(l,f);for(let a=0;a<p.length;a+=1)p[a]&&p[a].m(f,null);h=!0},p(_,[s]){(!h||s&2)&&oe(i,_[1]);const a={};if(s&16&&(a.errorMessage=_[4]),g.$set(a),s&37){m=te(_[2]);let v;for(v=0;v<m.length;v+=1){const k=Le(_,m,v);p[v]?p[v].p(k,s):(p[v]=Ie(k),p[v].c(),p[v].m(f,null))}for(;v<p.length;v+=1)p[v].d(1);p.length=m.length}(!h||s&8)&&fe(f,"govuk-radios--inline",_[3]),(!h||s&8)&&fe(f,"govuk-radios--small",_[3])},i(_){h||(C(g.$$.fragment,_),h=!0)},o(_){L(g.$$.fragment,_),h=!1},d(_){_&&b(t),M(g),re(p,_)}}}function ft(n,t,l){let e,{legend:i}=t,{choices:c}=t,{inlineSmall:g=!1}=t,{required:u=!1}=t,{value:f}=t,h=xe();const m=[[]];function p(s){He.call(this,n,s)}function _(){f=this.__value,l(0,f)}return n.$$set=s=>{"legend"in s&&l(1,i=s.legend),"choices"in s&&l(2,c=s.choices),"inlineSmall"in s&&l(3,g=s.inlineSmall),"required"in s&&l(6,u=s.required),"value"in s&&l(0,f=s.value)},n.$$.update=()=>{n.$$.dirty&65&&l(4,e=u&&f==""?"Required":"")},[f,i,c,g,e,h,u,p,_,m]}class ut extends _e{constructor(t){super(),ge(this,t,ft,rt,pe,{legend:1,choices:2,inlineSmall:3,required:6,value:0})}}function Ee(n){let t,l;return t=new ye({props:{$$slots:{default:[ct]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){B(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const c={};i&2050&&(c.$$scope={dirty:i,ctx:e}),t.$set(c)},i(e){l||(C(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function ct(n){let t,l;return{c(){t=Q("Use lookup: "),l=Q(n[1])},l(e){t=X(e,"Use lookup: "),l=X(e,n[1])},m(e,i){w(e,t,i),w(e,l,i)},p(e,i){i&2&&oe(l,e[1])},d(e){e&&(b(t),b(l))}}}function pt(n){let t,l,e,i,c,g,u,f,h,m,p,_,s,a,v,k;function d(o){n[5](o)}let I={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(I.value=n[2].criticalIssues[n[0]].criticalIssue),t=new ce({props:I}),z.push(()=>Y(t,"value",d));function V(o){n[6](o)}let G={label:"Stage",emptyOption:!0,choices:Oe(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(G.value=n[2].criticalIssues[n[0]].stage),i=new ce({props:G}),z.push(()=>Y(i,"value",V));function Z(o){n[7](o)}let x={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(x.value=n[2].criticalIssues[n[0]].locationName),u=new Re({props:x}),z.push(()=>Y(u,"value",Z));let y=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&Ee(n);function ie(o){n[8](o)}let H={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(H.value=n[2].criticalIssues[n[0]].resolved),p=new Ge({props:H}),z.push(()=>Y(p,"value",ie));function P(o){n[9](o)}let K={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(K.value=n[2].criticalIssues[n[0]].notes),a=new We({props:K}),z.push(()=>Y(a,"value",P)),{c(){B(t.$$.fragment),e=D(),B(i.$$.fragment),g=D(),B(u.$$.fragment),h=D(),y&&y.c(),m=D(),B(p.$$.fragment),s=D(),B(a.$$.fragment)},l(o){A(t.$$.fragment,o),e=S(o),A(i.$$.fragment,o),g=S(o),A(u.$$.fragment,o),h=S(o),y&&y.l(o),m=S(o),A(p.$$.fragment,o),s=S(o),A(a.$$.fragment,o)},m(o,r){q(t,o,r),w(o,e,r),q(i,o,r),w(o,g,r),q(u,o,r),w(o,h,r),y&&y.m(o,r),w(o,m,r),q(p,o,r),w(o,s,r),q(a,o,r),k=!0},p(o,[r]){const $={};!l&&r&5&&(l=!0,$.value=o[2].criticalIssues[o[0]].criticalIssue,J(()=>l=!1)),t.$set($);const N={};!c&&r&5&&(c=!0,N.value=o[2].criticalIssues[o[0]].stage,J(()=>c=!1)),i.$set(N);const O={};!f&&r&5&&(f=!0,O.value=o[2].criticalIssues[o[0]].locationName,J(()=>f=!1)),u.$set(O),o[1]&&o[1]!="Loading"&&o[1]!=o[2].criticalIssues[o[0]].locationName?y?(y.p(o,r),r&7&&C(y,1)):(y=Ee(o),y.c(),C(y,1),y.m(m.parentNode,m)):y&&(se(),L(y,1,1,()=>{y=null}),ae());const E={};!_&&r&5&&(_=!0,E.value=o[2].criticalIssues[o[0]].resolved,J(()=>_=!1)),p.$set(E);const ee={};!v&&r&5&&(v=!0,ee.value=o[2].criticalIssues[o[0]].notes,J(()=>v=!1)),a.$set(ee)},i(o){k||(C(t.$$.fragment,o),C(i.$$.fragment,o),C(u.$$.fragment,o),C(y),C(p.$$.fragment,o),C(a.$$.fragment,o),k=!0)},o(o){L(t.$$.fragment,o),L(i.$$.fragment,o),L(u.$$.fragment,o),L(y),L(p.$$.fragment,o),L(a.$$.fragment,o),k=!1},d(o){o&&(b(e),b(g),b(h),b(m),b(s)),M(t,o),M(i,o),M(u,o),y&&y.d(o),M(p,o),M(a,o)}}}function _t(n,t,l){let e;be(n,F,a=>l(2,e=a));let{idx:i}=t,c=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],g="Loading";ke(async()=>{await u(e.criticalIssues[i].point)});async function u(a){let v=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let d=await(await fetch(v)).json();l(1,g=d.address.road??d.display_name)}catch(k){return console.log(`Location lookup failed: ${k}`),""}}function f(){ue(F,e.criticalIssues[i].locationName=g,e)}function h(a){n.$$.not_equal(e.criticalIssues[i].criticalIssue,a)&&(e.criticalIssues[i].criticalIssue=a,F.set(e))}function m(a){n.$$.not_equal(e.criticalIssues[i].stage,a)&&(e.criticalIssues[i].stage=a,F.set(e))}function p(a){n.$$.not_equal(e.criticalIssues[i].locationName,a)&&(e.criticalIssues[i].locationName=a,F.set(e))}function _(a){n.$$.not_equal(e.criticalIssues[i].resolved,a)&&(e.criticalIssues[i].resolved=a,F.set(e))}function s(a){n.$$.not_equal(e.criticalIssues[i].notes,a)&&(e.criticalIssues[i].notes=a,F.set(e))}return n.$$set=a=>{"idx"in a&&l(0,i=a.idx)},[i,g,e,c,f,h,m,p,_,s]}class gt extends _e{constructor(t){super(),ge(this,t,_t,pt,pe,{idx:0})}}function Ne(n){let t,l;return t=new ye({props:{$$slots:{default:[mt]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){B(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const c={};i&2050&&(c.$$scope={dirty:i,ctx:e}),t.$set(c)},i(e){l||(C(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function mt(n){let t,l;return{c(){t=Q("Use lookup: "),l=Q(n[1])},l(e){t=X(e,"Use lookup: "),l=X(e,n[1])},m(e,i){w(e,t,i),w(e,l,i)},p(e,i){i&2&&oe(l,e[1])},d(e){e&&(b(t),b(l))}}}function dt(n){let t,l,e,i,c,g,u,f,h,m,p,_,s,a,v,k;function d(o){n[5](o)}let I={label:"Policy Conflict",emptyOption:!0,choices:n[3]};n[2].policyConflictLog[n[0]].conflict!==void 0&&(I.value=n[2].policyConflictLog[n[0]].conflict),t=new ce({props:I}),z.push(()=>Y(t,"value",d));function V(o){n[6](o)}let G={label:"Stage",emptyOption:!0,choices:Oe(["Existing","Design"])};n[2].policyConflictLog[n[0]].stage!==void 0&&(G.value=n[2].policyConflictLog[n[0]].stage),i=new ce({props:G}),z.push(()=>Y(i,"value",V));function Z(o){n[7](o)}let x={label:"Location Name"};n[2].policyConflictLog[n[0]].locationName!==void 0&&(x.value=n[2].policyConflictLog[n[0]].locationName),u=new Re({props:x}),z.push(()=>Y(u,"value",Z));let y=n[1]&&n[1]!="Loading"&&n[1]!=n[2].policyConflictLog[n[0]].locationName&&Ne(n);function ie(o){n[8](o)}let H={label:"Resolved by Design"};n[2].policyConflictLog[n[0]].resolved!==void 0&&(H.value=n[2].policyConflictLog[n[0]].resolved),p=new Ge({props:H}),z.push(()=>Y(p,"value",ie));function P(o){n[9](o)}let K={label:"Commentary & Feedback"};return n[2].policyConflictLog[n[0]].notes!==void 0&&(K.value=n[2].policyConflictLog[n[0]].notes),a=new We({props:K}),z.push(()=>Y(a,"value",P)),{c(){B(t.$$.fragment),e=D(),B(i.$$.fragment),g=D(),B(u.$$.fragment),h=D(),y&&y.c(),m=D(),B(p.$$.fragment),s=D(),B(a.$$.fragment)},l(o){A(t.$$.fragment,o),e=S(o),A(i.$$.fragment,o),g=S(o),A(u.$$.fragment,o),h=S(o),y&&y.l(o),m=S(o),A(p.$$.fragment,o),s=S(o),A(a.$$.fragment,o)},m(o,r){q(t,o,r),w(o,e,r),q(i,o,r),w(o,g,r),q(u,o,r),w(o,h,r),y&&y.m(o,r),w(o,m,r),q(p,o,r),w(o,s,r),q(a,o,r),k=!0},p(o,[r]){const $={};!l&&r&5&&(l=!0,$.value=o[2].policyConflictLog[o[0]].conflict,J(()=>l=!1)),t.$set($);const N={};!c&&r&5&&(c=!0,N.value=o[2].policyConflictLog[o[0]].stage,J(()=>c=!1)),i.$set(N);const O={};!f&&r&5&&(f=!0,O.value=o[2].policyConflictLog[o[0]].locationName,J(()=>f=!1)),u.$set(O),o[1]&&o[1]!="Loading"&&o[1]!=o[2].policyConflictLog[o[0]].locationName?y?(y.p(o,r),r&7&&C(y,1)):(y=Ne(o),y.c(),C(y,1),y.m(m.parentNode,m)):y&&(se(),L(y,1,1,()=>{y=null}),ae());const E={};!_&&r&5&&(_=!0,E.value=o[2].policyConflictLog[o[0]].resolved,J(()=>_=!1)),p.$set(E);const ee={};!v&&r&5&&(v=!0,ee.value=o[2].policyConflictLog[o[0]].notes,J(()=>v=!1)),a.$set(ee)},i(o){k||(C(t.$$.fragment,o),C(i.$$.fragment,o),C(u.$$.fragment,o),C(y),C(p.$$.fragment,o),C(a.$$.fragment,o),k=!0)},o(o){L(t.$$.fragment,o),L(i.$$.fragment,o),L(u.$$.fragment,o),L(y),L(p.$$.fragment,o),L(a.$$.fragment,o),k=!1},d(o){o&&(b(e),b(g),b(h),b(m),b(s)),M(t,o),M(i,o),M(u,o),y&&y.d(o),M(p,o),M(a,o)}}}function $t(n,t,l){let e;be(n,F,a=>l(2,e=a));let{idx:i}=t,c=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]],g="Loading";ke(async()=>{await u(e.policyConflictLog[i].point)});async function u(a){let v=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let d=await(await fetch(v)).json();l(1,g=d.address.road??d.display_name)}catch(k){return console.log(`Location lookup failed: ${k}`),""}}function f(){ue(F,e.policyConflictLog[i].locationName=g,e)}function h(a){n.$$.not_equal(e.policyConflictLog[i].conflict,a)&&(e.policyConflictLog[i].conflict=a,F.set(e))}function m(a){n.$$.not_equal(e.policyConflictLog[i].stage,a)&&(e.policyConflictLog[i].stage=a,F.set(e))}function p(a){n.$$.not_equal(e.policyConflictLog[i].locationName,a)&&(e.policyConflictLog[i].locationName=a,F.set(e))}function _(a){n.$$.not_equal(e.policyConflictLog[i].resolved,a)&&(e.policyConflictLog[i].resolved=a,F.set(e))}function s(a){n.$$.not_equal(e.policyConflictLog[i].notes,a)&&(e.policyConflictLog[i].notes=a,F.set(e))}return n.$$set=a=>{"idx"in a&&l(0,i=a.idx)},[i,g,e,c,f,h,m,p,_,s]}class ht extends _e{constructor(t){super(),ge(this,t,$t,dt,pe,{idx:0})}}const{window:vt}=at;function De(n,t,l){const e=n.slice();return e[27]=t[l],e[28]=t,e[29]=l,e}function Se(n,t,l){const e=n.slice();return e[30]=t[l],e[31]=t,e[29]=l,e}function Be(n,t,l){const e=n.slice();return e[27]=t[l],e[29]=l,e}function Ae(n,t,l){const e=n.slice();return e[30]=t[l],e[29]=l,e}function bt(n){let t,l,e,i,c,g,u,f;t=new Qe({props:{$$slots:{default:[yt]},$$scope:{ctx:n}}}),t.$on("click",n[18]),e=new Ze({props:{$$slots:{default:[wt]},$$scope:{ctx:n}}}),e.$on("click",n[7]);const h=[Lt,Ct],m=[];function p(_,s){return _[0].kind=="critical"?0:1}return c=p(n),g=m[c]=h[c](n),{c(){B(t.$$.fragment),l=D(),B(e.$$.fragment),i=D(),g.c(),u=Ce()},l(_){A(t.$$.fragment,_),l=S(_),A(e.$$.fragment,_),i=S(_),g.l(_),u=Ce()},m(_,s){q(t,_,s),w(_,l,s),q(e,_,s),w(_,i,s),m[c].m(_,s),w(_,u,s),f=!0},p(_,s){const a={};s[1]&8&&(a.$$scope={dirty:s,ctx:_}),t.$set(a);const v={};s[1]&8&&(v.$$scope={dirty:s,ctx:_}),e.$set(v);let k=c;c=p(_),c===k?m[c].p(_,s):(se(),L(m[k],1,1,()=>{m[k]=null}),ae(),g=m[c],g?g.p(_,s):(g=m[c]=h[c](_),g.c()),C(g,1),g.m(u.parentNode,u))},i(_){f||(C(t.$$.fragment,_),C(e.$$.fragment,_),C(g),f=!0)},o(_){L(t.$$.fragment,_),L(e.$$.fragment,_),L(g),f=!1},d(_){_&&(b(l),b(i),b(u)),M(t,_),M(e,_),m[c].d(_)}}}function kt(n){let t,l,e,i,c,g,u,f,h,m,p="Click the map to add a pin, or select a pin to fill out data",_,s,a="Critical Issues",v,k,d,I,V="Policy Conflicts",G,Z,x;t=new ye({props:{$$slots:{default:[It]},$$scope:{ctx:n}}}),t.$on("click",n[10]),e=new tt({}),c=new nt({});function y(r){n[11](r)}let ie={legend:"Create new pins",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};n[4]!==void 0&&(ie.value=n[4]),u=new ut({props:ie}),z.push(()=>Y(u,"value",y));let H=te(n[2].criticalIssues),P=[];for(let r=0;r<H.length;r+=1)P[r]=qe(Ae(n,H,r));let K=te(n[2].policyConflictLog),o=[];for(let r=0;r<K.length;r+=1)o[r]=Me(Be(n,K,r));return{c(){B(t.$$.fragment),l=D(),B(e.$$.fragment),i=D(),B(c.$$.fragment),g=D(),B(u.$$.fragment),h=D(),m=W("p"),m.textContent=p,_=D(),s=W("h3"),s.textContent=a,v=D(),k=W("ol");for(let r=0;r<P.length;r+=1)P[r].c();d=D(),I=W("h3"),I.textContent=V,G=D(),Z=W("ol");for(let r=0;r<o.length;r+=1)o[r].c()},l(r){A(t.$$.fragment,r),l=S(r),A(e.$$.fragment,r),i=S(r),A(c.$$.fragment,r),g=S(r),A(u.$$.fragment,r),h=S(r),m=R(r,"P",{"data-svelte-h":!0}),me(m)!=="svelte-sv95ee"&&(m.textContent=p),_=S(r),s=R(r,"H3",{"data-svelte-h":!0}),me(s)!=="svelte-1qhh5xr"&&(s.textContent=a),v=S(r),k=R(r,"OL",{});var $=U(k);for(let O=0;O<P.length;O+=1)P[O].l($);$.forEach(b),d=S(r),I=R(r,"H3",{"data-svelte-h":!0}),me(I)!=="svelte-eyxzjx"&&(I.textContent=V),G=S(r),Z=R(r,"OL",{});var N=U(Z);for(let O=0;O<o.length;O+=1)o[O].l(N);N.forEach(b)},m(r,$){q(t,r,$),w(r,l,$),q(e,r,$),w(r,i,$),q(c,r,$),w(r,g,$),q(u,r,$),w(r,h,$),w(r,m,$),w(r,_,$),w(r,s,$),w(r,v,$),w(r,k,$);for(let N=0;N<P.length;N+=1)P[N]&&P[N].m(k,null);w(r,d,$),w(r,I,$),w(r,G,$),w(r,Z,$);for(let N=0;N<o.length;N+=1)o[N]&&o[N].m(Z,null);x=!0},p(r,$){const N={};$[1]&8&&(N.$$scope={dirty:$,ctx:r}),t.$set(N);const O={};if(!f&&$[0]&16&&(f=!0,O.value=r[4],J(()=>f=!1)),u.$set(O),$[0]&70){H=te(r[2].criticalIssues);let E;for(E=0;E<H.length;E+=1){const ee=Ae(r,H,E);P[E]?P[E].p(ee,$):(P[E]=qe(ee),P[E].c(),P[E].m(k,null))}for(;E<P.length;E+=1)P[E].d(1);P.length=H.length}if($[0]&70){K=te(r[2].policyConflictLog);let E;for(E=0;E<K.length;E+=1){const ee=Be(r,K,E);o[E]?o[E].p(ee,$):(o[E]=Me(ee),o[E].c(),o[E].m(Z,null))}for(;E<o.length;E+=1)o[E].d(1);o.length=K.length}},i(r){x||(C(t.$$.fragment,r),C(e.$$.fragment,r),C(c.$$.fragment,r),C(u.$$.fragment,r),x=!0)},o(r){L(t.$$.fragment,r),L(e.$$.fragment,r),L(c.$$.fragment,r),L(u.$$.fragment,r),x=!1},d(r){r&&(b(l),b(i),b(g),b(h),b(m),b(_),b(s),b(v),b(k),b(d),b(I),b(G),b(Z)),M(t,r),M(e,r),M(c,r),M(u,r),re(P,r),re(o,r)}}}function yt(n){let t;return{c(){t=Q("Save")},l(l){t=X(l,"Save")},m(l,e){w(l,t,e)},d(l){l&&b(t)}}}function wt(n){let t;return{c(){t=Q("Delete")},l(l){t=X(l,"Delete")},m(l,e){w(l,t,e)},d(l){l&&b(t)}}}function Ct(n){let t,l;return t=new ht({props:{idx:n[0].idx}}),{c(){B(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const c={};i[0]&1&&(c.idx=e[0].idx),t.$set(c)},i(e){l||(C(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function Lt(n){let t,l;return t=new gt({props:{idx:n[0].idx}}),{c(){B(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p(e,i){const c={};i[0]&1&&(c.idx=e[0].idx),t.$set(c)},i(e){l||(C(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function It(n){let t;return{c(){t=Q("Zoom to fit")},l(l){t=X(l,"Zoom to fit")},m(l,e){w(l,t,e)},d(l){l&&b(t)}}}function qe(n){let t,l,e=Pe(n[30])+"",i,c,g,u;function f(){return n[12](n[29])}function h(){return n[13](n[29])}return{c(){t=W("li"),l=W("a"),i=Q(e),c=D(),this.h()},l(m){t=R(m,"LI",{});var p=U(t);l=R(p,"A",{href:!0});var _=U(l);i=X(_,e),_.forEach(b),c=S(p),p.forEach(b),this.h()},h(){T(l,"href","#")},m(m,p){w(m,t,p),j(t,l),j(l,i),j(t,c),g||(u=[le(l,"click",f),le(l,"mouseenter",h),le(l,"mouseleave",n[14])],g=!0)},p(m,p){n=m,p[0]&4&&e!==(e=Pe(n[30])+"")&&oe(i,e)},d(m){m&&b(t),g=!1,ve(u)}}}function Me(n){let t,l,e=Fe(n[27])+"",i,c,g,u;function f(){return n[15](n[29])}function h(){return n[16](n[29])}return{c(){t=W("li"),l=W("a"),i=Q(e),c=D(),this.h()},l(m){t=R(m,"LI",{});var p=U(t);l=R(p,"A",{href:!0});var _=U(l);i=X(_,e),_.forEach(b),c=S(p),p.forEach(b),this.h()},h(){T(l,"href","#")},m(m,p){w(m,t,p),j(t,l),j(l,i),j(t,c),g||(u=[le(l,"click",f),le(l,"mouseenter",h),le(l,"mouseleave",n[17])],g=!0)},p(m,p){n=m,p[0]&4&&e!==(e=Fe(n[27])+"")&&oe(i,e)},d(m){m&&b(t),g=!1,ve(u)}}}function Et(n){let t,l,e,i=n[30].criticalIssue+"",c;return{c(){t=de("svg"),l=de("polygon"),e=de("text"),c=Q(i),this.h()},l(g){t=$e(g,"svg",{width:!0,height:!0,xmlns:!0});var u=U(t);l=$e(u,"polygon",{points:!0,fill:!0,class:!0}),U(l).forEach(b),e=$e(u,"text",{x:!0,y:!0});var f=U(e);c=X(f,i),f.forEach(b),u.forEach(b),this.h()},h(){T(l,"points","20,0 0,40 40,40"),T(l,"fill",Je.critical.background),T(l,"class","svelte-996go8"),T(e,"x","13"),T(e,"y","30"),ne(e,"fill","white"),T(t,"width","40"),T(t,"height","40"),T(t,"xmlns","http://www.w3.org/2000/svg")},m(g,u){w(g,t,u),j(t,l),j(t,e),j(e,c)},p(g,u){u[0]&4&&i!==(i=g[30].criticalIssue+"")&&oe(c,i)},d(g){g&&b(t)}}}function Te(n){let t,l,e;function i(f){n[19](f,n[30])}function c(){return n[20](n[29])}function g(){return n[21](n[29])}let u={draggable:!0,$$slots:{default:[Et]},$$scope:{ctx:n}};return n[30].point!==void 0&&(u.lngLat=n[30].point),t=new Ue({props:u}),z.push(()=>Y(t,"lngLat",i)),t.$on("click",c),t.$on("dragend",g),{c(){B(t.$$.fragment)},l(f){A(t.$$.fragment,f)},m(f,h){q(t,f,h),e=!0},p(f,h){n=f;const m={};h[0]&4|h[1]&8&&(m.$$scope={dirty:h,ctx:n}),!l&&h[0]&4&&(l=!0,m.lngLat=n[30].point,J(()=>l=!1)),t.$set(m)},i(f){e||(C(t.$$.fragment,f),e=!0)},o(f){L(t.$$.fragment,f),e=!1},d(f){M(t,f)}}}function Nt(n){let t,l=n[27].conflict+"",e;return{c(){t=W("span"),e=Q(l),this.h()},l(i){t=R(i,"SPAN",{class:!0});var c=U(t);e=X(c,l),c.forEach(b),this.h()},h(){T(t,"class","dot svelte-996go8"),ne(t,"background",Ye)},m(i,c){w(i,t,c),j(t,e)},p(i,c){c[0]&4&&l!==(l=i[27].conflict+"")&&oe(e,l)},d(i){i&&b(t)}}}function je(n){let t,l,e;function i(f){n[22](f,n[27])}function c(){return n[23](n[29])}function g(){return n[24](n[29])}let u={draggable:!0,$$slots:{default:[Nt]},$$scope:{ctx:n}};return n[27].point!==void 0&&(u.lngLat=n[27].point),t=new Ue({props:u}),z.push(()=>Y(t,"lngLat",i)),t.$on("click",c),t.$on("dragend",g),{c(){B(t.$$.fragment)},l(f){A(t.$$.fragment,f)},m(f,h){q(t,f,h),e=!0},p(f,h){n=f;const m={};h[0]&4|h[1]&8&&(m.$$scope={dirty:h,ctx:n}),!l&&h[0]&4&&(l=!0,m.lngLat=n[27].point,J(()=>l=!1)),t.$set(m)},i(f){e||(C(t.$$.fragment,f),e=!0)},o(f){L(t.$$.fragment,f),e=!1},d(f){M(t,f)}}}function Dt(n){let t,l;return t=new st({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){B(t.$$.fragment)},l(e){A(t.$$.fragment,e)},m(e,i){q(t,e,i),l=!0},p:ze,i(e){l||(C(t.$$.fragment,e),l=!0)},o(e){L(t.$$.fragment,e),l=!1},d(e){M(t,e)}}}function St(n){let t,l,e,i,c,g,u=te(n[2].criticalIssues),f=[];for(let s=0;s<u.length;s+=1)f[s]=Te(Se(n,u,s));const h=s=>L(f[s],1,1,()=>{f[s]=null});let m=te(n[2].policyConflictLog),p=[];for(let s=0;s<m.length;s+=1)p[s]=je(De(n,m,s));const _=s=>L(p[s],1,1,()=>{p[s]=null});return e=new ot({props:{data:n[5],$$slots:{default:[Dt]},$$scope:{ctx:n}}}),c=new lt({props:{map:n[3]}}),{c(){for(let s=0;s<f.length;s+=1)f[s].c();t=D();for(let s=0;s<p.length;s+=1)p[s].c();l=D(),B(e.$$.fragment),i=D(),B(c.$$.fragment)},l(s){for(let a=0;a<f.length;a+=1)f[a].l(s);t=S(s);for(let a=0;a<p.length;a+=1)p[a].l(s);l=S(s),A(e.$$.fragment,s),i=S(s),A(c.$$.fragment,s)},m(s,a){for(let v=0;v<f.length;v+=1)f[v]&&f[v].m(s,a);w(s,t,a);for(let v=0;v<p.length;v+=1)p[v]&&p[v].m(s,a);w(s,l,a),q(e,s,a),w(s,i,a),q(c,s,a),g=!0},p(s,a){if(a[0]&68){u=te(s[2].criticalIssues);let d;for(d=0;d<u.length;d+=1){const I=Se(s,u,d);f[d]?(f[d].p(I,a),C(f[d],1)):(f[d]=Te(I),f[d].c(),C(f[d],1),f[d].m(t.parentNode,t))}for(se(),d=u.length;d<f.length;d+=1)h(d);ae()}if(a[0]&68){m=te(s[2].policyConflictLog);let d;for(d=0;d<m.length;d+=1){const I=De(s,m,d);p[d]?(p[d].p(I,a),C(p[d],1)):(p[d]=je(I),p[d].c(),C(p[d],1),p[d].m(l.parentNode,l))}for(se(),d=m.length;d<p.length;d+=1)_(d);ae()}const v={};a[0]&32&&(v.data=s[5]),a[1]&8&&(v.$$scope={dirty:a,ctx:s}),e.$set(v);const k={};a[0]&8&&(k.map=s[3]),c.$set(k)},i(s){if(!g){for(let a=0;a<u.length;a+=1)C(f[a]);for(let a=0;a<m.length;a+=1)C(p[a]);C(e.$$.fragment,s),C(c.$$.fragment,s),g=!0}},o(s){f=f.filter(Boolean);for(let a=0;a<f.length;a+=1)L(f[a]);p=p.filter(Boolean);for(let a=0;a<p.length;a+=1)L(p[a]);L(e.$$.fragment,s),L(c.$$.fragment,s),g=!1},d(s){s&&(b(t),b(l),b(i)),re(f,s),re(p,s),M(e,s),M(c,s)}}}function Bt(n){let t,l,e,i,c,g,u,f,h,m,p;const _=[kt,bt],s=[];function a(d,I){return d[0]==null?0:1}e=a(n),i=s[e]=_[e](n);function v(d){n[25](d)}let k={$$slots:{default:[St]},$$scope:{ctx:n}};return n[3]!==void 0&&(k.map=n[3]),u=new it({props:k}),z.push(()=>Y(u,"map",v)),{c(){t=W("div"),l=W("div"),i.c(),c=D(),g=W("div"),B(u.$$.fragment),this.h()},l(d){t=R(d,"DIV",{style:!0});var I=U(t);l=R(I,"DIV",{style:!0});var V=U(l);i.l(V),V.forEach(b),c=S(I),g=R(I,"DIV",{style:!0});var G=U(g);A(u.$$.fragment,G),G.forEach(b),I.forEach(b),this.h()},h(){ne(l,"width","30%"),ne(l,"overflow-y","scroll"),ne(l,"padding","10px"),ne(g,"position","relative"),ne(g,"width","70%"),ne(t,"display","flex"),ne(t,"height","600px")},m(d,I){w(d,t,I),j(t,l),s[e].m(l,null),j(t,c),j(t,g),q(u,g,null),h=!0,m||(p=le(vt,"keydown",n[9]),m=!0)},p(d,I){let V=e;e=a(d),e===V?s[e].p(d,I):(se(),L(s[V],1,1,()=>{s[V]=null}),ae(),i=s[e],i?i.p(d,I):(i=s[e]=_[e](d),i.c()),C(i,1),i.m(l,null));const G={};I[0]&44|I[1]&8&&(G.$$scope={dirty:I,ctx:d}),!f&&I[0]&8&&(f=!0,G.map=d[3],J(()=>f=!1)),u.$set(G)},i(d){h||(C(i),C(u.$$.fragment,d),h=!0)},o(d){L(i),L(u.$$.fragment,d),h=!1},d(d){d&&b(t),s[e].d(),M(u),m=!1,p()}}}function At(n,t,l){let e={type:"FeatureCollection",features:[]},i=t??l;if(i!=null){let c=i.kind=="critical"?n.criticalIssues:n.policyConflictLog;e.features.push(he(c[i.idx].point))}return e}function he(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function Pe(n){return`${n.criticalIssue||"Unknown critical"}: ${n.locationName||"???"}`}function Fe(n){return`${n.conflict||"Unknown conflict"}: ${n.locationName||"???"}`}function qt(n,t,l){let e,i;be(n,F,$=>l(2,i=$));let c,g="critical",u=null,f=null;function h($){l(0,u=$),l(1,f=null)}function m($){if(u!=null){l(0,u=null);return}g=="critical"?(ue(F,i.criticalIssues=[...i.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:$.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,u={kind:"critical",idx:i.criticalIssues.length-1})):(ue(F,i.policyConflictLog=[...i.policyConflictLog,{id:"TODO",conflict:"",stage:"",point:$.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),l(0,u={kind:"conflict",idx:i.policyConflictLog.length-1})),l(1,f=null)}ke(()=>{c.on("click",m),_()}),Ke(()=>{c.off("click",m)});function p(){window.confirm("Delete this entry?")&&(u.kind=="critical"?(i.criticalIssues.splice(u.idx,1),F.set(i)):(i.policyConflictLog.splice(u.idx,1),F.set(i)),l(0,u=null))}function _($){let N={type:"FeatureCollection",features:[...i.criticalIssues.map(O=>he(O.point)),...i.policyConflictLog.map(O=>he(O.point))]};N.features.length>0&&c.fitBounds(et(N),{padding:20,animate:!0})}function s($){u!=null&&$.key=="Escape"&&($.stopPropagation(),l(0,u=null))}const a=()=>_();function v($){g=$,l(4,g)}const k=$=>h({kind:"critical",idx:$}),d=$=>l(1,f={kind:"critical",idx:$}),I=()=>l(1,f=null),V=$=>h({kind:"conflict",idx:$}),G=$=>l(1,f={kind:"conflict",idx:$}),Z=()=>l(1,f=null),x=()=>l(0,u=null);function y($,N){n.$$.not_equal(N.point,$)&&(N.point=$,F.set(i))}const ie=$=>h({kind:"critical",idx:$}),H=$=>h({kind:"critical",idx:$});function P($,N){n.$$.not_equal(N.point,$)&&(N.point=$,F.set(i))}const K=$=>h({kind:"conflict",idx:$}),o=$=>h({kind:"conflict",idx:$});function r($){c=$,l(3,c)}return n.$$.update=()=>{n.$$.dirty[0]&7&&l(5,e=At(i,u,f))},[u,f,i,c,g,e,h,p,_,s,a,v,k,d,I,V,G,Z,x,y,ie,H,P,K,o,r]}class Zt extends _e{constructor(t){super(),ge(this,t,qt,Bt,pe,{},null,[-1,-1])}}export{Zt as component};
