import{s as te,a8 as Le,U as re,a7 as ye,v as O,a as A,g as S,i as k,x as R,f as _,k as le,t as T,d as P,j as Y,M as Ie,e as G,c as V,b as H,w as z,h as M,r as Ee,p as De,n as Q,q as we}from"../chunks/scheduler.srxSbnmG.js";import{S as ne,i as ie,e as U,c as C,a as L,m as E,t as h,g as X,b as v,f as x,d as D}from"../chunks/index.jWSzNkcH.js";import{e as ee}from"../chunks/each.PFGD7pQK.js";import{p as Be}from"../chunks/index.CRvgDNPa.js";import{S as Ce,W as Ae}from"../chunks/WarningButton.t2Artt9D.js";import{S as me}from"../chunks/Select.DmCnIuVe.js";import{T as Se}from"../chunks/TextArea.Bf6rpAiU.js";import{T as Ne}from"../chunks/TextInput.Drmp71y7.js";import{s as j}from"../chunks/data.BvluUCWc.js";import{Y as Me}from"../chunks/YesNo.BM_GdgOC.js";import{D as Te}from"../chunks/DefaultButton.BgNy7JfI.js";import{B as Pe,G as We,b as je,a as qe}from"../chunks/GeoreferenceLayer.D6tQQiVE.js";import{m as $e,M as Fe,G as Ge}from"../chunks/MapLibreMap.iFI_zsAS.js";import{C as Ve}from"../chunks/CircleLayer.Di3QtaA2.js";function Oe(n,t,i){let e=Le(),{map:a}=t,{position:p}=t,r=null;return re(()=>{r=new $e.Marker({draggable:!0}).setLngLat(new $e.LngLat(p[0],p[1])).addTo(a),r.on("dragstart",()=>{a.getCanvas().style.cursor="grabbing"}),r.on("drag",()=>{i(0,p=r.getLngLat().toArray())}),r.on("dragend",()=>{a.getCanvas().style.cursor="inherit",e("dragEnd")}),r.getElement().addEventListener("click",l=>{l.stopPropagation(),e("click")})}),ye(()=>{r==null||r.remove()}),n.$$set=l=>{"map"in l&&i(1,a=l.map),"position"in l&&i(0,p=l.position)},[p,a]}class Re extends ne{constructor(t){super(),ie(this,t,Oe,null,te,{map:1,position:0})}}function ge(n){let t,i;return t=new Ce({props:{$$slots:{default:[Ue]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){C(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,a){E(t,e,a),i=!0},p(e,a){const p={};a&2050&&(p.$$scope={dirty:a,ctx:e}),t.$set(p)},i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){v(t.$$.fragment,e),i=!1},d(e){D(t,e)}}}function Ue(n){let t,i;return{c(){t=T("Use lookup: "),i=T(n[1])},l(e){t=P(e,"Use lookup: "),i=P(e,n[1])},m(e,a){k(e,t,a),k(e,i,a)},p(e,a){a&2&&Y(i,e[1])},d(e){e&&(_(t),_(i))}}}function He(n){let t,i,e,a,p,r,l,o,s,m,c,$,d,g,B,b;function W(f){n[5](f)}let N={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(N.value=n[2].criticalIssues[n[0]].criticalIssue),t=new me({props:N}),O.push(()=>U(t,"value",W));function Z(f){n[6](f)}let w={label:"Stage",emptyOption:!0,choices:Be(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(w.value=n[2].criticalIssues[n[0]].stage),a=new me({props:w}),O.push(()=>U(a,"value",Z));function se(f){n[7](f)}let J={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(J.value=n[2].criticalIssues[n[0]].locationName),l=new Ne({props:J}),O.push(()=>U(l,"value",se));let u=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&ge(n);function y(f){n[8](f)}let F={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(F.value=n[2].criticalIssues[n[0]].resolved),c=new Me({props:F}),O.push(()=>U(c,"value",y));function q(f){n[9](f)}let K={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(K.value=n[2].criticalIssues[n[0]].notes),g=new Se({props:K}),O.push(()=>U(g,"value",q)),{c(){C(t.$$.fragment),e=A(),C(a.$$.fragment),r=A(),C(l.$$.fragment),s=A(),u&&u.c(),m=A(),C(c.$$.fragment),d=A(),C(g.$$.fragment)},l(f){L(t.$$.fragment,f),e=S(f),L(a.$$.fragment,f),r=S(f),L(l.$$.fragment,f),s=S(f),u&&u.l(f),m=S(f),L(c.$$.fragment,f),d=S(f),L(g.$$.fragment,f)},m(f,I){E(t,f,I),k(f,e,I),E(a,f,I),k(f,r,I),E(l,f,I),k(f,s,I),u&&u.m(f,I),k(f,m,I),E(c,f,I),k(f,d,I),E(g,f,I),b=!0},p(f,[I]){const oe={};!i&&I&5&&(i=!0,oe.value=f[2].criticalIssues[f[0]].criticalIssue,R(()=>i=!1)),t.$set(oe);const fe={};!p&&I&5&&(p=!0,fe.value=f[2].criticalIssues[f[0]].stage,R(()=>p=!1)),a.$set(fe);const ce={};!o&&I&5&&(o=!0,ce.value=f[2].criticalIssues[f[0]].locationName,R(()=>o=!1)),l.$set(ce),f[1]&&f[1]!="Loading"&&f[1]!=f[2].criticalIssues[f[0]].locationName?u?(u.p(f,I),I&7&&h(u,1)):(u=ge(f),u.c(),h(u,1),u.m(m.parentNode,m)):u&&(X(),v(u,1,1,()=>{u=null}),x());const ue={};!$&&I&5&&($=!0,ue.value=f[2].criticalIssues[f[0]].resolved,R(()=>$=!1)),c.$set(ue);const pe={};!B&&I&5&&(B=!0,pe.value=f[2].criticalIssues[f[0]].notes,R(()=>B=!1)),g.$set(pe)},i(f){b||(h(t.$$.fragment,f),h(a.$$.fragment,f),h(l.$$.fragment,f),h(u),h(c.$$.fragment,f),h(g.$$.fragment,f),b=!0)},o(f){v(t.$$.fragment,f),v(a.$$.fragment,f),v(l.$$.fragment,f),v(u),v(c.$$.fragment,f),v(g.$$.fragment,f),b=!1},d(f){f&&(_(e),_(r),_(s),_(m),_(d)),D(t,f),D(a,f),D(l,f),u&&u.d(f),D(c,f),D(g,f)}}}function Je(n,t,i){let e;le(n,j,g=>i(2,e=g));let{idx:a}=t,p=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],r="Loading";re(async()=>{await l(e.criticalIssues[a].point)});async function l(g){let B=`https://nominatim.openstreetmap.org/reverse?lon=${g[0]}&lat=${g[1]}&format=json`;try{let W=await(await fetch(B)).json();i(1,r=W.address.road??W.display_name)}catch(b){return console.log(`Location lookup failed: ${b}`),""}}function o(){Ie(j,e.criticalIssues[a].locationName=r,e)}function s(g){n.$$.not_equal(e.criticalIssues[a].criticalIssue,g)&&(e.criticalIssues[a].criticalIssue=g,j.set(e))}function m(g){n.$$.not_equal(e.criticalIssues[a].stage,g)&&(e.criticalIssues[a].stage=g,j.set(e))}function c(g){n.$$.not_equal(e.criticalIssues[a].locationName,g)&&(e.criticalIssues[a].locationName=g,j.set(e))}function $(g){n.$$.not_equal(e.criticalIssues[a].resolved,g)&&(e.criticalIssues[a].resolved=g,j.set(e))}function d(g){n.$$.not_equal(e.criticalIssues[a].notes,g)&&(e.criticalIssues[a].notes=g,j.set(e))}return n.$$set=g=>{"idx"in g&&i(0,a=g.idx)},[a,r,e,p,o,s,m,c,$,d]}class Ke extends ne{constructor(t){super(),ie(this,t,Je,He,te,{idx:0})}}function de(n,t,i){const e=n.slice();return e[13]=t[i],e[14]=t,e[15]=i,e}function ze(n){let t,i,e,a,p,r,l,o,s,m;return p=new Te({props:{$$slots:{default:[Ze]},$$scope:{ctx:n}}}),p.$on("click",n[6]),l=new Ae({props:{$$slots:{default:[Qe]},$$scope:{ctx:n}}}),l.$on("click",n[4]),s=new Ke({props:{idx:n[1]}}),{c(){t=G("p"),i=T("Editing "),e=T(n[1]),a=A(),C(p.$$.fragment),r=A(),C(l.$$.fragment),o=A(),C(s.$$.fragment)},l(c){t=V(c,"P",{});var $=H(t);i=P($,"Editing "),e=P($,n[1]),$.forEach(_),a=S(c),L(p.$$.fragment,c),r=S(c),L(l.$$.fragment,c),o=S(c),L(s.$$.fragment,c)},m(c,$){k(c,t,$),M(t,i),M(t,e),k(c,a,$),E(p,c,$),k(c,r,$),E(l,c,$),k(c,o,$),E(s,c,$),m=!0},p(c,$){(!m||$&2)&&Y(e,c[1]);const d={};$&65536&&(d.$$scope={dirty:$,ctx:c}),p.$set(d);const g={};$&65536&&(g.$$scope={dirty:$,ctx:c}),l.$set(g);const B={};$&2&&(B.idx=c[1]),s.$set(B)},i(c){m||(h(p.$$.fragment,c),h(l.$$.fragment,c),h(s.$$.fragment,c),m=!0)},o(c){v(p.$$.fragment,c),v(l.$$.fragment,c),v(s.$$.fragment,c),m=!1},d(c){c&&(_(t),_(a),_(r),_(o)),D(p,c),D(l,c),D(s,c)}}}function Ye(n){let t,i="Click the map to add a pin, or click a pin to fill out data";return{c(){t=G("p"),t.textContent=i},l(e){t=V(e,"P",{"data-svelte-h":!0}),De(t)!=="svelte-1rxcdnm"&&(t.textContent=i)},m(e,a){k(e,t,a)},p:Q,i:Q,o:Q,d(e){e&&_(t)}}}function Ze(n){let t;return{c(){t=T("Save")},l(i){t=P(i,"Save")},m(i,e){k(i,t,e)},d(i){i&&_(t)}}}function Qe(n){let t;return{c(){t=T("Delete")},l(i){t=P(i,"Delete")},m(i,e){k(i,t,e)},d(i){i&&_(t)}}}function _e(n){let t;return{c(){t=G("div"),this.h()},l(i){t=V(i,"DIV",{class:!0}),H(t).forEach(_),this.h()},h(){Ee(t,"class","block-map svelte-13rr2mh")},m(i,e){k(i,t,e)},d(i){i&&_(t)}}}function he(n){let t,i,e;function a(o){n[7](o,n[13])}function p(){return n[8](n[15])}function r(){return n[9](n[15])}let l={map:n[0]};return n[13].point!==void 0&&(l.position=n[13].point),t=new Re({props:l}),O.push(()=>U(t,"position",a)),t.$on("click",p),t.$on("dragEnd",r),{c(){C(t.$$.fragment)},l(o){L(t.$$.fragment,o)},m(o,s){E(t,o,s),e=!0},p(o,s){n=o;const m={};s&1&&(m.map=n[0]),!i&&s&4&&(i=!0,m.position=n[13].point,R(()=>i=!1)),t.$set(m)},i(o){e||(h(t.$$.fragment,o),e=!0)},o(o){v(t.$$.fragment,o),e=!1},d(o){D(t,o)}}}function be(n){let t,i;return t=new Ge({props:{data:ae(n[2].criticalIssues[n[1]].point),$$slots:{default:[Xe]},$$scope:{ctx:n}}}),{c(){C(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,a){E(t,e,a),i=!0},p(e,a){const p={};a&6&&(p.data=ae(e[2].criticalIssues[e[1]].point)),a&65536&&(p.$$scope={dirty:a,ctx:e}),t.$set(p)},i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){v(t.$$.fragment,e),i=!1},d(e){D(t,e)}}}function Xe(n){let t,i;return t=new Ve({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){C(t.$$.fragment)},l(e){L(t.$$.fragment,e)},m(e,a){E(t,e,a),i=!0},p:Q,i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){v(t.$$.fragment,e),i=!1},d(e){D(t,e)}}}function xe(n){let t,i,e,a,p=ee(n[2].criticalIssues),r=[];for(let s=0;s<p.length;s+=1)r[s]=he(de(n,p,s));const l=s=>v(r[s],1,1,()=>{r[s]=null});let o=n[1]!=null&&be(n);return e=new qe({props:{map:n[0]}}),{c(){for(let s=0;s<r.length;s+=1)r[s].c();t=A(),o&&o.c(),i=A(),C(e.$$.fragment)},l(s){for(let m=0;m<r.length;m+=1)r[m].l(s);t=S(s),o&&o.l(s),i=S(s),L(e.$$.fragment,s)},m(s,m){for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(s,m);k(s,t,m),o&&o.m(s,m),k(s,i,m),E(e,s,m),a=!0},p(s,m){if(m&13){p=ee(s[2].criticalIssues);let $;for($=0;$<p.length;$+=1){const d=de(s,p,$);r[$]?(r[$].p(d,m),h(r[$],1)):(r[$]=he(d),r[$].c(),h(r[$],1),r[$].m(t.parentNode,t))}for(X(),$=p.length;$<r.length;$+=1)l($);x()}s[1]!=null?o?(o.p(s,m),m&2&&h(o,1)):(o=be(s),o.c(),h(o,1),o.m(i.parentNode,i)):o&&(X(),v(o,1,1,()=>{o=null}),x());const c={};m&1&&(c.map=s[0]),e.$set(c)},i(s){if(!a){for(let m=0;m<p.length;m+=1)h(r[m]);h(o),h(e.$$.fragment,s),a=!0}},o(s){r=r.filter(Boolean);for(let m=0;m<r.length;m+=1)v(r[m]);v(o),v(e.$$.fragment,s),a=!1},d(s){s&&(_(t),_(i)),we(r,s),o&&o.d(s),D(e,s)}}}function et(n){let t;return{c(){t=T("Zoom to fit")},l(i){t=P(i,"Zoom to fit")},m(i,e){k(i,t,e)},d(i){i&&_(t)}}}function tt(n){let t,i,e,a,p,r,l,o,s,m,c,$,d,g,B,b;const W=[Ye,ze],N=[];function Z(u,y){return u[1]==null?0:1}e=Z(n),a=N[e]=W[e](n);let w=n[1]!=null&&_e();function se(u){n[10](u)}let J={$$slots:{default:[xe]},$$scope:{ctx:n}};return n[0]!==void 0&&(J.map=n[0]),o=new Fe({props:J}),O.push(()=>U(o,"map",se)),c=new Ce({props:{$$slots:{default:[et]},$$scope:{ctx:n}}}),c.$on("click",n[11]),d=new Pe({}),B=new We({}),{c(){t=G("div"),i=G("div"),a.c(),p=A(),r=G("div"),w&&w.c(),l=A(),C(o.$$.fragment),m=A(),C(c.$$.fragment),$=A(),C(d.$$.fragment),g=A(),C(B.$$.fragment),this.h()},l(u){t=V(u,"DIV",{style:!0});var y=H(t);i=V(y,"DIV",{style:!0});var F=H(i);a.l(F),F.forEach(_),p=S(y),r=V(y,"DIV",{style:!0});var q=H(r);w&&w.l(q),l=S(q),L(o.$$.fragment,q),q.forEach(_),y.forEach(_),m=S(u),L(c.$$.fragment,u),$=S(u),L(d.$$.fragment,u),g=S(u),L(B.$$.fragment,u),this.h()},h(){z(i,"width","30%"),z(r,"position","relative"),z(r,"width","70%"),z(r,"height","600px"),z(t,"display","flex")},m(u,y){k(u,t,y),M(t,i),N[e].m(i,null),M(t,p),M(t,r),w&&w.m(r,null),M(r,l),E(o,r,null),k(u,m,y),E(c,u,y),k(u,$,y),E(d,u,y),k(u,g,y),E(B,u,y),b=!0},p(u,[y]){let F=e;e=Z(u),e===F?N[e].p(u,y):(X(),v(N[F],1,1,()=>{N[F]=null}),x(),a=N[e],a?a.p(u,y):(a=N[e]=W[e](u),a.c()),h(a,1),a.m(i,null)),u[1]!=null?w||(w=_e(),w.c(),w.m(r,l)):w&&(w.d(1),w=null);const q={};y&65543&&(q.$$scope={dirty:y,ctx:u}),!s&&y&1&&(s=!0,q.map=u[0],R(()=>s=!1)),o.$set(q);const K={};y&65536&&(K.$$scope={dirty:y,ctx:u}),c.$set(K)},i(u){b||(h(a),h(o.$$.fragment,u),h(c.$$.fragment,u),h(d.$$.fragment,u),h(B.$$.fragment,u),b=!0)},o(u){v(a),v(o.$$.fragment,u),v(c.$$.fragment,u),v(d.$$.fragment,u),v(B.$$.fragment,u),b=!1},d(u){u&&(_(t),_(m),_($),_(g)),N[e].d(),w&&w.d(),D(o),D(c,u),D(d,u),D(B,u)}}}function ae(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function nt(n,t,i){let e;le(n,j,b=>i(2,e=b));let a,p=null;function r(b){i(1,p=b)}function l(b){Ie(j,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:b.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),i(1,p=e.criticalIssues.length-1)}re(()=>{a.on("click",l),s()}),ye(()=>{a.off("click",l)});function o(){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(p,1),j.set(e),i(1,p=null))}function s(b){if(e.criticalIssues.length>0){let W={type:"FeatureCollection",features:e.criticalIssues.map(N=>ae(N.point))};a.fitBounds(je(W),{padding:20,animate:!0})}}const m=()=>i(1,p=null);function c(b,W){n.$$.not_equal(W.point,b)&&(W.point=b,j.set(e))}const $=b=>r(b),d=b=>r(b);function g(b){a=b,i(0,a)}return[a,p,e,r,o,s,m,c,$,d,g,()=>s()]}class it extends ne{constructor(t){super(),ie(this,t,nt,tt,te,{})}}function ve(n,t,i){const e=n.slice();return e[1]=t[i],e}function ke(n){let t,i,e=n[1].criticalIssue+"",a,p,r=n[1].stage+"",l,o,s=n[1].locationName+"",m,c;return{c(){t=G("li"),i=T("Critical issue: type="),a=T(e),p=T(", stage="),l=T(r),o=T(", at "),m=T(s),c=A()},l($){t=V($,"LI",{});var d=H(t);i=P(d,"Critical issue: type="),a=P(d,e),p=P(d,", stage="),l=P(d,r),o=P(d,", at "),m=P(d,s),c=S(d),d.forEach(_)},m($,d){k($,t,d),M(t,i),M(t,a),M(t,p),M(t,l),M(t,o),M(t,m),M(t,c)},p($,d){d&1&&e!==(e=$[1].criticalIssue+"")&&Y(a,e),d&1&&r!==(r=$[1].stage+"")&&Y(l,r),d&1&&s!==(s=$[1].locationName+"")&&Y(m,s)},d($){$&&_(t)}}}function st(n){let t,i,e,a,p=ee(n[0].criticalIssues),r=[];for(let l=0;l<p.length;l+=1)r[l]=ke(ve(n,p,l));return e=new it({}),{c(){t=G("ol");for(let l=0;l<r.length;l+=1)r[l].c();i=A(),C(e.$$.fragment)},l(l){t=V(l,"OL",{});var o=H(t);for(let s=0;s<r.length;s+=1)r[s].l(o);o.forEach(_),i=S(l),L(e.$$.fragment,l)},m(l,o){k(l,t,o);for(let s=0;s<r.length;s+=1)r[s]&&r[s].m(t,null);k(l,i,o),E(e,l,o),a=!0},p(l,[o]){if(o&1){p=ee(l[0].criticalIssues);let s;for(s=0;s<p.length;s+=1){const m=ve(l,p,s);r[s]?r[s].p(m,o):(r[s]=ke(m),r[s].c(),r[s].m(t,null))}for(;s<r.length;s+=1)r[s].d(1);r.length=p.length}},i(l){a||(h(e.$$.fragment,l),a=!0)},o(l){v(e.$$.fragment,l),a=!1},d(l){l&&(_(t),_(i)),we(r,l),D(e,l)}}}function at(n,t,i){let e;return le(n,j,a=>i(0,e=a)),[e]}class vt extends ne{constructor(t){super(),ie(this,t,at,st,te,{})}}export{vt as component};
