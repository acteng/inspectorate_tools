import{s as he,w as x,x as ne,l as ct,u as _t,r as gt,v as dt,D as $e,k as Ie,R as pt,T as Ce,a as U,g as F,i as S,f as h,G as Le,n as ke,e as ee,t as H,c as te,b as le,d as G,p as de,q as V,h as Z,j as me,B as $t,W as ht,F as _e,m as Be}from"../chunks/scheduler.D5JRtHaf.js";import{S as Me,i as Se,e as oe,c as N,a as A,m as P,t as b,b as j,d as z,g as re,f as ae}from"../chunks/index.Xm1AgzMF.js";import{e as ue}from"../chunks/each.C9BadmQM.js";import{C as ze,B as kt}from"../chunks/ClickableCard.BhW8XYpY.js";import{D as rt}from"../chunks/DefaultButton.BHwS446X.js";import{S as be}from"../chunks/SecondaryButton.DxO4nu9r.js";/* empty css                                                    */import{T as De}from"../chunks/TextInput.Cluermb4.js";import{W as at}from"../chunks/WarningButton.jEqntaGg.js";import{s as X}from"../chunks/data.BC3pXOL5.js";import{L as bt,a as vt,d as ge,t as wt,v as jt,w as Ee,M as Ct,b as Lt,C as Mt,G as Ue,x as Ne,y as Fe,m as St,P as it,l as yt}from"../chunks/index.WC6jhmvX.js";import{c as Oe}from"../chunks/index.D6DdpyBf.js";import{g as Ae}from"../chunks/index.aldwjk77.js";import{c as ce}from"../chunks/colors.DaC397qr.js";import{G as It}from"../chunks/GeoreferenceLayer.DiG7eLJB.js";import{a as Tt,M as ye,B as Et,G as Nt,S as At,C as Pt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.ChXzxr60.js";import{C as zt}from"../chunks/CollapsibleCard.D0GavHKp.js";import{R as Pe}from"../chunks/Radio.BjpWuuOn.js";import{T as st}from"../chunks/TextArea.Ct1XwDet.js";import"../chunks/paths.Dd5bMQUx.js";function Dt(n){let e;const o=n[16].default,t=ct(o,n,n[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,r){t&&t.m(l,r),e=!0},p(l,r){t&&t.p&&(!e||r&16777216)&&_t(t,o,l,l[24],e?dt(o,l[24],r,null):gt(l[24]),null)},i(l){e||(b(t,l),e=!0)},o(l){j(t,l),e=!1},d(l){t&&t.d(l)}}}function qt(n){let e,o,t;function l(a){n[17](a)}let r={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Dt]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.hovered=n[0]),e=new bt({props:r}),x.push(()=>oe(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,[s]){const i={};s&2&&(i.id=a[1]),s&4&&(i.source=a[2]),s&8&&(i.sourceLayer=a[3]),s&16&&(i.beforeId=a[4]),s&32&&(i.beforeLayerType=a[5]),s&64&&(i.paint=a[6]),s&128&&(i.layout=a[7]),s&256&&(i.filter=a[8]),s&512&&(i.applyToClusters=a[9]),s&1024&&(i.minzoom=a[10]),s&2048&&(i.maxzoom=a[11]),s&4096&&(i.hoverCursor=a[12]),s&8192&&(i.manageHoverState=a[13]),s&16384&&(i.eventsIfTopMost=a[14]),s&32768&&(i.interactive=a[15]),s&16777216&&(i.$$scope={dirty:s,ctx:a}),!o&&s&1&&(o=!0,i.hovered=a[0],ne(()=>o=!1)),e.$set(i)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){j(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Bt(n,e,o){let{$$slots:t={},$$scope:l}=e,{id:r=vt("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:i=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:d=void 0}=e,{layout:_=void 0}=e,{filter:u=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:D=void 0}=e,{hoverCursor:B=void 0}=e,{manageHoverState:E=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:$=!0}=e;function p(y){v=y,o(0,v)}function w(y){$e.call(this,n,y)}function k(y){$e.call(this,n,y)}function q(y){$e.call(this,n,y)}function I(y){$e.call(this,n,y)}function J(y){$e.call(this,n,y)}function Q(y){$e.call(this,n,y)}return n.$$set=y=>{"id"in y&&o(1,r=y.id),"source"in y&&o(2,a=y.source),"sourceLayer"in y&&o(3,s=y.sourceLayer),"beforeId"in y&&o(4,i=y.beforeId),"beforeLayerType"in y&&o(5,g=y.beforeLayerType),"paint"in y&&o(6,d=y.paint),"layout"in y&&o(7,_=y.layout),"filter"in y&&o(8,u=y.filter),"applyToClusters"in y&&o(9,C=y.applyToClusters),"minzoom"in y&&o(10,L=y.minzoom),"maxzoom"in y&&o(11,D=y.maxzoom),"hoverCursor"in y&&o(12,B=y.hoverCursor),"manageHoverState"in y&&o(13,E=y.manageHoverState),"hovered"in y&&o(0,v=y.hovered),"eventsIfTopMost"in y&&o(14,f=y.eventsIfTopMost),"interactive"in y&&o(15,$=y.interactive),"$$scope"in y&&o(24,l=y.$$scope)},[v,r,a,s,i,g,d,_,u,C,L,D,B,E,f,$,t,p,w,k,q,I,J,Q,l]}class Ut extends Me{constructor(e){super(),Se(this,e,Bt,qt,he,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ft=Object.defineProperty,Ot=(n,e)=>Ft(n,"name",{value:e,configurable:!0});function ft(n,e,o,t={}){const l=Ae(n),r=ge(l[0]),a=ge(l[1]),s=ge(o),i=wt(e,t.units),g=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(s)),d=r+Math.atan2(Math.sin(s)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(g)),_=Ee(d),u=Ee(g);return jt([_,u],t.properties)}Ot(ft,"destination");var He=ft,Ht=Object.defineProperty,ut=(n,e)=>Ht(n,"name",{value:e,configurable:!0});function qe(n,e,o={}){if(o.final===!0)return mt(n,e);const t=Ae(n),l=Ae(e),r=ge(t[0]),a=ge(l[0]),s=ge(t[1]),i=ge(l[1]),g=Math.sin(a-r)*Math.cos(i),d=Math.cos(s)*Math.sin(i)-Math.sin(s)*Math.cos(i)*Math.cos(a-r);return Ee(Math.atan2(g,d))}ut(qe,"bearing");function mt(n,e){let o=qe(e,n);return o=(o+180)%360,o}ut(mt,"calculateFinalBearing");var Gt=qe;function Ge(n,e,o){const t=n.slice();return t[35]=e[o],t[36]=e,t[37]=o,t}function Je(n,e,o){const t=n.slice();return t[38]=e[o],t[39]=e,t[37]=o,t}function Jt(n){let e,o=nn(n[37])+"",t;return{c(){e=ee("span"),t=H(o),this.h()},l(l){e=te(l,"SPAN",{class:!0});var r=le(e);t=G(r,o),r.forEach(h),this.h()},h(){de(e,"class","dot svelte-1qktznf"),V(e,"color","#4472c4"),V(e,"background-color","white")},m(l,r){S(l,e,r),Z(e,t)},p:ke,d(l){l&&h(e)}}}function Ke(n){let e,o,t;function l(i){n[18](i,n[38])}function r(){return n[19](n[37])}function a(){return n[20](n[37])}let s={draggable:!0,$$slots:{default:[Jt]},$$scope:{ctx:n}};return n[38].point!==void 0&&(s.lngLat=n[38].point),e=new ye({props:s}),x.push(()=>oe(e,"lngLat",l)),e.$on("dragend",r),e.$on("click",a),{c(){N(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,g){P(e,i,g),t=!0},p(i,g){n=i;const d={};g[1]&512&&(d.$$scope={dirty:g,ctx:n}),!o&&g[0]&19&&(o=!0,d.lngLat=n[38].point,ne(()=>o=!1)),e.$set(d)},i(i){t||(b(e.$$.fragment,i),t=!0)},o(i){j(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function Kt(n){let e;return{c(){e=ee("span"),this.h()},l(o){e=te(o,"SPAN",{class:!0}),le(e).forEach(h),this.h()},h(){de(e,"class","dot svelte-1qktznf"),V(e,"background-color",n[7][n[35].score]),V(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},m(o,t){S(o,e,t)},p(o,t){t[0]&19&&V(e,"background-color",o[7][o[35].score]),t[0]&19&&V(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&h(e)}}}function Rt(n){let e;return{c(){e=ee("span"),this.h()},l(o){e=te(o,"SPAN",{class:!0}),le(e).forEach(h),this.h()},h(){de(e,"class","dot svelte-1qktznf"),V(e,"background-color",n[7][n[35].score])},m(o,t){S(o,e,t)},p(o,t){t[0]&19&&V(e,"background-color",o[7][o[35].score])},d(o){o&&h(e)}}}function Vt(n){let e;return{c(){e=ee("span"),this.h()},l(o){e=te(o,"SPAN",{class:!0}),le(e).forEach(h),this.h()},h(){de(e,"class","dot svelte-1qktznf"),V(e,"background-color",n[7][n[35].score]),V(e,"opacity","0%")},m(o,t){S(o,e,t)},p(o,t){t[0]&19&&V(e,"background-color",o[7][o[35].score])},d(o){o&&h(e)}}}function Re(n){let e,o,t,l,r,a,s,i,g;function d(w){n[21](w,n[35])}function _(){return n[22](n[37])}function u(){return n[23](n[37])}let C={draggable:!0,$$slots:{default:[Kt]},$$scope:{ctx:n}};n[35].point1!==void 0&&(C.lngLat=n[35].point1),e=new ye({props:C}),x.push(()=>oe(e,"lngLat",d)),e.$on("dragend",_),e.$on("click",u);function L(w){n[24](w,n[35])}function D(){return n[25](n[37])}function B(){return n[26](n[37])}let E={draggable:!0,$$slots:{default:[Rt]},$$scope:{ctx:n}};n[35].point2!==void 0&&(E.lngLat=n[35].point2),l=new ye({props:E}),x.push(()=>oe(l,"lngLat",L)),l.$on("dragend",D),l.$on("click",B);function v(w){n[27](w,n[35])}function f(){return n[28](n[37])}function $(){return n[29](n[37])}let p={draggable:!0,$$slots:{default:[Vt]},$$scope:{ctx:n}};return n[35].point3!==void 0&&(p.lngLat=n[35].point3),s=new ye({props:p}),x.push(()=>oe(s,"lngLat",v)),s.$on("dragend",f),s.$on("click",$),{c(){N(e.$$.fragment),t=U(),N(l.$$.fragment),a=U(),N(s.$$.fragment)},l(w){A(e.$$.fragment,w),t=F(w),A(l.$$.fragment,w),a=F(w),A(s.$$.fragment,w)},m(w,k){P(e,w,k),S(w,t,k),P(l,w,k),S(w,a,k),P(s,w,k),g=!0},p(w,k){n=w;const q={};k[0]&19|k[1]&512&&(q.$$scope={dirty:k,ctx:n}),!o&&k[0]&19&&(o=!0,q.lngLat=n[35].point1,ne(()=>o=!1)),e.$set(q);const I={};k[0]&19|k[1]&512&&(I.$$scope={dirty:k,ctx:n}),!r&&k[0]&19&&(r=!0,I.lngLat=n[35].point2,ne(()=>r=!1)),l.$set(I);const J={};k[0]&19|k[1]&512&&(J.$$scope={dirty:k,ctx:n}),!i&&k[0]&19&&(i=!0,J.lngLat=n[35].point3,ne(()=>i=!1)),s.$set(J)},i(w){g||(b(e.$$.fragment,w),b(l.$$.fragment,w),b(s.$$.fragment,w),g=!0)},o(w){j(e.$$.fragment,w),j(l.$$.fragment,w),j(s.$$.fragment,w),g=!1},d(w){w&&(h(t),h(a)),z(e,w),z(l,w),z(s,w)}}}function Xt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=H(e)},l(t){o=G(t,e)},m(t,l){S(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&me(o,e)},d(t){t&&h(o)}}}function Wt(n){let e,o;return e=new it({props:{$$slots:{default:[Xt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Zt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=H(e)},l(t){o=G(t,e)},m(t,l){S(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&me(o,e)},d(t){t&&h(o)}}}function Qt(n){let e,o;return e=new it({props:{$$slots:{default:[Zt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Yt(n){let e,o,t,l,r,a;return e=new Ne({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Fe(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Wt]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Ne({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Fe(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Qt]},$$scope:{ctx:n}}}),t.$on("click",n[9]),r=new Ut({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U(),N(r.$$.fragment)},l(s){A(e.$$.fragment,s),o=F(s),A(t.$$.fragment,s),l=F(s),A(r.$$.fragment,s)},m(s,i){P(e,s,i),S(s,o,i),P(t,s,i),S(s,l,i),P(r,s,i),a=!0},p(s,i){const g={};i[1]&512&&(g.$$scope={dirty:i,ctx:s}),e.$set(g);const d={};i[1]&512&&(d.$$scope={dirty:i,ctx:s}),t.$set(d)},i(s){a||(b(e.$$.fragment,s),b(t.$$.fragment,s),b(r.$$.fragment,s),a=!0)},o(s){j(e.$$.fragment,s),j(t.$$.fragment,s),j(r.$$.fragment,s),a=!1},d(s){s&&(h(o),h(l)),z(e,s),z(t,s),z(r,s)}}}function xt(n){let e,o,t,l;return e=new Ne({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new St({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment)},l(r){A(e.$$.fragment,r),o=F(r),A(t.$$.fragment,r)},m(r,a){P(e,r,a),S(r,o,a),P(t,r,a),l=!0},p:ke,i(r){l||(b(e.$$.fragment,r),b(t.$$.fragment,r),l=!0)},o(r){j(e.$$.fragment,r),j(t.$$.fragment,r),l=!1},d(r){r&&h(o),z(e,r),z(t,r)}}}function en(n){let e,o,t,l,r,a,s,i,g,d,_,u;e=new Tt({}),e.$on("click",n[8]),t=new Mt({props:{gj:n[4].summary.networkMap,show:n[2]}});let C=ue(n[4].jat[n[0]][n[1]].arms),L=[];for(let f=0;f<C.length;f+=1)L[f]=Ke(Je(n,C,f));const D=f=>j(L[f],1,1,()=>{L[f]=null});let B=ue(n[4].jat[n[0]][n[1]].movements),E=[];for(let f=0;f<B.length;f+=1)E[f]=Re(Ge(n,B,f));const v=f=>j(E[f],1,1,()=>{E[f]=null});return s=new Ue({props:{data:n[10](n[4]),$$slots:{default:[Yt]},$$scope:{ctx:n}}}),g=new Ue({props:{data:n[6],$$slots:{default:[xt]},$$scope:{ctx:n}}}),_=new It({props:{map:n[5]}}),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U();for(let f=0;f<L.length;f+=1)L[f].c();r=U();for(let f=0;f<E.length;f+=1)E[f].c();a=U(),N(s.$$.fragment),i=U(),N(g.$$.fragment),d=U(),N(_.$$.fragment)},l(f){A(e.$$.fragment,f),o=F(f),A(t.$$.fragment,f),l=F(f);for(let $=0;$<L.length;$+=1)L[$].l(f);r=F(f);for(let $=0;$<E.length;$+=1)E[$].l(f);a=F(f),A(s.$$.fragment,f),i=F(f),A(g.$$.fragment,f),d=F(f),A(_.$$.fragment,f)},m(f,$){P(e,f,$),S(f,o,$),P(t,f,$),S(f,l,$);for(let p=0;p<L.length;p+=1)L[p]&&L[p].m(f,$);S(f,r,$);for(let p=0;p<E.length;p+=1)E[p]&&E[p].m(f,$);S(f,a,$),P(s,f,$),S(f,i,$),P(g,f,$),S(f,d,$),P(_,f,$),u=!0},p(f,$){const p={};if($[0]&16&&(p.gj=f[4].summary.networkMap),$[0]&4&&(p.show=f[2]),t.$set(p),$[0]&27){C=ue(f[4].jat[f[0]][f[1]].arms);let I;for(I=0;I<C.length;I+=1){const J=Je(f,C,I);L[I]?(L[I].p(J,$),b(L[I],1)):(L[I]=Ke(J),L[I].c(),b(L[I],1),L[I].m(r.parentNode,r))}for(re(),I=C.length;I<L.length;I+=1)D(I);ae()}if($[0]&155){B=ue(f[4].jat[f[0]][f[1]].movements);let I;for(I=0;I<B.length;I+=1){const J=Ge(f,B,I);E[I]?(E[I].p(J,$),b(E[I],1)):(E[I]=Re(J),E[I].c(),b(E[I],1),E[I].m(a.parentNode,a))}for(re(),I=B.length;I<E.length;I+=1)v(I);ae()}const w={};$[0]&16&&(w.data=f[10](f[4])),$[1]&512&&(w.$$scope={dirty:$,ctx:f}),s.$set(w);const k={};$[0]&64&&(k.data=f[6]),$[1]&512&&(k.$$scope={dirty:$,ctx:f}),g.$set(k);const q={};$[0]&32&&(q.map=f[5]),_.$set(q)},i(f){if(!u){b(e.$$.fragment,f),b(t.$$.fragment,f);for(let $=0;$<C.length;$+=1)b(L[$]);for(let $=0;$<B.length;$+=1)b(E[$]);b(s.$$.fragment,f),b(g.$$.fragment,f),b(_.$$.fragment,f),u=!0}},o(f){j(e.$$.fragment,f),j(t.$$.fragment,f),L=L.filter(Boolean);for(let $=0;$<L.length;$+=1)j(L[$]);E=E.filter(Boolean);for(let $=0;$<E.length;$+=1)j(E[$]);j(s.$$.fragment,f),j(g.$$.fragment,f),j(_.$$.fragment,f),u=!1},d(f){f&&(h(o),h(l),h(r),h(a),h(i),h(d)),z(e,f),z(t,f),Le(L,f),Le(E,f),z(s,f),z(g,f),z(_,f)}}}function tn(n){let e,o,t;function l(a){n[30](a)}let r={$$slots:{default:[en]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.map=n[5]),e=new Ct({props:r}),x.push(()=>oe(e,"map",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};s[0]&127|s[1]&512&&(i.$$scope={dirty:s,ctx:a}),!o&&s[0]&32&&(o=!0,i.map=a[5],ne(()=>o=!1)),e.$set(i)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){j(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Ve(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function nn(n){return String.fromCharCode(n+65)}function on(n,e,o){let t,l;Ie(n,X,m=>o(4,l=m));let{junctionIdx:r}=e,{stage:a}=e,{newKind:s}=e,{editing:i}=e,{hoveringSidebar:g}=e,{streetviewOn:d}=e,{showContext:_}=e,{select:u}=e,{stopEditing:C}=e,L,D={0:ce.red.background,1:ce.amber.background,2:ce.green.background,X:ce.critical.background};function B(m,T,c){let M={type:"FeatureCollection",features:[]},Y=T??c;return Y!=null&&(Y.kind=="arm"?M.features.push(Ve(m.jat[r][a].arms[Y.idx],Y.idx)):M.features.push($(m.jat[r][a].movements[Y.idx],Y.idx))),M}async function E(m){if(!d){for(let T of L.queryRenderedFeatures(m.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i!=null){await C();return}s=="arm"?(Ce(X,l.jat[r][a].arms=[...l.jat[r][a].arms,{point:m.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[r][a].arms.length-1})):(Ce(X,l.jat[r][a].movements=[...l.jat[r][a].movements,{point1:m.detail.lngLat.toArray(),point2:He(m.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:He(m.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[r][a].movements.length-1}))}}async function v(m){await u({kind:"movement",idx:m.detail.features[0].id})}pt(()=>{w(!1)});function f(m){let T={type:"FeatureCollection",features:m.jat[r][a].movements.map((c,M)=>$(c,M))};for(let c of m.jat[r][a].movements)if(T.features.push(p(c,T.features.length)),c.kind=="walking & wheeling"){let M={...c,point1:c.point3,point3:c.point1};T.features.push(p(M,T.features.length))}return T}function $(m,T){return{type:"Feature",id:T,properties:{name:m.name,kind:m.kind,color:D[m.score]},geometry:{type:"LineString",coordinates:[m.point1,m.point2,m.point3]}}}function p(m,T){return{type:"Feature",id:T,properties:{kind:m.kind,color:D[m.score],angle:Gt(m.point2,m.point3)},geometry:{type:"Point",coordinates:m.point3}}}function w(m){let T=f(l);for(let c of l.jat[r][a].arms)T.features.push(Ve(c,T.features.length));for(let c of l.summary.networkMap.features)T.features.push(c);T.features.length>0&&L.fitBounds(Lt(T),{padding:20,animate:m})}function k(){return L}function q(m,T){n.$$.not_equal(T.point,m)&&(T.point=m,X.set(l))}const I=m=>u({kind:"arm",idx:m}),J=m=>u({kind:"arm",idx:m});function Q(m,T){n.$$.not_equal(T.point1,m)&&(T.point1=m,X.set(l))}const y=m=>u({kind:"movement",idx:m}),ve=m=>u({kind:"movement",idx:m});function pe(m,T){n.$$.not_equal(T.point2,m)&&(T.point2=m,X.set(l))}const ie=m=>u({kind:"movement",idx:m}),K=m=>u({kind:"movement",idx:m});function we(m,T){n.$$.not_equal(T.point3,m)&&(T.point3=m,X.set(l))}const W=m=>u({kind:"movement",idx:m}),se=m=>u({kind:"movement",idx:m});function R(m){L=m,o(5,L)}return n.$$set=m=>{"junctionIdx"in m&&o(0,r=m.junctionIdx),"stage"in m&&o(1,a=m.stage),"newKind"in m&&o(11,s=m.newKind),"editing"in m&&o(12,i=m.editing),"hoveringSidebar"in m&&o(13,g=m.hoveringSidebar),"streetviewOn"in m&&o(14,d=m.streetviewOn),"showContext"in m&&o(2,_=m.showContext),"select"in m&&o(3,u=m.select),"stopEditing"in m&&o(15,C=m.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&12304&&o(6,t=B(l,i,g))},[r,a,_,u,l,L,t,D,E,v,f,s,i,g,d,C,w,k,q,I,J,Q,y,ve,pe,ie,K,we,W,se,R]}class ln extends Me{constructor(e){super(),Se(this,e,on,tn,he,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function rn(n){let e,o,t,l,r,a,s,i,g,d,_,u;function C(p){n[5](p)}let L={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(L.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new De({props:L}),x.push(()=>oe(e,"value",C));function D(p){n[6](p)}let B={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(B.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new Pe({props:B}),x.push(()=>oe(l,"value",D));function E(p){n[7](p)}let v={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(v.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new Pe({props:v}),x.push(()=>oe(s,"value",E));function f(p){n[8](p)}let $={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),d=new st({props:$}),x.push(()=>oe(d,"value",f)),{c(){N(e.$$.fragment),t=U(),N(l.$$.fragment),a=U(),N(s.$$.fragment),g=U(),N(d.$$.fragment)},l(p){A(e.$$.fragment,p),t=F(p),A(l.$$.fragment,p),a=F(p),A(s.$$.fragment,p),g=F(p),A(d.$$.fragment,p)},m(p,w){P(e,p,w),S(p,t,w),P(l,p,w),S(p,a,w),P(s,p,w),S(p,g,w),P(d,p,w),u=!0},p(p,[w]){const k={};!o&&w&15&&(o=!0,k.value=p[3].jat[p[0]][p[1]].movements[p[2]].name,ne(()=>o=!1)),e.$set(k);const q={};!r&&w&15&&(r=!0,q.value=p[3].jat[p[0]][p[1]].movements[p[2]].kind,ne(()=>r=!1)),l.$set(q);const I={};!i&&w&15&&(i=!0,I.value=p[3].jat[p[0]][p[1]].movements[p[2]].score,ne(()=>i=!1)),s.$set(I);const J={};!_&&w&15&&(_=!0,J.value=p[3].jat[p[0]][p[1]].movements[p[2]].notes,ne(()=>_=!1)),d.$set(J)},i(p){u||(b(e.$$.fragment,p),b(l.$$.fragment,p),b(s.$$.fragment,p),b(d.$$.fragment,p),u=!0)},o(p){j(e.$$.fragment,p),j(l.$$.fragment,p),j(s.$$.fragment,p),j(d.$$.fragment,p),u=!1},d(p){p&&(h(t),h(a),h(g)),z(e,p),z(l,p),z(s,p),z(d,p)}}}function an(n,e,o){let t;Ie(n,X,u=>o(3,t=u));let{junctionIdx:l}=e,{stage:r}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function i(u){n.$$.not_equal(t.jat[l][r].movements[a].name,u)&&(t.jat[l][r].movements[a].name=u,X.set(t))}function g(u){n.$$.not_equal(t.jat[l][r].movements[a].kind,u)&&(t.jat[l][r].movements[a].kind=u,X.set(t))}function d(u){n.$$.not_equal(t.jat[l][r].movements[a].score,u)&&(t.jat[l][r].movements[a].score=u,X.set(t))}function _(u){n.$$.not_equal(t.jat[l][r].movements[a].notes,u)&&(t.jat[l][r].movements[a].notes=u,X.set(t))}return n.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,r=u.stage),"idx"in u&&o(2,a=u.idx)},[l,r,a,t,s,i,g,d,_]}class sn extends Me{constructor(e){super(),Se(this,e,an,rn,he,{junctionIdx:0,stage:1,idx:2})}}const{window:fn}=yt;function Xe(n,e,o){const t=n.slice();t[34]=e[o],t[37]=o;const l=t[17][t[34].score];return t[35]=l,t}function We(n,e,o){const t=n.slice();return t[38]=e[o],t[37]=o,t}function un(n){let e,o,t,l,r,a,s,i;e=new rt({props:{$$slots:{default:[cn]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new at({props:{$$slots:{default:[_n]},$$scope:{ctx:n}}}),t.$on("click",n[13]);const g=[dn,gn],d=[];function _(u,C){return u[3].kind=="movement"?0:1}return r=_(n),a=d[r]=g[r](n),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U(),a.c(),s=_e()},l(u){A(e.$$.fragment,u),o=F(u),A(t.$$.fragment,u),l=F(u),a.l(u),s=_e()},m(u,C){P(e,u,C),S(u,o,C),P(t,u,C),S(u,l,C),d[r].m(u,C),S(u,s,C),i=!0},p(u,C){const L={};C[1]&512&&(L.$$scope={dirty:C,ctx:u}),e.$set(L);const D={};C[1]&512&&(D.$$scope={dirty:C,ctx:u}),t.$set(D);let B=r;r=_(u),r===B?d[r].p(u,C):(re(),j(d[B],1,1,()=>{d[B]=null}),ae(),a=d[r],a?a.p(u,C):(a=d[r]=g[r](u),a.c()),b(a,1),a.m(s.parentNode,s))},i(u){i||(b(e.$$.fragment,u),b(t.$$.fragment,u),b(a),i=!0)},o(u){j(e.$$.fragment,u),j(t.$$.fragment,u),j(a),i=!1},d(u){u&&(h(o),h(l),h(s)),z(e,u),z(t,u),d[r].d(u)}}}function mn(n){let e,o,t,l,r,a,s,i=(n[9].jat[n[0]].name||"Untitled junction")+"",g,d,_,u,C,L,D,B="Arms",E,v,f,$,p="Movements",w,k,q,I;e=new zt({props:{label:"Tools",$$slots:{default:[hn]},$$scope:{ctx:n}}});function J(c,M){return c[9].jat[c[0]][c[1]].movements.length>0?bn:kn}let Q=J(n),y=Q(n);function ve(c){n[22](c)}let pe={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};n[2]!==void 0&&(pe.value=n[2]),u=new Pe({props:pe}),x.push(()=>oe(u,"value",ve));let ie=ue(n[9].jat[n[0]][n[1]].arms),K=[];for(let c=0;c<ie.length;c+=1)K[c]=Ze(We(n,ie,c));const we=c=>j(K[c],1,1,()=>{K[c]=null});let W=n[9].jat[n[0]][n[10]].arms.length>0&&Qe(n),se=ue(n[9].jat[n[0]][n[1]].movements),R=[];for(let c=0;c<se.length;c+=1)R[c]=Ye(Xe(n,se,c));const m=c=>j(R[c],1,1,()=>{R[c]=null});let T=n[9].jat[n[0]][n[10]].movements.length>0&&xe(n);return{c(){N(e.$$.fragment),o=U(),t=ee("p"),l=H("Total JAT score for "),r=H(n[1]),a=U(),s=ee("u"),g=H(i),d=H(`
        :
        `),y.c(),_=U(),N(u.$$.fragment),L=U(),D=ee("h3"),D.textContent=B,E=U();for(let c=0;c<K.length;c+=1)K[c].c();v=U(),W&&W.c(),f=U(),$=ee("h3"),$.textContent=p,w=U();for(let c=0;c<R.length;c+=1)R[c].c();k=U(),T&&T.c(),q=_e()},l(c){A(e.$$.fragment,c),o=F(c),t=te(c,"P",{});var M=le(t);l=G(M,"Total JAT score for "),r=G(M,n[1]),a=F(M),s=te(M,"U",{});var Y=le(s);g=G(Y,i),Y.forEach(h),d=G(M,`
        :
        `),y.l(M),M.forEach(h),_=F(c),A(u.$$.fragment,c),L=F(c),D=te(c,"H3",{"data-svelte-h":!0}),Be(D)!=="svelte-ld74qb"&&(D.textContent=B),E=F(c);for(let fe=0;fe<K.length;fe+=1)K[fe].l(c);v=F(c),W&&W.l(c),f=F(c),$=te(c,"H3",{"data-svelte-h":!0}),Be($)!=="svelte-1dc52s8"&&($.textContent=p),w=F(c);for(let fe=0;fe<R.length;fe+=1)R[fe].l(c);k=F(c),T&&T.l(c),q=_e()},m(c,M){P(e,c,M),S(c,o,M),S(c,t,M),Z(t,l),Z(t,r),Z(t,a),Z(t,s),Z(s,g),Z(t,d),y.m(t,null),S(c,_,M),P(u,c,M),S(c,L,M),S(c,D,M),S(c,E,M);for(let Y=0;Y<K.length;Y+=1)K[Y]&&K[Y].m(c,M);S(c,v,M),W&&W.m(c,M),S(c,f,M),S(c,$,M),S(c,w,M);for(let Y=0;Y<R.length;Y+=1)R[Y]&&R[Y].m(c,M);S(c,k,M),T&&T.m(c,M),S(c,q,M),I=!0},p(c,M){const Y={};M[0]&224|M[1]&512&&(Y.$$scope={dirty:M,ctx:c}),e.$set(Y),(!I||M[0]&2)&&me(r,c[1]),(!I||M[0]&513)&&i!==(i=(c[9].jat[c[0]].name||"Untitled junction")+"")&&me(g,i),Q===(Q=J(c))&&y?y.p(c,M):(y.d(1),y=Q(c),y&&(y.c(),y.m(t,null)));const fe={};if(!C&&M[0]&4&&(C=!0,fe.value=c[2],ne(()=>C=!1)),u.$set(fe),M[0]&2579){ie=ue(c[9].jat[c[0]][c[1]].arms);let O;for(O=0;O<ie.length;O+=1){const je=We(c,ie,O);K[O]?(K[O].p(je,M),b(K[O],1)):(K[O]=Ze(je),K[O].c(),b(K[O],1),K[O].m(v.parentNode,v))}for(re(),O=ie.length;O<K.length;O+=1)we(O);ae()}if(c[9].jat[c[0]][c[10]].arms.length>0?W?(W.p(c,M),M[0]&513&&b(W,1)):(W=Qe(c),W.c(),b(W,1),W.m(f.parentNode,f)):W&&(re(),j(W,1,1,()=>{W=null}),ae()),M[0]&133651){se=ue(c[9].jat[c[0]][c[1]].movements);let O;for(O=0;O<se.length;O+=1){const je=Xe(c,se,O);R[O]?(R[O].p(je,M),b(R[O],1)):(R[O]=Ye(je),R[O].c(),b(R[O],1),R[O].m(k.parentNode,k))}for(re(),O=se.length;O<R.length;O+=1)m(O);ae()}c[9].jat[c[0]][c[10]].movements.length>0?T?(T.p(c,M),M[0]&513&&b(T,1)):(T=xe(c),T.c(),b(T,1),T.m(q.parentNode,q)):T&&(re(),j(T,1,1,()=>{T=null}),ae())},i(c){if(!I){b(e.$$.fragment,c),b(u.$$.fragment,c);for(let M=0;M<ie.length;M+=1)b(K[M]);b(W);for(let M=0;M<se.length;M+=1)b(R[M]);b(T),I=!0}},o(c){j(e.$$.fragment,c),j(u.$$.fragment,c),K=K.filter(Boolean);for(let M=0;M<K.length;M+=1)j(K[M]);j(W),R=R.filter(Boolean);for(let M=0;M<R.length;M+=1)j(R[M]);j(T),I=!1},d(c){c&&(h(o),h(t),h(_),h(L),h(D),h(E),h(v),h(f),h($),h(w),h(k),h(q)),z(e,c),y.d(),z(u,c),Le(K,c),W&&W.d(c),Le(R,c),T&&T.d(c)}}}function cn(n){let e;return{c(){e=H("Save")},l(o){e=G(o,"Save")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function _n(n){let e;return{c(){e=H("Delete")},l(o){e=G(o,"Delete")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function gn(n){let e,o,t;function l(a){n[29](a)}let r={label:"Arm Name"};return n[9].jat[n[0]][n[1]].arms[n[3].idx].name!==void 0&&(r.value=n[9].jat[n[0]][n[1]].arms[n[3].idx].name),e=new De({props:r}),x.push(()=>oe(e,"value",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};!o&&s[0]&523&&(o=!0,i.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,ne(()=>o=!1)),e.$set(i)},i(a){t||(b(e.$$.fragment,a),t=!0)},o(a){j(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function dn(n){let e,o;return e=new sn({props:{junctionIdx:n[0],stage:n[1],idx:n[3].idx}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[0]&1&&(r.junctionIdx=t[0]),l[0]&2&&(r.stage=t[1]),l[0]&8&&(r.idx=t[3].idx),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function pn(n){let e;return{c(){e=H("Zoom to fit")},l(o){e=G(o,"Zoom to fit")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function $n(n){let e;return{c(){e=H("Show scheme context")},l(o){e=G(o,"Show scheme context")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function hn(n){var E;let e,o,t,l,r,a,s,i,g,d,_,u;e=new be({props:{$$slots:{default:[pn]},$$scope:{ctx:n}}}),e.$on("click",n[19]),t=new Et({}),r=new Nt({});function C(v){n[20](v)}let L={map:(E=n[7])==null?void 0:E.getMap()};n[5]!==void 0&&(L.enabled=n[5]),s=new At({props:L}),x.push(()=>oe(s,"enabled",C));function D(v){n[21](v)}let B={$$slots:{default:[$n]},$$scope:{ctx:n}};return n[6]!==void 0&&(B.checked=n[6]),d=new Pt({props:B}),x.push(()=>oe(d,"checked",D)),{c(){N(e.$$.fragment),o=U(),N(t.$$.fragment),l=U(),N(r.$$.fragment),a=U(),N(s.$$.fragment),g=U(),N(d.$$.fragment)},l(v){A(e.$$.fragment,v),o=F(v),A(t.$$.fragment,v),l=F(v),A(r.$$.fragment,v),a=F(v),A(s.$$.fragment,v),g=F(v),A(d.$$.fragment,v)},m(v,f){P(e,v,f),S(v,o,f),P(t,v,f),S(v,l,f),P(r,v,f),S(v,a,f),P(s,v,f),S(v,g,f),P(d,v,f),u=!0},p(v,f){var k;const $={};f[1]&512&&($.$$scope={dirty:f,ctx:v}),e.$set($);const p={};f[0]&128&&(p.map=(k=v[7])==null?void 0:k.getMap()),!i&&f[0]&32&&(i=!0,p.enabled=v[5],ne(()=>i=!1)),s.$set(p);const w={};f[1]&512&&(w.$$scope={dirty:f,ctx:v}),!_&&f[0]&64&&(_=!0,w.checked=v[6],ne(()=>_=!1)),d.$set(w)},i(v){u||(b(e.$$.fragment,v),b(t.$$.fragment,v),b(r.$$.fragment,v),b(s.$$.fragment,v),b(d.$$.fragment,v),u=!0)},o(v){j(e.$$.fragment,v),j(t.$$.fragment,v),j(r.$$.fragment,v),j(s.$$.fragment,v),j(d.$$.fragment,v),u=!1},d(v){v&&(h(o),h(l),h(a),h(g)),z(e,v),z(t,v),z(r,v),z(s,v),z(d,v)}}}function kn(n){let e;return{c(){e=H("No movements added")},l(o){e=G(o,"No movements added")},m(o,t){S(o,e,t)},p:ke,d(o){o&&h(e)}}}function bn(n){let e=Math.round(tt(n[9].jat[n[0]][n[1]]))+"",o,t;return{c(){o=H(e),t=H("%")},l(l){o=G(l,e),t=G(l,"%")},m(l,r){S(l,o,r),S(l,t,r)},p(l,r){r[0]&515&&e!==(e=Math.round(tt(l[9].jat[l[0]][l[1]]))+"")&&me(o,e)},d(l){l&&(h(o),h(t))}}}function Ze(n){let e,o;function t(){return n[23](n[37])}function l(){return n[24](n[37])}return e=new ze({props:{name:`${et(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[25]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=`${et(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(s)},i(r){o||(b(e.$$.fragment,r),o=!0)},o(r){j(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function Qe(n){let e,o;return e=new be({props:{$$slots:{default:[vn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function vn(n){let e,o;return{c(){e=H("Copy arms from "),o=H(n[10])},l(t){e=G(t,"Copy arms from "),o=G(t,n[10])},m(t,l){S(t,e,l),S(t,o,l)},p:ke,d(t){t&&(h(e),h(o))}}}function wn(n){let e,o,t,l=n[34].score+"",r,a,s,i=Oe(n[34].kind)+"",g;return{c(){e=ee("div"),o=ee("span"),t=H("Score: "),r=H(l),a=U(),s=ee("span"),g=H(i),this.h()},l(d){e=te(d,"DIV",{style:!0});var _=le(e);o=te(_,"SPAN",{style:!0});var u=le(o);t=G(u,"Score: "),r=G(u,l),u.forEach(h),a=F(_),s=te(_,"SPAN",{});var C=le(s);g=G(C,i),C.forEach(h),_.forEach(h),this.h()},h(){V(o,"padding","4px"),V(o,"color",n[35].font),V(o,"background-color",n[35].background),V(e,"width","100%"),V(e,"display","flex"),V(e,"justify-content","space-between")},m(d,_){S(d,e,_),Z(e,o),Z(o,t),Z(o,r),Z(e,a),Z(e,s),Z(s,g)},p(d,_){_[0]&515&&l!==(l=d[34].score+"")&&me(r,l),_[0]&515&&V(o,"color",d[35].font),_[0]&515&&V(o,"background-color",d[35].background),_[0]&515&&i!==(i=Oe(d[34].kind)+"")&&me(g,i)},d(d){d&&h(e)}}}function Ye(n){let e,o;function t(){return n[26](n[37])}function l(){return n[27](n[37])}return e=new ze({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[wn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[28]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=n[34].name||"Unnamed movement"),a[0]&515|a[1]&512&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(r){o||(b(e.$$.fragment,r),o=!0)},o(r){j(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function xe(n){let e,o;return e=new be({props:{$$slots:{default:[jn]},$$scope:{ctx:n}}}),e.$on("click",n[16]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function jn(n){let e,o;return{c(){e=H("Copy movements from "),o=H(n[10])},l(t){e=G(t,"Copy movements from "),o=G(t,n[10])},m(t,l){S(t,e,l),S(t,o,l)},p:ke,d(t){t&&(h(e),h(o))}}}function Cn(n){let e,o,t,l,r,a,s,i,g,d,_,u,C,L,D;function B(k){n[18](k)}let E={label:"Commentary / Notes"};n[9].jat[n[0]][n[1]].notes!==void 0&&(E.value=n[9].jat[n[0]][n[1]].notes),o=new st({props:E}),x.push(()=>oe(o,"value",B));const v=[mn,un],f=[];function $(k,q){return k[3]==null?0:1}s=$(n),i=f[s]=v[s](n);function p(k){n[32](k)}let w={junctionIdx:n[0],stage:n[1],newKind:n[2],hoveringSidebar:n[4],streetviewOn:n[5],showContext:n[6],select:n[11],stopEditing:n[12]};return n[3]!==void 0&&(w.editing=n[3]),_=new ln({props:w}),n[31](_),x.push(()=>oe(_,"editing",p)),{c(){e=ee("div"),N(o.$$.fragment),l=U(),r=ee("div"),a=ee("div"),i.c(),g=U(),d=ee("div"),N(_.$$.fragment),this.h()},l(k){e=te(k,"DIV",{class:!0});var q=le(e);A(o.$$.fragment,q),q.forEach(h),l=F(k),r=te(k,"DIV",{style:!0});var I=le(r);a=te(I,"DIV",{style:!0});var J=le(a);i.l(J),J.forEach(h),g=F(I),d=te(I,"DIV",{style:!0});var Q=le(d);A(_.$$.fragment,Q),Q.forEach(h),I.forEach(h),this.h()},h(){de(e,"class","govuk-width-container"),V(a,"width","30%"),V(a,"overflow-y","scroll"),V(a,"padding","10px"),V(a,"border","1px solid black"),V(d,"position","relative"),V(d,"width","100%"),V(r,"display","flex"),V(r,"height","80vh")},m(k,q){S(k,e,q),P(o,e,null),S(k,l,q),S(k,r,q),Z(r,a),f[s].m(a,null),n[30](a),Z(r,g),Z(r,d),P(_,d,null),C=!0,L||(D=$t(fn,"keydown",n[14]),L=!0)},p(k,q){const I={};!t&&q[0]&515&&(t=!0,I.value=k[9].jat[k[0]][k[1]].notes,ne(()=>t=!1)),o.$set(I);let J=s;s=$(k),s===J?f[s].p(k,q):(re(),j(f[J],1,1,()=>{f[J]=null}),ae(),i=f[s],i?i.p(k,q):(i=f[s]=v[s](k),i.c()),b(i,1),i.m(a,null));const Q={};q[0]&1&&(Q.junctionIdx=k[0]),q[0]&2&&(Q.stage=k[1]),q[0]&4&&(Q.newKind=k[2]),q[0]&16&&(Q.hoveringSidebar=k[4]),q[0]&32&&(Q.streetviewOn=k[5]),q[0]&64&&(Q.showContext=k[6]),!u&&q[0]&8&&(u=!0,Q.editing=k[3],ne(()=>u=!1)),_.$set(Q)},i(k){C||(b(o.$$.fragment,k),b(i),b(_.$$.fragment,k),C=!0)},o(k){j(o.$$.fragment,k),j(i),j(_.$$.fragment,k),C=!1},d(k){k&&(h(e),h(l),h(r)),z(o),f[s].d(),n[30](null),n[31](null),z(_),L=!1,D()}}}function et(n){return String.fromCharCode(n+65)}function tt(n){let e=0,o=0;for(let t of n.movements)e+={0:0,1:1,2:2,X:0}[t.score],o+=2;return e/o*100}function Ln(n,e,o){let t;Ie(n,X,m=>o(9,t=m));let{junctionIdx:l}=e,{stage:r}=e,a=r=="existing"?"proposed":"existing",s="arm",i=null,g=null,d=null,_=!1,u=!0,C=null,L;async function D(m){g=L.scrollTop,o(3,i=m),o(4,d=null)}async function B(){o(3,i=null),g!=null&&(await ht(),o(8,L.scrollTop=g,L),g=null)}function E(){window.confirm(`Delete this ${i.kind}?`)&&(i.kind=="movement"?(t.jat[l][r].movements.splice(i.idx,1),X.set(t)):(t.jat[l][r].arms.splice(i.idx,1),X.set(t)),B())}function v(m){if(i==null)return;let T=m.target.tagName,c=T=="INPUT"||T=="TEXTAREA";m.key=="Escape"||m.key=="Enter"&&!c?(m.stopPropagation(),B()):m.key=="Delete"&&!c&&(m.stopPropagation(),E())}function f(){t.jat[l][r].arms.length>0&&!window.confirm("Overwrite arms?")||(Ce(X,t.jat[l][r].arms=JSON.parse(JSON.stringify(t.jat[l][a].arms)),t),X.set(t))}function $(){t.jat[l][r].movements.length>0&&!window.confirm("Overwrite movements?")||(Ce(X,t.jat[l][r].movements=JSON.parse(JSON.stringify(t.jat[l][a].movements)),t),X.set(t))}let p={0:ce.red,1:ce.amber,2:ce.green,X:ce.critical};function w(m){n.$$.not_equal(t.jat[l][r].notes,m)&&(t.jat[l][r].notes=m,X.set(t))}const k=()=>C==null?void 0:C.zoom(!0);function q(m){_=m,o(5,_)}function I(m){u=m,o(6,u)}function J(m){s=m,o(2,s)}const Q=m=>D({kind:"arm",idx:m}),y=m=>o(4,d={kind:"arm",idx:m}),ve=()=>o(4,d=null),pe=m=>D({kind:"movement",idx:m}),ie=m=>o(4,d={kind:"movement",idx:m}),K=()=>o(4,d=null);function we(m){n.$$.not_equal(t.jat[l][r].arms[i.idx].name,m)&&(t.jat[l][r].arms[i.idx].name=m,X.set(t))}function W(m){x[m?"unshift":"push"](()=>{L=m,o(8,L)})}function se(m){x[m?"unshift":"push"](()=>{C=m,o(7,C)})}function R(m){i=m,o(3,i)}return n.$$set=m=>{"junctionIdx"in m&&o(0,l=m.junctionIdx),"stage"in m&&o(1,r=m.stage)},[l,r,s,i,d,_,u,C,L,t,a,D,B,E,v,f,$,p,w,k,q,I,J,Q,y,ve,pe,ie,K,we,W,se,R]}class Mn extends Me{constructor(e){super(),Se(this,e,Ln,Cn,he,{junctionIdx:0,stage:1},null,[-1,-1])}}function nt(n,e,o){const t=n.slice();return t[10]=e[o],t[12]=o,t}function Sn(n){let e,o,t=(n[1].jat[n[0].idx].name||"Untitled junction")+"",l,r,a=n[0].stage+"",s,i,g,d,_,u,C,L=n[0].stage,D,B;g=new kt({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}});function E($){n[9]($)}let v={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(v.value=n[1].jat[n[0].idx].name),_=new De({props:v}),x.push(()=>oe(_,"value",E));let f=ot(n);return{c(){e=ee("div"),o=ee("h2"),l=H(t),r=H(" - "),s=H(a),i=U(),N(g.$$.fragment),d=U(),N(_.$$.fragment),C=U(),f.c(),D=_e(),this.h()},l($){e=te($,"DIV",{class:!0});var p=le(e);o=te(p,"H2",{});var w=le(o);l=G(w,t),r=G(w," - "),s=G(w,a),w.forEach(h),i=F(p),A(g.$$.fragment,p),d=F(p),A(_.$$.fragment,p),p.forEach(h),C=F($),f.l($),D=_e(),this.h()},h(){de(e,"class","govuk-width-container")},m($,p){S($,e,p),Z(e,o),Z(o,l),Z(o,r),Z(o,s),Z(e,i),P(g,e,null),Z(e,d),P(_,e,null),S($,C,p),f.m($,p),S($,D,p),B=!0},p($,p){(!B||p&3)&&t!==(t=($[1].jat[$[0].idx].name||"Untitled junction")+"")&&me(l,t),(!B||p&1)&&a!==(a=$[0].stage+"")&&me(s,a);const w={};p&8193&&(w.$$scope={dirty:p,ctx:$}),g.$set(w);const k={};!u&&p&3&&(u=!0,k.value=$[1].jat[$[0].idx].name,ne(()=>u=!1)),_.$set(k),p&1&&he(L,L=$[0].stage)?(re(),j(f,1,1,ke),ae(),f=ot($),f.c(),b(f,1),f.m(D.parentNode,D)):f.p($,p)},i($){B||(b(g.$$.fragment,$),b(_.$$.fragment,$),b(f),B=!0)},o($){j(g.$$.fragment,$),j(_.$$.fragment,$),j(f),B=!1},d($){$&&(h(e),h(C),h(D)),z(g),z(_),f.d($)}}}function yn(n){let e,o,t,l;o=new rt({props:{$$slots:{default:[Dn]},$$scope:{ctx:n}}}),o.$on("click",n[2]);let r=ue(n[1].jat),a=[];for(let i=0;i<r.length;i+=1)a[i]=lt(nt(n,r,i));const s=i=>j(a[i],1,1,()=>{a[i]=null});return{c(){e=ee("div"),N(o.$$.fragment),t=U();for(let i=0;i<a.length;i+=1)a[i].c();this.h()},l(i){e=te(i,"DIV",{class:!0});var g=le(e);A(o.$$.fragment,g),t=F(g);for(let d=0;d<a.length;d+=1)a[d].l(g);g.forEach(h),this.h()},h(){de(e,"class","govuk-width-container")},m(i,g){S(i,e,g),P(o,e,null),Z(e,t);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(e,null);l=!0},p(i,g){const d={};if(g&8192&&(d.$$scope={dirty:g,ctx:i}),o.$set(d),g&3){r=ue(i[1].jat);let _;for(_=0;_<r.length;_+=1){const u=nt(i,r,_);a[_]?(a[_].p(u,g),b(a[_],1)):(a[_]=lt(u),a[_].c(),b(a[_],1),a[_].m(e,null))}for(re(),_=r.length;_<a.length;_+=1)s(_);ae()}},i(i){if(!l){b(o.$$.fragment,i);for(let g=0;g<r.length;g+=1)b(a[g]);l=!0}},o(i){j(o.$$.fragment,i),a=a.filter(Boolean);for(let g=0;g<a.length;g+=1)j(a[g]);l=!1},d(i){i&&h(e),z(o),Le(a,i)}}}function In(n){let e;return{c(){e=H("Back to all junctions")},l(o){e=G(o,"Back to all junctions")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function Tn(n){let e,o;return e=new be({props:{$$slots:{default:[Nn]},$$scope:{ctx:n}}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function En(n){let e,o;return e=new be({props:{$$slots:{default:[An]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Nn(n){let e;return{c(){e=H("Edit Proposed")},l(o){e=G(o,"Edit Proposed")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function An(n){let e;return{c(){e=H("Edit Existing")},l(o){e=G(o,"Edit Existing")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function Pn(n){let e;return{c(){e=H("Delete")},l(o){e=G(o,"Delete")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function zn(n){let e,o,t,l,r,a,s;e=new be({props:{$$slots:{default:[In]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const i=[En,Tn],g=[];function d(_,u){return _[0].stage=="proposed"?0:1}return t=d(n),l=g[t]=i[t](n),a=new at({props:{$$slots:{default:[Pn]},$$scope:{ctx:n}}}),a.$on("click",n[8]),{c(){N(e.$$.fragment),o=U(),l.c(),r=U(),N(a.$$.fragment)},l(_){A(e.$$.fragment,_),o=F(_),l.l(_),r=F(_),A(a.$$.fragment,_)},m(_,u){P(e,_,u),S(_,o,u),g[t].m(_,u),S(_,r,u),P(a,_,u),s=!0},p(_,u){const C={};u&8192&&(C.$$scope={dirty:u,ctx:_}),e.$set(C);let L=t;t=d(_),t===L?g[t].p(_,u):(re(),j(g[L],1,1,()=>{g[L]=null}),ae(),l=g[t],l?l.p(_,u):(l=g[t]=i[t](_),l.c()),b(l,1),l.m(r.parentNode,r));const D={};u&8192&&(D.$$scope={dirty:u,ctx:_}),a.$set(D)},i(_){s||(b(e.$$.fragment,_),b(l),b(a.$$.fragment,_),s=!0)},o(_){j(e.$$.fragment,_),j(l),j(a.$$.fragment,_),s=!1},d(_){_&&(h(o),h(r)),z(e,_),g[t].d(_),z(a,_)}}}function ot(n){let e,o;return e=new Mn({props:{junctionIdx:n[0].idx,stage:n[0].stage}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&1&&(r.junctionIdx=t[0].idx),l&1&&(r.stage=t[0].stage),e.$set(r)},i(t){o||(b(e.$$.fragment,t),o=!0)},o(t){j(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Dn(n){let e;return{c(){e=H("Add new junction")},l(o){e=G(o,"Add new junction")},m(o,t){S(o,e,t)},d(o){o&&h(e)}}}function lt(n){let e,o;function t(){return n[4](n[12])}return e=new ze({props:{name:n[10].name||"Untitled junction"}}),e.$on("click",t),{c(){N(e.$$.fragment)},l(l){A(e.$$.fragment,l)},m(l,r){P(e,l,r),o=!0},p(l,r){n=l;const a={};r&2&&(a.name=n[10].name||"Untitled junction"),e.$set(a)},i(l){o||(b(e.$$.fragment,l),o=!0)},o(l){j(e.$$.fragment,l),o=!1},d(l){z(e,l)}}}function qn(n){let e,o,t,l;const r=[yn,Sn],a=[];function s(i,g){return i[0].kind=="list"?0:i[0].kind=="edit"?1:-1}return~(e=s(n))&&(o=a[e]=r[e](n)),{c(){o&&o.c(),t=_e()},l(i){o&&o.l(i),t=_e()},m(i,g){~e&&a[e].m(i,g),S(i,t,g),l=!0},p(i,[g]){let d=e;e=s(i),e===d?~e&&a[e].p(i,g):(o&&(re(),j(a[d],1,1,()=>{a[d]=null}),ae()),~e?(o=a[e],o?o.p(i,g):(o=a[e]=r[e](i),o.c()),b(o,1),o.m(t.parentNode,t)):o=null)},i(i){l||(b(o),l=!0)},o(i){j(o),l=!1},d(i){i&&h(t),~e&&a[e].d(i)}}}function Te(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Bn(n,e,o){let t;Ie(n,X,C=>o(1,t=C));let l={kind:"list"};function r(){Ce(X,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),o(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function a(C){window.confirm("Delete this junction?")&&(t.jat.splice(C,1),X.set(t),o(0,l={kind:"list"}))}const s=C=>o(0,l={kind:"edit",idx:C,stage:"existing"}),i=()=>o(0,l={kind:"list"}),g=()=>o(0,l={kind:"edit",idx:Te(l),stage:"existing"}),d=()=>o(0,l={kind:"edit",idx:Te(l),stage:"proposed"}),_=()=>a(Te(l));function u(C){n.$$.not_equal(t.jat[l.idx].name,C)&&(t.jat[l.idx].name=C,X.set(t))}return[l,t,r,a,s,i,g,d,_,u]}class ro extends Me{constructor(e){super(),Se(this,e,Bn,qn,he,{})}}export{ro as component};
