import{s as $e,r as Y,w as x,l as mt,u as ct,m as _t,o as gt,C as de,k as ye,R as pt,T as je,a as B,g as D,i as L,f as b,F as Ce,n as he,e as te,t as H,c as ne,b as oe,d as J,q as Ie,v as X,h as Q,j as ce,y as dt,W as $t,D as me,p as Be}from"../chunks/scheduler.mGr_ZlpV.js";import{S as Le,i as Me,e as ee,c as N,b as A,m as P,t as v,a as w,d as z,g as le,f as re}from"../chunks/index.rGMSHTnh.js";import{e as ue}from"../chunks/each.K9grjjo2.js";import{C as Pe,B as ht}from"../chunks/ClickableCard.C5ecLatc.js";import{D as ot}from"../chunks/DefaultButton.Mx2gKMUF.js";import{S as ke}from"../chunks/SecondaryButton.BZ-CsghR.js";/* empty css                                                               */import{T as ze}from"../chunks/TextInput.CTsjQvA7.js";import{W as lt}from"../chunks/WarningButton.DoTAjTRB.js";import{s as V}from"../chunks/data.CmflWcam.js";import{L as kt,a as bt,d as ge,t as vt,v as wt,w as Ee,M as jt,b as Ct,C as Lt,G as De,x as Ne,y as Ue,m as Mt,P as rt,l as St}from"../chunks/index.CBNs3x04.js";import{g as Ae}from"../chunks/index.BH7h691i.js";import{c as _e}from"../chunks/colors.DaC397qr.js";import{G as yt}from"../chunks/GeoreferenceLayer.B9dRquSC.js";import{a as It,M as Se,B as Tt,G as Et,S as Nt,C as At}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DoohQwlN.js";import{C as Pt}from"../chunks/CollapsibleCard.Djd8DNlx.js";import{R as at}from"../chunks/Radio.BYzXQffH.js";import{T as it}from"../chunks/TextArea.CsHkafWZ.js";/* empty css                                                    */import"../chunks/paths.Crk4Qnvg.js";import{p as zt}from"../chunks/index.C-Y-j_4O.js";import{S as qt}from"../chunks/Select.CEkXhWTr.js";function Bt(n){let e;const o=n[16].default,t=mt(o,n,n[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,r){t&&t.m(l,r),e=!0},p(l,r){t&&t.p&&(!e||r&16777216)&&ct(t,o,l,l[24],e?gt(o,l[24],r,null):_t(l[24]),null)},i(l){e||(v(t,l),e=!0)},o(l){w(t,l),e=!1},d(l){t&&t.d(l)}}}function Dt(n){let e,o,t;function l(a){n[17](a)}let r={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[Bt]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.hovered=n[0]),e=new kt({props:r}),Y.push(()=>ee(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,[s]){const i={};s&2&&(i.id=a[1]),s&4&&(i.source=a[2]),s&8&&(i.sourceLayer=a[3]),s&16&&(i.beforeId=a[4]),s&32&&(i.beforeLayerType=a[5]),s&64&&(i.paint=a[6]),s&128&&(i.layout=a[7]),s&256&&(i.filter=a[8]),s&512&&(i.applyToClusters=a[9]),s&1024&&(i.minzoom=a[10]),s&2048&&(i.maxzoom=a[11]),s&4096&&(i.hoverCursor=a[12]),s&8192&&(i.manageHoverState=a[13]),s&16384&&(i.eventsIfTopMost=a[14]),s&32768&&(i.interactive=a[15]),s&16777216&&(i.$$scope={dirty:s,ctx:a}),!o&&s&1&&(o=!0,i.hovered=a[0],x(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Ut(n,e,o){let{$$slots:t={},$$scope:l}=e,{id:r=bt("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:i=void 0}=e,{beforeLayerType:_=void 0}=e,{paint:g=void 0}=e,{layout:p=void 0}=e,{filter:u=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:j=void 0}=e,{maxzoom:q=void 0}=e,{hoverCursor:U=void 0}=e,{manageHoverState:E=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:$=!0}=e;function k(S){h=S,o(0,h)}function d(S){de.call(this,n,S)}function y(S){de.call(this,n,S)}function G(S){de.call(this,n,S)}function I(S){de.call(this,n,S)}function F(S){de.call(this,n,S)}function se(S){de.call(this,n,S)}return n.$$set=S=>{"id"in S&&o(1,r=S.id),"source"in S&&o(2,a=S.source),"sourceLayer"in S&&o(3,s=S.sourceLayer),"beforeId"in S&&o(4,i=S.beforeId),"beforeLayerType"in S&&o(5,_=S.beforeLayerType),"paint"in S&&o(6,g=S.paint),"layout"in S&&o(7,p=S.layout),"filter"in S&&o(8,u=S.filter),"applyToClusters"in S&&o(9,C=S.applyToClusters),"minzoom"in S&&o(10,j=S.minzoom),"maxzoom"in S&&o(11,q=S.maxzoom),"hoverCursor"in S&&o(12,U=S.hoverCursor),"manageHoverState"in S&&o(13,E=S.manageHoverState),"hovered"in S&&o(0,h=S.hovered),"eventsIfTopMost"in S&&o(14,f=S.eventsIfTopMost),"interactive"in S&&o(15,$=S.interactive),"$$scope"in S&&o(24,l=S.$$scope)},[h,r,a,s,i,_,g,p,u,C,j,q,U,E,f,$,t,k,d,y,G,I,F,se,l]}class Ot extends Le{constructor(e){super(),Me(this,e,Ut,Dt,$e,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ft=Object.defineProperty,Ht=(n,e)=>Ft(n,"name",{value:e,configurable:!0});function st(n,e,o,t={}){const l=Ae(n),r=ge(l[0]),a=ge(l[1]),s=ge(o),i=vt(e,t.units),_=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(s)),g=r+Math.atan2(Math.sin(s)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(_)),p=Ee(g),u=Ee(_);return wt([p,u],t.properties)}Ht(st,"destination");var Oe=st,Jt=Object.defineProperty,ft=(n,e)=>Jt(n,"name",{value:e,configurable:!0});function qe(n,e,o={}){if(o.final===!0)return ut(n,e);const t=Ae(n),l=Ae(e),r=ge(t[0]),a=ge(l[0]),s=ge(t[1]),i=ge(l[1]),_=Math.sin(a-r)*Math.cos(i),g=Math.cos(s)*Math.sin(i)-Math.sin(s)*Math.cos(i)*Math.cos(a-r);return Ee(Math.atan2(_,g))}ft(qe,"bearing");function ut(n,e){let o=qe(e,n);return o=(o+180)%360,o}ft(ut,"calculateFinalBearing");var Gt=qe;function Fe(n,e,o){const t=n.slice();return t[35]=e[o],t[36]=e,t[37]=o,t}function He(n,e,o){const t=n.slice();return t[38]=e[o],t[39]=e,t[37]=o,t}function Kt(n){let e,o=on(n[37])+"",t;return{c(){e=te("span"),t=H(o),this.h()},l(l){e=ne(l,"SPAN",{class:!0});var r=oe(e);t=J(r,o),r.forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(l,r){L(l,e,r),Q(e,t)},p:he,d(l){l&&b(e)}}}function Je(n){let e,o,t;function l(i){n[18](i,n[38])}function r(){return n[19](n[37])}function a(){return n[20](n[37])}let s={draggable:!0,$$slots:{default:[Kt]},$$scope:{ctx:n}};return n[38].point!==void 0&&(s.lngLat=n[38].point),e=new Se({props:s}),Y.push(()=>ee(e,"lngLat",l)),e.$on("dragend",r),e.$on("click",a),{c(){N(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,_){P(e,i,_),t=!0},p(i,_){n=i;const g={};_[1]&512&&(g.$$scope={dirty:_,ctx:n}),!o&&_[0]&19&&(o=!0,g.lngLat=n[38].point,x(()=>o=!1)),e.$set(g)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){z(e,i)}}}function Rt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score]),X(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score]),t[0]&19&&X(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&b(e)}}}function Xt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score])},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Vt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score]),X(e,"opacity","0%")},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Ge(n){let e,o,t,l,r,a,s,i,_;function g(d){n[21](d,n[35])}function p(){return n[22](n[37])}function u(){return n[23](n[37])}let C={draggable:!0,$$slots:{default:[Rt]},$$scope:{ctx:n}};n[35].point1!==void 0&&(C.lngLat=n[35].point1),e=new Se({props:C}),Y.push(()=>ee(e,"lngLat",g)),e.$on("dragend",p),e.$on("click",u);function j(d){n[24](d,n[35])}function q(){return n[25](n[37])}function U(){return n[26](n[37])}let E={draggable:!0,$$slots:{default:[Xt]},$$scope:{ctx:n}};n[35].point2!==void 0&&(E.lngLat=n[35].point2),l=new Se({props:E}),Y.push(()=>ee(l,"lngLat",j)),l.$on("dragend",q),l.$on("click",U);function h(d){n[27](d,n[35])}function f(){return n[28](n[37])}function $(){return n[29](n[37])}let k={draggable:!0,$$slots:{default:[Vt]},$$scope:{ctx:n}};return n[35].point3!==void 0&&(k.lngLat=n[35].point3),s=new Se({props:k}),Y.push(()=>ee(s,"lngLat",h)),s.$on("dragend",f),s.$on("click",$),{c(){N(e.$$.fragment),t=B(),N(l.$$.fragment),a=B(),N(s.$$.fragment)},l(d){A(e.$$.fragment,d),t=D(d),A(l.$$.fragment,d),a=D(d),A(s.$$.fragment,d)},m(d,y){P(e,d,y),L(d,t,y),P(l,d,y),L(d,a,y),P(s,d,y),_=!0},p(d,y){n=d;const G={};y[0]&19|y[1]&512&&(G.$$scope={dirty:y,ctx:n}),!o&&y[0]&19&&(o=!0,G.lngLat=n[35].point1,x(()=>o=!1)),e.$set(G);const I={};y[0]&19|y[1]&512&&(I.$$scope={dirty:y,ctx:n}),!r&&y[0]&19&&(r=!0,I.lngLat=n[35].point2,x(()=>r=!1)),l.$set(I);const F={};y[0]&19|y[1]&512&&(F.$$scope={dirty:y,ctx:n}),!i&&y[0]&19&&(i=!0,F.lngLat=n[35].point3,x(()=>i=!1)),s.$set(F)},i(d){_||(v(e.$$.fragment,d),v(l.$$.fragment,d),v(s.$$.fragment,d),_=!0)},o(d){w(e.$$.fragment,d),w(l.$$.fragment,d),w(s.$$.fragment,d),_=!1},d(d){d&&(b(t),b(a)),z(e,d),z(l,d),z(s,d)}}}function Wt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=H(e)},l(t){o=J(t,e)},m(t,l){L(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&ce(o,e)},d(t){t&&b(o)}}}function Zt(n){let e,o;return e=new rt({props:{$$slots:{default:[Wt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Qt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=H(e)},l(t){o=J(t,e)},m(t,l){L(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&ce(o,e)},d(t){t&&b(o)}}}function Yt(n){let e,o;return e=new rt({props:{$$slots:{default:[Qt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function xt(n){let e,o,t,l,r,a;return e=new Ne({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ue(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Zt]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Ne({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ue(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Yt]},$$scope:{ctx:n}}}),t.$on("click",n[9]),r=new Ot({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),N(r.$$.fragment)},l(s){A(e.$$.fragment,s),o=D(s),A(t.$$.fragment,s),l=D(s),A(r.$$.fragment,s)},m(s,i){P(e,s,i),L(s,o,i),P(t,s,i),L(s,l,i),P(r,s,i),a=!0},p(s,i){const _={};i[1]&512&&(_.$$scope={dirty:i,ctx:s}),e.$set(_);const g={};i[1]&512&&(g.$$scope={dirty:i,ctx:s}),t.$set(g)},i(s){a||(v(e.$$.fragment,s),v(t.$$.fragment,s),v(r.$$.fragment,s),a=!0)},o(s){w(e.$$.fragment,s),w(t.$$.fragment,s),w(r.$$.fragment,s),a=!1},d(s){s&&(b(o),b(l)),z(e,s),z(t,s),z(r,s)}}}function en(n){let e,o,t,l;return e=new Ne({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Mt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment)},l(r){A(e.$$.fragment,r),o=D(r),A(t.$$.fragment,r)},m(r,a){P(e,r,a),L(r,o,a),P(t,r,a),l=!0},p:he,i(r){l||(v(e.$$.fragment,r),v(t.$$.fragment,r),l=!0)},o(r){w(e.$$.fragment,r),w(t.$$.fragment,r),l=!1},d(r){r&&b(o),z(e,r),z(t,r)}}}function tn(n){let e,o,t,l,r,a,s,i,_,g,p,u;e=new It({}),e.$on("click",n[8]),t=new Lt({props:{gj:n[4].summary.networkMap,show:n[2]}});let C=ue(n[4].jat[n[0]][n[1]].arms),j=[];for(let f=0;f<C.length;f+=1)j[f]=Je(He(n,C,f));const q=f=>w(j[f],1,1,()=>{j[f]=null});let U=ue(n[4].jat[n[0]][n[1]].movements),E=[];for(let f=0;f<U.length;f+=1)E[f]=Ge(Fe(n,U,f));const h=f=>w(E[f],1,1,()=>{E[f]=null});return s=new De({props:{data:n[10](n[4]),$$slots:{default:[xt]},$$scope:{ctx:n}}}),_=new De({props:{data:n[6],$$slots:{default:[en]},$$scope:{ctx:n}}}),p=new yt({props:{map:n[5]}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B();for(let f=0;f<j.length;f+=1)j[f].c();r=B();for(let f=0;f<E.length;f+=1)E[f].c();a=B(),N(s.$$.fragment),i=B(),N(_.$$.fragment),g=B(),N(p.$$.fragment)},l(f){A(e.$$.fragment,f),o=D(f),A(t.$$.fragment,f),l=D(f);for(let $=0;$<j.length;$+=1)j[$].l(f);r=D(f);for(let $=0;$<E.length;$+=1)E[$].l(f);a=D(f),A(s.$$.fragment,f),i=D(f),A(_.$$.fragment,f),g=D(f),A(p.$$.fragment,f)},m(f,$){P(e,f,$),L(f,o,$),P(t,f,$),L(f,l,$);for(let k=0;k<j.length;k+=1)j[k]&&j[k].m(f,$);L(f,r,$);for(let k=0;k<E.length;k+=1)E[k]&&E[k].m(f,$);L(f,a,$),P(s,f,$),L(f,i,$),P(_,f,$),L(f,g,$),P(p,f,$),u=!0},p(f,$){const k={};if($[0]&16&&(k.gj=f[4].summary.networkMap),$[0]&4&&(k.show=f[2]),t.$set(k),$[0]&27){C=ue(f[4].jat[f[0]][f[1]].arms);let I;for(I=0;I<C.length;I+=1){const F=He(f,C,I);j[I]?(j[I].p(F,$),v(j[I],1)):(j[I]=Je(F),j[I].c(),v(j[I],1),j[I].m(r.parentNode,r))}for(le(),I=C.length;I<j.length;I+=1)q(I);re()}if($[0]&155){U=ue(f[4].jat[f[0]][f[1]].movements);let I;for(I=0;I<U.length;I+=1){const F=Fe(f,U,I);E[I]?(E[I].p(F,$),v(E[I],1)):(E[I]=Ge(F),E[I].c(),v(E[I],1),E[I].m(a.parentNode,a))}for(le(),I=U.length;I<E.length;I+=1)h(I);re()}const d={};$[0]&16&&(d.data=f[10](f[4])),$[1]&512&&(d.$$scope={dirty:$,ctx:f}),s.$set(d);const y={};$[0]&64&&(y.data=f[6]),$[1]&512&&(y.$$scope={dirty:$,ctx:f}),_.$set(y);const G={};$[0]&32&&(G.map=f[5]),p.$set(G)},i(f){if(!u){v(e.$$.fragment,f),v(t.$$.fragment,f);for(let $=0;$<C.length;$+=1)v(j[$]);for(let $=0;$<U.length;$+=1)v(E[$]);v(s.$$.fragment,f),v(_.$$.fragment,f),v(p.$$.fragment,f),u=!0}},o(f){w(e.$$.fragment,f),w(t.$$.fragment,f),j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)w(j[$]);E=E.filter(Boolean);for(let $=0;$<E.length;$+=1)w(E[$]);w(s.$$.fragment,f),w(_.$$.fragment,f),w(p.$$.fragment,f),u=!1},d(f){f&&(b(o),b(l),b(r),b(a),b(i),b(g)),z(e,f),z(t,f),Ce(j,f),Ce(E,f),z(s,f),z(_,f),z(p,f)}}}function nn(n){let e,o,t;function l(a){n[30](a)}let r={$$slots:{default:[tn]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.map=n[5]),e=new jt({props:r}),Y.push(()=>ee(e,"map",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};s[0]&127|s[1]&512&&(i.$$scope={dirty:s,ctx:a}),!o&&s[0]&32&&(o=!0,i.map=a[5],x(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function Ke(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function on(n){return String.fromCharCode(n+65)}function ln(n,e,o){let t,l;ye(n,V,m=>o(4,l=m));let{junctionIdx:r}=e,{stage:a}=e,{newKind:s}=e,{editing:i}=e,{hoveringSidebar:_}=e,{streetviewOn:g}=e,{showContext:p}=e,{select:u}=e,{stopEditing:C}=e,j,q={0:_e.red.background,1:_e.amber.background,2:_e.green.background,X:_e.critical.background};function U(m,T,c){let M={type:"FeatureCollection",features:[]},Z=T??c;return Z!=null&&(Z.kind=="arm"?M.features.push(Ke(m.jat[r][a].arms[Z.idx],Z.idx)):M.features.push($(m.jat[r][a].movements[Z.idx],Z.idx))),M}async function E(m){if(!g){for(let T of j.queryRenderedFeatures(m.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i!=null){await C();return}s=="arm"?(je(V,l.jat[r][a].arms=[...l.jat[r][a].arms,{point:m.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[r][a].arms.length-1})):(je(V,l.jat[r][a].movements=[...l.jat[r][a].movements,{point1:m.detail.lngLat.toArray(),point2:Oe(m.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Oe(m.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[r][a].movements.length-1}))}}async function h(m){await u({kind:"movement",idx:m.detail.features[0].id})}pt(()=>{d(!1)});function f(m){let T={type:"FeatureCollection",features:m.jat[r][a].movements.map((c,M)=>$(c,M))};for(let c of m.jat[r][a].movements)if(T.features.push(k(c,T.features.length)),c.kind=="walking & wheeling"){let M={...c,point1:c.point3,point3:c.point1};T.features.push(k(M,T.features.length))}return T}function $(m,T){return{type:"Feature",id:T,properties:{name:m.name,kind:m.kind,color:q[m.score]},geometry:{type:"LineString",coordinates:[m.point1,m.point2,m.point3]}}}function k(m,T){return{type:"Feature",id:T,properties:{kind:m.kind,color:q[m.score],angle:Gt(m.point2,m.point3)},geometry:{type:"Point",coordinates:m.point3}}}function d(m){let T=f(l);for(let c of l.jat[r][a].arms)T.features.push(Ke(c,T.features.length));for(let c of l.summary.networkMap.features)T.features.push(c);T.features.length>0&&j.fitBounds(Ct(T),{padding:20,animate:m})}function y(){return j}function G(m,T){n.$$.not_equal(T.point,m)&&(T.point=m,V.set(l))}const I=m=>u({kind:"arm",idx:m}),F=m=>u({kind:"arm",idx:m});function se(m,T){n.$$.not_equal(T.point1,m)&&(T.point1=m,V.set(l))}const S=m=>u({kind:"movement",idx:m}),be=m=>u({kind:"movement",idx:m});function pe(m,T){n.$$.not_equal(T.point2,m)&&(T.point2=m,V.set(l))}const ae=m=>u({kind:"movement",idx:m}),K=m=>u({kind:"movement",idx:m});function ve(m,T){n.$$.not_equal(T.point3,m)&&(T.point3=m,V.set(l))}const W=m=>u({kind:"movement",idx:m}),ie=m=>u({kind:"movement",idx:m});function R(m){j=m,o(5,j)}return n.$$set=m=>{"junctionIdx"in m&&o(0,r=m.junctionIdx),"stage"in m&&o(1,a=m.stage),"newKind"in m&&o(11,s=m.newKind),"editing"in m&&o(12,i=m.editing),"hoveringSidebar"in m&&o(13,_=m.hoveringSidebar),"streetviewOn"in m&&o(14,g=m.streetviewOn),"showContext"in m&&o(2,p=m.showContext),"select"in m&&o(3,u=m.select),"stopEditing"in m&&o(15,C=m.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&12304&&o(6,t=U(l,i,_))},[r,a,p,u,l,j,t,q,E,h,f,s,i,_,g,C,d,y,G,I,F,se,S,be,pe,ae,K,ve,W,ie,R]}class rn extends Le{constructor(e){super(),Me(this,e,ln,nn,$e,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function an(n){let e,o,t,l,r,a,s,i,_,g,p,u;function C(k){n[5](k)}let j={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(j.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new ze({props:j}),Y.push(()=>ee(e,"value",C));function q(k){n[6](k)}let U={legend:"Movement",choices:zt(["cycling","walking & wheeling"]),inlineSmall:!0};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(U.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new at({props:U}),Y.push(()=>ee(l,"value",q));function E(k){n[7](k)}let h={label:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(h.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new qt({props:h}),Y.push(()=>ee(s,"value",E));function f(k){n[8](k)}let $={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),g=new it({props:$}),Y.push(()=>ee(g,"value",f)),{c(){N(e.$$.fragment),t=B(),N(l.$$.fragment),a=B(),N(s.$$.fragment),_=B(),N(g.$$.fragment)},l(k){A(e.$$.fragment,k),t=D(k),A(l.$$.fragment,k),a=D(k),A(s.$$.fragment,k),_=D(k),A(g.$$.fragment,k)},m(k,d){P(e,k,d),L(k,t,d),P(l,k,d),L(k,a,d),P(s,k,d),L(k,_,d),P(g,k,d),u=!0},p(k,[d]){const y={};!o&&d&15&&(o=!0,y.value=k[3].jat[k[0]][k[1]].movements[k[2]].name,x(()=>o=!1)),e.$set(y);const G={};!r&&d&15&&(r=!0,G.value=k[3].jat[k[0]][k[1]].movements[k[2]].kind,x(()=>r=!1)),l.$set(G);const I={};!i&&d&15&&(i=!0,I.value=k[3].jat[k[0]][k[1]].movements[k[2]].score,x(()=>i=!1)),s.$set(I);const F={};!p&&d&15&&(p=!0,F.value=k[3].jat[k[0]][k[1]].movements[k[2]].notes,x(()=>p=!1)),g.$set(F)},i(k){u||(v(e.$$.fragment,k),v(l.$$.fragment,k),v(s.$$.fragment,k),v(g.$$.fragment,k),u=!0)},o(k){w(e.$$.fragment,k),w(l.$$.fragment,k),w(s.$$.fragment,k),w(g.$$.fragment,k),u=!1},d(k){k&&(b(t),b(a),b(_)),z(e,k),z(l,k),z(s,k),z(g,k)}}}function sn(n,e,o){let t;ye(n,V,u=>o(3,t=u));let{junctionIdx:l}=e,{stage:r}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function i(u){n.$$.not_equal(t.jat[l][r].movements[a].name,u)&&(t.jat[l][r].movements[a].name=u,V.set(t))}function _(u){n.$$.not_equal(t.jat[l][r].movements[a].kind,u)&&(t.jat[l][r].movements[a].kind=u,V.set(t))}function g(u){n.$$.not_equal(t.jat[l][r].movements[a].score,u)&&(t.jat[l][r].movements[a].score=u,V.set(t))}function p(u){n.$$.not_equal(t.jat[l][r].movements[a].notes,u)&&(t.jat[l][r].movements[a].notes=u,V.set(t))}return n.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,r=u.stage),"idx"in u&&o(2,a=u.idx)},[l,r,a,t,s,i,_,g,p]}class fn extends Le{constructor(e){super(),Me(this,e,sn,an,$e,{junctionIdx:0,stage:1,idx:2})}}const{window:un}=St;function Re(n,e,o){const t=n.slice();t[34]=e[o],t[37]=o;const l=t[17][t[34].score];return t[35]=l,t}function Xe(n,e,o){const t=n.slice();return t[38]=e[o],t[37]=o,t}function mn(n){let e,o,t,l,r,a,s,i;e=new ot({props:{$$slots:{default:[_n]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new lt({props:{$$slots:{default:[gn]},$$scope:{ctx:n}}}),t.$on("click",n[13]);const _=[dn,pn],g=[];function p(u,C){return u[3].kind=="movement"?0:1}return r=p(n),a=g[r]=_[r](n),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),a.c(),s=me()},l(u){A(e.$$.fragment,u),o=D(u),A(t.$$.fragment,u),l=D(u),a.l(u),s=me()},m(u,C){P(e,u,C),L(u,o,C),P(t,u,C),L(u,l,C),g[r].m(u,C),L(u,s,C),i=!0},p(u,C){const j={};C[1]&512&&(j.$$scope={dirty:C,ctx:u}),e.$set(j);const q={};C[1]&512&&(q.$$scope={dirty:C,ctx:u}),t.$set(q);let U=r;r=p(u),r===U?g[r].p(u,C):(le(),w(g[U],1,1,()=>{g[U]=null}),re(),a=g[r],a?a.p(u,C):(a=g[r]=_[r](u),a.c()),v(a,1),a.m(s.parentNode,s))},i(u){i||(v(e.$$.fragment,u),v(t.$$.fragment,u),v(a),i=!0)},o(u){w(e.$$.fragment,u),w(t.$$.fragment,u),w(a),i=!1},d(u){u&&(b(o),b(l),b(s)),z(e,u),z(t,u),g[r].d(u)}}}function cn(n){let e,o,t,l,r,a,s,i=(n[9].jat[n[0]].name||"Untitled junction")+"",_,g,p,u,C,j,q,U="Arms",E,h,f,$,k="Movements",d,y,G,I;e=new Pt({props:{label:"Tools",$$slots:{default:[kn]},$$scope:{ctx:n}}});function F(c,M){return c[9].jat[c[0]][c[1]].movements.length>0?vn:bn}let se=F(n),S=se(n);function be(c){n[22](c)}let pe={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};n[2]!==void 0&&(pe.value=n[2]),u=new at({props:pe}),Y.push(()=>ee(u,"value",be));let ae=ue(n[9].jat[n[0]][n[1]].arms),K=[];for(let c=0;c<ae.length;c+=1)K[c]=Ve(Xe(n,ae,c));const ve=c=>w(K[c],1,1,()=>{K[c]=null});let W=n[9].jat[n[0]][n[10]].arms.length>0&&We(n),ie=ue(n[9].jat[n[0]][n[1]].movements),R=[];for(let c=0;c<ie.length;c+=1)R[c]=Ze(Re(n,ie,c));const m=c=>w(R[c],1,1,()=>{R[c]=null});let T=n[9].jat[n[0]][n[10]].movements.length>0&&Qe(n);return{c(){N(e.$$.fragment),o=B(),t=te("p"),l=H("Total JAT score for "),r=H(n[1]),a=B(),s=te("u"),_=H(i),g=H(`
        :
        `),S.c(),p=B(),N(u.$$.fragment),j=B(),q=te("h3"),q.textContent=U,E=B();for(let c=0;c<K.length;c+=1)K[c].c();h=B(),W&&W.c(),f=B(),$=te("h3"),$.textContent=k,d=B();for(let c=0;c<R.length;c+=1)R[c].c();y=B(),T&&T.c(),G=me()},l(c){A(e.$$.fragment,c),o=D(c),t=ne(c,"P",{});var M=oe(t);l=J(M,"Total JAT score for "),r=J(M,n[1]),a=D(M),s=ne(M,"U",{});var Z=oe(s);_=J(Z,i),Z.forEach(b),g=J(M,`
        :
        `),S.l(M),M.forEach(b),p=D(c),A(u.$$.fragment,c),j=D(c),q=ne(c,"H3",{"data-svelte-h":!0}),Be(q)!=="svelte-ld74qb"&&(q.textContent=U),E=D(c);for(let fe=0;fe<K.length;fe+=1)K[fe].l(c);h=D(c),W&&W.l(c),f=D(c),$=ne(c,"H3",{"data-svelte-h":!0}),Be($)!=="svelte-1dc52s8"&&($.textContent=k),d=D(c);for(let fe=0;fe<R.length;fe+=1)R[fe].l(c);y=D(c),T&&T.l(c),G=me()},m(c,M){P(e,c,M),L(c,o,M),L(c,t,M),Q(t,l),Q(t,r),Q(t,a),Q(t,s),Q(s,_),Q(t,g),S.m(t,null),L(c,p,M),P(u,c,M),L(c,j,M),L(c,q,M),L(c,E,M);for(let Z=0;Z<K.length;Z+=1)K[Z]&&K[Z].m(c,M);L(c,h,M),W&&W.m(c,M),L(c,f,M),L(c,$,M),L(c,d,M);for(let Z=0;Z<R.length;Z+=1)R[Z]&&R[Z].m(c,M);L(c,y,M),T&&T.m(c,M),L(c,G,M),I=!0},p(c,M){const Z={};M[0]&224|M[1]&512&&(Z.$$scope={dirty:M,ctx:c}),e.$set(Z),(!I||M[0]&2)&&ce(r,c[1]),(!I||M[0]&513)&&i!==(i=(c[9].jat[c[0]].name||"Untitled junction")+"")&&ce(_,i),se===(se=F(c))&&S?S.p(c,M):(S.d(1),S=se(c),S&&(S.c(),S.m(t,null)));const fe={};if(!C&&M[0]&4&&(C=!0,fe.value=c[2],x(()=>C=!1)),u.$set(fe),M[0]&2579){ae=ue(c[9].jat[c[0]][c[1]].arms);let O;for(O=0;O<ae.length;O+=1){const we=Xe(c,ae,O);K[O]?(K[O].p(we,M),v(K[O],1)):(K[O]=Ve(we),K[O].c(),v(K[O],1),K[O].m(h.parentNode,h))}for(le(),O=ae.length;O<K.length;O+=1)ve(O);re()}if(c[9].jat[c[0]][c[10]].arms.length>0?W?(W.p(c,M),M[0]&513&&v(W,1)):(W=We(c),W.c(),v(W,1),W.m(f.parentNode,f)):W&&(le(),w(W,1,1,()=>{W=null}),re()),M[0]&133651){ie=ue(c[9].jat[c[0]][c[1]].movements);let O;for(O=0;O<ie.length;O+=1){const we=Re(c,ie,O);R[O]?(R[O].p(we,M),v(R[O],1)):(R[O]=Ze(we),R[O].c(),v(R[O],1),R[O].m(y.parentNode,y))}for(le(),O=ie.length;O<R.length;O+=1)m(O);re()}c[9].jat[c[0]][c[10]].movements.length>0?T?(T.p(c,M),M[0]&513&&v(T,1)):(T=Qe(c),T.c(),v(T,1),T.m(G.parentNode,G)):T&&(le(),w(T,1,1,()=>{T=null}),re())},i(c){if(!I){v(e.$$.fragment,c),v(u.$$.fragment,c);for(let M=0;M<ae.length;M+=1)v(K[M]);v(W);for(let M=0;M<ie.length;M+=1)v(R[M]);v(T),I=!0}},o(c){w(e.$$.fragment,c),w(u.$$.fragment,c),K=K.filter(Boolean);for(let M=0;M<K.length;M+=1)w(K[M]);w(W),R=R.filter(Boolean);for(let M=0;M<R.length;M+=1)w(R[M]);w(T),I=!1},d(c){c&&(b(o),b(t),b(p),b(j),b(q),b(E),b(h),b(f),b($),b(d),b(y),b(G)),z(e,c),S.d(),z(u,c),Ce(K,c),W&&W.d(c),Ce(R,c),T&&T.d(c)}}}function _n(n){let e;return{c(){e=H("Save")},l(o){e=J(o,"Save")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function gn(n){let e;return{c(){e=H("Delete")},l(o){e=J(o,"Delete")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function pn(n){let e,o,t;function l(a){n[29](a)}let r={label:"Arm Name"};return n[9].jat[n[0]][n[1]].arms[n[3].idx].name!==void 0&&(r.value=n[9].jat[n[0]][n[1]].arms[n[3].idx].name),e=new ze({props:r}),Y.push(()=>ee(e,"value",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){P(e,a,s),t=!0},p(a,s){const i={};!o&&s[0]&523&&(o=!0,i.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,x(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){z(e,a)}}}function dn(n){let e,o;return e=new fn({props:{junctionIdx:n[0],stage:n[1],idx:n[3].idx}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[0]&1&&(r.junctionIdx=t[0]),l[0]&2&&(r.stage=t[1]),l[0]&8&&(r.idx=t[3].idx),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function $n(n){let e;return{c(){e=H("Zoom to fit")},l(o){e=J(o,"Zoom to fit")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function hn(n){let e;return{c(){e=H("Show scheme context")},l(o){e=J(o,"Show scheme context")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function kn(n){var E;let e,o,t,l,r,a,s,i,_,g,p,u;e=new ke({props:{$$slots:{default:[$n]},$$scope:{ctx:n}}}),e.$on("click",n[19]),t=new Tt({}),r=new Et({});function C(h){n[20](h)}let j={map:(E=n[7])==null?void 0:E.getMap()};n[5]!==void 0&&(j.enabled=n[5]),s=new Nt({props:j}),Y.push(()=>ee(s,"enabled",C));function q(h){n[21](h)}let U={$$slots:{default:[hn]},$$scope:{ctx:n}};return n[6]!==void 0&&(U.checked=n[6]),g=new At({props:U}),Y.push(()=>ee(g,"checked",q)),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),N(r.$$.fragment),a=B(),N(s.$$.fragment),_=B(),N(g.$$.fragment)},l(h){A(e.$$.fragment,h),o=D(h),A(t.$$.fragment,h),l=D(h),A(r.$$.fragment,h),a=D(h),A(s.$$.fragment,h),_=D(h),A(g.$$.fragment,h)},m(h,f){P(e,h,f),L(h,o,f),P(t,h,f),L(h,l,f),P(r,h,f),L(h,a,f),P(s,h,f),L(h,_,f),P(g,h,f),u=!0},p(h,f){var y;const $={};f[1]&512&&($.$$scope={dirty:f,ctx:h}),e.$set($);const k={};f[0]&128&&(k.map=(y=h[7])==null?void 0:y.getMap()),!i&&f[0]&32&&(i=!0,k.enabled=h[5],x(()=>i=!1)),s.$set(k);const d={};f[1]&512&&(d.$$scope={dirty:f,ctx:h}),!p&&f[0]&64&&(p=!0,d.checked=h[6],x(()=>p=!1)),g.$set(d)},i(h){u||(v(e.$$.fragment,h),v(t.$$.fragment,h),v(r.$$.fragment,h),v(s.$$.fragment,h),v(g.$$.fragment,h),u=!0)},o(h){w(e.$$.fragment,h),w(t.$$.fragment,h),w(r.$$.fragment,h),w(s.$$.fragment,h),w(g.$$.fragment,h),u=!1},d(h){h&&(b(o),b(l),b(a),b(_)),z(e,h),z(t,h),z(r,h),z(s,h),z(g,h)}}}function bn(n){let e;return{c(){e=H("No movements added")},l(o){e=J(o,"No movements added")},m(o,t){L(o,e,t)},p:he,d(o){o&&b(e)}}}function vn(n){let e=Math.round(xe(n[9].jat[n[0]][n[1]]))+"",o,t;return{c(){o=H(e),t=H("%")},l(l){o=J(l,e),t=J(l,"%")},m(l,r){L(l,o,r),L(l,t,r)},p(l,r){r[0]&515&&e!==(e=Math.round(xe(l[9].jat[l[0]][l[1]]))+"")&&ce(o,e)},d(l){l&&(b(o),b(t))}}}function Ve(n){let e,o;function t(){return n[23](n[37])}function l(){return n[24](n[37])}return e=new Pe({props:{name:`${Ye(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[25]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=`${Ye(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(s)},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){w(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function We(n){let e,o;return e=new ke({props:{$$slots:{default:[wn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function wn(n){let e,o;return{c(){e=H("Copy arms from "),o=H(n[10])},l(t){e=J(t,"Copy arms from "),o=J(t,n[10])},m(t,l){L(t,e,l),L(t,o,l)},p:he,d(t){t&&(b(e),b(o))}}}function jn(n){let e,o,t,l=n[34].score+"",r,a,s,i=n[34].kind+"",_;return{c(){e=te("div"),o=te("span"),t=H("Score: "),r=H(l),a=B(),s=te("span"),_=H(i),this.h()},l(g){e=ne(g,"DIV",{style:!0});var p=oe(e);o=ne(p,"SPAN",{style:!0});var u=oe(o);t=J(u,"Score: "),r=J(u,l),u.forEach(b),a=D(p),s=ne(p,"SPAN",{});var C=oe(s);_=J(C,i),C.forEach(b),p.forEach(b),this.h()},h(){X(o,"padding","4px"),X(o,"color",n[35].font),X(o,"background-color",n[35].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(g,p){L(g,e,p),Q(e,o),Q(o,t),Q(o,r),Q(e,a),Q(e,s),Q(s,_)},p(g,p){p[0]&515&&l!==(l=g[34].score+"")&&ce(r,l),p[0]&515&&X(o,"color",g[35].font),p[0]&515&&X(o,"background-color",g[35].background),p[0]&515&&i!==(i=g[34].kind+"")&&ce(_,i)},d(g){g&&b(e)}}}function Ze(n){let e,o;function t(){return n[26](n[37])}function l(){return n[27](n[37])}return e=new Pe({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[jn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[28]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){P(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=n[34].name||"Unnamed movement"),a[0]&515|a[1]&512&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){w(e.$$.fragment,r),o=!1},d(r){z(e,r)}}}function Qe(n){let e,o;return e=new ke({props:{$$slots:{default:[Cn]},$$scope:{ctx:n}}}),e.$on("click",n[16]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Cn(n){let e,o;return{c(){e=H("Copy movements from "),o=H(n[10])},l(t){e=J(t,"Copy movements from "),o=J(t,n[10])},m(t,l){L(t,e,l),L(t,o,l)},p:he,d(t){t&&(b(e),b(o))}}}function Ln(n){let e,o,t,l,r,a,s,i,_,g,p,u,C,j;function q(d){n[18](d)}let U={label:"Commentary / Notes"};n[9].jat[n[0]][n[1]].notes!==void 0&&(U.value=n[9].jat[n[0]][n[1]].notes),e=new it({props:U}),Y.push(()=>ee(e,"value",q));const E=[cn,mn],h=[];function f(d,y){return d[3]==null?0:1}a=f(n),s=h[a]=E[a](n);function $(d){n[32](d)}let k={junctionIdx:n[0],stage:n[1],newKind:n[2],hoveringSidebar:n[4],streetviewOn:n[5],showContext:n[6],select:n[11],stopEditing:n[12]};return n[3]!==void 0&&(k.editing=n[3]),g=new rn({props:k}),n[31](g),Y.push(()=>ee(g,"editing",$)),{c(){N(e.$$.fragment),t=B(),l=te("div"),r=te("div"),s.c(),i=B(),_=te("div"),N(g.$$.fragment),this.h()},l(d){A(e.$$.fragment,d),t=D(d),l=ne(d,"DIV",{style:!0});var y=oe(l);r=ne(y,"DIV",{style:!0});var G=oe(r);s.l(G),G.forEach(b),i=D(y),_=ne(y,"DIV",{style:!0});var I=oe(_);A(g.$$.fragment,I),I.forEach(b),y.forEach(b),this.h()},h(){X(r,"width","30%"),X(r,"overflow-y","scroll"),X(r,"padding","10px"),X(r,"border","1px solid black"),X(_,"position","relative"),X(_,"width","100%"),X(l,"display","flex"),X(l,"height","80vh")},m(d,y){P(e,d,y),L(d,t,y),L(d,l,y),Q(l,r),h[a].m(r,null),n[30](r),Q(l,i),Q(l,_),P(g,_,null),u=!0,C||(j=dt(un,"keydown",n[14]),C=!0)},p(d,y){const G={};!o&&y[0]&515&&(o=!0,G.value=d[9].jat[d[0]][d[1]].notes,x(()=>o=!1)),e.$set(G);let I=a;a=f(d),a===I?h[a].p(d,y):(le(),w(h[I],1,1,()=>{h[I]=null}),re(),s=h[a],s?s.p(d,y):(s=h[a]=E[a](d),s.c()),v(s,1),s.m(r,null));const F={};y[0]&1&&(F.junctionIdx=d[0]),y[0]&2&&(F.stage=d[1]),y[0]&4&&(F.newKind=d[2]),y[0]&16&&(F.hoveringSidebar=d[4]),y[0]&32&&(F.streetviewOn=d[5]),y[0]&64&&(F.showContext=d[6]),!p&&y[0]&8&&(p=!0,F.editing=d[3],x(()=>p=!1)),g.$set(F)},i(d){u||(v(e.$$.fragment,d),v(s),v(g.$$.fragment,d),u=!0)},o(d){w(e.$$.fragment,d),w(s),w(g.$$.fragment,d),u=!1},d(d){d&&(b(t),b(l)),z(e,d),h[a].d(),n[30](null),n[31](null),z(g),C=!1,j()}}}function Ye(n){return String.fromCharCode(n+65)}function xe(n){let e=0,o=0;for(let t of n.movements)e+={0:0,1:1,2:2,X:0}[t.score],o+=2;return e/o*100}function Mn(n,e,o){let t;ye(n,V,m=>o(9,t=m));let{junctionIdx:l}=e,{stage:r}=e,a=r=="existing"?"proposed":"existing",s="arm",i=null,_=null,g=null,p=!1,u=!0,C=null,j;async function q(m){_=j.scrollTop,o(3,i=m),o(4,g=null)}async function U(){o(3,i=null),_!=null&&(await $t(),o(8,j.scrollTop=_,j),_=null)}function E(){window.confirm(`Delete this ${i.kind}?`)&&(i.kind=="movement"?(t.jat[l][r].movements.splice(i.idx,1),V.set(t)):(t.jat[l][r].arms.splice(i.idx,1),V.set(t)),U())}function h(m){if(i!=null&&m.key=="Escape")m.stopPropagation(),U();else if(i!=null&&m.key=="Delete"){let T=m.target.tagName;if(T=="INPUT"||T=="TEXTAREA")return;m.stopPropagation(),E()}}function f(){t.jat[l][r].arms.length>0&&!window.confirm("Overwrite arms?")||(je(V,t.jat[l][r].arms=JSON.parse(JSON.stringify(t.jat[l][a].arms)),t),V.set(t))}function $(){t.jat[l][r].movements.length>0&&!window.confirm("Overwrite movements?")||(je(V,t.jat[l][r].movements=JSON.parse(JSON.stringify(t.jat[l][a].movements)),t),V.set(t))}let k={0:_e.red,1:_e.amber,2:_e.green,X:_e.critical};function d(m){n.$$.not_equal(t.jat[l][r].notes,m)&&(t.jat[l][r].notes=m,V.set(t))}const y=()=>C==null?void 0:C.zoom(!0);function G(m){p=m,o(5,p)}function I(m){u=m,o(6,u)}function F(m){s=m,o(2,s)}const se=m=>q({kind:"arm",idx:m}),S=m=>o(4,g={kind:"arm",idx:m}),be=()=>o(4,g=null),pe=m=>q({kind:"movement",idx:m}),ae=m=>o(4,g={kind:"movement",idx:m}),K=()=>o(4,g=null);function ve(m){n.$$.not_equal(t.jat[l][r].arms[i.idx].name,m)&&(t.jat[l][r].arms[i.idx].name=m,V.set(t))}function W(m){Y[m?"unshift":"push"](()=>{j=m,o(8,j)})}function ie(m){Y[m?"unshift":"push"](()=>{C=m,o(7,C)})}function R(m){i=m,o(3,i)}return n.$$set=m=>{"junctionIdx"in m&&o(0,l=m.junctionIdx),"stage"in m&&o(1,r=m.stage)},[l,r,s,i,g,p,u,C,j,t,a,q,U,E,h,f,$,k,d,y,G,I,F,se,S,be,pe,ae,K,ve,W,ie,R]}class Sn extends Le{constructor(e){super(),Me(this,e,Mn,Ln,$e,{junctionIdx:0,stage:1},null,[-1,-1])}}function et(n,e,o){const t=n.slice();return t[10]=e[o],t[12]=o,t}function yn(n){let e,o=(n[1].jat[n[0].idx].name||"Untitled junction")+"",t,l,r=n[0].stage+"",a,s,i,_,g,p,u,C=n[0].stage,j,q;i=new ht({props:{$$slots:{default:[qn]},$$scope:{ctx:n}}});function U(f){n[9](f)}let E={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(E.value=n[1].jat[n[0].idx].name),g=new ze({props:E}),Y.push(()=>ee(g,"value",U));let h=tt(n);return{c(){e=te("h2"),t=H(o),l=H(" - "),a=H(r),s=B(),N(i.$$.fragment),_=B(),N(g.$$.fragment),u=B(),h.c(),j=me()},l(f){e=ne(f,"H2",{});var $=oe(e);t=J($,o),l=J($," - "),a=J($,r),$.forEach(b),s=D(f),A(i.$$.fragment,f),_=D(f),A(g.$$.fragment,f),u=D(f),h.l(f),j=me()},m(f,$){L(f,e,$),Q(e,t),Q(e,l),Q(e,a),L(f,s,$),P(i,f,$),L(f,_,$),P(g,f,$),L(f,u,$),h.m(f,$),L(f,j,$),q=!0},p(f,$){(!q||$&3)&&o!==(o=(f[1].jat[f[0].idx].name||"Untitled junction")+"")&&ce(t,o),(!q||$&1)&&r!==(r=f[0].stage+"")&&ce(a,r);const k={};$&8193&&(k.$$scope={dirty:$,ctx:f}),i.$set(k);const d={};!p&&$&3&&(p=!0,d.value=f[1].jat[f[0].idx].name,x(()=>p=!1)),g.$set(d),$&1&&$e(C,C=f[0].stage)?(le(),w(h,1,1,he),re(),h=tt(f),h.c(),v(h,1),h.m(j.parentNode,j)):h.p(f,$)},i(f){q||(v(i.$$.fragment,f),v(g.$$.fragment,f),v(h),q=!0)},o(f){w(i.$$.fragment,f),w(g.$$.fragment,f),w(h),q=!1},d(f){f&&(b(e),b(s),b(_),b(u),b(j)),z(i,f),z(g,f),h.d(f)}}}function In(n){let e,o,t,l;e=new ot({props:{$$slots:{default:[Bn]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let r=ue(n[1].jat),a=[];for(let i=0;i<r.length;i+=1)a[i]=nt(et(n,r,i));const s=i=>w(a[i],1,1,()=>{a[i]=null});return{c(){N(e.$$.fragment),o=B();for(let i=0;i<a.length;i+=1)a[i].c();t=me()},l(i){A(e.$$.fragment,i),o=D(i);for(let _=0;_<a.length;_+=1)a[_].l(i);t=me()},m(i,_){P(e,i,_),L(i,o,_);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(i,_);L(i,t,_),l=!0},p(i,_){const g={};if(_&8192&&(g.$$scope={dirty:_,ctx:i}),e.$set(g),_&3){r=ue(i[1].jat);let p;for(p=0;p<r.length;p+=1){const u=et(i,r,p);a[p]?(a[p].p(u,_),v(a[p],1)):(a[p]=nt(u),a[p].c(),v(a[p],1),a[p].m(t.parentNode,t))}for(le(),p=r.length;p<a.length;p+=1)s(p);re()}},i(i){if(!l){v(e.$$.fragment,i);for(let _=0;_<r.length;_+=1)v(a[_]);l=!0}},o(i){w(e.$$.fragment,i),a=a.filter(Boolean);for(let _=0;_<a.length;_+=1)w(a[_]);l=!1},d(i){i&&(b(o),b(t)),z(e,i),Ce(a,i)}}}function Tn(n){let e;return{c(){e=H("Back to all junctions")},l(o){e=J(o,"Back to all junctions")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function En(n){let e,o;return e=new ke({props:{$$slots:{default:[An]},$$scope:{ctx:n}}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Nn(n){let e,o;return e=new ke({props:{$$slots:{default:[Pn]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function An(n){let e;return{c(){e=H("Edit Proposed")},l(o){e=J(o,"Edit Proposed")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function Pn(n){let e;return{c(){e=H("Edit Existing")},l(o){e=J(o,"Edit Existing")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function zn(n){let e;return{c(){e=H("Delete")},l(o){e=J(o,"Delete")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function qn(n){let e,o,t,l,r,a,s;e=new ke({props:{$$slots:{default:[Tn]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const i=[Nn,En],_=[];function g(p,u){return p[0].stage=="proposed"?0:1}return t=g(n),l=_[t]=i[t](n),a=new lt({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}}),a.$on("click",n[8]),{c(){N(e.$$.fragment),o=B(),l.c(),r=B(),N(a.$$.fragment)},l(p){A(e.$$.fragment,p),o=D(p),l.l(p),r=D(p),A(a.$$.fragment,p)},m(p,u){P(e,p,u),L(p,o,u),_[t].m(p,u),L(p,r,u),P(a,p,u),s=!0},p(p,u){const C={};u&8192&&(C.$$scope={dirty:u,ctx:p}),e.$set(C);let j=t;t=g(p),t===j?_[t].p(p,u):(le(),w(_[j],1,1,()=>{_[j]=null}),re(),l=_[t],l?l.p(p,u):(l=_[t]=i[t](p),l.c()),v(l,1),l.m(r.parentNode,r));const q={};u&8192&&(q.$$scope={dirty:u,ctx:p}),a.$set(q)},i(p){s||(v(e.$$.fragment,p),v(l),v(a.$$.fragment,p),s=!0)},o(p){w(e.$$.fragment,p),w(l),w(a.$$.fragment,p),s=!1},d(p){p&&(b(o),b(r)),z(e,p),_[t].d(p),z(a,p)}}}function tt(n){let e,o;return e=new Sn({props:{junctionIdx:n[0].idx,stage:n[0].stage}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){P(e,t,l),o=!0},p(t,l){const r={};l&1&&(r.junctionIdx=t[0].idx),l&1&&(r.stage=t[0].stage),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){z(e,t)}}}function Bn(n){let e;return{c(){e=H("Add new junction")},l(o){e=J(o,"Add new junction")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function nt(n){let e,o;function t(){return n[4](n[12])}return e=new Pe({props:{name:n[10].name||"Untitled junction"}}),e.$on("click",t),{c(){N(e.$$.fragment)},l(l){A(e.$$.fragment,l)},m(l,r){P(e,l,r),o=!0},p(l,r){n=l;const a={};r&2&&(a.name=n[10].name||"Untitled junction"),e.$set(a)},i(l){o||(v(e.$$.fragment,l),o=!0)},o(l){w(e.$$.fragment,l),o=!1},d(l){z(e,l)}}}function Dn(n){let e,o,t,l;const r=[In,yn],a=[];function s(i,_){return i[0].kind=="list"?0:i[0].kind=="edit"?1:-1}return~(e=s(n))&&(o=a[e]=r[e](n)),{c(){o&&o.c(),t=me()},l(i){o&&o.l(i),t=me()},m(i,_){~e&&a[e].m(i,_),L(i,t,_),l=!0},p(i,[_]){let g=e;e=s(i),e===g?~e&&a[e].p(i,_):(o&&(le(),w(a[g],1,1,()=>{a[g]=null}),re()),~e?(o=a[e],o?o.p(i,_):(o=a[e]=r[e](i),o.c()),v(o,1),o.m(t.parentNode,t)):o=null)},i(i){l||(v(o),l=!0)},o(i){w(o),l=!1},d(i){i&&b(t),~e&&a[e].d(i)}}}function Te(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Un(n,e,o){let t;ye(n,V,C=>o(1,t=C));let l={kind:"list"};function r(){je(V,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),o(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function a(C){window.confirm("Delete this junction?")&&(t.jat.splice(C,1),V.set(t),o(0,l={kind:"list"}))}const s=C=>o(0,l={kind:"edit",idx:C,stage:"existing"}),i=()=>o(0,l={kind:"list"}),_=()=>o(0,l={kind:"edit",idx:Te(l),stage:"existing"}),g=()=>o(0,l={kind:"edit",idx:Te(l),stage:"proposed"}),p=()=>a(Te(l));function u(C){n.$$.not_equal(t.jat[l.idx].name,C)&&(t.jat[l.idx].name=C,V.set(t))}return[l,t,r,a,s,i,_,g,p,u]}class so extends Le{constructor(e){super(),Me(this,e,Un,Dn,$e,{})}}export{so as component};
