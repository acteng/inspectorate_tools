import{s as Me,v as ne,x as oe,l as Ze,u as Qe,m as Ye,o as xe,H as ce,E as ke,i as L,f as v,a9 as hn,a8 as bn,k as Pe,U as Jt,a7 as Wt,N as ze,e as x,c as ee,b as re,r as et,a as z,g as D,w as te,h as fe,z as yn,t as V,p as wt,d as X,j as $e,q as De,n as mt}from"../chunks/scheduler.Bsni_e59.js";import{S as Ie,i as Te,e as ie,c as T,a as A,m as O,t as w,b as C,d as S,g as ge,f as pe}from"../chunks/index.CCfAUppz.js";import{e as be}from"../chunks/each.ChCadThl.js";import{W as Vt,S as ye}from"../chunks/WarningButton.D9QeV9gM.js";import{T as ct}from"../chunks/TextInput.CHbK327s.js";import{s as Q}from"../chunks/data.HgJIcvLc.js";import{L as Xt,a as Kt,e as vn,m as Oe,i as wn,f as Zt,M as kn,g as $n,G as kt,h as $t}from"../chunks/MapLibreMap.w9NYypRR.js";import{c as We}from"../chunks/colors.CYEpEtTL.js";import{C as jn}from"../chunks/CollapsibleCard.DoOZ0Bze.js";import{D as Cn}from"../chunks/DefaultButton.DyQsHGbh.js";import{a as Ln,R as En,B as Pn,G as Mn,c as In,S as Tn,M as lt,C as An}from"../chunks/GeoreferenceLayer.Ckgkr46x.js";import{T as Qt}from"../chunks/TextArea.DbePhW6L.js";import{p as On}from"../chunks/index.DNB12zf9.js";import{S as jt}from"../chunks/Select.N7F_8zcJ.js";function Sn(t){let e;const n=t[15].default,r=Ze(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&Qe(r,n,o,o[23],e?xe(n,o[23],l,null):Ye(o[23]),null)},i(o){e||(w(r,o),e=!0)},o(o){C(r,o),e=!1},d(o){r&&r.d(o)}}}function Fn(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[Sn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Xt({props:l}),ne.push(()=>ie(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){T(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){O(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Bn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Kt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:u}=e,{layout:y=void 0}=e,{filter:c=void 0}=e,{minzoom:g=void 0}=e,{maxzoom:d=void 0}=e,{hoverCursor:f=void 0}=e,{manageHoverState:p=!1}=e,{hovered:I=null}=e,{eventsIfTopMost:B=!1}=e,{interactive:H=!0}=e;function P(M){I=M,n(0,I)}function k(M){ce.call(this,t,M)}function E(M){ce.call(this,t,M)}function N(M){ce.call(this,t,M)}function K(M){ce.call(this,t,M)}function G(M){ce.call(this,t,M)}function q(M){ce.call(this,t,M)}return t.$$set=M=>{"id"in M&&n(1,l=M.id),"source"in M&&n(2,i=M.source),"sourceLayer"in M&&n(3,a=M.sourceLayer),"beforeId"in M&&n(4,s=M.beforeId),"beforeLayerType"in M&&n(5,m=M.beforeLayerType),"paint"in M&&n(6,u=M.paint),"layout"in M&&n(7,y=M.layout),"filter"in M&&n(8,c=M.filter),"minzoom"in M&&n(9,g=M.minzoom),"maxzoom"in M&&n(10,d=M.maxzoom),"hoverCursor"in M&&n(11,f=M.hoverCursor),"manageHoverState"in M&&n(12,p=M.manageHoverState),"hovered"in M&&n(0,I=M.hovered),"eventsIfTopMost"in M&&n(13,B=M.eventsIfTopMost),"interactive"in M&&n(14,H=M.interactive),"$$scope"in M&&n(23,o=M.$$scope)},[I,l,i,a,s,m,u,y,c,g,d,f,p,B,H,r,P,k,E,N,K,G,q,o]}class at extends Ie{constructor(e){super(),Te(this,e,Bn,Fn,Me,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const qn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),Ct=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function Lt(t){let e,n,r=(t[4]||t[3]instanceof Oe.Marker)&&Et(t);return{c(){e=x("div"),r&&r.c()},l(o){e=ee(o,"DIV",{});var l=re(e);r&&r.l(l),l.forEach(v)},m(o,l){L(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof Oe.Marker?r?(r.p(o,l),l[0]&24&&w(r,1)):(r=Et(o),r.c(),w(r,1),r.m(e,null)):r&&(ge(),C(r,1,1,()=>{r=null}),pe())},i(o){n||(w(r),n=!0)},o(o){C(r),n=!1},d(o){o&&v(e),r&&r.d(),t[32](null)}}}function Et(t){let e;const n=t[30].default,r=Ze(n,t,t[29],Ct);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&Qe(r,n,o,o[29],e?xe(n,o[29],l,qn):Ye(o[29]),Ct)},i(o){e||(w(r,o),e=!0)},o(o){C(r,o),e=!1},d(o){r&&r.d(o)}}}function Nn(t){let e,n,r=t[9].default&&Lt(t);return{c(){r&&r.c(),e=ke()},l(o){r&&r.l(o),e=ke()},m(o,l){r&&r.m(o,l),L(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&w(r,1)):(r=Lt(o),r.c(),w(r,1),r.m(e.parentNode,e)):r&&(ge(),C(r,1,1,()=>{r=null}),pe())},i(o){n||(w(r),n=!0)},o(o){C(r),n=!1},d(o){o&&v(e),r&&r.d(o)}}}function Gn(t,e,n){let r,o,l,i,a,s,{$$slots:m={},$$scope:u}=e;const y=hn(m);let{closeButton:c=void 0}=e,{closeOnClickOutside:g=!0}=e,{closeOnClickInside:d=!1}=e,{closeOnMove:f=!1}=e,{openOn:p="click"}=e,{openIfTopMost:I=!0}=e,{focusAfterOpen:B=!0}=e,{anchor:H=void 0}=e,{offset:P=void 0}=e,{popupClass:k=void 0}=e,{maxWidth:E=void 0}=e,{lngLat:N=void 0}=e,{html:K=void 0}=e,{open:G=!1}=e;const q=bn(),{map:M,popupTarget:j,layerEvent:le,layer:R,eventTopMost:Be}=vn();Pe(t,M,b=>n(2,l=b)),Pe(t,j,b=>n(3,a=b)),Pe(t,le,b=>n(28,i=b)),Pe(t,R,b=>n(35,s=b));const _=["click","dblclick","contextmenu"];let $,Z=!1,Y;function F(){if(!$)return;let b=$.getElement();!b||b===Y||(Y=b,p==="hover"&&(Y.style.pointerEvents="none"),Y.addEventListener("mouseenter",()=>{n(24,Z=!0)},{passive:!0}),Y.addEventListener("mouseleave",()=>{n(24,Z=!1)},{passive:!0}),Y.addEventListener("click",()=>{d&&n(0,G=!1)},{passive:!0}))}Jt(()=>{if(l)return l.on("click",Ae),l.on("contextmenu",Ae),typeof a=="string"&&(l.on("click",a,ve),l.on("dblclick",a,ve),l.on("contextmenu",a,ve),l.on("mousemove",a,Je),l.on("mouseleave",a,Ue),l.on("touchstart",a,He),l.on("touchend",a,Re)),()=>{l!=null&&l.loaded()&&($==null||$.remove(),l.off("click",Ae),l.off("contextmenu",Ae),a instanceof Oe.Marker?a.getPopup()===$&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,ve),l.off("dblclick",a,ve),l.off("contextmenu",a,ve),l.off("mousemove",a,Je),l.off("mouseleave",a,Ue),l.off("touchstart",a,He),l.off("touchend",a,Re)))}});function de(b){return I?!("marker"in b)&&!wn(b)&&Be(b)!==s:!1}let me=null,_e="normal";function ve(b){b.type===p&&(de(b)||("layerType"in b?b.layerType==="deckgl"?(n(10,N=b.coordinate),n(4,me=b.object?[b.object]:null)):(n(10,N=b.lngLat),n(4,me=b.features??[])):(n(10,N=b.lngLat),n(4,me=b.features??[])),setTimeout(()=>n(0,G=!0))))}let we=null;function He(b){we=b.point}function Re(b){if(!we||p!=="hover")return;let he=we.dist(b.point);we=null,he<3&&(n(10,N=b.lngLat),n(4,me=b.features??[]),$.isOpen()?n(25,_e="justOpened"):(n(25,_e="opening"),n(0,G=!0)))}function Ue(b){p!=="hover"||we||_e!=="normal"||(n(0,G=!1),n(4,me=null))}function Je(b){if(!(p!=="hover"||we||_e!=="normal")){if(de(b)){n(0,G=!1),n(4,me=null);return}n(0,G=!0),n(4,me=b.features??[]),n(10,N=b.lngLat)}}function Ae(b){if(_e==="justOpened"){n(25,_e="normal");return}if(!g)return;let he=[Y,a instanceof Oe.Marker?a==null?void 0:a.getElement():null];G&&$.isOpen()&&!he.some(it=>it==null?void 0:it.contains(b.originalEvent.target))&&(b.type==="contextmenu"&&p==="contextmenu"||b.type!=="contextmenu")&&n(0,G=!1)}Wt(()=>{l&&($!=null&&$.isOpen())&&$.remove()});let h;const W=()=>n(0,G=!1);function ae(b){ne[b?"unshift":"push"](()=>{h=b,n(1,h)})}return t.$$set=b=>{"closeButton"in b&&n(11,c=b.closeButton),"closeOnClickOutside"in b&&n(12,g=b.closeOnClickOutside),"closeOnClickInside"in b&&n(13,d=b.closeOnClickInside),"closeOnMove"in b&&n(14,f=b.closeOnMove),"openOn"in b&&n(15,p=b.openOn),"openIfTopMost"in b&&n(16,I=b.openIfTopMost),"focusAfterOpen"in b&&n(17,B=b.focusAfterOpen),"anchor"in b&&n(18,H=b.anchor),"offset"in b&&n(19,P=b.offset),"popupClass"in b&&n(20,k=b.popupClass),"maxWidth"in b&&n(21,E=b.maxWidth),"lngLat"in b&&n(10,N=b.lngLat),"html"in b&&n(22,K=b.html),"open"in b&&n(0,G=b.open),"$$scope"in b&&n(29,u=b.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=c??(!g&&!d)),t.$$.dirty[0]&146685952&&($||(n(23,$=new Oe.Popup({closeButton:r,closeOnClick:!1,closeOnMove:f,focusAfterOpen:B,maxWidth:E,className:k,anchor:H,offset:P})),Y=$.getElement(),$.on("open",()=>{n(0,G=!0),F(),q("open",$)}),$.on("close",()=>{n(0,G=!1),q("close",$)}),$.on("hover",()=>{q("hover",$)}))),t.$$.dirty[0]&8421384&&$&&a instanceof Oe.Marker&&(p==="click"?a.setPopup($):a.getPopup()===$&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&_.includes(p)&&(i==null?void 0:i.type)===p&&(ve(i),ze(le,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=p==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&p==="hover"&&le&&(o&&i&&(i.layerType==="deckgl"?(n(10,N=i.coordinate),n(4,me=i.object?[i.object]:null)):(n(10,N=i.lngLat),n(4,me=i.features??[]))),n(0,G=(o||Z)??!1)),t.$$.dirty[0]&12582914&&(h?$.setDOMContent(h):K&&$.setHTML(K)),t.$$.dirty[0]&8389632&&N&&$.setLngLat(N),t.$$.dirty[0]&41943045&&l){let b=$.isOpen();G&&!b?($.addTo(l),_e==="opening"&&n(25,_e="justOpened")):!G&&b&&$.remove()}},[G,h,l,a,me,M,j,le,R,y,N,c,g,d,f,p,I,B,H,P,k,E,K,$,Z,_e,o,r,i,u,m,W,ae]}class zn extends Ie{constructor(e){super(),Te(this,e,Gn,Nn,Me,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Dn(t){let e;const n=t[16].default,r=Ze(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Qe(r,n,o,o[24],e?xe(n,o[24],l,null):Ye(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){C(r,o),e=!1},d(o){r&&r.d(o)}}}function Hn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Dn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Xt({props:l}),ne.push(()=>ie(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){T(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){O(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Rn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Kt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:u=void 0}=e,{layout:y=void 0}=e,{filter:c=void 0}=e,{applyToClusters:g=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:f=void 0}=e,{hoverCursor:p=void 0}=e,{manageHoverState:I=!1}=e,{hovered:B=null}=e,{eventsIfTopMost:H=!1}=e,{interactive:P=!0}=e;function k(j){B=j,n(0,B)}function E(j){ce.call(this,t,j)}function N(j){ce.call(this,t,j)}function K(j){ce.call(this,t,j)}function G(j){ce.call(this,t,j)}function q(j){ce.call(this,t,j)}function M(j){ce.call(this,t,j)}return t.$$set=j=>{"id"in j&&n(1,l=j.id),"source"in j&&n(2,i=j.source),"sourceLayer"in j&&n(3,a=j.sourceLayer),"beforeId"in j&&n(4,s=j.beforeId),"beforeLayerType"in j&&n(5,m=j.beforeLayerType),"paint"in j&&n(6,u=j.paint),"layout"in j&&n(7,y=j.layout),"filter"in j&&n(8,c=j.filter),"applyToClusters"in j&&n(9,g=j.applyToClusters),"minzoom"in j&&n(10,d=j.minzoom),"maxzoom"in j&&n(11,f=j.maxzoom),"hoverCursor"in j&&n(12,p=j.hoverCursor),"manageHoverState"in j&&n(13,I=j.manageHoverState),"hovered"in j&&n(0,B=j.hovered),"eventsIfTopMost"in j&&n(14,H=j.eventsIfTopMost),"interactive"in j&&n(15,P=j.interactive),"$$scope"in j&&n(24,o=j.$$scope)},[B,l,i,a,s,m,u,y,c,g,d,f,p,I,H,P,r,k,E,N,K,G,q,M,o]}class Un extends Ie{constructor(e){super(),Te(this,e,Rn,Hn,Me,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Jn=t=>({props:t&8}),Pt=t=>({props:Xn(t[3])});function Wn(t){let e,n;const r=t[1].default,o=Ze(r,t,t[2],Pt);return{c(){e=x("div"),o&&o.c(),this.h()},l(l){e=ee(l,"DIV",{class:!0});var i=re(e);o&&o.l(i),i.forEach(v),this.h()},h(){et(e,"class","govuk-prose")},m(l,i){L(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&Qe(o,r,l,l[2],n?xe(r,l[2],i,Jn):Ye(l[2]),Pt)},i(l){n||(w(o,l),n=!0)},o(l){C(o,l),n=!1},d(l){l&&v(e),o&&o.d(l)}}}function Vn(t){let e,n;return e=new zn({props:{openOn:t[0],$$slots:{default:[Wn,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){O(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Xn(t){return t?t[0].properties??{}:{}}function Kn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Yt extends Ie{constructor(e){super(),Te(this,e,Kn,Vn,Me,{openOn:0})}}var Zn=Object.defineProperty,U=(t,e)=>Zn(t,"name",{value:e,configurable:!0}),Qn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!qe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=st(e),o=st(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!qe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return qe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return qe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};U(Qn,"GeojsonEquality");function qe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}U(qe,"sameLength");function st(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}U(st,"explode");var se=63710088e-1,xt={centimeters:se*100,centimetres:se*100,degrees:360/(2*Math.PI),feet:se*3.28084,inches:se*39.37,kilometers:se/1e3,kilometres:se/1e3,meters:se,metres:se,miles:se/1609.344,millimeters:se*1e3,millimetres:se*1e3,nauticalmiles:se/1852,radians:1,yards:se*1.0936},Mt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function je(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}U(je,"feature");function Yn(t,e,n={}){switch(t){case"Point":return tt(e).geometry;case"LineString":return pt(e).geometry;case"Polygon":return gt(e).geometry;case"MultiPoint":return tn(e).geometry;case"MultiLineString":return en(e).geometry;case"MultiPolygon":return nn(e).geometry;default:throw new Error(t+" is invalid")}}U(Yn,"geometry");function tt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Se(t[0])||!Se(t[1]))throw new Error("coordinates must contain numbers");return je({type:"Point",coordinates:t},e,n)}U(tt,"point");function xn(t,e,n={}){return nt(t.map(r=>tt(r,e)),n)}U(xn,"points");function gt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return je({type:"Polygon",coordinates:t},e,n)}U(gt,"polygon");function er(t,e,n={}){return nt(t.map(r=>gt(r,e)),n)}U(er,"polygons");function pt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return je({type:"LineString",coordinates:t},e,n)}U(pt,"lineString");function tr(t,e,n={}){return nt(t.map(r=>pt(r,e)),n)}U(tr,"lineStrings");function nt(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}U(nt,"featureCollection");function en(t,e,n={}){return je({type:"MultiLineString",coordinates:t},e,n)}U(en,"multiLineString");function tn(t,e,n={}){return je({type:"MultiPoint",coordinates:t},e,n)}U(tn,"multiPoint");function nn(t,e,n={}){return je({type:"MultiPolygon",coordinates:t},e,n)}U(nn,"multiPolygon");function nr(t,e,n={}){return je({type:"GeometryCollection",geometries:t},e,n)}U(nr,"geometryCollection");function rr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}U(rr,"round");function rn(t,e="kilometers"){const n=xt[e];if(!n)throw new Error(e+" units is invalid");return t*n}U(rn,"radiansToLength");function rt(t,e="kilometers"){const n=xt[e];if(!n)throw new Error(e+" units is invalid");return t/n}U(rt,"lengthToRadians");function or(t,e){return Ke(rt(t,e))}U(or,"lengthToDegrees");function ir(t){let e=t%360;return e<0&&(e+=360),e}U(ir,"bearingToAzimuth");function Ke(t){return t%(2*Math.PI)*180/Math.PI}U(Ke,"radiansToDegrees");function Xe(t){return t%360*Math.PI/180}U(Xe,"degreesToRadians");function lr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return rn(rt(t,e),n)}U(lr,"convertLength");function ar(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Mt[e];if(!r)throw new Error("invalid original units");const o=Mt[n];if(!o)throw new Error("invalid final units");return t/r*o}U(ar,"convertArea");function Se(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}U(Se,"isNumber");function sr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}U(sr,"isObject");function ur(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Se(e))throw new Error("bbox must only contain numbers")})}U(ur,"validateBBox");function fr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}U(fr,"validateId");var mr=Object.defineProperty,Ce=(t,e)=>mr(t,"name",{value:e,configurable:!0});function on(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Ce(on,"getCoord");function cr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Ce(cr,"getCoords");function ln(t){if(t.length>1&&Se(t[0])&&Se(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return ln(t[0]);throw new Error("coordinates must only contain numbers")}Ce(ln,"containsNumber");function gr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}Ce(gr,"geojsonType");function pr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}Ce(pr,"featureOf");function _r(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}Ce(_r,"collectionOf");function dr(t){return t.type==="Feature"?t.geometry:t}Ce(dr,"getGeom");function hr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Ce(hr,"getType");var br=Object.defineProperty,yr=(t,e)=>br(t,"name",{value:e,configurable:!0});function an(t,e,n,r={}){const o=on(t),l=Xe(o[0]),i=Xe(o[1]),a=Xe(n),s=rt(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),u=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),y=Ke(u),c=Ke(m);return tt([y,c],r.properties)}yr(an,"destination");var vr=an,wr=Object.defineProperty,J=(t,e)=>wr(t,"name",{value:e,configurable:!0}),kr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ne(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=ut(e),o=ut(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ne(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ne(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ne(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(kr,"GeojsonEquality");function Ne(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(Ne,"sameLength");function ut(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(ut,"explode");var ue=63710088e-1,sn={centimeters:ue*100,centimetres:ue*100,degrees:360/(2*Math.PI),feet:ue*3.28084,inches:ue*39.37,kilometers:ue/1e3,kilometres:ue/1e3,meters:ue,metres:ue,miles:ue/1609.344,millimeters:ue*1e3,millimetres:ue*1e3,nauticalmiles:ue/1852,radians:1,yards:ue*1.0936},It={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Le(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J(Le,"feature");function $r(t,e,n={}){switch(t){case"Point":return _t(e).geometry;case"LineString":return ht(e).geometry;case"Polygon":return dt(e).geometry;case"MultiPoint":return fn(e).geometry;case"MultiLineString":return un(e).geometry;case"MultiPolygon":return mn(e).geometry;default:throw new Error(t+" is invalid")}}J($r,"geometry");function _t(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Fe(t[0])||!Fe(t[1]))throw new Error("coordinates must contain numbers");return Le({type:"Point",coordinates:t},e,n)}J(_t,"point");function jr(t,e,n={}){return ot(t.map(r=>_t(r,e)),n)}J(jr,"points");function dt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return Le({type:"Polygon",coordinates:t},e,n)}J(dt,"polygon");function Cr(t,e,n={}){return ot(t.map(r=>dt(r,e)),n)}J(Cr,"polygons");function ht(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Le({type:"LineString",coordinates:t},e,n)}J(ht,"lineString");function Lr(t,e,n={}){return ot(t.map(r=>ht(r,e)),n)}J(Lr,"lineStrings");function ot(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(ot,"featureCollection");function un(t,e,n={}){return Le({type:"MultiLineString",coordinates:t},e,n)}J(un,"multiLineString");function fn(t,e,n={}){return Le({type:"MultiPoint",coordinates:t},e,n)}J(fn,"multiPoint");function mn(t,e,n={}){return Le({type:"MultiPolygon",coordinates:t},e,n)}J(mn,"multiPolygon");function Er(t,e,n={}){return Le({type:"GeometryCollection",geometries:t},e,n)}J(Er,"geometryCollection");function Pr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J(Pr,"round");function cn(t,e="kilometers"){const n=sn[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(cn,"radiansToLength");function bt(t,e="kilometers"){const n=sn[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(bt,"lengthToRadians");function Mr(t,e){return yt(bt(t,e))}J(Mr,"lengthToDegrees");function Ir(t){let e=t%360;return e<0&&(e+=360),e}J(Ir,"bearingToAzimuth");function yt(t){return t%(2*Math.PI)*180/Math.PI}J(yt,"radiansToDegrees");function Ge(t){return t%360*Math.PI/180}J(Ge,"degreesToRadians");function Tr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return cn(bt(t,e),n)}J(Tr,"convertLength");function Ar(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=It[e];if(!r)throw new Error("invalid original units");const o=It[n];if(!o)throw new Error("invalid final units");return t/r*o}J(Ar,"convertArea");function Fe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(Fe,"isNumber");function Or(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(Or,"isObject");function Sr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Fe(e))throw new Error("bbox must only contain numbers")})}J(Sr,"validateBBox");function Fr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(Fr,"validateId");var Br=Object.defineProperty,Ee=(t,e)=>Br(t,"name",{value:e,configurable:!0});function ft(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Ee(ft,"getCoord");function qr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Ee(qr,"getCoords");function gn(t){if(t.length>1&&Fe(t[0])&&Fe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return gn(t[0]);throw new Error("coordinates must only contain numbers")}Ee(gn,"containsNumber");function Nr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}Ee(Nr,"geojsonType");function Gr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}Ee(Gr,"featureOf");function zr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}Ee(zr,"collectionOf");function Dr(t){return t.type==="Feature"?t.geometry:t}Ee(Dr,"getGeom");function Hr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Ee(Hr,"getType");var Rr=Object.defineProperty,pn=(t,e)=>Rr(t,"name",{value:e,configurable:!0});function vt(t,e,n={}){if(n.final===!0)return _n(t,e);const r=ft(t),o=ft(e),l=Ge(r[0]),i=Ge(o[0]),a=Ge(r[1]),s=Ge(o[1]),m=Math.sin(i-l)*Math.cos(s),u=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return yt(Math.atan2(m,u))}pn(vt,"bearing");function _n(t,e){let n=vt(e,t);return n=(n+180)%360,n}pn(_n,"calculateFinalBearing");var Ur=vt;function Jr(t){let e,n,r,o,l,i,a,s,m,u,y,c;function g(k){t[6](k)}let d={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new ct({props:d}),ne.push(()=>ie(e,"value",g));function f(k){t[7](k)}let p={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(p.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new jt({props:p}),ne.push(()=>ie(o,"value",f));function I(k){t[8](k)}let B={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(B.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new jt({props:B}),ne.push(()=>ie(a,"value",I));function H(k){t[9](k)}let P={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(P.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),u=new Qt({props:P}),ne.push(()=>ie(u,"value",H)),{c(){T(e.$$.fragment),r=z(),T(o.$$.fragment),i=z(),T(a.$$.fragment),m=z(),T(u.$$.fragment)},l(k){A(e.$$.fragment,k),r=D(k),A(o.$$.fragment,k),i=D(k),A(a.$$.fragment,k),m=D(k),A(u.$$.fragment,k)},m(k,E){O(e,k,E),L(k,r,E),O(o,k,E),L(k,i,E),O(a,k,E),L(k,m,E),O(u,k,E),c=!0},p(k,[E]){const N={};!n&&E&15&&(n=!0,N.value=k[3].jat[k[0]][k[1]].movements[k[2]].name,oe(()=>n=!1)),e.$set(N);const K={};!l&&E&15&&(l=!0,K.value=k[3].jat[k[0]][k[1]].movements[k[2]].kind,oe(()=>l=!1)),o.$set(K);const G={};!s&&E&15&&(s=!0,G.value=k[3].jat[k[0]][k[1]].movements[k[2]].score,oe(()=>s=!1)),a.$set(G);const q={};!y&&E&15&&(y=!0,q.value=k[3].jat[k[0]][k[1]].movements[k[2]].notes,oe(()=>y=!1)),u.$set(q)},i(k){c||(w(e.$$.fragment,k),w(o.$$.fragment,k),w(a.$$.fragment,k),w(u.$$.fragment,k),c=!0)},o(k){C(e.$$.fragment,k),C(o.$$.fragment,k),C(a.$$.fragment,k),C(u.$$.fragment,k),c=!1},d(k){k&&(v(r),v(i),v(m)),S(e,k),S(o,k),S(a,k),S(u,k)}}}function Wr(t,e,n){let r;Pe(t,Q,g=>n(3,r=g));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=On(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function m(g){t.$$.not_equal(r.jat[o][l].movements[i].name,g)&&(r.jat[o][l].movements[i].name=g,Q.set(r))}function u(g){t.$$.not_equal(r.jat[o][l].movements[i].kind,g)&&(r.jat[o][l].movements[i].kind=g,Q.set(r))}function y(g){t.$$.not_equal(r.jat[o][l].movements[i].score,g)&&(r.jat[o][l].movements[i].score=g,Q.set(r))}function c(g){t.$$.not_equal(r.jat[o][l].movements[i].notes,g)&&(r.jat[o][l].movements[i].notes=g,Q.set(r))}return t.$$set=g=>{"junctionIdx"in g&&n(0,o=g.junctionIdx),"stage"in g&&n(1,l=g.stage),"idx"in g&&n(2,i=g.idx)},[o,l,i,r,a,s,m,u,y,c]}class Vr extends Ie{constructor(e){super(),Te(this,e,Wr,Jr,Me,{junctionIdx:0,stage:1,idx:2})}}const{window:Xr}=$n;function Tt(t,e,n){const r=t.slice();return r[45]=e[n],r[46]=e,r[47]=n,r}function At(t,e,n){const r=t.slice();return r[48]=e[n],r[49]=e,r[47]=n,r}function Ot(t,e,n){const r=t.slice();return r[45]=e[n],r[47]=n,r}function St(t,e,n){const r=t.slice();return r[48]=e[n],r[47]=n,r}function Kr(t){let e,n,r,o,l,i,a,s;e=new Cn({props:{$$slots:{default:[Qr]},$$scope:{ctx:t}}}),e.$on("click",t[28]),r=new Vt({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),r.$on("click",t[14]);const m=[eo,xr],u=[];function y(c,g){return c[2].kind=="movement"?0:1}return l=y(t),i=u[l]=m[l](t),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),i.c(),a=ke()},l(c){A(e.$$.fragment,c),n=D(c),A(r.$$.fragment,c),o=D(c),i.l(c),a=ke()},m(c,g){O(e,c,g),L(c,n,g),O(r,c,g),L(c,o,g),u[l].m(c,g),L(c,a,g),s=!0},p(c,g){const d={};g[1]&2097152&&(d.$$scope={dirty:g,ctx:c}),e.$set(d);const f={};g[1]&2097152&&(f.$$scope={dirty:g,ctx:c}),r.$set(f);let p=l;l=y(c),l===p?u[l].p(c,g):(ge(),C(u[p],1,1,()=>{u[p]=null}),pe(),i=u[l],i?i.p(c,g):(i=u[l]=m[l](c),i.c()),w(i,1),i.m(a.parentNode,a))},i(c){s||(w(e.$$.fragment,c),w(r.$$.fragment,c),w(i),s=!0)},o(c){C(e.$$.fragment,c),C(r.$$.fragment,c),C(i),s=!1},d(c){c&&(v(n),v(o),v(a)),S(e,c),S(r,c),u[l].d(c)}}}function Zr(t){let e,n,r,o,l,i,a="Arms",s,m,u,y,c,g="Movements",d,f,p,I,B,H=Ht(t[4].jat[t[0]][t[1]])+"",P,k,E;e=new jn({props:{label:"Tools",$$slots:{default:[no]},$$scope:{ctx:t}}});function N(_){t[21](_)}let K={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[6]!==void 0&&(K.value=t[6]),r=new En({props:K}),ne.push(()=>ie(r,"value",N));let G=be(t[4].jat[t[0]][t[1]].arms),q=[];for(let _=0;_<G.length;_+=1)q[_]=Bt(St(t,G,_));const M=_=>C(q[_],1,1,()=>{q[_]=null});let j=t[4].jat[t[0]][t[9]].arms.length>0&&qt(t),le=be(t[4].jat[t[0]][t[1]].movements),R=[];for(let _=0;_<le.length;_+=1)R[_]=Nt(Ot(t,le,_));const Be=_=>C(R[_],1,1,()=>{R[_]=null});return{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),l=z(),i=x("h3"),i.textContent=a,s=z(),m=x("ul");for(let _=0;_<q.length;_+=1)q[_].c();u=z(),j&&j.c(),y=z(),c=x("h3"),c.textContent=g,d=z(),f=x("ol");for(let _=0;_<R.length;_+=1)R[_].c();p=z(),I=x("p"),B=V("Total JAT score: "),P=V(H),k=V("%")},l(_){A(e.$$.fragment,_),n=D(_),A(r.$$.fragment,_),l=D(_),i=ee(_,"H3",{"data-svelte-h":!0}),wt(i)!=="svelte-ld74qb"&&(i.textContent=a),s=D(_),m=ee(_,"UL",{});var $=re(m);for(let F=0;F<q.length;F+=1)q[F].l($);$.forEach(v),u=D(_),j&&j.l(_),y=D(_),c=ee(_,"H3",{"data-svelte-h":!0}),wt(c)!=="svelte-1dc52s8"&&(c.textContent=g),d=D(_),f=ee(_,"OL",{});var Z=re(f);for(let F=0;F<R.length;F+=1)R[F].l(Z);Z.forEach(v),p=D(_),I=ee(_,"P",{});var Y=re(I);B=X(Y,"Total JAT score: "),P=X(Y,H),k=X(Y,"%"),Y.forEach(v)},m(_,$){O(e,_,$),L(_,n,$),O(r,_,$),L(_,l,$),L(_,i,$),L(_,s,$),L(_,m,$);for(let Z=0;Z<q.length;Z+=1)q[Z]&&q[Z].m(m,null);L(_,u,$),j&&j.m(_,$),L(_,y,$),L(_,c,$),L(_,d,$),L(_,f,$);for(let Z=0;Z<R.length;Z+=1)R[Z]&&R[Z].m(f,null);L(_,p,$),L(_,I,$),fe(I,B),fe(I,P),fe(I,k),E=!0},p(_,$){const Z={};$[0]&160|$[1]&2097152&&(Z.$$scope={dirty:$,ctx:_}),e.$set(Z);const Y={};if(!o&&$[0]&64&&(o=!0,Y.value=_[6],oe(()=>o=!1)),r.$set(Y),$[0]&2075){G=be(_[4].jat[_[0]][_[1]].arms);let F;for(F=0;F<G.length;F+=1){const de=St(_,G,F);q[F]?(q[F].p(de,$),w(q[F],1)):(q[F]=Bt(de),q[F].c(),w(q[F],1),q[F].m(m,null))}for(ge(),F=G.length;F<q.length;F+=1)M(F);pe()}if(_[4].jat[_[0]][_[9]].arms.length>0?j?(j.p(_,$),$[0]&17&&w(j,1)):(j=qt(_),j.c(),w(j,1),j.m(y.parentNode,y)):j&&(ge(),C(j,1,1,()=>{j=null}),pe()),$[0]&2075){le=be(_[4].jat[_[0]][_[1]].movements);let F;for(F=0;F<le.length;F+=1){const de=Ot(_,le,F);R[F]?(R[F].p(de,$),w(R[F],1)):(R[F]=Nt(de),R[F].c(),w(R[F],1),R[F].m(f,null))}for(ge(),F=le.length;F<R.length;F+=1)Be(F);pe()}(!E||$[0]&19)&&H!==(H=Ht(_[4].jat[_[0]][_[1]])+"")&&$e(P,H)},i(_){if(!E){w(e.$$.fragment,_),w(r.$$.fragment,_);for(let $=0;$<G.length;$+=1)w(q[$]);w(j);for(let $=0;$<le.length;$+=1)w(R[$]);E=!0}},o(_){C(e.$$.fragment,_),C(r.$$.fragment,_),q=q.filter(Boolean);for(let $=0;$<q.length;$+=1)C(q[$]);C(j),R=R.filter(Boolean);for(let $=0;$<R.length;$+=1)C(R[$]);E=!1},d(_){_&&(v(n),v(l),v(i),v(s),v(m),v(u),v(y),v(c),v(d),v(f),v(p),v(I)),S(e,_),S(r,_),De(q,_),j&&j.d(_),De(R,_)}}}function Qr(t){let e;return{c(){e=V("Save")},l(n){e=X(n,"Save")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Yr(t){let e;return{c(){e=V("Delete")},l(n){e=X(n,"Delete")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function xr(t){let e,n,r;function o(i){t[29](i)}let l={label:"Arm Name"};return t[4].jat[t[0]][t[1]].arms[t[2].idx].name!==void 0&&(l.value=t[4].jat[t[0]][t[1]].arms[t[2].idx].name),e=new ct({props:l}),ne.push(()=>ie(e,"value",o)),{c(){T(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){O(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&23&&(n=!0,s.value=i[4].jat[i[0]][i[1]].arms[i[2].idx].name,oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function eo(t){let e,n;return e=new Vr({props:{junctionIdx:t[0],stage:t[1],idx:t[2].idx}}),{c(){T(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){O(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&4&&(l.idx=r[2].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function to(t){let e;return{c(){e=V("Zoom to fit")},l(n){e=X(n,"Zoom to fit")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Ft(t){let e,n,r;function o(i){t[20](i)}let l={map:t[5]};return t[7]!==void 0&&(l.enabled=t[7]),e=new Tn({props:l}),ne.push(()=>ie(e,"enabled",o)),{c(){T(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,a){O(e,i,a),r=!0},p(i,a){const s={};a[0]&32&&(s.map=i[5]),!n&&a[0]&128&&(n=!0,s.enabled=i[7],oe(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function no(t){let e,n,r,o,l,i,a,s;e=new ye({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),e.$on("click",t[19]),r=new Pn({}),l=new Mn({});let m=t[5]&&Ft(t);return{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment),i=z(),m&&m.c(),a=ke()},l(u){A(e.$$.fragment,u),n=D(u),A(r.$$.fragment,u),o=D(u),A(l.$$.fragment,u),i=D(u),m&&m.l(u),a=ke()},m(u,y){O(e,u,y),L(u,n,y),O(r,u,y),L(u,o,y),O(l,u,y),L(u,i,y),m&&m.m(u,y),L(u,a,y),s=!0},p(u,y){const c={};y[1]&2097152&&(c.$$scope={dirty:y,ctx:u}),e.$set(c),u[5]?m?(m.p(u,y),y[0]&32&&w(m,1)):(m=Ft(u),m.c(),w(m,1),m.m(a.parentNode,a)):m&&(ge(),C(m,1,1,()=>{m=null}),pe())},i(u){s||(w(e.$$.fragment,u),w(r.$$.fragment,u),w(l.$$.fragment,u),w(m),s=!0)},o(u){C(e.$$.fragment,u),C(r.$$.fragment,u),C(l.$$.fragment,u),C(m),s=!1},d(u){u&&(v(n),v(o),v(i),v(a)),S(e,u),S(r,u),S(l,u),m&&m.d(u)}}}function ro(t){let e=dn(t[47])+"",n,r,o=(t[48].name||"Unnamed arm")+"",l;return{c(){n=V(e),r=V(" - "),l=V(o)},l(i){n=X(i,e),r=X(i," - "),l=X(i,o)},m(i,a){L(i,n,a),L(i,r,a),L(i,l,a)},p(i,a){a[0]&19&&o!==(o=(i[48].name||"Unnamed arm")+"")&&$e(l,o)},d(i){i&&(v(n),v(r),v(l))}}}function Bt(t){let e,n,r,o;function l(){return t[22](t[47])}function i(){return t[23](t[47])}return n=new ye({props:{$$slots:{default:[ro]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[24]),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(a){e=ee(a,"LI",{});var s=re(e);A(n.$$.fragment,s),r=D(s),s.forEach(v)},m(a,s){L(a,e,s),O(n,e,null),fe(e,r),o=!0},p(a,s){t=a;const m={};s[0]&19|s[1]&2097152&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){C(n.$$.fragment,a),o=!1},d(a){a&&v(e),S(n)}}}function qt(t){let e,n;return e=new ye({props:{$$slots:{default:[oo]},$$scope:{ctx:t}}}),e.$on("click",t[17]),{c(){T(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){O(e,r,o),n=!0},p(r,o){const l={};o[1]&2097152&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function oo(t){let e,n;return{c(){e=V("Copy arms from "),n=V(t[9])},l(r){e=X(r,"Copy arms from "),n=X(r,t[9])},m(r,o){L(r,e,o),L(r,n,o)},p:mt,d(r){r&&(v(e),v(n))}}}function io(t){let e=(t[45].name||"Unnamed movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){L(r,n,o)},p(r,o){o[0]&19&&e!==(e=(r[45].name||"Unnamed movement")+"")&&$e(n,e)},d(r){r&&v(n)}}}function Nt(t){let e,n,r,o;function l(){return t[25](t[47])}function i(){return t[26](t[47])}return n=new ye({props:{$$slots:{default:[io]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[27]),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(a){e=ee(a,"LI",{});var s=re(e);A(n.$$.fragment,s),r=D(s),s.forEach(v)},m(a,s){L(a,e,s),O(n,e,null),fe(e,r),o=!0},p(a,s){t=a;const m={};s[0]&19|s[1]&2097152&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){C(n.$$.fragment,a),o=!1},d(a){a&&v(e),S(n)}}}function lo(t){let e,n=dn(t[47])+"",r;return{c(){e=x("span"),r=V(n),this.h()},l(o){e=ee(o,"SPAN",{class:!0});var l=re(e);r=X(l,n),l.forEach(v),this.h()},h(){et(e,"class","dot svelte-o3xbby"),te(e,"color","#4472c4"),te(e,"background-color","white")},m(o,l){L(o,e,l),fe(e,r)},p:mt,d(o){o&&v(e)}}}function Gt(t){let e,n,r;function o(s){t[30](s,t[48])}function l(){return t[31](t[47])}function i(){return t[32](t[47])}let a={draggable:!0,$$slots:{default:[lo]},$$scope:{ctx:t}};return t[48].point!==void 0&&(a.lngLat=t[48].point),e=new lt({props:a}),ne.push(()=>ie(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){T(e.$$.fragment)},l(s){A(e.$$.fragment,s)},m(s,m){O(e,s,m),r=!0},p(s,m){t=s;const u={};m[1]&2097152&&(u.$$scope={dirty:m,ctx:t}),!n&&m[0]&19&&(n=!0,u.lngLat=t[48].point,oe(()=>n=!1)),e.$set(u)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){C(e.$$.fragment,s),r=!1},d(s){S(e,s)}}}function ao(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),re(e).forEach(v),this.h()},h(){et(e,"class","dot svelte-o3xbby"),te(e,"background-color",t[10][t[45].score]),te(e,"opacity",t[45].kind=="pedestrian"?"0%":"100%")},m(n,r){L(n,e,r)},p(n,r){r[0]&19&&te(e,"background-color",n[10][n[45].score]),r[0]&19&&te(e,"opacity",n[45].kind=="pedestrian"?"0%":"100%")},d(n){n&&v(e)}}}function so(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),re(e).forEach(v),this.h()},h(){et(e,"class","dot svelte-o3xbby"),te(e,"background-color",t[10][t[45].score]),te(e,"opacity","0%")},m(n,r){L(n,e,r)},p(n,r){r[0]&19&&te(e,"background-color",n[10][n[45].score])},d(n){n&&v(e)}}}function zt(t){let e,n,r,o,l,i;function a(f){t[33](f,t[45])}function s(){return t[34](t[47])}function m(){return t[35](t[47])}let u={draggable:!0,$$slots:{default:[ao]},$$scope:{ctx:t}};t[45].point1!==void 0&&(u.lngLat=t[45].point1),e=new lt({props:u}),ne.push(()=>ie(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",m);function y(f){t[36](f,t[45])}function c(){return t[37](t[47])}function g(){return t[38](t[47])}let d={draggable:!0,$$slots:{default:[so]},$$scope:{ctx:t}};return t[45].point2!==void 0&&(d.lngLat=t[45].point2),o=new lt({props:d}),ne.push(()=>ie(o,"lngLat",y)),o.$on("dragend",c),o.$on("click",g),{c(){T(e.$$.fragment),r=z(),T(o.$$.fragment)},l(f){A(e.$$.fragment,f),r=D(f),A(o.$$.fragment,f)},m(f,p){O(e,f,p),L(f,r,p),O(o,f,p),i=!0},p(f,p){t=f;const I={};p[0]&19|p[1]&2097152&&(I.$$scope={dirty:p,ctx:t}),!n&&p[0]&19&&(n=!0,I.lngLat=t[45].point1,oe(()=>n=!1)),e.$set(I);const B={};p[0]&19|p[1]&2097152&&(B.$$scope={dirty:p,ctx:t}),!l&&p[0]&19&&(l=!0,B.lngLat=t[45].point2,oe(()=>l=!1)),o.$set(B)},i(f){i||(w(e.$$.fragment,f),w(o.$$.fragment,f),i=!0)},o(f){C(e.$$.fragment,f),C(o.$$.fragment,f),i=!1},d(f){f&&v(r),S(e,f),S(o,f)}}}function uo(t){let e=(t[44].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){L(r,n,o)},p(r,o){o[1]&8192&&e!==(e=(r[44].name||"Untitled movement")+"")&&$e(n,e)},d(r){r&&v(n)}}}function fo(t){let e,n;return e=new Yt({props:{$$slots:{default:[uo,({props:r})=>({44:r}),({props:r})=>[0,r?8192:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){O(e,r,o),n=!0},p(r,o){const l={};o[1]&2105344&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function mo(t){let e=(t[44].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){L(r,n,o)},p(r,o){o[1]&8192&&e!==(e=(r[44].name||"Untitled movement")+"")&&$e(n,e)},d(r){r&&v(n)}}}function co(t){let e,n;return e=new Yt({props:{$$slots:{default:[mo,({props:r})=>({44:r}),({props:r})=>[0,r?8192:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,o){O(e,r,o),n=!0},p(r,o){const l={};o[1]&2105344&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){C(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function go(t){let e,n,r,o,l,i;return e=new at({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":$t(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[12]),r=new at({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":$t(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[co]},$$scope:{ctx:t}}}),r.$on("click",t[12]),l=new Un({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment)},l(a){A(e.$$.fragment,a),n=D(a),A(r.$$.fragment,a),o=D(a),A(l.$$.fragment,a)},m(a,s){O(e,a,s),L(a,n,s),O(r,a,s),L(a,o,s),O(l,a,s),i=!0},p(a,s){const m={};s[1]&2097152&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const u={};s[1]&2097152&&(u.$$scope={dirty:s,ctx:a}),r.$set(u)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){C(e.$$.fragment,a),C(r.$$.fragment,a),C(l.$$.fragment,a),i=!1},d(a){a&&(v(n),v(o)),S(e,a),S(r,a),S(l,a)}}}function po(t){let e,n,r,o;return e=new at({props:{paint:{"line-width":15,"line-color":"yellow"}}}),r=new An({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-color":"yellow","circle-radius":20}}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment)},l(l){A(e.$$.fragment,l),n=D(l),A(r.$$.fragment,l)},m(l,i){O(e,l,i),L(l,n,i),O(r,l,i),o=!0},p:mt,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),C(r.$$.fragment,l),o=!1},d(l){l&&v(n),S(e,l),S(r,l)}}}function _o(t){let e,n,r,o,l,i,a,s,m=be(t[4].jat[t[0]][t[1]].arms),u=[];for(let f=0;f<m.length;f+=1)u[f]=Gt(At(t,m,f));const y=f=>C(u[f],1,1,()=>{u[f]=null});let c=be(t[4].jat[t[0]][t[1]].movements),g=[];for(let f=0;f<c.length;f+=1)g[f]=zt(Tt(t,c,f));const d=f=>C(g[f],1,1,()=>{g[f]=null});return r=new kt({props:{data:t[13](t[4]),$$slots:{default:[go]},$$scope:{ctx:t}}}),l=new kt({props:{data:t[8],$$slots:{default:[po]},$$scope:{ctx:t}}}),a=new In({props:{map:t[5]}}),{c(){for(let f=0;f<u.length;f+=1)u[f].c();e=z();for(let f=0;f<g.length;f+=1)g[f].c();n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment),i=z(),T(a.$$.fragment)},l(f){for(let p=0;p<u.length;p+=1)u[p].l(f);e=D(f);for(let p=0;p<g.length;p+=1)g[p].l(f);n=D(f),A(r.$$.fragment,f),o=D(f),A(l.$$.fragment,f),i=D(f),A(a.$$.fragment,f)},m(f,p){for(let I=0;I<u.length;I+=1)u[I]&&u[I].m(f,p);L(f,e,p);for(let I=0;I<g.length;I+=1)g[I]&&g[I].m(f,p);L(f,n,p),O(r,f,p),L(f,o,p),O(l,f,p),L(f,i,p),O(a,f,p),s=!0},p(f,p){if(p[0]&2067){m=be(f[4].jat[f[0]][f[1]].arms);let P;for(P=0;P<m.length;P+=1){const k=At(f,m,P);u[P]?(u[P].p(k,p),w(u[P],1)):(u[P]=Gt(k),u[P].c(),w(u[P],1),u[P].m(e.parentNode,e))}for(ge(),P=m.length;P<u.length;P+=1)y(P);pe()}if(p[0]&3091){c=be(f[4].jat[f[0]][f[1]].movements);let P;for(P=0;P<c.length;P+=1){const k=Tt(f,c,P);g[P]?(g[P].p(k,p),w(g[P],1)):(g[P]=zt(k),g[P].c(),w(g[P],1),g[P].m(n.parentNode,n))}for(ge(),P=c.length;P<g.length;P+=1)d(P);pe()}const I={};p[0]&16&&(I.data=f[13](f[4])),p[1]&2097152&&(I.$$scope={dirty:p,ctx:f}),r.$set(I);const B={};p[0]&256&&(B.data=f[8]),p[1]&2097152&&(B.$$scope={dirty:p,ctx:f}),l.$set(B);const H={};p[0]&32&&(H.map=f[5]),a.$set(H)},i(f){if(!s){for(let p=0;p<m.length;p+=1)w(u[p]);for(let p=0;p<c.length;p+=1)w(g[p]);w(r.$$.fragment,f),w(l.$$.fragment,f),w(a.$$.fragment,f),s=!0}},o(f){u=u.filter(Boolean);for(let p=0;p<u.length;p+=1)C(u[p]);g=g.filter(Boolean);for(let p=0;p<g.length;p+=1)C(g[p]);C(r.$$.fragment,f),C(l.$$.fragment,f),C(a.$$.fragment,f),s=!1},d(f){f&&(v(e),v(n),v(o),v(i)),De(u,f),De(g,f),S(r,f),S(l,f),S(a,f)}}}function ho(t){let e,n,r,o,l,i,a,s,m,u,y,c,g,d;function f(E){t[18](E)}let p={label:"Commentary / Notes"};t[4].jat[t[0]][t[1]].notes!==void 0&&(p.value=t[4].jat[t[0]][t[1]].notes),e=new Qt({props:p}),ne.push(()=>ie(e,"value",f));const I=[Zr,Kr],B=[];function H(E,N){return E[2]==null?0:1}i=H(t),a=B[i]=I[i](t);function P(E){t[39](E)}let k={$$slots:{default:[_o]},$$scope:{ctx:t}};return t[5]!==void 0&&(k.map=t[5]),u=new kn({props:k}),ne.push(()=>ie(u,"map",P)),{c(){T(e.$$.fragment),r=z(),o=x("div"),l=x("div"),a.c(),s=z(),m=x("div"),T(u.$$.fragment),this.h()},l(E){A(e.$$.fragment,E),r=D(E),o=ee(E,"DIV",{style:!0});var N=re(o);l=ee(N,"DIV",{style:!0});var K=re(l);a.l(K),K.forEach(v),s=D(N),m=ee(N,"DIV",{style:!0});var G=re(m);A(u.$$.fragment,G),G.forEach(v),N.forEach(v),this.h()},h(){te(l,"width","30%"),te(l,"overflow-y","scroll"),te(l,"padding","10px"),te(l,"border","1px solid black"),te(m,"position","relative"),te(m,"width","100%"),te(o,"display","flex"),te(o,"height","80vh")},m(E,N){O(e,E,N),L(E,r,N),L(E,o,N),fe(o,l),B[i].m(l,null),fe(o,s),fe(o,m),O(u,m,null),c=!0,g||(d=yn(Xr,"keydown",t[16]),g=!0)},p(E,N){const K={};!n&&N[0]&19&&(n=!0,K.value=E[4].jat[E[0]][E[1]].notes,oe(()=>n=!1)),e.$set(K);let G=i;i=H(E),i===G?B[i].p(E,N):(ge(),C(B[G],1,1,()=>{B[G]=null}),pe(),a=B[i],a?a.p(E,N):(a=B[i]=I[i](E),a.c()),w(a,1),a.m(l,null));const q={};N[0]&307|N[1]&2097152&&(q.$$scope={dirty:N,ctx:E}),!y&&N[0]&32&&(y=!0,q.map=E[5],oe(()=>y=!1)),u.$set(q)},i(E){c||(w(e.$$.fragment,E),w(a),w(u.$$.fragment,E),c=!0)},o(E){C(e.$$.fragment,E),C(a),C(u.$$.fragment,E),c=!1},d(E){E&&(v(r),v(o)),S(e,E),B[i].d(),S(u),g=!1,d()}}}function Dt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function dn(t){return String.fromCharCode(t+65)}function Ht(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function bo(t,e,n){let r,o;Pe(t,Q,h=>n(4,o=h));let{junctionIdx:l}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s,m="arm",u=null,y=null,c=!1,g={0:We.red.background,1:We.amber.background,2:We.green.background,X:We.critical.background};function d(h,W,ae){let b={type:"FeatureCollection",features:[]},he=W??ae;return he!=null&&(he.kind=="arm"?b.features.push(Dt(h.jat[l][i].arms[he.idx],he.idx)):b.features.push(H(h.jat[l][i].movements[he.idx],he.idx))),b}function f(h){n(2,u=h),n(3,y=null)}function p(h){if(!c){for(let W of s.queryRenderedFeatures(h.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(u!=null){n(2,u=null);return}m=="arm"?(ze(Q,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:h.lngLat.toArray(),name:""}],o),n(2,u={kind:"arm",idx:o.jat[l][i].arms.length-1})):(ze(Q,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:h.lngLat.toArray(),point2:vr(h.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(2,u={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(3,y=null)}}function I(h){f({kind:"movement",idx:h.detail.features[0].id})}Jt(()=>{s.on("click",p),E(!1)}),Wt(()=>{s.off("click",p)});function B(h){let W={type:"FeatureCollection",features:h.jat[l][i].movements.map((ae,b)=>H(ae,b))};for(let ae of h.jat[l][i].movements)if(W.features.push(P(ae,W.features.length)),ae.kind=="pedestrian"){let b={...ae,point1:ae.point2,point2:ae.point1};W.features.push(P(b,W.features.length))}for(let ae of h.jat[l][i].arms)W.features.push(Dt(ae,W.features.length));return W}function H(h,W){return{type:"Feature",id:W,properties:{name:h.name,kind:h.kind,color:g[h.score]},geometry:{type:"LineString",coordinates:[h.point1,h.point2]}}}function P(h,W){return{type:"Feature",id:W,properties:{kind:h.kind,color:g[h.score],angle:Ur(h.point1,h.point2)},geometry:{type:"Point",coordinates:h.point2}}}function k(){window.confirm(`Delete this ${u.kind}?`)&&(u.kind=="movement"?(o.jat[l][i].movements.splice(u.idx,1),Q.set(o)):(o.jat[l][i].arms.splice(u.idx,1),Q.set(o)),n(2,u=null))}function E(h){let W=B(o);W.features.length>0&&s.fitBounds(Ln(W),{padding:20,animate:h})}function N(h){u!=null&&h.key=="Escape"?(h.stopPropagation(),n(2,u=null)):u!=null&&h.key=="Delete"&&k()}function K(){o.jat[l][i].arms.length>0&&!window.confirm("Overwrite arms?")||(ze(Q,o.jat[l][i].arms=JSON.parse(JSON.stringify(o.jat[l][a].arms)),o),Q.set(o))}function G(h){t.$$.not_equal(o.jat[l][i].notes,h)&&(o.jat[l][i].notes=h,Q.set(o))}const q=()=>E(!0);function M(h){c=h,n(7,c)}function j(h){m=h,n(6,m)}const le=h=>f({kind:"arm",idx:h}),R=h=>n(3,y={kind:"arm",idx:h}),Be=()=>n(3,y=null),_=h=>f({kind:"movement",idx:h}),$=h=>n(3,y={kind:"movement",idx:h}),Z=()=>n(3,y=null),Y=()=>n(2,u=null);function F(h){t.$$.not_equal(o.jat[l][i].arms[u.idx].name,h)&&(o.jat[l][i].arms[u.idx].name=h,Q.set(o))}function de(h,W){t.$$.not_equal(W.point,h)&&(W.point=h,Q.set(o))}const me=h=>f({kind:"arm",idx:h}),_e=h=>f({kind:"arm",idx:h});function ve(h,W){t.$$.not_equal(W.point1,h)&&(W.point1=h,Q.set(o))}const we=h=>f({kind:"movement",idx:h}),He=h=>f({kind:"movement",idx:h});function Re(h,W){t.$$.not_equal(W.point2,h)&&(W.point2=h,Q.set(o))}const Ue=h=>f({kind:"movement",idx:h}),Je=h=>f({kind:"movement",idx:h});function Ae(h){s=h,n(5,s)}return t.$$set=h=>{"junctionIdx"in h&&n(0,l=h.junctionIdx),"stage"in h&&n(1,i=h.stage)},t.$$.update=()=>{t.$$.dirty[0]&28&&n(8,r=d(o,u,y))},[l,i,u,y,o,s,m,c,r,a,g,f,I,B,k,E,N,K,G,q,M,j,le,R,Be,_,$,Z,Y,F,de,me,_e,ve,we,He,Re,Ue,Je,Ae]}class yo extends Ie{constructor(e){super(),Te(this,e,bo,ho,Me,{junctionIdx:0,stage:1},null,[-1,-1])}}function Rt(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function vo(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,u,y;return s=new ye({props:{$$slots:{default:[$o]},$$scope:{ctx:t}}}),s.$on("click",t[10]),u=new yo({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=x("h2"),r=V(n),o=V(" - "),i=V(l),a=z(),T(s.$$.fragment),m=z(),T(u.$$.fragment)},l(c){e=ee(c,"H2",{});var g=re(e);r=X(g,n),o=X(g," - "),i=X(g,l),g.forEach(v),a=D(c),A(s.$$.fragment,c),m=D(c),A(u.$$.fragment,c)},m(c,g){L(c,e,g),fe(e,r),fe(e,o),fe(e,i),L(c,a,g),O(s,c,g),L(c,m,g),O(u,c,g),y=!0},p(c,g){(!y||g&3)&&n!==(n=(c[1].jat[c[0].idx].name||"Untitled junction")+"")&&$e(r,n),(!y||g&1)&&l!==(l=c[0].stage+"")&&$e(i,l);const d={};g&16384&&(d.$$scope={dirty:g,ctx:c}),s.$set(d);const f={};g&1&&(f.junctionIdx=c[0].idx),g&1&&(f.stage=c[0].stage),u.$set(f)},i(c){y||(w(s.$$.fragment,c),w(u.$$.fragment,c),y=!0)},o(c){C(s.$$.fragment,c),C(u.$$.fragment,c),y=!1},d(c){c&&(v(e),v(a),v(m)),S(s,c),S(u,c)}}}function wo(t){let e,n,r,o,l,i,a,s,m,u,y;e=new ye({props:{$$slots:{default:[jo]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new Vt({props:{$$slots:{default:[Co]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function c(d){t[7](d)}let g={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(g.value=t[1].jat[t[0].idx].name),l=new ct({props:g}),ne.push(()=>ie(l,"value",c)),s=new ye({props:{$$slots:{default:[Lo]},$$scope:{ctx:t}}}),s.$on("click",t[8]),u=new ye({props:{$$slots:{default:[Eo]},$$scope:{ctx:t}}}),u.$on("click",t[9]),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment),a=z(),T(s.$$.fragment),m=z(),T(u.$$.fragment)},l(d){A(e.$$.fragment,d),n=D(d),A(r.$$.fragment,d),o=D(d),A(l.$$.fragment,d),a=D(d),A(s.$$.fragment,d),m=D(d),A(u.$$.fragment,d)},m(d,f){O(e,d,f),L(d,n,f),O(r,d,f),L(d,o,f),O(l,d,f),L(d,a,f),O(s,d,f),L(d,m,f),O(u,d,f),y=!0},p(d,f){const p={};f&16384&&(p.$$scope={dirty:f,ctx:d}),e.$set(p);const I={};f&16384&&(I.$$scope={dirty:f,ctx:d}),r.$set(I);const B={};!i&&f&3&&(i=!0,B.value=d[1].jat[d[0].idx].name,oe(()=>i=!1)),l.$set(B);const H={};f&16384&&(H.$$scope={dirty:f,ctx:d}),s.$set(H);const P={};f&16384&&(P.$$scope={dirty:f,ctx:d}),u.$set(P)},i(d){y||(w(e.$$.fragment,d),w(r.$$.fragment,d),w(l.$$.fragment,d),w(s.$$.fragment,d),w(u.$$.fragment,d),y=!0)},o(d){C(e.$$.fragment,d),C(r.$$.fragment,d),C(l.$$.fragment,d),C(s.$$.fragment,d),C(u.$$.fragment,d),y=!1},d(d){d&&(v(n),v(o),v(a),v(m)),S(e,d),S(r,d),S(l,d),S(s,d),S(u,d)}}}function ko(t){let e,n,r,o;e=new ye({props:{$$slots:{default:[Po]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=be(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Ut(Rt(t,l,s));const a=s=>C(i[s],1,1,()=>{i[s]=null});return{c(){T(e.$$.fragment),n=z(),r=x("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){A(e.$$.fragment,s),n=D(s),r=ee(s,"OL",{});var m=re(r);for(let u=0;u<i.length;u+=1)i[u].l(m);m.forEach(v)},m(s,m){O(e,s,m),L(s,n,m),L(s,r,m);for(let u=0;u<i.length;u+=1)i[u]&&i[u].m(r,null);o=!0},p(s,m){const u={};if(m&16384&&(u.$$scope={dirty:m,ctx:s}),e.$set(u),m&3){l=be(s[1].jat);let y;for(y=0;y<l.length;y+=1){const c=Rt(s,l,y);i[y]?(i[y].p(c,m),w(i[y],1)):(i[y]=Ut(c),i[y].c(),w(i[y],1),i[y].m(r,null))}for(ge(),y=l.length;y<i.length;y+=1)a(y);pe()}},i(s){if(!o){w(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(s){C(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)C(i[m]);o=!1},d(s){s&&(v(n),v(r)),S(e,s),De(i,s)}}}function $o(t){let e;return{c(){e=V("Back")},l(n){e=X(n,"Back")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function jo(t){let e;return{c(){e=V("Back to all junctions")},l(n){e=X(n,"Back to all junctions")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Co(t){let e;return{c(){e=V("Delete")},l(n){e=X(n,"Delete")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Lo(t){let e;return{c(){e=V("Existing")},l(n){e=X(n,"Existing")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Eo(t){let e;return{c(){e=V("Proposed")},l(n){e=X(n,"Proposed")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Po(t){let e;return{c(){e=V("Add new junction")},l(n){e=X(n,"Add new junction")},m(n,r){L(n,e,r)},d(n){n&&v(e)}}}function Mo(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){L(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&$e(n,e)},d(r){r&&v(n)}}}function Ut(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new ye({props:{$$slots:{default:[Mo]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(i){e=ee(i,"LI",{});var a=re(e);A(n.$$.fragment,a),r=D(a),a.forEach(v)},m(i,a){L(i,e,a),O(n,e,null),fe(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){C(n.$$.fragment,i),o=!1},d(i){i&&v(e),S(n)}}}function Io(t){let e,n,r,o;const l=[ko,wo,vo],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=ke()},l(s){n&&n.l(s),r=ke()},m(s,m){~e&&i[e].m(s,m),L(s,r,m),o=!0},p(s,[m]){let u=e;e=a(s),e===u?~e&&i[e].p(s,m):(n&&(ge(),C(i[u],1,1,()=>{i[u]=null}),pe()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){C(n),o=!1},d(s){s&&v(r),~e&&i[e].d(s)}}}function Ve(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function To(t,e,n){let r;Pe(t,Q,d=>n(1,r=d));let o={kind:"list"};function l(){ze(Q,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(d){window.confirm("Delete this junction?")&&(r.jat.splice(d,1),Q.set(r),n(0,o={kind:"list"}))}const a=d=>n(0,o={kind:"junction",idx:d}),s=()=>n(0,o={kind:"list"}),m=()=>i(Ve(o));function u(d){t.$$.not_equal(r.jat[o.idx].name,d)&&(r.jat[o.idx].name=d,Q.set(r))}return[o,r,l,i,a,s,m,u,()=>n(0,o={kind:"map",idx:Ve(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:Ve(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:Ve(o)})]}class Xo extends Ie{constructor(e){super(),Te(this,e,To,Io,Me,{})}}export{Xo as component};
