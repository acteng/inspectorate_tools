import{s as R,e as J,a as v,c as A,m as E,g as k,i as g,f as C,k as N,t as D,d as M}from"../chunks/scheduler.D1qsIhff.js";import{S as B,i as H,c as S,a as w,m as _,t as b,b as L,d as P}from"../chunks/index.DMPy99Kf.js";import{e as O}from"../chunks/da_log.yUlCngUS.js";import{s as V}from"../chunks/data.CSB6VPeJ.js";import{D as G}from"../chunks/DefaultButton.DKF8NDLi.js";/* empty css                                                               */import{T as I}from"../chunks/TextArea.ILRlrerf.js";import{E as U}from"../chunks/exceljs.min.BuyXGIGS.js";import{g as q,a as X}from"../chunks/lists.djxH55N_.js";import{d as z}from"../chunks/index.BXr4v5l0.js";const Q=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function Y(e){console.log("Loading blank route check xlsx");let t=await(await fetch(Q)).arrayBuffer(),l=new U.Workbook;await l.xlsx.load(t),l.eachSheet((u,r)=>{u.conditionalFormattings=[]}),Z(e,l),ee(e,l),te(e,l),le(e,l),$(e.safetyCheck,l,"3.1 Safety Check",["J","K","L","M"],y([[13,28]])),$(e.streetCheck,l,"4.1 Street Check",["J","K","L","M"],y([[13,19],[23,25],[29,34],[38,43],[47,50]])),$(e.streetPlacemakingCheck,l,"4.2 Street Placemaking Check",["I","J","K","L"],y([[13,15],[19,21],[25,34],[38,47]])),$(e.pathCheck,l,"5.1 Path Check",["J","K","L","M"],y([[15,19],[23,33],[37,40],[44,48],[52,56]])),$(e.pathPlacemakingCheck,l,"5.2 Path Placemaking Check",["I","J","K","L"],y([[12,14],[20,22],[26,29],[33,41]])),oe(e,l),l.getWorksheet("5.1 Path Check").getCell("D7").value=e.horseRiders,l.getWorksheet("7.1 Results Summary").getCell("G7").value=e.resultsReviewStatement,console.log("Writing route check xlsx");let n=await l.xlsx.writeBuffer();z(n,"out.xlsx")}function Z(e,o){let t=o.getWorksheet("1. Summary of Scheme");t.getCell("C6").value=e.summary.dateDesignReview,t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.assessedRouteLengthKm,t.getCell("C19").value=e.summary.totalRouteLengthKm,t.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(t.getCell("D22").value="Path Check")}function ee(e,o){let t=o.getWorksheet("2.1 Policy Check");for(let l=0;l<6;l++)t.getCell("D"+(8+l)).value=e.policyCheck[l].existing,t.getCell("E"+(8+l)).value=e.policyCheck[l].proposed,t.getCell("F"+(8+l)).value=e.policyCheck[l].commentary}function te(e,o){let t=o.getWorksheet("2.2 Policy Conflict Log");for(let[l,n]of e.policyConflictLog.entries())t.getCell("F"+(8+l)).value=q(n.conflict),t.getCell("H"+(8+l)).value=n.stage,t.getCell("I"+(8+l)).value=K(n.point),t.getCell("J"+(8+l)).value=n.locationName,t.getCell("K"+(8+l)).value=n.resolved,t.getCell("L"+(8+l)).value=n.notes}function le(e,o){let t=o.getWorksheet("3.2 Critical Issues Log");for(let[l,n]of e.criticalIssues.entries())t.getCell("F"+(8+l)).value=X(n.criticalIssue),t.getCell("H"+(8+l)).value=n.stage,t.getCell("I"+(8+l)).value=K(n.point),t.getCell("J"+(8+l)).value=n.locationName,t.getCell("K"+(8+l)).value=n.resolved,t.getCell("L"+(8+l)).value=n.notes}function $(e,o,t,l,n){let u=o.getWorksheet(t);if(n.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${t}`);for(let r=0;r<e.existingScores.length;r++){let s=n[r];u.getCell(l[0]+s).value=j(e.existingScores[r]),u.getCell(l[1]+s).value=e.existingScoreNotes[r],u.getCell(l[2]+s).value=j(e.proposedScores[r]),u.getCell(l[3]+s).value=e.proposedScoreNotes[r]}}function oe(e,o){let t=o.getWorksheet("6. JAT Check"),l=0;for(let n of e.jat)for(let u of[n.existing,n.proposed]){let r=h("H",l*5);t.getCell(h(r,1)+"9").value=n.name,t.getCell(h(r,1)+"10").value=u.notes;for(let[s,i]of u.movements.filter(f=>f.kind=="walking & wheeling").entries())t.getCell(r+(13+s)).value=i.name,t.getCell(h(r,2)+(13+s)).value=F(i.score),t.getCell(h(r,3)+(13+s)).value=i.notes;for(let[s,i]of u.movements.filter(f=>f.kind=="cycling").entries())t.getCell(r+(26+s)).value=i.name,t.getCell(h(r,2)+(26+s)).value=F(i.score),t.getCell(h(r,3)+(26+s)).value=i.notes;l++}}function h(e,o){return ne(ae(e)+o)}function ae(e){let o=0;for(let t=0;t<e.length;t++)o*=26,o+=e.charCodeAt(t)-65+1;return o-1}function ne(e){let o="";for(e+=1;e>0;){let t=(e-1)%26;o=String.fromCharCode(t+65)+o,e=Math.floor((e-1)/26)}return o}function y(e){let o=[];for(let[t,l]of e)for(let n=t;n<=l;n++)o.push(n);return o}function j(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function F(e){return{0:0,1:1,2:2,X:e}[e]}function K(e){return`${e[1]}, ${e[0]}`}function re(e){let o;return{c(){o=D("Convert to .xlsx (takes a few seconds)")},l(t){o=M(t,"Convert to .xlsx (takes a few seconds)")},m(t,l){g(t,o,l)},d(t){t&&C(o)}}}function ie(e){let o,t=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,l,n,u,r,s,i,f,c,d,p,T=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9</i>`,x;return n=new I({props:{label:"TSV output, just the one row of values",value:e[3]}}),r=new I({props:{label:"TSV output with header",value:`${e[2]}
${e[3]}
`}}),i=new I({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(e[1]),null,"  ")}}),c=new G({props:{$$slots:{default:[re]},$$scope:{ctx:e}}}),c.$on("click",e[4]),{c(){o=J("p"),o.textContent=t,l=v(),S(n.$$.fragment),u=v(),S(r.$$.fragment),s=v(),S(i.$$.fragment),f=v(),S(c.$$.fragment),d=v(),p=J("p"),p.innerHTML=T},l(a){o=A(a,"P",{"data-svelte-h":!0}),E(o)!=="svelte-5ssfe3"&&(o.textContent=t),l=k(a),w(n.$$.fragment,a),u=k(a),w(r.$$.fragment,a),s=k(a),w(i.$$.fragment,a),f=k(a),w(c.$$.fragment,a),d=k(a),p=A(a,"P",{"data-svelte-h":!0}),E(p)!=="svelte-6hhtkc"&&(p.innerHTML=T)},m(a,m){g(a,o,m),g(a,l,m),_(n,a,m),g(a,u,m),_(r,a,m),g(a,s,m),_(i,a,m),g(a,f,m),_(c,a,m),g(a,d,m),g(a,p,m),x=!0},p(a,[m]){const W={};m&64&&(W.$$scope={dirty:m,ctx:a}),c.$set(W)},i(a){x||(b(n.$$.fragment,a),b(r.$$.fragment,a),b(i.$$.fragment,a),b(c.$$.fragment,a),x=!0)},o(a){L(n.$$.fragment,a),L(r.$$.fragment,a),L(i.$$.fragment,a),L(c.$$.fragment,a),x=!1},d(a){a&&(C(o),C(l),C(u),C(s),C(f),C(d),C(p)),P(n,a),P(r,a),P(i,a),P(c,a)}}}function se(e,o,t){let l;N(e,V,i=>t(0,l=i));let n=O(l),u=n.map(i=>i[0]).join("	"),r=n.map(i=>`"${i[1]}"`).join("	");return[l,n,u,r,()=>Y(l)]}class $e extends B{constructor(o){super(),H(this,o,se,ie,R,{})}}export{$e as component};
