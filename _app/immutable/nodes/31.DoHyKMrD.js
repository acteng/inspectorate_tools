import{s as Pe,E as Ie,i as P,f as y,a9 as rr,a8 as nr,k as ae,U as Lt,a7 as Mt,N as Ot,e as W,c as U,b as H,l as At,u as Ft,m as jt,o as St,v as Z,r as I,R as at,S as ut,h as re,n as Ee,a as B,g as q,x as ne,w as te,z as Se,p as or,q as Tt,t as me,d as pe,j as Ke,B as ir}from"../chunks/scheduler.Bsni_e59.js";import{S as Ce,i as Le,t as b,g as ge,b as w,f as he,c as O,a as A,m as F,d as j,e as oe}from"../chunks/index.CCfAUppz.js";import{g as lr,a as sr,B as ar,G as ur,S as fr,c as cr,M as ft}from"../chunks/GeoreferenceLayer.3UF6qHh7.js";import{e as Be}from"../chunks/each.BmgwAlbi.js";import{d as mr,m as ue,i as pr,e as It,M as gr,G as ct,h as mt}from"../chunks/MapLibreMap.Cx_2xGtm.js";import{c as ie}from"../chunks/colors.CYEpEtTL.js";import{D as hr}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as dr,S as _r}from"../chunks/WarningButton.D9QeV9gM.js";import{L as Ue}from"../chunks/LineLayer.b3F2Rend.js";import{s as J}from"../chunks/data.CA4Vy_R3.js";import{p as pt}from"../chunks/index.CDHsHyLK.js";import{S as gt}from"../chunks/Select.bLRJACqI.js";import{T as yr}from"../chunks/TextInput.CHbK327s.js";const br=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),ht=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function dt(t){let e,r,n=(t[4]||t[3]instanceof ue.Marker)&&_t(t);return{c(){e=W("div"),n&&n.c()},l(o){e=U(o,"DIV",{});var i=H(e);n&&n.l(i),i.forEach(y)},m(o,i){P(o,e,i),n&&n.m(e,null),t[32](e),r=!0},p(o,i){o[4]||o[3]instanceof ue.Marker?n?(n.p(o,i),i[0]&24&&b(n,1)):(n=_t(o),n.c(),b(n,1),n.m(e,null)):n&&(ge(),w(n,1,1,()=>{n=null}),he())},i(o){r||(b(n),r=!0)},o(o){w(n),r=!1},d(o){o&&y(e),n&&n.d(),t[32](null)}}}function _t(t){let e;const r=t[30].default,n=At(r,t,t[29],ht);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i[0]&536870933)&&Ft(n,r,o,o[29],e?St(r,o[29],i,br):jt(o[29]),ht)},i(o){e||(b(n,o),e=!0)},o(o){w(n,o),e=!1},d(o){n&&n.d(o)}}}function wr(t){let e,r,n=t[9].default&&dt(t);return{c(){n&&n.c(),e=Ie()},l(o){n&&n.l(o),e=Ie()},m(o,i){n&&n.m(o,i),P(o,e,i),r=!0},p(o,i){o[9].default?n?(n.p(o,i),i[0]&512&&b(n,1)):(n=dt(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ge(),w(n,1,1,()=>{n=null}),he())},i(o){r||(b(n),r=!0)},o(o){w(n),r=!1},d(o){o&&y(e),n&&n.d(o)}}}function vr(t,e,r){let n,o,i,l,a,u,{$$slots:p={},$$scope:h}=e;const f=rr(p);let{closeButton:d=void 0}=e,{closeOnClickOutside:m=!0}=e,{closeOnClickInside:v=!1}=e,{closeOnMove:k=!1}=e,{openOn:s="click"}=e,{openIfTopMost:g=!0}=e,{focusAfterOpen:$=!0}=e,{anchor:M=void 0}=e,{offset:S=void 0}=e,{popupClass:de=void 0}=e,{maxWidth:_e=void 0}=e,{lngLat:N=void 0}=e,{html:le=void 0}=e,{open:T=!1}=e;const ye=nr(),{map:Me,popupTarget:Oe,layerEvent:_,layer:G,eventTopMost:be}=mr();ae(t,Me,c=>r(2,i=c)),ae(t,Oe,c=>r(3,a=c)),ae(t,_,c=>r(28,l=c)),ae(t,G,c=>r(35,u=c));const Ae=["click","dblclick","contextmenu"];let E,Fe=!1,K;function xt(){if(!E)return;let c=E.getElement();!c||c===K||(K=c,s==="hover"&&(K.style.pointerEvents="none"),K.addEventListener("mouseenter",()=>{r(24,Fe=!0)},{passive:!0}),K.addEventListener("mouseleave",()=>{r(24,Fe=!1)},{passive:!0}),K.addEventListener("click",()=>{v&&r(0,T=!1)},{passive:!0}))}Lt(()=>{if(i)return i.on("click",je),i.on("contextmenu",je),typeof a=="string"&&(i.on("click",a,ee),i.on("dblclick",a,ee),i.on("contextmenu",a,ee),i.on("mousemove",a,st),i.on("mouseleave",a,lt),i.on("touchstart",a,ot),i.on("touchend",a,it)),()=>{i!=null&&i.loaded()&&(E==null||E.remove(),i.off("click",je),i.off("contextmenu",je),a instanceof ue.Marker?a.getPopup()===E&&a.setPopup(void 0):typeof a=="string"&&(i.off("click",a,ee),i.off("dblclick",a,ee),i.off("contextmenu",a,ee),i.off("mousemove",a,st),i.off("mouseleave",a,lt),i.off("touchstart",a,ot),i.off("touchend",a,it)))}});function nt(c){return g?!("marker"in c)&&!pr(c)&&be(c)!==u:!1}let z=null,V="normal";function ee(c){c.type===s&&(nt(c)||("layerType"in c?c.layerType==="deckgl"?(r(10,N=c.coordinate),r(4,z=c.object?[c.object]:null)):(r(10,N=c.lngLat),r(4,z=c.features??[])):(r(10,N=c.lngLat),r(4,z=c.features??[])),setTimeout(()=>r(0,T=!0))))}let se=null;function ot(c){se=c.point}function it(c){if(!se||s!=="hover")return;let He=se.dist(c.point);se=null,He<3&&(r(10,N=c.lngLat),r(4,z=c.features??[]),E.isOpen()?r(25,V="justOpened"):(r(25,V="opening"),r(0,T=!0)))}function lt(c){s!=="hover"||se||V!=="normal"||(r(0,T=!1),r(4,z=null))}function st(c){if(!(s!=="hover"||se||V!=="normal")){if(nt(c)){r(0,T=!1),r(4,z=null);return}r(0,T=!0),r(4,z=c.features??[]),r(10,N=c.lngLat)}}function je(c){if(V==="justOpened"){r(25,V="normal");return}if(!m)return;let He=[K,a instanceof ue.Marker?a==null?void 0:a.getElement():null];T&&E.isOpen()&&!He.some(We=>We==null?void 0:We.contains(c.originalEvent.target))&&(c.type==="contextmenu"&&s==="contextmenu"||c.type!=="contextmenu")&&r(0,T=!1)}Mt(()=>{i&&(E!=null&&E.isOpen())&&E.remove()});let we;const er=()=>r(0,T=!1);function tr(c){Z[c?"unshift":"push"](()=>{we=c,r(1,we)})}return t.$$set=c=>{"closeButton"in c&&r(11,d=c.closeButton),"closeOnClickOutside"in c&&r(12,m=c.closeOnClickOutside),"closeOnClickInside"in c&&r(13,v=c.closeOnClickInside),"closeOnMove"in c&&r(14,k=c.closeOnMove),"openOn"in c&&r(15,s=c.openOn),"openIfTopMost"in c&&r(16,g=c.openIfTopMost),"focusAfterOpen"in c&&r(17,$=c.focusAfterOpen),"anchor"in c&&r(18,M=c.anchor),"offset"in c&&r(19,S=c.offset),"popupClass"in c&&r(20,de=c.popupClass),"maxWidth"in c&&r(21,_e=c.maxWidth),"lngLat"in c&&r(10,N=c.lngLat),"html"in c&&r(22,le=c.html),"open"in c&&r(0,T=c.open),"$$scope"in c&&r(29,h=c.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&r(27,n=d??(!m&&!v)),t.$$.dirty[0]&146685952&&(E||(r(23,E=new ue.Popup({closeButton:n,closeOnClick:!1,closeOnMove:k,focusAfterOpen:$,maxWidth:_e,className:de,anchor:M,offset:S})),K=E.getElement(),E.on("open",()=>{r(0,T=!0),xt(),ye("open",E)}),E.on("close",()=>{r(0,T=!1),ye("close",E)}),E.on("hover",()=>{ye("hover",E)}))),t.$$.dirty[0]&8421384&&E&&a instanceof ue.Marker&&(s==="click"?a.setPopup(E):a.getPopup()===E&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Ae.includes(s)&&(l==null?void 0:l.type)===s&&(ee(l),Ot(_,l=null,l)),t.$$.dirty[0]&268468224&&r(26,o=s==="hover"&&((l==null?void 0:l.type)==="mousemove"||(l==null?void 0:l.type)==="mouseenter")),t.$$.dirty[0]&352354304&&s==="hover"&&_&&(o&&l&&(l.layerType==="deckgl"?(r(10,N=l.coordinate),r(4,z=l.object?[l.object]:null)):(r(10,N=l.lngLat),r(4,z=l.features??[]))),r(0,T=(o||Fe)??!1)),t.$$.dirty[0]&12582914&&(we?E.setDOMContent(we):le&&E.setHTML(le)),t.$$.dirty[0]&8389632&&N&&E.setLngLat(N),t.$$.dirty[0]&41943045&&i){let c=E.isOpen();T&&!c?(E.addTo(i),V==="opening"&&r(25,V="justOpened")):!T&&c&&E.remove()}},[T,we,i,a,z,Me,Oe,_,G,f,N,d,m,v,k,s,g,$,M,S,de,_e,le,E,Fe,V,o,n,l,h,p,er,tr]}class kr extends Ce{constructor(e){super(),Le(this,e,vr,wr,Pe,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const $r=t=>({props:t&8}),yt=t=>({props:Cr(t[3])});function Er(t){let e,r;const n=t[1].default,o=At(n,t,t[2],yt);return{c(){e=W("div"),o&&o.c(),this.h()},l(i){e=U(i,"DIV",{class:!0});var l=H(e);o&&o.l(l),l.forEach(y),this.h()},h(){I(e,"class","govuk-prose")},m(i,l){P(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&12)&&Ft(o,n,i,i[2],r?St(n,i[2],l,$r):jt(i[2]),yt)},i(i){r||(b(o,i),r=!0)},o(i){w(o,i),r=!1},d(i){i&&y(e),o&&o.d(i)}}}function Pr(t){let e,r;return e=new kr({props:{openOn:t[0],$$slots:{default:[Er,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:t}}}),{c(){O(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){F(e,n,o),r=!0},p(n,[o]){const i={};o&1&&(i.openOn=n[0]),o&12&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Cr(t){return t?t[0].properties??{}:{}}function Lr(t,e,r){let{$$slots:n={},$$scope:o}=e,{openOn:i="hover"}=e;return t.$$set=l=>{"openOn"in l&&r(0,i=l.openOn),"$$scope"in l&&r(2,o=l.$$scope)},[i,n,o]}class Bt extends Ce{constructor(e){super(),Le(this,e,Lr,Pr,Pe,{openOn:0})}}var Mr=Object.defineProperty,C=(t,e)=>Mr(t,"name",{value:e,configurable:!0}),Or=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!ve(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=ze(e),o=ze(r);return n.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!ve(e,r))return!1;const i=e;let l=r;if(o&&!this.compareCoord(i[0],l[0])){const u=this.fixStartIndex(l,i);if(u)l=u;else return!1}const a=this.compareCoord(i[n],l[n]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[n],l[l.length-(1+n)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,r){let n,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],r[0])){o=i;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,r){return ve(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?It(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return ve(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};C(Or,"GeojsonEquality");function ve(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}C(ve,"sameLength");function ze(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}C(ze,"explode");var D=63710088e-1,qt={centimeters:D*100,centimetres:D*100,degrees:360/(2*Math.PI),feet:D*3.28084,inches:D*39.37,kilometers:D/1e3,kilometres:D/1e3,meters:D,metres:D,miles:D/1609.344,millimeters:D*1e3,millimetres:D*1e3,nauticalmiles:D/1852,radians:1,yards:D*1.0936},bt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Q(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}C(Q,"feature");function Ar(t,e,r={}){switch(t){case"Point":return Ge(e).geometry;case"LineString":return Qe(e).geometry;case"Polygon":return Ze(e).geometry;case"MultiPoint":return Nt(e).geometry;case"MultiLineString":return Gt(e).geometry;case"MultiPolygon":return Dt(e).geometry;default:throw new Error(t+" is invalid")}}C(Ar,"geometry");function Ge(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!fe(t[0])||!fe(t[1]))throw new Error("coordinates must contain numbers");return Q({type:"Point",coordinates:t},e,r)}C(Ge,"point");function Fr(t,e,r={}){return Ne(t.map(n=>Ge(n,e)),r)}C(Fr,"points");function Ze(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return Q({type:"Polygon",coordinates:t},e,r)}C(Ze,"polygon");function jr(t,e,r={}){return Ne(t.map(n=>Ze(n,e)),r)}C(jr,"polygons");function Qe(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Q({type:"LineString",coordinates:t},e,r)}C(Qe,"lineString");function Sr(t,e,r={}){return Ne(t.map(n=>Qe(n,e)),r)}C(Sr,"lineStrings");function Ne(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}C(Ne,"featureCollection");function Gt(t,e,r={}){return Q({type:"MultiLineString",coordinates:t},e,r)}C(Gt,"multiLineString");function Nt(t,e,r={}){return Q({type:"MultiPoint",coordinates:t},e,r)}C(Nt,"multiPoint");function Dt(t,e,r={}){return Q({type:"MultiPolygon",coordinates:t},e,r)}C(Dt,"multiPolygon");function Tr(t,e,r={}){return Q({type:"GeometryCollection",geometries:t},e,r)}C(Tr,"geometryCollection");function Ir(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}C(Ir,"round");function Rt(t,e="kilometers"){const r=qt[e];if(!r)throw new Error(e+" units is invalid");return t*r}C(Rt,"radiansToLength");function De(t,e="kilometers"){const r=qt[e];if(!r)throw new Error(e+" units is invalid");return t/r}C(De,"lengthToRadians");function Br(t,e){return qe(De(t,e))}C(Br,"lengthToDegrees");function qr(t){let e=t%360;return e<0&&(e+=360),e}C(qr,"bearingToAzimuth");function qe(t){return t%(2*Math.PI)*180/Math.PI}C(qe,"radiansToDegrees");function Te(t){return t%360*Math.PI/180}C(Te,"degreesToRadians");function Gr(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Rt(De(t,e),r)}C(Gr,"convertLength");function Nr(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=bt[e];if(!n)throw new Error("invalid original units");const o=bt[r];if(!o)throw new Error("invalid final units");return t/n*o}C(Nr,"convertArea");function fe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}C(fe,"isNumber");function Dr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}C(Dr,"isObject");function Rr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!fe(e))throw new Error("bbox must only contain numbers")})}C(Rr,"validateBBox");function Hr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}C(Hr,"validateId");var Wr=Object.defineProperty,X=(t,e)=>Wr(t,"name",{value:e,configurable:!0});function Ht(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}X(Ht,"getCoord");function Ur(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}X(Ur,"getCoords");function Wt(t){if(t.length>1&&fe(t[0])&&fe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Wt(t[0]);throw new Error("coordinates must only contain numbers")}X(Wt,"containsNumber");function zr(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}X(zr,"geojsonType");function Vr(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}X(Vr,"featureOf");function Jr(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}X(Jr,"collectionOf");function Kr(t){return t.type==="Feature"?t.geometry:t}X(Kr,"getGeom");function Zr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}X(Zr,"getType");var Qr=Object.defineProperty,Xr=(t,e)=>Qr(t,"name",{value:e,configurable:!0});function Ut(t,e,r,n={}){const o=Ht(t),i=Te(o[0]),l=Te(o[1]),a=Te(r),u=De(e,n.units),p=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(a)),h=i+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(p)),f=qe(h),d=qe(p);return Ge([f,d],n.properties)}Xr(Ut,"destination");var Yr=Ut,xr=Object.defineProperty,L=(t,e)=>xr(t,"name",{value:e,configurable:!0}),en=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!ke(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Ve(e),o=Ve(r);return n.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!ke(e,r))return!1;const i=e;let l=r;if(o&&!this.compareCoord(i[0],l[0])){const u=this.fixStartIndex(l,i);if(u)l=u;else return!1}const a=this.compareCoord(i[n],l[n]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[n],l[l.length-(1+n)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,r){let n,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],r[0])){o=i;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,r){return ke(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?It(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return ke(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};L(en,"GeojsonEquality");function ke(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}L(ke,"sameLength");function Ve(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}L(Ve,"explode");var R=63710088e-1,zt={centimeters:R*100,centimetres:R*100,degrees:360/(2*Math.PI),feet:R*3.28084,inches:R*39.37,kilometers:R/1e3,kilometres:R/1e3,meters:R,metres:R,miles:R/1609.344,millimeters:R*1e3,millimetres:R*1e3,nauticalmiles:R/1852,radians:1,yards:R*1.0936},wt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Y(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}L(Y,"feature");function tn(t,e,r={}){switch(t){case"Point":return Xe(e).geometry;case"LineString":return xe(e).geometry;case"Polygon":return Ye(e).geometry;case"MultiPoint":return Jt(e).geometry;case"MultiLineString":return Vt(e).geometry;case"MultiPolygon":return Kt(e).geometry;default:throw new Error(t+" is invalid")}}L(tn,"geometry");function Xe(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ce(t[0])||!ce(t[1]))throw new Error("coordinates must contain numbers");return Y({type:"Point",coordinates:t},e,r)}L(Xe,"point");function rn(t,e,r={}){return Re(t.map(n=>Xe(n,e)),r)}L(rn,"points");function Ye(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return Y({type:"Polygon",coordinates:t},e,r)}L(Ye,"polygon");function nn(t,e,r={}){return Re(t.map(n=>Ye(n,e)),r)}L(nn,"polygons");function xe(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Y({type:"LineString",coordinates:t},e,r)}L(xe,"lineString");function on(t,e,r={}){return Re(t.map(n=>xe(n,e)),r)}L(on,"lineStrings");function Re(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}L(Re,"featureCollection");function Vt(t,e,r={}){return Y({type:"MultiLineString",coordinates:t},e,r)}L(Vt,"multiLineString");function Jt(t,e,r={}){return Y({type:"MultiPoint",coordinates:t},e,r)}L(Jt,"multiPoint");function Kt(t,e,r={}){return Y({type:"MultiPolygon",coordinates:t},e,r)}L(Kt,"multiPolygon");function ln(t,e,r={}){return Y({type:"GeometryCollection",geometries:t},e,r)}L(ln,"geometryCollection");function sn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}L(sn,"round");function Zt(t,e="kilometers"){const r=zt[e];if(!r)throw new Error(e+" units is invalid");return t*r}L(Zt,"radiansToLength");function et(t,e="kilometers"){const r=zt[e];if(!r)throw new Error(e+" units is invalid");return t/r}L(et,"lengthToRadians");function an(t,e){return tt(et(t,e))}L(an,"lengthToDegrees");function un(t){let e=t%360;return e<0&&(e+=360),e}L(un,"bearingToAzimuth");function tt(t){return t%(2*Math.PI)*180/Math.PI}L(tt,"radiansToDegrees");function $e(t){return t%360*Math.PI/180}L($e,"degreesToRadians");function fn(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Zt(et(t,e),r)}L(fn,"convertLength");function cn(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=wt[e];if(!n)throw new Error("invalid original units");const o=wt[r];if(!o)throw new Error("invalid final units");return t/n*o}L(cn,"convertArea");function ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}L(ce,"isNumber");function mn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}L(mn,"isObject");function pn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ce(e))throw new Error("bbox must only contain numbers")})}L(pn,"validateBBox");function gn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}L(gn,"validateId");var hn=Object.defineProperty,x=(t,e)=>hn(t,"name",{value:e,configurable:!0});function Je(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}x(Je,"getCoord");function dn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}x(dn,"getCoords");function Qt(t){if(t.length>1&&ce(t[0])&&ce(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Qt(t[0]);throw new Error("coordinates must only contain numbers")}x(Qt,"containsNumber");function _n(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}x(_n,"geojsonType");function yn(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}x(yn,"featureOf");function bn(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}x(bn,"collectionOf");function wn(t){return t.type==="Feature"?t.geometry:t}x(wn,"getGeom");function vn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}x(vn,"getType");var kn=Object.defineProperty,Xt=(t,e)=>kn(t,"name",{value:e,configurable:!0});function rt(t,e,r={}){if(r.final===!0)return Yt(t,e);const n=Je(t),o=Je(e),i=$e(n[0]),l=$e(o[0]),a=$e(n[1]),u=$e(o[1]),p=Math.sin(l-i)*Math.cos(u),h=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(l-i);return tt(Math.atan2(p,h))}Xt(rt,"bearing");function Yt(t,e){let r=rt(e,t);return r=(r+180)%360,r}Xt(Yt,"calculateFinalBearing");var vt=rt;function $n(t){let e,r,n;return{c(){e=at("svg"),r=at("polygon"),this.h()},l(o){e=ut(o,"svg",{width:!0,height:!0,xmlns:!0});var i=H(e);r=ut(i,"polygon",{points:!0,fill:!0,transform:!0,class:!0}),H(r).forEach(y),i.forEach(y),this.h()},h(){I(r,"points","15,0 0,30 30,30"),I(r,"fill",t[0]),I(r,"transform",n="rotate("+t[1]+", 15, 15)"),I(r,"class","svelte-vih5bq"),I(e,"width","30"),I(e,"height","30"),I(e,"xmlns","http://www.w3.org/2000/svg")},m(o,i){P(o,e,i),re(e,r)},p(o,[i]){i&1&&I(r,"fill",o[0]),i&2&&n!==(n="rotate("+o[1]+", 15, 15)")&&I(r,"transform",n)},i:Ee,o:Ee,d(o){o&&y(e)}}}function En(t,e,r){let{color:n}=e,{angle:o}=e;return t.$$set=i=>{"color"in i&&r(0,n=i.color),"angle"in i&&r(1,o=i.angle)},[n,o]}class Pn extends Ce{constructor(e){super(),Le(this,e,En,$n,Pe,{color:0,angle:1})}}function Cn(t){let e,r,n,o,i,l,a,u,p;function h(s){t[4](s)}let f={label:"Name"};t[1].jat.movements[t[0]].name!==void 0&&(f.value=t[1].jat.movements[t[0]].name),e=new yr({props:f}),Z.push(()=>oe(e,"value",h));function d(s){t[5](s)}let m={label:"Kind",choices:t[2]};t[1].jat.movements[t[0]].kind!==void 0&&(m.value=t[1].jat.movements[t[0]].kind),o=new gt({props:m}),Z.push(()=>oe(o,"value",d));function v(s){t[6](s)}let k={label:"Color",choices:t[3]};return t[1].jat.movements[t[0]].color!==void 0&&(k.value=t[1].jat.movements[t[0]].color),a=new gt({props:k}),Z.push(()=>oe(a,"value",v)),{c(){O(e.$$.fragment),n=B(),O(o.$$.fragment),l=B(),O(a.$$.fragment)},l(s){A(e.$$.fragment,s),n=q(s),A(o.$$.fragment,s),l=q(s),A(a.$$.fragment,s)},m(s,g){F(e,s,g),P(s,n,g),F(o,s,g),P(s,l,g),F(a,s,g),p=!0},p(s,[g]){const $={};!r&&g&3&&(r=!0,$.value=s[1].jat.movements[s[0]].name,ne(()=>r=!1)),e.$set($);const M={};!i&&g&3&&(i=!0,M.value=s[1].jat.movements[s[0]].kind,ne(()=>i=!1)),o.$set(M);const S={};!u&&g&3&&(u=!0,S.value=s[1].jat.movements[s[0]].color,ne(()=>u=!1)),a.$set(S)},i(s){p||(b(e.$$.fragment,s),b(o.$$.fragment,s),b(a.$$.fragment,s),p=!0)},o(s){w(e.$$.fragment,s),w(o.$$.fragment,s),w(a.$$.fragment,s),p=!1},d(s){s&&(y(n),y(l)),j(e,s),j(o,s),j(a,s)}}}function Ln(t,e,r){let n;ae(t,J,h=>r(1,n=h));let{idx:o}=e,i=pt(["cycling-straight","cycling-turn","pedestrian"]),l=pt(["green","amber","red","critical"]);function a(h){t.$$.not_equal(n.jat.movements[o].name,h)&&(n.jat.movements[o].name=h,J.set(n))}function u(h){t.$$.not_equal(n.jat.movements[o].kind,h)&&(n.jat.movements[o].kind=h,J.set(n))}function p(h){t.$$.not_equal(n.jat.movements[o].color,h)&&(n.jat.movements[o].color=h,J.set(n))}return t.$$set=h=>{"idx"in h&&r(0,o=h.idx)},[o,n,i,l,a,u,p]}class Mn extends Ce{constructor(e){super(),Le(this,e,Ln,Cn,Pe,{idx:0})}}const{window:On}=lr;function kt(t,e,r){const n=t.slice();return n[27]=e[r],n[28]=e,n[29]=r,n}function $t(t,e,r){const n=t.slice();return n[27]=e[r],n[29]=r,n}function An(t){let e,r,n,o,i,l;return e=new hr({props:{$$slots:{default:[jn]},$$scope:{ctx:t}}}),e.$on("click",t[17]),n=new dr({props:{$$slots:{default:[Sn]},$$scope:{ctx:t}}}),n.$on("click",t[9]),i=new Mn({props:{idx:t[0]}}),{c(){O(e.$$.fragment),r=B(),O(n.$$.fragment),o=B(),O(i.$$.fragment)},l(a){A(e.$$.fragment,a),r=q(a),A(n.$$.fragment,a),o=q(a),A(i.$$.fragment,a)},m(a,u){F(e,a,u),P(a,r,u),F(n,a,u),P(a,o,u),F(i,a,u),l=!0},p(a,u){const p={};u[1]&1&&(p.$$scope={dirty:u,ctx:a}),e.$set(p);const h={};u[1]&1&&(h.$$scope={dirty:u,ctx:a}),n.$set(h);const f={};u[0]&1&&(f.idx=a[0]),i.$set(f)},i(a){l||(b(e.$$.fragment,a),b(n.$$.fragment,a),b(i.$$.fragment,a),l=!0)},o(a){w(e.$$.fragment,a),w(n.$$.fragment,a),w(i.$$.fragment,a),l=!1},d(a){a&&(y(r),y(o)),j(e,a),j(n,a),j(i,a)}}}function Fn(t){let e,r,n,o,i,l,a,u,p="Movements",h,f,d;e=new _r({props:{$$slots:{default:[Tn]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new ar({}),i=new ur({});let m=t[3]&&Et(t),v=Be(t[2].jat.movements),k=[];for(let s=0;s<v.length;s+=1)k[s]=Pt($t(t,v,s));return{c(){O(e.$$.fragment),r=B(),O(n.$$.fragment),o=B(),O(i.$$.fragment),l=B(),m&&m.c(),a=B(),u=W("h3"),u.textContent=p,h=B(),f=W("ol");for(let s=0;s<k.length;s+=1)k[s].c()},l(s){A(e.$$.fragment,s),r=q(s),A(n.$$.fragment,s),o=q(s),A(i.$$.fragment,s),l=q(s),m&&m.l(s),a=q(s),u=U(s,"H3",{"data-svelte-h":!0}),or(u)!=="svelte-1dc52s8"&&(u.textContent=p),h=q(s),f=U(s,"OL",{});var g=H(f);for(let $=0;$<k.length;$+=1)k[$].l(g);g.forEach(y)},m(s,g){F(e,s,g),P(s,r,g),F(n,s,g),P(s,o,g),F(i,s,g),P(s,l,g),m&&m.m(s,g),P(s,a,g),P(s,u,g),P(s,h,g),P(s,f,g);for(let $=0;$<k.length;$+=1)k[$]&&k[$].m(f,null);d=!0},p(s,g){const $={};if(g[1]&1&&($.$$scope={dirty:g,ctx:s}),e.$set($),s[3]?m?(m.p(s,g),g[0]&8&&b(m,1)):(m=Et(s),m.c(),b(m,1),m.m(a.parentNode,a)):m&&(ge(),w(m,1,1,()=>{m=null}),he()),g[0]&70){v=Be(s[2].jat.movements);let M;for(M=0;M<v.length;M+=1){const S=$t(s,v,M);k[M]?k[M].p(S,g):(k[M]=Pt(S),k[M].c(),k[M].m(f,null))}for(;M<k.length;M+=1)k[M].d(1);k.length=v.length}},i(s){d||(b(e.$$.fragment,s),b(n.$$.fragment,s),b(i.$$.fragment,s),b(m),d=!0)},o(s){w(e.$$.fragment,s),w(n.$$.fragment,s),w(i.$$.fragment,s),w(m),d=!1},d(s){s&&(y(r),y(o),y(l),y(a),y(u),y(h),y(f)),j(e,s),j(n,s),j(i,s),m&&m.d(s),Tt(k,s)}}}function jn(t){let e;return{c(){e=me("Save")},l(r){e=pe(r,"Save")},m(r,n){P(r,e,n)},d(r){r&&y(e)}}}function Sn(t){let e;return{c(){e=me("Delete")},l(r){e=pe(r,"Delete")},m(r,n){P(r,e,n)},d(r){r&&y(e)}}}function Tn(t){let e;return{c(){e=me("Zoom to fit")},l(r){e=pe(r,"Zoom to fit")},m(r,n){P(r,e,n)},d(r){r&&y(e)}}}function Et(t){let e,r,n;function o(l){t[13](l)}let i={map:t[3]};return t[4]!==void 0&&(i.enabled=t[4]),e=new fr({props:i}),Z.push(()=>oe(e,"enabled",o)),{c(){O(e.$$.fragment)},l(l){A(e.$$.fragment,l)},m(l,a){F(e,l,a),n=!0},p(l,a){const u={};a[0]&8&&(u.map=l[3]),!r&&a[0]&16&&(r=!0,u.enabled=l[4],ne(()=>r=!1)),e.$set(u)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){w(e.$$.fragment,l),n=!1},d(l){j(e,l)}}}function Pt(t){let e,r,n=(t[27].name||"Unnamed movement")+"",o,i,l,a;function u(){return t[14](t[29])}function p(){return t[15](t[29])}return{c(){e=W("li"),r=W("a"),o=me(n),i=B(),this.h()},l(h){e=U(h,"LI",{});var f=H(e);r=U(f,"A",{href:!0});var d=H(r);o=pe(d,n),d.forEach(y),i=q(f),f.forEach(y),this.h()},h(){I(r,"href","#")},m(h,f){P(h,e,f),re(e,r),re(r,o),re(e,i),l||(a=[Se(r,"click",u),Se(r,"mouseenter",p),Se(r,"mouseleave",t[16])],l=!0)},p(h,f){t=h,f[0]&4&&n!==(n=(t[27].name||"Unnamed movement")+"")&&Ke(o,n)},d(h){h&&y(e),l=!1,ir(a)}}}function In(t){let e,r;return{c(){e=W("span"),this.h()},l(n){e=U(n,"SPAN",{class:!0,style:!0}),H(e).forEach(y),this.h()},h(){I(e,"class","dot svelte-1kvjd2"),I(e,"style",r=`background-color: ${ie[t[27].color].background}`)},m(n,o){P(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${ie[n[27].color].background}`)&&I(e,"style",r)},d(n){n&&y(e)}}}function Bn(t){let e,r;return e=new Pn({props:{color:ie[t[27].color].background,angle:vt(t[27].point1,t[27].point2)}}),{c(){O(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){F(e,n,o),r=!0},p(n,o){const i={};o[0]&4&&(i.color=ie[n[27].color].background),o[0]&4&&(i.angle=vt(n[27].point1,n[27].point2)),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function qn(t){let e,r;return{c(){e=W("span"),this.h()},l(n){e=U(n,"SPAN",{class:!0,style:!0}),H(e).forEach(y),this.h()},h(){I(e,"class","dot svelte-1kvjd2"),I(e,"style",r=`background-color: ${ie[t[27].color].background}`)},m(n,o){P(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${ie[n[27].color].background}`)&&I(e,"style",r)},i:Ee,o:Ee,d(n){n&&y(e)}}}function Gn(t){let e,r,n,o;const i=[qn,Bn],l=[];function a(u,p){return u[27].kind=="pedestrian"?0:1}return e=a(t),r=l[e]=i[e](t),{c(){r.c(),n=Ie()},l(u){r.l(u),n=Ie()},m(u,p){l[e].m(u,p),P(u,n,p),o=!0},p(u,p){let h=e;e=a(u),e===h?l[e].p(u,p):(ge(),w(l[h],1,1,()=>{l[h]=null}),he(),r=l[e],r?r.p(u,p):(r=l[e]=i[e](u),r.c()),b(r,1),r.m(n.parentNode,n))},i(u){o||(b(r),o=!0)},o(u){w(r),o=!1},d(u){u&&y(n),l[e].d(u)}}}function Ct(t){let e,r,n,o,i,l;function a(m){t[18](m,t[27])}function u(){return t[19](t[29])}let p={draggable:!0,$$slots:{default:[In]},$$scope:{ctx:t}};t[27].point1!==void 0&&(p.lngLat=t[27].point1),e=new ft({props:p}),Z.push(()=>oe(e,"lngLat",a)),e.$on("dragend",u);function h(m){t[20](m,t[27])}function f(){return t[21](t[29])}let d={draggable:!0,$$slots:{default:[Gn]},$$scope:{ctx:t}};return t[27].point2!==void 0&&(d.lngLat=t[27].point2),o=new ft({props:d}),Z.push(()=>oe(o,"lngLat",h)),o.$on("dragend",f),{c(){O(e.$$.fragment),n=B(),O(o.$$.fragment)},l(m){A(e.$$.fragment,m),n=q(m),A(o.$$.fragment,m)},m(m,v){F(e,m,v),P(m,n,v),F(o,m,v),l=!0},p(m,v){t=m;const k={};v[0]&4|v[1]&1&&(k.$$scope={dirty:v,ctx:t}),!r&&v[0]&4&&(r=!0,k.lngLat=t[27].point1,ne(()=>r=!1)),e.$set(k);const s={};v[0]&4|v[1]&1&&(s.$$scope={dirty:v,ctx:t}),!i&&v[0]&4&&(i=!0,s.lngLat=t[27].point2,ne(()=>i=!1)),o.$set(s)},i(m){l||(b(e.$$.fragment,m),b(o.$$.fragment,m),l=!0)},o(m){w(e.$$.fragment,m),w(o.$$.fragment,m),l=!1},d(m){m&&y(n),j(e,m),j(o,m)}}}function Nn(t){let e=(t[26].name||"Untitled movement")+"",r;return{c(){r=me(e)},l(n){r=pe(n,e)},m(n,o){P(n,r,o)},p(n,o){o[0]&67108864&&e!==(e=(n[26].name||"Untitled movement")+"")&&Ke(r,e)},d(n){n&&y(r)}}}function Dn(t){let e,r;return e=new Bt({props:{$$slots:{default:[Nn,({props:n})=>({26:n}),({props:n})=>[n?67108864:0]]},$$scope:{ctx:t}}}),{c(){O(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){F(e,n,o),r=!0},p(n,o){const i={};o[0]&67108864|o[1]&1&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Rn(t){let e=(t[26].name||"Untitled movement")+"",r;return{c(){r=me(e)},l(n){r=pe(n,e)},m(n,o){P(n,r,o)},p(n,o){o[0]&67108864&&e!==(e=(n[26].name||"Untitled movement")+"")&&Ke(r,e)},d(n){n&&y(r)}}}function Hn(t){let e,r;return e=new Bt({props:{$$slots:{default:[Rn,({props:n})=>({26:n}),({props:n})=>[n?67108864:0]]},$$scope:{ctx:t}}}),{c(){O(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){F(e,n,o),r=!0},p(n,o){const i={};o[0]&67108864|o[1]&1&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function Wn(t){let e,r,n,o;return e=new Ue({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":mt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Dn]},$$scope:{ctx:t}}}),e.$on("click",t[7]),n=new Ue({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":mt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Hn]},$$scope:{ctx:t}}}),n.$on("click",t[7]),{c(){O(e.$$.fragment),r=B(),O(n.$$.fragment)},l(i){A(e.$$.fragment,i),r=q(i),A(n.$$.fragment,i)},m(i,l){F(e,i,l),P(i,r,l),F(n,i,l),o=!0},p(i,l){const a={};l[1]&1&&(a.$$scope={dirty:l,ctx:i}),e.$set(a);const u={};l[1]&1&&(u.$$scope={dirty:l,ctx:i}),n.$set(u)},i(i){o||(b(e.$$.fragment,i),b(n.$$.fragment,i),o=!0)},o(i){w(e.$$.fragment,i),w(n.$$.fragment,i),o=!1},d(i){i&&y(r),j(e,i),j(n,i)}}}function Un(t){let e,r;return e=new Ue({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){O(e.$$.fragment)},l(n){A(e.$$.fragment,n)},m(n,o){F(e,n,o),r=!0},p:Ee,i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){w(e.$$.fragment,n),r=!1},d(n){j(e,n)}}}function zn(t){let e,r,n,o,i,l,a,u=Be(t[2].jat.movements),p=[];for(let f=0;f<u.length;f+=1)p[f]=Ct(kt(t,u,f));const h=f=>w(p[f],1,1,()=>{p[f]=null});return r=new ct({props:{data:t[8](t[2].jat.movements),$$slots:{default:[Wn]},$$scope:{ctx:t}}}),o=new ct({props:{data:t[5],$$slots:{default:[Un]},$$scope:{ctx:t}}}),l=new cr({props:{map:t[3]}}),{c(){for(let f=0;f<p.length;f+=1)p[f].c();e=B(),O(r.$$.fragment),n=B(),O(o.$$.fragment),i=B(),O(l.$$.fragment)},l(f){for(let d=0;d<p.length;d+=1)p[d].l(f);e=q(f),A(r.$$.fragment,f),n=q(f),A(o.$$.fragment,f),i=q(f),A(l.$$.fragment,f)},m(f,d){for(let m=0;m<p.length;m+=1)p[m]&&p[m].m(f,d);P(f,e,d),F(r,f,d),P(f,n,d),F(o,f,d),P(f,i,d),F(l,f,d),a=!0},p(f,d){if(d[0]&68){u=Be(f[2].jat.movements);let s;for(s=0;s<u.length;s+=1){const g=kt(f,u,s);p[s]?(p[s].p(g,d),b(p[s],1)):(p[s]=Ct(g),p[s].c(),b(p[s],1),p[s].m(e.parentNode,e))}for(ge(),s=u.length;s<p.length;s+=1)h(s);he()}const m={};d[0]&4&&(m.data=f[8](f[2].jat.movements)),d[1]&1&&(m.$$scope={dirty:d,ctx:f}),r.$set(m);const v={};d[0]&32&&(v.data=f[5]),d[1]&1&&(v.$$scope={dirty:d,ctx:f}),o.$set(v);const k={};d[0]&8&&(k.map=f[3]),l.$set(k)},i(f){if(!a){for(let d=0;d<u.length;d+=1)b(p[d]);b(r.$$.fragment,f),b(o.$$.fragment,f),b(l.$$.fragment,f),a=!0}},o(f){p=p.filter(Boolean);for(let d=0;d<p.length;d+=1)w(p[d]);w(r.$$.fragment,f),w(o.$$.fragment,f),w(l.$$.fragment,f),a=!1},d(f){f&&(y(e),y(n),y(i)),Tt(p,f),j(r,f),j(o,f),j(l,f)}}}function Vn(t){let e,r,n,o,i,l,a,u,p,h,f;const d=[Fn,An],m=[];function v(g,$){return g[0]==null?0:1}n=v(t),o=m[n]=d[n](t);function k(g){t[22](g)}let s={$$slots:{default:[zn]},$$scope:{ctx:t}};return t[3]!==void 0&&(s.map=t[3]),a=new gr({props:s}),Z.push(()=>oe(a,"map",k)),{c(){e=W("div"),r=W("div"),o.c(),i=B(),l=W("div"),O(a.$$.fragment),this.h()},l(g){e=U(g,"DIV",{style:!0});var $=H(e);r=U($,"DIV",{style:!0});var M=H(r);o.l(M),M.forEach(y),i=q($),l=U($,"DIV",{style:!0});var S=H(l);A(a.$$.fragment,S),S.forEach(y),$.forEach(y),this.h()},h(){te(r,"width","30%"),te(r,"overflow-y","scroll"),te(r,"padding","10px"),te(l,"position","relative"),te(l,"width","100%"),te(e,"display","flex"),te(e,"height","600px")},m(g,$){P(g,e,$),re(e,r),m[n].m(r,null),re(e,i),re(e,l),F(a,l,null),p=!0,h||(f=Se(On,"keydown",t[11]),h=!0)},p(g,$){let M=n;n=v(g),n===M?m[n].p(g,$):(ge(),w(m[M],1,1,()=>{m[M]=null}),he(),o=m[n],o?o.p(g,$):(o=m[n]=d[n](g),o.c()),b(o,1),o.m(r,null));const S={};$[0]&44|$[1]&1&&(S.$$scope={dirty:$,ctx:g}),!u&&$[0]&8&&(u=!0,S.map=g[3],ne(()=>u=!1)),a.$set(S)},i(g){p||(b(o),b(a.$$.fragment,g),p=!0)},o(g){w(o),w(a.$$.fragment,g),p=!1},d(g){g&&y(e),m[n].d(),j(a),h=!1,f()}}}function Jn(t,e,r){let n,o;ae(t,J,_=>r(2,o=_));let i,l=null,a=null,u=!1;function p(_,G,be){let Ae={type:"FeatureCollection",features:[]},E=G??be;return E!=null&&Ae.features.push(v(_.jat.movements[E],E)),Ae}function h(_){r(0,l=_),r(1,a=null)}function f(_){if(!u){for(let G of i.queryRenderedFeatures(_.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(l!=null){r(0,l=null);return}Ot(J,o.jat.movements=[...o.jat.movements,{point1:_.lngLat.toArray(),point2:Yr(_.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",color:"green",name:"",notes:""}],o),r(0,l=o.jat.movements.length-1),r(1,a=null)}}function d(_){h(_.detail.features[0].id)}Lt(()=>{i.on("click",f),s(!1)}),Mt(()=>{i.off("click",f)});function m(_){return{type:"FeatureCollection",features:_.map((G,be)=>v(G,be))}}function v(_,G){return{type:"Feature",id:G,properties:{name:_.name,kind:_.kind,color:ie[_.color].background},geometry:{type:"LineString",coordinates:[_.point1,_.point2]}}}function k(){window.confirm("Delete this movement?")&&(o.jat.movements.splice(l,1),J.set(o),r(0,l=null))}function s(_){o.jat.movements.length>0&&i.fitBounds(sr(m(o.jat.movements)),{padding:20,animate:_})}function g(_){l!=null&&_.key=="Escape"?(_.stopPropagation(),r(0,l=null)):l!=null&&_.key=="Delete"&&k()}const $=()=>s(!0);function M(_){u=_,r(4,u)}const S=_=>h(_),de=_=>r(1,a=_),_e=()=>r(1,a=null),N=()=>r(0,l=null);function le(_,G){t.$$.not_equal(G.point1,_)&&(G.point1=_,J.set(o))}const T=_=>h(_);function ye(_,G){t.$$.not_equal(G.point2,_)&&(G.point2=_,J.set(o))}const Me=_=>h(_);function Oe(_){i=_,r(3,i)}return t.$$.update=()=>{t.$$.dirty[0]&7&&r(5,n=p(o,l,a))},[l,a,o,i,u,n,h,d,m,k,s,g,$,M,S,de,_e,N,le,T,ye,Me,Oe]}class uo extends Ce{constructor(e){super(),Le(this,e,Jn,Vn,Pe,{},null,[-1,-1])}}export{uo as component};
