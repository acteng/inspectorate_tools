import{s as Y,a7 as ye,U as ge,a8 as _e,A as T,a as B,g as S,i as v,B as N,f as _,k as X,e as q,c as F,b as G,v as j,h as W,r as Ce,M as he,t as O,d as V,j as De,p as Ae,n as J,E as re,q as be}from"../chunks/scheduler.CYx2ttP3.js";import{S as z,i as Q,f as P,c as k,a as w,m as I,t as d,b as h,d as y,g as H,e as K}from"../chunks/index.Bh3RlrZK.js";import{e as U}from"../chunks/each.D_qLyk6y.js";import{p as Be}from"../chunks/index.DYbhK7fp.js";import{S as le}from"../chunks/Select.gMiMMceA.js";import{T as Se}from"../chunks/TextArea.CT4fIbcj.js";import{T as Ee}from"../chunks/TextInput.DkOyKEPL.js";import{s as A}from"../chunks/data.IsJiNbVj.js";import{Y as Me}from"../chunks/YesNo.ygDSeLGs.js";import{D as Le}from"../chunks/DefaultButton.CxPf0z-2.js";import{W as ve,S as Te}from"../chunks/WarningButton.YKTv_CHU.js";import{m as oe,M as Ne,G as Pe,C as We}from"../chunks/MapLibreMap.C3nWZ4-0.js";import"../chunks/paths.DxYIWsaU.js";import{C as qe}from"../chunks/CollapsibleCard.ZXncRbDC.js";/* empty css                                                    */function Fe(n,t,i){let e=ye(),{map:a}=t,{position:l}=t,c=null;return ge(()=>{c=new oe.Marker({draggable:!0}).setLngLat(new oe.LngLat(l[0],l[1])).addTo(a),c.on("dragstart",()=>{a.getCanvas().style.cursor="grabbing"}),c.on("drag",()=>{i(0,l=c.getLngLat().toArray())}),c.on("dragend",()=>{a.getCanvas().style.cursor="inherit"}),c.getElement().addEventListener("click",s=>{e("click"),s.stopPropagation()})}),_e(()=>{c==null||c.remove()}),n.$$set=s=>{"map"in s&&i(1,a=s.map),"position"in s&&i(0,l=s.position)},[l,a]}class Oe extends z{constructor(t){super(),Q(this,t,Fe,null,Y,{map:1,position:0})}}function Ve(n){let t,i,e,a,l,c,s,u,r,f,o,m,$,g,M;function R(p){n[3](p)}let b={label:"Critical Issue",emptyOption:!0,choices:n[2]};n[1].criticalIssues[n[0]].criticalIssue!==void 0&&(b.value=n[1].criticalIssues[n[0]].criticalIssue),t=new le({props:b}),T.push(()=>P(t,"value",R));function C(p){n[4](p)}let L={label:"Stage",emptyOption:!0,choices:Be(["Existing","Design"])};n[1].criticalIssues[n[0]].stage!==void 0&&(L.value=n[1].criticalIssues[n[0]].stage),a=new le({props:L}),T.push(()=>P(a,"value",C));function E(p){n[5](p)}let Z={label:"Location Name"};n[1].criticalIssues[n[0]].locationName!==void 0&&(Z.value=n[1].criticalIssues[n[0]].locationName),s=new Ee({props:Z}),T.push(()=>P(s,"value",E));function we(p){n[6](p)}let x={label:"Resolved by Design"};n[1].criticalIssues[n[0]].resolved!==void 0&&(x.value=n[1].criticalIssues[n[0]].resolved),f=new Me({props:x}),T.push(()=>P(f,"value",we));function Ie(p){n[7](p)}let ee={label:"Commentary & Feedback"};return n[1].criticalIssues[n[0]].notes!==void 0&&(ee.value=n[1].criticalIssues[n[0]].notes),$=new Se({props:ee}),T.push(()=>P($,"value",Ie)),{c(){k(t.$$.fragment),e=B(),k(a.$$.fragment),c=B(),k(s.$$.fragment),r=B(),k(f.$$.fragment),m=B(),k($.$$.fragment)},l(p){w(t.$$.fragment,p),e=S(p),w(a.$$.fragment,p),c=S(p),w(s.$$.fragment,p),r=S(p),w(f.$$.fragment,p),m=S(p),w($.$$.fragment,p)},m(p,D){I(t,p,D),v(p,e,D),I(a,p,D),v(p,c,D),I(s,p,D),v(p,r,D),I(f,p,D),v(p,m,D),I($,p,D),M=!0},p(p,[D]){const te={};!i&&D&3&&(i=!0,te.value=p[1].criticalIssues[p[0]].criticalIssue,N(()=>i=!1)),t.$set(te);const ne={};!l&&D&3&&(l=!0,ne.value=p[1].criticalIssues[p[0]].stage,N(()=>l=!1)),a.$set(ne);const se={};!u&&D&3&&(u=!0,se.value=p[1].criticalIssues[p[0]].locationName,N(()=>u=!1)),s.$set(se);const ie={};!o&&D&3&&(o=!0,ie.value=p[1].criticalIssues[p[0]].resolved,N(()=>o=!1)),f.$set(ie);const ae={};!g&&D&3&&(g=!0,ae.value=p[1].criticalIssues[p[0]].notes,N(()=>g=!1)),$.$set(ae)},i(p){M||(d(t.$$.fragment,p),d(a.$$.fragment,p),d(s.$$.fragment,p),d(f.$$.fragment,p),d($.$$.fragment,p),M=!0)},o(p){h(t.$$.fragment,p),h(a.$$.fragment,p),h(s.$$.fragment,p),h(f.$$.fragment,p),h($.$$.fragment,p),M=!1},d(p){p&&(_(e),_(c),_(r),_(m)),y(t,p),y(a,p),y(s,p),y(f,p),y($,p)}}}function je(n,t,i){let e;X(n,A,o=>i(1,e=o));let{idx:a}=t,l=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]];function c(o){n.$$.not_equal(e.criticalIssues[a].criticalIssue,o)&&(e.criticalIssues[a].criticalIssue=o,A.set(e))}function s(o){n.$$.not_equal(e.criticalIssues[a].stage,o)&&(e.criticalIssues[a].stage=o,A.set(e))}function u(o){n.$$.not_equal(e.criticalIssues[a].locationName,o)&&(e.criticalIssues[a].locationName=o,A.set(e))}function r(o){n.$$.not_equal(e.criticalIssues[a].resolved,o)&&(e.criticalIssues[a].resolved=o,A.set(e))}function f(o){n.$$.not_equal(e.criticalIssues[a].notes,o)&&(e.criticalIssues[a].notes=o,A.set(e))}return n.$$set=o=>{"idx"in o&&i(0,a=o.idx)},[a,e,l,c,s,u,r,f]}class ke extends z{constructor(t){super(),Q(this,t,je,Ve,Y,{idx:0})}}function ce(n,t,i){const e=n.slice();return e[10]=t[i],e[11]=t,e[12]=i,e}function Ge(n){let t,i,e,a,l,c,s,u,r,f;return l=new Le({props:{$$slots:{default:[Je]},$$scope:{ctx:n}}}),l.$on("click",n[5]),s=new ve({props:{$$slots:{default:[He]},$$scope:{ctx:n}}}),s.$on("click",n[4]),r=new ke({props:{idx:n[1]}}),{c(){t=q("p"),i=O("Editing "),e=O(n[1]),a=B(),k(l.$$.fragment),c=B(),k(s.$$.fragment),u=B(),k(r.$$.fragment)},l(o){t=F(o,"P",{});var m=G(t);i=V(m,"Editing "),e=V(m,n[1]),m.forEach(_),a=S(o),w(l.$$.fragment,o),c=S(o),w(s.$$.fragment,o),u=S(o),w(r.$$.fragment,o)},m(o,m){v(o,t,m),W(t,i),W(t,e),v(o,a,m),I(l,o,m),v(o,c,m),I(s,o,m),v(o,u,m),I(r,o,m),f=!0},p(o,m){(!f||m&2)&&De(e,o[1]);const $={};m&8192&&($.$$scope={dirty:m,ctx:o}),l.$set($);const g={};m&8192&&(g.$$scope={dirty:m,ctx:o}),s.$set(g);const M={};m&2&&(M.idx=o[1]),r.$set(M)},i(o){f||(d(l.$$.fragment,o),d(s.$$.fragment,o),d(r.$$.fragment,o),f=!0)},o(o){h(l.$$.fragment,o),h(s.$$.fragment,o),h(r.$$.fragment,o),f=!1},d(o){o&&(_(t),_(a),_(c),_(u)),y(l,o),y(s,o),y(r,o)}}}function Re(n){let t,i="Click the map to add a pin, or click a pin to fill out data";return{c(){t=q("p"),t.textContent=i},l(e){t=F(e,"P",{"data-svelte-h":!0}),Ae(t)!=="svelte-1rxcdnm"&&(t.textContent=i)},m(e,a){v(e,t,a)},p:J,i:J,o:J,d(e){e&&_(t)}}}function Je(n){let t;return{c(){t=O("Save")},l(i){t=V(i,"Save")},m(i,e){v(i,t,e)},d(i){i&&_(t)}}}function He(n){let t;return{c(){t=O("Delete")},l(i){t=V(i,"Delete")},m(i,e){v(i,t,e)},d(i){i&&_(t)}}}function fe(n){let t;return{c(){t=q("div"),this.h()},l(i){t=F(i,"DIV",{class:!0}),G(t).forEach(_),this.h()},h(){Ce(t,"class","block-map svelte-13rr2mh")},m(i,e){v(i,t,e)},d(i){i&&_(t)}}}function ue(n){let t,i,e;function a(s){n[6](s,n[10])}function l(){return n[7](n[12])}let c={map:n[0]};return n[10].point!==void 0&&(c.position=n[10].point),t=new Oe({props:c}),T.push(()=>P(t,"position",a)),t.$on("click",l),{c(){k(t.$$.fragment)},l(s){w(t.$$.fragment,s)},m(s,u){I(t,s,u),e=!0},p(s,u){n=s;const r={};u&1&&(r.map=n[0]),!i&&u&4&&(i=!0,r.position=n[10].point,N(()=>i=!1)),t.$set(r)},i(s){e||(d(t.$$.fragment,s),e=!0)},o(s){h(t.$$.fragment,s),e=!1},d(s){y(t,s)}}}function pe(n){let t,i;return t=new Pe({props:{data:me(n[2].criticalIssues[n[1]].point),$$slots:{default:[Ke]},$$scope:{ctx:n}}}),{c(){k(t.$$.fragment)},l(e){w(t.$$.fragment,e)},m(e,a){I(t,e,a),i=!0},p(e,a){const l={};a&6&&(l.data=me(e[2].criticalIssues[e[1]].point)),a&8192&&(l.$$scope={dirty:a,ctx:e}),t.$set(l)},i(e){i||(d(t.$$.fragment,e),i=!0)},o(e){h(t.$$.fragment,e),i=!1},d(e){y(t,e)}}}function Ke(n){let t,i;return t=new We({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){k(t.$$.fragment)},l(e){w(t.$$.fragment,e)},m(e,a){I(t,e,a),i=!0},p:J,i(e){i||(d(t.$$.fragment,e),i=!0)},o(e){h(t.$$.fragment,e),i=!1},d(e){y(t,e)}}}function Ue(n){let t,i,e,a=U(n[2].criticalIssues),l=[];for(let u=0;u<a.length;u+=1)l[u]=ue(ce(n,a,u));const c=u=>h(l[u],1,1,()=>{l[u]=null});let s=n[1]!=null&&pe(n);return{c(){for(let u=0;u<l.length;u+=1)l[u].c();t=B(),s&&s.c(),i=re()},l(u){for(let r=0;r<l.length;r+=1)l[r].l(u);t=S(u),s&&s.l(u),i=re()},m(u,r){for(let f=0;f<l.length;f+=1)l[f]&&l[f].m(u,r);v(u,t,r),s&&s.m(u,r),v(u,i,r),e=!0},p(u,r){if(r&13){a=U(u[2].criticalIssues);let f;for(f=0;f<a.length;f+=1){const o=ce(u,a,f);l[f]?(l[f].p(o,r),d(l[f],1)):(l[f]=ue(o),l[f].c(),d(l[f],1),l[f].m(t.parentNode,t))}for(H(),f=a.length;f<l.length;f+=1)c(f);K()}u[1]!=null?s?(s.p(u,r),r&2&&d(s,1)):(s=pe(u),s.c(),d(s,1),s.m(i.parentNode,i)):s&&(H(),h(s,1,1,()=>{s=null}),K())},i(u){if(!e){for(let r=0;r<a.length;r+=1)d(l[r]);d(s),e=!0}},o(u){l=l.filter(Boolean);for(let r=0;r<l.length;r+=1)h(l[r]);h(s),e=!1},d(u){u&&(_(t),_(i)),be(l,u),s&&s.d(u)}}}function Ye(n){let t,i,e,a,l,c,s,u,r,f;const o=[Re,Ge],m=[];function $(b,C){return b[1]==null?0:1}e=$(n),a=m[e]=o[e](n);let g=n[1]!=null&&fe();function M(b){n[8](b)}let R={$$slots:{default:[Ue]},$$scope:{ctx:n}};return n[0]!==void 0&&(R.map=n[0]),u=new Ne({props:R}),T.push(()=>P(u,"map",M)),{c(){t=q("div"),i=q("div"),a.c(),l=B(),c=q("div"),g&&g.c(),s=B(),k(u.$$.fragment),this.h()},l(b){t=F(b,"DIV",{style:!0});var C=G(t);i=F(C,"DIV",{style:!0});var L=G(i);a.l(L),L.forEach(_),l=S(C),c=F(C,"DIV",{style:!0});var E=G(c);g&&g.l(E),s=S(E),w(u.$$.fragment,E),E.forEach(_),C.forEach(_),this.h()},h(){j(i,"width","30%"),j(c,"position","relative"),j(c,"width","70%"),j(c,"height","300px"),j(t,"display","flex")},m(b,C){v(b,t,C),W(t,i),m[e].m(i,null),W(t,l),W(t,c),g&&g.m(c,null),W(c,s),I(u,c,null),f=!0},p(b,[C]){let L=e;e=$(b),e===L?m[e].p(b,C):(H(),h(m[L],1,1,()=>{m[L]=null}),K(),a=m[e],a?a.p(b,C):(a=m[e]=o[e](b),a.c()),d(a,1),a.m(i,null)),b[1]!=null?g||(g=fe(),g.c(),g.m(c,s)):g&&(g.d(1),g=null);const E={};C&8199&&(E.$$scope={dirty:C,ctx:b}),!r&&C&1&&(r=!0,E.map=b[0],N(()=>r=!1)),u.$set(E)},i(b){f||(d(a),d(u.$$.fragment,b),f=!0)},o(b){h(a),h(u.$$.fragment,b),f=!1},d(b){b&&_(t),m[e].d(),g&&g.d(),y(u)}}}function me(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function ze(n,t,i){let e;X(n,A,$=>i(2,e=$));let a,l=null;function c($){i(1,l=$)}function s($){he(A,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:$.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),i(1,l=e.criticalIssues.length-1)}ge(()=>{a.on("click",s)}),_e(()=>{a.off("click",s)});function u(){e.criticalIssues.splice(l,1),A.set(e),i(1,l=null)}const r=()=>i(1,l=null);function f($,g){n.$$.not_equal(g.point,$)&&(g.point=$,A.set(e))}const o=$=>c($);function m($){a=$,i(0,a)}return[a,l,e,c,u,r,f,o,m]}class Qe extends z{constructor(t){super(),Q(this,t,ze,Ye,Y,{})}}function $e(n,t,i){const e=n.slice();return e[4]=t[i],e[6]=i,e}function Xe(n){let t;return{c(){t=O("Add")},l(i){t=V(i,"Add")},m(i,e){v(i,t,e)},d(i){i&&_(t)}}}function Ze(n){let t;return{c(){t=O("Delete")},l(i){t=V(i,"Delete")},m(i,e){v(i,t,e)},d(i){i&&_(t)}}}function xe(n){let t,i,e,a;function l(){return n[3](n[6])}return t=new ve({props:{$$slots:{default:[Ze]},$$scope:{ctx:n}}}),t.$on("click",l),e=new ke({props:{idx:n[6]}}),{c(){k(t.$$.fragment),i=B(),k(e.$$.fragment)},l(c){w(t.$$.fragment,c),i=S(c),w(e.$$.fragment,c)},m(c,s){I(t,c,s),v(c,i,s),I(e,c,s),a=!0},p(c,s){n=c;const u={};s&128&&(u.$$scope={dirty:s,ctx:n}),t.$set(u)},i(c){a||(d(t.$$.fragment,c),d(e.$$.fragment,c),a=!0)},o(c){h(t.$$.fragment,c),h(e.$$.fragment,c),a=!1},d(c){c&&_(i),y(t,c),y(e,c)}}}function de(n){let t,i;return t=new qe({props:{label:n[4].id,$$slots:{default:[xe]},$$scope:{ctx:n}}}),{c(){k(t.$$.fragment)},l(e){w(t.$$.fragment,e)},m(e,a){I(t,e,a),i=!0},p(e,a){const l={};a&1&&(l.label=e[4].id),a&128&&(l.$$scope={dirty:a,ctx:e}),t.$set(l)},i(e){i||(d(t.$$.fragment,e),i=!0)},o(e){h(t.$$.fragment,e),i=!1},d(e){y(t,e)}}}function et(n){let t,i,e,a,l;t=new Te({props:{$$slots:{default:[Xe]},$$scope:{ctx:n}}}),t.$on("click",n[1]);let c=U(n[0].criticalIssues),s=[];for(let r=0;r<c.length;r+=1)s[r]=de($e(n,c,r));const u=r=>h(s[r],1,1,()=>{s[r]=null});return a=new Qe({}),{c(){k(t.$$.fragment),i=B();for(let r=0;r<s.length;r+=1)s[r].c();e=B(),k(a.$$.fragment)},l(r){w(t.$$.fragment,r),i=S(r);for(let f=0;f<s.length;f+=1)s[f].l(r);e=S(r),w(a.$$.fragment,r)},m(r,f){I(t,r,f),v(r,i,f);for(let o=0;o<s.length;o+=1)s[o]&&s[o].m(r,f);v(r,e,f),I(a,r,f),l=!0},p(r,[f]){const o={};if(f&128&&(o.$$scope={dirty:f,ctx:r}),t.$set(o),f&5){c=U(r[0].criticalIssues);let m;for(m=0;m<c.length;m+=1){const $=$e(r,c,m);s[m]?(s[m].p($,f),d(s[m],1)):(s[m]=de($),s[m].c(),d(s[m],1),s[m].m(e.parentNode,e))}for(H(),m=c.length;m<s.length;m+=1)u(m);K()}},i(r){if(!l){d(t.$$.fragment,r);for(let f=0;f<c.length;f+=1)d(s[f]);d(a.$$.fragment,r),l=!0}},o(r){h(t.$$.fragment,r),s=s.filter(Boolean);for(let f=0;f<s.length;f+=1)h(s[f]);h(a.$$.fragment,r),l=!1},d(r){r&&(_(i),_(e)),y(t,r),be(s,r),y(a,r)}}}function tt(n,t,i){let e;X(n,A,s=>i(0,e=s));function a(){he(A,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:[0,0],locationName:"",resolved:"",notes:""}],e)}function l(s){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(s,1),A.set(e))}return[e,a,l,s=>l(s)]}class _t extends z{constructor(t){super(),Q(this,t,tt,et,Y,{})}}export{_t as component};
