import{s as ye,v as ee,x as oe,l as ze,u as De,m as He,o as Re,H as re,E as Ge,i as P,f as v,a9 as sn,a8 as un,k as de,U as Ft,a7 as $t,N as nt,e as Z,c as Q,b as te,r as Ae,a as H,g as R,w as ne,h as ae,z as fn,t as W,p as cn,d as V,j as _e,q as rt,n as mn}from"../chunks/scheduler.Bsni_e59.js";import{S as be,i as ve,e as ie,c as A,a as S,m as F,t as k,b as E,d as $,g as fe,f as ce}from"../chunks/index.CCfAUppz.js";import{e as Le}from"../chunks/each.ChCadThl.js";import{W as Bt,S as ue}from"../chunks/WarningButton.D9QeV9gM.js";import{T as qt}from"../chunks/TextInput.CHbK327s.js";import{s as K}from"../chunks/data.DbSXO9_u.js";import{L as Gt,g as Nt,e as gn,m as Ee,i as hn,f as zt,M as pn,a as dn,G as dt,h as _t}from"../chunks/MapLibreMap.CzTqa0z5.js";import{c as $e}from"../chunks/colors.CYEpEtTL.js";import{D as _n}from"../chunks/DefaultButton.DyQsHGbh.js";import{T as Dt}from"../chunks/TextArea.DbePhW6L.js";import{a as yn,B as bn,G as vn,S as wn,c as kn,M as yt}from"../chunks/GeoreferenceLayer.B05PThNY.js";import{p as jn}from"../chunks/index.CcyTGuEk.js";import{S as bt}from"../chunks/Select.N7F_8zcJ.js";function En(t){let e;const n=t[15].default,r=ze(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&De(r,n,o,o[23],e?Re(n,o[23],l,null):He(o[23]),null)},i(o){e||(k(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function Ln(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[En]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Gt({props:l}),ee.push(()=>ie(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(k(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){$(e,i)}}}function Cn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Nt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:h}=e,{layout:u=void 0}=e,{filter:m=void 0}=e,{minzoom:d=void 0}=e,{maxzoom:p=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:b=!1}=e,{hovered:q=null}=e,{eventsIfTopMost:O=!1}=e,{interactive:T=!0}=e;function D(L){q=L,n(0,q)}function g(L){re.call(this,t,L)}function j(L){re.call(this,t,L)}function c(L){re.call(this,t,L)}function M(L){re.call(this,t,L)}function I(L){re.call(this,t,L)}function B(L){re.call(this,t,L)}return t.$$set=L=>{"id"in L&&n(1,l=L.id),"source"in L&&n(2,i=L.source),"sourceLayer"in L&&n(3,a=L.sourceLayer),"beforeId"in L&&n(4,s=L.beforeId),"beforeLayerType"in L&&n(5,f=L.beforeLayerType),"paint"in L&&n(6,h=L.paint),"layout"in L&&n(7,u=L.layout),"filter"in L&&n(8,m=L.filter),"minzoom"in L&&n(9,d=L.minzoom),"maxzoom"in L&&n(10,p=L.maxzoom),"hoverCursor"in L&&n(11,y=L.hoverCursor),"manageHoverState"in L&&n(12,b=L.manageHoverState),"hovered"in L&&n(0,q=L.hovered),"eventsIfTopMost"in L&&n(13,O=L.eventsIfTopMost),"interactive"in L&&n(14,T=L.interactive),"$$scope"in L&&n(23,o=L.$$scope)},[q,l,i,a,s,f,h,u,m,d,p,y,b,O,T,r,D,g,j,c,M,I,B,o]}class Ye extends be{constructor(e){super(),ve(this,e,Cn,Ln,ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Mn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),vt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function wt(t){let e,n,r=(t[4]||t[3]instanceof Ee.Marker)&&kt(t);return{c(){e=Z("div"),r&&r.c()},l(o){e=Q(o,"DIV",{});var l=te(e);r&&r.l(l),l.forEach(v)},m(o,l){P(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof Ee.Marker?r?(r.p(o,l),l[0]&24&&k(r,1)):(r=kt(o),r.c(),k(r,1),r.m(e,null)):r&&(fe(),E(r,1,1,()=>{r=null}),ce())},i(o){n||(k(r),n=!0)},o(o){E(r),n=!1},d(o){o&&v(e),r&&r.d(),t[32](null)}}}function kt(t){let e;const n=t[30].default,r=ze(n,t,t[29],vt);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&De(r,n,o,o[29],e?Re(n,o[29],l,Mn):He(o[29]),vt)},i(o){e||(k(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function Pn(t){let e,n,r=t[9].default&&wt(t);return{c(){r&&r.c(),e=Ge()},l(o){r&&r.l(o),e=Ge()},m(o,l){r&&r.m(o,l),P(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&k(r,1)):(r=wt(o),r.c(),k(r,1),r.m(e.parentNode,e)):r&&(fe(),E(r,1,1,()=>{r=null}),ce())},i(o){n||(k(r),n=!0)},o(o){E(r),n=!1},d(o){o&&v(e),r&&r.d(o)}}}function In(t,e,n){let r,o,l,i,a,s,{$$slots:f={},$$scope:h}=e;const u=sn(f);let{closeButton:m=void 0}=e,{closeOnClickOutside:d=!0}=e,{closeOnClickInside:p=!1}=e,{closeOnMove:y=!1}=e,{openOn:b="click"}=e,{openIfTopMost:q=!0}=e,{focusAfterOpen:O=!0}=e,{anchor:T=void 0}=e,{offset:D=void 0}=e,{popupClass:g=void 0}=e,{maxWidth:j=void 0}=e,{lngLat:c=void 0}=e,{html:M=void 0}=e,{open:I=!1}=e;const B=un(),{map:L,popupTarget:C,layerEvent:we,layer:Se,eventTopMost:Xe}=gn();de(t,L,_=>n(2,l=_)),de(t,C,_=>n(3,a=_)),de(t,we,_=>n(28,i=_)),de(t,Se,_=>n(35,s=_));const Ke=["click","dblclick","contextmenu"];let G,ke=!1,se;function w(){if(!G)return;let _=G.getElement();!_||_===se||(se=_,b==="hover"&&(se.style.pointerEvents="none"),se.addEventListener("mouseenter",()=>{n(24,ke=!0)},{passive:!0}),se.addEventListener("mouseleave",()=>{n(24,ke=!1)},{passive:!0}),se.addEventListener("click",()=>{p&&n(0,I=!1)},{passive:!0}))}Ft(()=>{if(l)return l.on("click",Fe),l.on("contextmenu",Fe),typeof a=="string"&&(l.on("click",a,le),l.on("dblclick",a,le),l.on("contextmenu",a,le),l.on("mousemove",a,pt),l.on("mouseleave",a,ht),l.on("touchstart",a,mt),l.on("touchend",a,gt)),()=>{l!=null&&l.loaded()&&(G==null||G.remove(),l.off("click",Fe),l.off("contextmenu",Fe),a instanceof Ee.Marker?a.getPopup()===G&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,le),l.off("dblclick",a,le),l.off("contextmenu",a,le),l.off("mousemove",a,pt),l.off("mouseleave",a,ht),l.off("touchstart",a,mt),l.off("touchend",a,gt)))}});function U(_){return q?!("marker"in _)&&!hn(_)&&Xe(_)!==s:!1}let J=null,X="normal";function le(_){_.type===b&&(U(_)||("layerType"in _?_.layerType==="deckgl"?(n(10,c=_.coordinate),n(4,J=_.object?[_.object]:null)):(n(10,c=_.lngLat),n(4,J=_.features??[])):(n(10,c=_.lngLat),n(4,J=_.features??[])),setTimeout(()=>n(0,I=!0))))}let je=null;function mt(_){je=_.point}function gt(_){if(!je||b!=="hover")return;let Ze=je.dist(_.point);je=null,Ze<3&&(n(10,c=_.lngLat),n(4,J=_.features??[]),G.isOpen()?n(25,X="justOpened"):(n(25,X="opening"),n(0,I=!0)))}function ht(_){b!=="hover"||je||X!=="normal"||(n(0,I=!1),n(4,J=null))}function pt(_){if(!(b!=="hover"||je||X!=="normal")){if(U(_)){n(0,I=!1),n(4,J=null);return}n(0,I=!0),n(4,J=_.features??[]),n(10,c=_.lngLat)}}function Fe(_){if(X==="justOpened"){n(25,X="normal");return}if(!d)return;let Ze=[se,a instanceof Ee.Marker?a==null?void 0:a.getElement():null];I&&G.isOpen()&&!Ze.some(Qe=>Qe==null?void 0:Qe.contains(_.originalEvent.target))&&(_.type==="contextmenu"&&b==="contextmenu"||_.type!=="contextmenu")&&n(0,I=!1)}$t(()=>{l&&(G!=null&&G.isOpen())&&G.remove()});let Pe;const ln=()=>n(0,I=!1);function an(_){ee[_?"unshift":"push"](()=>{Pe=_,n(1,Pe)})}return t.$$set=_=>{"closeButton"in _&&n(11,m=_.closeButton),"closeOnClickOutside"in _&&n(12,d=_.closeOnClickOutside),"closeOnClickInside"in _&&n(13,p=_.closeOnClickInside),"closeOnMove"in _&&n(14,y=_.closeOnMove),"openOn"in _&&n(15,b=_.openOn),"openIfTopMost"in _&&n(16,q=_.openIfTopMost),"focusAfterOpen"in _&&n(17,O=_.focusAfterOpen),"anchor"in _&&n(18,T=_.anchor),"offset"in _&&n(19,D=_.offset),"popupClass"in _&&n(20,g=_.popupClass),"maxWidth"in _&&n(21,j=_.maxWidth),"lngLat"in _&&n(10,c=_.lngLat),"html"in _&&n(22,M=_.html),"open"in _&&n(0,I=_.open),"$$scope"in _&&n(29,h=_.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=m??(!d&&!p)),t.$$.dirty[0]&146685952&&(G||(n(23,G=new Ee.Popup({closeButton:r,closeOnClick:!1,closeOnMove:y,focusAfterOpen:O,maxWidth:j,className:g,anchor:T,offset:D})),se=G.getElement(),G.on("open",()=>{n(0,I=!0),w(),B("open",G)}),G.on("close",()=>{n(0,I=!1),B("close",G)}),G.on("hover",()=>{B("hover",G)}))),t.$$.dirty[0]&8421384&&G&&a instanceof Ee.Marker&&(b==="click"?a.setPopup(G):a.getPopup()===G&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Ke.includes(b)&&(i==null?void 0:i.type)===b&&(le(i),nt(we,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=b==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&b==="hover"&&we&&(o&&i&&(i.layerType==="deckgl"?(n(10,c=i.coordinate),n(4,J=i.object?[i.object]:null)):(n(10,c=i.lngLat),n(4,J=i.features??[]))),n(0,I=(o||ke)??!1)),t.$$.dirty[0]&12582914&&(Pe?G.setDOMContent(Pe):M&&G.setHTML(M)),t.$$.dirty[0]&8389632&&c&&G.setLngLat(c),t.$$.dirty[0]&41943045&&l){let _=G.isOpen();I&&!_?(G.addTo(l),X==="opening"&&n(25,X="justOpened")):!I&&_&&G.remove()}},[I,Pe,l,a,J,L,C,we,Se,u,c,m,d,p,y,b,q,O,T,D,g,j,M,G,ke,X,o,r,i,h,f,ln,an]}class Tn extends be{constructor(e){super(),ve(this,e,In,Pn,ye,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function On(t){let e;const n=t[16].default,r=ze(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&De(r,n,o,o[24],e?Re(n,o[24],l,null):He(o[24]),null)},i(o){e||(k(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function An(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[On]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Gt({props:l}),ee.push(()=>ie(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(k(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){$(e,i)}}}function Sn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Nt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:h=void 0}=e,{layout:u=void 0}=e,{filter:m=void 0}=e,{applyToClusters:d=void 0}=e,{minzoom:p=void 0}=e,{maxzoom:y=void 0}=e,{hoverCursor:b=void 0}=e,{manageHoverState:q=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:T=!1}=e,{interactive:D=!0}=e;function g(C){O=C,n(0,O)}function j(C){re.call(this,t,C)}function c(C){re.call(this,t,C)}function M(C){re.call(this,t,C)}function I(C){re.call(this,t,C)}function B(C){re.call(this,t,C)}function L(C){re.call(this,t,C)}return t.$$set=C=>{"id"in C&&n(1,l=C.id),"source"in C&&n(2,i=C.source),"sourceLayer"in C&&n(3,a=C.sourceLayer),"beforeId"in C&&n(4,s=C.beforeId),"beforeLayerType"in C&&n(5,f=C.beforeLayerType),"paint"in C&&n(6,h=C.paint),"layout"in C&&n(7,u=C.layout),"filter"in C&&n(8,m=C.filter),"applyToClusters"in C&&n(9,d=C.applyToClusters),"minzoom"in C&&n(10,p=C.minzoom),"maxzoom"in C&&n(11,y=C.maxzoom),"hoverCursor"in C&&n(12,b=C.hoverCursor),"manageHoverState"in C&&n(13,q=C.manageHoverState),"hovered"in C&&n(0,O=C.hovered),"eventsIfTopMost"in C&&n(14,T=C.eventsIfTopMost),"interactive"in C&&n(15,D=C.interactive),"$$scope"in C&&n(24,o=C.$$scope)},[O,l,i,a,s,f,h,u,m,d,p,y,b,q,T,D,r,g,j,c,M,I,B,L,o]}class Fn extends be{constructor(e){super(),ve(this,e,Sn,An,ye,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const $n=t=>({props:t&8}),jt=t=>({props:Gn(t[3])});function Bn(t){let e,n;const r=t[1].default,o=ze(r,t,t[2],jt);return{c(){e=Z("div"),o&&o.c(),this.h()},l(l){e=Q(l,"DIV",{class:!0});var i=te(e);o&&o.l(i),i.forEach(v),this.h()},h(){Ae(e,"class","govuk-prose")},m(l,i){P(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&De(o,r,l,l[2],n?Re(r,l[2],i,$n):He(l[2]),jt)},i(l){n||(k(o,l),n=!0)},o(l){E(o,l),n=!1},d(l){l&&v(e),o&&o.d(l)}}}function qn(t){let e,n;return e=new Tn({props:{openOn:t[0],$$slots:{default:[Bn,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){$(e,r)}}}function Gn(t){return t?t[0].properties??{}:{}}function Nn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Ht extends be{constructor(e){super(),ve(this,e,Nn,qn,ye,{openOn:0})}}var zn=Object.defineProperty,N=(t,e)=>zn(t,"name",{value:e,configurable:!0}),Dn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ie(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=xe(e),o=xe(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ie(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ie(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ie(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};N(Dn,"GeojsonEquality");function Ie(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}N(Ie,"sameLength");function xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}N(xe,"explode");var Y=63710088e-1,Rt={centimeters:Y*100,centimetres:Y*100,degrees:360/(2*Math.PI),feet:Y*3.28084,inches:Y*39.37,kilometers:Y/1e3,kilometres:Y/1e3,meters:Y,metres:Y,miles:Y/1609.344,millimeters:Y*1e3,millimetres:Y*1e3,nauticalmiles:Y/1852,radians:1,yards:Y*1.0936},Et={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function me(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}N(me,"feature");function Hn(t,e,n={}){switch(t){case"Point":return Ue(e).geometry;case"LineString":return it(e).geometry;case"Polygon":return ot(e).geometry;case"MultiPoint":return Jt(e).geometry;case"MultiLineString":return Ut(e).geometry;case"MultiPolygon":return Wt(e).geometry;default:throw new Error(t+" is invalid")}}N(Hn,"geometry");function Ue(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ce(t[0])||!Ce(t[1]))throw new Error("coordinates must contain numbers");return me({type:"Point",coordinates:t},e,n)}N(Ue,"point");function Rn(t,e,n={}){return Je(t.map(r=>Ue(r,e)),n)}N(Rn,"points");function ot(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return me({type:"Polygon",coordinates:t},e,n)}N(ot,"polygon");function Un(t,e,n={}){return Je(t.map(r=>ot(r,e)),n)}N(Un,"polygons");function it(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return me({type:"LineString",coordinates:t},e,n)}N(it,"lineString");function Jn(t,e,n={}){return Je(t.map(r=>it(r,e)),n)}N(Jn,"lineStrings");function Je(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}N(Je,"featureCollection");function Ut(t,e,n={}){return me({type:"MultiLineString",coordinates:t},e,n)}N(Ut,"multiLineString");function Jt(t,e,n={}){return me({type:"MultiPoint",coordinates:t},e,n)}N(Jt,"multiPoint");function Wt(t,e,n={}){return me({type:"MultiPolygon",coordinates:t},e,n)}N(Wt,"multiPolygon");function Wn(t,e,n={}){return me({type:"GeometryCollection",geometries:t},e,n)}N(Wn,"geometryCollection");function Vn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}N(Vn,"round");function Vt(t,e="kilometers"){const n=Rt[e];if(!n)throw new Error(e+" units is invalid");return t*n}N(Vt,"radiansToLength");function We(t,e="kilometers"){const n=Rt[e];if(!n)throw new Error(e+" units is invalid");return t/n}N(We,"lengthToRadians");function Xn(t,e){return Ne(We(t,e))}N(Xn,"lengthToDegrees");function Kn(t){let e=t%360;return e<0&&(e+=360),e}N(Kn,"bearingToAzimuth");function Ne(t){return t%(2*Math.PI)*180/Math.PI}N(Ne,"radiansToDegrees");function qe(t){return t%360*Math.PI/180}N(qe,"degreesToRadians");function Zn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Vt(We(t,e),n)}N(Zn,"convertLength");function Qn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Et[e];if(!r)throw new Error("invalid original units");const o=Et[n];if(!o)throw new Error("invalid final units");return t/r*o}N(Qn,"convertArea");function Ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}N(Ce,"isNumber");function Yn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}N(Yn,"isObject");function xn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ce(e))throw new Error("bbox must only contain numbers")})}N(xn,"validateBBox");function er(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}N(er,"validateId");var tr=Object.defineProperty,ge=(t,e)=>tr(t,"name",{value:e,configurable:!0});function Xt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ge(Xt,"getCoord");function nr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ge(nr,"getCoords");function Kt(t){if(t.length>1&&Ce(t[0])&&Ce(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Kt(t[0]);throw new Error("coordinates must only contain numbers")}ge(Kt,"containsNumber");function rr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ge(rr,"geojsonType");function or(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ge(or,"featureOf");function ir(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ge(ir,"collectionOf");function lr(t){return t.type==="Feature"?t.geometry:t}ge(lr,"getGeom");function ar(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ge(ar,"getType");var sr=Object.defineProperty,ur=(t,e)=>sr(t,"name",{value:e,configurable:!0});function Zt(t,e,n,r={}){const o=Xt(t),l=qe(o[0]),i=qe(o[1]),a=qe(n),s=We(e,r.units),f=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),h=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(f)),u=Ne(h),m=Ne(f);return Ue([u,m],r.properties)}ur(Zt,"destination");var fr=Zt,cr=Object.defineProperty,z=(t,e)=>cr(t,"name",{value:e,configurable:!0}),mr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Te(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=et(e),o=et(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Te(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Te(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?zt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Te(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};z(mr,"GeojsonEquality");function Te(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}z(Te,"sameLength");function et(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}z(et,"explode");var x=63710088e-1,Qt={centimeters:x*100,centimetres:x*100,degrees:360/(2*Math.PI),feet:x*3.28084,inches:x*39.37,kilometers:x/1e3,kilometres:x/1e3,meters:x,metres:x,miles:x/1609.344,millimeters:x*1e3,millimetres:x*1e3,nauticalmiles:x/1852,radians:1,yards:x*1.0936},Lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function he(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}z(he,"feature");function gr(t,e,n={}){switch(t){case"Point":return lt(e).geometry;case"LineString":return st(e).geometry;case"Polygon":return at(e).geometry;case"MultiPoint":return xt(e).geometry;case"MultiLineString":return Yt(e).geometry;case"MultiPolygon":return en(e).geometry;default:throw new Error(t+" is invalid")}}z(gr,"geometry");function lt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Me(t[0])||!Me(t[1]))throw new Error("coordinates must contain numbers");return he({type:"Point",coordinates:t},e,n)}z(lt,"point");function hr(t,e,n={}){return Ve(t.map(r=>lt(r,e)),n)}z(hr,"points");function at(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return he({type:"Polygon",coordinates:t},e,n)}z(at,"polygon");function pr(t,e,n={}){return Ve(t.map(r=>at(r,e)),n)}z(pr,"polygons");function st(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return he({type:"LineString",coordinates:t},e,n)}z(st,"lineString");function dr(t,e,n={}){return Ve(t.map(r=>st(r,e)),n)}z(dr,"lineStrings");function Ve(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}z(Ve,"featureCollection");function Yt(t,e,n={}){return he({type:"MultiLineString",coordinates:t},e,n)}z(Yt,"multiLineString");function xt(t,e,n={}){return he({type:"MultiPoint",coordinates:t},e,n)}z(xt,"multiPoint");function en(t,e,n={}){return he({type:"MultiPolygon",coordinates:t},e,n)}z(en,"multiPolygon");function _r(t,e,n={}){return he({type:"GeometryCollection",geometries:t},e,n)}z(_r,"geometryCollection");function yr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}z(yr,"round");function tn(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t*n}z(tn,"radiansToLength");function ut(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t/n}z(ut,"lengthToRadians");function br(t,e){return ft(ut(t,e))}z(br,"lengthToDegrees");function vr(t){let e=t%360;return e<0&&(e+=360),e}z(vr,"bearingToAzimuth");function ft(t){return t%(2*Math.PI)*180/Math.PI}z(ft,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}z(Oe,"degreesToRadians");function wr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return tn(ut(t,e),n)}z(wr,"convertLength");function kr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Lt[e];if(!r)throw new Error("invalid original units");const o=Lt[n];if(!o)throw new Error("invalid final units");return t/r*o}z(kr,"convertArea");function Me(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}z(Me,"isNumber");function jr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}z(jr,"isObject");function Er(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Me(e))throw new Error("bbox must only contain numbers")})}z(Er,"validateBBox");function Lr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}z(Lr,"validateId");var Cr=Object.defineProperty,pe=(t,e)=>Cr(t,"name",{value:e,configurable:!0});function tt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}pe(tt,"getCoord");function Mr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}pe(Mr,"getCoords");function nn(t){if(t.length>1&&Me(t[0])&&Me(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return nn(t[0]);throw new Error("coordinates must only contain numbers")}pe(nn,"containsNumber");function Pr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}pe(Pr,"geojsonType");function Ir(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}pe(Ir,"featureOf");function Tr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}pe(Tr,"collectionOf");function Or(t){return t.type==="Feature"?t.geometry:t}pe(Or,"getGeom");function Ar(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}pe(Ar,"getType");var Sr=Object.defineProperty,rn=(t,e)=>Sr(t,"name",{value:e,configurable:!0});function ct(t,e,n={}){if(n.final===!0)return on(t,e);const r=tt(t),o=tt(e),l=Oe(r[0]),i=Oe(o[0]),a=Oe(r[1]),s=Oe(o[1]),f=Math.sin(i-l)*Math.cos(s),h=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ft(Math.atan2(f,h))}rn(ct,"bearing");function on(t,e){let n=ct(e,t);return n=(n+180)%360,n}rn(on,"calculateFinalBearing");var Fr=ct;function $r(t){let e,n,r,o,l,i,a,s,f,h,u,m;function d(g){t[6](g)}let p={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(p.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new qt({props:p}),ee.push(()=>ie(e,"value",d));function y(g){t[7](g)}let b={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(b.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new bt({props:b}),ee.push(()=>ie(o,"value",y));function q(g){t[8](g)}let O={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(O.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new bt({props:O}),ee.push(()=>ie(a,"value",q));function T(g){t[9](g)}let D={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(D.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),h=new Dt({props:D}),ee.push(()=>ie(h,"value",T)),{c(){A(e.$$.fragment),r=H(),A(o.$$.fragment),i=H(),A(a.$$.fragment),f=H(),A(h.$$.fragment)},l(g){S(e.$$.fragment,g),r=R(g),S(o.$$.fragment,g),i=R(g),S(a.$$.fragment,g),f=R(g),S(h.$$.fragment,g)},m(g,j){F(e,g,j),P(g,r,j),F(o,g,j),P(g,i,j),F(a,g,j),P(g,f,j),F(h,g,j),m=!0},p(g,[j]){const c={};!n&&j&15&&(n=!0,c.value=g[3].jat[g[0]][g[1]].movements[g[2]].name,oe(()=>n=!1)),e.$set(c);const M={};!l&&j&15&&(l=!0,M.value=g[3].jat[g[0]][g[1]].movements[g[2]].kind,oe(()=>l=!1)),o.$set(M);const I={};!s&&j&15&&(s=!0,I.value=g[3].jat[g[0]][g[1]].movements[g[2]].score,oe(()=>s=!1)),a.$set(I);const B={};!u&&j&15&&(u=!0,B.value=g[3].jat[g[0]][g[1]].movements[g[2]].notes,oe(()=>u=!1)),h.$set(B)},i(g){m||(k(e.$$.fragment,g),k(o.$$.fragment,g),k(a.$$.fragment,g),k(h.$$.fragment,g),m=!0)},o(g){E(e.$$.fragment,g),E(o.$$.fragment,g),E(a.$$.fragment,g),E(h.$$.fragment,g),m=!1},d(g){g&&(v(r),v(i),v(f)),$(e,g),$(o,g),$(a,g),$(h,g)}}}function Br(t,e,n){let r;de(t,K,d=>n(3,r=d));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=jn(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function f(d){t.$$.not_equal(r.jat[o][l].movements[i].name,d)&&(r.jat[o][l].movements[i].name=d,K.set(r))}function h(d){t.$$.not_equal(r.jat[o][l].movements[i].kind,d)&&(r.jat[o][l].movements[i].kind=d,K.set(r))}function u(d){t.$$.not_equal(r.jat[o][l].movements[i].score,d)&&(r.jat[o][l].movements[i].score=d,K.set(r))}function m(d){t.$$.not_equal(r.jat[o][l].movements[i].notes,d)&&(r.jat[o][l].movements[i].notes=d,K.set(r))}return t.$$set=d=>{"junctionIdx"in d&&n(0,o=d.junctionIdx),"stage"in d&&n(1,l=d.stage),"idx"in d&&n(2,i=d.idx)},[o,l,i,r,a,s,f,h,u,m]}class qr extends be{constructor(e){super(),ve(this,e,Br,$r,ye,{junctionIdx:0,stage:1,idx:2})}}const{window:Gr}=dn;function Ct(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function Mt(t,e,n){const r=t.slice();return r[34]=e[n],r[36]=n,r}function Nr(t){let e,n,r,o,l,i;return e=new _n({props:{$$slots:{default:[Dr]},$$scope:{ctx:t}}}),e.$on("click",t[21]),r=new Bt({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),r.$on("click",t[12]),l=new qr({props:{junctionIdx:t[0],stage:t[1],idx:t[2]}}),{c(){A(e.$$.fragment),n=H(),A(r.$$.fragment),o=H(),A(l.$$.fragment)},l(a){S(e.$$.fragment,a),n=R(a),S(r.$$.fragment,a),o=R(a),S(l.$$.fragment,a)},m(a,s){F(e,a,s),P(a,n,s),F(r,a,s),P(a,o,s),F(l,a,s),i=!0},p(a,s){const f={};s[1]&128&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const h={};s[1]&128&&(h.$$scope={dirty:s,ctx:a}),r.$set(h);const u={};s[0]&1&&(u.junctionIdx=a[0]),s[0]&2&&(u.stage=a[1]),s[0]&4&&(u.idx=a[2]),l.$set(u)},i(a){i||(k(e.$$.fragment,a),k(r.$$.fragment,a),k(l.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(l.$$.fragment,a),i=!1},d(a){a&&(v(n),v(o)),$(e,a),$(r,a),$(l,a)}}}function zr(t){let e,n,r,o,l,i,a,s,f="Movements",h,u,m,d,p,y=Ot(t[4].jat[t[0]][t[1]])+"",b,q,O;e=new ue({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new bn({}),l=new vn({});let T=t[5]&&Pt(t),D=Le(t[4].jat[t[0]][t[1]].movements),g=[];for(let c=0;c<D.length;c+=1)g[c]=It(Mt(t,D,c));const j=c=>E(g[c],1,1,()=>{g[c]=null});return{c(){A(e.$$.fragment),n=H(),A(r.$$.fragment),o=H(),A(l.$$.fragment),i=H(),T&&T.c(),a=H(),s=Z("h3"),s.textContent=f,h=H(),u=Z("ol");for(let c=0;c<g.length;c+=1)g[c].c();m=H(),d=Z("p"),p=W("Total JAT score: "),b=W(y),q=W("%")},l(c){S(e.$$.fragment,c),n=R(c),S(r.$$.fragment,c),o=R(c),S(l.$$.fragment,c),i=R(c),T&&T.l(c),a=R(c),s=Q(c,"H3",{"data-svelte-h":!0}),cn(s)!=="svelte-1dc52s8"&&(s.textContent=f),h=R(c),u=Q(c,"OL",{});var M=te(u);for(let B=0;B<g.length;B+=1)g[B].l(M);M.forEach(v),m=R(c),d=Q(c,"P",{});var I=te(d);p=V(I,"Total JAT score: "),b=V(I,y),q=V(I,"%"),I.forEach(v)},m(c,M){F(e,c,M),P(c,n,M),F(r,c,M),P(c,o,M),F(l,c,M),P(c,i,M),T&&T.m(c,M),P(c,a,M),P(c,s,M),P(c,h,M),P(c,u,M);for(let I=0;I<g.length;I+=1)g[I]&&g[I].m(u,null);P(c,m,M),P(c,d,M),ae(d,p),ae(d,b),ae(d,q),O=!0},p(c,M){const I={};if(M[1]&128&&(I.$$scope={dirty:M,ctx:c}),e.$set(I),c[5]?T?(T.p(c,M),M[0]&32&&k(T,1)):(T=Pt(c),T.c(),k(T,1),T.m(a.parentNode,a)):T&&(fe(),E(T,1,1,()=>{T=null}),ce()),M[0]&539){D=Le(c[4].jat[c[0]][c[1]].movements);let B;for(B=0;B<D.length;B+=1){const L=Mt(c,D,B);g[B]?(g[B].p(L,M),k(g[B],1)):(g[B]=It(L),g[B].c(),k(g[B],1),g[B].m(u,null))}for(fe(),B=D.length;B<g.length;B+=1)j(B);ce()}(!O||M[0]&19)&&y!==(y=Ot(c[4].jat[c[0]][c[1]])+"")&&_e(b,y)},i(c){if(!O){k(e.$$.fragment,c),k(r.$$.fragment,c),k(l.$$.fragment,c),k(T);for(let M=0;M<D.length;M+=1)k(g[M]);O=!0}},o(c){E(e.$$.fragment,c),E(r.$$.fragment,c),E(l.$$.fragment,c),E(T),g=g.filter(Boolean);for(let M=0;M<g.length;M+=1)E(g[M]);O=!1},d(c){c&&(v(n),v(o),v(i),v(a),v(s),v(h),v(u),v(m),v(d)),$(e,c),$(r,c),$(l,c),T&&T.d(c),rt(g,c)}}}function Dr(t){let e;return{c(){e=W("Save")},l(n){e=V(n,"Save")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function Hr(t){let e;return{c(){e=W("Delete")},l(n){e=V(n,"Delete")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function Rr(t){let e;return{c(){e=W("Zoom to fit")},l(n){e=V(n,"Zoom to fit")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function Pt(t){let e,n,r;function o(i){t[17](i)}let l={map:t[5]};return t[6]!==void 0&&(l.enabled=t[6]),e=new wn({props:l}),ee.push(()=>ie(e,"enabled",o)),{c(){A(e.$$.fragment)},l(i){S(e.$$.fragment,i)},m(i,a){F(e,i,a),r=!0},p(i,a){const s={};a[0]&32&&(s.map=i[5]),!n&&a[0]&64&&(n=!0,s.enabled=i[6],oe(()=>n=!1)),e.$set(s)},i(i){r||(k(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){$(e,i)}}}function Ur(t){let e=(t[34].name||"Unnamed movement")+"",n;return{c(){n=W(e)},l(r){n=V(r,e)},m(r,o){P(r,n,o)},p(r,o){o[0]&19&&e!==(e=(r[34].name||"Unnamed movement")+"")&&_e(n,e)},d(r){r&&v(n)}}}function It(t){let e,n,r,o;function l(){return t[18](t[36])}function i(){return t[19](t[36])}return n=new ue({props:{$$slots:{default:[Ur]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[20]),{c(){e=Z("li"),A(n.$$.fragment),r=H()},l(a){e=Q(a,"LI",{});var s=te(e);S(n.$$.fragment,s),r=R(s),s.forEach(v)},m(a,s){P(a,e,s),F(n,e,null),ae(e,r),o=!0},p(a,s){t=a;const f={};s[0]&19|s[1]&128&&(f.$$scope={dirty:s,ctx:t}),n.$set(f)},i(a){o||(k(n.$$.fragment,a),o=!0)},o(a){E(n.$$.fragment,a),o=!1},d(a){a&&v(e),$(n)}}}function Jr(t){let e,n;return{c(){e=Z("span"),this.h()},l(r){e=Q(r,"SPAN",{class:!0,style:!0}),te(e).forEach(v),this.h()},h(){Ae(e,"class","dot svelte-1kvjd2"),Ae(e,"style",n=`background-color: ${t[8][t[34].score]}`),ne(e,"opacity",t[34].kind=="pedestrian"?"0%":"100%")},m(r,o){P(r,e,o)},p(r,o){o[0]&19&&n!==(n=`background-color: ${r[8][r[34].score]}`)&&Ae(e,"style",n);const l=o[0]&19;(o[0]&19||l)&&ne(e,"opacity",r[34].kind=="pedestrian"?"0%":"100%")},d(r){r&&v(e)}}}function Wr(t){let e;return{c(){e=Z("span"),this.h()},l(n){e=Q(n,"SPAN",{class:!0}),te(e).forEach(v),this.h()},h(){Ae(e,"class","dot svelte-1kvjd2"),ne(e,"background-color",t[8][t[34].score]),ne(e,"opacity","0%")},m(n,r){P(n,e,r)},p(n,r){r[0]&19&&ne(e,"background-color",n[8][n[34].score])},d(n){n&&v(e)}}}function Tt(t){let e,n,r,o,l,i;function a(y){t[22](y,t[34])}function s(){return t[23](t[36])}function f(){return t[24](t[36])}let h={draggable:!0,$$slots:{default:[Jr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(h.lngLat=t[34].point1),e=new yt({props:h}),ee.push(()=>ie(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",f);function u(y){t[25](y,t[34])}function m(){return t[26](t[36])}function d(){return t[27](t[36])}let p={draggable:!0,$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[34].point2!==void 0&&(p.lngLat=t[34].point2),o=new yt({props:p}),ee.push(()=>ie(o,"lngLat",u)),o.$on("dragend",m),o.$on("click",d),{c(){A(e.$$.fragment),r=H(),A(o.$$.fragment)},l(y){S(e.$$.fragment,y),r=R(y),S(o.$$.fragment,y)},m(y,b){F(e,y,b),P(y,r,b),F(o,y,b),i=!0},p(y,b){t=y;const q={};b[0]&19|b[1]&128&&(q.$$scope={dirty:b,ctx:t}),!n&&b[0]&19&&(n=!0,q.lngLat=t[34].point1,oe(()=>n=!1)),e.$set(q);const O={};b[0]&19|b[1]&128&&(O.$$scope={dirty:b,ctx:t}),!l&&b[0]&19&&(l=!0,O.lngLat=t[34].point2,oe(()=>l=!1)),o.$set(O)},i(y){i||(k(e.$$.fragment,y),k(o.$$.fragment,y),i=!0)},o(y){E(e.$$.fragment,y),E(o.$$.fragment,y),i=!1},d(y){y&&v(r),$(e,y),$(o,y)}}}function Vr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=W(e)},l(r){n=V(r,e)},m(r,o){P(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&_e(n,e)},d(r){r&&v(n)}}}function Xr(t){let e,n;return e=new Ht({props:{$$slots:{default:[Vr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&132&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){$(e,r)}}}function Kr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=W(e)},l(r){n=V(r,e)},m(r,o){P(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&_e(n,e)},d(r){r&&v(n)}}}function Zr(t){let e,n;return e=new Ht({props:{$$slots:{default:[Kr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p(r,o){const l={};o[1]&132&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){$(e,r)}}}function Qr(t){let e,n,r,o,l,i;return e=new Ye({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":_t(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Xr]},$$scope:{ctx:t}}}),e.$on("click",t[10]),r=new Ye({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":_t(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Zr]},$$scope:{ctx:t}}}),r.$on("click",t[10]),l=new Fn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){A(e.$$.fragment),n=H(),A(r.$$.fragment),o=H(),A(l.$$.fragment)},l(a){S(e.$$.fragment,a),n=R(a),S(r.$$.fragment,a),o=R(a),S(l.$$.fragment,a)},m(a,s){F(e,a,s),P(a,n,s),F(r,a,s),P(a,o,s),F(l,a,s),i=!0},p(a,s){const f={};s[1]&128&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const h={};s[1]&128&&(h.$$scope={dirty:s,ctx:a}),r.$set(h)},i(a){i||(k(e.$$.fragment,a),k(r.$$.fragment,a),k(l.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(l.$$.fragment,a),i=!1},d(a){a&&(v(n),v(o)),$(e,a),$(r,a),$(l,a)}}}function Yr(t){let e,n;return e=new Ye({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){F(e,r,o),n=!0},p:mn,i(r){n||(k(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){$(e,r)}}}function xr(t){let e,n,r,o,l,i,a,s=Le(t[4].jat[t[0]][t[1]].movements),f=[];for(let u=0;u<s.length;u+=1)f[u]=Tt(Ct(t,s,u));const h=u=>E(f[u],1,1,()=>{f[u]=null});return n=new dt({props:{data:t[11](t[4].jat[t[0]][t[1]].movements),$$slots:{default:[Qr]},$$scope:{ctx:t}}}),o=new dt({props:{data:t[7],$$slots:{default:[Yr]},$$scope:{ctx:t}}}),i=new kn({props:{map:t[5]}}),{c(){for(let u=0;u<f.length;u+=1)f[u].c();e=H(),A(n.$$.fragment),r=H(),A(o.$$.fragment),l=H(),A(i.$$.fragment)},l(u){for(let m=0;m<f.length;m+=1)f[m].l(u);e=R(u),S(n.$$.fragment,u),r=R(u),S(o.$$.fragment,u),l=R(u),S(i.$$.fragment,u)},m(u,m){for(let d=0;d<f.length;d+=1)f[d]&&f[d].m(u,m);P(u,e,m),F(n,u,m),P(u,r,m),F(o,u,m),P(u,l,m),F(i,u,m),a=!0},p(u,m){if(m[0]&787){s=Le(u[4].jat[u[0]][u[1]].movements);let b;for(b=0;b<s.length;b+=1){const q=Ct(u,s,b);f[b]?(f[b].p(q,m),k(f[b],1)):(f[b]=Tt(q),f[b].c(),k(f[b],1),f[b].m(e.parentNode,e))}for(fe(),b=s.length;b<f.length;b+=1)h(b);ce()}const d={};m[0]&19&&(d.data=u[11](u[4].jat[u[0]][u[1]].movements)),m[1]&128&&(d.$$scope={dirty:m,ctx:u}),n.$set(d);const p={};m[0]&128&&(p.data=u[7]),m[1]&128&&(p.$$scope={dirty:m,ctx:u}),o.$set(p);const y={};m[0]&32&&(y.map=u[5]),i.$set(y)},i(u){if(!a){for(let m=0;m<s.length;m+=1)k(f[m]);k(n.$$.fragment,u),k(o.$$.fragment,u),k(i.$$.fragment,u),a=!0}},o(u){f=f.filter(Boolean);for(let m=0;m<f.length;m+=1)E(f[m]);E(n.$$.fragment,u),E(o.$$.fragment,u),E(i.$$.fragment,u),a=!1},d(u){u&&(v(e),v(r),v(l)),rt(f,u),$(n,u),$(o,u),$(i,u)}}}function eo(t){let e,n,r,o,l,i,a,s,f,h,u,m,d,p;function y(j){t[15](j)}let b={label:"Commentary / Notes"};t[4].jat[t[0]][t[1]].notes!==void 0&&(b.value=t[4].jat[t[0]][t[1]].notes),e=new Dt({props:b}),ee.push(()=>ie(e,"value",y));const q=[zr,Nr],O=[];function T(j,c){return j[2]==null?0:1}i=T(t),a=O[i]=q[i](t);function D(j){t[28](j)}let g={$$slots:{default:[xr]},$$scope:{ctx:t}};return t[5]!==void 0&&(g.map=t[5]),h=new pn({props:g}),ee.push(()=>ie(h,"map",D)),{c(){A(e.$$.fragment),r=H(),o=Z("div"),l=Z("div"),a.c(),s=H(),f=Z("div"),A(h.$$.fragment),this.h()},l(j){S(e.$$.fragment,j),r=R(j),o=Q(j,"DIV",{style:!0});var c=te(o);l=Q(c,"DIV",{style:!0});var M=te(l);a.l(M),M.forEach(v),s=R(c),f=Q(c,"DIV",{style:!0});var I=te(f);S(h.$$.fragment,I),I.forEach(v),c.forEach(v),this.h()},h(){ne(l,"width","30%"),ne(l,"overflow-y","scroll"),ne(l,"padding","10px"),ne(f,"position","relative"),ne(f,"width","100%"),ne(o,"display","flex"),ne(o,"height","80vh")},m(j,c){F(e,j,c),P(j,r,c),P(j,o,c),ae(o,l),O[i].m(l,null),ae(o,s),ae(o,f),F(h,f,null),m=!0,d||(p=fn(Gr,"keydown",t[14]),d=!0)},p(j,c){const M={};!n&&c[0]&19&&(n=!0,M.value=j[4].jat[j[0]][j[1]].notes,oe(()=>n=!1)),e.$set(M);let I=i;i=T(j),i===I?O[i].p(j,c):(fe(),E(O[I],1,1,()=>{O[I]=null}),ce(),a=O[i],a?a.p(j,c):(a=O[i]=q[i](j),a.c()),k(a,1),a.m(l,null));const B={};c[0]&179|c[1]&128&&(B.$$scope={dirty:c,ctx:j}),!u&&c[0]&32&&(u=!0,B.map=j[5],oe(()=>u=!1)),h.$set(B)},i(j){m||(k(e.$$.fragment,j),k(a),k(h.$$.fragment,j),m=!0)},o(j){E(e.$$.fragment,j),E(a),E(h.$$.fragment,j),m=!1},d(j){j&&(v(r),v(o)),$(e,j),O[i].d(),$(h),d=!1,p()}}}function Ot(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function to(t,e,n){let r,o;de(t,K,w=>n(4,o=w));let{junctionIdx:l}=e,{stage:i}=e,a,s=null,f=null,h=!1,u={0:$e.red.background,1:$e.amber.background,2:$e.green.background,X:$e.critical.background};function m(w,U,J){let X={type:"FeatureCollection",features:[]},le=U??J;return le!=null&&X.features.push(q(w.jat[l][i].movements[le],le)),X}function d(w){n(2,s=w),n(3,f=null)}function p(w){if(!h){for(let U of a.queryRenderedFeatures(w.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(s!=null){n(2,s=null);return}nt(K,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:w.lngLat.toArray(),point2:fr(w.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(2,s=o.jat[l][i].movements.length-1),n(3,f=null)}}function y(w){d(w.detail.features[0].id)}Ft(()=>{a.on("click",p),D(!1)}),$t(()=>{a.off("click",p)});function b(w){let U={type:"FeatureCollection",features:w.map((J,X)=>q(J,X))};for(let J of w)if(U.features.push(O(J,U.features.length)),J.kind=="pedestrian"){let X={...J,point1:J.point2,point2:J.point1};U.features.push(O(X,U.features.length))}return U}function q(w,U){return{type:"Feature",id:U,properties:{name:w.name,kind:w.kind,color:u[w.score]},geometry:{type:"LineString",coordinates:[w.point1,w.point2]}}}function O(w,U){return{type:"Feature",id:U,properties:{kind:w.kind,color:u[w.score],angle:Fr(w.point1,w.point2)},geometry:{type:"Point",coordinates:w.point2}}}function T(){window.confirm("Delete this movement?")&&(o.jat[l][i].movements.splice(s,1),K.set(o),n(2,s=null))}function D(w){o.jat[l][i].movements.length>0&&a.fitBounds(yn(b(o.jat[l][i].movements)),{padding:20,animate:w})}function g(w){s!=null&&w.key=="Escape"?(w.stopPropagation(),n(2,s=null)):s!=null&&w.key=="Delete"&&T()}function j(w){t.$$.not_equal(o.jat[l][i].notes,w)&&(o.jat[l][i].notes=w,K.set(o))}const c=()=>D(!0);function M(w){h=w,n(6,h)}const I=w=>d(w),B=w=>n(3,f=w),L=()=>n(3,f=null),C=()=>n(2,s=null);function we(w,U){t.$$.not_equal(U.point1,w)&&(U.point1=w,K.set(o))}const Se=w=>d(w),Xe=w=>d(w);function Ke(w,U){t.$$.not_equal(U.point2,w)&&(U.point2=w,K.set(o))}const G=w=>d(w),ke=w=>d(w);function se(w){a=w,n(5,a)}return t.$$set=w=>{"junctionIdx"in w&&n(0,l=w.junctionIdx),"stage"in w&&n(1,i=w.stage)},t.$$.update=()=>{t.$$.dirty[0]&28&&n(7,r=m(o,s,f))},[l,i,s,f,o,a,h,r,u,d,y,b,T,D,g,j,c,M,I,B,L,C,we,Se,Xe,Ke,G,ke,se]}class no extends be{constructor(e){super(),ve(this,e,to,eo,ye,{junctionIdx:0,stage:1},null,[-1,-1])}}function At(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function ro(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,f,h,u;return s=new ue({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),s.$on("click",t[10]),h=new no({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=Z("h2"),r=W(n),o=W(" - "),i=W(l),a=H(),A(s.$$.fragment),f=H(),A(h.$$.fragment)},l(m){e=Q(m,"H2",{});var d=te(e);r=V(d,n),o=V(d," - "),i=V(d,l),d.forEach(v),a=R(m),S(s.$$.fragment,m),f=R(m),S(h.$$.fragment,m)},m(m,d){P(m,e,d),ae(e,r),ae(e,o),ae(e,i),P(m,a,d),F(s,m,d),P(m,f,d),F(h,m,d),u=!0},p(m,d){(!u||d&3)&&n!==(n=(m[1].jat[m[0].idx].name||"Untitled junction")+"")&&_e(r,n),(!u||d&1)&&l!==(l=m[0].stage+"")&&_e(i,l);const p={};d&16384&&(p.$$scope={dirty:d,ctx:m}),s.$set(p);const y={};d&1&&(y.junctionIdx=m[0].idx),d&1&&(y.stage=m[0].stage),h.$set(y)},i(m){u||(k(s.$$.fragment,m),k(h.$$.fragment,m),u=!0)},o(m){E(s.$$.fragment,m),E(h.$$.fragment,m),u=!1},d(m){m&&(v(e),v(a),v(f)),$(s,m),$(h,m)}}}function oo(t){let e,n,r,o,l,i,a,s,f,h,u;e=new ue({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new Bt({props:{$$slots:{default:[so]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function m(p){t[7](p)}let d={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(d.value=t[1].jat[t[0].idx].name),l=new qt({props:d}),ee.push(()=>ie(l,"value",m)),s=new ue({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),s.$on("click",t[8]),h=new ue({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),h.$on("click",t[9]),{c(){A(e.$$.fragment),n=H(),A(r.$$.fragment),o=H(),A(l.$$.fragment),a=H(),A(s.$$.fragment),f=H(),A(h.$$.fragment)},l(p){S(e.$$.fragment,p),n=R(p),S(r.$$.fragment,p),o=R(p),S(l.$$.fragment,p),a=R(p),S(s.$$.fragment,p),f=R(p),S(h.$$.fragment,p)},m(p,y){F(e,p,y),P(p,n,y),F(r,p,y),P(p,o,y),F(l,p,y),P(p,a,y),F(s,p,y),P(p,f,y),F(h,p,y),u=!0},p(p,y){const b={};y&16384&&(b.$$scope={dirty:y,ctx:p}),e.$set(b);const q={};y&16384&&(q.$$scope={dirty:y,ctx:p}),r.$set(q);const O={};!i&&y&3&&(i=!0,O.value=p[1].jat[p[0].idx].name,oe(()=>i=!1)),l.$set(O);const T={};y&16384&&(T.$$scope={dirty:y,ctx:p}),s.$set(T);const D={};y&16384&&(D.$$scope={dirty:y,ctx:p}),h.$set(D)},i(p){u||(k(e.$$.fragment,p),k(r.$$.fragment,p),k(l.$$.fragment,p),k(s.$$.fragment,p),k(h.$$.fragment,p),u=!0)},o(p){E(e.$$.fragment,p),E(r.$$.fragment,p),E(l.$$.fragment,p),E(s.$$.fragment,p),E(h.$$.fragment,p),u=!1},d(p){p&&(v(n),v(o),v(a),v(f)),$(e,p),$(r,p),$(l,p),$(s,p),$(h,p)}}}function io(t){let e,n,r,o;e=new ue({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=Le(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=St(At(t,l,s));const a=s=>E(i[s],1,1,()=>{i[s]=null});return{c(){A(e.$$.fragment),n=H(),r=Z("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){S(e.$$.fragment,s),n=R(s),r=Q(s,"OL",{});var f=te(r);for(let h=0;h<i.length;h+=1)i[h].l(f);f.forEach(v)},m(s,f){F(e,s,f),P(s,n,f),P(s,r,f);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(r,null);o=!0},p(s,f){const h={};if(f&16384&&(h.$$scope={dirty:f,ctx:s}),e.$set(h),f&3){l=Le(s[1].jat);let u;for(u=0;u<l.length;u+=1){const m=At(s,l,u);i[u]?(i[u].p(m,f),k(i[u],1)):(i[u]=St(m),i[u].c(),k(i[u],1),i[u].m(r,null))}for(fe(),u=l.length;u<i.length;u+=1)a(u);ce()}},i(s){if(!o){k(e.$$.fragment,s);for(let f=0;f<l.length;f+=1)k(i[f]);o=!0}},o(s){E(e.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)E(i[f]);o=!1},d(s){s&&(v(n),v(r)),$(e,s),rt(i,s)}}}function lo(t){let e;return{c(){e=W("Back")},l(n){e=V(n,"Back")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function ao(t){let e;return{c(){e=W("Back to all junctions")},l(n){e=V(n,"Back to all junctions")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function so(t){let e;return{c(){e=W("Delete")},l(n){e=V(n,"Delete")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function uo(t){let e;return{c(){e=W("Existing")},l(n){e=V(n,"Existing")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function fo(t){let e;return{c(){e=W("Proposed")},l(n){e=V(n,"Proposed")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function co(t){let e;return{c(){e=W("Add new junction")},l(n){e=V(n,"Add new junction")},m(n,r){P(n,e,r)},d(n){n&&v(e)}}}function mo(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=W(e)},l(r){n=V(r,e)},m(r,o){P(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&_e(n,e)},d(r){r&&v(n)}}}function St(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new ue({props:{$$slots:{default:[mo]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=Z("li"),A(n.$$.fragment),r=H()},l(i){e=Q(i,"LI",{});var a=te(e);S(n.$$.fragment,a),r=R(a),a.forEach(v)},m(i,a){P(i,e,a),F(n,e,null),ae(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(k(n.$$.fragment,i),o=!0)},o(i){E(n.$$.fragment,i),o=!1},d(i){i&&v(e),$(n)}}}function go(t){let e,n,r,o;const l=[io,oo,ro],i=[];function a(s,f){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=Ge()},l(s){n&&n.l(s),r=Ge()},m(s,f){~e&&i[e].m(s,f),P(s,r,f),o=!0},p(s,[f]){let h=e;e=a(s),e===h?~e&&i[e].p(s,f):(n&&(fe(),E(i[h],1,1,()=>{i[h]=null}),ce()),~e?(n=i[e],n?n.p(s,f):(n=i[e]=l[e](s),n.c()),k(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(k(n),o=!0)},o(s){E(n),o=!1},d(s){s&&v(r),~e&&i[e].d(s)}}}function Be(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function ho(t,e,n){let r;de(t,K,p=>n(1,r=p));let o={kind:"list"};function l(){nt(K,r.jat=[...r.jat,{name:"",existing:{movements:[],notes:""},proposed:{movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(p){window.confirm("Delete this junction?")&&(r.jat.splice(p,1),K.set(r),n(0,o={kind:"list"}))}const a=p=>n(0,o={kind:"junction",idx:p}),s=()=>n(0,o={kind:"list"}),f=()=>i(Be(o));function h(p){t.$$.not_equal(r.jat[o.idx].name,p)&&(r.jat[o.idx].name=p,K.set(r))}return[o,r,l,i,a,s,f,h,()=>n(0,o={kind:"map",idx:Be(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:Be(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:Be(o)})]}class Oo extends be{constructor(e){super(),ve(this,e,ho,go,ye,{})}}export{Oo as component};
