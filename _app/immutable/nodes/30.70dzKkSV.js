import{s as Q,a7 as Ee,U as x,a8 as be,A as V,a as B,g as S,i as b,B as O,f as _,k as ee,t as M,d as T,j as H,M as Ie,e as j,c as F,b as R,v as U,h as A,r as Le,p as De,n as J,E as ce,q as ke}from"../chunks/scheduler.DGmwKwHE.js";import{S as X,i as Z,f as G,c as w,a as C,m as E,t as h,g as K,b as v,e as Y,d as L}from"../chunks/index.Bb3HzqPI.js";import{e as z}from"../chunks/each.5Jij472k.js";import{p as Ae}from"../chunks/index.C4KBgqaI.js";import{S as Be,W as Se}from"../chunks/WarningButton.CmTmvDGe.js";import{S as ue}from"../chunks/Select.BxvsumuS.js";import{T as Ne}from"../chunks/TextArea.Ce4ExrTL.js";import{T as Me}from"../chunks/TextInput.BGWXu-yq.js";import{s as N}from"../chunks/data.jv7RfCIS.js";import{Y as Te}from"../chunks/YesNo.CmhzPwQt.js";import{D as Pe}from"../chunks/DefaultButton.Ba2CVFhD.js";import{m as fe,M as We,G as qe}from"../chunks/MapLibreMap.CCDcaP99.js";import{C as je}from"../chunks/CircleLayer.DYhwg6Sf.js";function Fe(n,t,i){let e=Ee(),{map:s}=t,{position:r}=t,u=null;return x(()=>{u=new fe.Marker({draggable:!0}).setLngLat(new fe.LngLat(r[0],r[1])).addTo(s),u.on("dragstart",()=>{s.getCanvas().style.cursor="grabbing"}),u.on("drag",()=>{i(0,r=u.getLngLat().toArray())}),u.on("dragend",()=>{s.getCanvas().style.cursor="inherit",e("dragEnd")}),u.getElement().addEventListener("click",a=>{a.stopPropagation(),e("click")})}),be(()=>{u==null||u.remove()}),n.$$set=a=>{"map"in a&&i(1,s=a.map),"position"in a&&i(0,r=a.position)},[r,s]}class Ve extends X{constructor(t){super(),Z(this,t,Fe,null,Q,{map:1,position:0})}}function pe(n){let t,i;return t=new Be({props:{$$slots:{default:[Oe]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){w(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,s){E(t,e,s),i=!0},p(e,s){const r={};s&2050&&(r.$$scope={dirty:s,ctx:e}),t.$set(r)},i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){v(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function Oe(n){let t,i;return{c(){t=M("Use lookup: "),i=M(n[1])},l(e){t=T(e,"Use lookup: "),i=T(e,n[1])},m(e,s){b(e,t,s),b(e,i,s)},p(e,s){s&2&&H(i,e[1])},d(e){e&&(_(t),_(i))}}}function Ge(n){let t,i,e,s,r,u,a,l,o,m,p,d,g,f,D,W;function $(c){n[5](c)}let y={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(y.value=n[2].criticalIssues[n[0]].criticalIssue),t=new ue({props:y}),V.push(()=>G(t,"value",$));function q(c){n[6](c)}let P={label:"Stage",emptyOption:!0,choices:Ae(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(P.value=n[2].criticalIssues[n[0]].stage),s=new ue({props:P}),V.push(()=>G(s,"value",q));function ye(c){n[7](c)}let te={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(te.value=n[2].criticalIssues[n[0]].locationName),a=new Me({props:te}),V.push(()=>G(a,"value",ye));let I=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&pe(n);function we(c){n[8](c)}let ne={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(ne.value=n[2].criticalIssues[n[0]].resolved),p=new Te({props:ne}),V.push(()=>G(p,"value",we));function Ce(c){n[9](c)}let ie={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(ie.value=n[2].criticalIssues[n[0]].notes),f=new Ne({props:ie}),V.push(()=>G(f,"value",Ce)),{c(){w(t.$$.fragment),e=B(),w(s.$$.fragment),u=B(),w(a.$$.fragment),o=B(),I&&I.c(),m=B(),w(p.$$.fragment),g=B(),w(f.$$.fragment)},l(c){C(t.$$.fragment,c),e=S(c),C(s.$$.fragment,c),u=S(c),C(a.$$.fragment,c),o=S(c),I&&I.l(c),m=S(c),C(p.$$.fragment,c),g=S(c),C(f.$$.fragment,c)},m(c,k){E(t,c,k),b(c,e,k),E(s,c,k),b(c,u,k),E(a,c,k),b(c,o,k),I&&I.m(c,k),b(c,m,k),E(p,c,k),b(c,g,k),E(f,c,k),W=!0},p(c,[k]){const se={};!i&&k&5&&(i=!0,se.value=c[2].criticalIssues[c[0]].criticalIssue,O(()=>i=!1)),t.$set(se);const ae={};!r&&k&5&&(r=!0,ae.value=c[2].criticalIssues[c[0]].stage,O(()=>r=!1)),s.$set(ae);const le={};!l&&k&5&&(l=!0,le.value=c[2].criticalIssues[c[0]].locationName,O(()=>l=!1)),a.$set(le),c[1]&&c[1]!="Loading"&&c[1]!=c[2].criticalIssues[c[0]].locationName?I?(I.p(c,k),k&7&&h(I,1)):(I=pe(c),I.c(),h(I,1),I.m(m.parentNode,m)):I&&(K(),v(I,1,1,()=>{I=null}),Y());const re={};!d&&k&5&&(d=!0,re.value=c[2].criticalIssues[c[0]].resolved,O(()=>d=!1)),p.$set(re);const oe={};!D&&k&5&&(D=!0,oe.value=c[2].criticalIssues[c[0]].notes,O(()=>D=!1)),f.$set(oe)},i(c){W||(h(t.$$.fragment,c),h(s.$$.fragment,c),h(a.$$.fragment,c),h(I),h(p.$$.fragment,c),h(f.$$.fragment,c),W=!0)},o(c){v(t.$$.fragment,c),v(s.$$.fragment,c),v(a.$$.fragment,c),v(I),v(p.$$.fragment,c),v(f.$$.fragment,c),W=!1},d(c){c&&(_(e),_(u),_(o),_(m),_(g)),L(t,c),L(s,c),L(a,c),I&&I.d(c),L(p,c),L(f,c)}}}function Re(n,t,i){let e;ee(n,N,f=>i(2,e=f));let{idx:s}=t,r=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],u="Loading";x(async()=>{await a(e.criticalIssues[s].point)});async function a(f){let D=`https://nominatim.openstreetmap.org/reverse?lon=${f[0]}&lat=${f[1]}&format=json`;try{let $=await(await fetch(D)).json();i(1,u=$.address.road??$.display_name)}catch(W){return console.log(`Location lookup failed: ${W}`),""}}function l(){Ie(N,e.criticalIssues[s].locationName=u,e)}function o(f){n.$$.not_equal(e.criticalIssues[s].criticalIssue,f)&&(e.criticalIssues[s].criticalIssue=f,N.set(e))}function m(f){n.$$.not_equal(e.criticalIssues[s].stage,f)&&(e.criticalIssues[s].stage=f,N.set(e))}function p(f){n.$$.not_equal(e.criticalIssues[s].locationName,f)&&(e.criticalIssues[s].locationName=f,N.set(e))}function d(f){n.$$.not_equal(e.criticalIssues[s].resolved,f)&&(e.criticalIssues[s].resolved=f,N.set(e))}function g(f){n.$$.not_equal(e.criticalIssues[s].notes,f)&&(e.criticalIssues[s].notes=f,N.set(e))}return n.$$set=f=>{"idx"in f&&i(0,s=f.idx)},[s,u,e,r,l,o,m,p,d,g]}class Ue extends X{constructor(t){super(),Z(this,t,Re,Ge,Q,{idx:0})}}function me(n,t,i){const e=n.slice();return e[11]=t[i],e[12]=t,e[13]=i,e}function He(n){let t,i,e,s,r,u,a,l,o,m;return r=new Pe({props:{$$slots:{default:[Ke]},$$scope:{ctx:n}}}),r.$on("click",n[5]),a=new Se({props:{$$slots:{default:[Ye]},$$scope:{ctx:n}}}),a.$on("click",n[4]),o=new Ue({props:{idx:n[1]}}),{c(){t=j("p"),i=M("Editing "),e=M(n[1]),s=B(),w(r.$$.fragment),u=B(),w(a.$$.fragment),l=B(),w(o.$$.fragment)},l(p){t=F(p,"P",{});var d=R(t);i=T(d,"Editing "),e=T(d,n[1]),d.forEach(_),s=S(p),C(r.$$.fragment,p),u=S(p),C(a.$$.fragment,p),l=S(p),C(o.$$.fragment,p)},m(p,d){b(p,t,d),A(t,i),A(t,e),b(p,s,d),E(r,p,d),b(p,u,d),E(a,p,d),b(p,l,d),E(o,p,d),m=!0},p(p,d){(!m||d&2)&&H(e,p[1]);const g={};d&16384&&(g.$$scope={dirty:d,ctx:p}),r.$set(g);const f={};d&16384&&(f.$$scope={dirty:d,ctx:p}),a.$set(f);const D={};d&2&&(D.idx=p[1]),o.$set(D)},i(p){m||(h(r.$$.fragment,p),h(a.$$.fragment,p),h(o.$$.fragment,p),m=!0)},o(p){v(r.$$.fragment,p),v(a.$$.fragment,p),v(o.$$.fragment,p),m=!1},d(p){p&&(_(t),_(s),_(u),_(l)),L(r,p),L(a,p),L(o,p)}}}function Je(n){let t,i="Click the map to add a pin, or click a pin to fill out data";return{c(){t=j("p"),t.textContent=i},l(e){t=F(e,"P",{"data-svelte-h":!0}),De(t)!=="svelte-1rxcdnm"&&(t.textContent=i)},m(e,s){b(e,t,s)},p:J,i:J,o:J,d(e){e&&_(t)}}}function Ke(n){let t;return{c(){t=M("Save")},l(i){t=T(i,"Save")},m(i,e){b(i,t,e)},d(i){i&&_(t)}}}function Ye(n){let t;return{c(){t=M("Delete")},l(i){t=T(i,"Delete")},m(i,e){b(i,t,e)},d(i){i&&_(t)}}}function de(n){let t;return{c(){t=j("div"),this.h()},l(i){t=F(i,"DIV",{class:!0}),R(t).forEach(_),this.h()},h(){Le(t,"class","block-map svelte-13rr2mh")},m(i,e){b(i,t,e)},d(i){i&&_(t)}}}function ge(n){let t,i,e;function s(l){n[6](l,n[11])}function r(){return n[7](n[13])}function u(){return n[8](n[13])}let a={map:n[0]};return n[11].point!==void 0&&(a.position=n[11].point),t=new Ve({props:a}),V.push(()=>G(t,"position",s)),t.$on("click",r),t.$on("dragEnd",u),{c(){w(t.$$.fragment)},l(l){C(t.$$.fragment,l)},m(l,o){E(t,l,o),e=!0},p(l,o){n=l;const m={};o&1&&(m.map=n[0]),!i&&o&4&&(i=!0,m.position=n[11].point,O(()=>i=!1)),t.$set(m)},i(l){e||(h(t.$$.fragment,l),e=!0)},o(l){v(t.$$.fragment,l),e=!1},d(l){L(t,l)}}}function _e(n){let t,i;return t=new qe({props:{data:$e(n[2].criticalIssues[n[1]].point),$$slots:{default:[ze]},$$scope:{ctx:n}}}),{c(){w(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,s){E(t,e,s),i=!0},p(e,s){const r={};s&6&&(r.data=$e(e[2].criticalIssues[e[1]].point)),s&16384&&(r.$$scope={dirty:s,ctx:e}),t.$set(r)},i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){v(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function ze(n){let t,i;return t=new je({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){w(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,s){E(t,e,s),i=!0},p:J,i(e){i||(h(t.$$.fragment,e),i=!0)},o(e){v(t.$$.fragment,e),i=!1},d(e){L(t,e)}}}function Qe(n){let t,i,e,s=z(n[2].criticalIssues),r=[];for(let l=0;l<s.length;l+=1)r[l]=ge(me(n,s,l));const u=l=>v(r[l],1,1,()=>{r[l]=null});let a=n[1]!=null&&_e(n);return{c(){for(let l=0;l<r.length;l+=1)r[l].c();t=B(),a&&a.c(),i=ce()},l(l){for(let o=0;o<r.length;o+=1)r[o].l(l);t=S(l),a&&a.l(l),i=ce()},m(l,o){for(let m=0;m<r.length;m+=1)r[m]&&r[m].m(l,o);b(l,t,o),a&&a.m(l,o),b(l,i,o),e=!0},p(l,o){if(o&13){s=z(l[2].criticalIssues);let m;for(m=0;m<s.length;m+=1){const p=me(l,s,m);r[m]?(r[m].p(p,o),h(r[m],1)):(r[m]=ge(p),r[m].c(),h(r[m],1),r[m].m(t.parentNode,t))}for(K(),m=s.length;m<r.length;m+=1)u(m);Y()}l[1]!=null?a?(a.p(l,o),o&2&&h(a,1)):(a=_e(l),a.c(),h(a,1),a.m(i.parentNode,i)):a&&(K(),v(a,1,1,()=>{a=null}),Y())},i(l){if(!e){for(let o=0;o<s.length;o+=1)h(r[o]);h(a),e=!0}},o(l){r=r.filter(Boolean);for(let o=0;o<r.length;o+=1)v(r[o]);v(a),e=!1},d(l){l&&(_(t),_(i)),ke(r,l),a&&a.d(l)}}}function Xe(n){let t,i,e,s,r,u,a,l,o,m;const p=[Je,He],d=[];function g($,y){return $[1]==null?0:1}e=g(n),s=d[e]=p[e](n);let f=n[1]!=null&&de();function D($){n[9]($)}let W={$$slots:{default:[Qe]},$$scope:{ctx:n}};return n[0]!==void 0&&(W.map=n[0]),l=new We({props:W}),V.push(()=>G(l,"map",D)),{c(){t=j("div"),i=j("div"),s.c(),r=B(),u=j("div"),f&&f.c(),a=B(),w(l.$$.fragment),this.h()},l($){t=F($,"DIV",{style:!0});var y=R(t);i=F(y,"DIV",{style:!0});var q=R(i);s.l(q),q.forEach(_),r=S(y),u=F(y,"DIV",{style:!0});var P=R(u);f&&f.l(P),a=S(P),C(l.$$.fragment,P),P.forEach(_),y.forEach(_),this.h()},h(){U(i,"width","30%"),U(u,"position","relative"),U(u,"width","70%"),U(u,"height","600px"),U(t,"display","flex")},m($,y){b($,t,y),A(t,i),d[e].m(i,null),A(t,r),A(t,u),f&&f.m(u,null),A(u,a),E(l,u,null),m=!0},p($,[y]){let q=e;e=g($),e===q?d[e].p($,y):(K(),v(d[q],1,1,()=>{d[q]=null}),Y(),s=d[e],s?s.p($,y):(s=d[e]=p[e]($),s.c()),h(s,1),s.m(i,null)),$[1]!=null?f||(f=de(),f.c(),f.m(u,a)):f&&(f.d(1),f=null);const P={};y&16391&&(P.$$scope={dirty:y,ctx:$}),!o&&y&1&&(o=!0,P.map=$[0],O(()=>o=!1)),l.$set(P)},i($){m||(h(s),h(l.$$.fragment,$),m=!0)},o($){v(s),v(l.$$.fragment,$),m=!1},d($){$&&_(t),d[e].d(),f&&f.d(),L(l)}}}function $e(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function Ze(n,t,i){let e;ee(n,N,f=>i(2,e=f));let s,r=null;function u(f){i(1,r=f)}function a(f){Ie(N,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:f.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),i(1,r=e.criticalIssues.length-1)}x(()=>{s.on("click",a)}),be(()=>{s.off("click",a)});function l(){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(r,1),N.set(e),i(1,r=null))}const o=()=>i(1,r=null);function m(f,D){n.$$.not_equal(D.point,f)&&(D.point=f,N.set(e))}const p=f=>u(f),d=f=>u(f);function g(f){s=f,i(0,s)}return[s,r,e,u,l,o,m,p,d,g]}class xe extends X{constructor(t){super(),Z(this,t,Ze,Xe,Q,{})}}function he(n,t,i){const e=n.slice();return e[1]=t[i],e}function ve(n){let t,i,e=n[1].criticalIssue+"",s,r,u=n[1].stage+"",a,l,o=n[1].locationName+"",m,p;return{c(){t=j("li"),i=M("Critical issue: type="),s=M(e),r=M(", stage="),a=M(u),l=M(", at "),m=M(o),p=B()},l(d){t=F(d,"LI",{});var g=R(t);i=T(g,"Critical issue: type="),s=T(g,e),r=T(g,", stage="),a=T(g,u),l=T(g,", at "),m=T(g,o),p=S(g),g.forEach(_)},m(d,g){b(d,t,g),A(t,i),A(t,s),A(t,r),A(t,a),A(t,l),A(t,m),A(t,p)},p(d,g){g&1&&e!==(e=d[1].criticalIssue+"")&&H(s,e),g&1&&u!==(u=d[1].stage+"")&&H(a,u),g&1&&o!==(o=d[1].locationName+"")&&H(m,o)},d(d){d&&_(t)}}}function et(n){let t,i,e,s,r=z(n[0].criticalIssues),u=[];for(let a=0;a<r.length;a+=1)u[a]=ve(he(n,r,a));return e=new xe({}),{c(){t=j("ol");for(let a=0;a<u.length;a+=1)u[a].c();i=B(),w(e.$$.fragment)},l(a){t=F(a,"OL",{});var l=R(t);for(let o=0;o<u.length;o+=1)u[o].l(l);l.forEach(_),i=S(a),C(e.$$.fragment,a)},m(a,l){b(a,t,l);for(let o=0;o<u.length;o+=1)u[o]&&u[o].m(t,null);b(a,i,l),E(e,a,l),s=!0},p(a,[l]){if(l&1){r=z(a[0].criticalIssues);let o;for(o=0;o<r.length;o+=1){const m=he(a,r,o);u[o]?u[o].p(m,l):(u[o]=ve(m),u[o].c(),u[o].m(t,null))}for(;o<u.length;o+=1)u[o].d(1);u.length=r.length}},i(a){s||(h(e.$$.fragment,a),s=!0)},o(a){v(e.$$.fragment,a),s=!1},d(a){a&&(_(t),_(i)),ke(u,a),L(e,a)}}}function tt(n,t,i){let e;return ee(n,N,s=>i(0,e=s)),[e]}class gt extends X{constructor(t){super(),Z(this,t,tt,et,Q,{})}}export{gt as component};
