import{s as I,e as J,a as $,c as R,m as K,g as k,i as f,f as g,k as W,t as T,d as j}from"../chunks/scheduler.BJ06nkRu.js";import{S as N,i as O,c as y,a as d,m as x,t as b,b as w,d as S}from"../chunks/index.Dmc4uC9p.js";import{e as D}from"../chunks/da_log.BJKP3T36.js";import{s as F}from"../chunks/data.DOKPrBVe.js";import{D as U}from"../chunks/DefaultButton.CRXvyloG.js";/* empty css                                                               */import{T as _}from"../chunks/TextArea.dqrL6eGj.js";import{E as B}from"../chunks/exceljs.min.BuyXGIGS.js";const A=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function M(e){console.log("Loading blank route check xlsx");let l=await(await fetch(A)).arrayBuffer(),t=new B.Workbook;await t.xlsx.load(l),t.eachSheet((s,r)=>{s.conditionalFormattings=[]}),V(e,t),G(e,t),H(e,t),q(e,t),C(e.safetyCheck,t,"3.1 Safety Check",["J","K","L","M"],p([[13,28]])),C(e.streetCheck,t,"4.1 Street Check",["J","K","L","M"],p([[13,19],[23,25],[29,34],[38,43],[47,50]])),C(e.streetPlacemakingCheck,t,"4.2 Street Placemaking Check",["I","J","K","L"],p([[13,15],[19,21],[25,34],[38,47]])),C(e.pathCheck,t,"5.1 Path Check",["J","K","L","M"],p([[15,19],[23,33],[37,40],[44,48],[52,56]])),C(e.pathPlacemakingCheck,t,"5.2 Path Placemaking Check",["I","J","K","L"],p([[12,14],[20,22],[26,29],[33,41]])),console.log("Writing route check xlsx");let a=await t.xlsx.writeBuffer();z(a,"out.xlsx")}function V(e,n){let l=n.getWorksheet("1. Summary of Scheme");l.getCell("C6").value=e.summary.dateDesignReview,l.getCell("C7").value=e.summary.schemeReference,l.getCell("C8").value=e.summary.schemeName,l.getCell("C9").value=e.summary.schemeSummary,l.getCell("C10").value=e.summary.schemeInfoReviewed,l.getCell("C11").value=e.summary.authority,l.getCell("C12").value=e.summary.transportOrCombinedAuthority,l.getCell("C13").value=e.summary.region,l.getCell("C14").value=e.summary.fundingProgramme,l.getCell("C15").value=e.summary.designStage,l.getCell("C16").value=e.summary.fundingConditions,l.getCell("C17").value=e.summary.inspectorEmail,l.getCell("C18").value=e.summary.assessedRouteLengthKm,l.getCell("C19").value=e.summary.totalRouteLengthKm,l.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(l.getCell("D22").value="Path Check")}function G(e,n){let l=n.getWorksheet("2.1 Policy Check");for(let t=0;t<6;t++)l.getCell("D"+(8+t)).value=e.policyCheck[t].existing,l.getCell("E"+(8+t)).value=e.policyCheck[t].proposed,l.getCell("F"+(8+t)).value=e.policyCheck[t].commentary}function H(e,n){let l=n.getWorksheet("2.2 Policy Conflict Log");for(let[t,a]of e.policyConflictLog.entries())l.getCell("F"+(8+t)).value=a.conflict,l.getCell("H"+(8+t)).value=a.stage,l.getCell("I"+(8+t)).value=E(a.point),l.getCell("J"+(8+t)).value=a.locationName,l.getCell("K"+(8+t)).value=a.resolved,l.getCell("L"+(8+t)).value=a.notes}function q(e,n){let l=n.getWorksheet("3.2 Critical Issues Log");for(let[t,a]of e.criticalIssues.entries())l.getCell("F"+(8+t)).value=a.criticalIssue,l.getCell("H"+(8+t)).value=a.stage,l.getCell("I"+(8+t)).value=E(a.point),l.getCell("J"+(8+t)).value=a.locationName,l.getCell("K"+(8+t)).value=a.resolved,l.getCell("L"+(8+t)).value=a.notes}function C(e,n,l,t,a){let s=n.getWorksheet(l);if(a.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${l}`);for(let r=0;r<e.existingScores.length;r++){let m=a[r];s.getCell(t[0]+m).value=P(e.existingScores[r]),s.getCell(t[1]+m).value=e.existingScoreNotes[r],s.getCell(t[2]+m).value=P(e.proposedScores[r]),s.getCell(t[3]+m).value=e.proposedScoreNotes[r]}}function p(e){let n=[];for(let[l,t]of e)for(let a=l;a<=t;a++)n.push(a);return n}function P(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function E(e){return`${e[1]}, ${e[0]}`}function z(e,n){let l=new Blob([e],{type:"application/octet-stream"}),t=URL.createObjectURL(l),a=document.createElement("a");a.href=t,a.download=n,a.style.display="none",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}function Q(e){let n;return{c(){n=T("Convert to .xlsx (takes a few seconds)")},l(l){n=j(l,"Convert to .xlsx (takes a few seconds)")},m(l,t){f(l,n,t)},d(l){l&&g(n)}}}function X(e){let n,l=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,t,a,s,r,m,i,h,c,v;return a=new _({props:{label:"TSV output, just the one row of values",value:e[3]}}),r=new _({props:{label:"TSV output with header",value:`${e[2]}
${e[3]}
`}}),i=new _({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(e[1]),null,"  ")}}),c=new U({props:{$$slots:{default:[Q]},$$scope:{ctx:e}}}),c.$on("click",e[4]),{c(){n=J("p"),n.textContent=l,t=$(),y(a.$$.fragment),s=$(),y(r.$$.fragment),m=$(),y(i.$$.fragment),h=$(),y(c.$$.fragment)},l(o){n=R(o,"P",{"data-svelte-h":!0}),K(n)!=="svelte-5ssfe3"&&(n.textContent=l),t=k(o),d(a.$$.fragment,o),s=k(o),d(r.$$.fragment,o),m=k(o),d(i.$$.fragment,o),h=k(o),d(c.$$.fragment,o)},m(o,u){f(o,n,u),f(o,t,u),x(a,o,u),f(o,s,u),x(r,o,u),f(o,m,u),x(i,o,u),f(o,h,u),x(c,o,u),v=!0},p(o,[u]){const L={};u&32&&(L.$$scope={dirty:u,ctx:o}),c.$set(L)},i(o){v||(b(a.$$.fragment,o),b(r.$$.fragment,o),b(i.$$.fragment,o),b(c.$$.fragment,o),v=!0)},o(o){w(a.$$.fragment,o),w(r.$$.fragment,o),w(i.$$.fragment,o),w(c.$$.fragment,o),v=!1},d(o){o&&(g(n),g(t),g(s),g(m),g(h)),S(a,o),S(r,o),S(i,o),S(c,o)}}}function Y(e,n,l){let t;W(e,F,i=>l(0,t=i));let a=D(t),s=a.map(i=>i[0]).join("	"),r=a.map(i=>`"${i[1]}"`).join("	");return[t,a,s,r,()=>M(t)]}class se extends N{constructor(n){super(),O(this,n,Y,X,I,{})}}export{se as component};
