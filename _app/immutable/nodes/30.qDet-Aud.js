import{s as G,a7 as we,U as pe,a8 as me,A as L,a as B,g as M,i as b,B as T,f as _,k as U,e as F,c as O,b as R,v as q,h as V,M as de,t as P,d as W,j as Ie,p as ke,n as K,E as ae,q as ge}from"../chunks/scheduler.CYx2ttP3.js";import{S as H,i as J,f as N,c as I,a as k,m as y,t as $,b as h,d as C,g as Y,e as z}from"../chunks/index.Bh3RlrZK.js";import{e as j}from"../chunks/each.D_qLyk6y.js";import{p as ye}from"../chunks/index.D-9ExnGl.js";import{S as re}from"../chunks/Select.gMiMMceA.js";import{T as Ce}from"../chunks/TextArea.CT4fIbcj.js";import{T as De}from"../chunks/TextInput.DkOyKEPL.js";import{s as D}from"../chunks/data.Bx8tP48L.js";import{Y as Ae}from"../chunks/YesNo.Eyf_4iK4.js";import{D as Be}from"../chunks/DefaultButton.CxPf0z-2.js";import{W as $e,S as Me}from"../chunks/WarningButton.YKTv_CHU.js";import{m as le,M as Se}from"../chunks/MapLibreMap.CuriT3oy.js";import"../chunks/paths.COgti69g.js";import{C as Ee}from"../chunks/CollapsibleCard.ZXncRbDC.js";/* empty css                                                    */function Le(i,t,r){let e=we(),{map:s}=t,{position:u}=t,a=null;return pe(()=>{a=new le.Marker({draggable:!0}).setLngLat(new le.LngLat(u[0],u[1])).addTo(s),a.on("dragstart",()=>{s.getCanvas().style.cursor="grabbing"}),a.on("drag",()=>{r(0,u=a.getLngLat().toArray())}),a.on("dragend",()=>{s.getCanvas().style.cursor="inherit"}),a.getElement().addEventListener("click",n=>{e("click"),n.stopPropagation()})}),me(()=>{a==null||a.remove()}),i.$$set=n=>{"map"in n&&r(1,s=n.map),"position"in n&&r(0,u=n.position)},[u,s]}class Te extends H{constructor(t){super(),J(this,t,Le,null,G,{map:1,position:0})}}function Ne(i){let t,r,e,s,u,a,n,f,o,p,l,m,d,A,g;function v(c){i[3](c)}let S={label:"Critical Issue",emptyOption:!0,choices:i[2]};i[1].criticalIssues[i[0]].criticalIssue!==void 0&&(S.value=i[1].criticalIssues[i[0]].criticalIssue),t=new re({props:S}),L.push(()=>N(t,"value",v));function E(c){i[4](c)}let Q={label:"Stage",emptyOption:!0,choices:ye(["Existing","Design"])};i[1].criticalIssues[i[0]].stage!==void 0&&(Q.value=i[1].criticalIssues[i[0]].stage),s=new re({props:Q}),L.push(()=>N(s,"value",E));function he(c){i[5](c)}let X={label:"Location Name"};i[1].criticalIssues[i[0]].locationName!==void 0&&(X.value=i[1].criticalIssues[i[0]].locationName),n=new De({props:X}),L.push(()=>N(n,"value",he));function be(c){i[6](c)}let Z={label:"Resolved by Design"};i[1].criticalIssues[i[0]].resolved!==void 0&&(Z.value=i[1].criticalIssues[i[0]].resolved),p=new Ae({props:Z}),L.push(()=>N(p,"value",be));function ve(c){i[7](c)}let x={label:"Commentary & Feedback"};return i[1].criticalIssues[i[0]].notes!==void 0&&(x.value=i[1].criticalIssues[i[0]].notes),d=new Ce({props:x}),L.push(()=>N(d,"value",ve)),{c(){I(t.$$.fragment),e=B(),I(s.$$.fragment),a=B(),I(n.$$.fragment),o=B(),I(p.$$.fragment),m=B(),I(d.$$.fragment)},l(c){k(t.$$.fragment,c),e=M(c),k(s.$$.fragment,c),a=M(c),k(n.$$.fragment,c),o=M(c),k(p.$$.fragment,c),m=M(c),k(d.$$.fragment,c)},m(c,w){y(t,c,w),b(c,e,w),y(s,c,w),b(c,a,w),y(n,c,w),b(c,o,w),y(p,c,w),b(c,m,w),y(d,c,w),g=!0},p(c,[w]){const ee={};!r&&w&3&&(r=!0,ee.value=c[1].criticalIssues[c[0]].criticalIssue,T(()=>r=!1)),t.$set(ee);const te={};!u&&w&3&&(u=!0,te.value=c[1].criticalIssues[c[0]].stage,T(()=>u=!1)),s.$set(te);const ne={};!f&&w&3&&(f=!0,ne.value=c[1].criticalIssues[c[0]].locationName,T(()=>f=!1)),n.$set(ne);const se={};!l&&w&3&&(l=!0,se.value=c[1].criticalIssues[c[0]].resolved,T(()=>l=!1)),p.$set(se);const ie={};!A&&w&3&&(A=!0,ie.value=c[1].criticalIssues[c[0]].notes,T(()=>A=!1)),d.$set(ie)},i(c){g||($(t.$$.fragment,c),$(s.$$.fragment,c),$(n.$$.fragment,c),$(p.$$.fragment,c),$(d.$$.fragment,c),g=!0)},o(c){h(t.$$.fragment,c),h(s.$$.fragment,c),h(n.$$.fragment,c),h(p.$$.fragment,c),h(d.$$.fragment,c),g=!1},d(c){c&&(_(e),_(a),_(o),_(m)),C(t,c),C(s,c),C(n,c),C(p,c),C(d,c)}}}function Pe(i,t,r){let e;U(i,D,l=>r(1,e=l));let{idx:s}=t,u=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]];function a(l){i.$$.not_equal(e.criticalIssues[s].criticalIssue,l)&&(e.criticalIssues[s].criticalIssue=l,D.set(e))}function n(l){i.$$.not_equal(e.criticalIssues[s].stage,l)&&(e.criticalIssues[s].stage=l,D.set(e))}function f(l){i.$$.not_equal(e.criticalIssues[s].locationName,l)&&(e.criticalIssues[s].locationName=l,D.set(e))}function o(l){i.$$.not_equal(e.criticalIssues[s].resolved,l)&&(e.criticalIssues[s].resolved=l,D.set(e))}function p(l){i.$$.not_equal(e.criticalIssues[s].notes,l)&&(e.criticalIssues[s].notes=l,D.set(e))}return i.$$set=l=>{"idx"in l&&r(0,s=l.idx)},[s,e,u,a,n,f,o,p]}class _e extends H{constructor(t){super(),J(this,t,Pe,Ne,G,{idx:0})}}function oe(i,t,r){const e=i.slice();return e[10]=t[r],e[11]=t,e[12]=r,e}function We(i){let t,r,e,s,u,a,n,f,o,p;return u=new _e({props:{idx:i[1]}}),n=new Be({props:{$$slots:{default:[Fe]},$$scope:{ctx:i}}}),n.$on("click",i[5]),o=new $e({props:{$$slots:{default:[Oe]},$$scope:{ctx:i}}}),o.$on("click",i[4]),{c(){t=F("p"),r=P("Editing "),e=P(i[1]),s=B(),I(u.$$.fragment),a=B(),I(n.$$.fragment),f=B(),I(o.$$.fragment)},l(l){t=O(l,"P",{});var m=R(t);r=W(m,"Editing "),e=W(m,i[1]),m.forEach(_),s=M(l),k(u.$$.fragment,l),a=M(l),k(n.$$.fragment,l),f=M(l),k(o.$$.fragment,l)},m(l,m){b(l,t,m),V(t,r),V(t,e),b(l,s,m),y(u,l,m),b(l,a,m),y(n,l,m),b(l,f,m),y(o,l,m),p=!0},p(l,m){(!p||m&2)&&Ie(e,l[1]);const d={};m&2&&(d.idx=l[1]),u.$set(d);const A={};m&8192&&(A.$$scope={dirty:m,ctx:l}),n.$set(A);const g={};m&8192&&(g.$$scope={dirty:m,ctx:l}),o.$set(g)},i(l){p||($(u.$$.fragment,l),$(n.$$.fragment,l),$(o.$$.fragment,l),p=!0)},o(l){h(u.$$.fragment,l),h(n.$$.fragment,l),h(o.$$.fragment,l),p=!1},d(l){l&&(_(t),_(s),_(a),_(f)),C(u,l),C(n,l),C(o,l)}}}function qe(i){let t,r="Click the map to add a pin, or click a pin to fill out data";return{c(){t=F("p"),t.textContent=r},l(e){t=O(e,"P",{"data-svelte-h":!0}),ke(t)!=="svelte-1rxcdnm"&&(t.textContent=r)},m(e,s){b(e,t,s)},p:K,i:K,o:K,d(e){e&&_(t)}}}function Fe(i){let t;return{c(){t=P("Save")},l(r){t=W(r,"Save")},m(r,e){b(r,t,e)},d(r){r&&_(t)}}}function Oe(i){let t;return{c(){t=P("Delete")},l(r){t=W(r,"Delete")},m(r,e){b(r,t,e)},d(r){r&&_(t)}}}function ce(i){let t,r,e;function s(n){i[6](n,i[10])}function u(){return i[7](i[12])}let a={map:i[0]};return i[10].point!==void 0&&(a.position=i[10].point),t=new Te({props:a}),L.push(()=>N(t,"position",s)),t.$on("click",u),{c(){I(t.$$.fragment)},l(n){k(t.$$.fragment,n)},m(n,f){y(t,n,f),e=!0},p(n,f){i=n;const o={};f&1&&(o.map=i[0]),!r&&f&4&&(r=!0,o.position=i[10].point,T(()=>r=!1)),t.$set(o)},i(n){e||($(t.$$.fragment,n),e=!0)},o(n){h(t.$$.fragment,n),e=!1},d(n){C(t,n)}}}function Ve(i){let t,r,e=j(i[2].criticalIssues),s=[];for(let a=0;a<e.length;a+=1)s[a]=ce(oe(i,e,a));const u=a=>h(s[a],1,1,()=>{s[a]=null});return{c(){for(let a=0;a<s.length;a+=1)s[a].c();t=ae()},l(a){for(let n=0;n<s.length;n+=1)s[n].l(a);t=ae()},m(a,n){for(let f=0;f<s.length;f+=1)s[f]&&s[f].m(a,n);b(a,t,n),r=!0},p(a,n){if(n&13){e=j(a[2].criticalIssues);let f;for(f=0;f<e.length;f+=1){const o=oe(a,e,f);s[f]?(s[f].p(o,n),$(s[f],1)):(s[f]=ce(o),s[f].c(),$(s[f],1),s[f].m(t.parentNode,t))}for(Y(),f=e.length;f<s.length;f+=1)u(f);z()}},i(a){if(!r){for(let n=0;n<e.length;n+=1)$(s[n]);r=!0}},o(a){s=s.filter(Boolean);for(let n=0;n<s.length;n+=1)h(s[n]);r=!1},d(a){a&&_(t),ge(s,a)}}}function Re(i){let t,r,e,s,u,a,n,f,o;const p=[qe,We],l=[];function m(g,v){return g[1]==null?0:1}e=m(i),s=l[e]=p[e](i);function d(g){i[8](g)}let A={$$slots:{default:[Ve]},$$scope:{ctx:i}};return i[0]!==void 0&&(A.map=i[0]),n=new Se({props:A}),L.push(()=>N(n,"map",d)),{c(){t=F("div"),r=F("div"),s.c(),u=B(),a=F("div"),I(n.$$.fragment),this.h()},l(g){t=O(g,"DIV",{style:!0});var v=R(t);r=O(v,"DIV",{style:!0});var S=R(r);s.l(S),S.forEach(_),u=M(v),a=O(v,"DIV",{style:!0});var E=R(a);k(n.$$.fragment,E),E.forEach(_),v.forEach(_),this.h()},h(){q(r,"width","30%"),q(a,"position","relative"),q(a,"width","70%"),q(a,"height","300px"),q(t,"display","flex")},m(g,v){b(g,t,v),V(t,r),l[e].m(r,null),V(t,u),V(t,a),y(n,a,null),o=!0},p(g,[v]){let S=e;e=m(g),e===S?l[e].p(g,v):(Y(),h(l[S],1,1,()=>{l[S]=null}),z(),s=l[e],s?s.p(g,v):(s=l[e]=p[e](g),s.c()),$(s,1),s.m(r,null));const E={};v&8197&&(E.$$scope={dirty:v,ctx:g}),!f&&v&1&&(f=!0,E.map=g[0],T(()=>f=!1)),n.$set(E)},i(g){o||($(s),$(n.$$.fragment,g),o=!0)},o(g){h(s),h(n.$$.fragment,g),o=!1},d(g){g&&_(t),l[e].d(),C(n)}}}function je(i,t,r){let e;U(i,D,d=>r(2,e=d));let s,u=null;function a(d){r(1,u=d)}function n(d){de(D,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:d.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),r(1,u=e.criticalIssues.length-1)}pe(()=>{s.on("click",n)}),me(()=>{s.off("click",n)});function f(){e.criticalIssues.splice(u,1),D.set(e),r(1,u=null)}const o=()=>r(1,u=null);function p(d,A){i.$$.not_equal(A.point,d)&&(A.point=d,D.set(e))}const l=d=>a(d);function m(d){s=d,r(0,s)}return[s,u,e,a,f,o,p,l,m]}class Ge extends H{constructor(t){super(),J(this,t,je,Re,G,{})}}function ue(i,t,r){const e=i.slice();return e[4]=t[r],e[6]=r,e}function He(i){let t;return{c(){t=P("Add")},l(r){t=W(r,"Add")},m(r,e){b(r,t,e)},d(r){r&&_(t)}}}function Je(i){let t;return{c(){t=P("Delete")},l(r){t=W(r,"Delete")},m(r,e){b(r,t,e)},d(r){r&&_(t)}}}function Ke(i){let t,r,e,s;function u(){return i[3](i[6])}return t=new $e({props:{$$slots:{default:[Je]},$$scope:{ctx:i}}}),t.$on("click",u),e=new _e({props:{idx:i[6]}}),{c(){I(t.$$.fragment),r=B(),I(e.$$.fragment)},l(a){k(t.$$.fragment,a),r=M(a),k(e.$$.fragment,a)},m(a,n){y(t,a,n),b(a,r,n),y(e,a,n),s=!0},p(a,n){i=a;const f={};n&128&&(f.$$scope={dirty:n,ctx:i}),t.$set(f)},i(a){s||($(t.$$.fragment,a),$(e.$$.fragment,a),s=!0)},o(a){h(t.$$.fragment,a),h(e.$$.fragment,a),s=!1},d(a){a&&_(r),C(t,a),C(e,a)}}}function fe(i){let t,r;return t=new Ee({props:{label:i[4].id,$$slots:{default:[Ke]},$$scope:{ctx:i}}}),{c(){I(t.$$.fragment)},l(e){k(t.$$.fragment,e)},m(e,s){y(t,e,s),r=!0},p(e,s){const u={};s&1&&(u.label=e[4].id),s&128&&(u.$$scope={dirty:s,ctx:e}),t.$set(u)},i(e){r||($(t.$$.fragment,e),r=!0)},o(e){h(t.$$.fragment,e),r=!1},d(e){C(t,e)}}}function Ue(i){let t,r,e,s,u;t=new Me({props:{$$slots:{default:[He]},$$scope:{ctx:i}}}),t.$on("click",i[1]);let a=j(i[0].criticalIssues),n=[];for(let o=0;o<a.length;o+=1)n[o]=fe(ue(i,a,o));const f=o=>h(n[o],1,1,()=>{n[o]=null});return s=new Ge({}),{c(){I(t.$$.fragment),r=B();for(let o=0;o<n.length;o+=1)n[o].c();e=B(),I(s.$$.fragment)},l(o){k(t.$$.fragment,o),r=M(o);for(let p=0;p<n.length;p+=1)n[p].l(o);e=M(o),k(s.$$.fragment,o)},m(o,p){y(t,o,p),b(o,r,p);for(let l=0;l<n.length;l+=1)n[l]&&n[l].m(o,p);b(o,e,p),y(s,o,p),u=!0},p(o,[p]){const l={};if(p&128&&(l.$$scope={dirty:p,ctx:o}),t.$set(l),p&5){a=j(o[0].criticalIssues);let m;for(m=0;m<a.length;m+=1){const d=ue(o,a,m);n[m]?(n[m].p(d,p),$(n[m],1)):(n[m]=fe(d),n[m].c(),$(n[m],1),n[m].m(e.parentNode,e))}for(Y(),m=a.length;m<n.length;m+=1)f(m);z()}},i(o){if(!u){$(t.$$.fragment,o);for(let p=0;p<a.length;p+=1)$(n[p]);$(s.$$.fragment,o),u=!0}},o(o){h(t.$$.fragment,o),n=n.filter(Boolean);for(let p=0;p<n.length;p+=1)h(n[p]);h(s.$$.fragment,o),u=!1},d(o){o&&(_(r),_(e)),C(t,o),ge(n,o),C(s,o)}}}function Ye(i,t,r){let e;U(i,D,n=>r(0,e=n));function s(){de(D,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:[0,0],locationName:"",resolved:"",notes:""}],e)}function u(n){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(n,1),D.set(e))}return[e,s,u,n=>u(n)]}class ut extends H{constructor(t){super(),J(this,t,Ye,Ue,G,{})}}export{ut as component};
