import{s as me,v as V,a as M,g as N,i as I,x as R,f as d,k as $e,U as _e,t as F,d as G,j as Z,M as de,e as q,c as P,b as H,w as O,h as W,z as K,a7 as Ie,p as Ce,q as ge,r as he,B as Le,n as Be}from"../chunks/scheduler.AqiHgB-4.js";import{S as be,i as ve,e as U,c as B,a as D,m as S,t as v,g as Q,b as k,f as X,d as A}from"../chunks/index.DZ6vdrCY.js";import{e as z}from"../chunks/each.CUTBGCH7.js";import{p as De}from"../chunks/index.CzSNroOQ.js";import{S as we,W as Se}from"../chunks/WarningButton.BsDaXUST.js";import{S as ae}from"../chunks/Select.BRrs173w.js";import{T as Ae}from"../chunks/TextArea.8bTl0pXV.js";import{T as Me}from"../chunks/TextInput.BTXckXUE.js";import{s as j}from"../chunks/data.E5y7HbKH.js";import{Y as Ne}from"../chunks/YesNo.4oiCz_Ie.js";import{D as Te}from"../chunks/DefaultButton.CVFa87wm.js";import{b as je,B as Ee,G as qe,a as Pe,M as We}from"../chunks/GeoreferenceLayer.C5C0RTYS.js";import{M as Fe,G as Ge}from"../chunks/MapLibreMap.Du0aShs1.js";import{C as Oe}from"../chunks/CircleLayer.JJSGiwcY.js";const Ve=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function le(n){let t,s;return t=new we({props:{$$slots:{default:[Re]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){B(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){S(t,e,i),s=!0},p(e,i){const f={};i&2050&&(f.$$scope={dirty:i,ctx:e}),t.$set(f)},i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){k(t.$$.fragment,e),s=!1},d(e){A(t,e)}}}function Re(n){let t,s;return{c(){t=F("Use lookup: "),s=F(n[1])},l(e){t=G(e,"Use lookup: "),s=G(e,n[1])},m(e,i){I(e,t,i),I(e,s,i)},p(e,i){i&2&&Z(s,e[1])},d(e){e&&(d(t),d(s))}}}function Ue(n){let t,s,e,i,f,c,r,m,l,u,$,y,p,a,g,w;function _(o){n[5](o)}let C={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(C.value=n[2].criticalIssues[n[0]].criticalIssue),t=new ae({props:C}),V.push(()=>U(t,"value",_));function E(o){n[6](o)}let T={label:"Stage",emptyOption:!0,choices:De(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(T.value=n[2].criticalIssues[n[0]].stage),i=new ae({props:T}),V.push(()=>U(i,"value",E));function J(o){n[7](o)}let h={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(h.value=n[2].criticalIssues[n[0]].locationName),r=new Me({props:h}),V.push(()=>U(r,"value",J));let b=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&le(n);function Y(o){n[8](o)}let x={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(x.value=n[2].criticalIssues[n[0]].resolved),$=new Ne({props:x}),V.push(()=>U($,"value",Y));function ke(o){n[9](o)}let ee={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(ee.value=n[2].criticalIssues[n[0]].notes),a=new Ae({props:ee}),V.push(()=>U(a,"value",ke)),{c(){B(t.$$.fragment),e=M(),B(i.$$.fragment),c=M(),B(r.$$.fragment),l=M(),b&&b.c(),u=M(),B($.$$.fragment),p=M(),B(a.$$.fragment)},l(o){D(t.$$.fragment,o),e=N(o),D(i.$$.fragment,o),c=N(o),D(r.$$.fragment,o),l=N(o),b&&b.l(o),u=N(o),D($.$$.fragment,o),p=N(o),D(a.$$.fragment,o)},m(o,L){S(t,o,L),I(o,e,L),S(i,o,L),I(o,c,L),S(r,o,L),I(o,l,L),b&&b.m(o,L),I(o,u,L),S($,o,L),I(o,p,L),S(a,o,L),w=!0},p(o,[L]){const te={};!s&&L&5&&(s=!0,te.value=o[2].criticalIssues[o[0]].criticalIssue,R(()=>s=!1)),t.$set(te);const ne={};!f&&L&5&&(f=!0,ne.value=o[2].criticalIssues[o[0]].stage,R(()=>f=!1)),i.$set(ne);const se={};!m&&L&5&&(m=!0,se.value=o[2].criticalIssues[o[0]].locationName,R(()=>m=!1)),r.$set(se),o[1]&&o[1]!="Loading"&&o[1]!=o[2].criticalIssues[o[0]].locationName?b?(b.p(o,L),L&7&&v(b,1)):(b=le(o),b.c(),v(b,1),b.m(u.parentNode,u)):b&&(Q(),k(b,1,1,()=>{b=null}),X());const ie={};!y&&L&5&&(y=!0,ie.value=o[2].criticalIssues[o[0]].resolved,R(()=>y=!1)),$.$set(ie);const re={};!g&&L&5&&(g=!0,re.value=o[2].criticalIssues[o[0]].notes,R(()=>g=!1)),a.$set(re)},i(o){w||(v(t.$$.fragment,o),v(i.$$.fragment,o),v(r.$$.fragment,o),v(b),v($.$$.fragment,o),v(a.$$.fragment,o),w=!0)},o(o){k(t.$$.fragment,o),k(i.$$.fragment,o),k(r.$$.fragment,o),k(b),k($.$$.fragment,o),k(a.$$.fragment,o),w=!1},d(o){o&&(d(e),d(c),d(l),d(u),d(p)),A(t,o),A(i,o),A(r,o),b&&b.d(o),A($,o),A(a,o)}}}function He(n,t,s){let e;$e(n,j,a=>s(2,e=a));let{idx:i}=t,f=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],c="Loading";_e(async()=>{await r(e.criticalIssues[i].point)});async function r(a){let g=`https://nominatim.openstreetmap.org/reverse?lon=${a[0]}&lat=${a[1]}&format=json`;try{let _=await(await fetch(g)).json();s(1,c=_.address.road??_.display_name)}catch(w){return console.log(`Location lookup failed: ${w}`),""}}function m(){de(j,e.criticalIssues[i].locationName=c,e)}function l(a){n.$$.not_equal(e.criticalIssues[i].criticalIssue,a)&&(e.criticalIssues[i].criticalIssue=a,j.set(e))}function u(a){n.$$.not_equal(e.criticalIssues[i].stage,a)&&(e.criticalIssues[i].stage=a,j.set(e))}function $(a){n.$$.not_equal(e.criticalIssues[i].locationName,a)&&(e.criticalIssues[i].locationName=a,j.set(e))}function y(a){n.$$.not_equal(e.criticalIssues[i].resolved,a)&&(e.criticalIssues[i].resolved=a,j.set(e))}function p(a){n.$$.not_equal(e.criticalIssues[i].notes,a)&&(e.criticalIssues[i].notes=a,j.set(e))}return n.$$set=a=>{"idx"in a&&s(0,i=a.idx)},[i,c,e,f,m,l,u,$,y,p]}class Ke extends be{constructor(t){super(),ve(this,t,He,Ue,me,{idx:0})}}const{window:ze}=Ve;function oe(n,t,s){const e=n.slice();return e[19]=t[s],e[20]=t,e[21]=s,e}function ue(n,t,s){const e=n.slice();return e[19]=t[s],e[21]=s,e}function Je(n){let t,s,e,i,f,c;return t=new Te({props:{$$slots:{default:[Ze]},$$scope:{ctx:n}}}),t.$on("click",n[13]),e=new Se({props:{$$slots:{default:[Qe]},$$scope:{ctx:n}}}),e.$on("click",n[6]),f=new Ke({props:{idx:n[0]}}),{c(){B(t.$$.fragment),s=M(),B(e.$$.fragment),i=M(),B(f.$$.fragment)},l(r){D(t.$$.fragment,r),s=N(r),D(e.$$.fragment,r),i=N(r),D(f.$$.fragment,r)},m(r,m){S(t,r,m),I(r,s,m),S(e,r,m),I(r,i,m),S(f,r,m),c=!0},p(r,m){const l={};m&8388608&&(l.$$scope={dirty:m,ctx:r}),t.$set(l);const u={};m&8388608&&(u.$$scope={dirty:m,ctx:r}),e.$set(u);const $={};m&1&&($.idx=r[0]),f.$set($)},i(r){c||(v(t.$$.fragment,r),v(e.$$.fragment,r),v(f.$$.fragment,r),c=!0)},o(r){k(t.$$.fragment,r),k(e.$$.fragment,r),k(f.$$.fragment,r),c=!1},d(r){r&&(d(s),d(i)),A(t,r),A(e,r),A(f,r)}}}function Ye(n){let t,s,e,i,f,c,r,m="Click the map to add a critical, or select a critical to fill out data",l,u,$;t=new we({props:{$$slots:{default:[Xe]},$$scope:{ctx:n}}}),t.$on("click",n[9]),e=new Ee({}),f=new qe({});let y=z(n[2].criticalIssues),p=[];for(let a=0;a<y.length;a+=1)p[a]=ce(ue(n,y,a));return{c(){B(t.$$.fragment),s=M(),B(e.$$.fragment),i=M(),B(f.$$.fragment),c=M(),r=q("p"),r.textContent=m,l=M(),u=q("ol");for(let a=0;a<p.length;a+=1)p[a].c()},l(a){D(t.$$.fragment,a),s=N(a),D(e.$$.fragment,a),i=N(a),D(f.$$.fragment,a),c=N(a),r=P(a,"P",{"data-svelte-h":!0}),Ce(r)!=="svelte-uo4gf4"&&(r.textContent=m),l=N(a),u=P(a,"OL",{});var g=H(u);for(let w=0;w<p.length;w+=1)p[w].l(g);g.forEach(d)},m(a,g){S(t,a,g),I(a,s,g),S(e,a,g),I(a,i,g),S(f,a,g),I(a,c,g),I(a,r,g),I(a,l,g),I(a,u,g);for(let w=0;w<p.length;w+=1)p[w]&&p[w].m(u,null);$=!0},p(a,g){const w={};if(g&8388608&&(w.$$scope={dirty:g,ctx:a}),t.$set(w),g&38){y=z(a[2].criticalIssues);let _;for(_=0;_<y.length;_+=1){const C=ue(a,y,_);p[_]?p[_].p(C,g):(p[_]=ce(C),p[_].c(),p[_].m(u,null))}for(;_<p.length;_+=1)p[_].d(1);p.length=y.length}},i(a){$||(v(t.$$.fragment,a),v(e.$$.fragment,a),v(f.$$.fragment,a),$=!0)},o(a){k(t.$$.fragment,a),k(e.$$.fragment,a),k(f.$$.fragment,a),$=!1},d(a){a&&(d(s),d(i),d(c),d(r),d(l),d(u)),A(t,a),A(e,a),A(f,a),ge(p,a)}}}function Ze(n){let t;return{c(){t=F("Save")},l(s){t=G(s,"Save")},m(s,e){I(s,t,e)},d(s){s&&d(t)}}}function Qe(n){let t;return{c(){t=F("Delete")},l(s){t=G(s,"Delete")},m(s,e){I(s,t,e)},d(s){s&&d(t)}}}function Xe(n){let t;return{c(){t=F("Zoom to fit")},l(s){t=G(s,"Zoom to fit")},m(s,e){I(s,t,e)},d(s){s&&d(t)}}}function ce(n){let t,s,e=pe(n[19])+"",i,f,c,r;function m(){return n[10](n[21])}function l(){return n[11](n[21])}return{c(){t=q("li"),s=q("a"),i=F(e),f=M(),this.h()},l(u){t=P(u,"LI",{});var $=H(t);s=P($,"A",{href:!0});var y=H(s);i=G(y,e),y.forEach(d),f=N($),$.forEach(d),this.h()},h(){he(s,"href","#")},m(u,$){I(u,t,$),W(t,s),W(s,i),W(t,f),c||(r=[K(s,"click",m),K(s,"mouseenter",l),K(s,"mouseleave",n[12])],c=!0)},p(u,$){n=u,$&4&&e!==(e=pe(n[19])+"")&&Z(i,e)},d(u){u&&d(t),c=!1,Le(r)}}}function xe(n){let t,s,e=n[19].criticalIssue+"",i;return{c(){t=q("span"),s=F("C"),i=F(e),this.h()},l(f){t=P(f,"SPAN",{class:!0});var c=H(t);s=G(c,"C"),i=G(c,e),c.forEach(d),this.h()},h(){he(t,"class","dot svelte-124qmh9")},m(f,c){I(f,t,c),W(t,s),W(t,i)},p(f,c){c&4&&e!==(e=f[19].criticalIssue+"")&&Z(i,e)},d(f){f&&d(t)}}}function fe(n){let t,s,e;function i(m){n[14](m,n[19])}function f(){return n[15](n[21])}function c(){return n[16](n[21])}let r={draggable:!0,$$slots:{default:[xe]},$$scope:{ctx:n}};return n[19].point!==void 0&&(r.lngLat=n[19].point),t=new We({props:r}),V.push(()=>U(t,"lngLat",i)),t.$on("click",f),t.$on("dragend",c),{c(){B(t.$$.fragment)},l(m){D(t.$$.fragment,m)},m(m,l){S(t,m,l),e=!0},p(m,l){n=m;const u={};l&8388612&&(u.$$scope={dirty:l,ctx:n}),!s&&l&4&&(s=!0,u.lngLat=n[19].point,R(()=>s=!1)),t.$set(u)},i(m){e||(v(t.$$.fragment,m),e=!0)},o(m){k(t.$$.fragment,m),e=!1},d(m){A(t,m)}}}function et(n){let t,s;return t=new Oe({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){B(t.$$.fragment)},l(e){D(t.$$.fragment,e)},m(e,i){S(t,e,i),s=!0},p:Be,i(e){s||(v(t.$$.fragment,e),s=!0)},o(e){k(t.$$.fragment,e),s=!1},d(e){A(t,e)}}}function tt(n){let t,s,e,i,f,c=z(n[2].criticalIssues),r=[];for(let l=0;l<c.length;l+=1)r[l]=fe(oe(n,c,l));const m=l=>k(r[l],1,1,()=>{r[l]=null});return s=new Ge({props:{data:n[4],$$slots:{default:[et]},$$scope:{ctx:n}}}),i=new Pe({props:{map:n[3]}}),{c(){for(let l=0;l<r.length;l+=1)r[l].c();t=M(),B(s.$$.fragment),e=M(),B(i.$$.fragment)},l(l){for(let u=0;u<r.length;u+=1)r[u].l(l);t=N(l),D(s.$$.fragment,l),e=N(l),D(i.$$.fragment,l)},m(l,u){for(let $=0;$<r.length;$+=1)r[$]&&r[$].m(l,u);I(l,t,u),S(s,l,u),I(l,e,u),S(i,l,u),f=!0},p(l,u){if(u&36){c=z(l[2].criticalIssues);let p;for(p=0;p<c.length;p+=1){const a=oe(l,c,p);r[p]?(r[p].p(a,u),v(r[p],1)):(r[p]=fe(a),r[p].c(),v(r[p],1),r[p].m(t.parentNode,t))}for(Q(),p=c.length;p<r.length;p+=1)m(p);X()}const $={};u&16&&($.data=l[4]),u&8388608&&($.$$scope={dirty:u,ctx:l}),s.$set($);const y={};u&8&&(y.map=l[3]),i.$set(y)},i(l){if(!f){for(let u=0;u<c.length;u+=1)v(r[u]);v(s.$$.fragment,l),v(i.$$.fragment,l),f=!0}},o(l){r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)k(r[u]);k(s.$$.fragment,l),k(i.$$.fragment,l),f=!1},d(l){l&&(d(t),d(e)),ge(r,l),A(s,l),A(i,l)}}}function nt(n){let t,s,e,i,f,c,r,m,l,u,$;const y=[Ye,Je],p=[];function a(_,C){return _[0]==null?0:1}e=a(n),i=p[e]=y[e](n);function g(_){n[17](_)}let w={$$slots:{default:[tt]},$$scope:{ctx:n}};return n[3]!==void 0&&(w.map=n[3]),r=new Fe({props:w}),V.push(()=>U(r,"map",g)),{c(){t=q("div"),s=q("div"),i.c(),f=M(),c=q("div"),B(r.$$.fragment),this.h()},l(_){t=P(_,"DIV",{style:!0});var C=H(t);s=P(C,"DIV",{style:!0});var E=H(s);i.l(E),E.forEach(d),f=N(C),c=P(C,"DIV",{style:!0});var T=H(c);D(r.$$.fragment,T),T.forEach(d),C.forEach(d),this.h()},h(){O(s,"width","30%"),O(s,"overflow-y","scroll"),O(s,"padding","10px"),O(c,"position","relative"),O(c,"width","70%"),O(t,"display","flex"),O(t,"height","600px")},m(_,C){I(_,t,C),W(t,s),p[e].m(s,null),W(t,f),W(t,c),S(r,c,null),l=!0,u||($=K(ze,"keydown",n[8]),u=!0)},p(_,[C]){let E=e;e=a(_),e===E?p[e].p(_,C):(Q(),k(p[E],1,1,()=>{p[E]=null}),X(),i=p[e],i?i.p(_,C):(i=p[e]=y[e](_),i.c()),v(i,1),i.m(s,null));const T={};C&8388636&&(T.$$scope={dirty:C,ctx:_}),!m&&C&8&&(m=!0,T.map=_[3],R(()=>m=!1)),r.$set(T)},i(_){l||(v(i),v(r.$$.fragment,_),l=!0)},o(_){k(i),k(r.$$.fragment,_),l=!1},d(_){_&&d(t),p[e].d(),A(r),u=!1,$()}}}function st(n,t,s){let e=t??s,i={type:"FeatureCollection",features:[]};return e!=null&&i.features.push(ye(n[e].point)),i}function ye(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function pe(n){return`${n.criticalIssue||"Unknown critical"}: ${n.locationName||"???"}`}function it(n,t,s){let e,i;$e(n,j,h=>s(2,i=h));let f,c=null,r=null;function m(h){s(0,c=h),s(1,r=null)}function l(h){if(c!=null){s(0,c=null);return}de(j,i.criticalIssues=[...i.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:h.lngLat.toArray(),locationName:"",resolved:"",notes:""}],i),s(0,c=i.criticalIssues.length-1),s(1,r=null)}_e(()=>{f.on("click",l),$()}),Ie(()=>{f.off("click",l)});function u(){window.confirm("Delete this entry?")&&(i.criticalIssues.splice(c,1),j.set(i),s(0,c=null))}function $(h){if(i.criticalIssues.length>0){let b={type:"FeatureCollection",features:i.criticalIssues.map(Y=>ye(Y.point))};f.fitBounds(je(b),{padding:20,animate:!0})}}function y(h){c!=null&&h.key=="Escape"&&(h.stopPropagation(),s(0,c=null))}const p=()=>$(),a=h=>m(h),g=h=>s(1,r=h),w=()=>s(1,r=null),_=()=>s(0,c=null);function C(h,b){n.$$.not_equal(b.point,h)&&(b.point=h,j.set(i))}const E=h=>m(h),T=h=>m(h);function J(h){f=h,s(3,f)}return n.$$.update=()=>{n.$$.dirty&7&&s(4,e=st(i.criticalIssues,c,r))},[c,r,i,f,e,m,u,$,y,p,a,g,w,_,C,E,T,J]}class bt extends be{constructor(t){super(),ve(this,t,it,nt,me,{})}}export{bt as component};
