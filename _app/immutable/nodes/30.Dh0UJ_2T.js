import{s as _e,v as Y,x as re,l as ze,u as De,m as He,o as Re,H as ne,E as Ge,i as P,f as j,a9 as an,a8 as sn,k as pe,U as St,a7 as Ft,N as nt,e as x,c as ee,b as ie,r as Ae,a as z,g as D,w as te,h as se,z as un,p as fn,q as rt,t as V,d as X,j as Ee,n as cn}from"../chunks/scheduler.Bsni_e59.js";import{S as ye,i as be,e as oe,c as T,a as O,m as A,t as w,b as E,d as S,g as fe,f as ce}from"../chunks/index.CCfAUppz.js";import{e as Le}from"../chunks/each.ChCadThl.js";import{W as $t,S as ue}from"../chunks/WarningButton.D9QeV9gM.js";import{T as Bt}from"../chunks/TextInput.CHbK327s.js";import{s as K}from"../chunks/data.CZzh17rr.js";import{L as qt,g as Gt,e as mn,m as je,i as gn,f as Nt,M as hn,a as dn,G as pt,h as _t}from"../chunks/MapLibreMap.BmddNfth.js";import{c as $e}from"../chunks/colors.CYEpEtTL.js";import{D as pn}from"../chunks/DefaultButton.DyQsHGbh.js";import{T as zt}from"../chunks/TextArea.DbePhW6L.js";import{a as _n,B as yn,G as bn,S as vn,c as wn,M as yt}from"../chunks/GeoreferenceLayer.CvF4CGaD.js";import{p as kn}from"../chunks/index.U3noCibR.js";import{S as bt}from"../chunks/Select.N7F_8zcJ.js";function jn(t){let e;const n=t[15].default,r=ze(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&De(r,n,o,o[23],e?Re(n,o[23],l,null):He(o[23]),null)},i(o){e||(w(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function En(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[jn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new qt({props:l}),Y.push(()=>oe(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){T(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){A(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],re(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Ln(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Gt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:h}=e,{layout:u=void 0}=e,{filter:m=void 0}=e,{minzoom:c=void 0}=e,{maxzoom:g=void 0}=e,{hoverCursor:d=void 0}=e,{manageHoverState:k=!1}=e,{hovered:p=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:B=!0}=e;function F(C){p=C,n(0,p)}function y(C){ne.call(this,t,C)}function L(C){ne.call(this,t,C)}function I(C){ne.call(this,t,C)}function U(C){ne.call(this,t,C)}function q(C){ne.call(this,t,C)}function W(C){ne.call(this,t,C)}return t.$$set=C=>{"id"in C&&n(1,l=C.id),"source"in C&&n(2,i=C.source),"sourceLayer"in C&&n(3,a=C.sourceLayer),"beforeId"in C&&n(4,s=C.beforeId),"beforeLayerType"in C&&n(5,f=C.beforeLayerType),"paint"in C&&n(6,h=C.paint),"layout"in C&&n(7,u=C.layout),"filter"in C&&n(8,m=C.filter),"minzoom"in C&&n(9,c=C.minzoom),"maxzoom"in C&&n(10,g=C.maxzoom),"hoverCursor"in C&&n(11,d=C.hoverCursor),"manageHoverState"in C&&n(12,k=C.manageHoverState),"hovered"in C&&n(0,p=C.hovered),"eventsIfTopMost"in C&&n(13,v=C.eventsIfTopMost),"interactive"in C&&n(14,B=C.interactive),"$$scope"in C&&n(23,o=C.$$scope)},[p,l,i,a,s,f,h,u,m,c,g,d,k,v,B,r,F,y,L,I,U,q,W,o]}class Ye extends ye{constructor(e){super(),be(this,e,Ln,En,_e,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Cn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),vt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function wt(t){let e,n,r=(t[4]||t[3]instanceof je.Marker)&&kt(t);return{c(){e=x("div"),r&&r.c()},l(o){e=ee(o,"DIV",{});var l=ie(e);r&&r.l(l),l.forEach(j)},m(o,l){P(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof je.Marker?r?(r.p(o,l),l[0]&24&&w(r,1)):(r=kt(o),r.c(),w(r,1),r.m(e,null)):r&&(fe(),E(r,1,1,()=>{r=null}),ce())},i(o){n||(w(r),n=!0)},o(o){E(r),n=!1},d(o){o&&j(e),r&&r.d(),t[32](null)}}}function kt(t){let e;const n=t[30].default,r=ze(n,t,t[29],vt);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&De(r,n,o,o[29],e?Re(n,o[29],l,Cn):He(o[29]),vt)},i(o){e||(w(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function Mn(t){let e,n,r=t[9].default&&wt(t);return{c(){r&&r.c(),e=Ge()},l(o){r&&r.l(o),e=Ge()},m(o,l){r&&r.m(o,l),P(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&w(r,1)):(r=wt(o),r.c(),w(r,1),r.m(e.parentNode,e)):r&&(fe(),E(r,1,1,()=>{r=null}),ce())},i(o){n||(w(r),n=!0)},o(o){E(r),n=!1},d(o){o&&j(e),r&&r.d(o)}}}function Pn(t,e,n){let r,o,l,i,a,s,{$$slots:f={},$$scope:h}=e;const u=an(f);let{closeButton:m=void 0}=e,{closeOnClickOutside:c=!0}=e,{closeOnClickInside:g=!1}=e,{closeOnMove:d=!1}=e,{openOn:k="click"}=e,{openIfTopMost:p=!0}=e,{focusAfterOpen:v=!0}=e,{anchor:B=void 0}=e,{offset:F=void 0}=e,{popupClass:y=void 0}=e,{maxWidth:L=void 0}=e,{lngLat:I=void 0}=e,{html:U=void 0}=e,{open:q=!1}=e;const W=sn(),{map:C,popupTarget:M,layerEvent:ve,layer:Se,eventTopMost:Xe}=mn();pe(t,C,_=>n(2,l=_)),pe(t,M,_=>n(3,a=_)),pe(t,ve,_=>n(28,i=_)),pe(t,Se,_=>n(35,s=_));const Ke=["click","dblclick","contextmenu"];let $,we=!1,ae;function b(){if(!$)return;let _=$.getElement();!_||_===ae||(ae=_,k==="hover"&&(ae.style.pointerEvents="none"),ae.addEventListener("mouseenter",()=>{n(24,we=!0)},{passive:!0}),ae.addEventListener("mouseleave",()=>{n(24,we=!1)},{passive:!0}),ae.addEventListener("click",()=>{g&&n(0,q=!1)},{passive:!0}))}St(()=>{if(l)return l.on("click",Fe),l.on("contextmenu",Fe),typeof a=="string"&&(l.on("click",a,le),l.on("dblclick",a,le),l.on("contextmenu",a,le),l.on("mousemove",a,dt),l.on("mouseleave",a,ht),l.on("touchstart",a,mt),l.on("touchend",a,gt)),()=>{l!=null&&l.loaded()&&($==null||$.remove(),l.off("click",Fe),l.off("contextmenu",Fe),a instanceof je.Marker?a.getPopup()===$&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,le),l.off("dblclick",a,le),l.off("contextmenu",a,le),l.off("mousemove",a,dt),l.off("mouseleave",a,ht),l.off("touchstart",a,mt),l.off("touchend",a,gt)))}});function H(_){return p?!("marker"in _)&&!gn(_)&&Xe(_)!==s:!1}let R=null,J="normal";function le(_){_.type===k&&(H(_)||("layerType"in _?_.layerType==="deckgl"?(n(10,I=_.coordinate),n(4,R=_.object?[_.object]:null)):(n(10,I=_.lngLat),n(4,R=_.features??[])):(n(10,I=_.lngLat),n(4,R=_.features??[])),setTimeout(()=>n(0,q=!0))))}let ke=null;function mt(_){ke=_.point}function gt(_){if(!ke||k!=="hover")return;let Ze=ke.dist(_.point);ke=null,Ze<3&&(n(10,I=_.lngLat),n(4,R=_.features??[]),$.isOpen()?n(25,J="justOpened"):(n(25,J="opening"),n(0,q=!0)))}function ht(_){k!=="hover"||ke||J!=="normal"||(n(0,q=!1),n(4,R=null))}function dt(_){if(!(k!=="hover"||ke||J!=="normal")){if(H(_)){n(0,q=!1),n(4,R=null);return}n(0,q=!0),n(4,R=_.features??[]),n(10,I=_.lngLat)}}function Fe(_){if(J==="justOpened"){n(25,J="normal");return}if(!c)return;let Ze=[ae,a instanceof je.Marker?a==null?void 0:a.getElement():null];q&&$.isOpen()&&!Ze.some(Qe=>Qe==null?void 0:Qe.contains(_.originalEvent.target))&&(_.type==="contextmenu"&&k==="contextmenu"||_.type!=="contextmenu")&&n(0,q=!1)}Ft(()=>{l&&($!=null&&$.isOpen())&&$.remove()});let Pe;const on=()=>n(0,q=!1);function ln(_){Y[_?"unshift":"push"](()=>{Pe=_,n(1,Pe)})}return t.$$set=_=>{"closeButton"in _&&n(11,m=_.closeButton),"closeOnClickOutside"in _&&n(12,c=_.closeOnClickOutside),"closeOnClickInside"in _&&n(13,g=_.closeOnClickInside),"closeOnMove"in _&&n(14,d=_.closeOnMove),"openOn"in _&&n(15,k=_.openOn),"openIfTopMost"in _&&n(16,p=_.openIfTopMost),"focusAfterOpen"in _&&n(17,v=_.focusAfterOpen),"anchor"in _&&n(18,B=_.anchor),"offset"in _&&n(19,F=_.offset),"popupClass"in _&&n(20,y=_.popupClass),"maxWidth"in _&&n(21,L=_.maxWidth),"lngLat"in _&&n(10,I=_.lngLat),"html"in _&&n(22,U=_.html),"open"in _&&n(0,q=_.open),"$$scope"in _&&n(29,h=_.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=m??(!c&&!g)),t.$$.dirty[0]&146685952&&($||(n(23,$=new je.Popup({closeButton:r,closeOnClick:!1,closeOnMove:d,focusAfterOpen:v,maxWidth:L,className:y,anchor:B,offset:F})),ae=$.getElement(),$.on("open",()=>{n(0,q=!0),b(),W("open",$)}),$.on("close",()=>{n(0,q=!1),W("close",$)}),$.on("hover",()=>{W("hover",$)}))),t.$$.dirty[0]&8421384&&$&&a instanceof je.Marker&&(k==="click"?a.setPopup($):a.getPopup()===$&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Ke.includes(k)&&(i==null?void 0:i.type)===k&&(le(i),nt(ve,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=k==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&k==="hover"&&ve&&(o&&i&&(i.layerType==="deckgl"?(n(10,I=i.coordinate),n(4,R=i.object?[i.object]:null)):(n(10,I=i.lngLat),n(4,R=i.features??[]))),n(0,q=(o||we)??!1)),t.$$.dirty[0]&12582914&&(Pe?$.setDOMContent(Pe):U&&$.setHTML(U)),t.$$.dirty[0]&8389632&&I&&$.setLngLat(I),t.$$.dirty[0]&41943045&&l){let _=$.isOpen();q&&!_?($.addTo(l),J==="opening"&&n(25,J="justOpened")):!q&&_&&$.remove()}},[q,Pe,l,a,R,C,M,ve,Se,u,I,m,c,g,d,k,p,v,B,F,y,L,U,$,we,J,o,r,i,h,f,on,ln]}class In extends ye{constructor(e){super(),be(this,e,Pn,Mn,_e,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Tn(t){let e;const n=t[16].default,r=ze(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&De(r,n,o,o[24],e?Re(n,o[24],l,null):He(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){E(r,o),e=!1},d(o){r&&r.d(o)}}}function On(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Tn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new qt({props:l}),Y.push(()=>oe(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){T(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){A(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],re(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function An(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Gt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:h=void 0}=e,{layout:u=void 0}=e,{filter:m=void 0}=e,{applyToClusters:c=void 0}=e,{minzoom:g=void 0}=e,{maxzoom:d=void 0}=e,{hoverCursor:k=void 0}=e,{manageHoverState:p=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:B=!1}=e,{interactive:F=!0}=e;function y(M){v=M,n(0,v)}function L(M){ne.call(this,t,M)}function I(M){ne.call(this,t,M)}function U(M){ne.call(this,t,M)}function q(M){ne.call(this,t,M)}function W(M){ne.call(this,t,M)}function C(M){ne.call(this,t,M)}return t.$$set=M=>{"id"in M&&n(1,l=M.id),"source"in M&&n(2,i=M.source),"sourceLayer"in M&&n(3,a=M.sourceLayer),"beforeId"in M&&n(4,s=M.beforeId),"beforeLayerType"in M&&n(5,f=M.beforeLayerType),"paint"in M&&n(6,h=M.paint),"layout"in M&&n(7,u=M.layout),"filter"in M&&n(8,m=M.filter),"applyToClusters"in M&&n(9,c=M.applyToClusters),"minzoom"in M&&n(10,g=M.minzoom),"maxzoom"in M&&n(11,d=M.maxzoom),"hoverCursor"in M&&n(12,k=M.hoverCursor),"manageHoverState"in M&&n(13,p=M.manageHoverState),"hovered"in M&&n(0,v=M.hovered),"eventsIfTopMost"in M&&n(14,B=M.eventsIfTopMost),"interactive"in M&&n(15,F=M.interactive),"$$scope"in M&&n(24,o=M.$$scope)},[v,l,i,a,s,f,h,u,m,c,g,d,k,p,B,F,r,y,L,I,U,q,W,C,o]}class Sn extends ye{constructor(e){super(),be(this,e,An,On,_e,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Fn=t=>({props:t&8}),jt=t=>({props:qn(t[3])});function $n(t){let e,n;const r=t[1].default,o=ze(r,t,t[2],jt);return{c(){e=x("div"),o&&o.c(),this.h()},l(l){e=ee(l,"DIV",{class:!0});var i=ie(e);o&&o.l(i),i.forEach(j),this.h()},h(){Ae(e,"class","govuk-prose")},m(l,i){P(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&De(o,r,l,l[2],n?Re(r,l[2],i,Fn):He(l[2]),jt)},i(l){n||(w(o,l),n=!0)},o(l){E(o,l),n=!1},d(l){l&&j(e),o&&o.d(l)}}}function Bn(t){let e,n;return e=new In({props:{openOn:t[0],$$slots:{default:[$n,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function qn(t){return t?t[0].properties??{}:{}}function Gn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Dt extends ye{constructor(e){super(),be(this,e,Gn,Bn,_e,{openOn:0})}}var Nn=Object.defineProperty,G=(t,e)=>Nn(t,"name",{value:e,configurable:!0}),zn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ie(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=xe(e),o=xe(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ie(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ie(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Nt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ie(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};G(zn,"GeojsonEquality");function Ie(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}G(Ie,"sameLength");function xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}G(xe,"explode");var Z=63710088e-1,Ht={centimeters:Z*100,centimetres:Z*100,degrees:360/(2*Math.PI),feet:Z*3.28084,inches:Z*39.37,kilometers:Z/1e3,kilometres:Z/1e3,meters:Z,metres:Z,miles:Z/1609.344,millimeters:Z*1e3,millimetres:Z*1e3,nauticalmiles:Z/1852,radians:1,yards:Z*1.0936},Et={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function me(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}G(me,"feature");function Dn(t,e,n={}){switch(t){case"Point":return Ue(e).geometry;case"LineString":return it(e).geometry;case"Polygon":return ot(e).geometry;case"MultiPoint":return Ut(e).geometry;case"MultiLineString":return Rt(e).geometry;case"MultiPolygon":return Wt(e).geometry;default:throw new Error(t+" is invalid")}}G(Dn,"geometry");function Ue(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ce(t[0])||!Ce(t[1]))throw new Error("coordinates must contain numbers");return me({type:"Point",coordinates:t},e,n)}G(Ue,"point");function Hn(t,e,n={}){return We(t.map(r=>Ue(r,e)),n)}G(Hn,"points");function ot(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return me({type:"Polygon",coordinates:t},e,n)}G(ot,"polygon");function Rn(t,e,n={}){return We(t.map(r=>ot(r,e)),n)}G(Rn,"polygons");function it(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return me({type:"LineString",coordinates:t},e,n)}G(it,"lineString");function Un(t,e,n={}){return We(t.map(r=>it(r,e)),n)}G(Un,"lineStrings");function We(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}G(We,"featureCollection");function Rt(t,e,n={}){return me({type:"MultiLineString",coordinates:t},e,n)}G(Rt,"multiLineString");function Ut(t,e,n={}){return me({type:"MultiPoint",coordinates:t},e,n)}G(Ut,"multiPoint");function Wt(t,e,n={}){return me({type:"MultiPolygon",coordinates:t},e,n)}G(Wt,"multiPolygon");function Wn(t,e,n={}){return me({type:"GeometryCollection",geometries:t},e,n)}G(Wn,"geometryCollection");function Jn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}G(Jn,"round");function Jt(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t*n}G(Jt,"radiansToLength");function Je(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t/n}G(Je,"lengthToRadians");function Vn(t,e){return Ne(Je(t,e))}G(Vn,"lengthToDegrees");function Xn(t){let e=t%360;return e<0&&(e+=360),e}G(Xn,"bearingToAzimuth");function Ne(t){return t%(2*Math.PI)*180/Math.PI}G(Ne,"radiansToDegrees");function qe(t){return t%360*Math.PI/180}G(qe,"degreesToRadians");function Kn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Jt(Je(t,e),n)}G(Kn,"convertLength");function Zn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Et[e];if(!r)throw new Error("invalid original units");const o=Et[n];if(!o)throw new Error("invalid final units");return t/r*o}G(Zn,"convertArea");function Ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}G(Ce,"isNumber");function Qn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}G(Qn,"isObject");function Yn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ce(e))throw new Error("bbox must only contain numbers")})}G(Yn,"validateBBox");function xn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}G(xn,"validateId");var er=Object.defineProperty,ge=(t,e)=>er(t,"name",{value:e,configurable:!0});function Vt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ge(Vt,"getCoord");function tr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ge(tr,"getCoords");function Xt(t){if(t.length>1&&Ce(t[0])&&Ce(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Xt(t[0]);throw new Error("coordinates must only contain numbers")}ge(Xt,"containsNumber");function nr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ge(nr,"geojsonType");function rr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ge(rr,"featureOf");function or(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ge(or,"collectionOf");function ir(t){return t.type==="Feature"?t.geometry:t}ge(ir,"getGeom");function lr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ge(lr,"getType");var ar=Object.defineProperty,sr=(t,e)=>ar(t,"name",{value:e,configurable:!0});function Kt(t,e,n,r={}){const o=Vt(t),l=qe(o[0]),i=qe(o[1]),a=qe(n),s=Je(e,r.units),f=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),h=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(f)),u=Ne(h),m=Ne(f);return Ue([u,m],r.properties)}sr(Kt,"destination");var ur=Kt,fr=Object.defineProperty,N=(t,e)=>fr(t,"name",{value:e,configurable:!0}),cr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Te(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=et(e),o=et(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Te(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Te(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Nt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Te(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};N(cr,"GeojsonEquality");function Te(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}N(Te,"sameLength");function et(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}N(et,"explode");var Q=63710088e-1,Zt={centimeters:Q*100,centimetres:Q*100,degrees:360/(2*Math.PI),feet:Q*3.28084,inches:Q*39.37,kilometers:Q/1e3,kilometres:Q/1e3,meters:Q,metres:Q,miles:Q/1609.344,millimeters:Q*1e3,millimetres:Q*1e3,nauticalmiles:Q/1852,radians:1,yards:Q*1.0936},Lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function he(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}N(he,"feature");function mr(t,e,n={}){switch(t){case"Point":return lt(e).geometry;case"LineString":return st(e).geometry;case"Polygon":return at(e).geometry;case"MultiPoint":return Yt(e).geometry;case"MultiLineString":return Qt(e).geometry;case"MultiPolygon":return xt(e).geometry;default:throw new Error(t+" is invalid")}}N(mr,"geometry");function lt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Me(t[0])||!Me(t[1]))throw new Error("coordinates must contain numbers");return he({type:"Point",coordinates:t},e,n)}N(lt,"point");function gr(t,e,n={}){return Ve(t.map(r=>lt(r,e)),n)}N(gr,"points");function at(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return he({type:"Polygon",coordinates:t},e,n)}N(at,"polygon");function hr(t,e,n={}){return Ve(t.map(r=>at(r,e)),n)}N(hr,"polygons");function st(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return he({type:"LineString",coordinates:t},e,n)}N(st,"lineString");function dr(t,e,n={}){return Ve(t.map(r=>st(r,e)),n)}N(dr,"lineStrings");function Ve(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}N(Ve,"featureCollection");function Qt(t,e,n={}){return he({type:"MultiLineString",coordinates:t},e,n)}N(Qt,"multiLineString");function Yt(t,e,n={}){return he({type:"MultiPoint",coordinates:t},e,n)}N(Yt,"multiPoint");function xt(t,e,n={}){return he({type:"MultiPolygon",coordinates:t},e,n)}N(xt,"multiPolygon");function pr(t,e,n={}){return he({type:"GeometryCollection",geometries:t},e,n)}N(pr,"geometryCollection");function _r(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}N(_r,"round");function en(t,e="kilometers"){const n=Zt[e];if(!n)throw new Error(e+" units is invalid");return t*n}N(en,"radiansToLength");function ut(t,e="kilometers"){const n=Zt[e];if(!n)throw new Error(e+" units is invalid");return t/n}N(ut,"lengthToRadians");function yr(t,e){return ft(ut(t,e))}N(yr,"lengthToDegrees");function br(t){let e=t%360;return e<0&&(e+=360),e}N(br,"bearingToAzimuth");function ft(t){return t%(2*Math.PI)*180/Math.PI}N(ft,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}N(Oe,"degreesToRadians");function vr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return en(ut(t,e),n)}N(vr,"convertLength");function wr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Lt[e];if(!r)throw new Error("invalid original units");const o=Lt[n];if(!o)throw new Error("invalid final units");return t/r*o}N(wr,"convertArea");function Me(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}N(Me,"isNumber");function kr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}N(kr,"isObject");function jr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Me(e))throw new Error("bbox must only contain numbers")})}N(jr,"validateBBox");function Er(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}N(Er,"validateId");var Lr=Object.defineProperty,de=(t,e)=>Lr(t,"name",{value:e,configurable:!0});function tt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}de(tt,"getCoord");function Cr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}de(Cr,"getCoords");function tn(t){if(t.length>1&&Me(t[0])&&Me(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return tn(t[0]);throw new Error("coordinates must only contain numbers")}de(tn,"containsNumber");function Mr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}de(Mr,"geojsonType");function Pr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}de(Pr,"featureOf");function Ir(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}de(Ir,"collectionOf");function Tr(t){return t.type==="Feature"?t.geometry:t}de(Tr,"getGeom");function Or(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}de(Or,"getType");var Ar=Object.defineProperty,nn=(t,e)=>Ar(t,"name",{value:e,configurable:!0});function ct(t,e,n={}){if(n.final===!0)return rn(t,e);const r=tt(t),o=tt(e),l=Oe(r[0]),i=Oe(o[0]),a=Oe(r[1]),s=Oe(o[1]),f=Math.sin(i-l)*Math.cos(s),h=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ft(Math.atan2(f,h))}nn(ct,"bearing");function rn(t,e){let n=ct(e,t);return n=(n+180)%360,n}nn(rn,"calculateFinalBearing");var Sr=ct;function Fr(t){let e,n,r,o,l,i,a,s,f,h,u,m;function c(y){t[6](y)}let g={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(g.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new Bt({props:g}),Y.push(()=>oe(e,"value",c));function d(y){t[7](y)}let k={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(k.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new bt({props:k}),Y.push(()=>oe(o,"value",d));function p(y){t[8](y)}let v={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(v.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new bt({props:v}),Y.push(()=>oe(a,"value",p));function B(y){t[9](y)}let F={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(F.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),h=new zt({props:F}),Y.push(()=>oe(h,"value",B)),{c(){T(e.$$.fragment),r=z(),T(o.$$.fragment),i=z(),T(a.$$.fragment),f=z(),T(h.$$.fragment)},l(y){O(e.$$.fragment,y),r=D(y),O(o.$$.fragment,y),i=D(y),O(a.$$.fragment,y),f=D(y),O(h.$$.fragment,y)},m(y,L){A(e,y,L),P(y,r,L),A(o,y,L),P(y,i,L),A(a,y,L),P(y,f,L),A(h,y,L),m=!0},p(y,[L]){const I={};!n&&L&15&&(n=!0,I.value=y[3].jat[y[0]][y[1]].movements[y[2]].name,re(()=>n=!1)),e.$set(I);const U={};!l&&L&15&&(l=!0,U.value=y[3].jat[y[0]][y[1]].movements[y[2]].kind,re(()=>l=!1)),o.$set(U);const q={};!s&&L&15&&(s=!0,q.value=y[3].jat[y[0]][y[1]].movements[y[2]].score,re(()=>s=!1)),a.$set(q);const W={};!u&&L&15&&(u=!0,W.value=y[3].jat[y[0]][y[1]].movements[y[2]].notes,re(()=>u=!1)),h.$set(W)},i(y){m||(w(e.$$.fragment,y),w(o.$$.fragment,y),w(a.$$.fragment,y),w(h.$$.fragment,y),m=!0)},o(y){E(e.$$.fragment,y),E(o.$$.fragment,y),E(a.$$.fragment,y),E(h.$$.fragment,y),m=!1},d(y){y&&(j(r),j(i),j(f)),S(e,y),S(o,y),S(a,y),S(h,y)}}}function $r(t,e,n){let r;pe(t,K,c=>n(3,r=c));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=kn(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function f(c){t.$$.not_equal(r.jat[o][l].movements[i].name,c)&&(r.jat[o][l].movements[i].name=c,K.set(r))}function h(c){t.$$.not_equal(r.jat[o][l].movements[i].kind,c)&&(r.jat[o][l].movements[i].kind=c,K.set(r))}function u(c){t.$$.not_equal(r.jat[o][l].movements[i].score,c)&&(r.jat[o][l].movements[i].score=c,K.set(r))}function m(c){t.$$.not_equal(r.jat[o][l].movements[i].notes,c)&&(r.jat[o][l].movements[i].notes=c,K.set(r))}return t.$$set=c=>{"junctionIdx"in c&&n(0,o=c.junctionIdx),"stage"in c&&n(1,l=c.stage),"idx"in c&&n(2,i=c.idx)},[o,l,i,r,a,s,f,h,u,m]}class Br extends ye{constructor(e){super(),be(this,e,$r,Fr,_e,{junctionIdx:0,stage:1,idx:2})}}const{window:qr}=dn;function Ct(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function Mt(t,e,n){const r=t.slice();return r[34]=e[n],r[36]=n,r}function Gr(t){let e,n,r,o,l,i;return e=new pn({props:{$$slots:{default:[zr]},$$scope:{ctx:t}}}),e.$on("click",t[21]),r=new $t({props:{$$slots:{default:[Dr]},$$scope:{ctx:t}}}),r.$on("click",t[12]),l=new Br({props:{junctionIdx:t[0],stage:t[1],idx:t[2]}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment)},l(a){O(e.$$.fragment,a),n=D(a),O(r.$$.fragment,a),o=D(a),O(l.$$.fragment,a)},m(a,s){A(e,a,s),P(a,n,s),A(r,a,s),P(a,o,s),A(l,a,s),i=!0},p(a,s){const f={};s[1]&128&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const h={};s[1]&128&&(h.$$scope={dirty:s,ctx:a}),r.$set(h);const u={};s[0]&1&&(u.junctionIdx=a[0]),s[0]&2&&(u.stage=a[1]),s[0]&4&&(u.idx=a[2]),l.$set(u)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(l.$$.fragment,a),i=!1},d(a){a&&(j(n),j(o)),S(e,a),S(r,a),S(l,a)}}}function Nr(t){let e,n,r,o,l,i,a,s,f="Movements",h,u,m;e=new ue({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new yn({}),l=new bn({});let c=t[5]&&Pt(t),g=Le(t[4].jat[t[0]][t[1]].movements),d=[];for(let p=0;p<g.length;p+=1)d[p]=It(Mt(t,g,p));const k=p=>E(d[p],1,1,()=>{d[p]=null});return{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment),i=z(),c&&c.c(),a=z(),s=x("h3"),s.textContent=f,h=z(),u=x("ol");for(let p=0;p<d.length;p+=1)d[p].c()},l(p){O(e.$$.fragment,p),n=D(p),O(r.$$.fragment,p),o=D(p),O(l.$$.fragment,p),i=D(p),c&&c.l(p),a=D(p),s=ee(p,"H3",{"data-svelte-h":!0}),fn(s)!=="svelte-1dc52s8"&&(s.textContent=f),h=D(p),u=ee(p,"OL",{});var v=ie(u);for(let B=0;B<d.length;B+=1)d[B].l(v);v.forEach(j)},m(p,v){A(e,p,v),P(p,n,v),A(r,p,v),P(p,o,v),A(l,p,v),P(p,i,v),c&&c.m(p,v),P(p,a,v),P(p,s,v),P(p,h,v),P(p,u,v);for(let B=0;B<d.length;B+=1)d[B]&&d[B].m(u,null);m=!0},p(p,v){const B={};if(v[1]&128&&(B.$$scope={dirty:v,ctx:p}),e.$set(B),p[5]?c?(c.p(p,v),v[0]&32&&w(c,1)):(c=Pt(p),c.c(),w(c,1),c.m(a.parentNode,a)):c&&(fe(),E(c,1,1,()=>{c=null}),ce()),v[0]&539){g=Le(p[4].jat[p[0]][p[1]].movements);let F;for(F=0;F<g.length;F+=1){const y=Mt(p,g,F);d[F]?(d[F].p(y,v),w(d[F],1)):(d[F]=It(y),d[F].c(),w(d[F],1),d[F].m(u,null))}for(fe(),F=g.length;F<d.length;F+=1)k(F);ce()}},i(p){if(!m){w(e.$$.fragment,p),w(r.$$.fragment,p),w(l.$$.fragment,p),w(c);for(let v=0;v<g.length;v+=1)w(d[v]);m=!0}},o(p){E(e.$$.fragment,p),E(r.$$.fragment,p),E(l.$$.fragment,p),E(c),d=d.filter(Boolean);for(let v=0;v<d.length;v+=1)E(d[v]);m=!1},d(p){p&&(j(n),j(o),j(i),j(a),j(s),j(h),j(u)),S(e,p),S(r,p),S(l,p),c&&c.d(p),rt(d,p)}}}function zr(t){let e;return{c(){e=V("Save")},l(n){e=X(n,"Save")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function Dr(t){let e;return{c(){e=V("Delete")},l(n){e=X(n,"Delete")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function Hr(t){let e;return{c(){e=V("Zoom to fit")},l(n){e=X(n,"Zoom to fit")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function Pt(t){let e,n,r;function o(i){t[17](i)}let l={map:t[5]};return t[6]!==void 0&&(l.enabled=t[6]),e=new vn({props:l}),Y.push(()=>oe(e,"enabled",o)),{c(){T(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,a){A(e,i,a),r=!0},p(i,a){const s={};a[0]&32&&(s.map=i[5]),!n&&a[0]&64&&(n=!0,s.enabled=i[6],re(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){E(e.$$.fragment,i),r=!1},d(i){S(e,i)}}}function Rr(t){let e=(t[34].name||"Unnamed movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){P(r,n,o)},p(r,o){o[0]&19&&e!==(e=(r[34].name||"Unnamed movement")+"")&&Ee(n,e)},d(r){r&&j(n)}}}function It(t){let e,n,r,o;function l(){return t[18](t[36])}function i(){return t[19](t[36])}return n=new ue({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[20]),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(a){e=ee(a,"LI",{});var s=ie(e);O(n.$$.fragment,s),r=D(s),s.forEach(j)},m(a,s){P(a,e,s),A(n,e,null),se(e,r),o=!0},p(a,s){t=a;const f={};s[0]&19|s[1]&128&&(f.$$scope={dirty:s,ctx:t}),n.$set(f)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){E(n.$$.fragment,a),o=!1},d(a){a&&j(e),S(n)}}}function Ur(t){let e,n;return{c(){e=x("span"),this.h()},l(r){e=ee(r,"SPAN",{class:!0,style:!0}),ie(e).forEach(j),this.h()},h(){Ae(e,"class","dot svelte-1kvjd2"),Ae(e,"style",n=`background-color: ${t[8][t[34].score]}`),te(e,"opacity",t[34].kind=="pedestrian"?"0%":"100%")},m(r,o){P(r,e,o)},p(r,o){o[0]&19&&n!==(n=`background-color: ${r[8][r[34].score]}`)&&Ae(e,"style",n);const l=o[0]&19;(o[0]&19||l)&&te(e,"opacity",r[34].kind=="pedestrian"?"0%":"100%")},d(r){r&&j(e)}}}function Wr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(j),this.h()},h(){Ae(e,"class","dot svelte-1kvjd2"),te(e,"background-color",t[8][t[34].score]),te(e,"opacity","0%")},m(n,r){P(n,e,r)},p(n,r){r[0]&19&&te(e,"background-color",n[8][n[34].score])},d(n){n&&j(e)}}}function Tt(t){let e,n,r,o,l,i;function a(d){t[22](d,t[34])}function s(){return t[23](t[36])}function f(){return t[24](t[36])}let h={draggable:!0,$$slots:{default:[Ur]},$$scope:{ctx:t}};t[34].point1!==void 0&&(h.lngLat=t[34].point1),e=new yt({props:h}),Y.push(()=>oe(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",f);function u(d){t[25](d,t[34])}function m(){return t[26](t[36])}function c(){return t[27](t[36])}let g={draggable:!0,$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[34].point2!==void 0&&(g.lngLat=t[34].point2),o=new yt({props:g}),Y.push(()=>oe(o,"lngLat",u)),o.$on("dragend",m),o.$on("click",c),{c(){T(e.$$.fragment),r=z(),T(o.$$.fragment)},l(d){O(e.$$.fragment,d),r=D(d),O(o.$$.fragment,d)},m(d,k){A(e,d,k),P(d,r,k),A(o,d,k),i=!0},p(d,k){t=d;const p={};k[0]&19|k[1]&128&&(p.$$scope={dirty:k,ctx:t}),!n&&k[0]&19&&(n=!0,p.lngLat=t[34].point1,re(()=>n=!1)),e.$set(p);const v={};k[0]&19|k[1]&128&&(v.$$scope={dirty:k,ctx:t}),!l&&k[0]&19&&(l=!0,v.lngLat=t[34].point2,re(()=>l=!1)),o.$set(v)},i(d){i||(w(e.$$.fragment,d),w(o.$$.fragment,d),i=!0)},o(d){E(e.$$.fragment,d),E(o.$$.fragment,d),i=!1},d(d){d&&j(r),S(e,d),S(o,d)}}}function Jr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){P(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&Ee(n,e)},d(r){r&&j(n)}}}function Vr(t){let e,n;return e=new Dt({props:{$$slots:{default:[Jr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p(r,o){const l={};o[1]&132&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Xr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){P(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&Ee(n,e)},d(r){r&&j(n)}}}function Kr(t){let e,n;return e=new Dt({props:{$$slots:{default:[Xr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p(r,o){const l={};o[1]&132&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Zr(t){let e,n,r,o,l,i;return e=new Ye({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":_t(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[10]),r=new Ye({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":_t(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Kr]},$$scope:{ctx:t}}}),r.$on("click",t[10]),l=new Sn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment)},l(a){O(e.$$.fragment,a),n=D(a),O(r.$$.fragment,a),o=D(a),O(l.$$.fragment,a)},m(a,s){A(e,a,s),P(a,n,s),A(r,a,s),P(a,o,s),A(l,a,s),i=!0},p(a,s){const f={};s[1]&128&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const h={};s[1]&128&&(h.$$scope={dirty:s,ctx:a}),r.$set(h)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){E(e.$$.fragment,a),E(r.$$.fragment,a),E(l.$$.fragment,a),i=!1},d(a){a&&(j(n),j(o)),S(e,a),S(r,a),S(l,a)}}}function Qr(t){let e,n;return e=new Ye({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){T(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,o){A(e,r,o),n=!0},p:cn,i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){E(e.$$.fragment,r),n=!1},d(r){S(e,r)}}}function Yr(t){let e,n,r,o,l,i,a,s=Le(t[4].jat[t[0]][t[1]].movements),f=[];for(let u=0;u<s.length;u+=1)f[u]=Tt(Ct(t,s,u));const h=u=>E(f[u],1,1,()=>{f[u]=null});return n=new pt({props:{data:t[11](t[4].jat[t[0]][t[1]].movements),$$slots:{default:[Zr]},$$scope:{ctx:t}}}),o=new pt({props:{data:t[7],$$slots:{default:[Qr]},$$scope:{ctx:t}}}),i=new wn({props:{map:t[5]}}),{c(){for(let u=0;u<f.length;u+=1)f[u].c();e=z(),T(n.$$.fragment),r=z(),T(o.$$.fragment),l=z(),T(i.$$.fragment)},l(u){for(let m=0;m<f.length;m+=1)f[m].l(u);e=D(u),O(n.$$.fragment,u),r=D(u),O(o.$$.fragment,u),l=D(u),O(i.$$.fragment,u)},m(u,m){for(let c=0;c<f.length;c+=1)f[c]&&f[c].m(u,m);P(u,e,m),A(n,u,m),P(u,r,m),A(o,u,m),P(u,l,m),A(i,u,m),a=!0},p(u,m){if(m[0]&787){s=Le(u[4].jat[u[0]][u[1]].movements);let k;for(k=0;k<s.length;k+=1){const p=Ct(u,s,k);f[k]?(f[k].p(p,m),w(f[k],1)):(f[k]=Tt(p),f[k].c(),w(f[k],1),f[k].m(e.parentNode,e))}for(fe(),k=s.length;k<f.length;k+=1)h(k);ce()}const c={};m[0]&19&&(c.data=u[11](u[4].jat[u[0]][u[1]].movements)),m[1]&128&&(c.$$scope={dirty:m,ctx:u}),n.$set(c);const g={};m[0]&128&&(g.data=u[7]),m[1]&128&&(g.$$scope={dirty:m,ctx:u}),o.$set(g);const d={};m[0]&32&&(d.map=u[5]),i.$set(d)},i(u){if(!a){for(let m=0;m<s.length;m+=1)w(f[m]);w(n.$$.fragment,u),w(o.$$.fragment,u),w(i.$$.fragment,u),a=!0}},o(u){f=f.filter(Boolean);for(let m=0;m<f.length;m+=1)E(f[m]);E(n.$$.fragment,u),E(o.$$.fragment,u),E(i.$$.fragment,u),a=!1},d(u){u&&(j(e),j(r),j(l)),rt(f,u),S(n,u),S(o,u),S(i,u)}}}function xr(t){let e,n,r,o,l,i,a,s,f,h,u,m,c,g;function d(L){t[15](L)}let k={label:"Commentary / Notes"};t[4].jat[t[0]][t[1]].notes!==void 0&&(k.value=t[4].jat[t[0]][t[1]].notes),e=new zt({props:k}),Y.push(()=>oe(e,"value",d));const p=[Nr,Gr],v=[];function B(L,I){return L[2]==null?0:1}i=B(t),a=v[i]=p[i](t);function F(L){t[28](L)}let y={$$slots:{default:[Yr]},$$scope:{ctx:t}};return t[5]!==void 0&&(y.map=t[5]),h=new hn({props:y}),Y.push(()=>oe(h,"map",F)),{c(){T(e.$$.fragment),r=z(),o=x("div"),l=x("div"),a.c(),s=z(),f=x("div"),T(h.$$.fragment),this.h()},l(L){O(e.$$.fragment,L),r=D(L),o=ee(L,"DIV",{style:!0});var I=ie(o);l=ee(I,"DIV",{style:!0});var U=ie(l);a.l(U),U.forEach(j),s=D(I),f=ee(I,"DIV",{style:!0});var q=ie(f);O(h.$$.fragment,q),q.forEach(j),I.forEach(j),this.h()},h(){te(l,"width","30%"),te(l,"overflow-y","scroll"),te(l,"padding","10px"),te(f,"position","relative"),te(f,"width","100%"),te(o,"display","flex"),te(o,"height","80vh")},m(L,I){A(e,L,I),P(L,r,I),P(L,o,I),se(o,l),v[i].m(l,null),se(o,s),se(o,f),A(h,f,null),m=!0,c||(g=un(qr,"keydown",t[14]),c=!0)},p(L,I){const U={};!n&&I[0]&19&&(n=!0,U.value=L[4].jat[L[0]][L[1]].notes,re(()=>n=!1)),e.$set(U);let q=i;i=B(L),i===q?v[i].p(L,I):(fe(),E(v[q],1,1,()=>{v[q]=null}),ce(),a=v[i],a?a.p(L,I):(a=v[i]=p[i](L),a.c()),w(a,1),a.m(l,null));const W={};I[0]&179|I[1]&128&&(W.$$scope={dirty:I,ctx:L}),!u&&I[0]&32&&(u=!0,W.map=L[5],re(()=>u=!1)),h.$set(W)},i(L){m||(w(e.$$.fragment,L),w(a),w(h.$$.fragment,L),m=!0)},o(L){E(e.$$.fragment,L),E(a),E(h.$$.fragment,L),m=!1},d(L){L&&(j(r),j(o)),S(e,L),v[i].d(),S(h),c=!1,g()}}}function eo(t,e,n){let r,o;pe(t,K,b=>n(4,o=b));let{junctionIdx:l}=e,{stage:i}=e,a,s=null,f=null,h=!1,u={0:$e.red.background,1:$e.amber.background,2:$e.green.background,X:$e.critical.background};function m(b,H,R){let J={type:"FeatureCollection",features:[]},le=H??R;return le!=null&&J.features.push(p(b.jat[l][i].movements[le],le)),J}function c(b){n(2,s=b),n(3,f=null)}function g(b){if(!h){for(let H of a.queryRenderedFeatures(b.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(s!=null){n(2,s=null);return}nt(K,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:b.lngLat.toArray(),point2:ur(b.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(2,s=o.jat[l][i].movements.length-1),n(3,f=null)}}function d(b){c(b.detail.features[0].id)}St(()=>{a.on("click",g),F(!1)}),Ft(()=>{a.off("click",g)});function k(b){let H={type:"FeatureCollection",features:b.map((R,J)=>p(R,J))};for(let R of b)if(H.features.push(v(R,H.features.length)),R.kind=="pedestrian"){let J={...R,point1:R.point2,point2:R.point1};H.features.push(v(J,H.features.length))}return H}function p(b,H){return{type:"Feature",id:H,properties:{name:b.name,kind:b.kind,color:u[b.score]},geometry:{type:"LineString",coordinates:[b.point1,b.point2]}}}function v(b,H){return{type:"Feature",id:H,properties:{kind:b.kind,color:u[b.score],angle:Sr(b.point1,b.point2)},geometry:{type:"Point",coordinates:b.point2}}}function B(){window.confirm("Delete this movement?")&&(o.jat[l][i].movements.splice(s,1),K.set(o),n(2,s=null))}function F(b){o.jat[l][i].movements.length>0&&a.fitBounds(_n(k(o.jat[l][i].movements)),{padding:20,animate:b})}function y(b){s!=null&&b.key=="Escape"?(b.stopPropagation(),n(2,s=null)):s!=null&&b.key=="Delete"&&B()}function L(b){t.$$.not_equal(o.jat[l][i].notes,b)&&(o.jat[l][i].notes=b,K.set(o))}const I=()=>F(!0);function U(b){h=b,n(6,h)}const q=b=>c(b),W=b=>n(3,f=b),C=()=>n(3,f=null),M=()=>n(2,s=null);function ve(b,H){t.$$.not_equal(H.point1,b)&&(H.point1=b,K.set(o))}const Se=b=>c(b),Xe=b=>c(b);function Ke(b,H){t.$$.not_equal(H.point2,b)&&(H.point2=b,K.set(o))}const $=b=>c(b),we=b=>c(b);function ae(b){a=b,n(5,a)}return t.$$set=b=>{"junctionIdx"in b&&n(0,l=b.junctionIdx),"stage"in b&&n(1,i=b.stage)},t.$$.update=()=>{t.$$.dirty[0]&28&&n(7,r=m(o,s,f))},[l,i,s,f,o,a,h,r,u,c,d,k,B,F,y,L,I,U,q,W,C,M,ve,Se,Xe,Ke,$,we,ae]}class to extends ye{constructor(e){super(),be(this,e,eo,xr,_e,{junctionIdx:0,stage:1},null,[-1,-1])}}function Ot(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function no(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,f,h,u;return s=new ue({props:{$$slots:{default:[io]},$$scope:{ctx:t}}}),s.$on("click",t[10]),h=new to({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=x("h2"),r=V(n),o=V(" - "),i=V(l),a=z(),T(s.$$.fragment),f=z(),T(h.$$.fragment)},l(m){e=ee(m,"H2",{});var c=ie(e);r=X(c,n),o=X(c," - "),i=X(c,l),c.forEach(j),a=D(m),O(s.$$.fragment,m),f=D(m),O(h.$$.fragment,m)},m(m,c){P(m,e,c),se(e,r),se(e,o),se(e,i),P(m,a,c),A(s,m,c),P(m,f,c),A(h,m,c),u=!0},p(m,c){(!u||c&3)&&n!==(n=(m[1].jat[m[0].idx].name||"Untitled junction")+"")&&Ee(r,n),(!u||c&1)&&l!==(l=m[0].stage+"")&&Ee(i,l);const g={};c&16384&&(g.$$scope={dirty:c,ctx:m}),s.$set(g);const d={};c&1&&(d.junctionIdx=m[0].idx),c&1&&(d.stage=m[0].stage),h.$set(d)},i(m){u||(w(s.$$.fragment,m),w(h.$$.fragment,m),u=!0)},o(m){E(s.$$.fragment,m),E(h.$$.fragment,m),u=!1},d(m){m&&(j(e),j(a),j(f)),S(s,m),S(h,m)}}}function ro(t){let e,n,r,o,l,i,a,s,f,h,u;e=new ue({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new $t({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function m(g){t[7](g)}let c={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(c.value=t[1].jat[t[0].idx].name),l=new Bt({props:c}),Y.push(()=>oe(l,"value",m)),s=new ue({props:{$$slots:{default:[so]},$$scope:{ctx:t}}}),s.$on("click",t[8]),h=new ue({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),h.$on("click",t[9]),{c(){T(e.$$.fragment),n=z(),T(r.$$.fragment),o=z(),T(l.$$.fragment),a=z(),T(s.$$.fragment),f=z(),T(h.$$.fragment)},l(g){O(e.$$.fragment,g),n=D(g),O(r.$$.fragment,g),o=D(g),O(l.$$.fragment,g),a=D(g),O(s.$$.fragment,g),f=D(g),O(h.$$.fragment,g)},m(g,d){A(e,g,d),P(g,n,d),A(r,g,d),P(g,o,d),A(l,g,d),P(g,a,d),A(s,g,d),P(g,f,d),A(h,g,d),u=!0},p(g,d){const k={};d&16384&&(k.$$scope={dirty:d,ctx:g}),e.$set(k);const p={};d&16384&&(p.$$scope={dirty:d,ctx:g}),r.$set(p);const v={};!i&&d&3&&(i=!0,v.value=g[1].jat[g[0].idx].name,re(()=>i=!1)),l.$set(v);const B={};d&16384&&(B.$$scope={dirty:d,ctx:g}),s.$set(B);const F={};d&16384&&(F.$$scope={dirty:d,ctx:g}),h.$set(F)},i(g){u||(w(e.$$.fragment,g),w(r.$$.fragment,g),w(l.$$.fragment,g),w(s.$$.fragment,g),w(h.$$.fragment,g),u=!0)},o(g){E(e.$$.fragment,g),E(r.$$.fragment,g),E(l.$$.fragment,g),E(s.$$.fragment,g),E(h.$$.fragment,g),u=!1},d(g){g&&(j(n),j(o),j(a),j(f)),S(e,g),S(r,g),S(l,g),S(s,g),S(h,g)}}}function oo(t){let e,n,r,o;e=new ue({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=Le(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=At(Ot(t,l,s));const a=s=>E(i[s],1,1,()=>{i[s]=null});return{c(){T(e.$$.fragment),n=z(),r=x("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){O(e.$$.fragment,s),n=D(s),r=ee(s,"OL",{});var f=ie(r);for(let h=0;h<i.length;h+=1)i[h].l(f);f.forEach(j)},m(s,f){A(e,s,f),P(s,n,f),P(s,r,f);for(let h=0;h<i.length;h+=1)i[h]&&i[h].m(r,null);o=!0},p(s,f){const h={};if(f&16384&&(h.$$scope={dirty:f,ctx:s}),e.$set(h),f&3){l=Le(s[1].jat);let u;for(u=0;u<l.length;u+=1){const m=Ot(s,l,u);i[u]?(i[u].p(m,f),w(i[u],1)):(i[u]=At(m),i[u].c(),w(i[u],1),i[u].m(r,null))}for(fe(),u=l.length;u<i.length;u+=1)a(u);ce()}},i(s){if(!o){w(e.$$.fragment,s);for(let f=0;f<l.length;f+=1)w(i[f]);o=!0}},o(s){E(e.$$.fragment,s),i=i.filter(Boolean);for(let f=0;f<i.length;f+=1)E(i[f]);o=!1},d(s){s&&(j(n),j(r)),S(e,s),rt(i,s)}}}function io(t){let e;return{c(){e=V("Back")},l(n){e=X(n,"Back")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function lo(t){let e;return{c(){e=V("Back to all junctions")},l(n){e=X(n,"Back to all junctions")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function ao(t){let e;return{c(){e=V("Delete")},l(n){e=X(n,"Delete")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function so(t){let e;return{c(){e=V("Existing")},l(n){e=X(n,"Existing")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function uo(t){let e;return{c(){e=V("Proposed")},l(n){e=X(n,"Proposed")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function fo(t){let e;return{c(){e=V("Add new junction")},l(n){e=X(n,"Add new junction")},m(n,r){P(n,e,r)},d(n){n&&j(e)}}}function co(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=V(e)},l(r){n=X(r,e)},m(r,o){P(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&Ee(n,e)},d(r){r&&j(n)}}}function At(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new ue({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=x("li"),T(n.$$.fragment),r=z()},l(i){e=ee(i,"LI",{});var a=ie(e);O(n.$$.fragment,a),r=D(a),a.forEach(j)},m(i,a){P(i,e,a),A(n,e,null),se(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){E(n.$$.fragment,i),o=!1},d(i){i&&j(e),S(n)}}}function mo(t){let e,n,r,o;const l=[oo,ro,no],i=[];function a(s,f){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=Ge()},l(s){n&&n.l(s),r=Ge()},m(s,f){~e&&i[e].m(s,f),P(s,r,f),o=!0},p(s,[f]){let h=e;e=a(s),e===h?~e&&i[e].p(s,f):(n&&(fe(),E(i[h],1,1,()=>{i[h]=null}),ce()),~e?(n=i[e],n?n.p(s,f):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){E(n),o=!1},d(s){s&&j(r),~e&&i[e].d(s)}}}function Be(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function go(t,e,n){let r;pe(t,K,g=>n(1,r=g));let o={kind:"list"};function l(){nt(K,r.jat=[...r.jat,{name:"",existing:{movements:[],notes:""},proposed:{movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(g){window.confirm("Delete this junction?")&&(r.jat.splice(g,1),K.set(r),n(0,o={kind:"list"}))}const a=g=>n(0,o={kind:"junction",idx:g}),s=()=>n(0,o={kind:"list"}),f=()=>i(Be(o));function h(g){t.$$.not_equal(r.jat[o.idx].name,g)&&(r.jat[o.idx].name=g,K.set(r))}return[o,r,l,i,a,s,f,h,()=>n(0,o={kind:"map",idx:Be(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:Be(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:Be(o)})]}class To extends ye{constructor(e){super(),be(this,e,go,mo,_e,{})}}export{To as component};
