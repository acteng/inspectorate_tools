import{s as K,e as J,a as p,c as R,m as T,g as h,i as f,f as g,k as j,t as N,d as O}from"../chunks/scheduler.BJ06nkRu.js";import{S as D,i as U,c as x,a as b,m as w,t as S,b as _,d as L}from"../chunks/index.Dmc4uC9p.js";import{e as B}from"../chunks/da_log.Dg19ACKq.js";import{s as M}from"../chunks/data.BvYhqLrY.js";import{D as A}from"../chunks/DefaultButton.CRXvyloG.js";/* empty css                                                               */import{T as P}from"../chunks/TextArea.dqrL6eGj.js";import{E as H}from"../chunks/exceljs.min.BuyXGIGS.js";import{g as V,a as G}from"../chunks/lists.djxH55N_.js";const q=""+new URL("../assets/blank_route_check.CfWjwSGn.xlsx",import.meta.url).href;async function z(e){console.log("Loading blank route check xlsx");let l=await(await fetch(q)).arrayBuffer(),t=new H.Workbook;await t.xlsx.load(l),t.eachSheet((s,r)=>{s.conditionalFormattings=[]}),Q(e,t),X(e,t),Y(e,t),Z(e,t),v(e.safetyCheck,t,"3.1 Safety Check",["J","K","L","M"],y([[13,28]])),v(e.streetCheck,t,"4.1 Street Check",["J","K","L","M"],y([[13,19],[23,25],[29,34],[38,43],[47,50]])),v(e.streetPlacemakingCheck,t,"4.2 Street Placemaking Check",["I","J","K","L"],y([[13,15],[19,21],[25,34],[38,47]])),v(e.pathCheck,t,"5.1 Path Check",["J","K","L","M"],y([[15,19],[23,33],[37,40],[44,48],[52,56]])),v(e.pathPlacemakingCheck,t,"5.2 Path Placemaking Check",["I","J","K","L"],y([[12,14],[20,22],[26,29],[33,41]])),console.log("Writing route check xlsx");let o=await t.xlsx.writeBuffer();ee(o,"out.xlsx")}function Q(e,n){let l=n.getWorksheet("1. Summary of Scheme");l.getCell("C6").value=e.summary.dateDesignReview,l.getCell("C7").value=e.summary.schemeReference,l.getCell("C8").value=e.summary.schemeName,l.getCell("C9").value=e.summary.schemeSummary,l.getCell("C10").value=e.summary.schemeInfoReviewed,l.getCell("C11").value=e.summary.authority,l.getCell("C12").value=e.summary.transportOrCombinedAuthority,l.getCell("C13").value=e.summary.region,l.getCell("C14").value=e.summary.fundingProgramme,l.getCell("C15").value=e.summary.designStage,l.getCell("C16").value=e.summary.fundingConditions,l.getCell("C17").value=e.summary.inspectorEmail,l.getCell("C18").value=e.summary.assessedRouteLengthKm,l.getCell("C19").value=e.summary.totalRouteLengthKm,l.getCell("C20").value=e.summary.notes,e.summary.checkType=="path"&&(l.getCell("D22").value="Path Check")}function X(e,n){let l=n.getWorksheet("2.1 Policy Check");for(let t=0;t<6;t++)l.getCell("D"+(8+t)).value=e.policyCheck[t].existing,l.getCell("E"+(8+t)).value=e.policyCheck[t].proposed,l.getCell("F"+(8+t)).value=e.policyCheck[t].commentary}function Y(e,n){let l=n.getWorksheet("2.2 Policy Conflict Log");for(let[t,o]of e.policyConflictLog.entries())l.getCell("F"+(8+t)).value=V(o.conflict),l.getCell("H"+(8+t)).value=o.stage,l.getCell("I"+(8+t)).value=F(o.point),l.getCell("J"+(8+t)).value=o.locationName,l.getCell("K"+(8+t)).value=o.resolved,l.getCell("L"+(8+t)).value=o.notes}function Z(e,n){let l=n.getWorksheet("3.2 Critical Issues Log");for(let[t,o]of e.criticalIssues.entries())l.getCell("F"+(8+t)).value=G(o.criticalIssue),l.getCell("H"+(8+t)).value=o.stage,l.getCell("I"+(8+t)).value=F(o.point),l.getCell("J"+(8+t)).value=o.locationName,l.getCell("K"+(8+t)).value=o.resolved,l.getCell("L"+(8+t)).value=o.notes}function v(e,n,l,t,o){let s=n.getWorksheet(l);if(o.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${l}`);for(let r=0;r<e.existingScores.length;r++){let m=o[r];s.getCell(t[0]+m).value=W(e.existingScores[r]),s.getCell(t[1]+m).value=e.existingScoreNotes[r],s.getCell(t[2]+m).value=W(e.proposedScores[r]),s.getCell(t[3]+m).value=e.proposedScoreNotes[r]}}function y(e){let n=[];for(let[l,t]of e)for(let o=l;o<=t;o++)n.push(o);return n}function W(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function F(e){return`${e[1]}, ${e[0]}`}function ee(e,n){let l=new Blob([e],{type:"application/octet-stream"}),t=URL.createObjectURL(l),o=document.createElement("a");o.href=t,o.download=n,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(t)}function te(e){let n;return{c(){n=N("Convert to .xlsx (takes a few seconds)")},l(l){n=O(l,"Convert to .xlsx (takes a few seconds)")},m(l,t){f(l,n,t)},d(l){l&&g(n)}}}function le(e){let n,l=`This page is for internal use only. The values below are TSV (tab-separated
  values), copyable into Excel.`,t,o,s,r,m,u,$,c,k,C,E=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9</i>`,d;return o=new P({props:{label:"TSV output, just the one row of values",value:e[3]}}),r=new P({props:{label:"TSV output with header",value:`${e[2]}
${e[3]}
`}}),u=new P({props:{label:"JSON mapping",value:JSON.stringify(Object.fromEntries(e[1]),null,"  ")}}),c=new A({props:{$$slots:{default:[te]},$$scope:{ctx:e}}}),c.$on("click",e[4]),{c(){n=J("p"),n.textContent=l,t=p(),x(o.$$.fragment),s=p(),x(r.$$.fragment),m=p(),x(u.$$.fragment),$=p(),x(c.$$.fragment),k=p(),C=J("p"),C.innerHTML=E},l(a){n=R(a,"P",{"data-svelte-h":!0}),T(n)!=="svelte-5ssfe3"&&(n.textContent=l),t=h(a),b(o.$$.fragment,a),s=h(a),b(r.$$.fragment,a),m=h(a),b(u.$$.fragment,a),$=h(a),b(c.$$.fragment,a),k=h(a),C=R(a,"P",{"data-svelte-h":!0}),T(C)!=="svelte-6hhtkc"&&(C.innerHTML=E)},m(a,i){f(a,n,i),f(a,t,i),w(o,a,i),f(a,s,i),w(r,a,i),f(a,m,i),w(u,a,i),f(a,$,i),w(c,a,i),f(a,k,i),f(a,C,i),d=!0},p(a,[i]){const I={};i&64&&(I.$$scope={dirty:i,ctx:a}),c.$set(I)},i(a){d||(S(o.$$.fragment,a),S(r.$$.fragment,a),S(u.$$.fragment,a),S(c.$$.fragment,a),d=!0)},o(a){_(o.$$.fragment,a),_(r.$$.fragment,a),_(u.$$.fragment,a),_(c.$$.fragment,a),d=!1},d(a){a&&(g(n),g(t),g(s),g(m),g($),g(k),g(C)),L(o,a),L(r,a),L(u,a),L(c,a)}}}function oe(e,n,l){let t;j(e,M,u=>l(0,t=u));let o=B(t),s=o.map(u=>u[0]).join("	"),r=o.map(u=>`"${u[1]}"`).join("	");return[t,o,s,r,()=>z(t)]}class ge extends D{constructor(n){super(),U(this,n,oe,le,K,{})}}export{ge as component};
