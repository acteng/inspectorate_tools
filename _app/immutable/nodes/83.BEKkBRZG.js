import{s as ke,v as Z,e as H,t as ne,a as M,c as K,b as z,d as le,f as d,g as j,r as G,w as te,i as C,h as O,x as Q,k as we,z as He,U as Ke,a7 as ze,E as Se,p as he,q as _e,N as Be,j as de,n as Je,R as ve,S as be}from"../chunks/scheduler.Bsni_e59.js";import{S as Ce,i as Le,e as X,c as P,a as T,m as V,t as k,b as L,d as F,f as ae,g as fe}from"../chunks/index.CCfAUppz.js";import{M as Ye,g as Ze,G as Qe}from"../chunks/MapLibreMap.BU-3A0qZ.js";import{e as oe}from"../chunks/each.ChCadThl.js";import{c as Xe,p as xe}from"../chunks/colors.CYEpEtTL.js";import{p as Ge}from"../chunks/index.KFDBKh8q.js";import{S as ge}from"../chunks/Select.N7F_8zcJ.js";import{T as We}from"../chunks/TextArea.DbePhW6L.js";import{T as Re}from"../chunks/TextInput.CHbK327s.js";import{s as R}from"../chunks/data.DYmOgu3T.js";import{s as me,b as $e,a as et,B as tt,G as nt,R as lt,S as it,c as ot,M as Oe,C as st}from"../chunks/GeoreferenceLayer.B_Yx6fMN.js";import{Y as Ue}from"../chunks/YesNo.D5av4F2r.js";import{D as rt}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as at,S as Ie}from"../chunks/WarningButton.D9QeV9gM.js";function ft(e){let t,l,n,o,p,u,f,s,b,g,c,v,r,m,D,S,_,I,B,W,J,q,x,A;function se(i){e[3](i)}let ie={label:"Critical Issue",emptyOption:!0,choices:e[2]};e[1].criticalIssues[e[0]].criticalIssue!==void 0&&(ie.value=e[1].criticalIssues[e[0]].criticalIssue),g=new ge({props:ie}),Z.push(()=>X(g,"value",se));function ee(i){e[4](i)}let E={label:"Stage",emptyOption:!0,choices:Ge(["Existing","Design"])};e[1].criticalIssues[e[0]].stage!==void 0&&(E.value=e[1].criticalIssues[e[0]].stage),r=new ge({props:E}),Z.push(()=>X(r,"value",ee));function re(i){e[5](i)}let Y={label:"Location Name"};e[1].criticalIssues[e[0]].locationName!==void 0&&(Y.value=e[1].criticalIssues[e[0]].locationName),S=new Re({props:Y}),Z.push(()=>X(S,"value",re));function N(i){e[6](i)}let y={label:"Resolved by Design"};e[1].criticalIssues[e[0]].resolved!==void 0&&(y.value=e[1].criticalIssues[e[0]].resolved),B=new Ue({props:y}),Z.push(()=>X(B,"value",N));function a(i){e[7](i)}let h={label:"Commentary & Feedback"};return e[1].criticalIssues[e[0]].notes!==void 0&&(h.value=e[1].criticalIssues[e[0]].notes),q=new We({props:h}),Z.push(()=>X(q,"value",a)),{c(){t=H("div"),l=H("a"),n=ne("Google StreetView"),p=M(),u=H("a"),f=ne("Bing Streetside"),b=M(),P(g.$$.fragment),v=M(),P(r.$$.fragment),D=M(),P(S.$$.fragment),I=M(),P(B.$$.fragment),J=M(),P(q.$$.fragment),this.h()},l(i){t=K(i,"DIV",{style:!0});var $=z(t);l=K($,"A",{href:!0,target:!0});var w=z(l);n=le(w,"Google StreetView"),w.forEach(d),p=j($),u=K($,"A",{href:!0,target:!0});var U=z(u);f=le(U,"Bing Streetside"),U.forEach(d),$.forEach(d),b=j(i),T(g.$$.fragment,i),v=j(i),T(r.$$.fragment,i),D=j(i),T(S.$$.fragment,i),I=j(i),T(B.$$.fragment,i),J=j(i),T(q.$$.fragment,i),this.h()},h(){G(l,"href",o=me(e[1].criticalIssues[e[0]].point)),G(l,"target","_blank"),G(u,"href",s=$e(e[1].criticalIssues[e[0]].point)),G(u,"target","_blank"),te(t,"display","flex"),te(t,"justify-content","space-evenly")},m(i,$){C(i,t,$),O(t,l),O(l,n),O(t,p),O(t,u),O(u,f),C(i,b,$),V(g,i,$),C(i,v,$),V(r,i,$),C(i,D,$),V(S,i,$),C(i,I,$),V(B,i,$),C(i,J,$),V(q,i,$),A=!0},p(i,[$]){(!A||$&3&&o!==(o=me(i[1].criticalIssues[i[0]].point)))&&G(l,"href",o),(!A||$&3&&s!==(s=$e(i[1].criticalIssues[i[0]].point)))&&G(u,"href",s);const w={};!c&&$&3&&(c=!0,w.value=i[1].criticalIssues[i[0]].criticalIssue,Q(()=>c=!1)),g.$set(w);const U={};!m&&$&3&&(m=!0,U.value=i[1].criticalIssues[i[0]].stage,Q(()=>m=!1)),r.$set(U);const ce={};!_&&$&3&&(_=!0,ce.value=i[1].criticalIssues[i[0]].locationName,Q(()=>_=!1)),S.$set(ce);const ue={};!W&&$&3&&(W=!0,ue.value=i[1].criticalIssues[i[0]].resolved,Q(()=>W=!1)),B.$set(ue);const pe={};!x&&$&3&&(x=!0,pe.value=i[1].criticalIssues[i[0]].notes,Q(()=>x=!1)),q.$set(pe)},i(i){A||(k(g.$$.fragment,i),k(r.$$.fragment,i),k(S.$$.fragment,i),k(B.$$.fragment,i),k(q.$$.fragment,i),A=!0)},o(i){L(g.$$.fragment,i),L(r.$$.fragment,i),L(S.$$.fragment,i),L(B.$$.fragment,i),L(q.$$.fragment,i),A=!1},d(i){i&&(d(t),d(b),d(v),d(D),d(I),d(J)),F(g,i),F(r,i),F(S,i),F(B,i),F(q,i)}}}function ct(e,t,l){let n;we(e,R,c=>l(1,n=c));let{idx:o}=t,p=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]];function u(c){e.$$.not_equal(n.criticalIssues[o].criticalIssue,c)&&(n.criticalIssues[o].criticalIssue=c,R.set(n))}function f(c){e.$$.not_equal(n.criticalIssues[o].stage,c)&&(n.criticalIssues[o].stage=c,R.set(n))}function s(c){e.$$.not_equal(n.criticalIssues[o].locationName,c)&&(n.criticalIssues[o].locationName=c,R.set(n))}function b(c){e.$$.not_equal(n.criticalIssues[o].resolved,c)&&(n.criticalIssues[o].resolved=c,R.set(n))}function g(c){e.$$.not_equal(n.criticalIssues[o].notes,c)&&(n.criticalIssues[o].notes=c,R.set(n))}return e.$$set=c=>{"idx"in c&&l(0,o=c.idx)},[o,n,p,u,f,s,b,g]}class ut extends Ce{constructor(t){super(),Le(this,t,ct,ft,ke,{idx:0})}}function pt(e){let t,l,n,o,p,u,f,s,b,g,c,v,r,m,D,S,_,I,B,W,J,q,x,A;function se(i){e[3](i)}let ie={label:"Policy Conflict",emptyOption:!0,choices:e[2]};e[1].policyConflictLog[e[0]].conflict!==void 0&&(ie.value=e[1].policyConflictLog[e[0]].conflict),g=new ge({props:ie}),Z.push(()=>X(g,"value",se));function ee(i){e[4](i)}let E={label:"Stage",emptyOption:!0,choices:Ge(["Existing","Design"])};e[1].policyConflictLog[e[0]].stage!==void 0&&(E.value=e[1].policyConflictLog[e[0]].stage),r=new ge({props:E}),Z.push(()=>X(r,"value",ee));function re(i){e[5](i)}let Y={label:"Location Name"};e[1].policyConflictLog[e[0]].locationName!==void 0&&(Y.value=e[1].policyConflictLog[e[0]].locationName),S=new Re({props:Y}),Z.push(()=>X(S,"value",re));function N(i){e[6](i)}let y={label:"Resolved by Design"};e[1].policyConflictLog[e[0]].resolved!==void 0&&(y.value=e[1].policyConflictLog[e[0]].resolved),B=new Ue({props:y}),Z.push(()=>X(B,"value",N));function a(i){e[7](i)}let h={label:"Commentary & Feedback"};return e[1].policyConflictLog[e[0]].notes!==void 0&&(h.value=e[1].policyConflictLog[e[0]].notes),q=new We({props:h}),Z.push(()=>X(q,"value",a)),{c(){t=H("div"),l=H("a"),n=ne("Google StreetView"),p=M(),u=H("a"),f=ne("Bing Streetside"),b=M(),P(g.$$.fragment),v=M(),P(r.$$.fragment),D=M(),P(S.$$.fragment),I=M(),P(B.$$.fragment),J=M(),P(q.$$.fragment),this.h()},l(i){t=K(i,"DIV",{style:!0});var $=z(t);l=K($,"A",{href:!0,target:!0});var w=z(l);n=le(w,"Google StreetView"),w.forEach(d),p=j($),u=K($,"A",{href:!0,target:!0});var U=z(u);f=le(U,"Bing Streetside"),U.forEach(d),$.forEach(d),b=j(i),T(g.$$.fragment,i),v=j(i),T(r.$$.fragment,i),D=j(i),T(S.$$.fragment,i),I=j(i),T(B.$$.fragment,i),J=j(i),T(q.$$.fragment,i),this.h()},h(){G(l,"href",o=me(e[1].policyConflictLog[e[0]].point)),G(l,"target","_blank"),G(u,"href",s=$e(e[1].policyConflictLog[e[0]].point)),G(u,"target","_blank"),te(t,"display","flex"),te(t,"justify-content","space-evenly")},m(i,$){C(i,t,$),O(t,l),O(l,n),O(t,p),O(t,u),O(u,f),C(i,b,$),V(g,i,$),C(i,v,$),V(r,i,$),C(i,D,$),V(S,i,$),C(i,I,$),V(B,i,$),C(i,J,$),V(q,i,$),A=!0},p(i,[$]){(!A||$&3&&o!==(o=me(i[1].policyConflictLog[i[0]].point)))&&G(l,"href",o),(!A||$&3&&s!==(s=$e(i[1].policyConflictLog[i[0]].point)))&&G(u,"href",s);const w={};!c&&$&3&&(c=!0,w.value=i[1].policyConflictLog[i[0]].conflict,Q(()=>c=!1)),g.$set(w);const U={};!m&&$&3&&(m=!0,U.value=i[1].policyConflictLog[i[0]].stage,Q(()=>m=!1)),r.$set(U);const ce={};!_&&$&3&&(_=!0,ce.value=i[1].policyConflictLog[i[0]].locationName,Q(()=>_=!1)),S.$set(ce);const ue={};!W&&$&3&&(W=!0,ue.value=i[1].policyConflictLog[i[0]].resolved,Q(()=>W=!1)),B.$set(ue);const pe={};!x&&$&3&&(x=!0,pe.value=i[1].policyConflictLog[i[0]].notes,Q(()=>x=!1)),q.$set(pe)},i(i){A||(k(g.$$.fragment,i),k(r.$$.fragment,i),k(S.$$.fragment,i),k(B.$$.fragment,i),k(q.$$.fragment,i),A=!0)},o(i){L(g.$$.fragment,i),L(r.$$.fragment,i),L(S.$$.fragment,i),L(B.$$.fragment,i),L(q.$$.fragment,i),A=!1},d(i){i&&(d(t),d(b),d(v),d(D),d(I),d(J)),F(g,i),F(r,i),F(S,i),F(B,i),F(q,i)}}}function _t(e,t,l){let n;we(e,R,c=>l(1,n=c));let{idx:o}=t,p=[["1","1 - Cyclists are not separated from pedestrians"],["2",'2 - Barriers, steps, or "Cyclist Dismount" signs are present'],["3","3 - The route is not direct, logical and intuitive"],["4","4 - Inappropriate surface materials"],["5","5 - Appropriate lighting is not provided"],["6","6 - Routes miss opportunities to join together with other facilities as a network"]];function u(c){e.$$.not_equal(n.policyConflictLog[o].conflict,c)&&(n.policyConflictLog[o].conflict=c,R.set(n))}function f(c){e.$$.not_equal(n.policyConflictLog[o].stage,c)&&(n.policyConflictLog[o].stage=c,R.set(n))}function s(c){e.$$.not_equal(n.policyConflictLog[o].locationName,c)&&(n.policyConflictLog[o].locationName=c,R.set(n))}function b(c){e.$$.not_equal(n.policyConflictLog[o].resolved,c)&&(n.policyConflictLog[o].resolved=c,R.set(n))}function g(c){e.$$.not_equal(n.policyConflictLog[o].notes,c)&&(n.policyConflictLog[o].notes=c,R.set(n))}return e.$$set=c=>{"idx"in c&&l(0,o=c.idx)},[o,n,p,u,f,s,b,g]}class gt extends Ce{constructor(t){super(),Le(this,t,_t,pt,ke,{idx:0})}}const{window:mt}=Ze;function Ae(e,t,l){const n=e.slice();return n[29]=t[l],n[30]=t,n[31]=l,n}function De(e,t,l){const n=e.slice();return n[32]=t[l],n[33]=t,n[31]=l,n}function Ee(e,t,l){const n=e.slice();return n[29]=t[l],n[31]=l,n}function Ne(e,t,l){const n=e.slice();return n[32]=t[l],n[31]=l,n}function $t(e){let t,l,n,o,p,u,f,s;t=new rt({props:{$$slots:{default:[ht]},$$scope:{ctx:e}}}),t.$on("click",e[20]),n=new at({props:{$$slots:{default:[vt]},$$scope:{ctx:e}}}),n.$on("click",e[8]);const b=[yt,bt],g=[];function c(v,r){return v[0].kind=="critical"?0:1}return p=c(e),u=g[p]=b[p](e),{c(){P(t.$$.fragment),l=M(),P(n.$$.fragment),o=M(),u.c(),f=Se()},l(v){T(t.$$.fragment,v),l=j(v),T(n.$$.fragment,v),o=j(v),u.l(v),f=Se()},m(v,r){V(t,v,r),C(v,l,r),V(n,v,r),C(v,o,r),g[p].m(v,r),C(v,f,r),s=!0},p(v,r){const m={};r[1]&32&&(m.$$scope={dirty:r,ctx:v}),t.$set(m);const D={};r[1]&32&&(D.$$scope={dirty:r,ctx:v}),n.$set(D);let S=p;p=c(v),p===S?g[p].p(v,r):(fe(),L(g[S],1,1,()=>{g[S]=null}),ae(),u=g[p],u?u.p(v,r):(u=g[p]=b[p](v),u.c()),k(u,1),u.m(f.parentNode,f))},i(v){s||(k(t.$$.fragment,v),k(n.$$.fragment,v),k(u),s=!0)},o(v){L(t.$$.fragment,v),L(n.$$.fragment,v),L(u),s=!1},d(v){v&&(d(l),d(o),d(f)),F(t,v),F(n,v),g[p].d(v)}}}function dt(e){let t,l,n,o,p,u,f,s,b,g,c,v="Click the map to add a problem, or select a problem to fill out data",r,m,D="Critical Issues",S,_,I,B,W="Policy Conflicts",J,q,x;t=new Ie({props:{$$slots:{default:[kt]},$$scope:{ctx:e}}}),t.$on("click",e[11]),n=new tt({}),p=new nt({});let A=e[3]&&qe(e);function se(a){e[13](a)}let ie={legend:"Create new problems",choices:[["critical","Critical Issue"],["conflict","Policy Conflict"]],inlineSmall:!0};e[4]!==void 0&&(ie.value=e[4]),s=new lt({props:ie}),Z.push(()=>X(s,"value",se));let ee=oe(e[2].criticalIssues),E=[];for(let a=0;a<ee.length;a+=1)E[a]=Me(Ne(e,ee,a));const re=a=>L(E[a],1,1,()=>{E[a]=null});let Y=oe(e[2].policyConflictLog),N=[];for(let a=0;a<Y.length;a+=1)N[a]=je(Ee(e,Y,a));const y=a=>L(N[a],1,1,()=>{N[a]=null});return{c(){P(t.$$.fragment),l=M(),P(n.$$.fragment),o=M(),P(p.$$.fragment),u=M(),A&&A.c(),f=M(),P(s.$$.fragment),g=M(),c=H("p"),c.textContent=v,r=M(),m=H("h3"),m.textContent=D,S=M(),_=H("ol");for(let a=0;a<E.length;a+=1)E[a].c();I=M(),B=H("h3"),B.textContent=W,J=M(),q=H("ol");for(let a=0;a<N.length;a+=1)N[a].c()},l(a){T(t.$$.fragment,a),l=j(a),T(n.$$.fragment,a),o=j(a),T(p.$$.fragment,a),u=j(a),A&&A.l(a),f=j(a),T(s.$$.fragment,a),g=j(a),c=K(a,"P",{"data-svelte-h":!0}),he(c)!=="svelte-12ba5j2"&&(c.textContent=v),r=j(a),m=K(a,"H3",{"data-svelte-h":!0}),he(m)!=="svelte-1qhh5xr"&&(m.textContent=D),S=j(a),_=K(a,"OL",{});var h=z(_);for(let $=0;$<E.length;$+=1)E[$].l(h);h.forEach(d),I=j(a),B=K(a,"H3",{"data-svelte-h":!0}),he(B)!=="svelte-eyxzjx"&&(B.textContent=W),J=j(a),q=K(a,"OL",{});var i=z(q);for(let $=0;$<N.length;$+=1)N[$].l(i);i.forEach(d)},m(a,h){V(t,a,h),C(a,l,h),V(n,a,h),C(a,o,h),V(p,a,h),C(a,u,h),A&&A.m(a,h),C(a,f,h),V(s,a,h),C(a,g,h),C(a,c,h),C(a,r,h),C(a,m,h),C(a,S,h),C(a,_,h);for(let i=0;i<E.length;i+=1)E[i]&&E[i].m(_,null);C(a,I,h),C(a,B,h),C(a,J,h),C(a,q,h);for(let i=0;i<N.length;i+=1)N[i]&&N[i].m(q,null);x=!0},p(a,h){const i={};h[1]&32&&(i.$$scope={dirty:h,ctx:a}),t.$set(i),a[3]?A?(A.p(a,h),h[0]&8&&k(A,1)):(A=qe(a),A.c(),k(A,1),A.m(f.parentNode,f)):A&&(fe(),L(A,1,1,()=>{A=null}),ae());const $={};if(!b&&h[0]&16&&(b=!0,$.value=a[4],Q(()=>b=!1)),s.$set($),h[0]&134){ee=oe(a[2].criticalIssues);let w;for(w=0;w<ee.length;w+=1){const U=Ne(a,ee,w);E[w]?(E[w].p(U,h),k(E[w],1)):(E[w]=Me(U),E[w].c(),k(E[w],1),E[w].m(_,null))}for(fe(),w=ee.length;w<E.length;w+=1)re(w);ae()}if(h[0]&134){Y=oe(a[2].policyConflictLog);let w;for(w=0;w<Y.length;w+=1){const U=Ee(a,Y,w);N[w]?(N[w].p(U,h),k(N[w],1)):(N[w]=je(U),N[w].c(),k(N[w],1),N[w].m(q,null))}for(fe(),w=Y.length;w<N.length;w+=1)y(w);ae()}},i(a){if(!x){k(t.$$.fragment,a),k(n.$$.fragment,a),k(p.$$.fragment,a),k(A),k(s.$$.fragment,a);for(let h=0;h<ee.length;h+=1)k(E[h]);for(let h=0;h<Y.length;h+=1)k(N[h]);x=!0}},o(a){L(t.$$.fragment,a),L(n.$$.fragment,a),L(p.$$.fragment,a),L(A),L(s.$$.fragment,a),E=E.filter(Boolean);for(let h=0;h<E.length;h+=1)L(E[h]);N=N.filter(Boolean);for(let h=0;h<N.length;h+=1)L(N[h]);x=!1},d(a){a&&(d(l),d(o),d(u),d(f),d(g),d(c),d(r),d(m),d(S),d(_),d(I),d(B),d(J),d(q)),F(t,a),F(n,a),F(p,a),A&&A.d(a),F(s,a),_e(E,a),_e(N,a)}}}function ht(e){let t;return{c(){t=ne("Save")},l(l){t=le(l,"Save")},m(l,n){C(l,t,n)},d(l){l&&d(t)}}}function vt(e){let t;return{c(){t=ne("Delete")},l(l){t=le(l,"Delete")},m(l,n){C(l,t,n)},d(l){l&&d(t)}}}function bt(e){let t,l;return t=new gt({props:{idx:e[0].idx}}),{c(){P(t.$$.fragment)},l(n){T(t.$$.fragment,n)},m(n,o){V(t,n,o),l=!0},p(n,o){const p={};o[0]&1&&(p.idx=n[0].idx),t.$set(p)},i(n){l||(k(t.$$.fragment,n),l=!0)},o(n){L(t.$$.fragment,n),l=!1},d(n){F(t,n)}}}function yt(e){let t,l;return t=new ut({props:{idx:e[0].idx}}),{c(){P(t.$$.fragment)},l(n){T(t.$$.fragment,n)},m(n,o){V(t,n,o),l=!0},p(n,o){const p={};o[0]&1&&(p.idx=n[0].idx),t.$set(p)},i(n){l||(k(t.$$.fragment,n),l=!0)},o(n){L(t.$$.fragment,n),l=!1},d(n){F(t,n)}}}function kt(e){let t;return{c(){t=ne("Zoom to fit")},l(l){t=le(l,"Zoom to fit")},m(l,n){C(l,t,n)},d(l){l&&d(t)}}}function qe(e){let t,l,n;function o(u){e[12](u)}let p={map:e[3]};return e[5]!==void 0&&(p.enabled=e[5]),t=new it({props:p}),Z.push(()=>X(t,"enabled",o)),{c(){P(t.$$.fragment)},l(u){T(t.$$.fragment,u)},m(u,f){V(t,u,f),n=!0},p(u,f){const s={};f[0]&8&&(s.map=u[3]),!l&&f[0]&32&&(l=!0,s.enabled=u[5],Q(()=>l=!1)),t.$set(s)},i(u){n||(k(t.$$.fragment,u),n=!0)},o(u){L(t.$$.fragment,u),n=!1},d(u){F(t,u)}}}function wt(e){let t=Ve(e[32])+"",l;return{c(){l=ne(t)},l(n){l=le(n,t)},m(n,o){C(n,l,o)},p(n,o){o[0]&4&&t!==(t=Ve(n[32])+"")&&de(l,t)},d(n){n&&d(l)}}}function Me(e){let t,l,n,o;function p(){return e[14](e[31])}function u(){return e[15](e[31])}return l=new Ie({props:{$$slots:{default:[wt]},$$scope:{ctx:e}}}),l.$on("click",p),l.$on("mouseenter",u),l.$on("mouseleave",e[16]),{c(){t=H("li"),P(l.$$.fragment),n=M()},l(f){t=K(f,"LI",{});var s=z(t);T(l.$$.fragment,s),n=j(s),s.forEach(d)},m(f,s){C(f,t,s),V(l,t,null),O(t,n),o=!0},p(f,s){e=f;const b={};s[0]&4|s[1]&32&&(b.$$scope={dirty:s,ctx:e}),l.$set(b)},i(f){o||(k(l.$$.fragment,f),o=!0)},o(f){L(l.$$.fragment,f),o=!1},d(f){f&&d(t),F(l)}}}function Ct(e){let t=Fe(e[29])+"",l;return{c(){l=ne(t)},l(n){l=le(n,t)},m(n,o){C(n,l,o)},p(n,o){o[0]&4&&t!==(t=Fe(n[29])+"")&&de(l,t)},d(n){n&&d(l)}}}function je(e){let t,l,n,o;function p(){return e[17](e[31])}function u(){return e[18](e[31])}return l=new Ie({props:{$$slots:{default:[Ct]},$$scope:{ctx:e}}}),l.$on("click",p),l.$on("mouseenter",u),l.$on("mouseleave",e[19]),{c(){t=H("li"),P(l.$$.fragment),n=M()},l(f){t=K(f,"LI",{});var s=z(t);T(l.$$.fragment,s),n=j(s),s.forEach(d)},m(f,s){C(f,t,s),V(l,t,null),O(t,n),o=!0},p(f,s){e=f;const b={};s[0]&4|s[1]&32&&(b.$$scope={dirty:s,ctx:e}),l.$set(b)},i(f){o||(k(l.$$.fragment,f),o=!0)},o(f){L(l.$$.fragment,f),o=!1},d(f){f&&d(t),F(l)}}}function Lt(e){let t,l,n,o=e[32].criticalIssue+"",p;return{c(){t=ve("svg"),l=ve("polygon"),n=ve("text"),p=ne(o),this.h()},l(u){t=be(u,"svg",{width:!0,height:!0,xmlns:!0});var f=z(t);l=be(f,"polygon",{points:!0,fill:!0,class:!0}),z(l).forEach(d),n=be(f,"text",{x:!0,y:!0});var s=z(n);p=le(s,o),s.forEach(d),f.forEach(d),this.h()},h(){G(l,"points","20,0 0,40 40,40"),G(l,"fill",Xe.critical.background),G(l,"class","svelte-996go8"),G(n,"x","13"),G(n,"y","30"),te(n,"fill","white"),G(t,"width","40"),G(t,"height","40"),G(t,"xmlns","http://www.w3.org/2000/svg")},m(u,f){C(u,t,f),O(t,l),O(t,n),O(n,p)},p(u,f){f[0]&4&&o!==(o=u[32].criticalIssue+"")&&de(p,o)},d(u){u&&d(t)}}}function Pe(e){let t,l,n;function o(s){e[21](s,e[32])}function p(){return e[22](e[31])}function u(){return e[23](e[31])}let f={draggable:!0,$$slots:{default:[Lt]},$$scope:{ctx:e}};return e[32].point!==void 0&&(f.lngLat=e[32].point),t=new Oe({props:f}),Z.push(()=>X(t,"lngLat",o)),t.$on("click",p),t.$on("dragend",u),{c(){P(t.$$.fragment)},l(s){T(t.$$.fragment,s)},m(s,b){V(t,s,b),n=!0},p(s,b){e=s;const g={};b[0]&4|b[1]&32&&(g.$$scope={dirty:b,ctx:e}),!l&&b[0]&4&&(l=!0,g.lngLat=e[32].point,Q(()=>l=!1)),t.$set(g)},i(s){n||(k(t.$$.fragment,s),n=!0)},o(s){L(t.$$.fragment,s),n=!1},d(s){F(t,s)}}}function It(e){let t,l=e[29].conflict+"",n;return{c(){t=H("span"),n=ne(l),this.h()},l(o){t=K(o,"SPAN",{class:!0});var p=z(t);n=le(p,l),p.forEach(d),this.h()},h(){G(t,"class","dot svelte-996go8"),te(t,"background",xe)},m(o,p){C(o,t,p),O(t,n)},p(o,p){p[0]&4&&l!==(l=o[29].conflict+"")&&de(n,l)},d(o){o&&d(t)}}}function Te(e){let t,l,n;function o(s){e[24](s,e[29])}function p(){return e[25](e[31])}function u(){return e[26](e[31])}let f={draggable:!0,$$slots:{default:[It]},$$scope:{ctx:e}};return e[29].point!==void 0&&(f.lngLat=e[29].point),t=new Oe({props:f}),Z.push(()=>X(t,"lngLat",o)),t.$on("click",p),t.$on("dragend",u),{c(){P(t.$$.fragment)},l(s){T(t.$$.fragment,s)},m(s,b){V(t,s,b),n=!0},p(s,b){e=s;const g={};b[0]&4|b[1]&32&&(g.$$scope={dirty:b,ctx:e}),!l&&b[0]&4&&(l=!0,g.lngLat=e[29].point,Q(()=>l=!1)),t.$set(g)},i(s){n||(k(t.$$.fragment,s),n=!0)},o(s){L(t.$$.fragment,s),n=!1},d(s){F(t,s)}}}function St(e){let t,l;return t=new st({props:{paint:{"circle-radius":30,"circle-color":"yellow"}}}),{c(){P(t.$$.fragment)},l(n){T(t.$$.fragment,n)},m(n,o){V(t,n,o),l=!0},p:Je,i(n){l||(k(t.$$.fragment,n),l=!0)},o(n){L(t.$$.fragment,n),l=!1},d(n){F(t,n)}}}function Bt(e){let t,l,n,o,p,u,f=oe(e[2].criticalIssues),s=[];for(let r=0;r<f.length;r+=1)s[r]=Pe(De(e,f,r));const b=r=>L(s[r],1,1,()=>{s[r]=null});let g=oe(e[2].policyConflictLog),c=[];for(let r=0;r<g.length;r+=1)c[r]=Te(Ae(e,g,r));const v=r=>L(c[r],1,1,()=>{c[r]=null});return n=new Qe({props:{data:e[6],$$slots:{default:[St]},$$scope:{ctx:e}}}),p=new ot({props:{map:e[3]}}),{c(){for(let r=0;r<s.length;r+=1)s[r].c();t=M();for(let r=0;r<c.length;r+=1)c[r].c();l=M(),P(n.$$.fragment),o=M(),P(p.$$.fragment)},l(r){for(let m=0;m<s.length;m+=1)s[m].l(r);t=j(r);for(let m=0;m<c.length;m+=1)c[m].l(r);l=j(r),T(n.$$.fragment,r),o=j(r),T(p.$$.fragment,r)},m(r,m){for(let D=0;D<s.length;D+=1)s[D]&&s[D].m(r,m);C(r,t,m);for(let D=0;D<c.length;D+=1)c[D]&&c[D].m(r,m);C(r,l,m),V(n,r,m),C(r,o,m),V(p,r,m),u=!0},p(r,m){if(m[0]&132){f=oe(r[2].criticalIssues);let _;for(_=0;_<f.length;_+=1){const I=De(r,f,_);s[_]?(s[_].p(I,m),k(s[_],1)):(s[_]=Pe(I),s[_].c(),k(s[_],1),s[_].m(t.parentNode,t))}for(fe(),_=f.length;_<s.length;_+=1)b(_);ae()}if(m[0]&132){g=oe(r[2].policyConflictLog);let _;for(_=0;_<g.length;_+=1){const I=Ae(r,g,_);c[_]?(c[_].p(I,m),k(c[_],1)):(c[_]=Te(I),c[_].c(),k(c[_],1),c[_].m(l.parentNode,l))}for(fe(),_=g.length;_<c.length;_+=1)v(_);ae()}const D={};m[0]&64&&(D.data=r[6]),m[1]&32&&(D.$$scope={dirty:m,ctx:r}),n.$set(D);const S={};m[0]&8&&(S.map=r[3]),p.$set(S)},i(r){if(!u){for(let m=0;m<f.length;m+=1)k(s[m]);for(let m=0;m<g.length;m+=1)k(c[m]);k(n.$$.fragment,r),k(p.$$.fragment,r),u=!0}},o(r){s=s.filter(Boolean);for(let m=0;m<s.length;m+=1)L(s[m]);c=c.filter(Boolean);for(let m=0;m<c.length;m+=1)L(c[m]);L(n.$$.fragment,r),L(p.$$.fragment,r),u=!1},d(r){r&&(d(t),d(l),d(o)),_e(s,r),_e(c,r),F(n,r),F(p,r)}}}function At(e){let t,l,n,o,p,u,f,s,b,g,c;const v=[dt,$t],r=[];function m(_,I){return _[0]==null?0:1}n=m(e),o=r[n]=v[n](e);function D(_){e[27](_)}let S={$$slots:{default:[Bt]},$$scope:{ctx:e}};return e[3]!==void 0&&(S.map=e[3]),f=new Ye({props:S}),Z.push(()=>X(f,"map",D)),{c(){t=H("div"),l=H("div"),o.c(),p=M(),u=H("div"),P(f.$$.fragment),this.h()},l(_){t=K(_,"DIV",{style:!0});var I=z(t);l=K(I,"DIV",{style:!0});var B=z(l);o.l(B),B.forEach(d),p=j(I),u=K(I,"DIV",{style:!0});var W=z(u);T(f.$$.fragment,W),W.forEach(d),I.forEach(d),this.h()},h(){te(l,"width","30%"),te(l,"overflow-y","scroll"),te(l,"padding","10px"),te(u,"position","relative"),te(u,"width","70%"),te(t,"display","flex"),te(t,"height","80vh")},m(_,I){C(_,t,I),O(t,l),r[n].m(l,null),O(t,p),O(t,u),V(f,u,null),b=!0,g||(c=He(mt,"keydown",e[10]),g=!0)},p(_,I){let B=n;n=m(_),n===B?r[n].p(_,I):(fe(),L(r[B],1,1,()=>{r[B]=null}),ae(),o=r[n],o?o.p(_,I):(o=r[n]=v[n](_),o.c()),k(o,1),o.m(l,null));const W={};I[0]&76|I[1]&32&&(W.$$scope={dirty:I,ctx:_}),!s&&I[0]&8&&(s=!0,W.map=_[3],Q(()=>s=!1)),f.$set(W)},i(_){b||(k(o),k(f.$$.fragment,_),b=!0)},o(_){L(o),L(f.$$.fragment,_),b=!1},d(_){_&&d(t),r[n].d(),F(f),g=!1,c()}}}function Dt(e,t,l){let n={type:"FeatureCollection",features:[]},o=t??l;if(o!=null){let p=o.kind=="critical"?e.criticalIssues:e.policyConflictLog;n.features.push(ye(p[o.idx].point))}return n}function ye(e){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:e}}}function Ve(e){return`${e.criticalIssue||"Unknown critical"}: ${e.locationName||"???"}`}function Fe(e){return`${e.conflict||"Unknown conflict"}: ${e.locationName||"???"}`}function Et(e,t,l){let n,o;we(e,R,y=>l(2,o=y));let p,u="critical",f=null,s=null,b=!1;function g(y){l(0,f=y),l(1,s=null)}function c(y){if(!b){if(f!=null){l(0,f=null);return}u=="critical"?(Be(R,o.criticalIssues=[...o.criticalIssues,{criticalIssue:"",stage:"",point:y.lngLat.toArray(),locationName:"",resolved:"",notes:""}],o),l(0,f={kind:"critical",idx:o.criticalIssues.length-1})):(Be(R,o.policyConflictLog=[...o.policyConflictLog,{conflict:"",stage:"",point:y.lngLat.toArray(),locationName:"",resolved:"",notes:""}],o),l(0,f={kind:"conflict",idx:o.policyConflictLog.length-1})),l(1,s=null)}}Ke(()=>{p.on("click",c),r(!1)}),ze(()=>{p.off("click",c)});function v(){window.confirm("Delete this entry?")&&(f.kind=="critical"?(o.criticalIssues.splice(f.idx,1),R.set(o)):(o.policyConflictLog.splice(f.idx,1),R.set(o)),l(0,f=null))}function r(y){let a={type:"FeatureCollection",features:[...o.criticalIssues.map(h=>ye(h.point)),...o.policyConflictLog.map(h=>ye(h.point))]};a.features.length>0&&p.fitBounds(et(a),{padding:20,animate:y})}function m(y){f!=null&&y.key=="Escape"?(y.stopPropagation(),l(0,f=null)):f!=null&&y.key=="Delete"&&v()}const D=()=>r(!0);function S(y){b=y,l(5,b)}function _(y){u=y,l(4,u)}const I=y=>g({kind:"critical",idx:y}),B=y=>l(1,s={kind:"critical",idx:y}),W=()=>l(1,s=null),J=y=>g({kind:"conflict",idx:y}),q=y=>l(1,s={kind:"conflict",idx:y}),x=()=>l(1,s=null),A=()=>l(0,f=null);function se(y,a){e.$$.not_equal(a.point,y)&&(a.point=y,R.set(o))}const ie=y=>g({kind:"critical",idx:y}),ee=y=>g({kind:"critical",idx:y});function E(y,a){e.$$.not_equal(a.point,y)&&(a.point=y,R.set(o))}const re=y=>g({kind:"conflict",idx:y}),Y=y=>g({kind:"conflict",idx:y});function N(y){p=y,l(3,p)}return e.$$.update=()=>{e.$$.dirty[0]&7&&l(6,n=Dt(o,f,s))},[f,s,o,p,u,b,n,g,v,r,m,D,S,_,I,B,W,J,q,x,A,se,ie,ee,E,re,Y,N]}class Kt extends Ce{constructor(t){super(),Le(this,t,Et,At,ke,{},null,[-1,-1])}}export{Kt as component};
