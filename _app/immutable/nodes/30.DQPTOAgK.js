import{s as Me,v as oe,x as ae,l as Ke,u as Ze,m as Qe,o as Ye,H as _e,E as Ae,i as E,f as b,a9 as dn,a8 as _n,k as Pe,U as Rt,a7 as Ut,N as Ve,e as te,c as ne,b as ie,r as xe,a as z,g as D,w as le,h as ue,z as pn,t as K,p as vt,d as Z,j as ke,q as ze,n as hn}from"../chunks/scheduler.Bsni_e59.js";import{S as Ie,i as Te,e as se,c as S,a as F,m as B,t as w,b as L,d as q,g as pe,f as he}from"../chunks/index.CCfAUppz.js";import{e as ye}from"../chunks/each.ChCadThl.js";import{W as Jt,S as we}from"../chunks/WarningButton.D9QeV9gM.js";import{T as mt}from"../chunks/TextInput.CHbK327s.js";import{s as ee}from"../chunks/data.S4jR8qkd.js";import{L as Wt,a as Vt,e as yn,m as Oe,i as bn,f as Xt,M as vn,g as wn,G as wt,h as kt}from"../chunks/MapLibreMap.BzVQ8rgn.js";import{c as Ue}from"../chunks/colors.CYEpEtTL.js";import{D as kn}from"../chunks/DefaultButton.DyQsHGbh.js";import{a as jn,B as Ln,G as En,R as Cn,S as $n,c as Pn,M as lt,C as Mn}from"../chunks/GeoreferenceLayer.CEUax-m5.js";import{T as Kt}from"../chunks/TextArea.DbePhW6L.js";import{p as In}from"../chunks/index.B1vzR2qI.js";import{S as jt}from"../chunks/Select.N7F_8zcJ.js";function Tn(t){let e;const n=t[15].default,r=Ke(n,t,t[23],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&8388608)&&Ze(r,n,o,o[23],e?Ye(n,o[23],l,null):Qe(o[23]),null)},i(o){e||(w(r,o),e=!0)},o(o){L(r,o),e=!1},d(o){r&&r.d(o)}}}function On(t){let e,n,r;function o(i){t[16](i)}let l={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[Tn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Wt({props:l}),oe.push(()=>se(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){S(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.minzoom=i[9]),a&1024&&(s.maxzoom=i[10]),a&2048&&(s.hoverCursor=i[11]),a&4096&&(s.manageHoverState=i[12]),a&8192&&(s.eventsIfTopMost=i[13]),a&16384&&(s.interactive=i[14]),a&8388608&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],ae(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){L(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function An(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Vt("line")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:f}=e,{layout:j=void 0}=e,{filter:c=void 0}=e,{minzoom:g=void 0}=e,{maxzoom:_=void 0}=e,{hoverCursor:u=void 0}=e,{manageHoverState:p=!1}=e,{hovered:O=null}=e,{eventsIfTopMost:A=!1}=e,{interactive:H=!0}=e;function $(k){O=k,n(0,O)}function h(k){_e.call(this,t,k)}function C(k){_e.call(this,t,k)}function T(k){_e.call(this,t,k)}function Q(k){_e.call(this,t,k)}function N(k){_e.call(this,t,k)}function Y(k){_e.call(this,t,k)}return t.$$set=k=>{"id"in k&&n(1,l=k.id),"source"in k&&n(2,i=k.source),"sourceLayer"in k&&n(3,a=k.sourceLayer),"beforeId"in k&&n(4,s=k.beforeId),"beforeLayerType"in k&&n(5,m=k.beforeLayerType),"paint"in k&&n(6,f=k.paint),"layout"in k&&n(7,j=k.layout),"filter"in k&&n(8,c=k.filter),"minzoom"in k&&n(9,g=k.minzoom),"maxzoom"in k&&n(10,_=k.maxzoom),"hoverCursor"in k&&n(11,u=k.hoverCursor),"manageHoverState"in k&&n(12,p=k.manageHoverState),"hovered"in k&&n(0,O=k.hovered),"eventsIfTopMost"in k&&n(13,A=k.eventsIfTopMost),"interactive"in k&&n(14,H=k.interactive),"$$scope"in k&&n(23,o=k.$$scope)},[O,l,i,a,s,m,f,j,c,g,_,u,p,A,H,r,$,h,C,T,Q,N,Y,o]}class at extends Ie{constructor(e){super(),Te(this,e,An,On,Me,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Sn=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),Lt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function Et(t){let e,n,r=(t[4]||t[3]instanceof Oe.Marker)&&Ct(t);return{c(){e=te("div"),r&&r.c()},l(o){e=ne(o,"DIV",{});var l=ie(e);r&&r.l(l),l.forEach(b)},m(o,l){E(o,e,l),r&&r.m(e,null),t[32](e),n=!0},p(o,l){o[4]||o[3]instanceof Oe.Marker?r?(r.p(o,l),l[0]&24&&w(r,1)):(r=Ct(o),r.c(),w(r,1),r.m(e,null)):r&&(pe(),L(r,1,1,()=>{r=null}),he())},i(o){n||(w(r),n=!0)},o(o){L(r),n=!1},d(o){o&&b(e),r&&r.d(),t[32](null)}}}function Ct(t){let e;const n=t[30].default,r=Ke(n,t,t[29],Lt);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l[0]&536870933)&&Ze(r,n,o,o[29],e?Ye(n,o[29],l,Sn):Qe(o[29]),Lt)},i(o){e||(w(r,o),e=!0)},o(o){L(r,o),e=!1},d(o){r&&r.d(o)}}}function Fn(t){let e,n,r=t[9].default&&Et(t);return{c(){r&&r.c(),e=Ae()},l(o){r&&r.l(o),e=Ae()},m(o,l){r&&r.m(o,l),E(o,e,l),n=!0},p(o,l){o[9].default?r?(r.p(o,l),l[0]&512&&w(r,1)):(r=Et(o),r.c(),w(r,1),r.m(e.parentNode,e)):r&&(pe(),L(r,1,1,()=>{r=null}),he())},i(o){n||(w(r),n=!0)},o(o){L(r),n=!1},d(o){o&&b(e),r&&r.d(o)}}}function Bn(t,e,n){let r,o,l,i,a,s,{$$slots:m={},$$scope:f}=e;const j=dn(m);let{closeButton:c=void 0}=e,{closeOnClickOutside:g=!0}=e,{closeOnClickInside:_=!1}=e,{closeOnMove:u=!1}=e,{openOn:p="click"}=e,{openIfTopMost:O=!0}=e,{focusAfterOpen:A=!0}=e,{anchor:H=void 0}=e,{offset:$=void 0}=e,{popupClass:h=void 0}=e,{maxWidth:C=void 0}=e,{lngLat:T=void 0}=e,{html:Q=void 0}=e,{open:N=!1}=e;const Y=_n(),{map:k,popupTarget:P,layerEvent:be,layer:ge,eventTopMost:V}=yn();Pe(t,k,v=>n(2,l=v)),Pe(t,P,v=>n(3,a=v)),Pe(t,be,v=>n(28,i=v)),Pe(t,ge,v=>n(35,s=v));const Be=["click","dblclick","contextmenu"];let G,R=!1,de;function d(){if(!G)return;let v=G.getElement();!v||v===de||(de=v,p==="hover"&&(de.style.pointerEvents="none"),de.addEventListener("mouseenter",()=>{n(24,R=!0)},{passive:!0}),de.addEventListener("mouseleave",()=>{n(24,R=!1)},{passive:!0}),de.addEventListener("click",()=>{_&&n(0,N=!1)},{passive:!0}))}Rt(()=>{if(l)return l.on("click",U),l.on("contextmenu",U),typeof a=="string"&&(l.on("click",a,I),l.on("dblclick",a,I),l.on("contextmenu",a,I),l.on("mousemove",a,y),l.on("mouseleave",a,Re),l.on("touchstart",a,De),l.on("touchend",a,He)),()=>{l!=null&&l.loaded()&&(G==null||G.remove(),l.off("click",U),l.off("contextmenu",U),a instanceof Oe.Marker?a.getPopup()===G&&a.setPopup(void 0):typeof a=="string"&&(l.off("click",a,I),l.off("dblclick",a,I),l.off("contextmenu",a,I),l.off("mousemove",a,y),l.off("mouseleave",a,Re),l.off("touchstart",a,De),l.off("touchend",a,He)))}});function M(v){return O?!("marker"in v)&&!bn(v)&&V(v)!==s:!1}let X=null,x="normal";function I(v){v.type===p&&(M(v)||("layerType"in v?v.layerType==="deckgl"?(n(10,T=v.coordinate),n(4,X=v.object?[v.object]:null)):(n(10,T=v.lngLat),n(4,X=v.features??[])):(n(10,T=v.lngLat),n(4,X=v.features??[])),setTimeout(()=>n(0,N=!0))))}let fe=null;function De(v){fe=v.point}function He(v){if(!fe||p!=="hover")return;let ot=fe.dist(v.point);fe=null,ot<3&&(n(10,T=v.lngLat),n(4,X=v.features??[]),G.isOpen()?n(25,x="justOpened"):(n(25,x="opening"),n(0,N=!0)))}function Re(v){p!=="hover"||fe||x!=="normal"||(n(0,N=!1),n(4,X=null))}function y(v){if(!(p!=="hover"||fe||x!=="normal")){if(M(v)){n(0,N=!1),n(4,X=null);return}n(0,N=!0),n(4,X=v.features??[]),n(10,T=v.lngLat)}}function U(v){if(x==="justOpened"){n(25,x="normal");return}if(!g)return;let ot=[de,a instanceof Oe.Marker?a==null?void 0:a.getElement():null];N&&G.isOpen()&&!ot.some(it=>it==null?void 0:it.contains(v.originalEvent.target))&&(v.type==="contextmenu"&&p==="contextmenu"||v.type!=="contextmenu")&&n(0,N=!1)}Ut(()=>{l&&(G!=null&&G.isOpen())&&G.remove()});let re;const ve=()=>n(0,N=!1);function je(v){oe[v?"unshift":"push"](()=>{re=v,n(1,re)})}return t.$$set=v=>{"closeButton"in v&&n(11,c=v.closeButton),"closeOnClickOutside"in v&&n(12,g=v.closeOnClickOutside),"closeOnClickInside"in v&&n(13,_=v.closeOnClickInside),"closeOnMove"in v&&n(14,u=v.closeOnMove),"openOn"in v&&n(15,p=v.openOn),"openIfTopMost"in v&&n(16,O=v.openIfTopMost),"focusAfterOpen"in v&&n(17,A=v.focusAfterOpen),"anchor"in v&&n(18,H=v.anchor),"offset"in v&&n(19,$=v.offset),"popupClass"in v&&n(20,h=v.popupClass),"maxWidth"in v&&n(21,C=v.maxWidth),"lngLat"in v&&n(10,T=v.lngLat),"html"in v&&n(22,Q=v.html),"open"in v&&n(0,N=v.open),"$$scope"in v&&n(29,f=v.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&n(27,r=c??(!g&&!_)),t.$$.dirty[0]&146685952&&(G||(n(23,G=new Oe.Popup({closeButton:r,closeOnClick:!1,closeOnMove:u,focusAfterOpen:A,maxWidth:C,className:h,anchor:H,offset:$})),de=G.getElement(),G.on("open",()=>{n(0,N=!0),d(),Y("open",G)}),G.on("close",()=>{n(0,N=!1),Y("close",G)}),G.on("hover",()=>{Y("hover",G)}))),t.$$.dirty[0]&8421384&&G&&a instanceof Oe.Marker&&(p==="click"?a.setPopup(G):a.getPopup()===G&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Be.includes(p)&&(i==null?void 0:i.type)===p&&(I(i),Ve(be,i=null,i)),t.$$.dirty[0]&268468224&&n(26,o=p==="hover"&&((i==null?void 0:i.type)==="mousemove"||(i==null?void 0:i.type)==="mouseenter")),t.$$.dirty[0]&352354304&&p==="hover"&&be&&(o&&i&&(i.layerType==="deckgl"?(n(10,T=i.coordinate),n(4,X=i.object?[i.object]:null)):(n(10,T=i.lngLat),n(4,X=i.features??[]))),n(0,N=(o||R)??!1)),t.$$.dirty[0]&12582914&&(re?G.setDOMContent(re):Q&&G.setHTML(Q)),t.$$.dirty[0]&8389632&&T&&G.setLngLat(T),t.$$.dirty[0]&41943045&&l){let v=G.isOpen();N&&!v?(G.addTo(l),x==="opening"&&n(25,x="justOpened")):!N&&v&&G.remove()}},[N,re,l,a,X,k,P,be,ge,j,T,c,g,_,u,p,O,A,H,$,h,C,Q,G,R,x,o,r,i,f,m,ve,je]}class qn extends Ie{constructor(e){super(),Te(this,e,Bn,Fn,Me,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}function Gn(t){let e;const n=t[16].default,r=Ke(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&Ze(r,n,o,o[24],e?Ye(n,o[24],l,null):Qe(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){L(r,o),e=!1},d(o){r&&r.d(o)}}}function Nn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Gn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new Wt({props:l}),oe.push(()=>se(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){S(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],ae(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){L(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function zn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=Vt("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:f=void 0}=e,{layout:j=void 0}=e,{filter:c=void 0}=e,{applyToClusters:g=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:u=void 0}=e,{hoverCursor:p=void 0}=e,{manageHoverState:O=!1}=e,{hovered:A=null}=e,{eventsIfTopMost:H=!1}=e,{interactive:$=!0}=e;function h(P){A=P,n(0,A)}function C(P){_e.call(this,t,P)}function T(P){_e.call(this,t,P)}function Q(P){_e.call(this,t,P)}function N(P){_e.call(this,t,P)}function Y(P){_e.call(this,t,P)}function k(P){_e.call(this,t,P)}return t.$$set=P=>{"id"in P&&n(1,l=P.id),"source"in P&&n(2,i=P.source),"sourceLayer"in P&&n(3,a=P.sourceLayer),"beforeId"in P&&n(4,s=P.beforeId),"beforeLayerType"in P&&n(5,m=P.beforeLayerType),"paint"in P&&n(6,f=P.paint),"layout"in P&&n(7,j=P.layout),"filter"in P&&n(8,c=P.filter),"applyToClusters"in P&&n(9,g=P.applyToClusters),"minzoom"in P&&n(10,_=P.minzoom),"maxzoom"in P&&n(11,u=P.maxzoom),"hoverCursor"in P&&n(12,p=P.hoverCursor),"manageHoverState"in P&&n(13,O=P.manageHoverState),"hovered"in P&&n(0,A=P.hovered),"eventsIfTopMost"in P&&n(14,H=P.eventsIfTopMost),"interactive"in P&&n(15,$=P.interactive),"$$scope"in P&&n(24,o=P.$$scope)},[A,l,i,a,s,m,f,j,c,g,_,u,p,O,H,$,r,h,C,T,Q,N,Y,k,o]}class Dn extends Ie{constructor(e){super(),Te(this,e,zn,Nn,Me,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const Hn=t=>({props:t&8}),$t=t=>({props:Jn(t[3])});function Rn(t){let e,n;const r=t[1].default,o=Ke(r,t,t[2],$t);return{c(){e=te("div"),o&&o.c(),this.h()},l(l){e=ne(l,"DIV",{class:!0});var i=ie(e);o&&o.l(i),i.forEach(b),this.h()},h(){xe(e,"class","govuk-prose")},m(l,i){E(l,e,i),o&&o.m(e,null),n=!0},p(l,i){o&&o.p&&(!n||i&12)&&Ze(o,r,l,l[2],n?Ye(r,l[2],i,Hn):Qe(l[2]),$t)},i(l){n||(w(o,l),n=!0)},o(l){L(o,l),n=!1},d(l){l&&b(e),o&&o.d(l)}}}function Un(t){let e,n;return e=new qn({props:{openOn:t[0],$$slots:{default:[Rn,({features:r})=>({3:r}),({features:r})=>r?8:0]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,[o]){const l={};o&1&&(l.openOn=r[0]),o&12&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Jn(t){return t?t[0].properties??{}:{}}function Wn(t,e,n){let{$$slots:r={},$$scope:o}=e,{openOn:l="hover"}=e;return t.$$set=i=>{"openOn"in i&&n(0,l=i.openOn),"$$scope"in i&&n(2,o=i.$$scope)},[l,r,o]}class Zt extends Ie{constructor(e){super(),Te(this,e,Wn,Un,Me,{openOn:0})}}var Vn=Object.defineProperty,J=(t,e)=>Vn(t,"name",{value:e,configurable:!0}),Xn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!qe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=st(e),o=st(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!qe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return qe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Xt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return qe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(Xn,"GeojsonEquality");function qe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(qe,"sameLength");function st(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(st,"explode");var me=63710088e-1,Qt={centimeters:me*100,centimetres:me*100,degrees:360/(2*Math.PI),feet:me*3.28084,inches:me*39.37,kilometers:me/1e3,kilometres:me/1e3,meters:me,metres:me,miles:me/1609.344,millimeters:me*1e3,millimetres:me*1e3,nauticalmiles:me/1852,radians:1,yards:me*1.0936},Pt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Le(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J(Le,"feature");function Kn(t,e,n={}){switch(t){case"Point":return et(e).geometry;case"LineString":return gt(e).geometry;case"Polygon":return ct(e).geometry;case"MultiPoint":return xt(e).geometry;case"MultiLineString":return Yt(e).geometry;case"MultiPolygon":return en(e).geometry;default:throw new Error(t+" is invalid")}}J(Kn,"geometry");function et(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Se(t[0])||!Se(t[1]))throw new Error("coordinates must contain numbers");return Le({type:"Point",coordinates:t},e,n)}J(et,"point");function Zn(t,e,n={}){return tt(t.map(r=>et(r,e)),n)}J(Zn,"points");function ct(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return Le({type:"Polygon",coordinates:t},e,n)}J(ct,"polygon");function Qn(t,e,n={}){return tt(t.map(r=>ct(r,e)),n)}J(Qn,"polygons");function gt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Le({type:"LineString",coordinates:t},e,n)}J(gt,"lineString");function Yn(t,e,n={}){return tt(t.map(r=>gt(r,e)),n)}J(Yn,"lineStrings");function tt(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(tt,"featureCollection");function Yt(t,e,n={}){return Le({type:"MultiLineString",coordinates:t},e,n)}J(Yt,"multiLineString");function xt(t,e,n={}){return Le({type:"MultiPoint",coordinates:t},e,n)}J(xt,"multiPoint");function en(t,e,n={}){return Le({type:"MultiPolygon",coordinates:t},e,n)}J(en,"multiPolygon");function xn(t,e,n={}){return Le({type:"GeometryCollection",geometries:t},e,n)}J(xn,"geometryCollection");function er(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J(er,"round");function tn(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(tn,"radiansToLength");function nt(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(nt,"lengthToRadians");function tr(t,e){return Xe(nt(t,e))}J(tr,"lengthToDegrees");function nr(t){let e=t%360;return e<0&&(e+=360),e}J(nr,"bearingToAzimuth");function Xe(t){return t%(2*Math.PI)*180/Math.PI}J(Xe,"radiansToDegrees");function We(t){return t%360*Math.PI/180}J(We,"degreesToRadians");function rr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return tn(nt(t,e),n)}J(rr,"convertLength");function or(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Pt[e];if(!r)throw new Error("invalid original units");const o=Pt[n];if(!o)throw new Error("invalid final units");return t/r*o}J(or,"convertArea");function Se(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(Se,"isNumber");function ir(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(ir,"isObject");function lr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Se(e))throw new Error("bbox must only contain numbers")})}J(lr,"validateBBox");function ar(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(ar,"validateId");var sr=Object.defineProperty,Ee=(t,e)=>sr(t,"name",{value:e,configurable:!0});function nn(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}Ee(nn,"getCoord");function ur(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}Ee(ur,"getCoords");function rn(t){if(t.length>1&&Se(t[0])&&Se(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return rn(t[0]);throw new Error("coordinates must only contain numbers")}Ee(rn,"containsNumber");function fr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}Ee(fr,"geojsonType");function mr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}Ee(mr,"featureOf");function cr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}Ee(cr,"collectionOf");function gr(t){return t.type==="Feature"?t.geometry:t}Ee(gr,"getGeom");function dr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}Ee(dr,"getType");var _r=Object.defineProperty,pr=(t,e)=>_r(t,"name",{value:e,configurable:!0});function on(t,e,n,r={}){const o=nn(t),l=We(o[0]),i=We(o[1]),a=We(n),s=nt(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),f=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),j=Xe(f),c=Xe(m);return et([j,c],r.properties)}pr(on,"destination");var hr=on,yr=Object.defineProperty,W=(t,e)=>yr(t,"name",{value:e,configurable:!0}),br=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ge(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=ut(e),o=ut(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ge(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ge(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Xt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ge(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};W(br,"GeojsonEquality");function Ge(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}W(Ge,"sameLength");function ut(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}W(ut,"explode");var ce=63710088e-1,ln={centimeters:ce*100,centimetres:ce*100,degrees:360/(2*Math.PI),feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},Mt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Ce(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}W(Ce,"feature");function vr(t,e,n={}){switch(t){case"Point":return dt(e).geometry;case"LineString":return pt(e).geometry;case"Polygon":return _t(e).geometry;case"MultiPoint":return sn(e).geometry;case"MultiLineString":return an(e).geometry;case"MultiPolygon":return un(e).geometry;default:throw new Error(t+" is invalid")}}W(vr,"geometry");function dt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Fe(t[0])||!Fe(t[1]))throw new Error("coordinates must contain numbers");return Ce({type:"Point",coordinates:t},e,n)}W(dt,"point");function wr(t,e,n={}){return rt(t.map(r=>dt(r,e)),n)}W(wr,"points");function _t(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return Ce({type:"Polygon",coordinates:t},e,n)}W(_t,"polygon");function kr(t,e,n={}){return rt(t.map(r=>_t(r,e)),n)}W(kr,"polygons");function pt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return Ce({type:"LineString",coordinates:t},e,n)}W(pt,"lineString");function jr(t,e,n={}){return rt(t.map(r=>pt(r,e)),n)}W(jr,"lineStrings");function rt(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}W(rt,"featureCollection");function an(t,e,n={}){return Ce({type:"MultiLineString",coordinates:t},e,n)}W(an,"multiLineString");function sn(t,e,n={}){return Ce({type:"MultiPoint",coordinates:t},e,n)}W(sn,"multiPoint");function un(t,e,n={}){return Ce({type:"MultiPolygon",coordinates:t},e,n)}W(un,"multiPolygon");function Lr(t,e,n={}){return Ce({type:"GeometryCollection",geometries:t},e,n)}W(Lr,"geometryCollection");function Er(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}W(Er,"round");function fn(t,e="kilometers"){const n=ln[e];if(!n)throw new Error(e+" units is invalid");return t*n}W(fn,"radiansToLength");function ht(t,e="kilometers"){const n=ln[e];if(!n)throw new Error(e+" units is invalid");return t/n}W(ht,"lengthToRadians");function Cr(t,e){return yt(ht(t,e))}W(Cr,"lengthToDegrees");function $r(t){let e=t%360;return e<0&&(e+=360),e}W($r,"bearingToAzimuth");function yt(t){return t%(2*Math.PI)*180/Math.PI}W(yt,"radiansToDegrees");function Ne(t){return t%360*Math.PI/180}W(Ne,"degreesToRadians");function Pr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return fn(ht(t,e),n)}W(Pr,"convertLength");function Mr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=Mt[e];if(!r)throw new Error("invalid original units");const o=Mt[n];if(!o)throw new Error("invalid final units");return t/r*o}W(Mr,"convertArea");function Fe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}W(Fe,"isNumber");function Ir(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}W(Ir,"isObject");function Tr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Fe(e))throw new Error("bbox must only contain numbers")})}W(Tr,"validateBBox");function Or(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}W(Or,"validateId");var Ar=Object.defineProperty,$e=(t,e)=>Ar(t,"name",{value:e,configurable:!0});function ft(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}$e(ft,"getCoord");function Sr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}$e(Sr,"getCoords");function mn(t){if(t.length>1&&Fe(t[0])&&Fe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return mn(t[0]);throw new Error("coordinates must only contain numbers")}$e(mn,"containsNumber");function Fr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}$e(Fr,"geojsonType");function Br(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}$e(Br,"featureOf");function qr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}$e(qr,"collectionOf");function Gr(t){return t.type==="Feature"?t.geometry:t}$e(Gr,"getGeom");function Nr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}$e(Nr,"getType");var zr=Object.defineProperty,cn=(t,e)=>zr(t,"name",{value:e,configurable:!0});function bt(t,e,n={}){if(n.final===!0)return gn(t,e);const r=ft(t),o=ft(e),l=Ne(r[0]),i=Ne(o[0]),a=Ne(r[1]),s=Ne(o[1]),m=Math.sin(i-l)*Math.cos(s),f=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return yt(Math.atan2(m,f))}cn(bt,"bearing");function gn(t,e){let n=bt(e,t);return n=(n+180)%360,n}cn(gn,"calculateFinalBearing");var Dr=bt;function Hr(t){let e,n,r,o,l,i,a,s,m,f,j,c;function g(h){t[6](h)}let _={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new mt({props:_}),oe.push(()=>se(e,"value",g));function u(h){t[7](h)}let p={label:"Movement",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(p.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new jt({props:p}),oe.push(()=>se(o,"value",u));function O(h){t[8](h)}let A={label:"Score",choices:t[5]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(A.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new jt({props:A}),oe.push(()=>se(a,"value",O));function H(h){t[9](h)}let $={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&($.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),f=new Kt({props:$}),oe.push(()=>se(f,"value",H)),{c(){S(e.$$.fragment),r=z(),S(o.$$.fragment),i=z(),S(a.$$.fragment),m=z(),S(f.$$.fragment)},l(h){F(e.$$.fragment,h),r=D(h),F(o.$$.fragment,h),i=D(h),F(a.$$.fragment,h),m=D(h),F(f.$$.fragment,h)},m(h,C){B(e,h,C),E(h,r,C),B(o,h,C),E(h,i,C),B(a,h,C),E(h,m,C),B(f,h,C),c=!0},p(h,[C]){const T={};!n&&C&15&&(n=!0,T.value=h[3].jat[h[0]][h[1]].movements[h[2]].name,ae(()=>n=!1)),e.$set(T);const Q={};!l&&C&15&&(l=!0,Q.value=h[3].jat[h[0]][h[1]].movements[h[2]].kind,ae(()=>l=!1)),o.$set(Q);const N={};!s&&C&15&&(s=!0,N.value=h[3].jat[h[0]][h[1]].movements[h[2]].score,ae(()=>s=!1)),a.$set(N);const Y={};!j&&C&15&&(j=!0,Y.value=h[3].jat[h[0]][h[1]].movements[h[2]].notes,ae(()=>j=!1)),f.$set(Y)},i(h){c||(w(e.$$.fragment,h),w(o.$$.fragment,h),w(a.$$.fragment,h),w(f.$$.fragment,h),c=!0)},o(h){L(e.$$.fragment,h),L(o.$$.fragment,h),L(a.$$.fragment,h),L(f.$$.fragment,h),c=!1},d(h){h&&(b(r),b(i),b(m)),q(e,h),q(o,h),q(a,h),q(f,h)}}}function Rr(t,e,n){let r;Pe(t,ee,g=>n(3,r=g));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=In(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function m(g){t.$$.not_equal(r.jat[o][l].movements[i].name,g)&&(r.jat[o][l].movements[i].name=g,ee.set(r))}function f(g){t.$$.not_equal(r.jat[o][l].movements[i].kind,g)&&(r.jat[o][l].movements[i].kind=g,ee.set(r))}function j(g){t.$$.not_equal(r.jat[o][l].movements[i].score,g)&&(r.jat[o][l].movements[i].score=g,ee.set(r))}function c(g){t.$$.not_equal(r.jat[o][l].movements[i].notes,g)&&(r.jat[o][l].movements[i].notes=g,ee.set(r))}return t.$$set=g=>{"junctionIdx"in g&&n(0,o=g.junctionIdx),"stage"in g&&n(1,l=g.stage),"idx"in g&&n(2,i=g.idx)},[o,l,i,r,a,s,m,f,j,c]}class Ur extends Ie{constructor(e){super(),Te(this,e,Rr,Hr,Me,{junctionIdx:0,stage:1,idx:2})}}const{window:Jr}=wn;function It(t,e,n){const r=t.slice();return r[44]=e[n],r[45]=e,r[46]=n,r}function Tt(t,e,n){const r=t.slice();return r[47]=e[n],r[48]=e,r[46]=n,r}function Ot(t,e,n){const r=t.slice();return r[44]=e[n],r[46]=n,r}function At(t,e,n){const r=t.slice();return r[47]=e[n],r[46]=n,r}function Wr(t){let e,n,r,o,l,i,a,s;e=new kn({props:{$$slots:{default:[Xr]},$$scope:{ctx:t}}}),e.$on("click",t[26]),r=new Jt({props:{$$slots:{default:[Kr]},$$scope:{ctx:t}}}),r.$on("click",t[13]);const m=[Qr,Zr],f=[];function j(c,g){return c[2].kind=="movement"?0:1}return l=j(t),i=f[l]=m[l](t),{c(){S(e.$$.fragment),n=z(),S(r.$$.fragment),o=z(),i.c(),a=Ae()},l(c){F(e.$$.fragment,c),n=D(c),F(r.$$.fragment,c),o=D(c),i.l(c),a=Ae()},m(c,g){B(e,c,g),E(c,n,g),B(r,c,g),E(c,o,g),f[l].m(c,g),E(c,a,g),s=!0},p(c,g){const _={};g[1]&1048576&&(_.$$scope={dirty:g,ctx:c}),e.$set(_);const u={};g[1]&1048576&&(u.$$scope={dirty:g,ctx:c}),r.$set(u);let p=l;l=j(c),l===p?f[l].p(c,g):(pe(),L(f[p],1,1,()=>{f[p]=null}),he(),i=f[l],i?i.p(c,g):(i=f[l]=m[l](c),i.c()),w(i,1),i.m(a.parentNode,a))},i(c){s||(w(e.$$.fragment,c),w(r.$$.fragment,c),w(i),s=!0)},o(c){L(e.$$.fragment,c),L(r.$$.fragment,c),L(i),s=!1},d(c){c&&(b(n),b(o),b(a)),q(e,c),q(r,c),f[l].d(c)}}}function Vr(t){let e,n,r,o,l,i,a,s,m,f,j,c="Arms",g,_,u,p,O="Movements",A,H,$,h,C,T=zt(t[4].jat[t[0]][t[1]])+"",Q,N,Y;e=new we({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),e.$on("click",t[17]),r=new Ln({}),l=new En({});let k=t[5]&&St(t);function P(d){t[19](d)}let be={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[6]!==void 0&&(be.value=t[6]),s=new Cn({props:be}),oe.push(()=>se(s,"value",P));let ge=ye(t[4].jat[t[0]][t[1]].arms),V=[];for(let d=0;d<ge.length;d+=1)V[d]=Ft(At(t,ge,d));const Be=d=>L(V[d],1,1,()=>{V[d]=null});let G=ye(t[4].jat[t[0]][t[1]].movements),R=[];for(let d=0;d<G.length;d+=1)R[d]=Bt(Ot(t,G,d));const de=d=>L(R[d],1,1,()=>{R[d]=null});return{c(){S(e.$$.fragment),n=z(),S(r.$$.fragment),o=z(),S(l.$$.fragment),i=z(),k&&k.c(),a=z(),S(s.$$.fragment),f=z(),j=te("h3"),j.textContent=c,g=z(),_=te("ul");for(let d=0;d<V.length;d+=1)V[d].c();u=z(),p=te("h3"),p.textContent=O,A=z(),H=te("ol");for(let d=0;d<R.length;d+=1)R[d].c();$=z(),h=te("p"),C=K("Total JAT score: "),Q=K(T),N=K("%")},l(d){F(e.$$.fragment,d),n=D(d),F(r.$$.fragment,d),o=D(d),F(l.$$.fragment,d),i=D(d),k&&k.l(d),a=D(d),F(s.$$.fragment,d),f=D(d),j=ne(d,"H3",{"data-svelte-h":!0}),vt(j)!=="svelte-ld74qb"&&(j.textContent=c),g=D(d),_=ne(d,"UL",{});var M=ie(_);for(let I=0;I<V.length;I+=1)V[I].l(M);M.forEach(b),u=D(d),p=ne(d,"H3",{"data-svelte-h":!0}),vt(p)!=="svelte-1dc52s8"&&(p.textContent=O),A=D(d),H=ne(d,"OL",{});var X=ie(H);for(let I=0;I<R.length;I+=1)R[I].l(X);X.forEach(b),$=D(d),h=ne(d,"P",{});var x=ie(h);C=Z(x,"Total JAT score: "),Q=Z(x,T),N=Z(x,"%"),x.forEach(b)},m(d,M){B(e,d,M),E(d,n,M),B(r,d,M),E(d,o,M),B(l,d,M),E(d,i,M),k&&k.m(d,M),E(d,a,M),B(s,d,M),E(d,f,M),E(d,j,M),E(d,g,M),E(d,_,M);for(let X=0;X<V.length;X+=1)V[X]&&V[X].m(_,null);E(d,u,M),E(d,p,M),E(d,A,M),E(d,H,M);for(let X=0;X<R.length;X+=1)R[X]&&R[X].m(H,null);E(d,$,M),E(d,h,M),ue(h,C),ue(h,Q),ue(h,N),Y=!0},p(d,M){const X={};M[1]&1048576&&(X.$$scope={dirty:M,ctx:d}),e.$set(X),d[5]?k?(k.p(d,M),M[0]&32&&w(k,1)):(k=St(d),k.c(),w(k,1),k.m(a.parentNode,a)):k&&(pe(),L(k,1,1,()=>{k=null}),he());const x={};if(!m&&M[0]&64&&(m=!0,x.value=d[6],ae(()=>m=!1)),s.$set(x),M[0]&1051){ge=ye(d[4].jat[d[0]][d[1]].arms);let I;for(I=0;I<ge.length;I+=1){const fe=At(d,ge,I);V[I]?(V[I].p(fe,M),w(V[I],1)):(V[I]=Ft(fe),V[I].c(),w(V[I],1),V[I].m(_,null))}for(pe(),I=ge.length;I<V.length;I+=1)Be(I);he()}if(M[0]&1051){G=ye(d[4].jat[d[0]][d[1]].movements);let I;for(I=0;I<G.length;I+=1){const fe=Ot(d,G,I);R[I]?(R[I].p(fe,M),w(R[I],1)):(R[I]=Bt(fe),R[I].c(),w(R[I],1),R[I].m(H,null))}for(pe(),I=G.length;I<R.length;I+=1)de(I);he()}(!Y||M[0]&19)&&T!==(T=zt(d[4].jat[d[0]][d[1]])+"")&&ke(Q,T)},i(d){if(!Y){w(e.$$.fragment,d),w(r.$$.fragment,d),w(l.$$.fragment,d),w(k),w(s.$$.fragment,d);for(let M=0;M<ge.length;M+=1)w(V[M]);for(let M=0;M<G.length;M+=1)w(R[M]);Y=!0}},o(d){L(e.$$.fragment,d),L(r.$$.fragment,d),L(l.$$.fragment,d),L(k),L(s.$$.fragment,d),V=V.filter(Boolean);for(let M=0;M<V.length;M+=1)L(V[M]);R=R.filter(Boolean);for(let M=0;M<R.length;M+=1)L(R[M]);Y=!1},d(d){d&&(b(n),b(o),b(i),b(a),b(f),b(j),b(g),b(_),b(u),b(p),b(A),b(H),b($),b(h)),q(e,d),q(r,d),q(l,d),k&&k.d(d),q(s,d),ze(V,d),ze(R,d)}}}function Xr(t){let e;return{c(){e=K("Save")},l(n){e=Z(n,"Save")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Kr(t){let e;return{c(){e=K("Delete")},l(n){e=Z(n,"Delete")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Zr(t){let e,n,r;function o(i){t[27](i)}let l={label:"Name"};return t[4].jat[t[0]][t[1]].arms[t[2].idx].name!==void 0&&(l.value=t[4].jat[t[0]][t[1]].arms[t[2].idx].name),e=new mt({props:l}),oe.push(()=>se(e,"value",o)),{c(){S(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&23&&(n=!0,s.value=i[4].jat[i[0]][i[1]].arms[i[2].idx].name,ae(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){L(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function Qr(t){let e,n;return e=new Ur({props:{junctionIdx:t[0],stage:t[1],idx:t[2].idx}}),{c(){S(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&4&&(l.idx=r[2].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Yr(t){let e;return{c(){e=K("Zoom to fit")},l(n){e=Z(n,"Zoom to fit")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function St(t){let e,n,r;function o(i){t[18](i)}let l={map:t[5]};return t[7]!==void 0&&(l.enabled=t[7]),e=new $n({props:l}),oe.push(()=>se(e,"enabled",o)),{c(){S(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){B(e,i,a),r=!0},p(i,a){const s={};a[0]&32&&(s.map=i[5]),!n&&a[0]&128&&(n=!0,s.enabled=i[7],ae(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){L(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function xr(t){let e,n,r=(t[47].name||"Unnamed arm")+"",o;return{c(){e=K(t[46]),n=K(" - "),o=K(r)},l(l){e=Z(l,t[46]),n=Z(l," - "),o=Z(l,r)},m(l,i){E(l,e,i),E(l,n,i),E(l,o,i)},p(l,i){i[0]&19&&r!==(r=(l[47].name||"Unnamed arm")+"")&&ke(o,r)},d(l){l&&(b(e),b(n),b(o))}}}function Ft(t){let e,n,r,o;function l(){return t[20](t[46])}function i(){return t[21](t[46])}return n=new we({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[22]),{c(){e=te("li"),S(n.$$.fragment),r=z()},l(a){e=ne(a,"LI",{});var s=ie(e);F(n.$$.fragment,s),r=D(s),s.forEach(b)},m(a,s){E(a,e,s),B(n,e,null),ue(e,r),o=!0},p(a,s){t=a;const m={};s[0]&19|s[1]&1048576&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){L(n.$$.fragment,a),o=!1},d(a){a&&b(e),q(n)}}}function eo(t){let e=(t[44].name||"Unnamed movement")+"",n;return{c(){n=K(e)},l(r){n=Z(r,e)},m(r,o){E(r,n,o)},p(r,o){o[0]&19&&e!==(e=(r[44].name||"Unnamed movement")+"")&&ke(n,e)},d(r){r&&b(n)}}}function Bt(t){let e,n,r,o;function l(){return t[23](t[46])}function i(){return t[24](t[46])}return n=new we({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[25]),{c(){e=te("li"),S(n.$$.fragment),r=z()},l(a){e=ne(a,"LI",{});var s=ie(e);F(n.$$.fragment,s),r=D(s),s.forEach(b)},m(a,s){E(a,e,s),B(n,e,null),ue(e,r),o=!0},p(a,s){t=a;const m={};s[0]&19|s[1]&1048576&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){L(n.$$.fragment,a),o=!1},d(a){a&&b(e),q(n)}}}function to(t){let e,n,r,o=t[47].name+"",l;return{c(){e=te("span"),n=K(t[46]),r=K(" - "),l=K(o),this.h()},l(i){e=ne(i,"SPAN",{class:!0});var a=ie(e);n=Z(a,t[46]),r=Z(a," - "),l=Z(a,o),a.forEach(b),this.h()},h(){xe(e,"class","dot svelte-1kvjd2"),le(e,"background-color","white")},m(i,a){E(i,e,a),ue(e,n),ue(e,r),ue(e,l)},p(i,a){a[0]&19&&o!==(o=i[47].name+"")&&ke(l,o)},d(i){i&&b(e)}}}function qt(t){let e,n,r;function o(s){t[28](s,t[47])}function l(){return t[29](t[46])}function i(){return t[30](t[46])}let a={draggable:!0,$$slots:{default:[to]},$$scope:{ctx:t}};return t[47].point!==void 0&&(a.lngLat=t[47].point),e=new lt({props:a}),oe.push(()=>se(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){S(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,m){B(e,s,m),r=!0},p(s,m){t=s;const f={};m[0]&19|m[1]&1048576&&(f.$$scope={dirty:m,ctx:t}),!n&&m[0]&19&&(n=!0,f.lngLat=t[47].point,ae(()=>n=!1)),e.$set(f)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){L(e.$$.fragment,s),r=!1},d(s){q(e,s)}}}function no(t){let e;return{c(){e=te("span"),this.h()},l(n){e=ne(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){xe(e,"class","dot svelte-1kvjd2"),le(e,"background-color",t[9][t[44].score]),le(e,"opacity",t[44].kind=="pedestrian"?"0%":"100%")},m(n,r){E(n,e,r)},p(n,r){r[0]&19&&le(e,"background-color",n[9][n[44].score]),r[0]&19&&le(e,"opacity",n[44].kind=="pedestrian"?"0%":"100%")},d(n){n&&b(e)}}}function ro(t){let e;return{c(){e=te("span"),this.h()},l(n){e=ne(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){xe(e,"class","dot svelte-1kvjd2"),le(e,"background-color",t[9][t[44].score]),le(e,"opacity","0%")},m(n,r){E(n,e,r)},p(n,r){r[0]&19&&le(e,"background-color",n[9][n[44].score])},d(n){n&&b(e)}}}function Gt(t){let e,n,r,o,l,i;function a(u){t[31](u,t[44])}function s(){return t[32](t[46])}function m(){return t[33](t[46])}let f={draggable:!0,$$slots:{default:[no]},$$scope:{ctx:t}};t[44].point1!==void 0&&(f.lngLat=t[44].point1),e=new lt({props:f}),oe.push(()=>se(e,"lngLat",a)),e.$on("dragend",s),e.$on("click",m);function j(u){t[34](u,t[44])}function c(){return t[35](t[46])}function g(){return t[36](t[46])}let _={draggable:!0,$$slots:{default:[ro]},$$scope:{ctx:t}};return t[44].point2!==void 0&&(_.lngLat=t[44].point2),o=new lt({props:_}),oe.push(()=>se(o,"lngLat",j)),o.$on("dragend",c),o.$on("click",g),{c(){S(e.$$.fragment),r=z(),S(o.$$.fragment)},l(u){F(e.$$.fragment,u),r=D(u),F(o.$$.fragment,u)},m(u,p){B(e,u,p),E(u,r,p),B(o,u,p),i=!0},p(u,p){t=u;const O={};p[0]&19|p[1]&1048576&&(O.$$scope={dirty:p,ctx:t}),!n&&p[0]&19&&(n=!0,O.lngLat=t[44].point1,ae(()=>n=!1)),e.$set(O);const A={};p[0]&19|p[1]&1048576&&(A.$$scope={dirty:p,ctx:t}),!l&&p[0]&19&&(l=!0,A.lngLat=t[44].point2,ae(()=>l=!1)),o.$set(A)},i(u){i||(w(e.$$.fragment,u),w(o.$$.fragment,u),i=!0)},o(u){L(e.$$.fragment,u),L(o.$$.fragment,u),i=!1},d(u){u&&b(r),q(e,u),q(o,u)}}}function oo(t){let e=(t[43].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=Z(r,e)},m(r,o){E(r,n,o)},p(r,o){o[1]&4096&&e!==(e=(r[43].name||"Untitled movement")+"")&&ke(n,e)},d(r){r&&b(n)}}}function io(t){let e,n;return e=new Zt({props:{$$slots:{default:[oo,({props:r})=>({43:r}),({props:r})=>[0,r?4096:0]]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[1]&1052672&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function lo(t){let e=(t[43].name||"Untitled movement")+"",n;return{c(){n=K(e)},l(r){n=Z(r,e)},m(r,o){E(r,n,o)},p(r,o){o[1]&4096&&e!==(e=(r[43].name||"Untitled movement")+"")&&ke(n,e)},d(r){r&&b(n)}}}function ao(t){let e,n;return e=new Zt({props:{$$slots:{default:[lo,({props:r})=>({43:r}),({props:r})=>[0,r?4096:0]]},$$scope:{ctx:t}}}),{c(){S(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){B(e,r,o),n=!0},p(r,o){const l={};o[1]&1052672&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){L(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function so(t){let e,n,r,o,l,i;return e=new at({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":kt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[io]},$$scope:{ctx:t}}}),e.$on("click",t[11]),r=new at({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":kt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[ao]},$$scope:{ctx:t}}}),r.$on("click",t[11]),l=new Dn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["+",["get","angle"],["match",["get","kind"],"cycling-left-turn",-90,"cycling-right-turn",90,0]],"text-size":70}}}),{c(){S(e.$$.fragment),n=z(),S(r.$$.fragment),o=z(),S(l.$$.fragment)},l(a){F(e.$$.fragment,a),n=D(a),F(r.$$.fragment,a),o=D(a),F(l.$$.fragment,a)},m(a,s){B(e,a,s),E(a,n,s),B(r,a,s),E(a,o,s),B(l,a,s),i=!0},p(a,s){const m={};s[1]&1048576&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const f={};s[1]&1048576&&(f.$$scope={dirty:s,ctx:a}),r.$set(f)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){L(e.$$.fragment,a),L(r.$$.fragment,a),L(l.$$.fragment,a),i=!1},d(a){a&&(b(n),b(o)),q(e,a),q(r,a),q(l,a)}}}function uo(t){let e,n,r,o;return e=new at({props:{paint:{"line-width":15,"line-color":"yellow"}}}),r=new Mn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-color":"yellow","circle-radius":20}}}),{c(){S(e.$$.fragment),n=z(),S(r.$$.fragment)},l(l){F(e.$$.fragment,l),n=D(l),F(r.$$.fragment,l)},m(l,i){B(e,l,i),E(l,n,i),B(r,l,i),o=!0},p:hn,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){L(e.$$.fragment,l),L(r.$$.fragment,l),o=!1},d(l){l&&b(n),q(e,l),q(r,l)}}}function fo(t){let e,n,r,o,l,i,a,s,m=ye(t[4].jat[t[0]][t[1]].arms),f=[];for(let u=0;u<m.length;u+=1)f[u]=qt(Tt(t,m,u));const j=u=>L(f[u],1,1,()=>{f[u]=null});let c=ye(t[4].jat[t[0]][t[1]].movements),g=[];for(let u=0;u<c.length;u+=1)g[u]=Gt(It(t,c,u));const _=u=>L(g[u],1,1,()=>{g[u]=null});return r=new wt({props:{data:t[12](t[4]),$$slots:{default:[so]},$$scope:{ctx:t}}}),l=new wt({props:{data:t[8],$$slots:{default:[uo]},$$scope:{ctx:t}}}),a=new Pn({props:{map:t[5]}}),{c(){for(let u=0;u<f.length;u+=1)f[u].c();e=z();for(let u=0;u<g.length;u+=1)g[u].c();n=z(),S(r.$$.fragment),o=z(),S(l.$$.fragment),i=z(),S(a.$$.fragment)},l(u){for(let p=0;p<f.length;p+=1)f[p].l(u);e=D(u);for(let p=0;p<g.length;p+=1)g[p].l(u);n=D(u),F(r.$$.fragment,u),o=D(u),F(l.$$.fragment,u),i=D(u),F(a.$$.fragment,u)},m(u,p){for(let O=0;O<f.length;O+=1)f[O]&&f[O].m(u,p);E(u,e,p);for(let O=0;O<g.length;O+=1)g[O]&&g[O].m(u,p);E(u,n,p),B(r,u,p),E(u,o,p),B(l,u,p),E(u,i,p),B(a,u,p),s=!0},p(u,p){if(p[0]&1043){m=ye(u[4].jat[u[0]][u[1]].arms);let $;for($=0;$<m.length;$+=1){const h=Tt(u,m,$);f[$]?(f[$].p(h,p),w(f[$],1)):(f[$]=qt(h),f[$].c(),w(f[$],1),f[$].m(e.parentNode,e))}for(pe(),$=m.length;$<f.length;$+=1)j($);he()}if(p[0]&1555){c=ye(u[4].jat[u[0]][u[1]].movements);let $;for($=0;$<c.length;$+=1){const h=It(u,c,$);g[$]?(g[$].p(h,p),w(g[$],1)):(g[$]=Gt(h),g[$].c(),w(g[$],1),g[$].m(n.parentNode,n))}for(pe(),$=c.length;$<g.length;$+=1)_($);he()}const O={};p[0]&16&&(O.data=u[12](u[4])),p[1]&1048576&&(O.$$scope={dirty:p,ctx:u}),r.$set(O);const A={};p[0]&256&&(A.data=u[8]),p[1]&1048576&&(A.$$scope={dirty:p,ctx:u}),l.$set(A);const H={};p[0]&32&&(H.map=u[5]),a.$set(H)},i(u){if(!s){for(let p=0;p<m.length;p+=1)w(f[p]);for(let p=0;p<c.length;p+=1)w(g[p]);w(r.$$.fragment,u),w(l.$$.fragment,u),w(a.$$.fragment,u),s=!0}},o(u){f=f.filter(Boolean);for(let p=0;p<f.length;p+=1)L(f[p]);g=g.filter(Boolean);for(let p=0;p<g.length;p+=1)L(g[p]);L(r.$$.fragment,u),L(l.$$.fragment,u),L(a.$$.fragment,u),s=!1},d(u){u&&(b(e),b(n),b(o),b(i)),ze(f,u),ze(g,u),q(r,u),q(l,u),q(a,u)}}}function mo(t){let e,n,r,o,l,i,a,s,m,f,j,c,g,_;function u(C){t[16](C)}let p={label:"Commentary / Notes"};t[4].jat[t[0]][t[1]].notes!==void 0&&(p.value=t[4].jat[t[0]][t[1]].notes),e=new Kt({props:p}),oe.push(()=>se(e,"value",u));const O=[Vr,Wr],A=[];function H(C,T){return C[2]==null?0:1}i=H(t),a=A[i]=O[i](t);function $(C){t[37](C)}let h={$$slots:{default:[fo]},$$scope:{ctx:t}};return t[5]!==void 0&&(h.map=t[5]),f=new vn({props:h}),oe.push(()=>se(f,"map",$)),{c(){S(e.$$.fragment),r=z(),o=te("div"),l=te("div"),a.c(),s=z(),m=te("div"),S(f.$$.fragment),this.h()},l(C){F(e.$$.fragment,C),r=D(C),o=ne(C,"DIV",{style:!0});var T=ie(o);l=ne(T,"DIV",{style:!0});var Q=ie(l);a.l(Q),Q.forEach(b),s=D(T),m=ne(T,"DIV",{style:!0});var N=ie(m);F(f.$$.fragment,N),N.forEach(b),T.forEach(b),this.h()},h(){le(l,"width","30%"),le(l,"overflow-y","scroll"),le(l,"padding","10px"),le(m,"position","relative"),le(m,"width","100%"),le(o,"display","flex"),le(o,"height","80vh")},m(C,T){B(e,C,T),E(C,r,T),E(C,o,T),ue(o,l),A[i].m(l,null),ue(o,s),ue(o,m),B(f,m,null),c=!0,g||(_=pn(Jr,"keydown",t[15]),g=!0)},p(C,T){const Q={};!n&&T[0]&19&&(n=!0,Q.value=C[4].jat[C[0]][C[1]].notes,ae(()=>n=!1)),e.$set(Q);let N=i;i=H(C),i===N?A[i].p(C,T):(pe(),L(A[N],1,1,()=>{A[N]=null}),he(),a=A[i],a?a.p(C,T):(a=A[i]=O[i](C),a.c()),w(a,1),a.m(l,null));const Y={};T[0]&307|T[1]&1048576&&(Y.$$scope={dirty:T,ctx:C}),!j&&T[0]&32&&(j=!0,Y.map=C[5],ae(()=>j=!1)),f.$set(Y)},i(C){c||(w(e.$$.fragment,C),w(a),w(f.$$.fragment,C),c=!0)},o(C){L(e.$$.fragment,C),L(a),L(f.$$.fragment,C),c=!1},d(C){C&&(b(r),b(o)),q(e,C),A[i].d(),q(f),g=!1,_()}}}function Nt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function zt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function co(t,e,n){let r,o;Pe(t,ee,y=>n(4,o=y));let{junctionIdx:l}=e,{stage:i}=e,a,s="arm",m=null,f=null,j=!1,c={0:Ue.red.background,1:Ue.amber.background,2:Ue.green.background,X:Ue.critical.background};function g(y,U,re){let ve={type:"FeatureCollection",features:[]},je=U??re;return je!=null&&(je.kind=="arm"?ve.features.push(Nt(y.jat[l][i].arms[je.idx],je.idx)):ve.features.push(A(y.jat[l][i].movements[je.idx],je.idx))),ve}function _(y){n(2,m=y),n(3,f=null)}function u(y){if(!j){for(let U of a.queryRenderedFeatures(y.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(m!=null){n(2,m=null);return}s=="arm"?(Ve(ee,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:y.lngLat.toArray(),name:""}],o),n(2,m={kind:"arm",idx:o.jat[l][i].arms.length-1})):(Ve(ee,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:y.lngLat.toArray(),point2:hr(y.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",score:"X",name:"",notes:""}],o),n(2,m={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(3,f=null)}}function p(y){_({kind:"movement",idx:y.detail.features[0].id})}Rt(()=>{a.on("click",u),h(!1)}),Ut(()=>{a.off("click",u)});function O(y){let U={type:"FeatureCollection",features:y.jat[l][i].movements.map((re,ve)=>A(re,ve))};for(let re of y.jat[l][i].movements)if(U.features.push(H(re,U.features.length)),re.kind=="pedestrian"){let ve={...re,point1:re.point2,point2:re.point1};U.features.push(H(ve,U.features.length))}for(let re of y.jat[l][i].arms)U.features.push(Nt(re,U.features.length));return U}function A(y,U){return{type:"Feature",id:U,properties:{name:y.name,kind:y.kind,color:c[y.score]},geometry:{type:"LineString",coordinates:[y.point1,y.point2]}}}function H(y,U){return{type:"Feature",id:U,properties:{kind:y.kind,color:c[y.score],angle:Dr(y.point1,y.point2)},geometry:{type:"Point",coordinates:y.point2}}}function $(){window.confirm(`Delete this ${m.kind}?`)&&(m.kind=="movement"?(o.jat[l][i].movements.splice(m.idx,1),ee.set(o)):(o.jat[l][i].arms.splice(m.idx,1),ee.set(o)),n(2,m=null))}function h(y){let U=O(o);U.features.length>0&&a.fitBounds(jn(U),{padding:20,animate:y})}function C(y){m!=null&&y.key=="Escape"?(y.stopPropagation(),n(2,m=null)):m!=null&&y.key=="Delete"&&$()}function T(y){t.$$.not_equal(o.jat[l][i].notes,y)&&(o.jat[l][i].notes=y,ee.set(o))}const Q=()=>h(!0);function N(y){j=y,n(7,j)}function Y(y){s=y,n(6,s)}const k=y=>_({kind:"arm",idx:y}),P=y=>n(3,f={kind:"arm",idx:y}),be=()=>n(3,f=null),ge=y=>_({kind:"movement",idx:y}),V=y=>n(3,f={kind:"movement",idx:y}),Be=()=>n(3,f=null),G=()=>n(2,m=null);function R(y){t.$$.not_equal(o.jat[l][i].arms[m.idx].name,y)&&(o.jat[l][i].arms[m.idx].name=y,ee.set(o))}function de(y,U){t.$$.not_equal(U.point,y)&&(U.point=y,ee.set(o))}const d=y=>_({kind:"arm",idx:y}),M=y=>_({kind:"arm",idx:y});function X(y,U){t.$$.not_equal(U.point1,y)&&(U.point1=y,ee.set(o))}const x=y=>_({kind:"movement",idx:y}),I=y=>_({kind:"movement",idx:y});function fe(y,U){t.$$.not_equal(U.point2,y)&&(U.point2=y,ee.set(o))}const De=y=>_({kind:"movement",idx:y}),He=y=>_({kind:"movement",idx:y});function Re(y){a=y,n(5,a)}return t.$$set=y=>{"junctionIdx"in y&&n(0,l=y.junctionIdx),"stage"in y&&n(1,i=y.stage)},t.$$.update=()=>{t.$$.dirty[0]&28&&n(8,r=g(o,m,f))},[l,i,m,f,o,a,s,j,r,c,_,p,O,$,h,C,T,Q,N,Y,k,P,be,ge,V,Be,G,R,de,d,M,X,x,I,fe,De,He,Re]}class go extends Ie{constructor(e){super(),Te(this,e,co,mo,Me,{junctionIdx:0,stage:1},null,[-1,-1])}}function Dt(t,e,n){const r=t.slice();return r[11]=e[n],r[13]=n,r}function _o(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,f,j;return s=new we({props:{$$slots:{default:[yo]},$$scope:{ctx:t}}}),s.$on("click",t[10]),f=new go({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){e=te("h2"),r=K(n),o=K(" - "),i=K(l),a=z(),S(s.$$.fragment),m=z(),S(f.$$.fragment)},l(c){e=ne(c,"H2",{});var g=ie(e);r=Z(g,n),o=Z(g," - "),i=Z(g,l),g.forEach(b),a=D(c),F(s.$$.fragment,c),m=D(c),F(f.$$.fragment,c)},m(c,g){E(c,e,g),ue(e,r),ue(e,o),ue(e,i),E(c,a,g),B(s,c,g),E(c,m,g),B(f,c,g),j=!0},p(c,g){(!j||g&3)&&n!==(n=(c[1].jat[c[0].idx].name||"Untitled junction")+"")&&ke(r,n),(!j||g&1)&&l!==(l=c[0].stage+"")&&ke(i,l);const _={};g&16384&&(_.$$scope={dirty:g,ctx:c}),s.$set(_);const u={};g&1&&(u.junctionIdx=c[0].idx),g&1&&(u.stage=c[0].stage),f.$set(u)},i(c){j||(w(s.$$.fragment,c),w(f.$$.fragment,c),j=!0)},o(c){L(s.$$.fragment,c),L(f.$$.fragment,c),j=!1},d(c){c&&(b(e),b(a),b(m)),q(s,c),q(f,c)}}}function po(t){let e,n,r,o,l,i,a,s,m,f,j;e=new we({props:{$$slots:{default:[bo]},$$scope:{ctx:t}}}),e.$on("click",t[5]),r=new Jt({props:{$$slots:{default:[vo]},$$scope:{ctx:t}}}),r.$on("click",t[6]);function c(_){t[7](_)}let g={label:"Name"};return t[1].jat[t[0].idx].name!==void 0&&(g.value=t[1].jat[t[0].idx].name),l=new mt({props:g}),oe.push(()=>se(l,"value",c)),s=new we({props:{$$slots:{default:[wo]},$$scope:{ctx:t}}}),s.$on("click",t[8]),f=new we({props:{$$slots:{default:[ko]},$$scope:{ctx:t}}}),f.$on("click",t[9]),{c(){S(e.$$.fragment),n=z(),S(r.$$.fragment),o=z(),S(l.$$.fragment),a=z(),S(s.$$.fragment),m=z(),S(f.$$.fragment)},l(_){F(e.$$.fragment,_),n=D(_),F(r.$$.fragment,_),o=D(_),F(l.$$.fragment,_),a=D(_),F(s.$$.fragment,_),m=D(_),F(f.$$.fragment,_)},m(_,u){B(e,_,u),E(_,n,u),B(r,_,u),E(_,o,u),B(l,_,u),E(_,a,u),B(s,_,u),E(_,m,u),B(f,_,u),j=!0},p(_,u){const p={};u&16384&&(p.$$scope={dirty:u,ctx:_}),e.$set(p);const O={};u&16384&&(O.$$scope={dirty:u,ctx:_}),r.$set(O);const A={};!i&&u&3&&(i=!0,A.value=_[1].jat[_[0].idx].name,ae(()=>i=!1)),l.$set(A);const H={};u&16384&&(H.$$scope={dirty:u,ctx:_}),s.$set(H);const $={};u&16384&&($.$$scope={dirty:u,ctx:_}),f.$set($)},i(_){j||(w(e.$$.fragment,_),w(r.$$.fragment,_),w(l.$$.fragment,_),w(s.$$.fragment,_),w(f.$$.fragment,_),j=!0)},o(_){L(e.$$.fragment,_),L(r.$$.fragment,_),L(l.$$.fragment,_),L(s.$$.fragment,_),L(f.$$.fragment,_),j=!1},d(_){_&&(b(n),b(o),b(a),b(m)),q(e,_),q(r,_),q(l,_),q(s,_),q(f,_)}}}function ho(t){let e,n,r,o;e=new we({props:{$$slots:{default:[jo]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=ye(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Ht(Dt(t,l,s));const a=s=>L(i[s],1,1,()=>{i[s]=null});return{c(){S(e.$$.fragment),n=z(),r=te("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){F(e.$$.fragment,s),n=D(s),r=ne(s,"OL",{});var m=ie(r);for(let f=0;f<i.length;f+=1)i[f].l(m);m.forEach(b)},m(s,m){B(e,s,m),E(s,n,m),E(s,r,m);for(let f=0;f<i.length;f+=1)i[f]&&i[f].m(r,null);o=!0},p(s,m){const f={};if(m&16384&&(f.$$scope={dirty:m,ctx:s}),e.$set(f),m&3){l=ye(s[1].jat);let j;for(j=0;j<l.length;j+=1){const c=Dt(s,l,j);i[j]?(i[j].p(c,m),w(i[j],1)):(i[j]=Ht(c),i[j].c(),w(i[j],1),i[j].m(r,null))}for(pe(),j=l.length;j<i.length;j+=1)a(j);he()}},i(s){if(!o){w(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(s){L(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)L(i[m]);o=!1},d(s){s&&(b(n),b(r)),q(e,s),ze(i,s)}}}function yo(t){let e;return{c(){e=K("Back")},l(n){e=Z(n,"Back")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function bo(t){let e;return{c(){e=K("Back to all junctions")},l(n){e=Z(n,"Back to all junctions")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function vo(t){let e;return{c(){e=K("Delete")},l(n){e=Z(n,"Delete")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function wo(t){let e;return{c(){e=K("Existing")},l(n){e=Z(n,"Existing")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function ko(t){let e;return{c(){e=K("Proposed")},l(n){e=Z(n,"Proposed")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function jo(t){let e;return{c(){e=K("Add new junction")},l(n){e=Z(n,"Add new junction")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Lo(t){let e=(t[11].name||"Untitled junction")+"",n;return{c(){n=K(e)},l(r){n=Z(r,e)},m(r,o){E(r,n,o)},p(r,o){o&2&&e!==(e=(r[11].name||"Untitled junction")+"")&&ke(n,e)},d(r){r&&b(n)}}}function Ht(t){let e,n,r,o;function l(){return t[4](t[13])}return n=new we({props:{$$slots:{default:[Lo]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=te("li"),S(n.$$.fragment),r=z()},l(i){e=ne(i,"LI",{});var a=ie(e);F(n.$$.fragment,a),r=D(a),a.forEach(b)},m(i,a){E(i,e,a),B(n,e,null),ue(e,r),o=!0},p(i,a){t=i;const s={};a&16386&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){L(n.$$.fragment,i),o=!1},d(i){i&&b(e),q(n)}}}function Eo(t){let e,n,r,o;const l=[ho,po,_o],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="junction"?1:s[0].kind=="map"?2:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=Ae()},l(s){n&&n.l(s),r=Ae()},m(s,m){~e&&i[e].m(s,m),E(s,r,m),o=!0},p(s,[m]){let f=e;e=a(s),e===f?~e&&i[e].p(s,m):(n&&(pe(),L(i[f],1,1,()=>{i[f]=null}),he()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){L(n),o=!1},d(s){s&&b(r),~e&&i[e].d(s)}}}function Je(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function Co(t,e,n){let r;Pe(t,ee,_=>n(1,r=_));let o={kind:"list"};function l(){Ve(ee,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"junction",idx:r.jat.length-1})}function i(_){window.confirm("Delete this junction?")&&(r.jat.splice(_,1),ee.set(r),n(0,o={kind:"list"}))}const a=_=>n(0,o={kind:"junction",idx:_}),s=()=>n(0,o={kind:"list"}),m=()=>i(Je(o));function f(_){t.$$.not_equal(r.jat[o.idx].name,_)&&(r.jat[o.idx].name=_,ee.set(r))}return[o,r,l,i,a,s,m,f,()=>n(0,o={kind:"map",idx:Je(o),stage:"existing"}),()=>n(0,o={kind:"map",idx:Je(o),stage:"proposed"}),()=>n(0,o={kind:"junction",idx:Je(o)})]}class Ho extends Ie{constructor(e){super(),Te(this,e,Co,Eo,Me,{})}}export{Ho as component};
