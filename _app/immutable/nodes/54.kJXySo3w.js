import{s as Ce,w as x,x as ee,l as xt,u as en,r as tn,v as nn,D as ke,k as Re,R as rn,T as qe,a as O,g as B,i as j,f as y,G as Ne,n as Pe,e as ie,t as X,c as ae,b as me,d as W,p as Ue,q as Q,h as ne,j as he,z as on,W as an,E as de,m as ut}from"../chunks/scheduler.Dk-JDrYY.js";import{S as Oe,i as Be,e as te,c as I,a as F,m as T,t as w,b as v,d as q,g as le,f as se}from"../chunks/index.CsRFimJs.js";import{e as pe}from"../chunks/each.CDGFUH-m.js";import{C as xe,B as ln}from"../chunks/ClickableCard.CTSMXU-9.js";import{D as St}from"../chunks/DefaultButton.CC-Pd1ev.js";import{S as Le}from"../chunks/SecondaryButton.8USQHego.js";/* empty css                                                               */import{T as et}from"../chunks/TextInput.D4Ne2cWG.js";import{W as It}from"../chunks/WarningButton.DIgJP2sp.js";import{s as V}from"../chunks/data.ALZ3V6Te.js";import{L as sn,g as un,e as Ft,M as fn,b as mn,C as cn,G as ft,l as Ve,n as mt,h as gn,P as Tt,f as pn}from"../chunks/index.BoaCPR9V.js";import{c as _e}from"../chunks/colors.DaC397qr.js";import{G as dn}from"../chunks/GeoreferenceLayer.Bgs6bEOy.js";import{a as _n,M as Ge,B as hn,G as $n,S as bn,C as wn}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.DsIIad6G.js";import{C as yn}from"../chunks/CollapsibleCard.CjD8ekrq.js";import{R as qt}from"../chunks/Radio.DdII1WVx.js";import{T as Nt}from"../chunks/TextArea.CWcMMY8c.js";/* empty css                                                    */import"../chunks/paths.B8kBPPtB.js";import{p as vn}from"../chunks/index.BSJeUgZ9.js";import{S as kn}from"../chunks/Select.sDYZiyFV.js";function jn(t){let e;const n=t[16].default,r=xt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,i){r&&r.m(o,i),e=!0},p(o,i){r&&r.p&&(!e||i&16777216)&&en(r,n,o,o[24],e?nn(n,o[24],i,null):tn(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){v(r,o),e=!1},d(o){r&&r.d(o)}}}function En(t){let e,n,r;function o(a){t[17](a)}let i={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[jn]},$$scope:{ctx:t}};return t[0]!==void 0&&(i.hovered=t[0]),e=new sn({props:i}),x.push(()=>te(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,s){T(e,a,s),r=!0},p(a,[s]){const l={};s&2&&(l.id=a[1]),s&4&&(l.source=a[2]),s&8&&(l.sourceLayer=a[3]),s&16&&(l.beforeId=a[4]),s&32&&(l.beforeLayerType=a[5]),s&64&&(l.paint=a[6]),s&128&&(l.layout=a[7]),s&256&&(l.filter=a[8]),s&512&&(l.applyToClusters=a[9]),s&1024&&(l.minzoom=a[10]),s&2048&&(l.maxzoom=a[11]),s&4096&&(l.hoverCursor=a[12]),s&8192&&(l.manageHoverState=a[13]),s&16384&&(l.eventsIfTopMost=a[14]),s&32768&&(l.interactive=a[15]),s&16777216&&(l.$$scope={dirty:s,ctx:a}),!n&&s&1&&(n=!0,l.hovered=a[0],ee(()=>n=!1)),e.$set(l)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){v(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function Cn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:i=un("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:l=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:d=void 0}=e,{layout:h=void 0}=e,{filter:f=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:k=void 0}=e,{maxzoom:N=void 0}=e,{hoverCursor:G=void 0}=e,{manageHoverState:S=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:_=!0}=e;function b(P){$=P,n(0,$)}function p(P){ke.call(this,t,P)}function L(P){ke.call(this,t,P)}function J(P){ke.call(this,t,P)}function A(P){ke.call(this,t,P)}function D(P){ke.call(this,t,P)}function ce(P){ke.call(this,t,P)}return t.$$set=P=>{"id"in P&&n(1,i=P.id),"source"in P&&n(2,a=P.source),"sourceLayer"in P&&n(3,s=P.sourceLayer),"beforeId"in P&&n(4,l=P.beforeId),"beforeLayerType"in P&&n(5,g=P.beforeLayerType),"paint"in P&&n(6,d=P.paint),"layout"in P&&n(7,h=P.layout),"filter"in P&&n(8,f=P.filter),"applyToClusters"in P&&n(9,C=P.applyToClusters),"minzoom"in P&&n(10,k=P.minzoom),"maxzoom"in P&&n(11,N=P.maxzoom),"hoverCursor"in P&&n(12,G=P.hoverCursor),"manageHoverState"in P&&n(13,S=P.manageHoverState),"hovered"in P&&n(0,$=P.hovered),"eventsIfTopMost"in P&&n(14,u=P.eventsIfTopMost),"interactive"in P&&n(15,_=P.interactive),"$$scope"in P&&n(24,o=P.$$scope)},[$,i,a,s,l,g,d,h,f,C,k,N,G,S,u,_,r,b,p,L,J,A,D,ce,o]}class Pn extends Oe{constructor(e){super(),Be(this,e,Cn,En,Ce,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ln=Object.defineProperty,R=(t,e)=>Ln(t,"name",{value:e,configurable:!0}),An=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ie(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ze(e),o=Ze(n);return r.every(i=>o.some(a=>this.compare(i,a)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ie(e,n))return!1;const i=e;let a=n;if(o&&!this.compareCoord(i[0],a[0])){const l=this.fixStartIndex(a,i);if(l)a=l;else return!1}const s=this.compareCoord(i[r],a[r]);return this.direction||s?this.comparePath(i,a):this.compareCoord(i[r],a[a.length-(1+r)])?this.comparePath(i.slice().reverse(),a):!1}fixStartIndex(e,n){let r,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],n[0])){o=i;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(i=>o.some(a=>this.compareLine(i,a,1,!0)))}return!1}compareGeometryCollection(e,n){return Ie(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ie(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};R(An,"GeojsonEquality");function Ie(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}R(Ie,"sameLength");function Ze(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}R(Ze,"explode");var re=63710088e-1,Ot={centimeters:re*100,centimetres:re*100,degrees:360/(2*Math.PI),feet:re*3.28084,inches:re*39.37,kilometers:re/1e3,kilometres:re/1e3,meters:re,metres:re,miles:re/1609.344,millimeters:re*1e3,millimetres:re*1e3,nauticalmiles:re/1852,radians:1,yards:re*1.0936},ct={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $e(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}R($e,"feature");function Mn(t,e,n={}){switch(t){case"Point":return Je(e).geometry;case"LineString":return nt(e).geometry;case"Polygon":return tt(e).geometry;case"MultiPoint":return Gt(e).geometry;case"MultiLineString":return Bt(e).geometry;case"MultiPolygon":return zt(e).geometry;default:throw new Error(t+" is invalid")}}R(Mn,"geometry");function Je(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!je(t[0])||!je(t[1]))throw new Error("coordinates must contain numbers");return $e({type:"Point",coordinates:t},e,n)}R(Je,"point");function Sn(t,e,n={}){return He(t.map(r=>Je(r,e)),n)}R(Sn,"points");function tt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return $e({type:"Polygon",coordinates:t},e,n)}R(tt,"polygon");function In(t,e,n={}){return He(t.map(r=>tt(r,e)),n)}R(In,"polygons");function nt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return $e({type:"LineString",coordinates:t},e,n)}R(nt,"lineString");function Fn(t,e,n={}){return He(t.map(r=>nt(r,e)),n)}R(Fn,"lineStrings");function He(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}R(He,"featureCollection");function Bt(t,e,n={}){return $e({type:"MultiLineString",coordinates:t},e,n)}R(Bt,"multiLineString");function Gt(t,e,n={}){return $e({type:"MultiPoint",coordinates:t},e,n)}R(Gt,"multiPoint");function zt(t,e,n={}){return $e({type:"MultiPolygon",coordinates:t},e,n)}R(zt,"multiPolygon");function Tn(t,e,n={}){return $e({type:"GeometryCollection",geometries:t},e,n)}R(Tn,"geometryCollection");function qn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}R(qn,"round");function Dt(t,e="kilometers"){const n=Ot[e];if(!n)throw new Error(e+" units is invalid");return t*n}R(Dt,"radiansToLength");function Ke(t,e="kilometers"){const n=Ot[e];if(!n)throw new Error(e+" units is invalid");return t/n}R(Ke,"lengthToRadians");function Nn(t,e){return De(Ke(t,e))}R(Nn,"lengthToDegrees");function On(t){let e=t%360;return e<0&&(e+=360),e}R(On,"bearingToAzimuth");function De(t){return t%(2*Math.PI)*180/Math.PI}R(De,"radiansToDegrees");function ze(t){return t%360*Math.PI/180}R(ze,"degreesToRadians");function Bn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Dt(Ke(t,e),n)}R(Bn,"convertLength");function Gn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=ct[e];if(!r)throw new Error("invalid original units");const o=ct[n];if(!o)throw new Error("invalid final units");return t/r*o}R(Gn,"convertArea");function je(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}R(je,"isNumber");function zn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}R(zn,"isObject");function Dn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!je(e))throw new Error("bbox must only contain numbers")})}R(Dn,"validateBBox");function Rn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}R(Rn,"validateId");var Un=Object.defineProperty,be=(t,e)=>Un(t,"name",{value:e,configurable:!0});function Rt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}be(Rt,"getCoord");function Jn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}be(Jn,"getCoords");function Ut(t){if(t.length>1&&je(t[0])&&je(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ut(t[0]);throw new Error("coordinates must only contain numbers")}be(Ut,"containsNumber");function Hn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}be(Hn,"geojsonType");function Kn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}be(Kn,"featureOf");function Xn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}be(Xn,"collectionOf");function Wn(t){return t.type==="Feature"?t.geometry:t}be(Wn,"getGeom");function Vn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}be(Vn,"getType");var Zn=Object.defineProperty,Qn=(t,e)=>Zn(t,"name",{value:e,configurable:!0});function Jt(t,e,n,r={}){const o=Rt(t),i=ze(o[0]),a=ze(o[1]),s=ze(n),l=Ke(e,r.units),g=Math.asin(Math.sin(a)*Math.cos(l)+Math.cos(a)*Math.sin(l)*Math.cos(s)),d=i+Math.atan2(Math.sin(s)*Math.sin(l)*Math.cos(a),Math.cos(l)-Math.sin(a)*Math.sin(g)),h=De(d),f=De(g);return Je([h,f],r.properties)}Qn(Jt,"destination");var gt=Jt,Yn=Object.defineProperty,U=(t,e)=>Yn(t,"name",{value:e,configurable:!0}),xn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Fe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Qe(e),o=Qe(n);return r.every(i=>o.some(a=>this.compare(i,a)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Fe(e,n))return!1;const i=e;let a=n;if(o&&!this.compareCoord(i[0],a[0])){const l=this.fixStartIndex(a,i);if(l)a=l;else return!1}const s=this.compareCoord(i[r],a[r]);return this.direction||s?this.comparePath(i,a):this.compareCoord(i[r],a[a.length-(1+r)])?this.comparePath(i.slice().reverse(),a):!1}fixStartIndex(e,n){let r,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],n[0])){o=i;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(i=>o.some(a=>this.compareLine(i,a,1,!0)))}return!1}compareGeometryCollection(e,n){return Fe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Fe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};U(xn,"GeojsonEquality");function Fe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}U(Fe,"sameLength");function Qe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}U(Qe,"explode");var oe=63710088e-1,Ht={centimeters:oe*100,centimetres:oe*100,degrees:360/(2*Math.PI),feet:oe*3.28084,inches:oe*39.37,kilometers:oe/1e3,kilometres:oe/1e3,meters:oe,metres:oe,miles:oe/1609.344,millimeters:oe*1e3,millimetres:oe*1e3,nauticalmiles:oe/1852,radians:1,yards:oe*1.0936},pt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function we(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}U(we,"feature");function er(t,e,n={}){switch(t){case"Point":return rt(e).geometry;case"LineString":return it(e).geometry;case"Polygon":return ot(e).geometry;case"MultiPoint":return Xt(e).geometry;case"MultiLineString":return Kt(e).geometry;case"MultiPolygon":return Wt(e).geometry;default:throw new Error(t+" is invalid")}}U(er,"geometry");function rt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ee(t[0])||!Ee(t[1]))throw new Error("coordinates must contain numbers");return we({type:"Point",coordinates:t},e,n)}U(rt,"point");function tr(t,e,n={}){return Xe(t.map(r=>rt(r,e)),n)}U(tr,"points");function ot(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return we({type:"Polygon",coordinates:t},e,n)}U(ot,"polygon");function nr(t,e,n={}){return Xe(t.map(r=>ot(r,e)),n)}U(nr,"polygons");function it(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return we({type:"LineString",coordinates:t},e,n)}U(it,"lineString");function rr(t,e,n={}){return Xe(t.map(r=>it(r,e)),n)}U(rr,"lineStrings");function Xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}U(Xe,"featureCollection");function Kt(t,e,n={}){return we({type:"MultiLineString",coordinates:t},e,n)}U(Kt,"multiLineString");function Xt(t,e,n={}){return we({type:"MultiPoint",coordinates:t},e,n)}U(Xt,"multiPoint");function Wt(t,e,n={}){return we({type:"MultiPolygon",coordinates:t},e,n)}U(Wt,"multiPolygon");function or(t,e,n={}){return we({type:"GeometryCollection",geometries:t},e,n)}U(or,"geometryCollection");function ir(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}U(ir,"round");function Vt(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t*n}U(Vt,"radiansToLength");function at(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t/n}U(at,"lengthToRadians");function ar(t,e){return lt(at(t,e))}U(ar,"lengthToDegrees");function lr(t){let e=t%360;return e<0&&(e+=360),e}U(lr,"bearingToAzimuth");function lt(t){return t%(2*Math.PI)*180/Math.PI}U(lt,"radiansToDegrees");function Te(t){return t%360*Math.PI/180}U(Te,"degreesToRadians");function sr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Vt(at(t,e),n)}U(sr,"convertLength");function ur(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=pt[e];if(!r)throw new Error("invalid original units");const o=pt[n];if(!o)throw new Error("invalid final units");return t/r*o}U(ur,"convertArea");function Ee(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}U(Ee,"isNumber");function fr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}U(fr,"isObject");function mr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ee(e))throw new Error("bbox must only contain numbers")})}U(mr,"validateBBox");function cr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}U(cr,"validateId");var gr=Object.defineProperty,ye=(t,e)=>gr(t,"name",{value:e,configurable:!0});function Ye(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ye(Ye,"getCoord");function pr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ye(pr,"getCoords");function Zt(t){if(t.length>1&&Ee(t[0])&&Ee(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Zt(t[0]);throw new Error("coordinates must only contain numbers")}ye(Zt,"containsNumber");function dr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ye(dr,"geojsonType");function _r(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ye(_r,"featureOf");function hr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ye(hr,"collectionOf");function $r(t){return t.type==="Feature"?t.geometry:t}ye($r,"getGeom");function br(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ye(br,"getType");var wr=Object.defineProperty,Qt=(t,e)=>wr(t,"name",{value:e,configurable:!0});function st(t,e,n={}){if(n.final===!0)return Yt(t,e);const r=Ye(t),o=Ye(e),i=Te(r[0]),a=Te(o[0]),s=Te(r[1]),l=Te(o[1]),g=Math.sin(a-i)*Math.cos(l),d=Math.cos(s)*Math.sin(l)-Math.sin(s)*Math.cos(l)*Math.cos(a-i);return lt(Math.atan2(g,d))}Qt(st,"bearing");function Yt(t,e){let n=st(e,t);return n=(n+180)%360,n}Qt(Yt,"calculateFinalBearing");var yr=st;function dt(t,e,n){const r=t.slice();return r[35]=e[n],r[36]=e,r[37]=n,r}function _t(t,e,n){const r=t.slice();return r[38]=e[n],r[39]=e,r[37]=n,r}function vr(t){let e,n=Tr(t[37])+"",r;return{c(){e=ie("span"),r=X(n),this.h()},l(o){e=ae(o,"SPAN",{class:!0});var i=me(e);r=W(i,n),i.forEach(y),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"color","#4472c4"),Q(e,"background-color","white")},m(o,i){j(o,e,i),ne(e,r)},p:Pe,d(o){o&&y(e)}}}function ht(t){let e,n,r;function o(l){t[18](l,t[38])}function i(){return t[19](t[37])}function a(){return t[20](t[37])}let s={draggable:!0,$$slots:{default:[vr]},$$scope:{ctx:t}};return t[38].point!==void 0&&(s.lngLat=t[38].point),e=new Ge({props:s}),x.push(()=>te(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",a),{c(){I(e.$$.fragment)},l(l){F(e.$$.fragment,l)},m(l,g){T(e,l,g),r=!0},p(l,g){t=l;const d={};g[1]&512&&(d.$$scope={dirty:g,ctx:t}),!n&&g[0]&19&&(n=!0,d.lngLat=t[38].point,ee(()=>n=!1)),e.$set(d)},i(l){r||(w(e.$$.fragment,l),r=!0)},o(l){v(e.$$.fragment,l),r=!1},d(l){q(e,l)}}}function kr(t){let e;return{c(){e=ie("span"),this.h()},l(n){e=ae(n,"SPAN",{class:!0}),me(e).forEach(y),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[7][t[35].score]),Q(e,"opacity",t[35].kind=="walking & wheeling"?"0%":"100%")},m(n,r){j(n,e,r)},p(n,r){r[0]&19&&Q(e,"background-color",n[7][n[35].score]),r[0]&19&&Q(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&y(e)}}}function jr(t){let e;return{c(){e=ie("span"),this.h()},l(n){e=ae(n,"SPAN",{class:!0}),me(e).forEach(y),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[7][t[35].score])},m(n,r){j(n,e,r)},p(n,r){r[0]&19&&Q(e,"background-color",n[7][n[35].score])},d(n){n&&y(e)}}}function Er(t){let e;return{c(){e=ie("span"),this.h()},l(n){e=ae(n,"SPAN",{class:!0}),me(e).forEach(y),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[7][t[35].score]),Q(e,"opacity","0%")},m(n,r){j(n,e,r)},p(n,r){r[0]&19&&Q(e,"background-color",n[7][n[35].score])},d(n){n&&y(e)}}}function $t(t){let e,n,r,o,i,a,s,l,g;function d(p){t[21](p,t[35])}function h(){return t[22](t[37])}function f(){return t[23](t[37])}let C={draggable:!0,$$slots:{default:[kr]},$$scope:{ctx:t}};t[35].point1!==void 0&&(C.lngLat=t[35].point1),e=new Ge({props:C}),x.push(()=>te(e,"lngLat",d)),e.$on("dragend",h),e.$on("click",f);function k(p){t[24](p,t[35])}function N(){return t[25](t[37])}function G(){return t[26](t[37])}let S={draggable:!0,$$slots:{default:[jr]},$$scope:{ctx:t}};t[35].point2!==void 0&&(S.lngLat=t[35].point2),o=new Ge({props:S}),x.push(()=>te(o,"lngLat",k)),o.$on("dragend",N),o.$on("click",G);function $(p){t[27](p,t[35])}function u(){return t[28](t[37])}function _(){return t[29](t[37])}let b={draggable:!0,$$slots:{default:[Er]},$$scope:{ctx:t}};return t[35].point3!==void 0&&(b.lngLat=t[35].point3),s=new Ge({props:b}),x.push(()=>te(s,"lngLat",$)),s.$on("dragend",u),s.$on("click",_),{c(){I(e.$$.fragment),r=O(),I(o.$$.fragment),a=O(),I(s.$$.fragment)},l(p){F(e.$$.fragment,p),r=B(p),F(o.$$.fragment,p),a=B(p),F(s.$$.fragment,p)},m(p,L){T(e,p,L),j(p,r,L),T(o,p,L),j(p,a,L),T(s,p,L),g=!0},p(p,L){t=p;const J={};L[0]&19|L[1]&512&&(J.$$scope={dirty:L,ctx:t}),!n&&L[0]&19&&(n=!0,J.lngLat=t[35].point1,ee(()=>n=!1)),e.$set(J);const A={};L[0]&19|L[1]&512&&(A.$$scope={dirty:L,ctx:t}),!i&&L[0]&19&&(i=!0,A.lngLat=t[35].point2,ee(()=>i=!1)),o.$set(A);const D={};L[0]&19|L[1]&512&&(D.$$scope={dirty:L,ctx:t}),!l&&L[0]&19&&(l=!0,D.lngLat=t[35].point3,ee(()=>l=!1)),s.$set(D)},i(p){g||(w(e.$$.fragment,p),w(o.$$.fragment,p),w(s.$$.fragment,p),g=!0)},o(p){v(e.$$.fragment,p),v(o.$$.fragment,p),v(s.$$.fragment,p),g=!1},d(p){p&&(y(r),y(a)),q(e,p),q(o,p),q(s,p)}}}function Cr(t){let e=(t[34].name||"Untitled movement")+"",n;return{c(){n=X(e)},l(r){n=W(r,e)},m(r,o){j(r,n,o)},p(r,o){o[1]&8&&e!==(e=(r[34].name||"Untitled movement")+"")&&he(n,e)},d(r){r&&y(n)}}}function Pr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Cr,({props:r})=>({34:r}),({props:r})=>[0,r?8:0]]},$$scope:{ctx:t}}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&520&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Lr(t){let e=(t[34].name||"Untitled movement")+"",n;return{c(){n=X(e)},l(r){n=W(r,e)},m(r,o){j(r,n,o)},p(r,o){o[1]&8&&e!==(e=(r[34].name||"Untitled movement")+"")&&he(n,e)},d(r){r&&y(n)}}}function Ar(t){let e,n;return e=new Tt({props:{$$slots:{default:[Lr,({props:r})=>({34:r}),({props:r})=>[0,r?8:0]]},$$scope:{ctx:t}}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&520&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Mr(t){let e,n,r,o,i,a;return e=new Ve({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":mt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Pr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new Ve({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":mt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Ar]},$$scope:{ctx:t}}}),r.$on("click",t[9]),i=new Pn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){I(e.$$.fragment),n=O(),I(r.$$.fragment),o=O(),I(i.$$.fragment)},l(s){F(e.$$.fragment,s),n=B(s),F(r.$$.fragment,s),o=B(s),F(i.$$.fragment,s)},m(s,l){T(e,s,l),j(s,n,l),T(r,s,l),j(s,o,l),T(i,s,l),a=!0},p(s,l){const g={};l[1]&512&&(g.$$scope={dirty:l,ctx:s}),e.$set(g);const d={};l[1]&512&&(d.$$scope={dirty:l,ctx:s}),r.$set(d)},i(s){a||(w(e.$$.fragment,s),w(r.$$.fragment,s),w(i.$$.fragment,s),a=!0)},o(s){v(e.$$.fragment,s),v(r.$$.fragment,s),v(i.$$.fragment,s),a=!1},d(s){s&&(y(n),y(o)),q(e,s),q(r,s),q(i,s)}}}function Sr(t){let e,n,r,o;return e=new Ve({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new gn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){I(e.$$.fragment),n=O(),I(r.$$.fragment)},l(i){F(e.$$.fragment,i),n=B(i),F(r.$$.fragment,i)},m(i,a){T(e,i,a),j(i,n,a),T(r,i,a),o=!0},p:Pe,i(i){o||(w(e.$$.fragment,i),w(r.$$.fragment,i),o=!0)},o(i){v(e.$$.fragment,i),v(r.$$.fragment,i),o=!1},d(i){i&&y(n),q(e,i),q(r,i)}}}function Ir(t){let e,n,r,o,i,a,s,l,g,d,h,f;e=new _n({}),e.$on("click",t[8]),r=new cn({props:{gj:t[4].summary.networkMap,show:t[2]}});let C=pe(t[4].jat[t[0]][t[1]].arms),k=[];for(let u=0;u<C.length;u+=1)k[u]=ht(_t(t,C,u));const N=u=>v(k[u],1,1,()=>{k[u]=null});let G=pe(t[4].jat[t[0]][t[1]].movements),S=[];for(let u=0;u<G.length;u+=1)S[u]=$t(dt(t,G,u));const $=u=>v(S[u],1,1,()=>{S[u]=null});return s=new ft({props:{data:t[10](t[4]),$$slots:{default:[Mr]},$$scope:{ctx:t}}}),g=new ft({props:{data:t[6],$$slots:{default:[Sr]},$$scope:{ctx:t}}}),h=new dn({props:{map:t[5]}}),{c(){I(e.$$.fragment),n=O(),I(r.$$.fragment),o=O();for(let u=0;u<k.length;u+=1)k[u].c();i=O();for(let u=0;u<S.length;u+=1)S[u].c();a=O(),I(s.$$.fragment),l=O(),I(g.$$.fragment),d=O(),I(h.$$.fragment)},l(u){F(e.$$.fragment,u),n=B(u),F(r.$$.fragment,u),o=B(u);for(let _=0;_<k.length;_+=1)k[_].l(u);i=B(u);for(let _=0;_<S.length;_+=1)S[_].l(u);a=B(u),F(s.$$.fragment,u),l=B(u),F(g.$$.fragment,u),d=B(u),F(h.$$.fragment,u)},m(u,_){T(e,u,_),j(u,n,_),T(r,u,_),j(u,o,_);for(let b=0;b<k.length;b+=1)k[b]&&k[b].m(u,_);j(u,i,_);for(let b=0;b<S.length;b+=1)S[b]&&S[b].m(u,_);j(u,a,_),T(s,u,_),j(u,l,_),T(g,u,_),j(u,d,_),T(h,u,_),f=!0},p(u,_){const b={};if(_[0]&16&&(b.gj=u[4].summary.networkMap),_[0]&4&&(b.show=u[2]),r.$set(b),_[0]&27){C=pe(u[4].jat[u[0]][u[1]].arms);let A;for(A=0;A<C.length;A+=1){const D=_t(u,C,A);k[A]?(k[A].p(D,_),w(k[A],1)):(k[A]=ht(D),k[A].c(),w(k[A],1),k[A].m(i.parentNode,i))}for(le(),A=C.length;A<k.length;A+=1)N(A);se()}if(_[0]&155){G=pe(u[4].jat[u[0]][u[1]].movements);let A;for(A=0;A<G.length;A+=1){const D=dt(u,G,A);S[A]?(S[A].p(D,_),w(S[A],1)):(S[A]=$t(D),S[A].c(),w(S[A],1),S[A].m(a.parentNode,a))}for(le(),A=G.length;A<S.length;A+=1)$(A);se()}const p={};_[0]&16&&(p.data=u[10](u[4])),_[1]&512&&(p.$$scope={dirty:_,ctx:u}),s.$set(p);const L={};_[0]&64&&(L.data=u[6]),_[1]&512&&(L.$$scope={dirty:_,ctx:u}),g.$set(L);const J={};_[0]&32&&(J.map=u[5]),h.$set(J)},i(u){if(!f){w(e.$$.fragment,u),w(r.$$.fragment,u);for(let _=0;_<C.length;_+=1)w(k[_]);for(let _=0;_<G.length;_+=1)w(S[_]);w(s.$$.fragment,u),w(g.$$.fragment,u),w(h.$$.fragment,u),f=!0}},o(u){v(e.$$.fragment,u),v(r.$$.fragment,u),k=k.filter(Boolean);for(let _=0;_<k.length;_+=1)v(k[_]);S=S.filter(Boolean);for(let _=0;_<S.length;_+=1)v(S[_]);v(s.$$.fragment,u),v(g.$$.fragment,u),v(h.$$.fragment,u),f=!1},d(u){u&&(y(n),y(o),y(i),y(a),y(l),y(d)),q(e,u),q(r,u),Ne(k,u),Ne(S,u),q(s,u),q(g,u),q(h,u)}}}function Fr(t){let e,n,r;function o(a){t[30](a)}let i={$$slots:{default:[Ir]},$$scope:{ctx:t}};return t[5]!==void 0&&(i.map=t[5]),e=new fn({props:i}),x.push(()=>te(e,"map",o)),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,s){T(e,a,s),r=!0},p(a,s){const l={};s[0]&127|s[1]&512&&(l.$$scope={dirty:s,ctx:a}),!n&&s[0]&32&&(n=!0,l.map=a[5],ee(()=>n=!1)),e.$set(l)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){v(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function bt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Tr(t){return String.fromCharCode(t+65)}function qr(t,e,n){let r,o;Re(t,V,m=>n(4,o=m));let{junctionIdx:i}=e,{stage:a}=e,{newKind:s}=e,{editing:l}=e,{hoveringSidebar:g}=e,{streetviewOn:d}=e,{showContext:h}=e,{select:f}=e,{stopEditing:C}=e,k,N={0:_e.red.background,1:_e.amber.background,2:_e.green.background,X:_e.critical.background};function G(m,M,c){let E={type:"FeatureCollection",features:[]},Y=M??c;return Y!=null&&(Y.kind=="arm"?E.features.push(bt(m.jat[i][a].arms[Y.idx],Y.idx)):E.features.push(_(m.jat[i][a].movements[Y.idx],Y.idx))),E}async function S(m){if(!d){for(let M of k.queryRenderedFeatures(m.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(l!=null){await C();return}s=="arm"?(qe(V,o.jat[i][a].arms=[...o.jat[i][a].arms,{point:m.detail.lngLat.toArray(),name:""}],o),await f({kind:"arm",idx:o.jat[i][a].arms.length-1})):(qe(V,o.jat[i][a].movements=[...o.jat[i][a].movements,{point1:m.detail.lngLat.toArray(),point2:gt(m.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:gt(m.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await f({kind:"movement",idx:o.jat[i][a].movements.length-1}))}}async function $(m){await f({kind:"movement",idx:m.detail.features[0].id})}rn(()=>{p(!1)});function u(m){let M={type:"FeatureCollection",features:m.jat[i][a].movements.map((c,E)=>_(c,E))};for(let c of m.jat[i][a].movements)if(M.features.push(b(c,M.features.length)),c.kind=="walking & wheeling"){let E={...c,point1:c.point3,point3:c.point1};M.features.push(b(E,M.features.length))}return M}function _(m,M){return{type:"Feature",id:M,properties:{name:m.name,kind:m.kind,color:N[m.score]},geometry:{type:"LineString",coordinates:[m.point1,m.point2,m.point3]}}}function b(m,M){return{type:"Feature",id:M,properties:{kind:m.kind,color:N[m.score],angle:yr(m.point2,m.point3)},geometry:{type:"Point",coordinates:m.point3}}}function p(m){let M=u(o);for(let c of o.jat[i][a].arms)M.features.push(bt(c,M.features.length));for(let c of o.summary.networkMap.features)M.features.push(c);M.features.length>0&&k.fitBounds(mn(M),{padding:20,animate:m})}function L(){return k}function J(m,M){t.$$.not_equal(M.point,m)&&(M.point=m,V.set(o))}const A=m=>f({kind:"arm",idx:m}),D=m=>f({kind:"arm",idx:m});function ce(m,M){t.$$.not_equal(M.point1,m)&&(M.point1=m,V.set(o))}const P=m=>f({kind:"movement",idx:m}),Ae=m=>f({kind:"movement",idx:m});function ve(m,M){t.$$.not_equal(M.point2,m)&&(M.point2=m,V.set(o))}const ue=m=>f({kind:"movement",idx:m}),H=m=>f({kind:"movement",idx:m});function Me(m,M){t.$$.not_equal(M.point3,m)&&(M.point3=m,V.set(o))}const Z=m=>f({kind:"movement",idx:m}),fe=m=>f({kind:"movement",idx:m});function K(m){k=m,n(5,k)}return t.$$set=m=>{"junctionIdx"in m&&n(0,i=m.junctionIdx),"stage"in m&&n(1,a=m.stage),"newKind"in m&&n(11,s=m.newKind),"editing"in m&&n(12,l=m.editing),"hoveringSidebar"in m&&n(13,g=m.hoveringSidebar),"streetviewOn"in m&&n(14,d=m.streetviewOn),"showContext"in m&&n(2,h=m.showContext),"select"in m&&n(3,f=m.select),"stopEditing"in m&&n(15,C=m.stopEditing)},t.$$.update=()=>{t.$$.dirty[0]&12304&&n(6,r=G(o,l,g))},[i,a,h,f,o,k,r,N,S,$,u,s,l,g,d,C,p,L,J,A,D,ce,P,Ae,ve,ue,H,Me,Z,fe,K]}class Nr extends Oe{constructor(e){super(),Be(this,e,qr,Fr,Ce,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function Or(t){let e,n,r,o,i,a,s,l,g,d,h,f;function C(b){t[5](b)}let k={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(k.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new et({props:k}),x.push(()=>te(e,"value",C));function N(b){t[6](b)}let G={legend:"Movement",choices:vn(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(G.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new qt({props:G}),x.push(()=>te(o,"value",N));function S(b){t[7](b)}let $={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&($.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),s=new kn({props:$}),x.push(()=>te(s,"value",S));function u(b){t[8](b)}let _={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),d=new Nt({props:_}),x.push(()=>te(d,"value",u)),{c(){I(e.$$.fragment),r=O(),I(o.$$.fragment),a=O(),I(s.$$.fragment),g=O(),I(d.$$.fragment)},l(b){F(e.$$.fragment,b),r=B(b),F(o.$$.fragment,b),a=B(b),F(s.$$.fragment,b),g=B(b),F(d.$$.fragment,b)},m(b,p){T(e,b,p),j(b,r,p),T(o,b,p),j(b,a,p),T(s,b,p),j(b,g,p),T(d,b,p),f=!0},p(b,[p]){const L={};!n&&p&15&&(n=!0,L.value=b[3].jat[b[0]][b[1]].movements[b[2]].name,ee(()=>n=!1)),e.$set(L);const J={};!i&&p&15&&(i=!0,J.value=b[3].jat[b[0]][b[1]].movements[b[2]].kind,ee(()=>i=!1)),o.$set(J);const A={};!l&&p&15&&(l=!0,A.value=b[3].jat[b[0]][b[1]].movements[b[2]].score,ee(()=>l=!1)),s.$set(A);const D={};!h&&p&15&&(h=!0,D.value=b[3].jat[b[0]][b[1]].movements[b[2]].notes,ee(()=>h=!1)),d.$set(D)},i(b){f||(w(e.$$.fragment,b),w(o.$$.fragment,b),w(s.$$.fragment,b),w(d.$$.fragment,b),f=!0)},o(b){v(e.$$.fragment,b),v(o.$$.fragment,b),v(s.$$.fragment,b),v(d.$$.fragment,b),f=!1},d(b){b&&(y(r),y(a),y(g)),q(e,b),q(o,b),q(s,b),q(d,b)}}}function Br(t,e,n){let r;Re(t,V,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:i}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function l(f){t.$$.not_equal(r.jat[o][i].movements[a].name,f)&&(r.jat[o][i].movements[a].name=f,V.set(r))}function g(f){t.$$.not_equal(r.jat[o][i].movements[a].kind,f)&&(r.jat[o][i].movements[a].kind=f,V.set(r))}function d(f){t.$$.not_equal(r.jat[o][i].movements[a].score,f)&&(r.jat[o][i].movements[a].score=f,V.set(r))}function h(f){t.$$.not_equal(r.jat[o][i].movements[a].notes,f)&&(r.jat[o][i].movements[a].notes=f,V.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,i=f.stage),"idx"in f&&n(2,a=f.idx)},[o,i,a,r,s,l,g,d,h]}class Gr extends Oe{constructor(e){super(),Be(this,e,Br,Or,Ce,{junctionIdx:0,stage:1,idx:2})}}const{window:zr}=pn;function wt(t,e,n){const r=t.slice();r[34]=e[n],r[37]=n;const o=r[17][r[34].score];return r[35]=o,r}function yt(t,e,n){const r=t.slice();return r[38]=e[n],r[37]=n,r}function Dr(t){let e,n,r,o,i,a,s,l;e=new St({props:{$$slots:{default:[Ur]},$$scope:{ctx:t}}}),e.$on("click",t[12]),r=new It({props:{$$slots:{default:[Jr]},$$scope:{ctx:t}}}),r.$on("click",t[13]);const g=[Kr,Hr],d=[];function h(f,C){return f[3].kind=="movement"?0:1}return i=h(t),a=d[i]=g[i](t),{c(){I(e.$$.fragment),n=O(),I(r.$$.fragment),o=O(),a.c(),s=de()},l(f){F(e.$$.fragment,f),n=B(f),F(r.$$.fragment,f),o=B(f),a.l(f),s=de()},m(f,C){T(e,f,C),j(f,n,C),T(r,f,C),j(f,o,C),d[i].m(f,C),j(f,s,C),l=!0},p(f,C){const k={};C[1]&512&&(k.$$scope={dirty:C,ctx:f}),e.$set(k);const N={};C[1]&512&&(N.$$scope={dirty:C,ctx:f}),r.$set(N);let G=i;i=h(f),i===G?d[i].p(f,C):(le(),v(d[G],1,1,()=>{d[G]=null}),se(),a=d[i],a?a.p(f,C):(a=d[i]=g[i](f),a.c()),w(a,1),a.m(s.parentNode,s))},i(f){l||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(a),l=!0)},o(f){v(e.$$.fragment,f),v(r.$$.fragment,f),v(a),l=!1},d(f){f&&(y(n),y(o),y(s)),q(e,f),q(r,f),d[i].d(f)}}}function Rr(t){let e,n,r,o,i,a,s,l=(t[9].jat[t[0]].name||"Untitled junction")+"",g,d,h,f,C,k,N,G="Arms",S,$,u,_,b="Movements",p,L,J,A;e=new yn({props:{label:"Tools",$$slots:{default:[Vr]},$$scope:{ctx:t}}});function D(c,E){return c[9].jat[c[0]][c[1]].movements.length>0?Qr:Zr}let ce=D(t),P=ce(t);function Ae(c){t[22](c)}let ve={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(ve.value=t[2]),f=new qt({props:ve}),x.push(()=>te(f,"value",Ae));let ue=pe(t[9].jat[t[0]][t[1]].arms),H=[];for(let c=0;c<ue.length;c+=1)H[c]=vt(yt(t,ue,c));const Me=c=>v(H[c],1,1,()=>{H[c]=null});let Z=t[9].jat[t[0]][t[10]].arms.length>0&&kt(t),fe=pe(t[9].jat[t[0]][t[1]].movements),K=[];for(let c=0;c<fe.length;c+=1)K[c]=jt(wt(t,fe,c));const m=c=>v(K[c],1,1,()=>{K[c]=null});let M=t[9].jat[t[0]][t[10]].movements.length>0&&Et(t);return{c(){I(e.$$.fragment),n=O(),r=ie("p"),o=X("Total JAT score for "),i=X(t[1]),a=O(),s=ie("u"),g=X(l),d=X(`
        :
        `),P.c(),h=O(),I(f.$$.fragment),k=O(),N=ie("h3"),N.textContent=G,S=O();for(let c=0;c<H.length;c+=1)H[c].c();$=O(),Z&&Z.c(),u=O(),_=ie("h3"),_.textContent=b,p=O();for(let c=0;c<K.length;c+=1)K[c].c();L=O(),M&&M.c(),J=de()},l(c){F(e.$$.fragment,c),n=B(c),r=ae(c,"P",{});var E=me(r);o=W(E,"Total JAT score for "),i=W(E,t[1]),a=B(E),s=ae(E,"U",{});var Y=me(s);g=W(Y,l),Y.forEach(y),d=W(E,`
        :
        `),P.l(E),E.forEach(y),h=B(c),F(f.$$.fragment,c),k=B(c),N=ae(c,"H3",{"data-svelte-h":!0}),ut(N)!=="svelte-ld74qb"&&(N.textContent=G),S=B(c);for(let ge=0;ge<H.length;ge+=1)H[ge].l(c);$=B(c),Z&&Z.l(c),u=B(c),_=ae(c,"H3",{"data-svelte-h":!0}),ut(_)!=="svelte-1dc52s8"&&(_.textContent=b),p=B(c);for(let ge=0;ge<K.length;ge+=1)K[ge].l(c);L=B(c),M&&M.l(c),J=de()},m(c,E){T(e,c,E),j(c,n,E),j(c,r,E),ne(r,o),ne(r,i),ne(r,a),ne(r,s),ne(s,g),ne(r,d),P.m(r,null),j(c,h,E),T(f,c,E),j(c,k,E),j(c,N,E),j(c,S,E);for(let Y=0;Y<H.length;Y+=1)H[Y]&&H[Y].m(c,E);j(c,$,E),Z&&Z.m(c,E),j(c,u,E),j(c,_,E),j(c,p,E);for(let Y=0;Y<K.length;Y+=1)K[Y]&&K[Y].m(c,E);j(c,L,E),M&&M.m(c,E),j(c,J,E),A=!0},p(c,E){const Y={};E[0]&224|E[1]&512&&(Y.$$scope={dirty:E,ctx:c}),e.$set(Y),(!A||E[0]&2)&&he(i,c[1]),(!A||E[0]&513)&&l!==(l=(c[9].jat[c[0]].name||"Untitled junction")+"")&&he(g,l),ce===(ce=D(c))&&P?P.p(c,E):(P.d(1),P=ce(c),P&&(P.c(),P.m(r,null)));const ge={};if(!C&&E[0]&4&&(C=!0,ge.value=c[2],ee(()=>C=!1)),f.$set(ge),E[0]&2579){ue=pe(c[9].jat[c[0]][c[1]].arms);let z;for(z=0;z<ue.length;z+=1){const Se=yt(c,ue,z);H[z]?(H[z].p(Se,E),w(H[z],1)):(H[z]=vt(Se),H[z].c(),w(H[z],1),H[z].m($.parentNode,$))}for(le(),z=ue.length;z<H.length;z+=1)Me(z);se()}if(c[9].jat[c[0]][c[10]].arms.length>0?Z?(Z.p(c,E),E[0]&513&&w(Z,1)):(Z=kt(c),Z.c(),w(Z,1),Z.m(u.parentNode,u)):Z&&(le(),v(Z,1,1,()=>{Z=null}),se()),E[0]&133651){fe=pe(c[9].jat[c[0]][c[1]].movements);let z;for(z=0;z<fe.length;z+=1){const Se=wt(c,fe,z);K[z]?(K[z].p(Se,E),w(K[z],1)):(K[z]=jt(Se),K[z].c(),w(K[z],1),K[z].m(L.parentNode,L))}for(le(),z=fe.length;z<K.length;z+=1)m(z);se()}c[9].jat[c[0]][c[10]].movements.length>0?M?(M.p(c,E),E[0]&513&&w(M,1)):(M=Et(c),M.c(),w(M,1),M.m(J.parentNode,J)):M&&(le(),v(M,1,1,()=>{M=null}),se())},i(c){if(!A){w(e.$$.fragment,c),w(f.$$.fragment,c);for(let E=0;E<ue.length;E+=1)w(H[E]);w(Z);for(let E=0;E<fe.length;E+=1)w(K[E]);w(M),A=!0}},o(c){v(e.$$.fragment,c),v(f.$$.fragment,c),H=H.filter(Boolean);for(let E=0;E<H.length;E+=1)v(H[E]);v(Z),K=K.filter(Boolean);for(let E=0;E<K.length;E+=1)v(K[E]);v(M),A=!1},d(c){c&&(y(n),y(r),y(h),y(k),y(N),y(S),y($),y(u),y(_),y(p),y(L),y(J)),q(e,c),P.d(),q(f,c),Ne(H,c),Z&&Z.d(c),Ne(K,c),M&&M.d(c)}}}function Ur(t){let e;return{c(){e=X("Save")},l(n){e=W(n,"Save")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function Jr(t){let e;return{c(){e=X("Delete")},l(n){e=W(n,"Delete")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function Hr(t){let e,n,r;function o(a){t[29](a)}let i={label:"Arm Name"};return t[9].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(i.value=t[9].jat[t[0]][t[1]].arms[t[3].idx].name),e=new et({props:i}),x.push(()=>te(e,"value",o)),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,s){T(e,a,s),r=!0},p(a,s){const l={};!n&&s[0]&523&&(n=!0,l.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,ee(()=>n=!1)),e.$set(l)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){v(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function Kr(t){let e,n;return e=new Gr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[0]&1&&(i.junctionIdx=r[0]),o[0]&2&&(i.stage=r[1]),o[0]&8&&(i.idx=r[3].idx),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Xr(t){let e;return{c(){e=X("Zoom to fit")},l(n){e=W(n,"Zoom to fit")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function Wr(t){let e;return{c(){e=X("Show scheme context")},l(n){e=W(n,"Show scheme context")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function Vr(t){var S;let e,n,r,o,i,a,s,l,g,d,h,f;e=new Le({props:{$$slots:{default:[Xr]},$$scope:{ctx:t}}}),e.$on("click",t[19]),r=new hn({}),i=new $n({});function C($){t[20]($)}let k={map:(S=t[7])==null?void 0:S.getMap()};t[5]!==void 0&&(k.enabled=t[5]),s=new bn({props:k}),x.push(()=>te(s,"enabled",C));function N($){t[21]($)}let G={$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[6]!==void 0&&(G.checked=t[6]),d=new wn({props:G}),x.push(()=>te(d,"checked",N)),{c(){I(e.$$.fragment),n=O(),I(r.$$.fragment),o=O(),I(i.$$.fragment),a=O(),I(s.$$.fragment),g=O(),I(d.$$.fragment)},l($){F(e.$$.fragment,$),n=B($),F(r.$$.fragment,$),o=B($),F(i.$$.fragment,$),a=B($),F(s.$$.fragment,$),g=B($),F(d.$$.fragment,$)},m($,u){T(e,$,u),j($,n,u),T(r,$,u),j($,o,u),T(i,$,u),j($,a,u),T(s,$,u),j($,g,u),T(d,$,u),f=!0},p($,u){var L;const _={};u[1]&512&&(_.$$scope={dirty:u,ctx:$}),e.$set(_);const b={};u[0]&128&&(b.map=(L=$[7])==null?void 0:L.getMap()),!l&&u[0]&32&&(l=!0,b.enabled=$[5],ee(()=>l=!1)),s.$set(b);const p={};u[1]&512&&(p.$$scope={dirty:u,ctx:$}),!h&&u[0]&64&&(h=!0,p.checked=$[6],ee(()=>h=!1)),d.$set(p)},i($){f||(w(e.$$.fragment,$),w(r.$$.fragment,$),w(i.$$.fragment,$),w(s.$$.fragment,$),w(d.$$.fragment,$),f=!0)},o($){v(e.$$.fragment,$),v(r.$$.fragment,$),v(i.$$.fragment,$),v(s.$$.fragment,$),v(d.$$.fragment,$),f=!1},d($){$&&(y(n),y(o),y(a),y(g)),q(e,$),q(r,$),q(i,$),q(s,$),q(d,$)}}}function Zr(t){let e;return{c(){e=X("No movements added")},l(n){e=W(n,"No movements added")},m(n,r){j(n,e,r)},p:Pe,d(n){n&&y(e)}}}function Qr(t){let e=Math.round(Pt(t[9].jat[t[0]][t[1]]))+"",n,r;return{c(){n=X(e),r=X("%")},l(o){n=W(o,e),r=W(o,"%")},m(o,i){j(o,n,i),j(o,r,i)},p(o,i){i[0]&515&&e!==(e=Math.round(Pt(o[9].jat[o[0]][o[1]]))+"")&&he(n,e)},d(o){o&&(y(n),y(r))}}}function vt(t){let e,n;function r(){return t[23](t[37])}function o(){return t[24](t[37])}return e=new xe({props:{name:`${Ct(t[37])} - ${t[38].name||"Unnamed arm"}`}}),e.$on("click",r),e.$on("mouseenter",o),e.$on("mouseleave",t[25]),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){T(e,i,a),n=!0},p(i,a){t=i;const s={};a[0]&515&&(s.name=`${Ct(t[37])} - ${t[38].name||"Unnamed arm"}`),e.$set(s)},i(i){n||(w(e.$$.fragment,i),n=!0)},o(i){v(e.$$.fragment,i),n=!1},d(i){q(e,i)}}}function kt(t){let e,n;return e=new Le({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),e.$on("click",t[15]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Yr(t){let e,n;return{c(){e=X("Copy arms from "),n=X(t[10])},l(r){e=W(r,"Copy arms from "),n=W(r,t[10])},m(r,o){j(r,e,o),j(r,n,o)},p:Pe,d(r){r&&(y(e),y(n))}}}function xr(t){let e,n,r=t[34].score+"",o;return{c(){e=ie("span"),n=X("Score: "),o=X(r),this.h()},l(i){e=ae(i,"SPAN",{style:!0});var a=me(e);n=W(a,"Score: "),o=W(a,r),a.forEach(y),this.h()},h(){Q(e,"padding","4px"),Q(e,"color",t[35].font),Q(e,"background-color",t[35].background)},m(i,a){j(i,e,a),ne(e,n),ne(e,o)},p(i,a){a[0]&515&&r!==(r=i[34].score+"")&&he(o,r),a[0]&515&&Q(e,"color",i[35].font),a[0]&515&&Q(e,"background-color",i[35].background)},d(i){i&&y(e)}}}function jt(t){let e,n;function r(){return t[26](t[37])}function o(){return t[27](t[37])}return e=new xe({props:{name:t[34].name||"Unnamed movement",$$slots:{default:[xr]},$$scope:{ctx:t}}}),e.$on("click",r),e.$on("mouseenter",o),e.$on("mouseleave",t[28]),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){T(e,i,a),n=!0},p(i,a){t=i;const s={};a[0]&515&&(s.name=t[34].name||"Unnamed movement"),a[0]&515|a[1]&512&&(s.$$scope={dirty:a,ctx:t}),e.$set(s)},i(i){n||(w(e.$$.fragment,i),n=!0)},o(i){v(e.$$.fragment,i),n=!1},d(i){q(e,i)}}}function Et(t){let e,n;return e=new Le({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),e.$on("click",t[16]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function eo(t){let e,n;return{c(){e=X("Copy movements from "),n=X(t[10])},l(r){e=W(r,"Copy movements from "),n=W(r,t[10])},m(r,o){j(r,e,o),j(r,n,o)},p:Pe,d(r){r&&(y(e),y(n))}}}function to(t){let e,n,r,o,i,a,s,l,g,d,h,f,C,k;function N(p){t[18](p)}let G={label:"Commentary / Notes"};t[9].jat[t[0]][t[1]].notes!==void 0&&(G.value=t[9].jat[t[0]][t[1]].notes),e=new Nt({props:G}),x.push(()=>te(e,"value",N));const S=[Rr,Dr],$=[];function u(p,L){return p[3]==null?0:1}a=u(t),s=$[a]=S[a](t);function _(p){t[32](p)}let b={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6],select:t[11],stopEditing:t[12]};return t[3]!==void 0&&(b.editing=t[3]),d=new Nr({props:b}),t[31](d),x.push(()=>te(d,"editing",_)),{c(){I(e.$$.fragment),r=O(),o=ie("div"),i=ie("div"),s.c(),l=O(),g=ie("div"),I(d.$$.fragment),this.h()},l(p){F(e.$$.fragment,p),r=B(p),o=ae(p,"DIV",{style:!0});var L=me(o);i=ae(L,"DIV",{style:!0});var J=me(i);s.l(J),J.forEach(y),l=B(L),g=ae(L,"DIV",{style:!0});var A=me(g);F(d.$$.fragment,A),A.forEach(y),L.forEach(y),this.h()},h(){Q(i,"width","30%"),Q(i,"overflow-y","scroll"),Q(i,"padding","10px"),Q(i,"border","1px solid black"),Q(g,"position","relative"),Q(g,"width","100%"),Q(o,"display","flex"),Q(o,"height","80vh")},m(p,L){T(e,p,L),j(p,r,L),j(p,o,L),ne(o,i),$[a].m(i,null),t[30](i),ne(o,l),ne(o,g),T(d,g,null),f=!0,C||(k=on(zr,"keydown",t[14]),C=!0)},p(p,L){const J={};!n&&L[0]&515&&(n=!0,J.value=p[9].jat[p[0]][p[1]].notes,ee(()=>n=!1)),e.$set(J);let A=a;a=u(p),a===A?$[a].p(p,L):(le(),v($[A],1,1,()=>{$[A]=null}),se(),s=$[a],s?s.p(p,L):(s=$[a]=S[a](p),s.c()),w(s,1),s.m(i,null));const D={};L[0]&1&&(D.junctionIdx=p[0]),L[0]&2&&(D.stage=p[1]),L[0]&4&&(D.newKind=p[2]),L[0]&16&&(D.hoveringSidebar=p[4]),L[0]&32&&(D.streetviewOn=p[5]),L[0]&64&&(D.showContext=p[6]),!h&&L[0]&8&&(h=!0,D.editing=p[3],ee(()=>h=!1)),d.$set(D)},i(p){f||(w(e.$$.fragment,p),w(s),w(d.$$.fragment,p),f=!0)},o(p){v(e.$$.fragment,p),v(s),v(d.$$.fragment,p),f=!1},d(p){p&&(y(r),y(o)),q(e,p),$[a].d(),t[30](null),t[31](null),q(d),C=!1,k()}}}function Ct(t){return String.fromCharCode(t+65)}function Pt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function no(t,e,n){let r;Re(t,V,m=>n(9,r=m));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",s="arm",l=null,g=null,d=null,h=!1,f=!0,C=null,k;async function N(m){g=k.scrollTop,n(3,l=m),n(4,d=null)}async function G(){n(3,l=null),g!=null&&(await an(),n(8,k.scrollTop=g,k),g=null)}function S(){window.confirm(`Delete this ${l.kind}?`)&&(l.kind=="movement"?(r.jat[o][i].movements.splice(l.idx,1),V.set(r)):(r.jat[o][i].arms.splice(l.idx,1),V.set(r)),G())}function $(m){if(l!=null&&m.key=="Escape")m.stopPropagation(),G();else if(l!=null&&m.key=="Delete"){let M=m.target.tagName;if(M=="INPUT"||M=="TEXTAREA")return;m.stopPropagation(),S()}}function u(){r.jat[o][i].arms.length>0&&!window.confirm("Overwrite arms?")||(qe(V,r.jat[o][i].arms=JSON.parse(JSON.stringify(r.jat[o][a].arms)),r),V.set(r))}function _(){r.jat[o][i].movements.length>0&&!window.confirm("Overwrite movements?")||(qe(V,r.jat[o][i].movements=JSON.parse(JSON.stringify(r.jat[o][a].movements)),r),V.set(r))}let b={0:_e.red,1:_e.amber,2:_e.green,X:_e.critical};function p(m){t.$$.not_equal(r.jat[o][i].notes,m)&&(r.jat[o][i].notes=m,V.set(r))}const L=()=>C==null?void 0:C.zoom(!0);function J(m){h=m,n(5,h)}function A(m){f=m,n(6,f)}function D(m){s=m,n(2,s)}const ce=m=>N({kind:"arm",idx:m}),P=m=>n(4,d={kind:"arm",idx:m}),Ae=()=>n(4,d=null),ve=m=>N({kind:"movement",idx:m}),ue=m=>n(4,d={kind:"movement",idx:m}),H=()=>n(4,d=null);function Me(m){t.$$.not_equal(r.jat[o][i].arms[l.idx].name,m)&&(r.jat[o][i].arms[l.idx].name=m,V.set(r))}function Z(m){x[m?"unshift":"push"](()=>{k=m,n(8,k)})}function fe(m){x[m?"unshift":"push"](()=>{C=m,n(7,C)})}function K(m){l=m,n(3,l)}return t.$$set=m=>{"junctionIdx"in m&&n(0,o=m.junctionIdx),"stage"in m&&n(1,i=m.stage)},[o,i,s,l,d,h,f,C,k,r,a,N,G,S,$,u,_,b,p,L,J,A,D,ce,P,Ae,ve,ue,H,Me,Z,fe,K]}class ro extends Oe{constructor(e){super(),Be(this,e,no,to,Ce,{junctionIdx:0,stage:1},null,[-1,-1])}}function Lt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function oo(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,i=t[0].stage+"",a,s,l,g,d,h,f,C=t[0].stage,k,N;l=new ln({props:{$$slots:{default:[co]},$$scope:{ctx:t}}});function G(u){t[9](u)}let S={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(S.value=t[1].jat[t[0].idx].name),d=new et({props:S}),x.push(()=>te(d,"value",G));let $=At(t);return{c(){e=ie("h2"),r=X(n),o=X(" - "),a=X(i),s=O(),I(l.$$.fragment),g=O(),I(d.$$.fragment),f=O(),$.c(),k=de()},l(u){e=ae(u,"H2",{});var _=me(e);r=W(_,n),o=W(_," - "),a=W(_,i),_.forEach(y),s=B(u),F(l.$$.fragment,u),g=B(u),F(d.$$.fragment,u),f=B(u),$.l(u),k=de()},m(u,_){j(u,e,_),ne(e,r),ne(e,o),ne(e,a),j(u,s,_),T(l,u,_),j(u,g,_),T(d,u,_),j(u,f,_),$.m(u,_),j(u,k,_),N=!0},p(u,_){(!N||_&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&he(r,n),(!N||_&1)&&i!==(i=u[0].stage+"")&&he(a,i);const b={};_&8193&&(b.$$scope={dirty:_,ctx:u}),l.$set(b);const p={};!h&&_&3&&(h=!0,p.value=u[1].jat[u[0].idx].name,ee(()=>h=!1)),d.$set(p),_&1&&Ce(C,C=u[0].stage)?(le(),v($,1,1,Pe),se(),$=At(u),$.c(),w($,1),$.m(k.parentNode,k)):$.p(u,_)},i(u){N||(w(l.$$.fragment,u),w(d.$$.fragment,u),w($),N=!0)},o(u){v(l.$$.fragment,u),v(d.$$.fragment,u),v($),N=!1},d(u){u&&(y(e),y(s),y(g),y(f),y(k)),q(l,u),q(d,u),$.d(u)}}}function io(t){let e,n,r,o;e=new St({props:{$$slots:{default:[go]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let i=pe(t[1].jat),a=[];for(let l=0;l<i.length;l+=1)a[l]=Mt(Lt(t,i,l));const s=l=>v(a[l],1,1,()=>{a[l]=null});return{c(){I(e.$$.fragment),n=O();for(let l=0;l<a.length;l+=1)a[l].c();r=de()},l(l){F(e.$$.fragment,l),n=B(l);for(let g=0;g<a.length;g+=1)a[g].l(l);r=de()},m(l,g){T(e,l,g),j(l,n,g);for(let d=0;d<a.length;d+=1)a[d]&&a[d].m(l,g);j(l,r,g),o=!0},p(l,g){const d={};if(g&8192&&(d.$$scope={dirty:g,ctx:l}),e.$set(d),g&3){i=pe(l[1].jat);let h;for(h=0;h<i.length;h+=1){const f=Lt(l,i,h);a[h]?(a[h].p(f,g),w(a[h],1)):(a[h]=Mt(f),a[h].c(),w(a[h],1),a[h].m(r.parentNode,r))}for(le(),h=i.length;h<a.length;h+=1)s(h);se()}},i(l){if(!o){w(e.$$.fragment,l);for(let g=0;g<i.length;g+=1)w(a[g]);o=!0}},o(l){v(e.$$.fragment,l),a=a.filter(Boolean);for(let g=0;g<a.length;g+=1)v(a[g]);o=!1},d(l){l&&(y(n),y(r)),q(e,l),Ne(a,l)}}}function ao(t){let e;return{c(){e=X("Back to all junctions")},l(n){e=W(n,"Back to all junctions")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function lo(t){let e,n;return e=new Le({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function so(t){let e,n;return e=new Le({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function uo(t){let e;return{c(){e=X("Edit Proposed")},l(n){e=W(n,"Edit Proposed")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function fo(t){let e;return{c(){e=X("Edit Existing")},l(n){e=W(n,"Edit Existing")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function mo(t){let e;return{c(){e=X("Delete")},l(n){e=W(n,"Delete")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function co(t){let e,n,r,o,i,a,s;e=new Le({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const l=[so,lo],g=[];function d(h,f){return h[0].stage=="proposed"?0:1}return r=d(t),o=g[r]=l[r](t),a=new It({props:{$$slots:{default:[mo]},$$scope:{ctx:t}}}),a.$on("click",t[8]),{c(){I(e.$$.fragment),n=O(),o.c(),i=O(),I(a.$$.fragment)},l(h){F(e.$$.fragment,h),n=B(h),o.l(h),i=B(h),F(a.$$.fragment,h)},m(h,f){T(e,h,f),j(h,n,f),g[r].m(h,f),j(h,i,f),T(a,h,f),s=!0},p(h,f){const C={};f&8192&&(C.$$scope={dirty:f,ctx:h}),e.$set(C);let k=r;r=d(h),r===k?g[r].p(h,f):(le(),v(g[k],1,1,()=>{g[k]=null}),se(),o=g[r],o?o.p(h,f):(o=g[r]=l[r](h),o.c()),w(o,1),o.m(i.parentNode,i));const N={};f&8192&&(N.$$scope={dirty:f,ctx:h}),a.$set(N)},i(h){s||(w(e.$$.fragment,h),w(o),w(a.$$.fragment,h),s=!0)},o(h){v(e.$$.fragment,h),v(o),v(a.$$.fragment,h),s=!1},d(h){h&&(y(n),y(i)),q(e,h),g[r].d(h),q(a,h)}}}function At(t){let e,n;return e=new ro({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o&1&&(i.junctionIdx=r[0].idx),o&1&&(i.stage=r[0].stage),e.$set(i)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){v(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function go(t){let e;return{c(){e=X("Add new junction")},l(n){e=W(n,"Add new junction")},m(n,r){j(n,e,r)},d(n){n&&y(e)}}}function Mt(t){let e,n;function r(){return t[4](t[12])}return e=new xe({props:{name:t[10].name||"Untitled junction"}}),e.$on("click",r),{c(){I(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,i){T(e,o,i),n=!0},p(o,i){t=o;const a={};i&2&&(a.name=t[10].name||"Untitled junction"),e.$set(a)},i(o){n||(w(e.$$.fragment,o),n=!0)},o(o){v(e.$$.fragment,o),n=!1},d(o){q(e,o)}}}function po(t){let e,n,r,o;const i=[io,oo],a=[];function s(l,g){return l[0].kind=="list"?0:l[0].kind=="edit"?1:-1}return~(e=s(t))&&(n=a[e]=i[e](t)),{c(){n&&n.c(),r=de()},l(l){n&&n.l(l),r=de()},m(l,g){~e&&a[e].m(l,g),j(l,r,g),o=!0},p(l,[g]){let d=e;e=s(l),e===d?~e&&a[e].p(l,g):(n&&(le(),v(a[d],1,1,()=>{a[d]=null}),se()),~e?(n=a[e],n?n.p(l,g):(n=a[e]=i[e](l),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(l){o||(w(n),o=!0)},o(l){v(n),o=!1},d(l){l&&y(r),~e&&a[e].d(l)}}}function We(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function _o(t,e,n){let r;Re(t,V,C=>n(1,r=C));let o={kind:"list"};function i(){qe(V,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function a(C){window.confirm("Delete this junction?")&&(r.jat.splice(C,1),V.set(r),n(0,o={kind:"list"}))}const s=C=>n(0,o={kind:"edit",idx:C,stage:"existing"}),l=()=>n(0,o={kind:"list"}),g=()=>n(0,o={kind:"edit",idx:We(o),stage:"existing"}),d=()=>n(0,o={kind:"edit",idx:We(o),stage:"proposed"}),h=()=>a(We(o));function f(C){t.$$.not_equal(r.jat[o.idx].name,C)&&(r.jat[o.idx].name=C,V.set(r))}return[o,r,i,a,s,l,g,d,h,f]}class zo extends Oe{constructor(e){super(),Be(this,e,_o,po,Ce,{})}}export{zo as component};
