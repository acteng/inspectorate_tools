import{s as _e,v as Z,x as Y,l as Ze,u as Qe,m as Xe,o as Ye,H as me,E as qe,i as M,f as v,a9 as nr,a8 as or,k as ge,U as Tt,a7 as It,N as St,e as W,c as U,b as R,r as q,R as gt,S as ht,h as ue,n as Ae,a as G,g as N,w as se,z as Se,p as ir,q as Bt,t as ye,d as be,j as xe,B as lr}from"../chunks/scheduler.Bsni_e59.js";import{S as ve,i as we,e as x,c as F,a as j,m as T,t as b,b as E,d as I,g as ke,f as Ee}from"../chunks/index.CCfAUppz.js";import{L as ar,g as sr,e as ur,m as he,i as fr,f as qt,M as cr,a as mr,G as pt,h as dt}from"../chunks/MapLibreMap.DQJCRC_X.js";import{e as Ge}from"../chunks/each.BmgwAlbi.js";import{c as fe}from"../chunks/colors.CYEpEtTL.js";import{D as gr}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as hr,S as pr}from"../chunks/WarningButton.D9QeV9gM.js";import{a as dr,B as _r,G as yr,S as br,c as vr,M as _t}from"../chunks/GeoreferenceLayer.XrRiLZ13.js";import{s as K}from"../chunks/data.DF9_frvF.js";import{p as yt}from"../chunks/index.F4wDJvP0.js";import{S as bt}from"../chunks/Select.bLRJACqI.js";import{T as wr}from"../chunks/TextInput.CHbK327s.js";function kr(t){let e;const r=t[15].default,n=Ze(r,t,t[23],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8388608)&&Qe(n,r,o,o[23],e?Ye(r,o[23],i,null):Xe(o[23]),null)},i(o){e||(b(n,o),e=!0)},o(o){E(n,o),e=!1},d(o){n&&n.d(o)}}}function Er(t){let e,r,n;function o(l){t[16](l)}let i={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[kr]},$$scope:{ctx:t}};return t[0]!==void 0&&(i.hovered=t[0]),e=new ar({props:i}),Z.push(()=>x(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){F(e.$$.fragment)},l(l){j(e.$$.fragment,l)},m(l,a){T(e,l,a),n=!0},p(l,[a]){const u={};a&2&&(u.id=l[1]),a&4&&(u.source=l[2]),a&8&&(u.sourceLayer=l[3]),a&16&&(u.beforeId=l[4]),a&32&&(u.beforeLayerType=l[5]),a&64&&(u.paint=l[6]),a&128&&(u.layout=l[7]),a&256&&(u.filter=l[8]),a&512&&(u.minzoom=l[9]),a&1024&&(u.maxzoom=l[10]),a&2048&&(u.hoverCursor=l[11]),a&4096&&(u.manageHoverState=l[12]),a&8192&&(u.eventsIfTopMost=l[13]),a&16384&&(u.interactive=l[14]),a&8388608&&(u.$$scope={dirty:a,ctx:l}),!r&&a&1&&(r=!0,u.hovered=l[0],Y(()=>r=!1)),e.$set(u)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){E(e.$$.fragment,l),n=!1},d(l){I(e,l)}}}function Cr(t,e,r){let{$$slots:n={},$$scope:o}=e,{id:i=sr("line")}=e,{source:l=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:u=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:p}=e,{layout:f=void 0}=e,{filter:d=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:w=void 0}=e,{hoverCursor:k=void 0}=e,{manageHoverState:s=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:C=!1}=e,{interactive:P=!0}=e;function S(_){h=_,r(0,h)}function oe(_){me.call(this,t,_)}function ie(_){me.call(this,t,_)}function D(_){me.call(this,t,_)}function Q(_){me.call(this,t,_)}function B(_){me.call(this,t,_)}function le(_){me.call(this,t,_)}return t.$$set=_=>{"id"in _&&r(1,i=_.id),"source"in _&&r(2,l=_.source),"sourceLayer"in _&&r(3,a=_.sourceLayer),"beforeId"in _&&r(4,u=_.beforeId),"beforeLayerType"in _&&r(5,g=_.beforeLayerType),"paint"in _&&r(6,p=_.paint),"layout"in _&&r(7,f=_.layout),"filter"in _&&r(8,d=_.filter),"minzoom"in _&&r(9,m=_.minzoom),"maxzoom"in _&&r(10,w=_.maxzoom),"hoverCursor"in _&&r(11,k=_.hoverCursor),"manageHoverState"in _&&r(12,s=_.manageHoverState),"hovered"in _&&r(0,h=_.hovered),"eventsIfTopMost"in _&&r(13,C=_.eventsIfTopMost),"interactive"in _&&r(14,P=_.interactive),"$$scope"in _&&r(23,o=_.$$scope)},[h,i,l,a,u,g,p,f,d,m,w,k,s,C,P,n,S,oe,ie,D,Q,B,le,o]}class Ue extends ve{constructor(e){super(),we(this,e,Cr,Er,_e,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Lr=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),vt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function wt(t){let e,r,n=(t[4]||t[3]instanceof he.Marker)&&kt(t);return{c(){e=W("div"),n&&n.c()},l(o){e=U(o,"DIV",{});var i=R(e);n&&n.l(i),i.forEach(v)},m(o,i){M(o,e,i),n&&n.m(e,null),t[32](e),r=!0},p(o,i){o[4]||o[3]instanceof he.Marker?n?(n.p(o,i),i[0]&24&&b(n,1)):(n=kt(o),n.c(),b(n,1),n.m(e,null)):n&&(ke(),E(n,1,1,()=>{n=null}),Ee())},i(o){r||(b(n),r=!0)},o(o){E(n),r=!1},d(o){o&&v(e),n&&n.d(),t[32](null)}}}function kt(t){let e;const r=t[30].default,n=Ze(r,t,t[29],vt);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i[0]&536870933)&&Qe(n,r,o,o[29],e?Ye(r,o[29],i,Lr):Xe(o[29]),vt)},i(o){e||(b(n,o),e=!0)},o(o){E(n,o),e=!1},d(o){n&&n.d(o)}}}function Pr(t){let e,r,n=t[9].default&&wt(t);return{c(){n&&n.c(),e=qe()},l(o){n&&n.l(o),e=qe()},m(o,i){n&&n.m(o,i),M(o,e,i),r=!0},p(o,i){o[9].default?n?(n.p(o,i),i[0]&512&&b(n,1)):(n=wt(o),n.c(),b(n,1),n.m(e.parentNode,e)):n&&(ke(),E(n,1,1,()=>{n=null}),Ee())},i(o){r||(b(n),r=!0)},o(o){E(n),r=!1},d(o){o&&v(e),n&&n.d(o)}}}function Mr(t,e,r){let n,o,i,l,a,u,{$$slots:g={},$$scope:p}=e;const f=nr(g);let{closeButton:d=void 0}=e,{closeOnClickOutside:m=!0}=e,{closeOnClickInside:w=!1}=e,{closeOnMove:k=!1}=e,{openOn:s="click"}=e,{openIfTopMost:h=!0}=e,{focusAfterOpen:C=!0}=e,{anchor:P=void 0}=e,{offset:S=void 0}=e,{popupClass:oe=void 0}=e,{maxWidth:ie=void 0}=e,{lngLat:D=void 0}=e,{html:Q=void 0}=e,{open:B=!1}=e;const le=or(),{map:_,popupTarget:Fe,layerEvent:y,layer:$,eventTopMost:Ce}=ur();ge(t,_,c=>r(2,i=c)),ge(t,Fe,c=>r(3,a=c)),ge(t,y,c=>r(28,l=c)),ge(t,$,c=>r(35,u=c));const je=["click","dblclick","contextmenu"];let L,Te=!1,X;function er(){if(!L)return;let c=L.getElement();!c||c===X||(X=c,s==="hover"&&(X.style.pointerEvents="none"),X.addEventListener("mouseenter",()=>{r(24,Te=!0)},{passive:!0}),X.addEventListener("mouseleave",()=>{r(24,Te=!1)},{passive:!0}),X.addEventListener("click",()=>{w&&r(0,B=!1)},{passive:!0}))}Tt(()=>{if(i)return i.on("click",Ie),i.on("contextmenu",Ie),typeof a=="string"&&(i.on("click",a,ae),i.on("dblclick",a,ae),i.on("contextmenu",a,ae),i.on("mousemove",a,mt),i.on("mouseleave",a,ct),i.on("touchstart",a,ut),i.on("touchend",a,ft)),()=>{i!=null&&i.loaded()&&(L==null||L.remove(),i.off("click",Ie),i.off("contextmenu",Ie),a instanceof he.Marker?a.getPopup()===L&&a.setPopup(void 0):typeof a=="string"&&(i.off("click",a,ae),i.off("dblclick",a,ae),i.off("contextmenu",a,ae),i.off("mousemove",a,mt),i.off("mouseleave",a,ct),i.off("touchstart",a,ut),i.off("touchend",a,ft)))}});function st(c){return h?!("marker"in c)&&!fr(c)&&Ce(c)!==u:!1}let V=null,J="normal";function ae(c){c.type===s&&(st(c)||("layerType"in c?c.layerType==="deckgl"?(r(10,D=c.coordinate),r(4,V=c.object?[c.object]:null)):(r(10,D=c.lngLat),r(4,V=c.features??[])):(r(10,D=c.lngLat),r(4,V=c.features??[])),setTimeout(()=>r(0,B=!0))))}let ce=null;function ut(c){ce=c.point}function ft(c){if(!ce||s!=="hover")return;let Re=ce.dist(c.point);ce=null,Re<3&&(r(10,D=c.lngLat),r(4,V=c.features??[]),L.isOpen()?r(25,J="justOpened"):(r(25,J="opening"),r(0,B=!0)))}function ct(c){s!=="hover"||ce||J!=="normal"||(r(0,B=!1),r(4,V=null))}function mt(c){if(!(s!=="hover"||ce||J!=="normal")){if(st(c)){r(0,B=!1),r(4,V=null);return}r(0,B=!0),r(4,V=c.features??[]),r(10,D=c.lngLat)}}function Ie(c){if(J==="justOpened"){r(25,J="normal");return}if(!m)return;let Re=[X,a instanceof he.Marker?a==null?void 0:a.getElement():null];B&&L.isOpen()&&!Re.some(We=>We==null?void 0:We.contains(c.originalEvent.target))&&(c.type==="contextmenu"&&s==="contextmenu"||c.type!=="contextmenu")&&r(0,B=!1)}It(()=>{i&&(L!=null&&L.isOpen())&&L.remove()});let Le;const tr=()=>r(0,B=!1);function rr(c){Z[c?"unshift":"push"](()=>{Le=c,r(1,Le)})}return t.$$set=c=>{"closeButton"in c&&r(11,d=c.closeButton),"closeOnClickOutside"in c&&r(12,m=c.closeOnClickOutside),"closeOnClickInside"in c&&r(13,w=c.closeOnClickInside),"closeOnMove"in c&&r(14,k=c.closeOnMove),"openOn"in c&&r(15,s=c.openOn),"openIfTopMost"in c&&r(16,h=c.openIfTopMost),"focusAfterOpen"in c&&r(17,C=c.focusAfterOpen),"anchor"in c&&r(18,P=c.anchor),"offset"in c&&r(19,S=c.offset),"popupClass"in c&&r(20,oe=c.popupClass),"maxWidth"in c&&r(21,ie=c.maxWidth),"lngLat"in c&&r(10,D=c.lngLat),"html"in c&&r(22,Q=c.html),"open"in c&&r(0,B=c.open),"$$scope"in c&&r(29,p=c.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&r(27,n=d??(!m&&!w)),t.$$.dirty[0]&146685952&&(L||(r(23,L=new he.Popup({closeButton:n,closeOnClick:!1,closeOnMove:k,focusAfterOpen:C,maxWidth:ie,className:oe,anchor:P,offset:S})),X=L.getElement(),L.on("open",()=>{r(0,B=!0),er(),le("open",L)}),L.on("close",()=>{r(0,B=!1),le("close",L)}),L.on("hover",()=>{le("hover",L)}))),t.$$.dirty[0]&8421384&&L&&a instanceof he.Marker&&(s==="click"?a.setPopup(L):a.getPopup()===L&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&je.includes(s)&&(l==null?void 0:l.type)===s&&(ae(l),St(y,l=null,l)),t.$$.dirty[0]&268468224&&r(26,o=s==="hover"&&((l==null?void 0:l.type)==="mousemove"||(l==null?void 0:l.type)==="mouseenter")),t.$$.dirty[0]&352354304&&s==="hover"&&y&&(o&&l&&(l.layerType==="deckgl"?(r(10,D=l.coordinate),r(4,V=l.object?[l.object]:null)):(r(10,D=l.lngLat),r(4,V=l.features??[]))),r(0,B=(o||Te)??!1)),t.$$.dirty[0]&12582914&&(Le?L.setDOMContent(Le):Q&&L.setHTML(Q)),t.$$.dirty[0]&8389632&&D&&L.setLngLat(D),t.$$.dirty[0]&41943045&&i){let c=L.isOpen();B&&!c?(L.addTo(i),J==="opening"&&r(25,J="justOpened")):!B&&c&&L.remove()}},[B,Le,i,a,V,_,Fe,y,$,f,D,d,m,w,k,s,h,C,P,S,oe,ie,Q,L,Te,J,o,n,l,p,g,tr,rr]}class Or extends ve{constructor(e){super(),we(this,e,Mr,Pr,_e,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const Ar=t=>({props:t&8}),Et=t=>({props:Tr(t[3])});function Fr(t){let e,r;const n=t[1].default,o=Ze(n,t,t[2],Et);return{c(){e=W("div"),o&&o.c(),this.h()},l(i){e=U(i,"DIV",{class:!0});var l=R(e);o&&o.l(l),l.forEach(v),this.h()},h(){q(e,"class","govuk-prose")},m(i,l){M(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&12)&&Qe(o,n,i,i[2],r?Ye(n,i[2],l,Ar):Xe(i[2]),Et)},i(i){r||(b(o,i),r=!0)},o(i){E(o,i),r=!1},d(i){i&&v(e),o&&o.d(i)}}}function jr(t){let e,r;return e=new Or({props:{openOn:t[0],$$slots:{default:[Fr,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,o){T(e,n,o),r=!0},p(n,[o]){const i={};o&1&&(i.openOn=n[0]),o&12&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function Tr(t){return t?t[0].properties??{}:{}}function Ir(t,e,r){let{$$slots:n={},$$scope:o}=e,{openOn:i="hover"}=e;return t.$$set=l=>{"openOn"in l&&r(0,i=l.openOn),"$$scope"in l&&r(2,o=l.$$scope)},[i,n,o]}class Gt extends ve{constructor(e){super(),we(this,e,Ir,jr,_e,{openOn:0})}}var Sr=Object.defineProperty,O=(t,e)=>Sr(t,"name",{value:e,configurable:!0}),Br=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Pe(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Ve(e),o=Ve(r);return n.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Pe(e,r))return!1;const i=e;let l=r;if(o&&!this.compareCoord(i[0],l[0])){const u=this.fixStartIndex(l,i);if(u)l=u;else return!1}const a=this.compareCoord(i[n],l[n]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[n],l[l.length-(1+n)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,r){let n,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],r[0])){o=i;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,r){return Pe(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?qt(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Pe(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};O(Br,"GeojsonEquality");function Pe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}O(Pe,"sameLength");function Ve(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}O(Ve,"explode");var z=63710088e-1,Nt={centimeters:z*100,centimetres:z*100,degrees:360/(2*Math.PI),feet:z*3.28084,inches:z*39.37,kilometers:z/1e3,kilometres:z/1e3,meters:z,metres:z,miles:z/1609.344,millimeters:z*1e3,millimetres:z*1e3,nauticalmiles:z/1852,radians:1,yards:z*1.0936},Ct={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ee(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}O(ee,"feature");function qr(t,e,r={}){switch(t){case"Point":return De(e).geometry;case"LineString":return tt(e).geometry;case"Polygon":return et(e).geometry;case"MultiPoint":return $t(e).geometry;case"MultiLineString":return Dt(e).geometry;case"MultiPolygon":return zt(e).geometry;default:throw new Error(t+" is invalid")}}O(qr,"geometry");function De(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!pe(t[0])||!pe(t[1]))throw new Error("coordinates must contain numbers");return ee({type:"Point",coordinates:t},e,r)}O(De,"point");function Gr(t,e,r={}){return $e(t.map(n=>De(n,e)),r)}O(Gr,"points");function et(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return ee({type:"Polygon",coordinates:t},e,r)}O(et,"polygon");function Nr(t,e,r={}){return $e(t.map(n=>et(n,e)),r)}O(Nr,"polygons");function tt(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ee({type:"LineString",coordinates:t},e,r)}O(tt,"lineString");function Dr(t,e,r={}){return $e(t.map(n=>tt(n,e)),r)}O(Dr,"lineStrings");function $e(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}O($e,"featureCollection");function Dt(t,e,r={}){return ee({type:"MultiLineString",coordinates:t},e,r)}O(Dt,"multiLineString");function $t(t,e,r={}){return ee({type:"MultiPoint",coordinates:t},e,r)}O($t,"multiPoint");function zt(t,e,r={}){return ee({type:"MultiPolygon",coordinates:t},e,r)}O(zt,"multiPolygon");function $r(t,e,r={}){return ee({type:"GeometryCollection",geometries:t},e,r)}O($r,"geometryCollection");function zr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}O(zr,"round");function Ht(t,e="kilometers"){const r=Nt[e];if(!r)throw new Error(e+" units is invalid");return t*r}O(Ht,"radiansToLength");function ze(t,e="kilometers"){const r=Nt[e];if(!r)throw new Error(e+" units is invalid");return t/r}O(ze,"lengthToRadians");function Hr(t,e){return Ne(ze(t,e))}O(Hr,"lengthToDegrees");function Rr(t){let e=t%360;return e<0&&(e+=360),e}O(Rr,"bearingToAzimuth");function Ne(t){return t%(2*Math.PI)*180/Math.PI}O(Ne,"radiansToDegrees");function Be(t){return t%360*Math.PI/180}O(Be,"degreesToRadians");function Wr(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Ht(ze(t,e),r)}O(Wr,"convertLength");function Ur(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Ct[e];if(!n)throw new Error("invalid original units");const o=Ct[r];if(!o)throw new Error("invalid final units");return t/n*o}O(Ur,"convertArea");function pe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}O(pe,"isNumber");function Vr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}O(Vr,"isObject");function Jr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!pe(e))throw new Error("bbox must only contain numbers")})}O(Jr,"validateBBox");function Kr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}O(Kr,"validateId");var Zr=Object.defineProperty,te=(t,e)=>Zr(t,"name",{value:e,configurable:!0});function Rt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}te(Rt,"getCoord");function Qr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}te(Qr,"getCoords");function Wt(t){if(t.length>1&&pe(t[0])&&pe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Wt(t[0]);throw new Error("coordinates must only contain numbers")}te(Wt,"containsNumber");function Xr(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}te(Xr,"geojsonType");function Yr(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}te(Yr,"featureOf");function xr(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}te(xr,"collectionOf");function en(t){return t.type==="Feature"?t.geometry:t}te(en,"getGeom");function tn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}te(tn,"getType");var rn=Object.defineProperty,nn=(t,e)=>rn(t,"name",{value:e,configurable:!0});function Ut(t,e,r,n={}){const o=Rt(t),i=Be(o[0]),l=Be(o[1]),a=Be(r),u=ze(e,n.units),g=Math.asin(Math.sin(l)*Math.cos(u)+Math.cos(l)*Math.sin(u)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(u)*Math.cos(l),Math.cos(u)-Math.sin(l)*Math.sin(g)),f=Ne(p),d=Ne(g);return De([f,d],n.properties)}nn(Ut,"destination");var on=Ut,ln=Object.defineProperty,A=(t,e)=>ln(t,"name",{value:e,configurable:!0}),an=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Me(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Je(e),o=Je(r);return n.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Me(e,r))return!1;const i=e;let l=r;if(o&&!this.compareCoord(i[0],l[0])){const u=this.fixStartIndex(l,i);if(u)l=u;else return!1}const a=this.compareCoord(i[n],l[n]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[n],l[l.length-(1+n)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,r){let n,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],r[0])){o=i;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,r){return Me(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?qt(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Me(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};A(an,"GeojsonEquality");function Me(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}A(Me,"sameLength");function Je(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}A(Je,"explode");var H=63710088e-1,Vt={centimeters:H*100,centimetres:H*100,degrees:360/(2*Math.PI),feet:H*3.28084,inches:H*39.37,kilometers:H/1e3,kilometres:H/1e3,meters:H,metres:H,miles:H/1609.344,millimeters:H*1e3,millimetres:H*1e3,nauticalmiles:H/1852,radians:1,yards:H*1.0936},Lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function re(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}A(re,"feature");function sn(t,e,r={}){switch(t){case"Point":return rt(e).geometry;case"LineString":return ot(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return Kt(e).geometry;case"MultiLineString":return Jt(e).geometry;case"MultiPolygon":return Zt(e).geometry;default:throw new Error(t+" is invalid")}}A(sn,"geometry");function rt(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!de(t[0])||!de(t[1]))throw new Error("coordinates must contain numbers");return re({type:"Point",coordinates:t},e,r)}A(rt,"point");function un(t,e,r={}){return He(t.map(n=>rt(n,e)),r)}A(un,"points");function nt(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return re({type:"Polygon",coordinates:t},e,r)}A(nt,"polygon");function fn(t,e,r={}){return He(t.map(n=>nt(n,e)),r)}A(fn,"polygons");function ot(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return re({type:"LineString",coordinates:t},e,r)}A(ot,"lineString");function cn(t,e,r={}){return He(t.map(n=>ot(n,e)),r)}A(cn,"lineStrings");function He(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}A(He,"featureCollection");function Jt(t,e,r={}){return re({type:"MultiLineString",coordinates:t},e,r)}A(Jt,"multiLineString");function Kt(t,e,r={}){return re({type:"MultiPoint",coordinates:t},e,r)}A(Kt,"multiPoint");function Zt(t,e,r={}){return re({type:"MultiPolygon",coordinates:t},e,r)}A(Zt,"multiPolygon");function mn(t,e,r={}){return re({type:"GeometryCollection",geometries:t},e,r)}A(mn,"geometryCollection");function gn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}A(gn,"round");function Qt(t,e="kilometers"){const r=Vt[e];if(!r)throw new Error(e+" units is invalid");return t*r}A(Qt,"radiansToLength");function it(t,e="kilometers"){const r=Vt[e];if(!r)throw new Error(e+" units is invalid");return t/r}A(it,"lengthToRadians");function hn(t,e){return lt(it(t,e))}A(hn,"lengthToDegrees");function pn(t){let e=t%360;return e<0&&(e+=360),e}A(pn,"bearingToAzimuth");function lt(t){return t%(2*Math.PI)*180/Math.PI}A(lt,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}A(Oe,"degreesToRadians");function dn(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Qt(it(t,e),r)}A(dn,"convertLength");function _n(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Lt[e];if(!n)throw new Error("invalid original units");const o=Lt[r];if(!o)throw new Error("invalid final units");return t/n*o}A(_n,"convertArea");function de(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}A(de,"isNumber");function yn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}A(yn,"isObject");function bn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!de(e))throw new Error("bbox must only contain numbers")})}A(bn,"validateBBox");function vn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}A(vn,"validateId");var wn=Object.defineProperty,ne=(t,e)=>wn(t,"name",{value:e,configurable:!0});function Ke(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ne(Ke,"getCoord");function kn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ne(kn,"getCoords");function Xt(t){if(t.length>1&&de(t[0])&&de(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Xt(t[0]);throw new Error("coordinates must only contain numbers")}ne(Xt,"containsNumber");function En(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}ne(En,"geojsonType");function Cn(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}ne(Cn,"featureOf");function Ln(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}ne(Ln,"collectionOf");function Pn(t){return t.type==="Feature"?t.geometry:t}ne(Pn,"getGeom");function Mn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ne(Mn,"getType");var On=Object.defineProperty,Yt=(t,e)=>On(t,"name",{value:e,configurable:!0});function at(t,e,r={}){if(r.final===!0)return xt(t,e);const n=Ke(t),o=Ke(e),i=Oe(n[0]),l=Oe(o[0]),a=Oe(n[1]),u=Oe(o[1]),g=Math.sin(l-i)*Math.cos(u),p=Math.cos(a)*Math.sin(u)-Math.sin(a)*Math.cos(u)*Math.cos(l-i);return lt(Math.atan2(g,p))}Yt(at,"bearing");function xt(t,e){let r=at(e,t);return r=(r+180)%360,r}Yt(xt,"calculateFinalBearing");var Pt=at;function An(t){let e,r,n;return{c(){e=gt("svg"),r=gt("polygon"),this.h()},l(o){e=ht(o,"svg",{width:!0,height:!0,xmlns:!0});var i=R(e);r=ht(i,"polygon",{points:!0,fill:!0,transform:!0,class:!0}),R(r).forEach(v),i.forEach(v),this.h()},h(){q(r,"points","15,0 0,30 30,30"),q(r,"fill",t[0]),q(r,"transform",n="rotate("+t[1]+", 15, 15)"),q(r,"class","svelte-vih5bq"),q(e,"width","30"),q(e,"height","30"),q(e,"xmlns","http://www.w3.org/2000/svg")},m(o,i){M(o,e,i),ue(e,r)},p(o,[i]){i&1&&q(r,"fill",o[0]),i&2&&n!==(n="rotate("+o[1]+", 15, 15)")&&q(r,"transform",n)},i:Ae,o:Ae,d(o){o&&v(e)}}}function Fn(t,e,r){let{color:n}=e,{angle:o}=e;return t.$$set=i=>{"color"in i&&r(0,n=i.color),"angle"in i&&r(1,o=i.angle)},[n,o]}class jn extends ve{constructor(e){super(),we(this,e,Fn,An,_e,{color:0,angle:1})}}function Tn(t){let e,r,n,o,i,l,a,u,g;function p(s){t[4](s)}let f={label:"Name"};t[1].jat.movements[t[0]].name!==void 0&&(f.value=t[1].jat.movements[t[0]].name),e=new wr({props:f}),Z.push(()=>x(e,"value",p));function d(s){t[5](s)}let m={label:"Kind",choices:t[2]};t[1].jat.movements[t[0]].kind!==void 0&&(m.value=t[1].jat.movements[t[0]].kind),o=new bt({props:m}),Z.push(()=>x(o,"value",d));function w(s){t[6](s)}let k={label:"Color",choices:t[3]};return t[1].jat.movements[t[0]].color!==void 0&&(k.value=t[1].jat.movements[t[0]].color),a=new bt({props:k}),Z.push(()=>x(a,"value",w)),{c(){F(e.$$.fragment),n=G(),F(o.$$.fragment),l=G(),F(a.$$.fragment)},l(s){j(e.$$.fragment,s),n=N(s),j(o.$$.fragment,s),l=N(s),j(a.$$.fragment,s)},m(s,h){T(e,s,h),M(s,n,h),T(o,s,h),M(s,l,h),T(a,s,h),g=!0},p(s,[h]){const C={};!r&&h&3&&(r=!0,C.value=s[1].jat.movements[s[0]].name,Y(()=>r=!1)),e.$set(C);const P={};!i&&h&3&&(i=!0,P.value=s[1].jat.movements[s[0]].kind,Y(()=>i=!1)),o.$set(P);const S={};!u&&h&3&&(u=!0,S.value=s[1].jat.movements[s[0]].color,Y(()=>u=!1)),a.$set(S)},i(s){g||(b(e.$$.fragment,s),b(o.$$.fragment,s),b(a.$$.fragment,s),g=!0)},o(s){E(e.$$.fragment,s),E(o.$$.fragment,s),E(a.$$.fragment,s),g=!1},d(s){s&&(v(n),v(l)),I(e,s),I(o,s),I(a,s)}}}function In(t,e,r){let n;ge(t,K,p=>r(1,n=p));let{idx:o}=e,i=yt(["cycling-straight","cycling-turn","pedestrian"]),l=yt(["green","amber","red","critical"]);function a(p){t.$$.not_equal(n.jat.movements[o].name,p)&&(n.jat.movements[o].name=p,K.set(n))}function u(p){t.$$.not_equal(n.jat.movements[o].kind,p)&&(n.jat.movements[o].kind=p,K.set(n))}function g(p){t.$$.not_equal(n.jat.movements[o].color,p)&&(n.jat.movements[o].color=p,K.set(n))}return t.$$set=p=>{"idx"in p&&r(0,o=p.idx)},[o,n,i,l,a,u,g]}class Sn extends ve{constructor(e){super(),we(this,e,In,Tn,_e,{idx:0})}}const{window:Bn}=mr;function Mt(t,e,r){const n=t.slice();return n[27]=e[r],n[28]=e,n[29]=r,n}function Ot(t,e,r){const n=t.slice();return n[27]=e[r],n[29]=r,n}function qn(t){let e,r,n,o,i,l;return e=new gr({props:{$$slots:{default:[Nn]},$$scope:{ctx:t}}}),e.$on("click",t[17]),n=new hr({props:{$$slots:{default:[Dn]},$$scope:{ctx:t}}}),n.$on("click",t[9]),i=new Sn({props:{idx:t[0]}}),{c(){F(e.$$.fragment),r=G(),F(n.$$.fragment),o=G(),F(i.$$.fragment)},l(a){j(e.$$.fragment,a),r=N(a),j(n.$$.fragment,a),o=N(a),j(i.$$.fragment,a)},m(a,u){T(e,a,u),M(a,r,u),T(n,a,u),M(a,o,u),T(i,a,u),l=!0},p(a,u){const g={};u[1]&1&&(g.$$scope={dirty:u,ctx:a}),e.$set(g);const p={};u[1]&1&&(p.$$scope={dirty:u,ctx:a}),n.$set(p);const f={};u[0]&1&&(f.idx=a[0]),i.$set(f)},i(a){l||(b(e.$$.fragment,a),b(n.$$.fragment,a),b(i.$$.fragment,a),l=!0)},o(a){E(e.$$.fragment,a),E(n.$$.fragment,a),E(i.$$.fragment,a),l=!1},d(a){a&&(v(r),v(o)),I(e,a),I(n,a),I(i,a)}}}function Gn(t){let e,r,n,o,i,l,a,u,g="Movements",p,f,d;e=new pr({props:{$$slots:{default:[$n]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new _r({}),i=new yr({});let m=t[3]&&At(t),w=Ge(t[2].jat.movements),k=[];for(let s=0;s<w.length;s+=1)k[s]=Ft(Ot(t,w,s));return{c(){F(e.$$.fragment),r=G(),F(n.$$.fragment),o=G(),F(i.$$.fragment),l=G(),m&&m.c(),a=G(),u=W("h3"),u.textContent=g,p=G(),f=W("ol");for(let s=0;s<k.length;s+=1)k[s].c()},l(s){j(e.$$.fragment,s),r=N(s),j(n.$$.fragment,s),o=N(s),j(i.$$.fragment,s),l=N(s),m&&m.l(s),a=N(s),u=U(s,"H3",{"data-svelte-h":!0}),ir(u)!=="svelte-1dc52s8"&&(u.textContent=g),p=N(s),f=U(s,"OL",{});var h=R(f);for(let C=0;C<k.length;C+=1)k[C].l(h);h.forEach(v)},m(s,h){T(e,s,h),M(s,r,h),T(n,s,h),M(s,o,h),T(i,s,h),M(s,l,h),m&&m.m(s,h),M(s,a,h),M(s,u,h),M(s,p,h),M(s,f,h);for(let C=0;C<k.length;C+=1)k[C]&&k[C].m(f,null);d=!0},p(s,h){const C={};if(h[1]&1&&(C.$$scope={dirty:h,ctx:s}),e.$set(C),s[3]?m?(m.p(s,h),h[0]&8&&b(m,1)):(m=At(s),m.c(),b(m,1),m.m(a.parentNode,a)):m&&(ke(),E(m,1,1,()=>{m=null}),Ee()),h[0]&70){w=Ge(s[2].jat.movements);let P;for(P=0;P<w.length;P+=1){const S=Ot(s,w,P);k[P]?k[P].p(S,h):(k[P]=Ft(S),k[P].c(),k[P].m(f,null))}for(;P<k.length;P+=1)k[P].d(1);k.length=w.length}},i(s){d||(b(e.$$.fragment,s),b(n.$$.fragment,s),b(i.$$.fragment,s),b(m),d=!0)},o(s){E(e.$$.fragment,s),E(n.$$.fragment,s),E(i.$$.fragment,s),E(m),d=!1},d(s){s&&(v(r),v(o),v(l),v(a),v(u),v(p),v(f)),I(e,s),I(n,s),I(i,s),m&&m.d(s),Bt(k,s)}}}function Nn(t){let e;return{c(){e=ye("Save")},l(r){e=be(r,"Save")},m(r,n){M(r,e,n)},d(r){r&&v(e)}}}function Dn(t){let e;return{c(){e=ye("Delete")},l(r){e=be(r,"Delete")},m(r,n){M(r,e,n)},d(r){r&&v(e)}}}function $n(t){let e;return{c(){e=ye("Zoom to fit")},l(r){e=be(r,"Zoom to fit")},m(r,n){M(r,e,n)},d(r){r&&v(e)}}}function At(t){let e,r,n;function o(l){t[13](l)}let i={map:t[3]};return t[4]!==void 0&&(i.enabled=t[4]),e=new br({props:i}),Z.push(()=>x(e,"enabled",o)),{c(){F(e.$$.fragment)},l(l){j(e.$$.fragment,l)},m(l,a){T(e,l,a),n=!0},p(l,a){const u={};a[0]&8&&(u.map=l[3]),!r&&a[0]&16&&(r=!0,u.enabled=l[4],Y(()=>r=!1)),e.$set(u)},i(l){n||(b(e.$$.fragment,l),n=!0)},o(l){E(e.$$.fragment,l),n=!1},d(l){I(e,l)}}}function Ft(t){let e,r,n=(t[27].name||"Unnamed movement")+"",o,i,l,a;function u(){return t[14](t[29])}function g(){return t[15](t[29])}return{c(){e=W("li"),r=W("a"),o=ye(n),i=G(),this.h()},l(p){e=U(p,"LI",{});var f=R(e);r=U(f,"A",{href:!0});var d=R(r);o=be(d,n),d.forEach(v),i=N(f),f.forEach(v),this.h()},h(){q(r,"href","#")},m(p,f){M(p,e,f),ue(e,r),ue(r,o),ue(e,i),l||(a=[Se(r,"click",u),Se(r,"mouseenter",g),Se(r,"mouseleave",t[16])],l=!0)},p(p,f){t=p,f[0]&4&&n!==(n=(t[27].name||"Unnamed movement")+"")&&xe(o,n)},d(p){p&&v(e),l=!1,lr(a)}}}function zn(t){let e,r;return{c(){e=W("span"),this.h()},l(n){e=U(n,"SPAN",{class:!0,style:!0}),R(e).forEach(v),this.h()},h(){q(e,"class","dot svelte-1kvjd2"),q(e,"style",r=`background-color: ${fe[t[27].color].background}`)},m(n,o){M(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${fe[n[27].color].background}`)&&q(e,"style",r)},d(n){n&&v(e)}}}function Hn(t){let e,r;return e=new jn({props:{color:fe[t[27].color].background,angle:Pt(t[27].point1,t[27].point2)}}),{c(){F(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,o){T(e,n,o),r=!0},p(n,o){const i={};o[0]&4&&(i.color=fe[n[27].color].background),o[0]&4&&(i.angle=Pt(n[27].point1,n[27].point2)),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function Rn(t){let e,r;return{c(){e=W("span"),this.h()},l(n){e=U(n,"SPAN",{class:!0,style:!0}),R(e).forEach(v),this.h()},h(){q(e,"class","dot svelte-1kvjd2"),q(e,"style",r=`background-color: ${fe[t[27].color].background}`)},m(n,o){M(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${fe[n[27].color].background}`)&&q(e,"style",r)},i:Ae,o:Ae,d(n){n&&v(e)}}}function Wn(t){let e,r,n,o;const i=[Rn,Hn],l=[];function a(u,g){return u[27].kind=="pedestrian"?0:1}return e=a(t),r=l[e]=i[e](t),{c(){r.c(),n=qe()},l(u){r.l(u),n=qe()},m(u,g){l[e].m(u,g),M(u,n,g),o=!0},p(u,g){let p=e;e=a(u),e===p?l[e].p(u,g):(ke(),E(l[p],1,1,()=>{l[p]=null}),Ee(),r=l[e],r?r.p(u,g):(r=l[e]=i[e](u),r.c()),b(r,1),r.m(n.parentNode,n))},i(u){o||(b(r),o=!0)},o(u){E(r),o=!1},d(u){u&&v(n),l[e].d(u)}}}function jt(t){let e,r,n,o,i,l;function a(m){t[18](m,t[27])}function u(){return t[19](t[29])}let g={draggable:!0,$$slots:{default:[zn]},$$scope:{ctx:t}};t[27].point1!==void 0&&(g.lngLat=t[27].point1),e=new _t({props:g}),Z.push(()=>x(e,"lngLat",a)),e.$on("dragend",u);function p(m){t[20](m,t[27])}function f(){return t[21](t[29])}let d={draggable:!0,$$slots:{default:[Wn]},$$scope:{ctx:t}};return t[27].point2!==void 0&&(d.lngLat=t[27].point2),o=new _t({props:d}),Z.push(()=>x(o,"lngLat",p)),o.$on("dragend",f),{c(){F(e.$$.fragment),n=G(),F(o.$$.fragment)},l(m){j(e.$$.fragment,m),n=N(m),j(o.$$.fragment,m)},m(m,w){T(e,m,w),M(m,n,w),T(o,m,w),l=!0},p(m,w){t=m;const k={};w[0]&4|w[1]&1&&(k.$$scope={dirty:w,ctx:t}),!r&&w[0]&4&&(r=!0,k.lngLat=t[27].point1,Y(()=>r=!1)),e.$set(k);const s={};w[0]&4|w[1]&1&&(s.$$scope={dirty:w,ctx:t}),!i&&w[0]&4&&(i=!0,s.lngLat=t[27].point2,Y(()=>i=!1)),o.$set(s)},i(m){l||(b(e.$$.fragment,m),b(o.$$.fragment,m),l=!0)},o(m){E(e.$$.fragment,m),E(o.$$.fragment,m),l=!1},d(m){m&&v(n),I(e,m),I(o,m)}}}function Un(t){let e=(t[26].name||"Untitled movement")+"",r;return{c(){r=ye(e)},l(n){r=be(n,e)},m(n,o){M(n,r,o)},p(n,o){o[0]&67108864&&e!==(e=(n[26].name||"Untitled movement")+"")&&xe(r,e)},d(n){n&&v(r)}}}function Vn(t){let e,r;return e=new Gt({props:{$$slots:{default:[Un,({props:n})=>({26:n}),({props:n})=>[n?67108864:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,o){T(e,n,o),r=!0},p(n,o){const i={};o[0]&67108864|o[1]&1&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function Jn(t){let e=(t[26].name||"Untitled movement")+"",r;return{c(){r=ye(e)},l(n){r=be(n,e)},m(n,o){M(n,r,o)},p(n,o){o[0]&67108864&&e!==(e=(n[26].name||"Untitled movement")+"")&&xe(r,e)},d(n){n&&v(r)}}}function Kn(t){let e,r;return e=new Gt({props:{$$slots:{default:[Jn,({props:n})=>({26:n}),({props:n})=>[n?67108864:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,o){T(e,n,o),r=!0},p(n,o){const i={};o[0]&67108864|o[1]&1&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function Zn(t){let e,r,n,o;return e=new Ue({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":dt(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Vn]},$$scope:{ctx:t}}}),e.$on("click",t[7]),n=new Ue({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":dt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Kn]},$$scope:{ctx:t}}}),n.$on("click",t[7]),{c(){F(e.$$.fragment),r=G(),F(n.$$.fragment)},l(i){j(e.$$.fragment,i),r=N(i),j(n.$$.fragment,i)},m(i,l){T(e,i,l),M(i,r,l),T(n,i,l),o=!0},p(i,l){const a={};l[1]&1&&(a.$$scope={dirty:l,ctx:i}),e.$set(a);const u={};l[1]&1&&(u.$$scope={dirty:l,ctx:i}),n.$set(u)},i(i){o||(b(e.$$.fragment,i),b(n.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(n.$$.fragment,i),o=!1},d(i){i&&v(r),I(e,i),I(n,i)}}}function Qn(t){let e,r;return e=new Ue({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){F(e.$$.fragment)},l(n){j(e.$$.fragment,n)},m(n,o){T(e,n,o),r=!0},p:Ae,i(n){r||(b(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){I(e,n)}}}function Xn(t){let e,r,n,o,i,l,a,u=Ge(t[2].jat.movements),g=[];for(let f=0;f<u.length;f+=1)g[f]=jt(Mt(t,u,f));const p=f=>E(g[f],1,1,()=>{g[f]=null});return r=new pt({props:{data:t[8](t[2].jat.movements),$$slots:{default:[Zn]},$$scope:{ctx:t}}}),o=new pt({props:{data:t[5],$$slots:{default:[Qn]},$$scope:{ctx:t}}}),l=new vr({props:{map:t[3]}}),{c(){for(let f=0;f<g.length;f+=1)g[f].c();e=G(),F(r.$$.fragment),n=G(),F(o.$$.fragment),i=G(),F(l.$$.fragment)},l(f){for(let d=0;d<g.length;d+=1)g[d].l(f);e=N(f),j(r.$$.fragment,f),n=N(f),j(o.$$.fragment,f),i=N(f),j(l.$$.fragment,f)},m(f,d){for(let m=0;m<g.length;m+=1)g[m]&&g[m].m(f,d);M(f,e,d),T(r,f,d),M(f,n,d),T(o,f,d),M(f,i,d),T(l,f,d),a=!0},p(f,d){if(d[0]&68){u=Ge(f[2].jat.movements);let s;for(s=0;s<u.length;s+=1){const h=Mt(f,u,s);g[s]?(g[s].p(h,d),b(g[s],1)):(g[s]=jt(h),g[s].c(),b(g[s],1),g[s].m(e.parentNode,e))}for(ke(),s=u.length;s<g.length;s+=1)p(s);Ee()}const m={};d[0]&4&&(m.data=f[8](f[2].jat.movements)),d[1]&1&&(m.$$scope={dirty:d,ctx:f}),r.$set(m);const w={};d[0]&32&&(w.data=f[5]),d[1]&1&&(w.$$scope={dirty:d,ctx:f}),o.$set(w);const k={};d[0]&8&&(k.map=f[3]),l.$set(k)},i(f){if(!a){for(let d=0;d<u.length;d+=1)b(g[d]);b(r.$$.fragment,f),b(o.$$.fragment,f),b(l.$$.fragment,f),a=!0}},o(f){g=g.filter(Boolean);for(let d=0;d<g.length;d+=1)E(g[d]);E(r.$$.fragment,f),E(o.$$.fragment,f),E(l.$$.fragment,f),a=!1},d(f){f&&(v(e),v(n),v(i)),Bt(g,f),I(r,f),I(o,f),I(l,f)}}}function Yn(t){let e,r,n,o,i,l,a,u,g,p,f;const d=[Gn,qn],m=[];function w(h,C){return h[0]==null?0:1}n=w(t),o=m[n]=d[n](t);function k(h){t[22](h)}let s={$$slots:{default:[Xn]},$$scope:{ctx:t}};return t[3]!==void 0&&(s.map=t[3]),a=new cr({props:s}),Z.push(()=>x(a,"map",k)),{c(){e=W("div"),r=W("div"),o.c(),i=G(),l=W("div"),F(a.$$.fragment),this.h()},l(h){e=U(h,"DIV",{style:!0});var C=R(e);r=U(C,"DIV",{style:!0});var P=R(r);o.l(P),P.forEach(v),i=N(C),l=U(C,"DIV",{style:!0});var S=R(l);j(a.$$.fragment,S),S.forEach(v),C.forEach(v),this.h()},h(){se(r,"width","30%"),se(r,"overflow-y","scroll"),se(r,"padding","10px"),se(l,"position","relative"),se(l,"width","100%"),se(e,"display","flex"),se(e,"height","80vh")},m(h,C){M(h,e,C),ue(e,r),m[n].m(r,null),ue(e,i),ue(e,l),T(a,l,null),g=!0,p||(f=Se(Bn,"keydown",t[11]),p=!0)},p(h,C){let P=n;n=w(h),n===P?m[n].p(h,C):(ke(),E(m[P],1,1,()=>{m[P]=null}),Ee(),o=m[n],o?o.p(h,C):(o=m[n]=d[n](h),o.c()),b(o,1),o.m(r,null));const S={};C[0]&44|C[1]&1&&(S.$$scope={dirty:C,ctx:h}),!u&&C[0]&8&&(u=!0,S.map=h[3],Y(()=>u=!1)),a.$set(S)},i(h){g||(b(o),b(a.$$.fragment,h),g=!0)},o(h){E(o),E(a.$$.fragment,h),g=!1},d(h){h&&v(e),m[n].d(),I(a),p=!1,f()}}}function xn(t,e,r){let n,o;ge(t,K,y=>r(2,o=y));let i,l=null,a=null,u=!1;function g(y,$,Ce){let je={type:"FeatureCollection",features:[]},L=$??Ce;return L!=null&&je.features.push(w(y.jat.movements[L],L)),je}function p(y){r(0,l=y),r(1,a=null)}function f(y){if(!u){for(let $ of i.queryRenderedFeatures(y.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(l!=null){r(0,l=null);return}St(K,o.jat.movements=[...o.jat.movements,{point1:y.lngLat.toArray(),point2:on(y.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",color:"green",name:"",notes:""}],o),r(0,l=o.jat.movements.length-1),r(1,a=null)}}function d(y){p(y.detail.features[0].id)}Tt(()=>{i.on("click",f),s(!1)}),It(()=>{i.off("click",f)});function m(y){return{type:"FeatureCollection",features:y.map(($,Ce)=>w($,Ce))}}function w(y,$){return{type:"Feature",id:$,properties:{name:y.name,kind:y.kind,color:fe[y.color].background},geometry:{type:"LineString",coordinates:[y.point1,y.point2]}}}function k(){window.confirm("Delete this movement?")&&(o.jat.movements.splice(l,1),K.set(o),r(0,l=null))}function s(y){o.jat.movements.length>0&&i.fitBounds(dr(m(o.jat.movements)),{padding:20,animate:y})}function h(y){l!=null&&y.key=="Escape"?(y.stopPropagation(),r(0,l=null)):l!=null&&y.key=="Delete"&&k()}const C=()=>s(!0);function P(y){u=y,r(4,u)}const S=y=>p(y),oe=y=>r(1,a=y),ie=()=>r(1,a=null),D=()=>r(0,l=null);function Q(y,$){t.$$.not_equal($.point1,y)&&($.point1=y,K.set(o))}const B=y=>p(y);function le(y,$){t.$$.not_equal($.point2,y)&&($.point2=y,K.set(o))}const _=y=>p(y);function Fe(y){i=y,r(3,i)}return t.$$.update=()=>{t.$$.dirty[0]&7&&r(5,n=g(o,l,a))},[l,a,o,i,u,n,p,d,m,k,s,h,C,P,S,oe,ie,D,Q,B,le,_,Fe]}class ho extends ve{constructor(e){super(),we(this,e,xn,Yn,_e,{},null,[-1,-1])}}export{ho as component};
