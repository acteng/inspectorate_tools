import{s as Q,A as O,a as N,g as S,i as b,B as V,f as $,k as X,N as he,t as M,d as T,j as J,P as ve,e as j,c as F,b as G,v as H,h as E,O as we,r as Ce,p as De,n as U,E as oe,q as be}from"../chunks/scheduler.DUXu1fc4.js";import{S as Z,i as x,f as R,c as w,a as C,m as D,t as h,g as K,b as v,e as Y,d as A}from"../chunks/index.Cw3Z3Eqf.js";import{e as z}from"../chunks/each.CBIw2Sej.js";import{p as Ae}from"../chunks/index.1D6E3q4g.js";import{S as Be,W as Ee}from"../chunks/WarningButton.M-LXQQTX.js";import{S as ce}from"../chunks/Select.CZexGjXH.js";import{T as Ne}from"../chunks/TextArea.CwUteWfG.js";import{T as Se}from"../chunks/TextInput.BwN4dbUN.js";import{s as L}from"../chunks/data.DJtq5Z8k.js";import{Y as Le}from"../chunks/YesNo.a4h_XayN.js";import{D as Me}from"../chunks/DefaultButton.BHEQKUQS.js";import{D as Te}from"../chunks/DraggablePin.BRMZNIX3.js";import{M as Pe,G as We}from"../chunks/MapLibreMap.B3Y5dvyS.js";import{C as qe}from"../chunks/CircleLayer.DpgBX6Lr.js";function fe(i){let t,n;return t=new Be({props:{$$slots:{default:[je]},$$scope:{ctx:i}}}),t.$on("click",i[4]),{c(){w(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,s){D(t,e,s),n=!0},p(e,s){const o={};s&2050&&(o.$$scope={dirty:s,ctx:e}),t.$set(o)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){v(t.$$.fragment,e),n=!1},d(e){A(t,e)}}}function je(i){let t,n;return{c(){t=M("Use lookup: "),n=M(i[1])},l(e){t=T(e,"Use lookup: "),n=T(e,i[1])},m(e,s){b(e,t,s),b(e,n,s)},p(e,s){s&2&&J(n,e[1])},d(e){e&&($(t),$(n))}}}function Fe(i){let t,n,e,s,o,u,a,l,r,m,p,d,_,f,B,W;function g(c){i[5](c)}let y={label:"Critical Issue",emptyOption:!0,choices:i[3]};i[2].criticalIssues[i[0]].criticalIssue!==void 0&&(y.value=i[2].criticalIssues[i[0]].criticalIssue),t=new ce({props:y}),O.push(()=>R(t,"value",g));function q(c){i[6](c)}let P={label:"Stage",emptyOption:!0,choices:Ae(["Existing","Design"])};i[2].criticalIssues[i[0]].stage!==void 0&&(P.value=i[2].criticalIssues[i[0]].stage),s=new ce({props:P}),O.push(()=>R(s,"value",q));function Ie(c){i[7](c)}let ee={label:"Location Name"};i[2].criticalIssues[i[0]].locationName!==void 0&&(ee.value=i[2].criticalIssues[i[0]].locationName),a=new Se({props:ee}),O.push(()=>R(a,"value",Ie));let I=i[1]&&i[1]!="Loading"&&i[1]!=i[2].criticalIssues[i[0]].locationName&&fe(i);function ke(c){i[8](c)}let te={label:"Resolved by Design"};i[2].criticalIssues[i[0]].resolved!==void 0&&(te.value=i[2].criticalIssues[i[0]].resolved),p=new Le({props:te}),O.push(()=>R(p,"value",ke));function ye(c){i[9](c)}let ie={label:"Commentary & Feedback"};return i[2].criticalIssues[i[0]].notes!==void 0&&(ie.value=i[2].criticalIssues[i[0]].notes),f=new Ne({props:ie}),O.push(()=>R(f,"value",ye)),{c(){w(t.$$.fragment),e=N(),w(s.$$.fragment),u=N(),w(a.$$.fragment),r=N(),I&&I.c(),m=N(),w(p.$$.fragment),_=N(),w(f.$$.fragment)},l(c){C(t.$$.fragment,c),e=S(c),C(s.$$.fragment,c),u=S(c),C(a.$$.fragment,c),r=S(c),I&&I.l(c),m=S(c),C(p.$$.fragment,c),_=S(c),C(f.$$.fragment,c)},m(c,k){D(t,c,k),b(c,e,k),D(s,c,k),b(c,u,k),D(a,c,k),b(c,r,k),I&&I.m(c,k),b(c,m,k),D(p,c,k),b(c,_,k),D(f,c,k),W=!0},p(c,[k]){const ne={};!n&&k&5&&(n=!0,ne.value=c[2].criticalIssues[c[0]].criticalIssue,V(()=>n=!1)),t.$set(ne);const se={};!o&&k&5&&(o=!0,se.value=c[2].criticalIssues[c[0]].stage,V(()=>o=!1)),s.$set(se);const ae={};!l&&k&5&&(l=!0,ae.value=c[2].criticalIssues[c[0]].locationName,V(()=>l=!1)),a.$set(ae),c[1]&&c[1]!="Loading"&&c[1]!=c[2].criticalIssues[c[0]].locationName?I?(I.p(c,k),k&7&&h(I,1)):(I=fe(c),I.c(),h(I,1),I.m(m.parentNode,m)):I&&(K(),v(I,1,1,()=>{I=null}),Y());const le={};!d&&k&5&&(d=!0,le.value=c[2].criticalIssues[c[0]].resolved,V(()=>d=!1)),p.$set(le);const re={};!B&&k&5&&(B=!0,re.value=c[2].criticalIssues[c[0]].notes,V(()=>B=!1)),f.$set(re)},i(c){W||(h(t.$$.fragment,c),h(s.$$.fragment,c),h(a.$$.fragment,c),h(I),h(p.$$.fragment,c),h(f.$$.fragment,c),W=!0)},o(c){v(t.$$.fragment,c),v(s.$$.fragment,c),v(a.$$.fragment,c),v(I),v(p.$$.fragment,c),v(f.$$.fragment,c),W=!1},d(c){c&&($(e),$(u),$(r),$(m),$(_)),A(t,c),A(s,c),A(a,c),I&&I.d(c),A(p,c),A(f,c)}}}function Oe(i,t,n){let e;X(i,L,f=>n(2,e=f));let{idx:s}=t,o=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],u="Loading";he(async()=>{await a(e.criticalIssues[s].point)});async function a(f){let B=`https://nominatim.openstreetmap.org/reverse?lon=${f[0]}&lat=${f[1]}&format=json`;try{let g=await(await fetch(B)).json();n(1,u=g.address.road??g.display_name)}catch(W){return console.log(`Location lookup failed: ${W}`),""}}function l(){ve(L,e.criticalIssues[s].locationName=u,e)}function r(f){i.$$.not_equal(e.criticalIssues[s].criticalIssue,f)&&(e.criticalIssues[s].criticalIssue=f,L.set(e))}function m(f){i.$$.not_equal(e.criticalIssues[s].stage,f)&&(e.criticalIssues[s].stage=f,L.set(e))}function p(f){i.$$.not_equal(e.criticalIssues[s].locationName,f)&&(e.criticalIssues[s].locationName=f,L.set(e))}function d(f){i.$$.not_equal(e.criticalIssues[s].resolved,f)&&(e.criticalIssues[s].resolved=f,L.set(e))}function _(f){i.$$.not_equal(e.criticalIssues[s].notes,f)&&(e.criticalIssues[s].notes=f,L.set(e))}return i.$$set=f=>{"idx"in f&&n(0,s=f.idx)},[s,u,e,o,l,r,m,p,d,_]}class Ve extends Z{constructor(t){super(),x(this,t,Oe,Fe,Q,{idx:0})}}function ue(i,t,n){const e=i.slice();return e[11]=t[n],e[12]=t,e[13]=n,e}function Re(i){let t,n,e,s,o,u,a,l,r,m;return o=new Me({props:{$$slots:{default:[He]},$$scope:{ctx:i}}}),o.$on("click",i[5]),a=new Ee({props:{$$slots:{default:[Je]},$$scope:{ctx:i}}}),a.$on("click",i[4]),r=new Ve({props:{idx:i[1]}}),{c(){t=j("p"),n=M("Editing "),e=M(i[1]),s=N(),w(o.$$.fragment),u=N(),w(a.$$.fragment),l=N(),w(r.$$.fragment)},l(p){t=F(p,"P",{});var d=G(t);n=T(d,"Editing "),e=T(d,i[1]),d.forEach($),s=S(p),C(o.$$.fragment,p),u=S(p),C(a.$$.fragment,p),l=S(p),C(r.$$.fragment,p)},m(p,d){b(p,t,d),E(t,n),E(t,e),b(p,s,d),D(o,p,d),b(p,u,d),D(a,p,d),b(p,l,d),D(r,p,d),m=!0},p(p,d){(!m||d&2)&&J(e,p[1]);const _={};d&16384&&(_.$$scope={dirty:d,ctx:p}),o.$set(_);const f={};d&16384&&(f.$$scope={dirty:d,ctx:p}),a.$set(f);const B={};d&2&&(B.idx=p[1]),r.$set(B)},i(p){m||(h(o.$$.fragment,p),h(a.$$.fragment,p),h(r.$$.fragment,p),m=!0)},o(p){v(o.$$.fragment,p),v(a.$$.fragment,p),v(r.$$.fragment,p),m=!1},d(p){p&&($(t),$(s),$(u),$(l)),A(o,p),A(a,p),A(r,p)}}}function Ge(i){let t,n="Click the map to add a pin, or click a pin to fill out data";return{c(){t=j("p"),t.textContent=n},l(e){t=F(e,"P",{"data-svelte-h":!0}),De(t)!=="svelte-1rxcdnm"&&(t.textContent=n)},m(e,s){b(e,t,s)},p:U,i:U,o:U,d(e){e&&$(t)}}}function He(i){let t;return{c(){t=M("Save")},l(n){t=T(n,"Save")},m(n,e){b(n,t,e)},d(n){n&&$(t)}}}function Je(i){let t;return{c(){t=M("Delete")},l(n){t=T(n,"Delete")},m(n,e){b(n,t,e)},d(n){n&&$(t)}}}function pe(i){let t;return{c(){t=j("div"),this.h()},l(n){t=F(n,"DIV",{class:!0}),G(t).forEach($),this.h()},h(){Ce(t,"class","block-map svelte-13rr2mh")},m(n,e){b(n,t,e)},d(n){n&&$(t)}}}function me(i){let t,n,e;function s(l){i[6](l,i[11])}function o(){return i[7](i[13])}function u(){return i[8](i[13])}let a={map:i[0]};return i[11].point!==void 0&&(a.position=i[11].point),t=new Te({props:a}),O.push(()=>R(t,"position",s)),t.$on("click",o),t.$on("dragEnd",u),{c(){w(t.$$.fragment)},l(l){C(t.$$.fragment,l)},m(l,r){D(t,l,r),e=!0},p(l,r){i=l;const m={};r&1&&(m.map=i[0]),!n&&r&4&&(n=!0,m.position=i[11].point,V(()=>n=!1)),t.$set(m)},i(l){e||(h(t.$$.fragment,l),e=!0)},o(l){v(t.$$.fragment,l),e=!1},d(l){A(t,l)}}}function de(i){let t,n;return t=new We({props:{data:_e(i[2].criticalIssues[i[1]].point),$$slots:{default:[Ue]},$$scope:{ctx:i}}}),{c(){w(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,s){D(t,e,s),n=!0},p(e,s){const o={};s&6&&(o.data=_e(e[2].criticalIssues[e[1]].point)),s&16384&&(o.$$scope={dirty:s,ctx:e}),t.$set(o)},i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){v(t.$$.fragment,e),n=!1},d(e){A(t,e)}}}function Ue(i){let t,n;return t=new qe({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){w(t.$$.fragment)},l(e){C(t.$$.fragment,e)},m(e,s){D(t,e,s),n=!0},p:U,i(e){n||(h(t.$$.fragment,e),n=!0)},o(e){v(t.$$.fragment,e),n=!1},d(e){A(t,e)}}}function Ke(i){let t,n,e,s=z(i[2].criticalIssues),o=[];for(let l=0;l<s.length;l+=1)o[l]=me(ue(i,s,l));const u=l=>v(o[l],1,1,()=>{o[l]=null});let a=i[1]!=null&&de(i);return{c(){for(let l=0;l<o.length;l+=1)o[l].c();t=N(),a&&a.c(),n=oe()},l(l){for(let r=0;r<o.length;r+=1)o[r].l(l);t=S(l),a&&a.l(l),n=oe()},m(l,r){for(let m=0;m<o.length;m+=1)o[m]&&o[m].m(l,r);b(l,t,r),a&&a.m(l,r),b(l,n,r),e=!0},p(l,r){if(r&13){s=z(l[2].criticalIssues);let m;for(m=0;m<s.length;m+=1){const p=ue(l,s,m);o[m]?(o[m].p(p,r),h(o[m],1)):(o[m]=me(p),o[m].c(),h(o[m],1),o[m].m(t.parentNode,t))}for(K(),m=s.length;m<o.length;m+=1)u(m);Y()}l[1]!=null?a?(a.p(l,r),r&2&&h(a,1)):(a=de(l),a.c(),h(a,1),a.m(n.parentNode,n)):a&&(K(),v(a,1,1,()=>{a=null}),Y())},i(l){if(!e){for(let r=0;r<s.length;r+=1)h(o[r]);h(a),e=!0}},o(l){o=o.filter(Boolean);for(let r=0;r<o.length;r+=1)v(o[r]);v(a),e=!1},d(l){l&&($(t),$(n)),be(o,l),a&&a.d(l)}}}function Ye(i){let t,n,e,s,o,u,a,l,r,m;const p=[Ge,Re],d=[];function _(g,y){return g[1]==null?0:1}e=_(i),s=d[e]=p[e](i);let f=i[1]!=null&&pe();function B(g){i[9](g)}let W={$$slots:{default:[Ke]},$$scope:{ctx:i}};return i[0]!==void 0&&(W.map=i[0]),l=new Pe({props:W}),O.push(()=>R(l,"map",B)),{c(){t=j("div"),n=j("div"),s.c(),o=N(),u=j("div"),f&&f.c(),a=N(),w(l.$$.fragment),this.h()},l(g){t=F(g,"DIV",{style:!0});var y=G(t);n=F(y,"DIV",{style:!0});var q=G(n);s.l(q),q.forEach($),o=S(y),u=F(y,"DIV",{style:!0});var P=G(u);f&&f.l(P),a=S(P),C(l.$$.fragment,P),P.forEach($),y.forEach($),this.h()},h(){H(n,"width","30%"),H(u,"position","relative"),H(u,"width","70%"),H(u,"height","600px"),H(t,"display","flex")},m(g,y){b(g,t,y),E(t,n),d[e].m(n,null),E(t,o),E(t,u),f&&f.m(u,null),E(u,a),D(l,u,null),m=!0},p(g,[y]){let q=e;e=_(g),e===q?d[e].p(g,y):(K(),v(d[q],1,1,()=>{d[q]=null}),Y(),s=d[e],s?s.p(g,y):(s=d[e]=p[e](g),s.c()),h(s,1),s.m(n,null)),g[1]!=null?f||(f=pe(),f.c(),f.m(u,a)):f&&(f.d(1),f=null);const P={};y&16391&&(P.$$scope={dirty:y,ctx:g}),!r&&y&1&&(r=!0,P.map=g[0],V(()=>r=!1)),l.$set(P)},i(g){m||(h(s),h(l.$$.fragment,g),m=!0)},o(g){v(s),v(l.$$.fragment,g),m=!1},d(g){g&&$(t),d[e].d(),f&&f.d(),A(l)}}}function _e(i){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:i}}}function ze(i,t,n){let e;X(i,L,f=>n(2,e=f));let s,o=null;function u(f){n(1,o=f)}function a(f){ve(L,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:f.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),n(1,o=e.criticalIssues.length-1)}he(()=>{s.on("click",a)}),we(()=>{s.off("click",a)});function l(){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(o,1),L.set(e),n(1,o=null))}const r=()=>n(1,o=null);function m(f,B){i.$$.not_equal(B.point,f)&&(B.point=f,L.set(e))}const p=f=>u(f),d=f=>u(f);function _(f){s=f,n(0,s)}return[s,o,e,u,l,r,m,p,d,_]}class Qe extends Z{constructor(t){super(),x(this,t,ze,Ye,Q,{})}}function $e(i,t,n){const e=i.slice();return e[1]=t[n],e}function ge(i){let t,n,e=i[1].criticalIssue+"",s,o,u=i[1].stage+"",a,l,r=i[1].locationName+"",m,p;return{c(){t=j("li"),n=M("Critical issue: type="),s=M(e),o=M(", stage="),a=M(u),l=M(", at "),m=M(r),p=N()},l(d){t=F(d,"LI",{});var _=G(t);n=T(_,"Critical issue: type="),s=T(_,e),o=T(_,", stage="),a=T(_,u),l=T(_,", at "),m=T(_,r),p=S(_),_.forEach($)},m(d,_){b(d,t,_),E(t,n),E(t,s),E(t,o),E(t,a),E(t,l),E(t,m),E(t,p)},p(d,_){_&1&&e!==(e=d[1].criticalIssue+"")&&J(s,e),_&1&&u!==(u=d[1].stage+"")&&J(a,u),_&1&&r!==(r=d[1].locationName+"")&&J(m,r)},d(d){d&&$(t)}}}function Xe(i){let t,n,e,s,o=z(i[0].criticalIssues),u=[];for(let a=0;a<o.length;a+=1)u[a]=ge($e(i,o,a));return e=new Qe({}),{c(){t=j("ol");for(let a=0;a<u.length;a+=1)u[a].c();n=N(),w(e.$$.fragment)},l(a){t=F(a,"OL",{});var l=G(t);for(let r=0;r<u.length;r+=1)u[r].l(l);l.forEach($),n=S(a),C(e.$$.fragment,a)},m(a,l){b(a,t,l);for(let r=0;r<u.length;r+=1)u[r]&&u[r].m(t,null);b(a,n,l),D(e,a,l),s=!0},p(a,[l]){if(l&1){o=z(a[0].criticalIssues);let r;for(r=0;r<o.length;r+=1){const m=$e(a,o,r);u[r]?u[r].p(m,l):(u[r]=ge(m),u[r].c(),u[r].m(t,null))}for(;r<u.length;r+=1)u[r].d(1);u.length=o.length}},i(a){s||(h(e.$$.fragment,a),s=!0)},o(a){v(e.$$.fragment,a),s=!1},d(a){a&&($(t),$(n)),be(u,a),A(e,a)}}}function Ze(i,t,n){let e;return X(i,L,s=>n(0,e=s)),[e]}class mt extends Z{constructor(t){super(),x(this,t,Ze,Xe,Q,{})}}export{mt as component};
