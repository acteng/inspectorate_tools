import{s as z,a7 as Le,U as Z,a8 as ve,A as q,a as L,g as B,i as b,B as j,f as _,k as x,t as P,d as W,j as ke,M as ee,e as V,c as G,b as U,v as R,h as O,r as Be,p as Se,n as K,E as ce,q as we}from"../chunks/scheduler.CYx2ttP3.js";import{S as Q,i as X,f as F,c as w,a as I,m as y,t as d,g as H,b as g,e as J,d as C}from"../chunks/index.Bh3RlrZK.js";import{e as Y}from"../chunks/each.D_qLyk6y.js";import{p as Ne}from"../chunks/index.BsIekoKO.js";import{S as Ie,W as ye}from"../chunks/WarningButton.YKTv_CHU.js";import{S as fe}from"../chunks/Select.gMiMMceA.js";import{T as Me}from"../chunks/TextArea.CT4fIbcj.js";import{T as Te}from"../chunks/TextInput.DkOyKEPL.js";import{s as E}from"../chunks/data.CTtsnZNh.js";import{Y as Pe}from"../chunks/YesNo.BdYDPFUC.js";import{D as We}from"../chunks/DefaultButton.CxPf0z-2.js";import{m as ue,M as qe,G as je,C as Fe}from"../chunks/MapLibreMap.FPSPdrIQ.js";import"../chunks/paths.BBSqk5PS.js";import{C as Oe}from"../chunks/CollapsibleCard.ZXncRbDC.js";/* empty css                                                    */function Ve(n,t,s){let e=Le(),{map:i}=t,{position:l}=t,c=null;return Z(()=>{c=new ue.Marker({draggable:!0}).setLngLat(new ue.LngLat(l[0],l[1])).addTo(i),c.on("dragstart",()=>{i.getCanvas().style.cursor="grabbing"}),c.on("drag",()=>{s(0,l=c.getLngLat().toArray())}),c.on("dragend",()=>{i.getCanvas().style.cursor="inherit",e("dragEnd")}),c.getElement().addEventListener("click",a=>{a.stopPropagation(),e("click")})}),ve(()=>{c==null||c.remove()}),n.$$set=a=>{"map"in a&&s(1,i=a.map),"position"in a&&s(0,l=a.position)},[l,i]}class Ge extends Q{constructor(t){super(),X(this,t,Ve,null,z,{map:1,position:0})}}function pe(n){let t,s;return t=new Ie({props:{$$slots:{default:[Re]},$$scope:{ctx:n}}}),t.$on("click",n[4]),{c(){w(t.$$.fragment)},l(e){I(t.$$.fragment,e)},m(e,i){y(t,e,i),s=!0},p(e,i){const l={};i&2050&&(l.$$scope={dirty:i,ctx:e}),t.$set(l)},i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){g(t.$$.fragment,e),s=!1},d(e){C(t,e)}}}function Re(n){let t,s;return{c(){t=P("Use lookup: "),s=P(n[1])},l(e){t=W(e,"Use lookup: "),s=W(e,n[1])},m(e,i){b(e,t,i),b(e,s,i)},p(e,i){i&2&&ke(s,e[1])},d(e){e&&(_(t),_(s))}}}function Ue(n){let t,s,e,i,l,c,a,o,r,u,m,$,D,p,S,M;function h(f){n[5](f)}let A={label:"Critical Issue",emptyOption:!0,choices:n[3]};n[2].criticalIssues[n[0]].criticalIssue!==void 0&&(A.value=n[2].criticalIssues[n[0]].criticalIssue),t=new fe({props:A}),q.push(()=>F(t,"value",h));function T(f){n[6](f)}let N={label:"Stage",emptyOption:!0,choices:Ne(["Existing","Design"])};n[2].criticalIssues[n[0]].stage!==void 0&&(N.value=n[2].criticalIssues[n[0]].stage),i=new fe({props:N}),q.push(()=>F(i,"value",T));function De(f){n[7](f)}let te={label:"Location Name"};n[2].criticalIssues[n[0]].locationName!==void 0&&(te.value=n[2].criticalIssues[n[0]].locationName),a=new Te({props:te}),q.push(()=>F(a,"value",De));let v=n[1]&&n[1]!="Loading"&&n[1]!=n[2].criticalIssues[n[0]].locationName&&pe(n);function Ae(f){n[8](f)}let ne={label:"Resolved by Design"};n[2].criticalIssues[n[0]].resolved!==void 0&&(ne.value=n[2].criticalIssues[n[0]].resolved),m=new Pe({props:ne}),q.push(()=>F(m,"value",Ae));function Ee(f){n[9](f)}let se={label:"Commentary & Feedback"};return n[2].criticalIssues[n[0]].notes!==void 0&&(se.value=n[2].criticalIssues[n[0]].notes),p=new Me({props:se}),q.push(()=>F(p,"value",Ee)),{c(){w(t.$$.fragment),e=L(),w(i.$$.fragment),c=L(),w(a.$$.fragment),r=L(),v&&v.c(),u=L(),w(m.$$.fragment),D=L(),w(p.$$.fragment)},l(f){I(t.$$.fragment,f),e=B(f),I(i.$$.fragment,f),c=B(f),I(a.$$.fragment,f),r=B(f),v&&v.l(f),u=B(f),I(m.$$.fragment,f),D=B(f),I(p.$$.fragment,f)},m(f,k){y(t,f,k),b(f,e,k),y(i,f,k),b(f,c,k),y(a,f,k),b(f,r,k),v&&v.m(f,k),b(f,u,k),y(m,f,k),b(f,D,k),y(p,f,k),M=!0},p(f,[k]){const ie={};!s&&k&5&&(s=!0,ie.value=f[2].criticalIssues[f[0]].criticalIssue,j(()=>s=!1)),t.$set(ie);const ae={};!l&&k&5&&(l=!0,ae.value=f[2].criticalIssues[f[0]].stage,j(()=>l=!1)),i.$set(ae);const re={};!o&&k&5&&(o=!0,re.value=f[2].criticalIssues[f[0]].locationName,j(()=>o=!1)),a.$set(re),f[1]&&f[1]!="Loading"&&f[1]!=f[2].criticalIssues[f[0]].locationName?v?(v.p(f,k),k&7&&d(v,1)):(v=pe(f),v.c(),d(v,1),v.m(u.parentNode,u)):v&&(H(),g(v,1,1,()=>{v=null}),J());const le={};!$&&k&5&&($=!0,le.value=f[2].criticalIssues[f[0]].resolved,j(()=>$=!1)),m.$set(le);const oe={};!S&&k&5&&(S=!0,oe.value=f[2].criticalIssues[f[0]].notes,j(()=>S=!1)),p.$set(oe)},i(f){M||(d(t.$$.fragment,f),d(i.$$.fragment,f),d(a.$$.fragment,f),d(v),d(m.$$.fragment,f),d(p.$$.fragment,f),M=!0)},o(f){g(t.$$.fragment,f),g(i.$$.fragment,f),g(a.$$.fragment,f),g(v),g(m.$$.fragment,f),g(p.$$.fragment,f),M=!1},d(f){f&&(_(e),_(c),_(r),_(u),_(D)),C(t,f),C(i,f),C(a,f),v&&v.d(f),C(m,f),C(p,f)}}}function He(n,t,s){let e;x(n,E,p=>s(2,e=p));let{idx:i}=t,l=[["1","1 - Conflict at Side Roads and Priority Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["2","2 - Conflict at Roundabouts and Signal Junctions: >2,500vpd cut across main walking, wheeling or cycling streams"],["3","3 - Lane Widths: Cyclists unprotected in 3.25-3.9m wide nearside lane"],["4","4 - Trip Hazards: Level differences >13mm with no tactile information and colour contrast"],["5A","5A - Kerbside Activity: Cycle facility next to parking/loading with insufficient buffer"],["5B","5B - Kerbside Activity: Unprotected cycle lane next to a frequently used bus layby"],["6A","6A - Provision of Crossings: on busy streets (>8,000vpd), formal crossings are more than 400m apart"],["6B","6B - Provision of Crossings: on quieter streets (<8,000vpd), desire lines are blocked by parking/loading"],["7A","7A - Standard of Crossings: on busy streets (>8,000vpd), uncontrolled crossings of 2+ lanes with no gaps in traffic"],["7B","7B - Standard of Crossings: at signal junctions, there are arms with no green man for pedestrians"],["8","8 - Motor Traffic Speed: Mean speed > 30mph when cyclists/pedestrians are unprotected"],["9A","9A - Motor Traffic Volume: >1,000 vehicles in busiest hour when cyclists/pedestrians are unprotected"],["9B","9B - Motor Traffic Volume: >5% HGV traffic when cyclists/pedestrians are unprotected and >500 vehicles in busiest hour"],["10","10 - Pedestrian Crossing Speed: Pedestrians must cross at speeds >1.2m/s"],["11A","11A - Footway Width: <1m clear width"],["11B","11B - Footway Width: 1.0-1.5m wide clear width for over 6m"],["11C","11C - Footway Width: <2m clear width and pedestrian comfort level is poor (PCL of D-E)"],["11D","11D - Footway Width: no footway"],["12A","12A - Effective Width next to Tram Lines: <2.4m effective width for cyclists from tramline edge to kerb on a straight run"],["12B","12B - Effective Width next to Tram Lines: insufficient effective width for cyclists on a curved section of tram route"],["13","13 - Crossing Angle of Tram/Train Rails: Cyclist crossing angle <60Â°"],["14",'14 - Cycling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["15",'15 - Walking/Wheeling Surface and Maintenance Defects: Major defects (provide further information in "commentary and feedback")'],["16","16 - Guard Railing: used as standard without consideration of inherent safety risks"]],c="Loading";Z(async()=>{await a(e.criticalIssues[i].point)});async function a(p){let S=`https://nominatim.openstreetmap.org/reverse?lon=${p[0]}&lat=${p[1]}&format=json`;try{let h=await(await fetch(S)).json();s(1,c=h.address.road??h.display_name)}catch(M){return console.log(`Location lookup failed: ${M}`),""}}function o(){ee(E,e.criticalIssues[i].locationName=c,e)}function r(p){n.$$.not_equal(e.criticalIssues[i].criticalIssue,p)&&(e.criticalIssues[i].criticalIssue=p,E.set(e))}function u(p){n.$$.not_equal(e.criticalIssues[i].stage,p)&&(e.criticalIssues[i].stage=p,E.set(e))}function m(p){n.$$.not_equal(e.criticalIssues[i].locationName,p)&&(e.criticalIssues[i].locationName=p,E.set(e))}function $(p){n.$$.not_equal(e.criticalIssues[i].resolved,p)&&(e.criticalIssues[i].resolved=p,E.set(e))}function D(p){n.$$.not_equal(e.criticalIssues[i].notes,p)&&(e.criticalIssues[i].notes=p,E.set(e))}return n.$$set=p=>{"idx"in p&&s(0,i=p.idx)},[i,c,e,l,o,r,u,m,$,D]}class Ce extends Q{constructor(t){super(),X(this,t,He,Ue,z,{idx:0})}}function me(n,t,s){const e=n.slice();return e[11]=t[s],e[12]=t,e[13]=s,e}function Je(n){let t,s,e,i,l,c,a,o,r,u;return l=new We({props:{$$slots:{default:[Ye]},$$scope:{ctx:n}}}),l.$on("click",n[5]),a=new ye({props:{$$slots:{default:[ze]},$$scope:{ctx:n}}}),a.$on("click",n[4]),r=new Ce({props:{idx:n[1]}}),{c(){t=V("p"),s=P("Editing "),e=P(n[1]),i=L(),w(l.$$.fragment),c=L(),w(a.$$.fragment),o=L(),w(r.$$.fragment)},l(m){t=G(m,"P",{});var $=U(t);s=W($,"Editing "),e=W($,n[1]),$.forEach(_),i=B(m),I(l.$$.fragment,m),c=B(m),I(a.$$.fragment,m),o=B(m),I(r.$$.fragment,m)},m(m,$){b(m,t,$),O(t,s),O(t,e),b(m,i,$),y(l,m,$),b(m,c,$),y(a,m,$),b(m,o,$),y(r,m,$),u=!0},p(m,$){(!u||$&2)&&ke(e,m[1]);const D={};$&16384&&(D.$$scope={dirty:$,ctx:m}),l.$set(D);const p={};$&16384&&(p.$$scope={dirty:$,ctx:m}),a.$set(p);const S={};$&2&&(S.idx=m[1]),r.$set(S)},i(m){u||(d(l.$$.fragment,m),d(a.$$.fragment,m),d(r.$$.fragment,m),u=!0)},o(m){g(l.$$.fragment,m),g(a.$$.fragment,m),g(r.$$.fragment,m),u=!1},d(m){m&&(_(t),_(i),_(c),_(o)),C(l,m),C(a,m),C(r,m)}}}function Ke(n){let t,s="Click the map to add a pin, or click a pin to fill out data";return{c(){t=V("p"),t.textContent=s},l(e){t=G(e,"P",{"data-svelte-h":!0}),Se(t)!=="svelte-1rxcdnm"&&(t.textContent=s)},m(e,i){b(e,t,i)},p:K,i:K,o:K,d(e){e&&_(t)}}}function Ye(n){let t;return{c(){t=P("Save")},l(s){t=W(s,"Save")},m(s,e){b(s,t,e)},d(s){s&&_(t)}}}function ze(n){let t;return{c(){t=P("Delete")},l(s){t=W(s,"Delete")},m(s,e){b(s,t,e)},d(s){s&&_(t)}}}function $e(n){let t;return{c(){t=V("div"),this.h()},l(s){t=G(s,"DIV",{class:!0}),U(t).forEach(_),this.h()},h(){Be(t,"class","block-map svelte-13rr2mh")},m(s,e){b(s,t,e)},d(s){s&&_(t)}}}function de(n){let t,s,e;function i(o){n[6](o,n[11])}function l(){return n[7](n[13])}function c(){return n[8](n[13])}let a={map:n[0]};return n[11].point!==void 0&&(a.position=n[11].point),t=new Ge({props:a}),q.push(()=>F(t,"position",i)),t.$on("click",l),t.$on("dragEnd",c),{c(){w(t.$$.fragment)},l(o){I(t.$$.fragment,o)},m(o,r){y(t,o,r),e=!0},p(o,r){n=o;const u={};r&1&&(u.map=n[0]),!s&&r&4&&(s=!0,u.position=n[11].point,j(()=>s=!1)),t.$set(u)},i(o){e||(d(t.$$.fragment,o),e=!0)},o(o){g(t.$$.fragment,o),e=!1},d(o){C(t,o)}}}function ge(n){let t,s;return t=new je({props:{data:_e(n[2].criticalIssues[n[1]].point),$$slots:{default:[Qe]},$$scope:{ctx:n}}}),{c(){w(t.$$.fragment)},l(e){I(t.$$.fragment,e)},m(e,i){y(t,e,i),s=!0},p(e,i){const l={};i&6&&(l.data=_e(e[2].criticalIssues[e[1]].point)),i&16384&&(l.$$scope={dirty:i,ctx:e}),t.$set(l)},i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){g(t.$$.fragment,e),s=!1},d(e){C(t,e)}}}function Qe(n){let t,s;return t=new Fe({props:{paint:{"circle-radius":10,"circle-color":"yellow"}}}),{c(){w(t.$$.fragment)},l(e){I(t.$$.fragment,e)},m(e,i){y(t,e,i),s=!0},p:K,i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){g(t.$$.fragment,e),s=!1},d(e){C(t,e)}}}function Xe(n){let t,s,e,i=Y(n[2].criticalIssues),l=[];for(let o=0;o<i.length;o+=1)l[o]=de(me(n,i,o));const c=o=>g(l[o],1,1,()=>{l[o]=null});let a=n[1]!=null&&ge(n);return{c(){for(let o=0;o<l.length;o+=1)l[o].c();t=L(),a&&a.c(),s=ce()},l(o){for(let r=0;r<l.length;r+=1)l[r].l(o);t=B(o),a&&a.l(o),s=ce()},m(o,r){for(let u=0;u<l.length;u+=1)l[u]&&l[u].m(o,r);b(o,t,r),a&&a.m(o,r),b(o,s,r),e=!0},p(o,r){if(r&13){i=Y(o[2].criticalIssues);let u;for(u=0;u<i.length;u+=1){const m=me(o,i,u);l[u]?(l[u].p(m,r),d(l[u],1)):(l[u]=de(m),l[u].c(),d(l[u],1),l[u].m(t.parentNode,t))}for(H(),u=i.length;u<l.length;u+=1)c(u);J()}o[1]!=null?a?(a.p(o,r),r&2&&d(a,1)):(a=ge(o),a.c(),d(a,1),a.m(s.parentNode,s)):a&&(H(),g(a,1,1,()=>{a=null}),J())},i(o){if(!e){for(let r=0;r<i.length;r+=1)d(l[r]);d(a),e=!0}},o(o){l=l.filter(Boolean);for(let r=0;r<l.length;r+=1)g(l[r]);g(a),e=!1},d(o){o&&(_(t),_(s)),we(l,o),a&&a.d(o)}}}function Ze(n){let t,s,e,i,l,c,a,o,r,u;const m=[Ke,Je],$=[];function D(h,A){return h[1]==null?0:1}e=D(n),i=$[e]=m[e](n);let p=n[1]!=null&&$e();function S(h){n[9](h)}let M={$$slots:{default:[Xe]},$$scope:{ctx:n}};return n[0]!==void 0&&(M.map=n[0]),o=new qe({props:M}),q.push(()=>F(o,"map",S)),{c(){t=V("div"),s=V("div"),i.c(),l=L(),c=V("div"),p&&p.c(),a=L(),w(o.$$.fragment),this.h()},l(h){t=G(h,"DIV",{style:!0});var A=U(t);s=G(A,"DIV",{style:!0});var T=U(s);i.l(T),T.forEach(_),l=B(A),c=G(A,"DIV",{style:!0});var N=U(c);p&&p.l(N),a=B(N),I(o.$$.fragment,N),N.forEach(_),A.forEach(_),this.h()},h(){R(s,"width","30%"),R(c,"position","relative"),R(c,"width","70%"),R(c,"height","300px"),R(t,"display","flex")},m(h,A){b(h,t,A),O(t,s),$[e].m(s,null),O(t,l),O(t,c),p&&p.m(c,null),O(c,a),y(o,c,null),u=!0},p(h,[A]){let T=e;e=D(h),e===T?$[e].p(h,A):(H(),g($[T],1,1,()=>{$[T]=null}),J(),i=$[e],i?i.p(h,A):(i=$[e]=m[e](h),i.c()),d(i,1),i.m(s,null)),h[1]!=null?p||(p=$e(),p.c(),p.m(c,a)):p&&(p.d(1),p=null);const N={};A&16391&&(N.$$scope={dirty:A,ctx:h}),!r&&A&1&&(r=!0,N.map=h[0],j(()=>r=!1)),o.$set(N)},i(h){u||(d(i),d(o.$$.fragment,h),u=!0)},o(h){g(i),g(o.$$.fragment,h),u=!1},d(h){h&&_(t),$[e].d(),p&&p.d(),C(o)}}}function _e(n){return{type:"Feature",properties:{},geometry:{type:"Point",coordinates:n}}}function xe(n,t,s){let e;x(n,E,p=>s(2,e=p));let i,l=null;function c(p){s(1,l=p)}function a(p){ee(E,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:p.lngLat.toArray(),locationName:"",resolved:"",notes:""}],e),s(1,l=e.criticalIssues.length-1)}Z(()=>{i.on("click",a)}),ve(()=>{i.off("click",a)});function o(){e.criticalIssues.splice(l,1),E.set(e),s(1,l=null)}const r=()=>s(1,l=null);function u(p,S){n.$$.not_equal(S.point,p)&&(S.point=p,E.set(e))}const m=p=>c(p),$=p=>c(p);function D(p){i=p,s(0,i)}return[i,l,e,c,o,r,u,m,$,D]}class et extends Q{constructor(t){super(),X(this,t,xe,Ze,z,{})}}function he(n,t,s){const e=n.slice();return e[4]=t[s],e[6]=s,e}function tt(n){let t;return{c(){t=P("Add")},l(s){t=W(s,"Add")},m(s,e){b(s,t,e)},d(s){s&&_(t)}}}function nt(n){let t;return{c(){t=P("Delete")},l(s){t=W(s,"Delete")},m(s,e){b(s,t,e)},d(s){s&&_(t)}}}function st(n){let t,s,e,i;function l(){return n[3](n[6])}return t=new ye({props:{$$slots:{default:[nt]},$$scope:{ctx:n}}}),t.$on("click",l),e=new Ce({props:{idx:n[6]}}),{c(){w(t.$$.fragment),s=L(),w(e.$$.fragment)},l(c){I(t.$$.fragment,c),s=B(c),I(e.$$.fragment,c)},m(c,a){y(t,c,a),b(c,s,a),y(e,c,a),i=!0},p(c,a){n=c;const o={};a&128&&(o.$$scope={dirty:a,ctx:n}),t.$set(o)},i(c){i||(d(t.$$.fragment,c),d(e.$$.fragment,c),i=!0)},o(c){g(t.$$.fragment,c),g(e.$$.fragment,c),i=!1},d(c){c&&_(s),C(t,c),C(e,c)}}}function be(n){let t,s;return t=new Oe({props:{label:n[4].id,$$slots:{default:[st]},$$scope:{ctx:n}}}),{c(){w(t.$$.fragment)},l(e){I(t.$$.fragment,e)},m(e,i){y(t,e,i),s=!0},p(e,i){const l={};i&1&&(l.label=e[4].id),i&128&&(l.$$scope={dirty:i,ctx:e}),t.$set(l)},i(e){s||(d(t.$$.fragment,e),s=!0)},o(e){g(t.$$.fragment,e),s=!1},d(e){C(t,e)}}}function it(n){let t,s,e,i,l;t=new Ie({props:{$$slots:{default:[tt]},$$scope:{ctx:n}}}),t.$on("click",n[1]);let c=Y(n[0].criticalIssues),a=[];for(let r=0;r<c.length;r+=1)a[r]=be(he(n,c,r));const o=r=>g(a[r],1,1,()=>{a[r]=null});return i=new et({}),{c(){w(t.$$.fragment),s=L();for(let r=0;r<a.length;r+=1)a[r].c();e=L(),w(i.$$.fragment)},l(r){I(t.$$.fragment,r),s=B(r);for(let u=0;u<a.length;u+=1)a[u].l(r);e=B(r),I(i.$$.fragment,r)},m(r,u){y(t,r,u),b(r,s,u);for(let m=0;m<a.length;m+=1)a[m]&&a[m].m(r,u);b(r,e,u),y(i,r,u),l=!0},p(r,[u]){const m={};if(u&128&&(m.$$scope={dirty:u,ctx:r}),t.$set(m),u&5){c=Y(r[0].criticalIssues);let $;for($=0;$<c.length;$+=1){const D=he(r,c,$);a[$]?(a[$].p(D,u),d(a[$],1)):(a[$]=be(D),a[$].c(),d(a[$],1),a[$].m(e.parentNode,e))}for(H(),$=c.length;$<a.length;$+=1)o($);J()}},i(r){if(!l){d(t.$$.fragment,r);for(let u=0;u<c.length;u+=1)d(a[u]);d(i.$$.fragment,r),l=!0}},o(r){g(t.$$.fragment,r),a=a.filter(Boolean);for(let u=0;u<a.length;u+=1)g(a[u]);g(i.$$.fragment,r),l=!1},d(r){r&&(_(s),_(e)),C(t,r),we(a,r),C(i,r)}}}function at(n,t,s){let e;x(n,E,a=>s(0,e=a));function i(){ee(E,e.criticalIssues=[...e.criticalIssues,{id:"TODO",criticalIssue:"",stage:"",point:[0,0],locationName:"",resolved:"",notes:""}],e)}function l(a){window.confirm("Delete this entry?")&&(e.criticalIssues.splice(a,1),E.set(e))}return[e,i,l,a=>l(a)]}class kt extends Q{constructor(t){super(),X(this,t,at,it,z,{})}}export{kt as component};
