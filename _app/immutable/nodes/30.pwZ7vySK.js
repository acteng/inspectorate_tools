import{s as Pe,v as te,w as ne,l as en,u as tn,m as nn,o as rn,G as Ee,k as Re,U as on,T as qe,a as B,g as G,i as v,f as b,q as Oe,n as Me,e as x,t as J,c as ee,b as ie,d as H,r as Je,x as Y,h as oe,j as _e,z as ln,D as be,p as ft}from"../chunks/scheduler.BBS-fkhU.js";import{S as Ne,i as Be,e as re,c as I,a as F,m as T,t as w,b as k,d as q,g as me,f as ce}from"../chunks/index.B8H3ypVf.js";import{e as pe}from"../chunks/each.D79A5KlB.js";import{B as an}from"../chunks/ButtonGroup.fhy-VJbf.js";import{W as It,S as de}from"../chunks/WarningButton.CaqyhU7y.js";import{T as tt}from"../chunks/TextInput.C_aBwF72.js";import{s as Q}from"../chunks/data.DZj75f-0.js";import{L as sn,d as un,e as Ft,M as fn,b as mn,C as cn,G as mt,f as Qe,h as ct,c as gn,P as Tt,g as pn}from"../chunks/index.DehCEenh.js";import{c as Ge}from"../chunks/colors.CYEpEtTL.js";import{M as _n,a as dn,b as ze,R as qt,B as hn,G as $n,C as bn,S as wn}from"../chunks/GeoreferenceLayer.CLNtiY_7.js";import{D as yn,C as vn}from"../chunks/DefaultButton.Pbp5mObw.js";import{T as Ot}from"../chunks/TextArea.Ck6ITb4v.js";import{p as Nt}from"../chunks/index.BxTAzgsS.js";import{S as kn}from"../chunks/Select.DqyoFzIJ.js";function jn(t){let e;const n=t[16].default,r=en(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&tn(r,n,o,o[24],e?rn(n,o[24],l,null):nn(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function En(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[jn]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new sn({props:l}),te.push(()=>re(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,s){T(e,i,s),r=!0},p(i,[s]){const a={};s&2&&(a.id=i[1]),s&4&&(a.source=i[2]),s&8&&(a.sourceLayer=i[3]),s&16&&(a.beforeId=i[4]),s&32&&(a.beforeLayerType=i[5]),s&64&&(a.paint=i[6]),s&128&&(a.layout=i[7]),s&256&&(a.filter=i[8]),s&512&&(a.applyToClusters=i[9]),s&1024&&(a.minzoom=i[10]),s&2048&&(a.maxzoom=i[11]),s&4096&&(a.hoverCursor=i[12]),s&8192&&(a.manageHoverState=i[13]),s&16384&&(a.eventsIfTopMost=i[14]),s&32768&&(a.interactive=i[15]),s&16777216&&(a.$$scope={dirty:s,ctx:i}),!n&&s&1&&(n=!0,a.hovered=i[0],ne(()=>n=!1)),e.$set(a)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function Cn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=un("symbol")}=e,{source:i=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:a=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:g=void 0}=e,{layout:p=void 0}=e,{filter:f=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:O=void 0}=e,{hoverCursor:y=void 0}=e,{manageHoverState:j=!1}=e,{hovered:S=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:d=!0}=e;function $(A){S=A,n(0,S)}function _(A){Ee.call(this,t,A)}function P(A){Ee.call(this,t,A)}function K(A){Ee.call(this,t,A)}function M(A){Ee.call(this,t,A)}function U(A){Ee.call(this,t,A)}function ge(A){Ee.call(this,t,A)}return t.$$set=A=>{"id"in A&&n(1,l=A.id),"source"in A&&n(2,i=A.source),"sourceLayer"in A&&n(3,s=A.sourceLayer),"beforeId"in A&&n(4,a=A.beforeId),"beforeLayerType"in A&&n(5,m=A.beforeLayerType),"paint"in A&&n(6,g=A.paint),"layout"in A&&n(7,p=A.layout),"filter"in A&&n(8,f=A.filter),"applyToClusters"in A&&n(9,E=A.applyToClusters),"minzoom"in A&&n(10,C=A.minzoom),"maxzoom"in A&&n(11,O=A.maxzoom),"hoverCursor"in A&&n(12,y=A.hoverCursor),"manageHoverState"in A&&n(13,j=A.manageHoverState),"hovered"in A&&n(0,S=A.hovered),"eventsIfTopMost"in A&&n(14,u=A.eventsIfTopMost),"interactive"in A&&n(15,d=A.interactive),"$$scope"in A&&n(24,o=A.$$scope)},[S,l,i,s,a,m,g,p,f,E,C,O,y,j,u,d,r,$,_,P,K,M,U,ge,o]}class Ln extends Ne{constructor(e){super(),Be(this,e,Cn,En,Pe,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Pn=Object.defineProperty,X=(t,e)=>Pn(t,"name",{value:e,configurable:!0}),Mn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ie(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ye(e),o=Ye(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ie(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const a=this.fixStartIndex(i,l);if(a)i=a;else return!1}const s=this.compareCoord(l[r],i[r]);return this.direction||s?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Ie(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ie(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};X(Mn,"GeojsonEquality");function Ie(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}X(Ie,"sameLength");function Ye(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}X(Ye,"explode");var ue=63710088e-1,Bt={centimeters:ue*100,centimetres:ue*100,degrees:360/(2*Math.PI),feet:ue*3.28084,inches:ue*39.37,kilometers:ue/1e3,kilometres:ue/1e3,meters:ue,metres:ue,miles:ue/1609.344,millimeters:ue*1e3,millimetres:ue*1e3,nauticalmiles:ue/1852,radians:1,yards:ue*1.0936},gt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function we(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}X(we,"feature");function An(t,e,n={}){switch(t){case"Point":return He(e).geometry;case"LineString":return rt(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return zt(e).geometry;case"MultiLineString":return Gt(e).geometry;case"MultiPolygon":return Dt(e).geometry;default:throw new Error(t+" is invalid")}}X(An,"geometry");function He(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ce(t[0])||!Ce(t[1]))throw new Error("coordinates must contain numbers");return we({type:"Point",coordinates:t},e,n)}X(He,"point");function Sn(t,e,n={}){return Ke(t.map(r=>He(r,e)),n)}X(Sn,"points");function nt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return we({type:"Polygon",coordinates:t},e,n)}X(nt,"polygon");function In(t,e,n={}){return Ke(t.map(r=>nt(r,e)),n)}X(In,"polygons");function rt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return we({type:"LineString",coordinates:t},e,n)}X(rt,"lineString");function Fn(t,e,n={}){return Ke(t.map(r=>rt(r,e)),n)}X(Fn,"lineStrings");function Ke(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}X(Ke,"featureCollection");function Gt(t,e,n={}){return we({type:"MultiLineString",coordinates:t},e,n)}X(Gt,"multiLineString");function zt(t,e,n={}){return we({type:"MultiPoint",coordinates:t},e,n)}X(zt,"multiPoint");function Dt(t,e,n={}){return we({type:"MultiPolygon",coordinates:t},e,n)}X(Dt,"multiPolygon");function Tn(t,e,n={}){return we({type:"GeometryCollection",geometries:t},e,n)}X(Tn,"geometryCollection");function qn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}X(qn,"round");function Ut(t,e="kilometers"){const n=Bt[e];if(!n)throw new Error(e+" units is invalid");return t*n}X(Ut,"radiansToLength");function Xe(t,e="kilometers"){const n=Bt[e];if(!n)throw new Error(e+" units is invalid");return t/n}X(Xe,"lengthToRadians");function On(t,e){return Ue(Xe(t,e))}X(On,"lengthToDegrees");function Nn(t){let e=t%360;return e<0&&(e+=360),e}X(Nn,"bearingToAzimuth");function Ue(t){return t%(2*Math.PI)*180/Math.PI}X(Ue,"radiansToDegrees");function De(t){return t%360*Math.PI/180}X(De,"degreesToRadians");function Bn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Ut(Xe(t,e),n)}X(Bn,"convertLength");function Gn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=gt[e];if(!r)throw new Error("invalid original units");const o=gt[n];if(!o)throw new Error("invalid final units");return t/r*o}X(Gn,"convertArea");function Ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}X(Ce,"isNumber");function zn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}X(zn,"isObject");function Dn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ce(e))throw new Error("bbox must only contain numbers")})}X(Dn,"validateBBox");function Un(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}X(Un,"validateId");var Rn=Object.defineProperty,ye=(t,e)=>Rn(t,"name",{value:e,configurable:!0});function Rt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ye(Rt,"getCoord");function Jn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ye(Jn,"getCoords");function Jt(t){if(t.length>1&&Ce(t[0])&&Ce(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Jt(t[0]);throw new Error("coordinates must only contain numbers")}ye(Jt,"containsNumber");function Hn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ye(Hn,"geojsonType");function Kn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ye(Kn,"featureOf");function Xn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ye(Xn,"collectionOf");function Vn(t){return t.type==="Feature"?t.geometry:t}ye(Vn,"getGeom");function Wn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ye(Wn,"getType");var Zn=Object.defineProperty,Qn=(t,e)=>Zn(t,"name",{value:e,configurable:!0});function Ht(t,e,n,r={}){const o=Rt(t),l=De(o[0]),i=De(o[1]),s=De(n),a=Xe(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(a)+Math.cos(i)*Math.sin(a)*Math.cos(s)),g=l+Math.atan2(Math.sin(s)*Math.sin(a)*Math.cos(i),Math.cos(a)-Math.sin(i)*Math.sin(m)),p=Ue(g),f=Ue(m);return He([p,f],r.properties)}Qn(Ht,"destination");var pt=Ht,Yn=Object.defineProperty,V=(t,e)=>Yn(t,"name",{value:e,configurable:!0}),xn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Fe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=xe(e),o=xe(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Fe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const a=this.fixStartIndex(i,l);if(a)i=a;else return!1}const s=this.compareCoord(l[r],i[r]);return this.direction||s?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Fe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Fe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};V(xn,"GeojsonEquality");function Fe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}V(Fe,"sameLength");function xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}V(xe,"explode");var fe=63710088e-1,Kt={centimeters:fe*100,centimetres:fe*100,degrees:360/(2*Math.PI),feet:fe*3.28084,inches:fe*39.37,kilometers:fe/1e3,kilometres:fe/1e3,meters:fe,metres:fe,miles:fe/1609.344,millimeters:fe*1e3,millimetres:fe*1e3,nauticalmiles:fe/1852,radians:1,yards:fe*1.0936},_t={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ve(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}V(ve,"feature");function er(t,e,n={}){switch(t){case"Point":return ot(e).geometry;case"LineString":return lt(e).geometry;case"Polygon":return it(e).geometry;case"MultiPoint":return Vt(e).geometry;case"MultiLineString":return Xt(e).geometry;case"MultiPolygon":return Wt(e).geometry;default:throw new Error(t+" is invalid")}}V(er,"geometry");function ot(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Le(t[0])||!Le(t[1]))throw new Error("coordinates must contain numbers");return ve({type:"Point",coordinates:t},e,n)}V(ot,"point");function tr(t,e,n={}){return Ve(t.map(r=>ot(r,e)),n)}V(tr,"points");function it(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ve({type:"Polygon",coordinates:t},e,n)}V(it,"polygon");function nr(t,e,n={}){return Ve(t.map(r=>it(r,e)),n)}V(nr,"polygons");function lt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ve({type:"LineString",coordinates:t},e,n)}V(lt,"lineString");function rr(t,e,n={}){return Ve(t.map(r=>lt(r,e)),n)}V(rr,"lineStrings");function Ve(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}V(Ve,"featureCollection");function Xt(t,e,n={}){return ve({type:"MultiLineString",coordinates:t},e,n)}V(Xt,"multiLineString");function Vt(t,e,n={}){return ve({type:"MultiPoint",coordinates:t},e,n)}V(Vt,"multiPoint");function Wt(t,e,n={}){return ve({type:"MultiPolygon",coordinates:t},e,n)}V(Wt,"multiPolygon");function or(t,e,n={}){return ve({type:"GeometryCollection",geometries:t},e,n)}V(or,"geometryCollection");function ir(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}V(ir,"round");function Zt(t,e="kilometers"){const n=Kt[e];if(!n)throw new Error(e+" units is invalid");return t*n}V(Zt,"radiansToLength");function at(t,e="kilometers"){const n=Kt[e];if(!n)throw new Error(e+" units is invalid");return t/n}V(at,"lengthToRadians");function lr(t,e){return st(at(t,e))}V(lr,"lengthToDegrees");function ar(t){let e=t%360;return e<0&&(e+=360),e}V(ar,"bearingToAzimuth");function st(t){return t%(2*Math.PI)*180/Math.PI}V(st,"radiansToDegrees");function Te(t){return t%360*Math.PI/180}V(Te,"degreesToRadians");function sr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Zt(at(t,e),n)}V(sr,"convertLength");function ur(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=_t[e];if(!r)throw new Error("invalid original units");const o=_t[n];if(!o)throw new Error("invalid final units");return t/r*o}V(ur,"convertArea");function Le(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}V(Le,"isNumber");function fr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}V(fr,"isObject");function mr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Le(e))throw new Error("bbox must only contain numbers")})}V(mr,"validateBBox");function cr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}V(cr,"validateId");var gr=Object.defineProperty,ke=(t,e)=>gr(t,"name",{value:e,configurable:!0});function et(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ke(et,"getCoord");function pr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ke(pr,"getCoords");function Qt(t){if(t.length>1&&Le(t[0])&&Le(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Qt(t[0]);throw new Error("coordinates must only contain numbers")}ke(Qt,"containsNumber");function _r(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ke(_r,"geojsonType");function dr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ke(dr,"featureOf");function hr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ke(hr,"collectionOf");function $r(t){return t.type==="Feature"?t.geometry:t}ke($r,"getGeom");function br(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ke(br,"getType");var wr=Object.defineProperty,Yt=(t,e)=>wr(t,"name",{value:e,configurable:!0});function ut(t,e,n={}){if(n.final===!0)return xt(t,e);const r=et(t),o=et(e),l=Te(r[0]),i=Te(o[0]),s=Te(r[1]),a=Te(o[1]),m=Math.sin(i-l)*Math.cos(a),g=Math.cos(s)*Math.sin(a)-Math.sin(s)*Math.cos(a)*Math.cos(i-l);return st(Math.atan2(m,g))}Yt(ut,"bearing");function xt(t,e){let n=ut(e,t);return n=(n+180)%360,n}Yt(xt,"calculateFinalBearing");var yr=ut;function dt(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function ht(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function vr(t){let e,n=Tr(t[36])+"",r;return{c(){e=x("span"),r=J(n),this.h()},l(o){e=ee(o,"SPAN",{class:!0});var l=ie(e);r=H(l,n),l.forEach(b),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"color","#4472c4"),Y(e,"background-color","white")},m(o,l){v(o,e,l),oe(e,r)},p:Me,d(o){o&&b(e)}}}function $t(t){let e,n,r;function o(a){t[17](a,t[37])}function l(){return t[18](t[36])}function i(){return t[19](t[36])}let s={draggable:!0,$$slots:{default:[vr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(s.lngLat=t[37].point),e=new ze({props:s}),te.push(()=>re(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,m){T(e,a,m),r=!0},p(a,m){t=a;const g={};m[1]&256&&(g.$$scope={dirty:m,ctx:t}),!n&&m[0]&11&&(n=!0,g.lngLat=t[37].point,ne(()=>n=!1)),e.$set(g)},i(a){r||(w(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function kr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score]),Y(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score]),r[0]&11&&Y(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&b(e)}}}function jr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score])},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score])},d(n){n&&b(e)}}}function Er(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Y(e,"background-color",t[6][t[34].score]),Y(e,"opacity","0%")},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Y(e,"background-color",n[6][n[34].score])},d(n){n&&b(e)}}}function bt(t){let e,n,r,o,l,i,s,a,m;function g(_){t[20](_,t[34])}function p(){return t[21](t[36])}function f(){return t[22](t[36])}let E={draggable:!0,$$slots:{default:[kr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(E.lngLat=t[34].point1),e=new ze({props:E}),te.push(()=>re(e,"lngLat",g)),e.$on("dragend",p),e.$on("click",f);function C(_){t[23](_,t[34])}function O(){return t[24](t[36])}function y(){return t[25](t[36])}let j={draggable:!0,$$slots:{default:[jr]},$$scope:{ctx:t}};t[34].point2!==void 0&&(j.lngLat=t[34].point2),o=new ze({props:j}),te.push(()=>re(o,"lngLat",C)),o.$on("dragend",O),o.$on("click",y);function S(_){t[26](_,t[34])}function u(){return t[27](t[36])}function d(){return t[28](t[36])}let $={draggable:!0,$$slots:{default:[Er]},$$scope:{ctx:t}};return t[34].point3!==void 0&&($.lngLat=t[34].point3),s=new ze({props:$}),te.push(()=>re(s,"lngLat",S)),s.$on("dragend",u),s.$on("click",d),{c(){I(e.$$.fragment),r=B(),I(o.$$.fragment),i=B(),I(s.$$.fragment)},l(_){F(e.$$.fragment,_),r=G(_),F(o.$$.fragment,_),i=G(_),F(s.$$.fragment,_)},m(_,P){T(e,_,P),v(_,r,P),T(o,_,P),v(_,i,P),T(s,_,P),m=!0},p(_,P){t=_;const K={};P[0]&11|P[1]&256&&(K.$$scope={dirty:P,ctx:t}),!n&&P[0]&11&&(n=!0,K.lngLat=t[34].point1,ne(()=>n=!1)),e.$set(K);const M={};P[0]&11|P[1]&256&&(M.$$scope={dirty:P,ctx:t}),!l&&P[0]&11&&(l=!0,M.lngLat=t[34].point2,ne(()=>l=!1)),o.$set(M);const U={};P[0]&11|P[1]&256&&(U.$$scope={dirty:P,ctx:t}),!a&&P[0]&11&&(a=!0,U.lngLat=t[34].point3,ne(()=>a=!1)),s.$set(U)},i(_){m||(w(e.$$.fragment,_),w(o.$$.fragment,_),w(s.$$.fragment,_),m=!0)},o(_){k(e.$$.fragment,_),k(o.$$.fragment,_),k(s.$$.fragment,_),m=!1},d(_){_&&(b(r),b(i)),q(e,_),q(o,_),q(s,_)}}}function Cr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&_e(n,e)},d(r){r&&b(n)}}}function Lr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Cr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Pr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&_e(n,e)},d(r){r&&b(n)}}}function Mr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Pr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Ar(t){let e,n,r,o,l,i;return e=new Qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":ct(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Lr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new Qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":ct(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Mr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new Ln({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B(),I(l.$$.fragment)},l(s){F(e.$$.fragment,s),n=G(s),F(r.$$.fragment,s),o=G(s),F(l.$$.fragment,s)},m(s,a){T(e,s,a),v(s,n,a),T(r,s,a),v(s,o,a),T(l,s,a),i=!0},p(s,a){const m={};a[1]&256&&(m.$$scope={dirty:a,ctx:s}),e.$set(m);const g={};a[1]&256&&(g.$$scope={dirty:a,ctx:s}),r.$set(g)},i(s){i||(w(e.$$.fragment,s),w(r.$$.fragment,s),w(l.$$.fragment,s),i=!0)},o(s){k(e.$$.fragment,s),k(r.$$.fragment,s),k(l.$$.fragment,s),i=!1},d(s){s&&(b(n),b(o)),q(e,s),q(r,s),q(l,s)}}}function Sr(t){let e,n,r,o;return e=new Qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new gn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment)},l(l){F(e.$$.fragment,l),n=G(l),F(r.$$.fragment,l)},m(l,i){T(e,l,i),v(l,n,i),T(r,l,i),o=!0},p:Me,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),o=!1},d(l){l&&b(n),q(e,l),q(r,l)}}}function Ir(t){let e,n,r,o,l,i,s,a,m,g,p,f;e=new _n({}),e.$on("click",t[8]),r=new cn({props:{gj:t[3].summary.networkMap,show:t[2]}});let E=pe(t[3].jat[t[0]][t[1]].arms),C=[];for(let u=0;u<E.length;u+=1)C[u]=$t(ht(t,E,u));const O=u=>k(C[u],1,1,()=>{C[u]=null});let y=pe(t[3].jat[t[0]][t[1]].movements),j=[];for(let u=0;u<y.length;u+=1)j[u]=bt(dt(t,y,u));const S=u=>k(j[u],1,1,()=>{j[u]=null});return s=new mt({props:{data:t[10](t[3]),$$slots:{default:[Ar]},$$scope:{ctx:t}}}),m=new mt({props:{data:t[5],$$slots:{default:[Sr]},$$scope:{ctx:t}}}),p=new dn({props:{map:t[4]}}),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B();for(let u=0;u<C.length;u+=1)C[u].c();l=B();for(let u=0;u<j.length;u+=1)j[u].c();i=B(),I(s.$$.fragment),a=B(),I(m.$$.fragment),g=B(),I(p.$$.fragment)},l(u){F(e.$$.fragment,u),n=G(u),F(r.$$.fragment,u),o=G(u);for(let d=0;d<C.length;d+=1)C[d].l(u);l=G(u);for(let d=0;d<j.length;d+=1)j[d].l(u);i=G(u),F(s.$$.fragment,u),a=G(u),F(m.$$.fragment,u),g=G(u),F(p.$$.fragment,u)},m(u,d){T(e,u,d),v(u,n,d),T(r,u,d),v(u,o,d);for(let $=0;$<C.length;$+=1)C[$]&&C[$].m(u,d);v(u,l,d);for(let $=0;$<j.length;$+=1)j[$]&&j[$].m(u,d);v(u,i,d),T(s,u,d),v(u,a,d),T(m,u,d),v(u,g,d),T(p,u,d),f=!0},p(u,d){const $={};if(d[0]&8&&($.gj=u[3].summary.networkMap),d[0]&4&&($.show=u[2]),r.$set($),d[0]&139){E=pe(u[3].jat[u[0]][u[1]].arms);let M;for(M=0;M<E.length;M+=1){const U=ht(u,E,M);C[M]?(C[M].p(U,d),w(C[M],1)):(C[M]=$t(U),C[M].c(),w(C[M],1),C[M].m(l.parentNode,l))}for(me(),M=E.length;M<C.length;M+=1)O(M);ce()}if(d[0]&203){y=pe(u[3].jat[u[0]][u[1]].movements);let M;for(M=0;M<y.length;M+=1){const U=dt(u,y,M);j[M]?(j[M].p(U,d),w(j[M],1)):(j[M]=bt(U),j[M].c(),w(j[M],1),j[M].m(i.parentNode,i))}for(me(),M=y.length;M<j.length;M+=1)S(M);ce()}const _={};d[0]&8&&(_.data=u[10](u[3])),d[1]&256&&(_.$$scope={dirty:d,ctx:u}),s.$set(_);const P={};d[0]&32&&(P.data=u[5]),d[1]&256&&(P.$$scope={dirty:d,ctx:u}),m.$set(P);const K={};d[0]&16&&(K.map=u[4]),p.$set(K)},i(u){if(!f){w(e.$$.fragment,u),w(r.$$.fragment,u);for(let d=0;d<E.length;d+=1)w(C[d]);for(let d=0;d<y.length;d+=1)w(j[d]);w(s.$$.fragment,u),w(m.$$.fragment,u),w(p.$$.fragment,u),f=!0}},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),C=C.filter(Boolean);for(let d=0;d<C.length;d+=1)k(C[d]);j=j.filter(Boolean);for(let d=0;d<j.length;d+=1)k(j[d]);k(s.$$.fragment,u),k(m.$$.fragment,u),k(p.$$.fragment,u),f=!1},d(u){u&&(b(n),b(o),b(l),b(i),b(a),b(g)),q(e,u),q(r,u),Oe(C,u),Oe(j,u),q(s,u),q(m,u),q(p,u)}}}function Fr(t){let e,n,r;function o(i){t[29](i)}let l={$$slots:{default:[Ir]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.map=t[4]),e=new fn({props:l}),te.push(()=>re(e,"map",o)),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,s){T(e,i,s),r=!0},p(i,s){const a={};s[0]&63|s[1]&256&&(a.$$scope={dirty:s,ctx:i}),!n&&s[0]&16&&(n=!0,a.map=i[4],ne(()=>n=!1)),e.$set(a)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function wt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Tr(t){return String.fromCharCode(t+65)}function qr(t,e,n){let r,o;Re(t,Q,h=>n(3,o=h));let{junctionIdx:l}=e,{stage:i}=e,{newKind:s}=e,{editing:a}=e,{hoveringSidebar:m}=e,{streetviewOn:g}=e,{showContext:p}=e,f,E={0:Ge.red.background,1:Ge.amber.background,2:Ge.green.background,X:Ge.critical.background};function C(h,z,D){let he={type:"FeatureCollection",features:[]},W=z??D;return W!=null&&(W.kind=="arm"?he.features.push(wt(h.jat[l][i].arms[W.idx],W.idx)):he.features.push(u(h.jat[l][i].movements[W.idx],W.idx))),he}function O(h){n(11,a=h),n(12,m=null)}function y(h){if(!g){for(let z of f.queryRenderedFeatures(h.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a!=null){n(11,a=null);return}s=="arm"?(qe(Q,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:h.detail.lngLat.toArray(),name:""}],o),n(11,a={kind:"arm",idx:o.jat[l][i].arms.length-1})):(qe(Q,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:h.detail.lngLat.toArray(),point2:pt(h.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:pt(h.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(11,a={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(12,m=null)}}function j(h){O({kind:"movement",idx:h.detail.features[0].id})}on(()=>{$(!1)});function S(h){let z={type:"FeatureCollection",features:h.jat[l][i].movements.map((D,he)=>u(D,he))};for(let D of h.jat[l][i].movements)if(z.features.push(d(D,z.features.length)),D.kind=="walking & wheeling"){let he={...D,point1:D.point3,point3:D.point1};z.features.push(d(he,z.features.length))}return z}function u(h,z){return{type:"Feature",id:z,properties:{name:h.name,kind:h.kind,color:E[h.score]},geometry:{type:"LineString",coordinates:[h.point1,h.point2,h.point3]}}}function d(h,z){return{type:"Feature",id:z,properties:{kind:h.kind,color:E[h.score],angle:yr(h.point2,h.point3)},geometry:{type:"Point",coordinates:h.point3}}}function $(h){let z=S(o);for(let D of o.jat[l][i].arms)z.features.push(wt(D,z.features.length));for(let D of o.summary.networkMap.features)z.features.push(D);z.features.length>0&&f.fitBounds(mn(z),{padding:20,animate:h})}function _(){return f}function P(h,z){t.$$.not_equal(z.point,h)&&(z.point=h,Q.set(o))}const K=h=>O({kind:"arm",idx:h}),M=h=>O({kind:"arm",idx:h});function U(h,z){t.$$.not_equal(z.point1,h)&&(z.point1=h,Q.set(o))}const ge=h=>O({kind:"movement",idx:h}),A=h=>O({kind:"movement",idx:h});function $e(h,z){t.$$.not_equal(z.point2,h)&&(z.point2=h,Q.set(o))}const le=h=>O({kind:"movement",idx:h}),Ae=h=>O({kind:"movement",idx:h});function je(h,z){t.$$.not_equal(z.point3,h)&&(z.point3=h,Q.set(o))}const N=h=>O({kind:"movement",idx:h}),Z=h=>O({kind:"movement",idx:h});function We(h){f=h,n(4,f)}return t.$$set=h=>{"junctionIdx"in h&&n(0,l=h.junctionIdx),"stage"in h&&n(1,i=h.stage),"newKind"in h&&n(13,s=h.newKind),"editing"in h&&n(11,a=h.editing),"hoveringSidebar"in h&&n(12,m=h.hoveringSidebar),"streetviewOn"in h&&n(14,g=h.streetviewOn),"showContext"in h&&n(2,p=h.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=C(o,a,m))},[l,i,p,o,f,r,E,O,y,j,S,a,m,s,g,$,_,P,K,M,U,ge,A,$e,le,Ae,je,N,Z,We]}class Or extends Ne{constructor(e){super(),Be(this,e,qr,Fr,Pe,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Nr(t){let e,n,r,o,l,i,s,a,m,g,p,f;function E($){t[5]($)}let C={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(C.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new tt({props:C}),te.push(()=>re(e,"value",E));function O($){t[6]($)}let y={legend:"Movement",choices:Nt(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(y.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new qt({props:y}),te.push(()=>re(o,"value",O));function j($){t[7]($)}let S={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(S.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),s=new kn({props:S}),te.push(()=>re(s,"value",j));function u($){t[8]($)}let d={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),g=new Ot({props:d}),te.push(()=>re(g,"value",u)),{c(){I(e.$$.fragment),r=B(),I(o.$$.fragment),i=B(),I(s.$$.fragment),m=B(),I(g.$$.fragment)},l($){F(e.$$.fragment,$),r=G($),F(o.$$.fragment,$),i=G($),F(s.$$.fragment,$),m=G($),F(g.$$.fragment,$)},m($,_){T(e,$,_),v($,r,_),T(o,$,_),v($,i,_),T(s,$,_),v($,m,_),T(g,$,_),f=!0},p($,[_]){const P={};!n&&_&15&&(n=!0,P.value=$[3].jat[$[0]][$[1]].movements[$[2]].name,ne(()=>n=!1)),e.$set(P);const K={};!l&&_&15&&(l=!0,K.value=$[3].jat[$[0]][$[1]].movements[$[2]].kind,ne(()=>l=!1)),o.$set(K);const M={};!a&&_&15&&(a=!0,M.value=$[3].jat[$[0]][$[1]].movements[$[2]].score,ne(()=>a=!1)),s.$set(M);const U={};!p&&_&15&&(p=!0,U.value=$[3].jat[$[0]][$[1]].movements[$[2]].notes,ne(()=>p=!1)),g.$set(U)},i($){f||(w(e.$$.fragment,$),w(o.$$.fragment,$),w(s.$$.fragment,$),w(g.$$.fragment,$),f=!0)},o($){k(e.$$.fragment,$),k(o.$$.fragment,$),k(s.$$.fragment,$),k(g.$$.fragment,$),f=!1},d($){$&&(b(r),b(i),b(m)),q(e,$),q(o,$),q(s,$),q(g,$)}}}function Br(t,e,n){let r;Re(t,Q,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e;Nt(["cycling","walking & wheeling"]);let s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function a(f){t.$$.not_equal(r.jat[o][l].movements[i].name,f)&&(r.jat[o][l].movements[i].name=f,Q.set(r))}function m(f){t.$$.not_equal(r.jat[o][l].movements[i].kind,f)&&(r.jat[o][l].movements[i].kind=f,Q.set(r))}function g(f){t.$$.not_equal(r.jat[o][l].movements[i].score,f)&&(r.jat[o][l].movements[i].score=f,Q.set(r))}function p(f){t.$$.not_equal(r.jat[o][l].movements[i].notes,f)&&(r.jat[o][l].movements[i].notes=f,Q.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,l=f.stage),"idx"in f&&n(2,i=f.idx)},[o,l,i,r,s,a,m,g,p]}class Gr extends Ne{constructor(e){super(),Be(this,e,Br,Nr,Pe,{junctionIdx:0,stage:1,idx:2})}}const{window:zr}=pn;function yt(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function vt(t,e,n){const r=t.slice();return r[33]=e[n],r[32]=n,r}function Dr(t){let e,n,r,o,l,i,s,a;e=new yn({props:{$$slots:{default:[Rr]},$$scope:{ctx:t}}}),e.$on("click",t[26]),r=new It({props:{$$slots:{default:[Jr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const m=[Kr,Hr],g=[];function p(f,E){return f[3].kind=="movement"?0:1}return l=p(t),i=g[l]=m[l](t),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B(),i.c(),s=be()},l(f){F(e.$$.fragment,f),n=G(f),F(r.$$.fragment,f),o=G(f),i.l(f),s=be()},m(f,E){T(e,f,E),v(f,n,E),T(r,f,E),v(f,o,E),g[l].m(f,E),v(f,s,E),a=!0},p(f,E){const C={};E[1]&16&&(C.$$scope={dirty:E,ctx:f}),e.$set(C);const O={};E[1]&16&&(O.$$scope={dirty:E,ctx:f}),r.$set(O);let y=l;l=p(f),l===y?g[l].p(f,E):(me(),k(g[y],1,1,()=>{g[y]=null}),ce(),i=g[l],i?i.p(f,E):(i=g[l]=m[l](f),i.c()),w(i,1),i.m(s.parentNode,s))},i(f){a||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(i),a=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(i),a=!1},d(f){f&&(b(n),b(o),b(s)),q(e,f),q(r,f),g[l].d(f)}}}function Ur(t){let e,n,r,o,l,i,s,a=(t[8].jat[t[0]].name||"Untitled junction")+"",m,g,p,f,E,C,O,y="Arms",j,S,u,d,$,_="Movements",P,K,M,U,ge;e=new vn({props:{label:"Tools",$$slots:{default:[Wr]},$$scope:{ctx:t}}});function A(c,L){return c[8].jat[c[0]][c[1]].movements.length>0?Qr:Zr}let $e=A(t),le=$e(t);function Ae(c){t[19](c)}let je={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(je.value=t[2]),f=new qt({props:je}),te.push(()=>re(f,"value",Ae));let N=pe(t[8].jat[t[0]][t[1]].arms),Z=[];for(let c=0;c<N.length;c+=1)Z[c]=jt(vt(t,N,c));const We=c=>k(Z[c],1,1,()=>{Z[c]=null});let h=t[8].jat[t[0]][t[9]].arms.length>0&&Et(t),z=pe(t[8].jat[t[0]][t[1]].movements),D=[];for(let c=0;c<z.length;c+=1)D[c]=Ct(yt(t,z,c));const he=c=>k(D[c],1,1,()=>{D[c]=null});let W=t[8].jat[t[0]][t[9]].movements.length>0&&Lt(t);return{c(){I(e.$$.fragment),n=B(),r=x("p"),o=J("Total JAT score for "),l=J(t[1]),i=B(),s=x("u"),m=J(a),g=J(`
        :
        `),le.c(),p=B(),I(f.$$.fragment),C=B(),O=x("h3"),O.textContent=y,j=B(),S=x("ul");for(let c=0;c<Z.length;c+=1)Z[c].c();u=B(),h&&h.c(),d=B(),$=x("h3"),$.textContent=_,P=B(),K=x("ol");for(let c=0;c<D.length;c+=1)D[c].c();M=B(),W&&W.c(),U=be()},l(c){F(e.$$.fragment,c),n=G(c),r=ee(c,"P",{});var L=ie(r);o=H(L,"Total JAT score for "),l=H(L,t[1]),i=G(L),s=ee(L,"U",{});var ae=ie(s);m=H(ae,a),ae.forEach(b),g=H(L,`
        :
        `),le.l(L),L.forEach(b),p=G(c),F(f.$$.fragment,c),C=G(c),O=ee(c,"H3",{"data-svelte-h":!0}),ft(O)!=="svelte-ld74qb"&&(O.textContent=y),j=G(c),S=ee(c,"UL",{});var Se=ie(S);for(let se=0;se<Z.length;se+=1)Z[se].l(Se);Se.forEach(b),u=G(c),h&&h.l(c),d=G(c),$=ee(c,"H3",{"data-svelte-h":!0}),ft($)!=="svelte-1dc52s8"&&($.textContent=_),P=G(c),K=ee(c,"OL",{});var R=ie(K);for(let se=0;se<D.length;se+=1)D[se].l(R);R.forEach(b),M=G(c),W&&W.l(c),U=be()},m(c,L){T(e,c,L),v(c,n,L),v(c,r,L),oe(r,o),oe(r,l),oe(r,i),oe(r,s),oe(s,m),oe(r,g),le.m(r,null),v(c,p,L),T(f,c,L),v(c,C,L),v(c,O,L),v(c,j,L),v(c,S,L);for(let ae=0;ae<Z.length;ae+=1)Z[ae]&&Z[ae].m(S,null);v(c,u,L),h&&h.m(c,L),v(c,d,L),v(c,$,L),v(c,P,L),v(c,K,L);for(let ae=0;ae<D.length;ae+=1)D[ae]&&D[ae].m(K,null);v(c,M,L),W&&W.m(c,L),v(c,U,L),ge=!0},p(c,L){const ae={};L[0]&224|L[1]&16&&(ae.$$scope={dirty:L,ctx:c}),e.$set(ae),(!ge||L[0]&2)&&_e(l,c[1]),(!ge||L[0]&257)&&a!==(a=(c[8].jat[c[0]].name||"Untitled junction")+"")&&_e(m,a),$e===($e=A(c))&&le?le.p(c,L):(le.d(1),le=$e(c),le&&(le.c(),le.m(r,null)));const Se={};if(!E&&L[0]&4&&(E=!0,Se.value=c[2],ne(()=>E=!1)),f.$set(Se),L[0]&1299){N=pe(c[8].jat[c[0]][c[1]].arms);let R;for(R=0;R<N.length;R+=1){const se=vt(c,N,R);Z[R]?(Z[R].p(se,L),w(Z[R],1)):(Z[R]=jt(se),Z[R].c(),w(Z[R],1),Z[R].m(S,null))}for(me(),R=N.length;R<Z.length;R+=1)We(R);ce()}if(c[8].jat[c[0]][c[9]].arms.length>0?h?(h.p(c,L),L[0]&257&&w(h,1)):(h=Et(c),h.c(),w(h,1),h.m(d.parentNode,d)):h&&(me(),k(h,1,1,()=>{h=null}),ce()),L[0]&1299){z=pe(c[8].jat[c[0]][c[1]].movements);let R;for(R=0;R<z.length;R+=1){const se=yt(c,z,R);D[R]?(D[R].p(se,L),w(D[R],1)):(D[R]=Ct(se),D[R].c(),w(D[R],1),D[R].m(K,null))}for(me(),R=z.length;R<D.length;R+=1)he(R);ce()}c[8].jat[c[0]][c[9]].movements.length>0?W?(W.p(c,L),L[0]&257&&w(W,1)):(W=Lt(c),W.c(),w(W,1),W.m(U.parentNode,U)):W&&(me(),k(W,1,1,()=>{W=null}),ce())},i(c){if(!ge){w(e.$$.fragment,c),w(f.$$.fragment,c);for(let L=0;L<N.length;L+=1)w(Z[L]);w(h);for(let L=0;L<z.length;L+=1)w(D[L]);w(W),ge=!0}},o(c){k(e.$$.fragment,c),k(f.$$.fragment,c),Z=Z.filter(Boolean);for(let L=0;L<Z.length;L+=1)k(Z[L]);k(h),D=D.filter(Boolean);for(let L=0;L<D.length;L+=1)k(D[L]);k(W),ge=!1},d(c){c&&(b(n),b(r),b(p),b(C),b(O),b(j),b(S),b(u),b(d),b($),b(P),b(K),b(M),b(U)),q(e,c),le.d(),q(f,c),Oe(Z,c),h&&h.d(c),Oe(D,c),W&&W.d(c)}}}function Rr(t){let e;return{c(){e=J("Save")},l(n){e=H(n,"Save")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function Jr(t){let e;return{c(){e=J("Delete")},l(n){e=H(n,"Delete")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function Hr(t){let e,n,r;function o(i){t[27](i)}let l={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new tt({props:l}),te.push(()=>re(e,"value",o)),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,s){T(e,i,s),r=!0},p(i,s){const a={};!n&&s[0]&267&&(n=!0,a.value=i[8].jat[i[0]][i[1]].arms[i[3].idx].name,ne(()=>n=!1)),e.$set(a)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){q(e,i)}}}function Kr(t){let e,n;return e=new Gr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Xr(t){let e;return{c(){e=J("Zoom to fit")},l(n){e=H(n,"Zoom to fit")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function kt(t){var i;let e,n,r;function o(s){t[17](s)}let l={map:(i=t[7])==null?void 0:i.getMap()};return t[5]!==void 0&&(l.enabled=t[5]),e=new wn({props:l}),te.push(()=>re(e,"enabled",o)),{c(){I(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,a){T(e,s,a),r=!0},p(s,a){var g;const m={};a[0]&128&&(m.map=(g=s[7])==null?void 0:g.getMap()),!n&&a[0]&32&&(n=!0,m.enabled=s[5],ne(()=>n=!1)),e.$set(m)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){q(e,s)}}}function Vr(t){let e;return{c(){e=J("Show scheme context")},l(n){e=H(n,"Show scheme context")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function Wr(t){var O;let e,n,r,o,l,i,s=(O=t[7])==null?void 0:O.getMap(),a,m,g,p;e=new de({props:{$$slots:{default:[Xr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new hn({}),l=new $n({});let f=s&&kt(t);function E(y){t[18](y)}let C={$$slots:{default:[Vr]},$$scope:{ctx:t}};return t[6]!==void 0&&(C.checked=t[6]),m=new bn({props:C}),te.push(()=>re(m,"checked",E)),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B(),I(l.$$.fragment),i=B(),f&&f.c(),a=B(),I(m.$$.fragment)},l(y){F(e.$$.fragment,y),n=G(y),F(r.$$.fragment,y),o=G(y),F(l.$$.fragment,y),i=G(y),f&&f.l(y),a=G(y),F(m.$$.fragment,y)},m(y,j){T(e,y,j),v(y,n,j),T(r,y,j),v(y,o,j),T(l,y,j),v(y,i,j),f&&f.m(y,j),v(y,a,j),T(m,y,j),p=!0},p(y,j){var d;const S={};j[1]&16&&(S.$$scope={dirty:j,ctx:y}),e.$set(S),j[0]&128&&(s=(d=y[7])==null?void 0:d.getMap()),s?f?(f.p(y,j),j[0]&128&&w(f,1)):(f=kt(y),f.c(),w(f,1),f.m(a.parentNode,a)):f&&(me(),k(f,1,1,()=>{f=null}),ce());const u={};j[1]&16&&(u.$$scope={dirty:j,ctx:y}),!g&&j[0]&64&&(g=!0,u.checked=y[6],ne(()=>g=!1)),m.$set(u)},i(y){p||(w(e.$$.fragment,y),w(r.$$.fragment,y),w(l.$$.fragment,y),w(f),w(m.$$.fragment,y),p=!0)},o(y){k(e.$$.fragment,y),k(r.$$.fragment,y),k(l.$$.fragment,y),k(f),k(m.$$.fragment,y),p=!1},d(y){y&&(b(n),b(o),b(i),b(a)),q(e,y),q(r,y),q(l,y),f&&f.d(y),q(m,y)}}}function Zr(t){let e;return{c(){e=J("No movements added")},l(n){e=H(n,"No movements added")},m(n,r){v(n,e,r)},p:Me,d(n){n&&b(e)}}}function Qr(t){let e=Pt(t[8].jat[t[0]][t[1]]).toFixed(1)+"",n,r;return{c(){n=J(e),r=J("%")},l(o){n=H(o,e),r=H(o,"%")},m(o,l){v(o,n,l),v(o,r,l)},p(o,l){l[0]&259&&e!==(e=Pt(o[8].jat[o[0]][o[1]]).toFixed(1)+"")&&_e(n,e)},d(o){o&&(b(n),b(r))}}}function Yr(t){let e=ro(t[32])+"",n,r,o=(t[33].name||"Unnamed arm")+"",l;return{c(){n=J(e),r=J(" - "),l=J(o)},l(i){n=H(i,e),r=H(i," - "),l=H(i,o)},m(i,s){v(i,n,s),v(i,r,s),v(i,l,s)},p(i,s){s[0]&259&&o!==(o=(i[33].name||"Unnamed arm")+"")&&_e(l,o)},d(i){i&&(b(n),b(r),b(l))}}}function jt(t){let e,n,r,o;function l(){return t[20](t[32])}function i(){return t[21](t[32])}return n=new de({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[22]),{c(){e=x("li"),I(n.$$.fragment),r=B()},l(s){e=ee(s,"LI",{});var a=ie(e);F(n.$$.fragment,a),r=G(a),a.forEach(b)},m(s,a){v(s,e,a),T(n,e,null),oe(e,r),o=!0},p(s,a){t=s;const m={};a[0]&259|a[1]&16&&(m.$$scope={dirty:a,ctx:t}),n.$set(m)},i(s){o||(w(n.$$.fragment,s),o=!0)},o(s){k(n.$$.fragment,s),o=!1},d(s){s&&b(e),q(n)}}}function Et(t){let e,n;return e=new de({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function xr(t){let e,n;return{c(){e=J("Copy arms from "),n=J(t[9])},l(r){e=H(r,"Copy arms from "),n=H(r,t[9])},m(r,o){v(r,e,o),v(r,n,o)},p:Me,d(r){r&&(b(e),b(n))}}}function eo(t){let e=(t[30].name||"Unnamed movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o[0]&259&&e!==(e=(r[30].name||"Unnamed movement")+"")&&_e(n,e)},d(r){r&&b(n)}}}function Ct(t){let e,n,r,o;function l(){return t[23](t[32])}function i(){return t[24](t[32])}return n=new de({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[25]),{c(){e=x("li"),I(n.$$.fragment),r=B()},l(s){e=ee(s,"LI",{});var a=ie(e);F(n.$$.fragment,a),r=G(a),a.forEach(b)},m(s,a){v(s,e,a),T(n,e,null),oe(e,r),o=!0},p(s,a){t=s;const m={};a[0]&259|a[1]&16&&(m.$$scope={dirty:a,ctx:t}),n.$set(m)},i(s){o||(w(n.$$.fragment,s),o=!0)},o(s){k(n.$$.fragment,s),o=!1},d(s){s&&b(e),q(n)}}}function Lt(t){let e,n;return e=new de({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o[1]&16&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function to(t){let e,n;return{c(){e=J("Copy movements from "),n=J(t[9])},l(r){e=H(r,"Copy movements from "),n=H(r,t[9])},m(r,o){v(r,e,o),v(r,n,o)},p:Me,d(r){r&&(b(e),b(n))}}}function no(t){let e,n,r,o,l,i,s,a,m,g,p,f,E,C;function O(_){t[15](_)}let y={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(y.value=t[8].jat[t[0]][t[1]].notes),e=new Ot({props:y}),te.push(()=>re(e,"value",O));const j=[Ur,Dr],S=[];function u(_,P){return _[3]==null?0:1}i=u(t),s=S[i]=j[i](t);function d(_){t[29](_)}let $={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&($.editing=t[3]),g=new Or({props:$}),t[28](g),te.push(()=>re(g,"editing",d)),{c(){I(e.$$.fragment),r=B(),o=x("div"),l=x("div"),s.c(),a=B(),m=x("div"),I(g.$$.fragment),this.h()},l(_){F(e.$$.fragment,_),r=G(_),o=ee(_,"DIV",{style:!0});var P=ie(o);l=ee(P,"DIV",{style:!0});var K=ie(l);s.l(K),K.forEach(b),a=G(P),m=ee(P,"DIV",{style:!0});var M=ie(m);F(g.$$.fragment,M),M.forEach(b),P.forEach(b),this.h()},h(){Y(l,"width","30%"),Y(l,"overflow-y","scroll"),Y(l,"padding","10px"),Y(l,"border","1px solid black"),Y(m,"position","relative"),Y(m,"width","100%"),Y(o,"display","flex"),Y(o,"height","80vh")},m(_,P){T(e,_,P),v(_,r,P),v(_,o,P),oe(o,l),S[i].m(l,null),oe(o,a),oe(o,m),T(g,m,null),f=!0,E||(C=ln(zr,"keydown",t[12]),E=!0)},p(_,P){const K={};!n&&P[0]&259&&(n=!0,K.value=_[8].jat[_[0]][_[1]].notes,ne(()=>n=!1)),e.$set(K);let M=i;i=u(_),i===M?S[i].p(_,P):(me(),k(S[M],1,1,()=>{S[M]=null}),ce(),s=S[i],s?s.p(_,P):(s=S[i]=j[i](_),s.c()),w(s,1),s.m(l,null));const U={};P[0]&1&&(U.junctionIdx=_[0]),P[0]&2&&(U.stage=_[1]),P[0]&4&&(U.newKind=_[2]),P[0]&16&&(U.hoveringSidebar=_[4]),P[0]&32&&(U.streetviewOn=_[5]),P[0]&64&&(U.showContext=_[6]),!p&&P[0]&8&&(p=!0,U.editing=_[3],ne(()=>p=!1)),g.$set(U)},i(_){f||(w(e.$$.fragment,_),w(s),w(g.$$.fragment,_),f=!0)},o(_){k(e.$$.fragment,_),k(s),k(g.$$.fragment,_),f=!1},d(_){_&&(b(r),b(o)),q(e,_),S[i].d(),t[28](null),q(g),E=!1,C()}}}function ro(t){return String.fromCharCode(t+65)}function Pt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function oo(t,e,n){let r;Re(t,Q,N=>n(8,r=N));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",s="arm",a=null,m=null,g=!1,p=!0,f=null;function E(N){n(3,a=N),n(4,m=null)}function C(){window.confirm(`Delete this ${a.kind}?`)&&(a.kind=="movement"?(r.jat[o][l].movements.splice(a.idx,1),Q.set(r)):(r.jat[o][l].arms.splice(a.idx,1),Q.set(r)),n(3,a=null))}function O(N){a!=null&&N.key=="Escape"?(N.stopPropagation(),n(3,a=null)):a!=null&&N.key=="Delete"&&C()}function y(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(qe(Q,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),Q.set(r))}function j(){r.jat[o][l].movements.length>0&&!window.confirm("Overwrite movements?")||(qe(Q,r.jat[o][l].movements=JSON.parse(JSON.stringify(r.jat[o][i].movements)),r),Q.set(r))}function S(N){t.$$.not_equal(r.jat[o][l].notes,N)&&(r.jat[o][l].notes=N,Q.set(r))}const u=()=>f==null?void 0:f.zoom(!0);function d(N){g=N,n(5,g)}function $(N){p=N,n(6,p)}function _(N){s=N,n(2,s)}const P=N=>E({kind:"arm",idx:N}),K=N=>n(4,m={kind:"arm",idx:N}),M=()=>n(4,m=null),U=N=>E({kind:"movement",idx:N}),ge=N=>n(4,m={kind:"movement",idx:N}),A=()=>n(4,m=null),$e=()=>n(3,a=null);function le(N){t.$$.not_equal(r.jat[o][l].arms[a.idx].name,N)&&(r.jat[o][l].arms[a.idx].name=N,Q.set(r))}function Ae(N){te[N?"unshift":"push"](()=>{f=N,n(7,f)})}function je(N){a=N,n(3,a)}return t.$$set=N=>{"junctionIdx"in N&&n(0,o=N.junctionIdx),"stage"in N&&n(1,l=N.stage)},[o,l,s,a,m,g,p,f,r,i,E,C,O,y,j,S,u,d,$,_,P,K,M,U,ge,A,$e,le,Ae,je]}class io extends Ne{constructor(e){super(),Be(this,e,oo,no,Pe,{junctionIdx:0,stage:1},null,[-1,-1])}}function Mt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function lo(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,s,a,m,g,p,f,E=t[0].stage,C,O;a=new an({props:{$$slots:{default:[po]},$$scope:{ctx:t}}});function y(u){t[9](u)}let j={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(j.value=t[1].jat[t[0].idx].name),g=new tt({props:j}),te.push(()=>re(g,"value",y));let S=At(t);return{c(){e=x("h2"),r=J(n),o=J(" - "),i=J(l),s=B(),I(a.$$.fragment),m=B(),I(g.$$.fragment),f=B(),S.c(),C=be()},l(u){e=ee(u,"H2",{});var d=ie(e);r=H(d,n),o=H(d," - "),i=H(d,l),d.forEach(b),s=G(u),F(a.$$.fragment,u),m=G(u),F(g.$$.fragment,u),f=G(u),S.l(u),C=be()},m(u,d){v(u,e,d),oe(e,r),oe(e,o),oe(e,i),v(u,s,d),T(a,u,d),v(u,m,d),T(g,u,d),v(u,f,d),S.m(u,d),v(u,C,d),O=!0},p(u,d){(!O||d&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&_e(r,n),(!O||d&1)&&l!==(l=u[0].stage+"")&&_e(i,l);const $={};d&8193&&($.$$scope={dirty:d,ctx:u}),a.$set($);const _={};!p&&d&3&&(p=!0,_.value=u[1].jat[u[0].idx].name,ne(()=>p=!1)),g.$set(_),d&1&&Pe(E,E=u[0].stage)?(me(),k(S,1,1,Me),ce(),S=At(u),S.c(),w(S,1),S.m(C.parentNode,C)):S.p(u,d)},i(u){O||(w(a.$$.fragment,u),w(g.$$.fragment,u),w(S),O=!0)},o(u){k(a.$$.fragment,u),k(g.$$.fragment,u),k(S),O=!1},d(u){u&&(b(e),b(s),b(m),b(f),b(C)),q(a,u),q(g,u),S.d(u)}}}function ao(t){let e,n,r,o;e=new de({props:{$$slots:{default:[_o]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=pe(t[1].jat),i=[];for(let a=0;a<l.length;a+=1)i[a]=St(Mt(t,l,a));const s=a=>k(i[a],1,1,()=>{i[a]=null});return{c(){I(e.$$.fragment),n=B(),r=x("ol");for(let a=0;a<i.length;a+=1)i[a].c()},l(a){F(e.$$.fragment,a),n=G(a),r=ee(a,"OL",{});var m=ie(r);for(let g=0;g<i.length;g+=1)i[g].l(m);m.forEach(b)},m(a,m){T(e,a,m),v(a,n,m),v(a,r,m);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(r,null);o=!0},p(a,m){const g={};if(m&8192&&(g.$$scope={dirty:m,ctx:a}),e.$set(g),m&3){l=pe(a[1].jat);let p;for(p=0;p<l.length;p+=1){const f=Mt(a,l,p);i[p]?(i[p].p(f,m),w(i[p],1)):(i[p]=St(f),i[p].c(),w(i[p],1),i[p].m(r,null))}for(me(),p=l.length;p<i.length;p+=1)s(p);ce()}},i(a){if(!o){w(e.$$.fragment,a);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(a){k(e.$$.fragment,a),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)k(i[m]);o=!1},d(a){a&&(b(n),b(r)),q(e,a),Oe(i,a)}}}function so(t){let e;return{c(){e=J("Back to all junctions")},l(n){e=H(n,"Back to all junctions")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function uo(t){let e,n;return e=new de({props:{$$slots:{default:[mo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function fo(t){let e,n;return e=new de({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function mo(t){let e;return{c(){e=J("Edit Proposed")},l(n){e=H(n,"Edit Proposed")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function co(t){let e;return{c(){e=J("Edit Existing")},l(n){e=H(n,"Edit Existing")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function go(t){let e;return{c(){e=J("Delete")},l(n){e=H(n,"Delete")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function po(t){let e,n,r,o,l,i,s;e=new de({props:{$$slots:{default:[so]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const a=[fo,uo],m=[];function g(p,f){return p[0].stage=="proposed"?0:1}return r=g(t),o=m[r]=a[r](t),i=new It({props:{$$slots:{default:[go]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){I(e.$$.fragment),n=B(),o.c(),l=B(),I(i.$$.fragment)},l(p){F(e.$$.fragment,p),n=G(p),o.l(p),l=G(p),F(i.$$.fragment,p)},m(p,f){T(e,p,f),v(p,n,f),m[r].m(p,f),v(p,l,f),T(i,p,f),s=!0},p(p,f){const E={};f&8192&&(E.$$scope={dirty:f,ctx:p}),e.$set(E);let C=r;r=g(p),r===C?m[r].p(p,f):(me(),k(m[C],1,1,()=>{m[C]=null}),ce(),o=m[r],o?o.p(p,f):(o=m[r]=a[r](p),o.c()),w(o,1),o.m(l.parentNode,l));const O={};f&8192&&(O.$$scope={dirty:f,ctx:p}),i.$set(O)},i(p){s||(w(e.$$.fragment,p),w(o),w(i.$$.fragment,p),s=!0)},o(p){k(e.$$.fragment,p),k(o),k(i.$$.fragment,p),s=!1},d(p){p&&(b(n),b(l)),q(e,p),m[r].d(p),q(i,p)}}}function At(t){let e,n;return e=new io({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function _o(t){let e;return{c(){e=J("Add new junction")},l(n){e=H(n,"Add new junction")},m(n,r){v(n,e,r)},d(n){n&&b(e)}}}function ho(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){v(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&_e(n,e)},d(r){r&&b(n)}}}function St(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new de({props:{$$slots:{default:[ho]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=x("li"),I(n.$$.fragment),r=B()},l(i){e=ee(i,"LI",{});var s=ie(e);F(n.$$.fragment,s),r=G(s),s.forEach(b)},m(i,s){v(i,e,s),T(n,e,null),oe(e,r),o=!0},p(i,s){t=i;const a={};s&8194&&(a.$$scope={dirty:s,ctx:t}),n.$set(a)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&b(e),q(n)}}}function $o(t){let e,n,r,o;const l=[ao,lo],i=[];function s(a,m){return a[0].kind=="list"?0:a[0].kind=="edit"?1:-1}return~(e=s(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=be()},l(a){n&&n.l(a),r=be()},m(a,m){~e&&i[e].m(a,m),v(a,r,m),o=!0},p(a,[m]){let g=e;e=s(a),e===g?~e&&i[e].p(a,m):(n&&(me(),k(i[g],1,1,()=>{i[g]=null}),ce()),~e?(n=i[e],n?n.p(a,m):(n=i[e]=l[e](a),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(a){o||(w(n),o=!0)},o(a){k(n),o=!1},d(a){a&&b(r),~e&&i[e].d(a)}}}function Ze(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function bo(t,e,n){let r;Re(t,Q,E=>n(1,r=E));let o={kind:"list"};function l(){qe(Q,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(E){window.confirm("Delete this junction?")&&(r.jat.splice(E,1),Q.set(r),n(0,o={kind:"list"}))}const s=E=>n(0,o={kind:"edit",idx:E,stage:"existing"}),a=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"existing"}),g=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"proposed"}),p=()=>i(Ze(o));function f(E){t.$$.not_equal(r.jat[o.idx].name,E)&&(r.jat[o.idx].name=E,Q.set(r))}return[o,r,l,i,s,a,m,g,p,f]}class Oo extends Ne{constructor(e){super(),Be(this,e,bo,$o,Pe,{})}}export{Oo as component};
