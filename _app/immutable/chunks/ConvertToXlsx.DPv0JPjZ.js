import{s as R,r as D,a as x,g as b,i as f,w as N,f as p,k as F,e as W,t as B,c as E,d as J,I as H,q as I,v as j,n as K,p as q}from"./scheduler.Bpan6Ont.js";import{S as O,i as U,e as G,c as d,a as $,m as v,t as y,b as k,d as _}from"./index.B_gktW-4.js";import{h as V}from"./authority_names.C3GaQFlA.js";import"./SelectWithCustom.svelte_svelte_type_style_lang.DTayyJxX.js";import{S as A}from"./SecondaryButton.CdOzlW9k.js";import{W as X}from"./WarningText.sEvOLD9E.js";import{L as z}from"./Loading.DqclPNEg.js";import{M as Y}from"./Modal.Dki2TR_G.js";import"./paths.CYGn1jwE.js";import"./entry.DpZDEqol.js";import{d as Q}from"./download.C6h074W8.js";import{E as Z}from"./exceljs.min.DWizGZHR.js";import{g as ee,a as te}from"./lists.ubQNs_Tl.js";import{c as le,s as oe}from"./data.DKhm0m7X.js";const re=""+new URL("../assets/blank_route_check.BBlYPqT0.xlsx",import.meta.url).href;async function ne(e,o){console.log("Loading blank route check xlsx");let l=await(await fetch(re)).arrayBuffer(),r=new Z.Workbook;await r.xlsx.load(l),r.eachSheet((s,i)=>{s.conditionalFormattings=[]}),ae(e,r),ie(e,r),ue(e,r),ce(e,r),h(e.safetyCheck,r,"3.1 Safety Check",["J","K","L","M"],C([[13,28]])),h(e.streetCheck,r,"4.1 Street Check",["J","K","L","M"],C([[13,19],[23,25],[29,34],[38,43],[47,50]])),h(e.streetPlacemakingCheck,r,"4.2 Street Placemaking Check",["I","J","K","L"],C([[13,15],[19,21],[25,34],[38,47]])),h(e.pathCheck,r,"5.1 Path Check",["J","K","L","M"],C([[15,19],[23,33],[37,40],[44,48],[52,56]])),h(e.pathPlacemakingCheck,r,"5.2 Path Placemaking Check",["I","J","K","L"],C([[12,14],[20,22],[26,29],[33,41]])),me(e,r),r.getWorksheet("5.1 Path Check").getCell("D7").value=e.horseRiders,r.getWorksheet("7.1 Results Summary").getCell("G7").value=e.resultsReviewStatement,console.log("Writing route check xlsx");let n=await r.xlsx.writeBuffer();V(n,`route_check_${o}.xlsx`)}function ae(e,o){let t=o.getWorksheet("1. Summary of Scheme");t.getCell("C6").value=se(e.summary.dateDesignReview),t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.assessedRouteLengthKm,t.getCell("C19").value=e.summary.totalRouteLengthKm,t.getCell("C20").value=e.summary.notes,t.getCell("D22").value=e.summary.checkType=="path"?"Path Check":"Street Check";for(let l of e.summary.networkMap.features)if(l.geometry.type=="LineString"){let r=l.geometry.coordinates[0];t.getCell("C26").value=`${r[1]}, ${r[0]}`;let n=l.geometry.coordinates[l.geometry.coordinates.length-1];t.getCell("C27").value=`${n[1]}, ${n[0]}`,t.getCell("C28").value=`https://www.google.com/maps/@${r[1]},${r[0]},17z`;break}}function se(e){const o=e.split("-");if(o.length==3){const t=o[2],l=o[1],r=o[0];return`${t}/${l}/${r}`}return""}function ie(e,o){let t=o.getWorksheet("2.1 Policy Check");for(let l=0;l<6;l++)t.getCell("D"+(8+l)).value=e.policyCheck[l].existing,t.getCell("E"+(8+l)).value=e.policyCheck[l].proposed,t.getCell("F"+(8+l)).value=e.policyCheck[l].commentary}function ue(e,o){let t=o.getWorksheet("2.2 Policy Conflict Log");for(let[l,r]of e.policyConflictLog.entries())t.getCell("F"+(8+l)).value=ee(r.conflict),t.getCell("H"+(8+l)).value=r.stage,t.getCell("I"+(8+l)).value=M(r.point),t.getCell("J"+(8+l)).value=r.locationName,t.getCell("K"+(8+l)).value=r.stage==="Design"?"No":r.resolved,t.getCell("L"+(8+l)).value=r.notes;for(let l=0;l<42;l++)t.getCell("F"+(8+l)).dataValidation={type:"list",allowBlank:!0,formulae:["'8.2 Lookups&Forumlae2'!$B$7:$B$12"]}}function ce(e,o){let t=o.getWorksheet("3.2 Critical Issues Log");for(let[l,r]of e.criticalIssues.entries())t.getCell("F"+(8+l)).value=te(r.criticalIssue),t.getCell("H"+(8+l)).value=r.stage,t.getCell("I"+(8+l)).value=M(r.point),t.getCell("J"+(8+l)).value=r.locationName,t.getCell("K"+(8+l)).value=r.stage==="Design"?"No":r.resolved,t.getCell("L"+(8+l)).value=r.notes;for(let l=0;l<42;l++)t.getCell("F"+(8+l)).dataValidation={type:"list",allowBlank:!0,formulae:["'8.2 Lookups&Forumlae2'!$B$16:$B$39"]}}function h(e,o,t,l,r){let n=o.getWorksheet(t);if(r.length!=e.existingScores.length)throw new Error(`Wrong Excel ranges for ${t}`);for(let s=0;s<e.existingScores.length;s++){let i=r[s];n.getCell(l[0]+i).value=P(e.existingScores[s]),n.getCell(l[1]+i).value=e.existingScoreNotes[s],n.getCell(l[2]+i).value=P(e.proposedScores[s]),n.getCell(l[3]+i).value=e.proposedScoreNotes[s]}}function me(e,o){let t=o.getWorksheet("6. JAT Check"),l=0;for(let r of e.jat)for(let n of[r.existing,r.proposed]){let s=g("H",l*5);t.getCell(g(s,1)+"9").value=r.name,t.getCell(g(s,1)+"10").value=n.notes;for(let[i,u]of n.movements.filter(m=>m.kind=="walking & wheeling").entries())t.getCell(s+(13+i)).value=u.name,t.getCell(g(s,2)+(13+i)).value=T(u.score),t.getCell(g(s,3)+(13+i)).value=u.notes;for(let[i,u]of n.movements.filter(m=>m.kind=="cycling").entries())t.getCell(s+(26+i)).value=u.name,t.getCell(g(s,2)+(26+i)).value=T(u.score),t.getCell(g(s,3)+(26+i)).value=u.notes;l++}}function g(e,o){return fe(ge(e)+o)}function ge(e){let o=0;for(let t=0;t<e.length;t++)o*=26,o+=e.charCodeAt(t)-65+1;return o-1}function fe(e){let o="";for(e+=1;e>0;){let t=(e-1)%26;o=String.fromCharCode(t+65)+o,e=Math.floor((e-1)/26)}return o}function C(e){let o=[];for(let[t,l]of e)for(let r=t;r<=l;r++)o.push(r);return o}function P(e){return{"":e,C:e,0:0,1:1,2:2,"N/A":e}[e]}function T(e){return{0:0,1:1,2:2,X:e}[e]}function M(e){return`${e[1]}, ${e[0]}`}function pe(e){let o,t,l;return{c(){o=W("img"),l=B(`
  Export .xlsx`),this.h()},l(r){o=E(r,"IMG",{src:!0,alt:!0,style:!0}),l=J(r,`
  Export .xlsx`),this.h()},h(){H(o.src,t=Q)||I(o,"src",t),I(o,"alt",""),j(o,"vertical-align","middle")},m(r,n){f(r,o,n),f(r,l,n)},p:K,d(r){r&&(p(o),p(l))}}}function he(e){let o,t=`<li>When you open the file, you need to force Excel to recalculate all
        formulas with Ctrl + Alt + F9.</li> <li>The route coordinates in the Summary of Scheme may not capture
        everything mapped when the route is split into multiple pieces.</li> <li>The map weblink only shows the route start point.</li> <li>Graphs will not be exported. To share a summary of results, export
        relevant results pages as .pdf files from your we browser.</li> <li>Formatting changes may occur, including spreadsheet tab colours and
        other minor inconsistencies.</li> <li>In the JAT tab, only the scores will be exported - movement diagrams
        will be lost.</li> <li>The spreadsheet will be completely unprotected.</li>`;return{c(){o=W("ul"),o.innerHTML=t},l(l){o=E(l,"UL",{"data-svelte-h":!0}),q(o)!=="svelte-1gtaimv"&&(o.innerHTML=t)},m(l,r){f(l,o,r)},p:K,d(l){l&&p(o)}}}function Ce(e){let o;return{c(){o=B("OK")},l(t){o=J(t,"OK")},m(t,l){f(t,o,l)},d(t){t&&p(o)}}}function de(e){let o,t,l,r;return o=new X({props:{$$slots:{default:[he]},$$scope:{ctx:e}}}),l=new A({props:{$$slots:{default:[Ce]},$$scope:{ctx:e}}}),l.$on("click",e[3]),{c(){d(o.$$.fragment),t=x(),d(l.$$.fragment)},l(n){$(o.$$.fragment,n),t=b(n),$(l.$$.fragment,n)},m(n,s){v(o,n,s),f(n,t,s),v(l,n,s),r=!0},p(n,s){const i={};s&128&&(i.$$scope={dirty:s,ctx:n}),o.$set(i);const u={};s&128&&(u.$$scope={dirty:s,ctx:n}),l.$set(u)},i(n){r||(y(o.$$.fragment,n),y(l.$$.fragment,n),r=!0)},o(n){k(o.$$.fragment,n),k(l.$$.fragment,n),r=!1},d(n){n&&p(t),_(o,n),_(l,n)}}}function $e(e){let o,t,l,r,n,s,i;o=new A({props:{$$slots:{default:[pe]},$$scope:{ctx:e}}}),o.$on("click",e[2]),l=new z({props:{loading:e[0]}});function u(a){e[4](a)}let m={title:"Route check exported to Excel",$$slots:{default:[de]},$$scope:{ctx:e}};return e[1]!==void 0&&(m.open=e[1]),n=new Y({props:m}),D.push(()=>G(n,"open",u)),{c(){d(o.$$.fragment),t=x(),d(l.$$.fragment),r=x(),d(n.$$.fragment)},l(a){$(o.$$.fragment,a),t=b(a),$(l.$$.fragment,a),r=b(a),$(n.$$.fragment,a)},m(a,c){v(o,a,c),f(a,t,c),v(l,a,c),f(a,r,c),v(n,a,c),i=!0},p(a,[c]){const S={};c&128&&(S.$$scope={dirty:c,ctx:a}),o.$set(S);const L={};c&1&&(L.loading=a[0]),l.$set(L);const w={};c&130&&(w.$$scope={dirty:c,ctx:a}),!s&&c&2&&(s=!0,w.open=a[1],N(()=>s=!1)),n.$set(w)},i(a){i||(y(o.$$.fragment,a),y(l.$$.fragment,a),y(n.$$.fragment,a),i=!0)},o(a){k(o.$$.fragment,a),k(l.$$.fragment,a),k(n.$$.fragment,a),i=!1},d(a){a&&(p(t),p(r)),_(o,a),_(l,a),_(n,a)}}}function ve(e,o,t){let l,r;F(e,le,a=>t(5,l=a)),F(e,oe,a=>t(6,r=a));let n="",s=!1;async function i(){t(0,n="Converting to .xlsx (takes about 20 seconds)");try{await ne(r,l),t(1,s=!0)}catch(a){window.alert(`Conversion failed: ${a}`)}t(0,n="")}const u=()=>t(1,s=!1);function m(a){s=a,t(1,s)}return[n,s,i,u,m]}class Ee extends O{constructor(o){super(),U(this,o,ve,$e,R,{})}}export{Ee as C};
