import{s as De,r as He,a as S,g as E,i as C,w as Ye,f as $,U as Re,t as j,d as X,e as F,c as L,q as U,y as Me,n as fe,p as ue,l as Ve,b as O,v as je,h as d,j as ie,u as We,m as Ge,o as Pe,H as Ie,V as ae,K as qe,W as Je}from"./scheduler.DGwhun8C.js";import{S as Xe,i as Oe,e as Ne,c as W,a as G,m as P,t as D,b as H,d as q,g as we,f as ve}from"./index.B2vZYn3d.js";import{e as Fe}from"./each.osbS1YKp.js";import{g as Le}from"./entry.DSp3k-YW.js";import{b as pe}from"./paths.xS7WD_4K.js";import{a as Be,d as xe}from"./index._BuZCfh8.js";import{S as Ue,A as Ke}from"./ServiceHeader.V5J_QdS7.js";import{F as ze}from"./FileInput.CkACidO6.js";import"./SelectWithCustom.svelte_svelte_type_style_lang.5m1AGxEU.js";import{S as ce}from"./SecondaryButton.zQkvdoBX.js";import{W as Qe}from"./WarningButton.B3j9Frnm.js";import{F as Ze}from"./FormElement.Cd26lsYY.js";import{W as et}from"./WarningText.wRiJ9IQ1.js";import{L as tt}from"./Loading.Bgdi-Hsv.js";import{M as lt}from"./Modal.uz-o5mEC.js";function nt(n){let e;return{c(){e=j("Import from XLSX file")},l(t){e=X(t,"Import from XLSX file")},m(t,l){C(t,e,l)},d(t){t&&$(e)}}}function rt(n){let e,t,l;return{c(){e=F("input"),this.h()},l(a){e=L(a,"INPUT",{class:!0,id:!0,type:!0}),this.h()},h(){U(e,"class","govuk-file-upload"),U(e,"id","import-xlsx"),U(e,"type","file")},m(a,o){C(a,e,o),n[6](e),t||(l=Me(e,"change",n[3]),t=!0)},p:fe,d(a){a&&$(e),n[6](null),t=!1,l()}}}function ot(n){let e,t=`You can import from an existing route check .xlsx file, <b>only if there&#39;s an up-to-date DALOG sheet added</b>
      . After importing, there will still be some problems:`,l,a,o=`<li>You must fill out the Junction Assessment Tool (JAT); it won&#39;t be
        imported</li> <li>Some text fields on the Summary of Scheme page will be missing</li>`;return{c(){e=F("p"),e.innerHTML=t,l=S(),a=F("ul"),a.innerHTML=o},l(s){e=L(s,"P",{"data-svelte-h":!0}),ue(e)!=="svelte-1ykh4hv"&&(e.innerHTML=t),l=E(s),a=L(s,"UL",{"data-svelte-h":!0}),ue(a)!=="svelte-1tt4pqo"&&(a.innerHTML=o)},m(s,r){C(s,e,r),C(s,l,r),C(s,a,r)},p:fe,d(s){s&&($(e),$(l),$(a))}}}function st(n){let e;return{c(){e=j("Close")},l(t){e=X(t,"Close")},m(t,l){C(t,e,l)},d(t){t&&$(e)}}}function at(n){let e,t,l,a,o,s;return e=new Ze({props:{label:"Import from XLSX file",id:"import-xlsx",$$slots:{default:[rt]},$$scope:{ctx:n}}}),l=new et({props:{$$slots:{default:[ot]},$$scope:{ctx:n}}}),o=new ce({props:{$$slots:{default:[st]},$$scope:{ctx:n}}}),o.$on("click",n[7]),{c(){W(e.$$.fragment),t=S(),W(l.$$.fragment),a=S(),W(o.$$.fragment)},l(r){G(e.$$.fragment,r),t=E(r),G(l.$$.fragment,r),a=E(r),G(o.$$.fragment,r)},m(r,h){P(e,r,h),C(r,t,h),P(l,r,h),C(r,a,h),P(o,r,h),s=!0},p(r,h){const w={};h&1028&&(w.$$scope={dirty:h,ctx:r}),e.$set(w);const u={};h&1024&&(u.$$scope={dirty:h,ctx:r}),l.$set(u);const c={};h&1024&&(c.$$scope={dirty:h,ctx:r}),o.$set(c)},i(r){s||(D(e.$$.fragment,r),D(l.$$.fragment,r),D(o.$$.fragment,r),s=!0)},o(r){H(e.$$.fragment,r),H(l.$$.fragment,r),H(o.$$.fragment,r),s=!1},d(r){r&&($(t),$(a)),q(e,r),q(l,r),q(o,r)}}}function it(n){let e,t,l,a,o,s,r;e=new ce({props:{$$slots:{default:[nt]},$$scope:{ctx:n}}}),e.$on("click",n[5]),l=new tt({props:{loading:n[0]}});function h(u){n[8](u)}let w={title:"Import from XLSX file",$$slots:{default:[at]},$$scope:{ctx:n}};return n[1]!==void 0&&(w.open=n[1]),o=new lt({props:w}),He.push(()=>Ne(o,"open",h)),{c(){W(e.$$.fragment),t=S(),W(l.$$.fragment),a=S(),W(o.$$.fragment)},l(u){G(e.$$.fragment,u),t=E(u),G(l.$$.fragment,u),a=E(u),G(o.$$.fragment,u)},m(u,c){P(e,u,c),C(u,t,c),P(l,u,c),C(u,a,c),P(o,u,c),r=!0},p(u,[c]){const _={};c&1024&&(_.$$scope={dirty:c,ctx:u}),e.$set(_);const i={};c&1&&(i.loading=u[0]),l.$set(i);const T={};c&1030&&(T.$$scope={dirty:c,ctx:u}),!s&&c&2&&(s=!0,T.open=u[1],Ye(()=>s=!1)),o.$set(T)},i(u){r||(D(e.$$.fragment,u),D(l.$$.fragment,u),D(o.$$.fragment,u),r=!0)},o(u){H(e.$$.fragment,u),H(l.$$.fragment,u),H(o.$$.fragment,u),r=!1},d(u){u&&($(t),$(a)),q(e,u),q(l,u),q(o,u)}}}function ft(n,e,t){let l=Re(),{xlsxImporter:a}=e,o="",s=!1,r;async function h(i){let T=r.files[0].name;try{t(0,o=`Loading ${T}`);let m=await r.files[0].arrayBuffer(),g=await a(m);t(0,o=""),l("imported",{filename:Be(T,".xlsx"),data:g})}catch(m){window.alert(`Couldn't import ${T}: ${m}`),t(0,o="")}}const w=()=>t(1,s=!0);function u(i){He[i?"unshift":"push"](()=>{r=i,t(2,r)})}const c=()=>t(1,s=!1);function _(i){s=i,t(1,s)}return n.$$set=i=>{"xlsxImporter"in i&&t(4,a=i.xlsxImporter)},[o,s,r,h,a,w,u,c,_]}class ut extends Xe{constructor(e){super(),Oe(this,e,ft,it,De,{xlsxImporter:4})}}function Se(n,e,t){const l=n.slice();return l[21]=e[t],l}const ct=n=>({}),Ee=n=>({});function Ce(n){let e,t,l="You are editing:",a,o,s,r;return{c(){e=F("p"),t=F("b"),t.textContent=l,a=S(),o=F("a"),s=j(n[7]),this.h()},l(h){e=L(h,"P",{});var w=O(e);t=L(w,"B",{"data-svelte-h":!0}),ue(t)!=="svelte-1kt2tqj"&&(t.textContent=l),a=E(w),o=L(w,"A",{href:!0});var u=O(o);s=X(u,n[7]),u.forEach($),w.forEach($),this.h()},h(){U(o,"href",r=`${pe}/${n[0].prefix}overview`)},m(h,w){C(h,e,w),d(e,t),d(e,a),d(e,o),d(o,s)},p(h,w){w&128&&ie(s,h[7]),w&1&&r!==(r=`${pe}/${h[0].prefix}overview`)&&U(o,"href",r)},d(h){h&&$(e)}}}function mt(n){let e,t="No saved files";return{c(){e=F("p"),e.textContent=t},l(l){e=L(l,"P",{"data-svelte-h":!0}),ue(e)!=="svelte-yojds1"&&(e.textContent=t)},m(l,a){C(l,e,a)},p:fe,i:fe,o:fe,d(l){l&&$(e)}}}function _t(n){let e,t="Manage existing files",l,a,o,s,r,h="<tr><th>File name</th> <th>Scheme name</th> <th>Action</th></tr>",w,u,c;a=new ce({props:{$$slots:{default:[pt]},$$scope:{ctx:n}}}),a.$on("click",n[15]);let _=Fe(n[6]),i=[];for(let m=0;m<_.length;m+=1)i[m]=Te(Se(n,_,m));const T=m=>H(i[m],1,1,()=>{i[m]=null});return{c(){e=F("h2"),e.textContent=t,l=S(),W(a.$$.fragment),o=S(),s=F("table"),r=F("thead"),r.innerHTML=h,w=S(),u=F("tbody");for(let m=0;m<i.length;m+=1)i[m].c()},l(m){e=L(m,"H2",{"data-svelte-h":!0}),ue(e)!=="svelte-1d50rjn"&&(e.textContent=t),l=E(m),G(a.$$.fragment,m),o=E(m),s=L(m,"TABLE",{});var g=O(s);r=L(g,"THEAD",{"data-svelte-h":!0}),ue(r)!=="svelte-gvkk9f"&&(r.innerHTML=h),w=E(g),u=L(g,"TBODY",{});var k=O(u);for(let v=0;v<i.length;v+=1)i[v].l(k);k.forEach($),g.forEach($)},m(m,g){C(m,e,g),C(m,l,g),P(a,m,g),C(m,o,g),C(m,s,g),d(s,r),d(s,w),d(s,u);for(let k=0;k<i.length;k+=1)i[k]&&i[k].m(u,null);c=!0},p(m,g){const k={};if(g&524288&&(k.$$scope={dirty:g,ctx:m}),a.$set(k),g&9025){_=Fe(m[6]);let v;for(v=0;v<_.length;v+=1){const J=Se(m,_,v);i[v]?(i[v].p(J,g),D(i[v],1)):(i[v]=Te(J),i[v].c(),D(i[v],1),i[v].m(u,null))}for(we(),v=_.length;v<i.length;v+=1)T(v);ve()}},i(m){if(!c){D(a.$$.fragment,m);for(let g=0;g<_.length;g+=1)D(i[g]);c=!0}},o(m){H(a.$$.fragment,m),i=i.filter(Boolean);for(let g=0;g<i.length;g+=1)H(i[g]);c=!1},d(m){m&&($(e),$(l),$(o),$(s)),q(a,m),qe(i,m)}}}function pt(n){let e;return{c(){e=j("Export all files for backup")},l(t){e=X(t,"Export all files for backup")},m(t,l){C(t,e,l)},d(t){t&&$(e)}}}function dt(n){let e;return{c(){e=j("Rename")},l(t){e=X(t,"Rename")},m(t,l){C(t,e,l)},d(t){t&&$(e)}}}function $t(n){let e;return{c(){e=j("Delete")},l(t){e=X(t,"Delete")},m(t,l){C(t,e,l)},d(t){t&&$(e)}}}function Te(n){let e,t,l,a=n[21]+"",o,s,r,h=n[0].describeFile(n[21])+"",w,u,c,_,i,T,m,g,k,v,J;function B(){return n[16](n[21])}function Y(){return n[17](n[21])}i=new ce({props:{$$slots:{default:[dt]},$$scope:{ctx:n}}}),i.$on("click",Y);function re(){return n[18](n[21])}return m=new Qe({props:{$$slots:{default:[$t]},$$scope:{ctx:n}}}),m.$on("click",re),{c(){e=F("tr"),t=F("td"),l=F("a"),o=j(a),s=S(),r=F("td"),w=j(h),u=S(),c=F("td"),_=F("div"),W(i.$$.fragment),T=S(),W(m.$$.fragment),g=S(),this.h()},l(b){e=L(b,"TR",{});var y=O(e);t=L(y,"TD",{});var K=O(t);l=L(K,"A",{href:!0});var x=O(l);o=X(x,a),x.forEach($),K.forEach($),s=E(y),r=L(y,"TD",{});var te=O(r);w=X(te,h),te.forEach($),u=E(y),c=L(y,"TD",{});var f=O(c);_=L(f,"DIV",{class:!0,style:!0});var A=O(_);G(i.$$.fragment,A),T=E(A),G(m.$$.fragment,A),A.forEach($),f.forEach($),g=E(y),y.forEach($),this.h()},h(){U(l,"href","#"),U(_,"class","govuk-button-group"),je(_,"flex-wrap","nowrap")},m(b,y){C(b,e,y),d(e,t),d(t,l),d(l,o),d(e,s),d(e,r),d(r,w),d(e,u),d(e,c),d(c,_),P(i,_,null),d(_,T),P(m,_,null),d(e,g),k=!0,v||(J=Me(l,"click",Je(B)),v=!0)},p(b,y){n=b,(!k||y&64)&&a!==(a=n[21]+"")&&ie(o,a),(!k||y&65)&&h!==(h=n[0].describeFile(n[21])+"")&&ie(w,h);const K={};y&524288&&(K.$$scope={dirty:y,ctx:n}),i.$set(K);const x={};y&524288&&(x.$$scope={dirty:y,ctx:n}),m.$set(x)},i(b){k||(D(i.$$.fragment,b),D(m.$$.fragment,b),k=!0)},o(b){H(i.$$.fragment,b),H(m.$$.fragment,b),k=!1},d(b){b&&$(e),q(i),q(m),v=!1,J()}}}function ht(n){let e;return{c(){e=j("Create new file")},l(t){e=X(t,"Create new file")},m(t,l){C(t,e,l)},d(t){t&&$(e)}}}function Ae(n){let e,t,l,a;return l=new ut({props:{xlsxImporter:n[5]}}),l.$on("imported",n[12]),{c(){e=F("hr"),t=S(),W(l.$$.fragment)},l(o){e=L(o,"HR",{}),t=E(o),G(l.$$.fragment,o)},m(o,s){C(o,e,s),C(o,t,s),P(l,o,s),a=!0},p(o,s){const r={};s&32&&(r.xlsxImporter=o[5]),l.$set(r)},i(o){a||(D(l.$$.fragment,o),a=!0)},o(o){H(l.$$.fragment,o),a=!1},d(o){o&&($(e),$(t)),q(l,o)}}}function gt(n){let e,t,l,a,o,s,r,h,w,u,c,_,i,T,m,g,k,v,J,B,Y,re,b,y,K,x,te,f,A,V,Q,me,de,oe,$e,Z;e=new Ue({props:{service:n[3]}}),a=new Ke({});const he=n[14].description,N=Ve(he,n,n[19],Ee);let R=n[7]&&Ce(n);const ke=[_t,mt],le=[];function ye(p,I){return p[6].length>0?0:1}B=ye(n),Y=le[B]=ke[B](n),f=new ce({props:{$$slots:{default:[ht]},$$scope:{ctx:n}}}),f.$on("click",n[10]),oe=new ze({props:{label:"Select a .json file",onLoad:n[11]}});let M=n[5]!=null&&Ae(n);return{c(){W(e.$$.fragment),t=S(),l=F("div"),W(a.$$.fragment),o=S(),s=F("h1"),r=j("Manage my "),h=j(n[4]),w=j("s"),u=S(),c=F("div"),_=F("div"),N&&N.c(),i=S(),T=F("p"),m=j("On this page you can manage your "),g=j(n[4]),k=j(` files. All files are auto-saved
        in your browser's local storage. You can close your browser and continue
        later.`),v=S(),R&&R.c(),J=S(),Y.c(),re=S(),b=F("div"),y=F("h2"),K=j("Create a new "),x=j(n[4]),te=S(),W(f.$$.fragment),A=S(),V=F("h2"),Q=j("Import a saved "),me=j(n[4]),de=S(),W(oe.$$.fragment),$e=S(),M&&M.c(),this.h()},l(p){G(e.$$.fragment,p),t=E(p),l=L(p,"DIV",{class:!0});var I=O(l);G(a.$$.fragment,I),o=E(I),s=L(I,"H1",{style:!0});var se=O(s);r=X(se,"Manage my "),h=X(se,n[4]),w=X(se,"s"),se.forEach($),u=E(I),c=L(I,"DIV",{class:!0});var ne=O(c);_=L(ne,"DIV",{class:!0});var z=O(_);N&&N.l(z),i=E(z),T=L(z,"P",{});var _e=O(T);m=X(_e,"On this page you can manage your "),g=X(_e,n[4]),k=X(_e,` files. All files are auto-saved
        in your browser's local storage. You can close your browser and continue
        later.`),_e.forEach($),v=E(z),R&&R.l(z),J=E(z),Y.l(z),z.forEach($),re=E(ne),b=L(ne,"DIV",{class:!0});var ee=O(b);y=L(ee,"H2",{class:!0});var ge=O(y);K=X(ge,"Create a new "),x=X(ge,n[4]),ge.forEach($),te=E(ee),G(f.$$.fragment,ee),A=E(ee),V=L(ee,"H2",{});var be=O(V);Q=X(be,"Import a saved "),me=X(be,n[4]),be.forEach($),de=E(ee),G(oe.$$.fragment,ee),$e=E(ee),M&&M.l(ee),ee.forEach($),ne.forEach($),I.forEach($),this.h()},h(){je(s,"margin-top","30px"),U(_,"class","govuk-grid-column-two-thirds"),U(y,"class","green-bar svelte-1z050ke"),U(b,"class","govuk-grid-column-one-third"),U(c,"class","govuk-grid-row"),U(l,"class","govuk-width-container")},m(p,I){P(e,p,I),C(p,t,I),C(p,l,I),P(a,l,null),d(l,o),d(l,s),d(s,r),d(s,h),d(s,w),d(l,u),d(l,c),d(c,_),N&&N.m(_,null),d(_,i),d(_,T),d(T,m),d(T,g),d(T,k),d(_,v),R&&R.m(_,null),d(_,J),le[B].m(_,null),d(c,re),d(c,b),d(b,y),d(y,K),d(y,x),d(b,te),P(f,b,null),d(b,A),d(b,V),d(V,Q),d(V,me),d(b,de),P(oe,b,null),d(b,$e),M&&M.m(b,null),Z=!0},p(p,[I]){const se={};I&8&&(se.service=p[3]),e.$set(se),(!Z||I&16)&&ie(h,p[4]),N&&N.p&&(!Z||I&524288)&&We(N,he,p,p[19],Z?Pe(he,p[19],I,ct):Ge(p[19]),Ee),(!Z||I&16)&&ie(g,p[4]),p[7]?R?R.p(p,I):(R=Ce(p),R.c(),R.m(_,J)):R&&(R.d(1),R=null);let ne=B;B=ye(p),B===ne?le[B].p(p,I):(we(),H(le[ne],1,1,()=>{le[ne]=null}),ve(),Y=le[B],Y?Y.p(p,I):(Y=le[B]=ke[B](p),Y.c()),D(Y,1),Y.m(_,null)),(!Z||I&16)&&ie(x,p[4]);const z={};I&524288&&(z.$$scope={dirty:I,ctx:p}),f.$set(z),(!Z||I&16)&&ie(me,p[4]),p[5]!=null?M?(M.p(p,I),I&32&&D(M,1)):(M=Ae(p),M.c(),D(M,1),M.m(b,null)):M&&(we(),H(M,1,1,()=>{M=null}),ve())},i(p){Z||(D(e.$$.fragment,p),D(a.$$.fragment,p),D(N,p),D(Y),D(f.$$.fragment,p),D(oe.$$.fragment,p),D(M),Z=!0)},o(p){H(e.$$.fragment,p),H(a.$$.fragment,p),H(N,p),H(Y),H(f.$$.fragment,p),H(oe.$$.fragment,p),H(M),Z=!1},d(p){p&&($(t),$(l)),q(e,p),q(a),N&&N.d(p),R&&R.d(),le[B].d(),q(f),q(oe),M&&M.d()}}}function bt(n,e,t){let l,a=fe,o=()=>(a(),a=Ie(i,f=>t(20,l=f)),i),s,r=fe,h=()=>(r(),r=Ie(_,f=>t(7,s=f)),_);n.$$.on_destroy.push(()=>a()),n.$$.on_destroy.push(()=>r());let{$$slots:w={},$$scope:u}=e,{files:c}=e,{currentFile:_}=e;h();let{state:i}=e;o();let{service:T}=e,{fileObjectType:m}=e,{xlsxImporter:g=null}=e,k=c.getFileList();function v(f){let A=window.prompt(`Rename file ${f} to what?`,f);if(A){let V=c.key(f),Q=window.localStorage.getItem(V);window.localStorage.setItem(c.key(A),Q),window.localStorage.removeItem(V),t(6,k=c.getFileList()),s==f&&ae(_,s=A,s)}}function J(f){if(!window.confirm(`Really delete file ${f}? You can't undo this. (If you delete, a copy will still be downloaded to your browser's download folder, in case you make a mistake.)`))return;let A=c.key(f);xe(`${f}.json`,window.localStorage.getItem(A)),window.localStorage.removeItem(A),s==f&&(ae(_,s="",s),ae(i,l=c.emptyState(),l),window.localStorage.setItem(c.key("last-opened-file"),"")),t(6,k=c.getFileList())}function B(){let f=window.prompt("What do you want to name your new file?");f&&(ae(_,s=f,s),ae(i,l=c.emptyState(),l),t(6,k=c.saveAndGetFileList(s,l)),Le(`${pe}/${c.prefix}overview`))}function Y(f,A){let V=Be(f,".json");try{let Q=JSON.parse(A);c.validate(Q),t(6,k=c.saveAndGetFileList(V,Q)),b(V)}catch(Q){window.alert(`Couldn't load ${V}: ${Q}`)}}function re(f){let{filename:A,data:V}=f.detail;t(6,k=c.saveAndGetFileList(A,V)),b(A)}function b(f){try{let A=c.loadFile(f);ae(_,s=f,s),ae(i,l=A,l),Le(`${pe}/${c.prefix}overview`)}catch(A){window.alert(`Couldn't load ${f}: ${A}`)}return!1}const y=()=>c.exportAll(),K=f=>b(f),x=f=>v(f),te=f=>J(f);return n.$$set=f=>{"files"in f&&t(0,c=f.files),"currentFile"in f&&h(t(1,_=f.currentFile)),"state"in f&&o(t(2,i=f.state)),"service"in f&&t(3,T=f.service),"fileObjectType"in f&&t(4,m=f.fileObjectType),"xlsxImporter"in f&&t(5,g=f.xlsxImporter),"$$scope"in f&&t(19,u=f.$$scope)},[c,_,i,T,m,g,k,s,v,J,B,Y,re,b,w,y,K,x,te,u]}class jt extends Xe{constructor(e){super(),Oe(this,e,bt,gt,De,{files:0,currentFile:1,state:2,service:3,fileObjectType:4,xlsxImporter:5})}}export{jt as F};
