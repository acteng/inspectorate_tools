import{s as Le,r as me,w as de,l as Bt,u as Rt,m as Ft,o as qt,D as Me,e as Z,a as O,c as X,b as Q,f as _,g as P,i as y,t as V,d as J,p as Fe,v as te,h as C,K as je,q as ne,j as fe,k as He,V as Re,_ as Yt,E as ke,I as zt,O as Ve,P as Je,n as Ae,y as Ut,G as lt,W as xt}from"../chunks/scheduler.Bpan6Ont.js";import{S as Ne,i as Oe,e as _e,c as q,a as z,m as U,t as k,b as T,d as G,g as ve,f as be}from"../chunks/index.B_gktW-4.js";import{e as ge}from"../chunks/each.rqQRCiyP.js";import{G as en,S as tn,C as xe}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.CetTLcgq.js";import{B as nn}from"../chunks/ButtonGroup.NiDQIiQf.js";import{D as et}from"../chunks/DefaultButton.pW5DN5JW.js";import"../chunks/SelectWithCustom.svelte_svelte_type_style_lang.DwZHIC7P.js";import{S as Pe}from"../chunks/SecondaryButton.DPeOVvsh.js";import{T as tt}from"../chunks/TextInput.DbE7zhpz.js";import{W as nt}from"../chunks/WarningButton.BjgVp-1z.js";import{p as Ze,c as rt}from"../chunks/authority_names.D1F0BlqS.js";import"../chunks/paths.DG2_gtVS.js";import"../chunks/entry.zgcpFzmw.js";import{s as le}from"../chunks/data.DyZeCl94.js";import{g as on}from"../chunks/globals.D0QH3NT1.js";import{c as Te}from"../chunks/colors.DaC397qr.js";import{M as ze,B as ln,C as rn}from"../chunks/Marker.vIrua2M4.js";import"../chunks/index.BhP5kGAr.js";import{v as an,l as sn,d as Ie,w as Ke,x as fn,y as Gt,z as un,M as cn,k as mn,G as it,b as gn,L as Qe,h as at,C as dn}from"../chunks/index.ECEdLopW.js";import{C as _n}from"../chunks/CollapsibleCard.CnaEhlqF.js";import{T as Ht}from"../chunks/TextArea.DUnI-n9_.js";import{R as Ue}from"../chunks/Radio.B7lg4JHQ.js";import{M as pn}from"../chunks/Modal.DYgxY6Kl.js";import{E as hn}from"../chunks/ExternalLink.fPkBc3Rj.js";import{g as Ye,t as $n}from"../chunks/index.B54rbVRu.js";import{I as Xe,p as vn,G as bn}from"../chunks/pan.CpJQy5iw.js";import{R as kn}from"../chunks/RouteMapLayer.u1YpxmVA.js";import{P as Vt}from"../chunks/Popup.jzXvSAkr.js";function wn(n){let e;const t=n[16].default,o=Bt(t,n,n[24],null);return{c(){o&&o.c()},l(l){o&&o.l(l)},m(l,i){o&&o.m(l,i),e=!0},p(l,i){o&&o.p&&(!e||i&16777216)&&Rt(o,t,l,l[24],e?qt(t,l[24],i,null):Ft(l[24]),null)},i(l){e||(k(o,l),e=!0)},o(l){T(o,l),e=!1},d(l){o&&o.d(l)}}}function yn(n){let e,t,o;function l(r){n[17](r)}let i={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[wn]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.hovered=n[0]),e=new an({props:i}),me.push(()=>_e(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){q(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,a){U(e,r,a),o=!0},p(r,[a]){const s={};a&2&&(s.id=r[1]),a&4&&(s.source=r[2]),a&8&&(s.sourceLayer=r[3]),a&16&&(s.beforeId=r[4]),a&32&&(s.beforeLayerType=r[5]),a&64&&(s.paint=r[6]),a&128&&(s.layout=r[7]),a&256&&(s.filter=r[8]),a&512&&(s.applyToClusters=r[9]),a&1024&&(s.minzoom=r[10]),a&2048&&(s.maxzoom=r[11]),a&4096&&(s.hoverCursor=r[12]),a&8192&&(s.manageHoverState=r[13]),a&16384&&(s.eventsIfTopMost=r[14]),a&32768&&(s.interactive=r[15]),a&16777216&&(s.$$scope={dirty:a,ctx:r}),!t&&a&1&&(t=!0,s.hovered=r[0],de(()=>t=!1)),e.$set(s)},i(r){o||(k(e.$$.fragment,r),o=!0)},o(r){T(e.$$.fragment,r),o=!1},d(r){G(e,r)}}}function jn(n,e,t){let{$$slots:o={},$$scope:l}=e,{id:i=sn("symbol")}=e,{source:r=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:c=void 0}=e,{layout:m=void 0}=e,{filter:g=void 0}=e,{applyToClusters:$=void 0}=e,{minzoom:I=void 0}=e,{maxzoom:H=void 0}=e,{hoverCursor:S=void 0}=e,{manageHoverState:K=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:w=!1}=e,{interactive:N=!0}=e;function u(v){h=v,t(0,h)}function p(v){Me.call(this,n,v)}function d(v){Me.call(this,n,v)}function W(v){Me.call(this,n,v)}function F(v){Me.call(this,n,v)}function b(v){Me.call(this,n,v)}function D(v){Me.call(this,n,v)}return n.$$set=v=>{"id"in v&&t(1,i=v.id),"source"in v&&t(2,r=v.source),"sourceLayer"in v&&t(3,a=v.sourceLayer),"beforeId"in v&&t(4,s=v.beforeId),"beforeLayerType"in v&&t(5,f=v.beforeLayerType),"paint"in v&&t(6,c=v.paint),"layout"in v&&t(7,m=v.layout),"filter"in v&&t(8,g=v.filter),"applyToClusters"in v&&t(9,$=v.applyToClusters),"minzoom"in v&&t(10,I=v.minzoom),"maxzoom"in v&&t(11,H=v.maxzoom),"hoverCursor"in v&&t(12,S=v.hoverCursor),"manageHoverState"in v&&t(13,K=v.manageHoverState),"hovered"in v&&t(0,h=v.hovered),"eventsIfTopMost"in v&&t(14,w=v.eventsIfTopMost),"interactive"in v&&t(15,N=v.interactive),"$$scope"in v&&t(24,l=v.$$scope)},[h,i,r,a,s,f,c,m,g,$,I,H,S,K,w,N,o,u,p,d,W,F,b,D,l]}class Cn extends Ne{constructor(e){super(),Oe(this,e,jn,yn,Le,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}const De={"Any type of junction":{"All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{"Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{"Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{"All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{"All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}},Jt=Object.keys(De);function Ge(n){return Object.keys(De[n])}const Se="All movements";function st(n,e){let t=[],o=De[n][e];o&&t.push({junctionType:n,movementType:e,...o});let l=De[n][Se];if(l&&e!=Se&&t.push({junctionType:n,movementType:Se,...l}),n=="Crossroads"){let i=De["Simple priority T-junction"][Se];i&&t.push({junctionType:"Simple priority T-junction",movementType:Se,...i})}if(n!="Any type of junction"){let i=De["Any type of junction"][Se];i&&t.push({junctionType:"Any type of junction",movementType:Se,...i})}return t}function ft(n,e,t){const o=n.slice();return o[9]=e[t],o}function ut(n,e,t){const o=n.slice();return o[12]=e[t],o}function ct(n,e,t){const o=n.slice();return o[12]=e[t],o}function mt(n,e,t){const o=n.slice();return o[12]=e[t],o}function Tn(n){let e;return{c(){e=V("LTN 1/20 scoring guidance")},l(t){e=J(t,"LTN 1/20 scoring guidance")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Ln(n){let e;return{c(){e=V(`LTN 1/20 appendix B
    `)},l(t){e=J(t,`LTN 1/20 appendix B
    `)},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function gt(n){let e,t=n[12]+"",o;return{c(){e=Z("li"),o=V(t)},l(l){e=X(l,"LI",{});var i=Q(e);o=J(i,t),i.forEach(_)},m(l,i){y(l,e,i),C(e,o)},p(l,i){i&6&&t!==(t=l[12]+"")&&fe(o,t)},d(l){l&&_(e)}}}function dt(n){let e,t=n[12]+"",o;return{c(){e=Z("li"),o=V(t)},l(l){e=X(l,"LI",{});var i=Q(e);o=J(i,t),i.forEach(_)},m(l,i){y(l,e,i),C(e,o)},p(l,i){i&6&&t!==(t=l[12]+"")&&fe(o,t)},d(l){l&&_(e)}}}function _t(n){let e,t=n[12]+"",o;return{c(){e=Z("li"),o=V(t)},l(l){e=X(l,"LI",{});var i=Q(e);o=J(i,t),i.forEach(_)},m(l,i){y(l,e,i),C(e,o)},p(l,i){i&6&&t!==(t=l[12]+"")&&fe(o,t)},d(l){l&&_(e)}}}function pt(n){let e,t,o=n[9].junctionType+"",l,i,r,a,s,f,c=n[9].movementType+"",m,g,$,I,H,S,K,h,w,N,u,p=ge(n[9].scoreZero),d=[];for(let v=0;v<p.length;v+=1)d[v]=gt(mt(n,p,v));let W=ge(n[9].scoreOne),F=[];for(let v=0;v<W.length;v+=1)F[v]=dt(ct(n,W,v));let b=ge(n[9].scoreTwo),D=[];for(let v=0;v<b.length;v+=1)D[v]=_t(ut(n,b,v));return{c(){e=Z("tr"),t=Z("td"),l=V(o),i=O(),r=Z("br"),a=O(),s=Z("br"),f=O(),m=V(c),g=O(),$=Z("td"),I=Z("ul");for(let v=0;v<d.length;v+=1)d[v].c();H=O(),S=Z("td"),K=Z("ul");for(let v=0;v<F.length;v+=1)F[v].c();h=O(),w=Z("td"),N=Z("ul");for(let v=0;v<D.length;v+=1)D[v].c();u=O(),this.h()},l(v){e=X(v,"TR",{});var Y=Q(e);t=X(Y,"TD",{class:!0});var L=Q(t);l=J(L,o),i=P(L),r=X(L,"BR",{}),a=P(L),s=X(L,"BR",{}),f=P(L),m=J(L,c),L.forEach(_),g=P(Y),$=X(Y,"TD",{class:!0});var ie=Q($);I=X(ie,"UL",{});var A=Q(I);for(let M=0;M<d.length;M+=1)d[M].l(A);A.forEach(_),ie.forEach(_),H=P(Y),S=X(Y,"TD",{class:!0});var ee=Q(S);K=X(ee,"UL",{});var se=Q(K);for(let M=0;M<F.length;M+=1)F[M].l(se);se.forEach(_),ee.forEach(_),h=P(Y),w=X(Y,"TD",{class:!0});var re=Q(w);N=X(re,"UL",{});var ue=Q(N);for(let M=0;M<D.length;M+=1)D[M].l(ue);ue.forEach(_),re.forEach(_),u=P(Y),Y.forEach(_),this.h()},h(){ne(t,"class","type-row svelte-k4kgn3"),ne($,"class","score-zero svelte-k4kgn3"),ne(S,"class","score-one svelte-k4kgn3"),ne(w,"class","score-two svelte-k4kgn3")},m(v,Y){y(v,e,Y),C(e,t),C(t,l),C(t,i),C(t,r),C(t,a),C(t,s),C(t,f),C(t,m),C(e,g),C(e,$),C($,I);for(let L=0;L<d.length;L+=1)d[L]&&d[L].m(I,null);C(e,H),C(e,S),C(S,K);for(let L=0;L<F.length;L+=1)F[L]&&F[L].m(K,null);C(e,h),C(e,w),C(w,N);for(let L=0;L<D.length;L+=1)D[L]&&D[L].m(N,null);C(e,u)},p(v,Y){if(Y&6&&o!==(o=v[9].junctionType+"")&&fe(l,o),Y&6&&c!==(c=v[9].movementType+"")&&fe(m,c),Y&6){p=ge(v[9].scoreZero);let L;for(L=0;L<p.length;L+=1){const ie=mt(v,p,L);d[L]?d[L].p(ie,Y):(d[L]=gt(ie),d[L].c(),d[L].m(I,null))}for(;L<d.length;L+=1)d[L].d(1);d.length=p.length}if(Y&6){W=ge(v[9].scoreOne);let L;for(L=0;L<W.length;L+=1){const ie=ct(v,W,L);F[L]?F[L].p(ie,Y):(F[L]=dt(ie),F[L].c(),F[L].m(K,null))}for(;L<F.length;L+=1)F[L].d(1);F.length=W.length}if(Y&6){b=ge(v[9].scoreTwo);let L;for(L=0;L<b.length;L+=1){const ie=ut(v,b,L);D[L]?D[L].p(ie,Y):(D[L]=_t(ie),D[L].c(),D[L].m(N,null))}for(;L<D.length;L+=1)D[L].d(1);D.length=b.length}},d(v){v&&_(e),je(d,v),je(F,v),je(D,v)}}}function En(n){let e;return{c(){e=V("OK")},l(t){e=J(t,"OK")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Sn(n){let e,t,o,l,i,r,a,s,f,c,m,g,$,I,H=`<th class="type-header svelte-k4kgn3">Type of junction and movement</th> <th class="score-zero-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 0</b></p> <p class="svelte-k4kgn3">Suitable only for confident existing cyclists, and may be avoided by
          some experienced cyclists</p> <p class="svelte-k4kgn3">Conditions are most likely to give rise to the most common collision
          types</p></th> <th class="score-one-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 1</b></p> <p class="svelte-k4kgn3">Likely to be more acceptable to most cyclists, but may still pose
          problems for less confident or new cyclists</p> <p class="svelte-k4kgn3">The risk of collisions has been reduced by design layout or traffic
          management interventions</p></th> <th class="score-two-header svelte-k4kgn3"><p class="svelte-k4kgn3"><b>Score = 2</b></p> <p class="svelte-k4kgn3">Suitable for all potential and existing cyclists</p> <p class="svelte-k4kgn3">The potential for collisions has been removed, or managed to a high
          standard of safety for cyclists</p></th>`,S,K,h,w;o=new hn({props:{href:"https://assets.publishing.service.gov.uk/media/5ffa1f96d3bf7f65d9e35825/cycle-infrastructure-design-ltn-1-20.pdf",$$slots:{default:[Ln]},$$scope:{ctx:n}}});function N(b){n[5](b)}let u={label:"Type of junction",choices:Ze(Jt)};n[1]!==void 0&&(u.value=n[1]),a=new Ue({props:u}),me.push(()=>_e(a,"value",N)),a.$on("change",n[3]);function p(b){n[6](b)}let d={label:"Type of movement",choices:Ze(Ge(n[1]))};n[2]!==void 0&&(d.value=n[2]),c=new Ue({props:d}),me.push(()=>_e(c,"value",p));let W=ge(st(n[1],n[2])),F=[];for(let b=0;b<W.length;b+=1)F[b]=pt(ft(n,W,b));return h=new Pe({props:{$$slots:{default:[En]},$$scope:{ctx:n}}}),h.$on("click",n[7]),{c(){e=Z("p"),t=V("Guidance from "),q(o.$$.fragment),l=V("."),i=O(),r=Z("div"),q(a.$$.fragment),f=O(),q(c.$$.fragment),g=O(),$=Z("table"),I=Z("tr"),I.innerHTML=H,S=O();for(let b=0;b<F.length;b+=1)F[b].c();K=O(),q(h.$$.fragment),this.h()},l(b){e=X(b,"P",{});var D=Q(e);t=J(D,"Guidance from "),z(o.$$.fragment,D),l=J(D,"."),D.forEach(_),i=P(b),r=X(b,"DIV",{style:!0});var v=Q(r);z(a.$$.fragment,v),f=P(v),z(c.$$.fragment,v),v.forEach(_),g=P(b),$=X(b,"TABLE",{});var Y=Q($);I=X(Y,"TR",{"data-svelte-h":!0}),Fe(I)!=="svelte-1kfz8ii"&&(I.innerHTML=H),S=P(Y);for(let L=0;L<F.length;L+=1)F[L].l(Y);Y.forEach(_),K=P(b),z(h.$$.fragment,b),this.h()},h(){te(r,"display","flex"),te(r,"justify-content","space-between")},m(b,D){y(b,e,D),C(e,t),U(o,e,null),C(e,l),y(b,i,D),y(b,r,D),U(a,r,null),C(r,f),U(c,r,null),y(b,g,D),y(b,$,D),C($,I),C($,S);for(let v=0;v<F.length;v+=1)F[v]&&F[v].m($,null);y(b,K,D),U(h,b,D),w=!0},p(b,D){const v={};D&524288&&(v.$$scope={dirty:D,ctx:b}),o.$set(v);const Y={};!s&&D&2&&(s=!0,Y.value=b[1],de(()=>s=!1)),a.$set(Y);const L={};if(D&2&&(L.choices=Ze(Ge(b[1]))),!m&&D&4&&(m=!0,L.value=b[2],de(()=>m=!1)),c.$set(L),D&6){W=ge(st(b[1],b[2]));let A;for(A=0;A<W.length;A+=1){const ee=ft(b,W,A);F[A]?F[A].p(ee,D):(F[A]=pt(ee),F[A].c(),F[A].m($,null))}for(;A<F.length;A+=1)F[A].d(1);F.length=W.length}const ie={};D&524288&&(ie.$$scope={dirty:D,ctx:b}),h.$set(ie)},i(b){w||(k(o.$$.fragment,b),k(a.$$.fragment,b),k(c.$$.fragment,b),k(h.$$.fragment,b),w=!0)},o(b){T(o.$$.fragment,b),T(a.$$.fragment,b),T(c.$$.fragment,b),T(h.$$.fragment,b),w=!1},d(b){b&&(_(e),_(i),_(r),_(g),_($),_(K)),G(o),G(a),G(c),je(F,b),G(h,b)}}}function Mn(n){let e,t,o,l,i,r;t=new Pe({props:{$$slots:{default:[Tn]},$$scope:{ctx:n}}}),t.$on("click",n[4]);function a(f){n[8](f)}let s={title:"LTN 1/20 scoring guidance",viewWidth:80,$$slots:{default:[Sn]},$$scope:{ctx:n}};return n[0]!==void 0&&(s.open=n[0]),l=new pn({props:s}),me.push(()=>_e(l,"open",a)),{c(){e=Z("div"),q(t.$$.fragment),o=O(),q(l.$$.fragment)},l(f){e=X(f,"DIV",{});var c=Q(e);z(t.$$.fragment,c),c.forEach(_),o=P(f),z(l.$$.fragment,f)},m(f,c){y(f,e,c),U(t,e,null),y(f,o,c),U(l,f,c),r=!0},p(f,[c]){const m={};c&524288&&(m.$$scope={dirty:c,ctx:f}),t.$set(m);const g={};c&524295&&(g.$$scope={dirty:c,ctx:f}),!i&&c&1&&(i=!0,g.open=f[0],de(()=>i=!1)),l.$set(g)},i(f){r||(k(t.$$.fragment,f),k(l.$$.fragment,f),r=!0)},o(f){T(t.$$.fragment,f),T(l.$$.fragment,f),r=!1},d(f){f&&(_(e),_(o)),G(t),G(l,f)}}}function In(n,e,t){let o=!1,l=Jt[0],i=Ge(l)[0];function r(){t(2,i=Ge(l)[0])}const a=()=>t(0,o=!0);function s(g){l=g,t(1,l)}function f(g){i=g,t(2,i)}const c=()=>t(0,o=!1);function m(g){o=g,t(0,o)}return[o,l,i,r,a,s,f,c,m]}class An extends Ne{constructor(e){super(),Oe(this,e,In,Mn,Le,{})}}function ht(n){let e,t;return e=new An({}),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function Nn(n){let e,t,o,l,i,r,a,s,f,c,m,g,$;function I(d){n[5](d)}let H={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(H.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new tt({props:H}),me.push(()=>_e(e,"value",I));function S(d){n[6](d)}let K={label:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(K.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new Ue({props:K}),me.push(()=>_e(l,"value",S));let h=n[3].jat[n[0]][n[1]].movements[n[2]].kind=="cycling"&&ht();function w(d){n[7](d)}let N={label:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(N.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new Ue({props:N}),me.push(()=>_e(s,"value",w));function u(d){n[8](d)}let p={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(p.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),m=new Ht({props:p}),me.push(()=>_e(m,"value",u)),{c(){q(e.$$.fragment),o=O(),q(l.$$.fragment),r=O(),h&&h.c(),a=O(),q(s.$$.fragment),c=O(),q(m.$$.fragment)},l(d){z(e.$$.fragment,d),o=P(d),z(l.$$.fragment,d),r=P(d),h&&h.l(d),a=P(d),z(s.$$.fragment,d),c=P(d),z(m.$$.fragment,d)},m(d,W){U(e,d,W),y(d,o,W),U(l,d,W),y(d,r,W),h&&h.m(d,W),y(d,a,W),U(s,d,W),y(d,c,W),U(m,d,W),$=!0},p(d,[W]){const F={};!t&&W&15&&(t=!0,F.value=d[3].jat[d[0]][d[1]].movements[d[2]].name,de(()=>t=!1)),e.$set(F);const b={};!i&&W&15&&(i=!0,b.value=d[3].jat[d[0]][d[1]].movements[d[2]].kind,de(()=>i=!1)),l.$set(b),d[3].jat[d[0]][d[1]].movements[d[2]].kind=="cycling"?h?W&15&&k(h,1):(h=ht(),h.c(),k(h,1),h.m(a.parentNode,a)):h&&(ve(),T(h,1,1,()=>{h=null}),be());const D={};!f&&W&15&&(f=!0,D.value=d[3].jat[d[0]][d[1]].movements[d[2]].score,de(()=>f=!1)),s.$set(D);const v={};!g&&W&15&&(g=!0,v.value=d[3].jat[d[0]][d[1]].movements[d[2]].notes,de(()=>g=!1)),m.$set(v)},i(d){$||(k(e.$$.fragment,d),k(l.$$.fragment,d),k(h),k(s.$$.fragment,d),k(m.$$.fragment,d),$=!0)},o(d){T(e.$$.fragment,d),T(l.$$.fragment,d),T(h),T(s.$$.fragment,d),T(m.$$.fragment,d),$=!1},d(d){d&&(_(o),_(r),_(a),_(c)),G(e,d),G(l,d),h&&h.d(d),G(s,d),G(m,d)}}}function On(n,e,t){let o;He(n,le,g=>t(3,o=g));let{junctionIdx:l}=e,{stage:i}=e,{idx:r}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(g){n.$$.not_equal(o.jat[l][i].movements[r].name,g)&&(o.jat[l][i].movements[r].name=g,le.set(o))}function f(g){n.$$.not_equal(o.jat[l][i].movements[r].kind,g)&&(o.jat[l][i].movements[r].kind=g,le.set(o))}function c(g){n.$$.not_equal(o.jat[l][i].movements[r].score,g)&&(o.jat[l][i].movements[r].score=g,le.set(o))}function m(g){n.$$.not_equal(o.jat[l][i].movements[r].notes,g)&&(o.jat[l][i].movements[r].notes=g,le.set(o))}return n.$$set=g=>{"junctionIdx"in g&&t(0,l=g.junctionIdx),"stage"in g&&t(1,i=g.stage),"idx"in g&&t(2,r=g.idx)},[l,i,r,o,a,s,f,c,m]}class Pn extends Ne{constructor(e){super(),Oe(this,e,On,Nn,Le,{junctionIdx:0,stage:1,idx:2})}}var Dn=Object.defineProperty,Zt=(n,e)=>Dn(n,"name",{value:e,configurable:!0});function ot(n,e,t={}){if(t.final===!0)return Xt(n,e);const o=Ye(n),l=Ye(e),i=Ie(o[0]),r=Ie(l[0]),a=Ie(o[1]),s=Ie(l[1]),f=Math.sin(r-i)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(r-i);return Ke(Math.atan2(f,c))}Zt(ot,"bearing");function Xt(n,e){let t=ot(e,n);return t=(t+180)%360,t}Zt(Xt,"calculateFinalBearing");var Be=ot,Bn=Object.defineProperty,Rn=(n,e)=>Bn(n,"name",{value:e,configurable:!0});function Wt(n,e={}){const t=fn(n),o=(t[0]+t[2])/2,l=(t[1]+t[3])/2;return Gt([o,l],e.properties,e)}Rn(Wt,"center");var Fn=Wt,qn=Object.defineProperty,zn=(n,e)=>qn(n,"name",{value:e,configurable:!0});function Kt(n,e,t,o={}){const l=Ye(n),i=Ie(l[0]),r=Ie(l[1]),a=Ie(t),s=un(e,o.units),f=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(a)),c=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(f)),m=Ke(c),g=Ke(f);return Gt([m,g],o.properties)}zn(Kt,"destination");var qe=Kt;function Un(n){let e=Fn({type:"FeatureCollection",features:n.map(o=>({type:"Feature",geometry:{type:"Point",coordinates:o.point},properties:{}}))}).geometry.coordinates;n.sort((o,l)=>$t(Be(e,l.point))-$t(Be(e,o.point)));let t=[];for(let o=0;o<n.length;o++){let l=n[o],i=Be(l.point,e),r=1;for(let a of Hn(o,n.length)){let s=n[a],f=Be(e,s.point),c=Gn(l.point,e,r++),m=$n(l.point,e),g=qe(c,.5*m,i).geometry.coordinates,$=qe(g,.2*m,f).geometry.coordinates;t.push({point1:c,point2:g,point3:$,kind:"cycling",score:"X",name:`${l.name} to ${s.name}`,notes:""})}}return t}function Gn(n,e,t){let o=.003,i=Be(n,e)-90,r=o*t;return qe(n,r,i).geometry.coordinates}function $t(n){return(n+360)%360}function Hn(n,e){let t=[];for(let o=n+1;o<e;o++)t.push(o);for(let o=0;o<n;o++)t.push(o);return t}const Vn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function vt(n,e,t){const o=n.slice();return o[36]=e[t],o[37]=e,o[38]=t,o}function bt(n,e,t){const o=n.slice();return o[39]=e[t],o[40]=e,o[38]=t,o}function kt(n){let e,t,o,l,i,r,a;return t=new Xe({props:{$$slots:{default:[Xn]},$$scope:{ctx:n}}}),t.$on("click",function(){Yt(n[5])&&n[5].apply(this,arguments)}),l=new Xe({props:{$$slots:{default:[Qn]},$$scope:{ctx:n}}}),l.$on("click",n[17]),r=new Xe({props:{$$slots:{default:[eo]},$$scope:{ctx:n}}}),r.$on("click",n[18]),{c(){e=Z("div"),q(t.$$.fragment),o=O(),q(l.$$.fragment),i=O(),q(r.$$.fragment),this.h()},l(s){e=X(s,"DIV",{class:!0});var f=Q(e);z(t.$$.fragment,f),o=P(f),z(l.$$.fragment,f),i=P(f),z(r.$$.fragment,f),f.forEach(_),this.h()},h(){ne(e,"class","control-panel svelte-edsx8m")},m(s,f){y(s,e,f),U(t,e,null),C(e,o),U(l,e,null),C(e,i),U(r,e,null),a=!0},p(s,f){n=s;const c={};f[0]&1|f[1]&1024&&(c.$$scope={dirty:f,ctx:n}),t.$set(c);const m={};f[0]&1|f[1]&1024&&(m.$$scope={dirty:f,ctx:n}),l.$set(m);const g={};f[0]&1|f[1]&1024&&(g.$$scope={dirty:f,ctx:n}),r.$set(g)},i(s){a||(k(t.$$.fragment,s),k(l.$$.fragment,s),k(r.$$.fragment,s),a=!0)},o(s){T(t.$$.fragment,s),T(l.$$.fragment,s),T(r.$$.fragment,s),a=!1},d(s){s&&_(e),G(t),G(l),G(r)}}}function Jn(n){let e;return{c(){e=V("Move map")},l(t){e=J(t,"Move map")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Zn(n){let e,t="Move map";return{c(){e=Z("b"),e.textContent=t},l(o){e=X(o,"B",{"data-svelte-h":!0}),Fe(e)!=="svelte-ydcbkl"&&(e.textContent=t)},m(o,l){y(o,e,l)},d(o){o&&_(e)}}}function Xn(n){let e,t,o,l;function i(s,f){return s[0].mode=="select"?Zn:Jn}let r=i(n),a=r(n);return{c(){e=Z("img"),o=O(),a.c(),l=ke(),this.h()},l(s){e=X(s,"IMG",{src:!0,alt:!0,style:!0}),o=P(s),a.l(s),l=ke(),this.h()},h(){zt(e.src,t=vn)||ne(e,"src",t),ne(e,"alt","Move map"),te(e,"vertical-align","middle")},m(s,f){y(s,e,f),y(s,o,f),a.m(s,f),y(s,l,f)},p(s,f){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(l.parentNode,l)))},d(s){s&&(_(e),_(o),_(l)),a.d(s)}}}function Wn(n){let e;return{c(){e=V("New arm")},l(t){e=J(t,"New arm")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Kn(n){let e,t="New arm";return{c(){e=Z("b"),e.textContent=t},l(o){e=X(o,"B",{"data-svelte-h":!0}),Fe(e)!=="svelte-1ydhckg"&&(e.textContent=t)},m(o,l){y(o,e,l)},d(o){o&&_(e)}}}function Qn(n){let e,t,o,l,i,r;function a(c,m){return c[0].mode=="new-arm"?Kn:Wn}let s=a(n),f=s(n);return{c(){e=Ve("svg"),t=Ve("circle"),o=Ve("text"),l=V("A"),i=O(),f.c(),r=ke(),this.h()},l(c){e=Je(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var m=Q(e);t=Je(m,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),Q(t).forEach(_),o=Je(m,"text",{x:!0,y:!0,fill:!0});var g=Q(o);l=J(g,"A"),g.forEach(_),m.forEach(_),i=P(c),f.l(c),r=ke(),this.h()},h(){ne(t,"cx","12"),ne(t,"cy","12"),ne(t,"r","12"),ne(t,"fill","white"),ne(o,"x","6"),ne(o,"y","16"),ne(o,"fill","#4472c4"),ne(e,"width","24"),ne(e,"height","24"),ne(e,"xmlns","http://www.w3.org/2000/svg"),te(e,"vertical-align","middle")},m(c,m){y(c,e,m),C(e,t),C(e,o),C(o,l),y(c,i,m),f.m(c,m),y(c,r,m)},p(c,m){s!==(s=a(c))&&(f.d(1),f=s(c),f&&(f.c(),f.m(r.parentNode,r)))},d(c){c&&(_(e),_(i),_(r)),f.d(c)}}}function Yn(n){let e;return{c(){e=V("New movement")},l(t){e=J(t,"New movement")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function xn(n){let e,t="New movement";return{c(){e=Z("b"),e.textContent=t},l(o){e=X(o,"B",{"data-svelte-h":!0}),Fe(e)!=="svelte-o3h90l"&&(e.textContent=t)},m(o,l){y(o,e,l)},d(o){o&&_(e)}}}function eo(n){let e,t,o,l;function i(s,f){return s[0].mode=="new-movement"?xn:Yn}let r=i(n),a=r(n);return{c(){e=Z("img"),o=O(),a.c(),l=ke(),this.h()},l(s){e=X(s,"IMG",{src:!0,alt:!0,style:!0}),o=P(s),a.l(s),l=ke(),this.h()},h(){zt(e.src,t=Vn)||ne(e,"src",t),ne(e,"alt","New movement"),te(e,"vertical-align","middle")},m(s,f){y(s,e,f),y(s,o,f),a.m(s,f),y(s,l,f)},p(s,f){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(l.parentNode,l)))},d(s){s&&(_(e),_(o),_(l)),a.d(s)}}}function wt(n){let e,t;return e=new bn({props:{map:n[6],beforeId:"route-map"}}),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},p(o,l){const i={};l[0]&64&&(i.map=o[6]),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function to(n){let e,t=go(n[38])+"",o;return{c(){e=Z("span"),o=V(t),this.h()},l(l){e=X(l,"SPAN",{class:!0});var i=Q(e);o=J(i,t),i.forEach(_),this.h()},h(){ne(e,"class","dot svelte-edsx8m"),te(e,"color","#4472c4"),te(e,"background-color","white")},m(l,i){y(l,e,i),C(e,o)},p:Ae,d(l){l&&_(e)}}}function yt(n){let e,t,o;function l(s){n[19](s,n[39])}function i(){return n[20](n[38])}function r(){return n[21](n[38])}let a={draggable:!0,$$slots:{default:[to]},$$scope:{ctx:n}};return n[39].point!==void 0&&(a.lngLat=n[39].point),e=new ze({props:a}),me.push(()=>_e(e,"lngLat",l)),e.$on("dragend",i),e.$on("click",r),{c(){q(e.$$.fragment)},l(s){z(e.$$.fragment,s)},m(s,f){U(e,s,f),o=!0},p(s,f){n=s;const c={};f[1]&1024&&(c.$$scope={dirty:f,ctx:n}),!t&&f[0]&134&&(t=!0,c.lngLat=n[39].point,de(()=>t=!1)),e.$set(c)},i(s){o||(k(e.$$.fragment,s),o=!0)},o(s){T(e.$$.fragment,s),o=!1},d(s){G(e,s)}}}function no(n){let e;return{c(){e=Z("span"),this.h()},l(t){e=X(t,"SPAN",{class:!0}),Q(e).forEach(_),this.h()},h(){ne(e,"class","dot svelte-edsx8m"),te(e,"background-color",n[9][n[36].score]),te(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(t,o){y(t,e,o)},p(t,o){o[0]&134&&te(e,"background-color",t[9][t[36].score]),o[0]&134&&te(e,"opacity",t[36].kind=="walking & wheeling"?"0%":"100%")},d(t){t&&_(e)}}}function oo(n){let e;return{c(){e=Z("span"),this.h()},l(t){e=X(t,"SPAN",{class:!0}),Q(e).forEach(_),this.h()},h(){ne(e,"class","dot svelte-edsx8m"),te(e,"background-color",n[9][n[36].score])},m(t,o){y(t,e,o)},p(t,o){o[0]&134&&te(e,"background-color",t[9][t[36].score])},d(t){t&&_(e)}}}function lo(n){let e;return{c(){e=Z("span"),this.h()},l(t){e=X(t,"SPAN",{class:!0}),Q(e).forEach(_),this.h()},h(){ne(e,"class","dot svelte-edsx8m"),te(e,"background-color",n[9][n[36].score]),te(e,"opacity","0%")},m(t,o){y(t,e,o)},p(t,o){o[0]&134&&te(e,"background-color",t[9][t[36].score])},d(t){t&&_(e)}}}function jt(n){let e,t,o,l,i,r,a,s,f;function c(p){n[22](p,n[36])}function m(){return n[23](n[38])}function g(){return n[24](n[38])}let $={draggable:!0,$$slots:{default:[no]},$$scope:{ctx:n}};n[36].point1!==void 0&&($.lngLat=n[36].point1),e=new ze({props:$}),me.push(()=>_e(e,"lngLat",c)),e.$on("dragend",m),e.$on("click",g);function I(p){n[25](p,n[36])}function H(){return n[26](n[38])}function S(){return n[27](n[38])}let K={draggable:!0,$$slots:{default:[oo]},$$scope:{ctx:n}};n[36].point2!==void 0&&(K.lngLat=n[36].point2),l=new ze({props:K}),me.push(()=>_e(l,"lngLat",I)),l.$on("dragend",H),l.$on("click",S);function h(p){n[28](p,n[36])}function w(){return n[29](n[38])}function N(){return n[30](n[38])}let u={draggable:!0,$$slots:{default:[lo]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(u.lngLat=n[36].point3),a=new ze({props:u}),me.push(()=>_e(a,"lngLat",h)),a.$on("dragend",w),a.$on("click",N),{c(){q(e.$$.fragment),o=O(),q(l.$$.fragment),r=O(),q(a.$$.fragment)},l(p){z(e.$$.fragment,p),o=P(p),z(l.$$.fragment,p),r=P(p),z(a.$$.fragment,p)},m(p,d){U(e,p,d),y(p,o,d),U(l,p,d),y(p,r,d),U(a,p,d),f=!0},p(p,d){n=p;const W={};d[0]&134|d[1]&1024&&(W.$$scope={dirty:d,ctx:n}),!t&&d[0]&134&&(t=!0,W.lngLat=n[36].point1,de(()=>t=!1)),e.$set(W);const F={};d[0]&134|d[1]&1024&&(F.$$scope={dirty:d,ctx:n}),!i&&d[0]&134&&(i=!0,F.lngLat=n[36].point2,de(()=>i=!1)),l.$set(F);const b={};d[0]&134|d[1]&1024&&(b.$$scope={dirty:d,ctx:n}),!s&&d[0]&134&&(s=!0,b.lngLat=n[36].point3,de(()=>s=!1)),a.$set(b)},i(p){f||(k(e.$$.fragment,p),k(l.$$.fragment,p),k(a.$$.fragment,p),f=!0)},o(p){T(e.$$.fragment,p),T(l.$$.fragment,p),T(a.$$.fragment,p),f=!1},d(p){p&&(_(o),_(r)),G(e,p),G(l,p),G(a,p)}}}function ro(n){let e=(n[35].name||"Untitled movement")+"",t;return{c(){t=V(e)},l(o){t=J(o,e)},m(o,l){y(o,t,l)},p(o,l){l[1]&16&&e!==(e=(o[35].name||"Untitled movement")+"")&&fe(t,e)},d(o){o&&_(t)}}}function io(n){let e,t;return e=new Vt({props:{$$slots:{default:[ro,({props:o})=>({35:o}),({props:o})=>[0,o?16:0]]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},p(o,l){const i={};l[1]&1040&&(i.$$scope={dirty:l,ctx:o}),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function ao(n){let e=(n[35].name||"Untitled movement")+"",t;return{c(){t=V(e)},l(o){t=J(o,e)},m(o,l){y(o,t,l)},p(o,l){l[1]&16&&e!==(e=(o[35].name||"Untitled movement")+"")&&fe(t,e)},d(o){o&&_(t)}}}function so(n){let e,t;return e=new Vt({props:{$$slots:{default:[ao,({props:o})=>({35:o}),({props:o})=>[0,o?16:0]]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},p(o,l){const i={};l[1]&1040&&(i.$$scope={dirty:l,ctx:o}),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function fo(n){let e,t,o,l,i,r;return e=new Qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":at(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[io]},$$scope:{ctx:n}}}),e.$on("click",n[11]),o=new Qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":at(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[so]},$$scope:{ctx:n}}}),o.$on("click",n[11]),i=new Cn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){q(e.$$.fragment),t=O(),q(o.$$.fragment),l=O(),q(i.$$.fragment)},l(a){z(e.$$.fragment,a),t=P(a),z(o.$$.fragment,a),l=P(a),z(i.$$.fragment,a)},m(a,s){U(e,a,s),y(a,t,s),U(o,a,s),y(a,l,s),U(i,a,s),r=!0},p(a,s){const f={};s[1]&1024&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:a}),o.$set(c)},i(a){r||(k(e.$$.fragment,a),k(o.$$.fragment,a),k(i.$$.fragment,a),r=!0)},o(a){T(e.$$.fragment,a),T(o.$$.fragment,a),T(i.$$.fragment,a),r=!1},d(a){a&&(_(t),_(l)),G(e,a),G(o,a),G(i,a)}}}function uo(n){let e,t,o,l;return e=new Qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),o=new dn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){q(e.$$.fragment),t=O(),q(o.$$.fragment)},l(i){z(e.$$.fragment,i),t=P(i),z(o.$$.fragment,i)},m(i,r){U(e,i,r),y(i,t,r),U(o,i,r),l=!0},p:Ae,i(i){l||(k(e.$$.fragment,i),k(o.$$.fragment,i),l=!0)},o(i){T(e.$$.fragment,i),T(o.$$.fragment,i),l=!1},d(i){i&&_(t),G(e,i),G(o,i)}}}function co(n){let e,t,o,l,i,r,a,s,f,c,m,g;e=new mn({}),e.$on("click",n[10]);let $=n[0].mode!="editing"&&kt(n);l=new kn({props:{show:n[3],id:"route-map"}});let I=n[6]&&wt(n),H=ge(n[7].jat[n[1]][n[2]].arms),S=[];for(let u=0;u<H.length;u+=1)S[u]=yt(bt(n,H,u));const K=u=>T(S[u],1,1,()=>{S[u]=null});let h=ge(n[7].jat[n[1]][n[2]].movements),w=[];for(let u=0;u<h.length;u+=1)w[u]=jt(vt(n,h,u));const N=u=>T(w[u],1,1,()=>{w[u]=null});return f=new it({props:{data:n[12](n[7]),$$slots:{default:[fo]},$$scope:{ctx:n}}}),m=new it({props:{data:n[8],$$slots:{default:[uo]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment),t=O(),$&&$.c(),o=O(),q(l.$$.fragment),i=O(),I&&I.c(),r=O();for(let u=0;u<S.length;u+=1)S[u].c();a=O();for(let u=0;u<w.length;u+=1)w[u].c();s=O(),q(f.$$.fragment),c=O(),q(m.$$.fragment)},l(u){z(e.$$.fragment,u),t=P(u),$&&$.l(u),o=P(u),z(l.$$.fragment,u),i=P(u),I&&I.l(u),r=P(u);for(let p=0;p<S.length;p+=1)S[p].l(u);a=P(u);for(let p=0;p<w.length;p+=1)w[p].l(u);s=P(u),z(f.$$.fragment,u),c=P(u),z(m.$$.fragment,u)},m(u,p){U(e,u,p),y(u,t,p),$&&$.m(u,p),y(u,o,p),U(l,u,p),y(u,i,p),I&&I.m(u,p),y(u,r,p);for(let d=0;d<S.length;d+=1)S[d]&&S[d].m(u,p);y(u,a,p);for(let d=0;d<w.length;d+=1)w[d]&&w[d].m(u,p);y(u,s,p),U(f,u,p),y(u,c,p),U(m,u,p),g=!0},p(u,p){u[0].mode!="editing"?$?($.p(u,p),p[0]&1&&k($,1)):($=kt(u),$.c(),k($,1),$.m(o.parentNode,o)):$&&(ve(),T($,1,1,()=>{$=null}),be());const d={};if(p[0]&8&&(d.show=u[3]),l.$set(d),u[6]?I?(I.p(u,p),p[0]&64&&k(I,1)):(I=wt(u),I.c(),k(I,1),I.m(r.parentNode,r)):I&&(ve(),T(I,1,1,()=>{I=null}),be()),p[0]&150){H=ge(u[7].jat[u[1]][u[2]].arms);let b;for(b=0;b<H.length;b+=1){const D=bt(u,H,b);S[b]?(S[b].p(D,p),k(S[b],1)):(S[b]=yt(D),S[b].c(),k(S[b],1),S[b].m(a.parentNode,a))}for(ve(),b=H.length;b<S.length;b+=1)K(b);be()}if(p[0]&662){h=ge(u[7].jat[u[1]][u[2]].movements);let b;for(b=0;b<h.length;b+=1){const D=vt(u,h,b);w[b]?(w[b].p(D,p),k(w[b],1)):(w[b]=jt(D),w[b].c(),k(w[b],1),w[b].m(s.parentNode,s))}for(ve(),b=h.length;b<w.length;b+=1)N(b);be()}const W={};p[0]&128&&(W.data=u[12](u[7])),p[1]&1024&&(W.$$scope={dirty:p,ctx:u}),f.$set(W);const F={};p[0]&256&&(F.data=u[8]),p[1]&1024&&(F.$$scope={dirty:p,ctx:u}),m.$set(F)},i(u){if(!g){k(e.$$.fragment,u),k($),k(l.$$.fragment,u),k(I);for(let p=0;p<H.length;p+=1)k(S[p]);for(let p=0;p<h.length;p+=1)k(w[p]);k(f.$$.fragment,u),k(m.$$.fragment,u),g=!0}},o(u){T(e.$$.fragment,u),T($),T(l.$$.fragment,u),T(I),S=S.filter(Boolean);for(let p=0;p<S.length;p+=1)T(S[p]);w=w.filter(Boolean);for(let p=0;p<w.length;p+=1)T(w[p]);T(f.$$.fragment,u),T(m.$$.fragment,u),g=!1},d(u){u&&(_(t),_(o),_(i),_(r),_(a),_(s),_(c)),G(e,u),$&&$.d(u),G(l,u),I&&I.d(u),je(S,u),je(w,u),G(f,u),G(m,u)}}}function mo(n){let e,t,o;function l(r){n[31](r)}let i={$$slots:{default:[co]},$$scope:{ctx:n}};return n[6]!==void 0&&(i.map=n[6]),e=new cn({props:i}),me.push(()=>_e(e,"map",l)),{c(){q(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,a){U(e,r,a),o=!0},p(r,a){const s={};a[0]&511|a[1]&1024&&(s.$$scope={dirty:a,ctx:r}),!t&&a[0]&64&&(t=!0,s.map=r[6],de(()=>t=!1)),e.$set(s)},i(r){o||(k(e.$$.fragment,r),o=!0)},o(r){T(e.$$.fragment,r),o=!1},d(r){G(e,r)}}}function Ct(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function go(n){return String.fromCharCode(n+65)}function _o(n,e,t){let o,l;He(n,le,j=>t(7,l=j));let{junctionIdx:i}=e,{stage:r}=e,{mode:a}=e,{hoveringSidebar:s}=e,{streetviewOn:f}=e,{showRoute:c}=e,{select:m}=e,{stopEditing:g}=e,$,I={0:Te.red.background,1:Te.amber.background,2:Te.green.background,X:Te.critical.background};function H(j,B,pe){let oe={type:"FeatureCollection",features:[]},$e=B.mode=="editing"?B.id:pe;return $e!=null&&($e.kind=="arm"?oe.features.push(Ct(j.jat[i][r].arms[$e.idx],$e.idx)):oe.features.push(w(j.jat[i][r].movements[$e.idx],$e.idx))),oe}async function S(j){if(!(f||!$)){for(let B of $.queryRenderedFeatures(j.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await g();return}a.mode=="new-arm"?(Re(le,l.jat[i][r].arms=[...l.jat[i][r].arms,{point:j.detail.lngLat.toArray(),name:""}],l),await m({kind:"arm",idx:l.jat[i][r].arms.length-1})):(Re(le,l.jat[i][r].movements=[...l.jat[i][r].movements,{point1:j.detail.lngLat.toArray(),point2:qe(j.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:qe(j.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await m({kind:"movement",idx:l.jat[i][r].movements.length-1}))}}}async function K(j){await m({kind:"movement",idx:j.detail.features[0].id})}function h(j){let B={type:"FeatureCollection",features:j.jat[i][r].movements.map((pe,oe)=>w(pe,oe))};for(let pe of j.jat[i][r].movements)if(B.features.push(N(pe,B.features.length)),pe.kind=="walking & wheeling"){let oe={...pe,point1:pe.point3,point3:pe.point1};B.features.push(N(oe,B.features.length))}return B}function w(j,B){return{type:"Feature",id:B,properties:{name:j.name,kind:j.kind,color:I[j.score]},geometry:{type:"LineString",coordinates:[j.point1,j.point2,j.point3]}}}function N(j,B){return{type:"Feature",id:B,properties:{kind:j.kind,color:I[j.score],angle:Be(j.point2,j.point3)},geometry:{type:"Point",coordinates:j.point3}}}function u(j){if(!$)return;let B=h(l);for(let pe of l.jat[i][r].arms)B.features.push(Ct(pe,B.features.length));for(let pe of l.summary.networkMap.features)B.features.push(pe);B.features.length>0&&$.fitBounds(gn(B),{padding:20,animate:j})}function p(){return $}const d=()=>t(0,a={mode:"new-arm"}),W=()=>t(0,a={mode:"new-movement"});function F(j,B){n.$$.not_equal(B.point,j)&&(B.point=j,le.set(l))}const b=j=>m({kind:"arm",idx:j}),D=j=>m({kind:"arm",idx:j});function v(j,B){n.$$.not_equal(B.point1,j)&&(B.point1=j,le.set(l))}const Y=j=>m({kind:"movement",idx:j}),L=j=>m({kind:"movement",idx:j});function ie(j,B){n.$$.not_equal(B.point2,j)&&(B.point2=j,le.set(l))}const A=j=>m({kind:"movement",idx:j}),ee=j=>m({kind:"movement",idx:j});function se(j,B){n.$$.not_equal(B.point3,j)&&(B.point3=j,le.set(l))}const re=j=>m({kind:"movement",idx:j}),ue=j=>m({kind:"movement",idx:j});function M(j){$=j,t(6,$)}return n.$$set=j=>{"junctionIdx"in j&&t(1,i=j.junctionIdx),"stage"in j&&t(2,r=j.stage),"mode"in j&&t(0,a=j.mode),"hoveringSidebar"in j&&t(13,s=j.hoveringSidebar),"streetviewOn"in j&&t(14,f=j.streetviewOn),"showRoute"in j&&t(3,c=j.showRoute),"select"in j&&t(4,m=j.select),"stopEditing"in j&&t(5,g=j.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&64&&$&&u(!1),n.$$.dirty[0]&8321&&t(8,o=H(l,a,s))},[a,i,r,c,m,g,$,l,o,I,S,K,h,s,f,u,p,d,W,F,b,D,v,Y,L,ie,A,ee,se,re,ue,M]}class po extends Ne{constructor(e){super(),Oe(this,e,_o,mo,Le,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showRoute:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function we(n){if(n.movements.length==0)return"No movements added";let e=0,t=0;for(let l of n.movements)e+={0:0,1:1,2:2,X:0}[l.score],t+=2;let o=e/t*100;return`${Math.round(o)}%`}const{window:ho}=on;function Tt(n,e,t){const o=n.slice();o[34]=e[t],o[37]=t;const l=o[16][o[34].score];return o[35]=l,o}function Lt(n,e,t){const o=n.slice();return o[38]=e[t],o[37]=t,o}function $o(n){let e,t,o,l,i,r,a,s;e=new et({props:{$$slots:{default:[bo]},$$scope:{ctx:n}}}),e.$on("click",n[11]),o=new nt({props:{$$slots:{default:[ko]},$$scope:{ctx:n}}}),o.$on("click",n[12]);const f=[yo,wo],c=[];function m(g,$){return g[2].id.kind=="movement"?0:1}return i=m(n),r=c[i]=f[i](n),{c(){q(e.$$.fragment),t=O(),q(o.$$.fragment),l=O(),r.c(),a=ke()},l(g){z(e.$$.fragment,g),t=P(g),z(o.$$.fragment,g),l=P(g),r.l(g),a=ke()},m(g,$){U(e,g,$),y(g,t,$),U(o,g,$),y(g,l,$),c[i].m(g,$),y(g,a,$),s=!0},p(g,$){const I={};$[1]&2&&(I.$$scope={dirty:$,ctx:g}),e.$set(I);const H={};$[1]&2&&(H.$$scope={dirty:$,ctx:g}),o.$set(H);let S=i;i=m(g),i===S?c[i].p(g,$):(ve(),T(c[S],1,1,()=>{c[S]=null}),be(),r=c[i],r?r.p(g,$):(r=c[i]=f[i](g),r.c()),k(r,1),r.m(a.parentNode,a))},i(g){s||(k(e.$$.fragment,g),k(o.$$.fragment,g),k(r),s=!0)},o(g){T(e.$$.fragment,g),T(o.$$.fragment,g),T(r),s=!1},d(g){g&&(_(t),_(l),_(a)),G(e,g),G(o,g),c[i].d(g)}}}function vo(n){let e,t,o,l,i,r,a,s=n[8].jat[n[0]].name+"",f,c,m,g,$,I="Arms",H,S,K,h,w="Movements",N,u,p,d,W,F,b=(n[8].jat[n[0]].name||"Untitled junction")+"",D,v,Y=we(n[8].jat[n[0]][n[1]])+"",L,ie,A,ee,se,re;const ue=n[18].default,M=Bt(ue,n,n[32],null);m=new _n({props:{label:"Map tools",$$slots:{default:[Eo]},$$scope:{ctx:n}}});let j=ge(n[8].jat[n[0]][n[1]].arms),B=[];for(let E=0;E<j.length;E+=1)B[E]=Et(Lt(n,j,E));const pe=E=>T(B[E],1,1,()=>{B[E]=null});let oe=n[8].jat[n[0]][n[9]].arms.length>0&&St(n);A=new Pe({props:{disabled:n[8].jat[n[0]][n[1]].arms.length<2,$$slots:{default:[Mo]},$$scope:{ctx:n}}}),A.$on("click",n[17]);let $e=ge(n[8].jat[n[0]][n[1]].movements),ae=[];for(let E=0;E<$e.length;E+=1)ae[E]=Mt(Tt(n,$e,E));const Qt=E=>T(ae[E],1,1,()=>{ae[E]=null});let ce=n[8].jat[n[0]][n[9]].movements.length>0&&It(n);return{c(){M&&M.c(),e=O(),t=Z("div"),o=Z("p"),l=Z("b"),i=V("Currently editing "),r=V(n[1]),a=V(` junction
            `),f=V(s),c=O(),q(m.$$.fragment),g=O(),$=Z("h3"),$.textContent=I,H=O();for(let E=0;E<B.length;E+=1)B[E].c();S=O(),oe&&oe.c(),K=O(),h=Z("h3"),h.textContent=w,N=O(),u=Z("p"),p=V("Total JAT score for "),d=V(n[1]),W=V(` junction
          `),F=Z("i"),D=V(b),v=V(`
          : `),L=V(Y),ie=O(),q(A.$$.fragment),ee=O();for(let E=0;E<ae.length;E+=1)ae[E].c();se=O(),ce&&ce.c(),this.h()},l(E){M&&M.l(E),e=P(E),t=X(E,"DIV",{class:!0});var R=Q(t);o=X(R,"P",{});var he=Q(o);l=X(he,"B",{});var ye=Q(l);i=J(ye,"Currently editing "),r=J(ye,n[1]),a=J(ye,` junction
            `),f=J(ye,s),ye.forEach(_),he.forEach(_),c=P(R),z(m.$$.fragment,R),g=P(R),$=X(R,"H3",{"data-svelte-h":!0}),Fe($)!=="svelte-ld74qb"&&($.textContent=I),H=P(R);for(let Ee=0;Ee<B.length;Ee+=1)B[Ee].l(R);S=P(R),oe&&oe.l(R),K=P(R),h=X(R,"H3",{"data-svelte-h":!0}),Fe(h)!=="svelte-1dc52s8"&&(h.textContent=w),N=P(R),u=X(R,"P",{});var x=Q(u);p=J(x,"Total JAT score for "),d=J(x,n[1]),W=J(x,` junction
          `),F=X(x,"I",{});var Ce=Q(F);D=J(Ce,b),Ce.forEach(_),v=J(x,`
          : `),L=J(x,Y),x.forEach(_),ie=P(R),z(A.$$.fragment,R),ee=P(R);for(let Ee=0;Ee<ae.length;Ee+=1)ae[Ee].l(R);se=P(R),ce&&ce.l(R),R.forEach(_),this.h()},h(){ne(t,"class","govuk-tabs__panel")},m(E,R){M&&M.m(E,R),y(E,e,R),y(E,t,R),C(t,o),C(o,l),C(l,i),C(l,r),C(l,a),C(l,f),C(t,c),U(m,t,null),C(t,g),C(t,$),C(t,H);for(let he=0;he<B.length;he+=1)B[he]&&B[he].m(t,null);C(t,S),oe&&oe.m(t,null),C(t,K),C(t,h),C(t,N),C(t,u),C(u,p),C(u,d),C(u,W),C(u,F),C(F,D),C(u,v),C(u,L),C(t,ie),U(A,t,null),C(t,ee);for(let he=0;he<ae.length;he+=1)ae[he]&&ae[he].m(t,null);C(t,se),ce&&ce.m(t,null),re=!0},p(E,R){M&&M.p&&(!re||R[1]&2)&&Rt(M,ue,E,E[32],re?qt(ue,E[32],R,null):Ft(E[32]),null),(!re||R[0]&2)&&fe(r,E[1]),(!re||R[0]&257)&&s!==(s=E[8].jat[E[0]].name+"")&&fe(f,s);const he={};if(R[0]&112|R[1]&2&&(he.$$scope={dirty:R,ctx:E}),m.$set(he),R[0]&1291){j=ge(E[8].jat[E[0]][E[1]].arms);let x;for(x=0;x<j.length;x+=1){const Ce=Lt(E,j,x);B[x]?(B[x].p(Ce,R),k(B[x],1)):(B[x]=Et(Ce),B[x].c(),k(B[x],1),B[x].m(t,S))}for(ve(),x=j.length;x<B.length;x+=1)pe(x);be()}E[8].jat[E[0]][E[9]].arms.length>0?oe?(oe.p(E,R),R[0]&257&&k(oe,1)):(oe=St(E),oe.c(),k(oe,1),oe.m(t,K)):oe&&(ve(),T(oe,1,1,()=>{oe=null}),be()),(!re||R[0]&2)&&fe(d,E[1]),(!re||R[0]&257)&&b!==(b=(E[8].jat[E[0]].name||"Untitled junction")+"")&&fe(D,b),(!re||R[0]&259)&&Y!==(Y=we(E[8].jat[E[0]][E[1]])+"")&&fe(L,Y);const ye={};if(R[0]&259&&(ye.disabled=E[8].jat[E[0]][E[1]].arms.length<2),R[1]&2&&(ye.$$scope={dirty:R,ctx:E}),A.$set(ye),R[0]&66827){$e=ge(E[8].jat[E[0]][E[1]].movements);let x;for(x=0;x<$e.length;x+=1){const Ce=Tt(E,$e,x);ae[x]?(ae[x].p(Ce,R),k(ae[x],1)):(ae[x]=Mt(Ce),ae[x].c(),k(ae[x],1),ae[x].m(t,se))}for(ve(),x=$e.length;x<ae.length;x+=1)Qt(x);be()}E[8].jat[E[0]][E[9]].movements.length>0?ce?(ce.p(E,R),R[0]&257&&k(ce,1)):(ce=It(E),ce.c(),k(ce,1),ce.m(t,null)):ce&&(ve(),T(ce,1,1,()=>{ce=null}),be())},i(E){if(!re){k(M,E),k(m.$$.fragment,E);for(let R=0;R<j.length;R+=1)k(B[R]);k(oe),k(A.$$.fragment,E);for(let R=0;R<$e.length;R+=1)k(ae[R]);k(ce),re=!0}},o(E){T(M,E),T(m.$$.fragment,E),B=B.filter(Boolean);for(let R=0;R<B.length;R+=1)T(B[R]);T(oe),T(A.$$.fragment,E),ae=ae.filter(Boolean);for(let R=0;R<ae.length;R+=1)T(ae[R]);T(ce),re=!1},d(E){E&&(_(e),_(t)),M&&M.d(E),G(m),je(B,E),oe&&oe.d(),G(A),je(ae,E),ce&&ce.d()}}}function bo(n){let e;return{c(){e=V("Save")},l(t){e=J(t,"Save")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function ko(n){let e;return{c(){e=V("Delete")},l(t){e=J(t,"Delete")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function wo(n){let e,t,o;function l(r){n[29](r)}let i={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(i.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new tt({props:i}),me.push(()=>_e(e,"value",l)),{c(){q(e.$$.fragment)},l(r){z(e.$$.fragment,r)},m(r,a){U(e,r,a),o=!0},p(r,a){const s={};!t&&a[0]&263&&(t=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,de(()=>t=!1)),e.$set(s)},i(r){o||(k(e.$$.fragment,r),o=!0)},o(r){T(e.$$.fragment,r),o=!1},d(r){G(e,r)}}}function yo(n){let e,t,o,l,i,r;return e=new Pn({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),o=new et({props:{$$slots:{default:[jo]},$$scope:{ctx:n}}}),o.$on("click",n[11]),i=new nt({props:{$$slots:{default:[Co]},$$scope:{ctx:n}}}),i.$on("click",n[12]),{c(){q(e.$$.fragment),t=O(),q(o.$$.fragment),l=O(),q(i.$$.fragment)},l(a){z(e.$$.fragment,a),t=P(a),z(o.$$.fragment,a),l=P(a),z(i.$$.fragment,a)},m(a,s){U(e,a,s),y(a,t,s),U(o,a,s),y(a,l,s),U(i,a,s),r=!0},p(a,s){const f={};s[0]&1&&(f.junctionIdx=a[0]),s[0]&2&&(f.stage=a[1]),s[0]&4&&(f.idx=a[2].id.idx),e.$set(f);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:a}),o.$set(c);const m={};s[1]&2&&(m.$$scope={dirty:s,ctx:a}),i.$set(m)},i(a){r||(k(e.$$.fragment,a),k(o.$$.fragment,a),k(i.$$.fragment,a),r=!0)},o(a){T(e.$$.fragment,a),T(o.$$.fragment,a),T(i.$$.fragment,a),r=!1},d(a){a&&(_(t),_(l)),G(e,a),G(o,a),G(i,a)}}}function jo(n){let e;return{c(){e=V("Save")},l(t){e=J(t,"Save")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Co(n){let e;return{c(){e=V("Delete")},l(t){e=J(t,"Delete")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function To(n){let e;return{c(){e=V("Zoom to fit")},l(t){e=J(t,"Zoom to fit")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Lo(n){let e;return{c(){e=V("Show route")},l(t){e=J(t,"Show route")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Eo(n){var K;let e,t,o,l,i,r,a,s,f,c,m,g;e=new Pe({props:{$$slots:{default:[To]},$$scope:{ctx:n}}}),e.$on("click",n[20]),o=new ln({}),i=new en({});function $(h){n[21](h)}let I={map:(K=n[6])==null?void 0:K.getMap()};n[4]!==void 0&&(I.enabled=n[4]),a=new tn({props:I}),me.push(()=>_e(a,"enabled",$));function H(h){n[22](h)}let S={$$slots:{default:[Lo]},$$scope:{ctx:n}};return n[5]!==void 0&&(S.checked=n[5]),c=new rn({props:S}),me.push(()=>_e(c,"checked",H)),{c(){q(e.$$.fragment),t=O(),q(o.$$.fragment),l=O(),q(i.$$.fragment),r=O(),q(a.$$.fragment),f=O(),q(c.$$.fragment)},l(h){z(e.$$.fragment,h),t=P(h),z(o.$$.fragment,h),l=P(h),z(i.$$.fragment,h),r=P(h),z(a.$$.fragment,h),f=P(h),z(c.$$.fragment,h)},m(h,w){U(e,h,w),y(h,t,w),U(o,h,w),y(h,l,w),U(i,h,w),y(h,r,w),U(a,h,w),y(h,f,w),U(c,h,w),g=!0},p(h,w){var d;const N={};w[1]&2&&(N.$$scope={dirty:w,ctx:h}),e.$set(N);const u={};w[0]&64&&(u.map=(d=h[6])==null?void 0:d.getMap()),!s&&w[0]&16&&(s=!0,u.enabled=h[4],de(()=>s=!1)),a.$set(u);const p={};w[1]&2&&(p.$$scope={dirty:w,ctx:h}),!m&&w[0]&32&&(m=!0,p.checked=h[5],de(()=>m=!1)),c.$set(p)},i(h){g||(k(e.$$.fragment,h),k(o.$$.fragment,h),k(i.$$.fragment,h),k(a.$$.fragment,h),k(c.$$.fragment,h),g=!0)},o(h){T(e.$$.fragment,h),T(o.$$.fragment,h),T(i.$$.fragment,h),T(a.$$.fragment,h),T(c.$$.fragment,h),g=!1},d(h){h&&(_(t),_(l),_(r),_(f)),G(e,h),G(o,h),G(i,h),G(a,h),G(c,h)}}}function Et(n){let e,t;function o(){return n[23](n[37])}function l(){return n[24](n[37])}return e=new xe({props:{name:`${At(n[37])} - ${n[38].name||"Unnamed arm"}`,hasSlot:!1}}),e.$on("click",o),e.$on("mouseenter",l),e.$on("mouseleave",n[25]),{c(){q(e.$$.fragment)},l(i){z(e.$$.fragment,i)},m(i,r){U(e,i,r),t=!0},p(i,r){n=i;const a={};r[0]&259&&(a.name=`${At(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(a)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){G(e,i)}}}function St(n){let e,t;return e=new Pe({props:{$$slots:{default:[So]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},p(o,l){const i={};l[1]&2&&(i.$$scope={dirty:l,ctx:o}),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function So(n){let e,t;return{c(){e=V("Copy arms from "),t=V(n[9])},l(o){e=J(o,"Copy arms from "),t=J(o,n[9])},m(o,l){y(o,e,l),y(o,t,l)},p:Ae,d(o){o&&(_(e),_(t))}}}function Mo(n){let e;return{c(){e=V("Generate cycling movements between all arms")},l(t){e=J(t,"Generate cycling movements between all arms")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Io(n){let e,t,o,l=n[34].score+"",i,r,a,s=rt(n[34].kind)+"",f;return{c(){e=Z("div"),t=Z("span"),o=V("Score: "),i=V(l),r=O(),a=Z("span"),f=V(s),this.h()},l(c){e=X(c,"DIV",{style:!0});var m=Q(e);t=X(m,"SPAN",{style:!0});var g=Q(t);o=J(g,"Score: "),i=J(g,l),g.forEach(_),r=P(m),a=X(m,"SPAN",{});var $=Q(a);f=J($,s),$.forEach(_),m.forEach(_),this.h()},h(){te(t,"padding","4px"),te(t,"color",n[35].font),te(t,"background-color",n[35].background),te(e,"width","100%"),te(e,"display","flex"),te(e,"justify-content","space-between")},m(c,m){y(c,e,m),C(e,t),C(t,o),C(t,i),C(e,r),C(e,a),C(a,f)},p(c,m){m[0]&259&&l!==(l=c[34].score+"")&&fe(i,l),m[0]&259&&te(t,"color",c[35].font),m[0]&259&&te(t,"background-color",c[35].background),m[0]&259&&s!==(s=rt(c[34].kind)+"")&&fe(f,s)},d(c){c&&_(e)}}}function Mt(n){let e,t;function o(){return n[26](n[37])}function l(){return n[27](n[37])}return e=new xe({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[Io]},$$scope:{ctx:n}}}),e.$on("click",o),e.$on("mouseenter",l),e.$on("mouseleave",n[28]),{c(){q(e.$$.fragment)},l(i){z(e.$$.fragment,i)},m(i,r){U(e,i,r),t=!0},p(i,r){n=i;const a={};r[0]&259&&(a.name=n[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(a.$$scope={dirty:r,ctx:n}),e.$set(a)},i(i){t||(k(e.$$.fragment,i),t=!0)},o(i){T(e.$$.fragment,i),t=!1},d(i){G(e,i)}}}function It(n){let e,t;return e=new Pe({props:{$$slots:{default:[Ao]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},p(o,l){const i={};l[1]&2&&(i.$$scope={dirty:l,ctx:o}),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function Ao(n){let e,t;return{c(){e=V("Copy movements from "),t=V(n[9])},l(o){e=J(o,"Copy movements from "),t=J(o,n[9])},m(o,l){y(o,e,l),y(o,t,l)},p:Ae,d(o){o&&(_(e),_(t))}}}function No(n){let e,t,o,l,i,r,a,s=we(n[8].jat[n[0]].existing)+"",f,c,m,g=we(n[8].jat[n[0]].proposed)+"",$,I,H,S,K,h,w,N,u,p,d,W,F;function b(A){n[19](A)}let D={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(D.value=n[8].jat[n[0]][n[1]].notes),t=new Ht({props:D}),me.push(()=>_e(t,"value",b));const v=[vo,$o],Y=[];function L(A,ee){return A[2].mode!="editing"?0:1}h=L(n),w=Y[h]=v[h](n);let ie={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showRoute:n[5],select:n[10],stopEditing:n[11]};return p=new po({props:ie}),n[31](p),{c(){e=Z("div"),q(t.$$.fragment),l=O(),i=Z("p"),r=V("Total JAT score: "),a=Z("b"),f=V(s),c=V(`
    existing,
    `),m=Z("b"),$=V(g),I=V(`
    proposed`),H=O(),S=Z("div"),K=Z("div"),w.c(),N=O(),u=Z("div"),q(p.$$.fragment),this.h()},l(A){e=X(A,"DIV",{class:!0});var ee=Q(e);z(t.$$.fragment,ee),l=P(ee),i=X(ee,"P",{});var se=Q(i);r=J(se,"Total JAT score: "),a=X(se,"B",{});var re=Q(a);f=J(re,s),re.forEach(_),c=J(se,`
    existing,
    `),m=X(se,"B",{});var ue=Q(m);$=J(ue,g),ue.forEach(_),I=J(se,`
    proposed`),se.forEach(_),ee.forEach(_),H=P(A),S=X(A,"DIV",{style:!0});var M=Q(S);K=X(M,"DIV",{style:!0});var j=Q(K);w.l(j),j.forEach(_),N=P(M),u=X(M,"DIV",{style:!0});var B=Q(u);z(p.$$.fragment,B),B.forEach(_),M.forEach(_),this.h()},h(){ne(e,"class","govuk-width-container"),te(K,"width","30%"),te(K,"overflow-y","scroll"),te(K,"padding","10px"),te(K,"border","1px solid black"),te(u,"position","relative"),te(u,"width","100%"),te(S,"display","flex"),te(S,"height","80vh")},m(A,ee){y(A,e,ee),U(t,e,null),C(e,l),C(e,i),C(i,r),C(i,a),C(a,f),C(i,c),C(i,m),C(m,$),C(i,I),y(A,H,ee),y(A,S,ee),C(S,K),Y[h].m(K,null),n[30](K),C(S,N),C(S,u),U(p,u,null),d=!0,W||(F=Ut(ho,"keydown",n[13]),W=!0)},p(A,ee){const se={};ee[0]&2&&(se.label="Commentary / Notes about "+A[1]+" junction"),!o&&ee[0]&259&&(o=!0,se.value=A[8].jat[A[0]][A[1]].notes,de(()=>o=!1)),t.$set(se),(!d||ee[0]&257)&&s!==(s=we(A[8].jat[A[0]].existing)+"")&&fe(f,s),(!d||ee[0]&257)&&g!==(g=we(A[8].jat[A[0]].proposed)+"")&&fe($,g);let re=h;h=L(A),h===re?Y[h].p(A,ee):(ve(),T(Y[re],1,1,()=>{Y[re]=null}),be(),w=Y[h],w?w.p(A,ee):(w=Y[h]=v[h](A),w.c()),k(w,1),w.m(K,null));const ue={};ee[0]&1&&(ue.junctionIdx=A[0]),ee[0]&2&&(ue.stage=A[1]),ee[0]&4&&(ue.mode=A[2]),ee[0]&8&&(ue.hoveringSidebar=A[3]),ee[0]&16&&(ue.streetviewOn=A[4]),ee[0]&32&&(ue.showRoute=A[5]),p.$set(ue)},i(A){d||(k(t.$$.fragment,A),k(w),k(p.$$.fragment,A),d=!0)},o(A){T(t.$$.fragment,A),T(w),T(p.$$.fragment,A),d=!1},d(A){A&&(_(e),_(H),_(S)),G(t),Y[h].d(),n[30](null),n[31](null),G(p),W=!1,F()}}}function At(n){return String.fromCharCode(n+65)}function Oo(n,e,t){let o;He(n,le,M=>t(8,o=M));let{$$slots:l={},$$scope:i}=e,{junctionIdx:r}=e,{stage:a}=e,s=a=="existing"?"proposed":"existing",f={mode:"select"},c=null,m=null,g=!1,$=!0,I=null,H;async function S(M){c=H.scrollTop,t(2,f={mode:"editing",id:M}),t(3,m=null),await lt(),t(7,H.scrollTop=0,H)}async function K(){t(2,f={mode:"select"}),c!=null&&(await lt(),t(7,H.scrollTop=c,H),c=null)}function h(){f.mode=="editing"&&window.confirm(`Delete this ${f.id.kind}?`)&&(f.id.kind=="movement"?(o.jat[r][a].movements.splice(f.id.idx,1),le.set(o)):(o.jat[r][a].arms.splice(f.id.idx,1),le.set(o)),K())}function w(M){if(f.mode!="editing")return;let j=M.target.tagName,B=j=="INPUT"||j=="TEXTAREA";M.key=="Escape"||M.key=="Enter"&&!B?(M.stopPropagation(),K()):M.key=="Delete"&&!B&&(M.stopPropagation(),h())}function N(){o.jat[r][a].arms.length>0&&!window.confirm("Overwrite arms?")||(Re(le,o.jat[r][a].arms=JSON.parse(JSON.stringify(o.jat[r][s].arms)),o),le.set(o))}function u(){o.jat[r][a].movements.length>0&&!window.confirm("Overwrite movements?")||(Re(le,o.jat[r][a].movements=JSON.parse(JSON.stringify(o.jat[r][s].movements)),o),le.set(o))}let p={0:Te.red,1:Te.amber,2:Te.green,X:Te.critical};function d(){if(o.jat[r][a].movements.length>0&&!window.confirm("Overwrite all cycling movements?"))return;let M=o.jat[r][a].movements.filter(j=>j.kind=="walking & wheeling");Re(le,o.jat[r][a].movements=[...M,...Un(o.jat[r][a].arms)],o)}function W(M){n.$$.not_equal(o.jat[r][a].notes,M)&&(o.jat[r][a].notes=M,le.set(o))}const F=()=>I==null?void 0:I.zoom(!0);function b(M){g=M,t(4,g)}function D(M){$=M,t(5,$)}const v=M=>S({kind:"arm",idx:M}),Y=M=>t(3,m={kind:"arm",idx:M}),L=()=>t(3,m=null),ie=M=>S({kind:"movement",idx:M}),A=M=>t(3,m={kind:"movement",idx:M}),ee=()=>t(3,m=null);function se(M){n.$$.not_equal(o.jat[r][a].arms[f.id.idx].name,M)&&(o.jat[r][a].arms[f.id.idx].name=M,le.set(o))}function re(M){me[M?"unshift":"push"](()=>{H=M,t(7,H)})}function ue(M){me[M?"unshift":"push"](()=>{I=M,t(6,I)})}return n.$$set=M=>{"junctionIdx"in M&&t(0,r=M.junctionIdx),"stage"in M&&t(1,a=M.stage),"$$scope"in M&&t(32,i=M.$$scope)},[r,a,f,m,g,$,I,H,o,s,S,K,h,w,N,u,p,d,l,W,F,b,D,v,Y,L,ie,A,ee,se,re,ue,i]}class Po extends Ne{constructor(e){super(),Oe(this,e,Oo,No,Le,{junctionIdx:0,stage:1},null,[-1,-1])}}function Do(n){let e,t,o,l,i;return{c(){e=Z("li"),t=Z("a"),o=V(n[0]),this.h()},l(r){e=X(r,"LI",{class:!0});var a=Q(e);t=X(a,"A",{class:!0,href:!0});var s=Q(t);o=J(s,n[0]),s.forEach(_),a.forEach(_),this.h()},h(){ne(t,"class","govuk-tabs__tab"),ne(t,"href","#"),ne(e,"class","govuk-tabs__list-item")},m(r,a){y(r,e,a),C(e,t),C(t,o),l||(i=Ut(t,"click",xt(n[2])),l=!0)},p(r,a){a&1&&fe(o,r[0])},d(r){r&&_(e),l=!1,i()}}}function Bo(n){let e,t;return{c(){e=Z("li"),t=V(n[0]),this.h()},l(o){e=X(o,"LI",{class:!0});var l=Q(e);t=J(l,n[0]),l.forEach(_),this.h()},h(){ne(e,"class","govuk-tabs__list-item govuk-tabs__list-item--selected")},m(o,l){y(o,e,l),C(e,t)},p(o,l){l&1&&fe(t,o[0])},d(o){o&&_(e)}}}function Ro(n){let e;function t(i,r){return i[1]?Bo:Do}let o=t(n),l=o(n);return{c(){l.c(),e=ke()},l(i){l.l(i),e=ke()},m(i,r){l.m(i,r),y(i,e,r)},p(i,[r]){o===(o=t(i))&&l?l.p(i,r):(l.d(1),l=o(i),l&&(l.c(),l.m(e.parentNode,e)))},i:Ae,o:Ae,d(i){i&&_(e),l.d(i)}}}function Fo(n,e,t){let{label:o}=e,{isCurrent:l}=e;function i(r){Me.call(this,n,r)}return n.$$set=r=>{"label"in r&&t(0,o=r.label),"isCurrent"in r&&t(1,l=r.isCurrent)},[o,l,i]}class Nt extends Ne{constructor(e){super(),Oe(this,e,Fo,Ro,Le,{label:0,isCurrent:1})}}function Ot(n,e,t){const o=n.slice();return o[10]=e[t],o[12]=t,o}function qo(n){let e,t,o=(n[1].jat[n[0].idx].name||"Untitled junction")+"",l,i,r=n[0].stage+"",a,s,f,c,m,g,$,I=n[0].stage,H,S;f=new nn({props:{$$slots:{default:[Ho]},$$scope:{ctx:n}}});function K(N){n[7](N)}let h={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(h.value=n[1].jat[n[0].idx].name),m=new tt({props:h}),me.push(()=>_e(m,"value",K));let w=Pt(n);return{c(){e=Z("div"),t=Z("h2"),l=V(o),i=V(" - "),a=V(r),s=O(),q(f.$$.fragment),c=O(),q(m.$$.fragment),$=O(),w.c(),H=ke(),this.h()},l(N){e=X(N,"DIV",{class:!0});var u=Q(e);t=X(u,"H2",{});var p=Q(t);l=J(p,o),i=J(p," - "),a=J(p,r),p.forEach(_),s=P(u),z(f.$$.fragment,u),c=P(u),z(m.$$.fragment,u),u.forEach(_),$=P(N),w.l(N),H=ke(),this.h()},h(){ne(e,"class","govuk-width-container")},m(N,u){y(N,e,u),C(e,t),C(t,l),C(t,i),C(t,a),C(e,s),U(f,e,null),C(e,c),U(m,e,null),y(N,$,u),w.m(N,u),y(N,H,u),S=!0},p(N,u){(!S||u&3)&&o!==(o=(N[1].jat[N[0].idx].name||"Untitled junction")+"")&&fe(l,o),(!S||u&1)&&r!==(r=N[0].stage+"")&&fe(a,r);const p={};u&8193&&(p.$$scope={dirty:u,ctx:N}),f.$set(p);const d={};!g&&u&3&&(g=!0,d.value=N[1].jat[N[0].idx].name,de(()=>g=!1)),m.$set(d),u&1&&Le(I,I=N[0].stage)?(ve(),T(w,1,1,Ae),be(),w=Pt(N),w.c(),k(w,1),w.m(H.parentNode,H)):w.p(N,u)},i(N){S||(k(f.$$.fragment,N),k(m.$$.fragment,N),k(w),S=!0)},o(N){T(f.$$.fragment,N),T(m.$$.fragment,N),T(w),S=!1},d(N){N&&(_(e),_($),_(H)),G(f),G(m),w.d(N)}}}function zo(n){let e,t,o,l;t=new et({props:{$$slots:{default:[Jo]},$$scope:{ctx:n}}}),t.$on("click",n[2]);let i=ge(n[1].jat),r=[];for(let s=0;s<i.length;s+=1)r[s]=Dt(Ot(n,i,s));const a=s=>T(r[s],1,1,()=>{r[s]=null});return{c(){e=Z("div"),q(t.$$.fragment),o=O();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=X(s,"DIV",{class:!0});var f=Q(e);z(t.$$.fragment,f),o=P(f);for(let c=0;c<r.length;c+=1)r[c].l(f);f.forEach(_),this.h()},h(){ne(e,"class","govuk-width-container")},m(s,f){y(s,e,f),U(t,e,null),C(e,o);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);l=!0},p(s,f){const c={};if(f&8192&&(c.$$scope={dirty:f,ctx:s}),t.$set(c),f&3){i=ge(s[1].jat);let m;for(m=0;m<i.length;m+=1){const g=Ot(s,i,m);r[m]?(r[m].p(g,f),k(r[m],1)):(r[m]=Dt(g),r[m].c(),k(r[m],1),r[m].m(e,null))}for(ve(),m=i.length;m<r.length;m+=1)a(m);be()}},i(s){if(!l){k(t.$$.fragment,s);for(let f=0;f<i.length;f+=1)k(r[f]);l=!0}},o(s){T(t.$$.fragment,s),r=r.filter(Boolean);for(let f=0;f<r.length;f+=1)T(r[f]);l=!1},d(s){s&&_(e),G(t),je(r,s)}}}function Uo(n){let e;return{c(){e=V("Back to all junctions")},l(t){e=J(t,"Back to all junctions")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Go(n){let e;return{c(){e=V("Delete junction")},l(t){e=J(t,"Delete junction")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Ho(n){let e,t,o,l;return e=new Pe({props:{$$slots:{default:[Uo]},$$scope:{ctx:n}}}),e.$on("click",n[5]),o=new nt({props:{$$slots:{default:[Go]},$$scope:{ctx:n}}}),o.$on("click",n[6]),{c(){q(e.$$.fragment),t=O(),q(o.$$.fragment)},l(i){z(e.$$.fragment,i),t=P(i),z(o.$$.fragment,i)},m(i,r){U(e,i,r),y(i,t,r),U(o,i,r),l=!0},p(i,r){const a={};r&8192&&(a.$$scope={dirty:r,ctx:i}),e.$set(a);const s={};r&8192&&(s.$$scope={dirty:r,ctx:i}),o.$set(s)},i(i){l||(k(e.$$.fragment,i),k(o.$$.fragment,i),l=!0)},o(i){T(e.$$.fragment,i),T(o.$$.fragment,i),l=!1},d(i){i&&_(t),G(e,i),G(o,i)}}}function Vo(n){let e,t,o,l,i;return t=new Nt({props:{label:"Existing",isCurrent:n[0].stage=="existing"}}),t.$on("click",n[8]),l=new Nt({props:{label:"Proposed",isCurrent:n[0].stage=="proposed"}}),l.$on("click",n[9]),{c(){e=Z("ul"),q(t.$$.fragment),o=O(),q(l.$$.fragment),this.h()},l(r){e=X(r,"UL",{class:!0,style:!0});var a=Q(e);z(t.$$.fragment,a),o=P(a),z(l.$$.fragment,a),a.forEach(_),this.h()},h(){ne(e,"class","govuk-tabs__list"),te(e,"list-style-type","none")},m(r,a){y(r,e,a),U(t,e,null),C(e,o),U(l,e,null),i=!0},p(r,a){const s={};a&1&&(s.isCurrent=r[0].stage=="existing"),t.$set(s);const f={};a&1&&(f.isCurrent=r[0].stage=="proposed"),l.$set(f)},i(r){i||(k(t.$$.fragment,r),k(l.$$.fragment,r),i=!0)},o(r){T(t.$$.fragment,r),T(l.$$.fragment,r),i=!1},d(r){r&&_(e),G(t),G(l)}}}function Pt(n){let e,t;return e=new Po({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[Vo]},$$scope:{ctx:n}}}),{c(){q(e.$$.fragment)},l(o){z(e.$$.fragment,o)},m(o,l){U(e,o,l),t=!0},p(o,l){const i={};l&1&&(i.junctionIdx=o[0].idx),l&1&&(i.stage=o[0].stage),l&8193&&(i.$$scope={dirty:l,ctx:o}),e.$set(i)},i(o){t||(k(e.$$.fragment,o),t=!0)},o(o){T(e.$$.fragment,o),t=!1},d(o){G(e,o)}}}function Jo(n){let e;return{c(){e=V("Add new junction")},l(t){e=J(t,"Add new junction")},m(t,o){y(t,e,o)},d(t){t&&_(e)}}}function Zo(n){let e,t,o,l=we(n[10].existing)+"",i,r,a,s,f=we(n[10].proposed)+"",c,m;return{c(){e=Z("div"),t=Z("span"),o=V("Existing: "),i=V(l),r=O(),a=Z("span"),s=V("Proposed: "),c=V(f),m=O(),this.h()},l(g){e=X(g,"DIV",{style:!0});var $=Q(e);t=X($,"SPAN",{});var I=Q(t);o=J(I,"Existing: "),i=J(I,l),I.forEach(_),r=P($),a=X($,"SPAN",{});var H=Q(a);s=J(H,"Proposed: "),c=J(H,f),H.forEach(_),$.forEach(_),m=P(g),this.h()},h(){te(e,"width","100%"),te(e,"display","flex"),te(e,"justify-content","space-between")},m(g,$){y(g,e,$),C(e,t),C(t,o),C(t,i),C(e,r),C(e,a),C(a,s),C(a,c),y(g,m,$)},p(g,$){$&2&&l!==(l=we(g[10].existing)+"")&&fe(i,l),$&2&&f!==(f=we(g[10].proposed)+"")&&fe(c,f)},d(g){g&&(_(e),_(m))}}}function Dt(n){let e,t;function o(){return n[4](n[12])}return e=new xe({props:{name:n[10].name||"Untitled junction",$$slots:{default:[Zo]},$$scope:{ctx:n}}}),e.$on("click",o),{c(){q(e.$$.fragment)},l(l){z(e.$$.fragment,l)},m(l,i){U(e,l,i),t=!0},p(l,i){n=l;const r={};i&2&&(r.name=n[10].name||"Untitled junction"),i&8194&&(r.$$scope={dirty:i,ctx:n}),e.$set(r)},i(l){t||(k(e.$$.fragment,l),t=!0)},o(l){T(e.$$.fragment,l),t=!1},d(l){G(e,l)}}}function Xo(n){let e,t,o,l;const i=[zo,qo],r=[];function a(s,f){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(n))&&(t=r[e]=i[e](n)),{c(){t&&t.c(),o=ke()},l(s){t&&t.l(s),o=ke()},m(s,f){~e&&r[e].m(s,f),y(s,o,f),l=!0},p(s,[f]){let c=e;e=a(s),e===c?~e&&r[e].p(s,f):(t&&(ve(),T(r[c],1,1,()=>{r[c]=null}),be()),~e?(t=r[e],t?t.p(s,f):(t=r[e]=i[e](s),t.c()),k(t,1),t.m(o.parentNode,o)):t=null)},i(s){l||(k(t),l=!0)},o(s){T(t),l=!1},d(s){s&&_(o),~e&&r[e].d(s)}}}function We(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Wo(n,e,t){let o;He(n,le,$=>t(1,o=$));let l={kind:"list"};function i(){Re(le,o.jat=[...o.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],o),t(0,l={kind:"edit",idx:o.jat.length-1,stage:"existing"})}function r($){window.confirm("Delete this junction?")&&(o.jat.splice($,1),le.set(o),t(0,l={kind:"list"}))}const a=$=>t(0,l={kind:"edit",idx:$,stage:"existing"}),s=()=>t(0,l={kind:"list"}),f=()=>r(We(l));function c($){n.$$.not_equal(o.jat[l.idx].name,$)&&(o.jat[l.idx].name=$,le.set(o))}return[l,o,i,r,a,s,f,c,()=>t(0,l={kind:"edit",idx:We(l),stage:"existing"}),()=>t(0,l={kind:"edit",idx:We(l),stage:"proposed"})]}class jl extends Ne{constructor(e){super(),Oe(this,e,Wo,Xo,Le,{})}}export{jl as component};
