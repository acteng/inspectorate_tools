import{s as we,v as ee,x as re,l as xe,u as et,m as tt,o as rt,H as he,E as _e,i as M,f as b,a9 as nr,a8 as or,k as pe,U as Tt,a7 as It,N as St,e as V,c as J,b as $,r as G,n as Fe,R as Ne,S as De,w as Y,h as Q,t as oe,a as z,d as ie,g as H,j as Re,z as qe,p as ir,q as Bt,B as lr}from"../chunks/scheduler.Bsni_e59.js";import{S as ke,i as Ee,e as ne,c as T,a as I,m as S,t as k,b as E,d as B,g as Ce,f as Le}from"../chunks/index.CCfAUppz.js";import{L as ar,g as sr,e as ur,m as de,i as fr,f as qt,M as cr,a as mr,G as dt,h as _t}from"../chunks/MapLibreMap.ooVieJtI.js";import{e as ze}from"../chunks/each.BmgwAlbi.js";import{c as me}from"../chunks/colors.CYEpEtTL.js";import{D as gr}from"../chunks/DefaultButton.DyQsHGbh.js";import{W as hr,S as pr}from"../chunks/WarningButton.D9QeV9gM.js";import{a as dr,B as _r,G as yr,S as br,c as vr,M as yt}from"../chunks/GeoreferenceLayer.CXB2jUNZ.js";import{s as x}from"../chunks/data.YWUIvoOn.js";import{p as bt}from"../chunks/index.DptIILEH.js";import{S as vt}from"../chunks/Select.bLRJACqI.js";import{T as wr}from"../chunks/TextInput.CHbK327s.js";function kr(t){let e;const r=t[15].default,n=xe(r,t,t[23],null);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i&8388608)&&et(n,r,o,o[23],e?rt(r,o[23],i,null):tt(o[23]),null)},i(o){e||(k(n,o),e=!0)},o(o){E(n,o),e=!1},d(o){n&&n.d(o)}}}function Er(t){let e,r,n;function o(l){t[16](l)}let i={id:t[1],type:"line",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],minzoom:t[9],maxzoom:t[10],hoverCursor:t[11],manageHoverState:t[12],eventsIfTopMost:t[13],interactive:t[14],$$slots:{default:[kr]},$$scope:{ctx:t}};return t[0]!==void 0&&(i.hovered=t[0]),e=new ar({props:i}),ee.push(()=>ne(e,"hovered",o)),e.$on("click",t[17]),e.$on("dblclick",t[18]),e.$on("contextmenu",t[19]),e.$on("mouseenter",t[20]),e.$on("mousemove",t[21]),e.$on("mouseleave",t[22]),{c(){T(e.$$.fragment)},l(l){I(e.$$.fragment,l)},m(l,a){S(e,l,a),n=!0},p(l,[a]){const s={};a&2&&(s.id=l[1]),a&4&&(s.source=l[2]),a&8&&(s.sourceLayer=l[3]),a&16&&(s.beforeId=l[4]),a&32&&(s.beforeLayerType=l[5]),a&64&&(s.paint=l[6]),a&128&&(s.layout=l[7]),a&256&&(s.filter=l[8]),a&512&&(s.minzoom=l[9]),a&1024&&(s.maxzoom=l[10]),a&2048&&(s.hoverCursor=l[11]),a&4096&&(s.manageHoverState=l[12]),a&8192&&(s.eventsIfTopMost=l[13]),a&16384&&(s.interactive=l[14]),a&8388608&&(s.$$scope={dirty:a,ctx:l}),!r&&a&1&&(r=!0,s.hovered=l[0],re(()=>r=!1)),e.$set(s)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){E(e.$$.fragment,l),n=!1},d(l){B(e,l)}}}function Cr(t,e,r){let{$$slots:n={},$$scope:o}=e,{id:i=sr("line")}=e,{source:l=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:g=void 0}=e,{paint:p}=e,{layout:f=void 0}=e,{filter:h=void 0}=e,{minzoom:m=void 0}=e,{maxzoom:w=void 0}=e,{hoverCursor:C=void 0}=e,{manageHoverState:u=!1}=e,{hovered:d=null}=e,{eventsIfTopMost:L=!1}=e,{interactive:O=!0}=e;function N(y){d=y,r(0,d)}function _(y){he.call(this,t,y)}function F(y){he.call(this,t,y)}function D(y){he.call(this,t,y)}function K(y){he.call(this,t,y)}function q(y){he.call(this,t,y)}function fe(y){he.call(this,t,y)}return t.$$set=y=>{"id"in y&&r(1,i=y.id),"source"in y&&r(2,l=y.source),"sourceLayer"in y&&r(3,a=y.sourceLayer),"beforeId"in y&&r(4,s=y.beforeId),"beforeLayerType"in y&&r(5,g=y.beforeLayerType),"paint"in y&&r(6,p=y.paint),"layout"in y&&r(7,f=y.layout),"filter"in y&&r(8,h=y.filter),"minzoom"in y&&r(9,m=y.minzoom),"maxzoom"in y&&r(10,w=y.maxzoom),"hoverCursor"in y&&r(11,C=y.hoverCursor),"manageHoverState"in y&&r(12,u=y.manageHoverState),"hovered"in y&&r(0,d=y.hovered),"eventsIfTopMost"in y&&r(13,L=y.eventsIfTopMost),"interactive"in y&&r(14,O=y.interactive),"$$scope"in y&&r(23,o=y.$$scope)},[d,i,l,a,s,g,p,f,h,m,w,C,u,L,O,n,N,_,F,D,K,q,fe,o]}class Ze extends ke{constructor(e){super(),Ee(this,e,Cr,Er,we,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,minzoom:9,maxzoom:10,hoverCursor:11,manageHoverState:12,hovered:0,eventsIfTopMost:13,interactive:14})}}const Lr=t=>({features:t[0]&16,data:t[0]&16,map:t[0]&4,close:t[0]&1}),wt=t=>{var e;return{features:t[4],data:(e=t[4])==null?void 0:e[0],map:t[2],close:t[31]}};function kt(t){let e,r,n=(t[4]||t[3]instanceof de.Marker)&&Et(t);return{c(){e=V("div"),n&&n.c()},l(o){e=J(o,"DIV",{});var i=$(e);n&&n.l(i),i.forEach(b)},m(o,i){M(o,e,i),n&&n.m(e,null),t[32](e),r=!0},p(o,i){o[4]||o[3]instanceof de.Marker?n?(n.p(o,i),i[0]&24&&k(n,1)):(n=Et(o),n.c(),k(n,1),n.m(e,null)):n&&(Ce(),E(n,1,1,()=>{n=null}),Le())},i(o){r||(k(n),r=!0)},o(o){E(n),r=!1},d(o){o&&b(e),n&&n.d(),t[32](null)}}}function Et(t){let e;const r=t[30].default,n=xe(r,t,t[29],wt);return{c(){n&&n.c()},l(o){n&&n.l(o)},m(o,i){n&&n.m(o,i),e=!0},p(o,i){n&&n.p&&(!e||i[0]&536870933)&&et(n,r,o,o[29],e?rt(r,o[29],i,Lr):tt(o[29]),wt)},i(o){e||(k(n,o),e=!0)},o(o){E(n,o),e=!1},d(o){n&&n.d(o)}}}function Pr(t){let e,r,n=t[9].default&&kt(t);return{c(){n&&n.c(),e=_e()},l(o){n&&n.l(o),e=_e()},m(o,i){n&&n.m(o,i),M(o,e,i),r=!0},p(o,i){o[9].default?n?(n.p(o,i),i[0]&512&&k(n,1)):(n=kt(o),n.c(),k(n,1),n.m(e.parentNode,e)):n&&(Ce(),E(n,1,1,()=>{n=null}),Le())},i(o){r||(k(n),r=!0)},o(o){E(n),r=!1},d(o){o&&b(e),n&&n.d(o)}}}function Mr(t,e,r){let n,o,i,l,a,s,{$$slots:g={},$$scope:p}=e;const f=nr(g);let{closeButton:h=void 0}=e,{closeOnClickOutside:m=!0}=e,{closeOnClickInside:w=!1}=e,{closeOnMove:C=!1}=e,{openOn:u="click"}=e,{openIfTopMost:d=!0}=e,{focusAfterOpen:L=!0}=e,{anchor:O=void 0}=e,{offset:N=void 0}=e,{popupClass:_=void 0}=e,{maxWidth:F=void 0}=e,{lngLat:D=void 0}=e,{html:K=void 0}=e,{open:q=!1}=e;const fe=or(),{map:y,popupTarget:Te,layerEvent:v,layer:R,eventTopMost:Pe}=ur();pe(t,y,c=>r(2,i=c)),pe(t,Te,c=>r(3,a=c)),pe(t,v,c=>r(28,l=c)),pe(t,R,c=>r(35,s=c));const Ie=["click","dblclick","contextmenu"];let P,Se=!1,te;function er(){if(!P)return;let c=P.getElement();!c||c===te||(te=c,u==="hover"&&(te.style.pointerEvents="none"),te.addEventListener("mouseenter",()=>{r(24,Se=!0)},{passive:!0}),te.addEventListener("mouseleave",()=>{r(24,Se=!1)},{passive:!0}),te.addEventListener("click",()=>{w&&r(0,q=!1)},{passive:!0}))}Tt(()=>{if(i)return i.on("click",Be),i.on("contextmenu",Be),typeof a=="string"&&(i.on("click",a,ce),i.on("dblclick",a,ce),i.on("contextmenu",a,ce),i.on("mousemove",a,pt),i.on("mouseleave",a,ht),i.on("touchstart",a,mt),i.on("touchend",a,gt)),()=>{i!=null&&i.loaded()&&(P==null||P.remove(),i.off("click",Be),i.off("contextmenu",Be),a instanceof de.Marker?a.getPopup()===P&&a.setPopup(void 0):typeof a=="string"&&(i.off("click",a,ce),i.off("dblclick",a,ce),i.off("contextmenu",a,ce),i.off("mousemove",a,pt),i.off("mouseleave",a,ht),i.off("touchstart",a,mt),i.off("touchend",a,gt)))}});function ct(c){return d?!("marker"in c)&&!fr(c)&&Pe(c)!==s:!1}let Z=null,X="normal";function ce(c){c.type===u&&(ct(c)||("layerType"in c?c.layerType==="deckgl"?(r(10,D=c.coordinate),r(4,Z=c.object?[c.object]:null)):(r(10,D=c.lngLat),r(4,Z=c.features??[])):(r(10,D=c.lngLat),r(4,Z=c.features??[])),setTimeout(()=>r(0,q=!0))))}let ge=null;function mt(c){ge=c.point}function gt(c){if(!ge||u!=="hover")return;let Je=ge.dist(c.point);ge=null,Je<3&&(r(10,D=c.lngLat),r(4,Z=c.features??[]),P.isOpen()?r(25,X="justOpened"):(r(25,X="opening"),r(0,q=!0)))}function ht(c){u!=="hover"||ge||X!=="normal"||(r(0,q=!1),r(4,Z=null))}function pt(c){if(!(u!=="hover"||ge||X!=="normal")){if(ct(c)){r(0,q=!1),r(4,Z=null);return}r(0,q=!0),r(4,Z=c.features??[]),r(10,D=c.lngLat)}}function Be(c){if(X==="justOpened"){r(25,X="normal");return}if(!m)return;let Je=[te,a instanceof de.Marker?a==null?void 0:a.getElement():null];q&&P.isOpen()&&!Je.some(Ke=>Ke==null?void 0:Ke.contains(c.originalEvent.target))&&(c.type==="contextmenu"&&u==="contextmenu"||c.type!=="contextmenu")&&r(0,q=!1)}It(()=>{i&&(P!=null&&P.isOpen())&&P.remove()});let Me;const tr=()=>r(0,q=!1);function rr(c){ee[c?"unshift":"push"](()=>{Me=c,r(1,Me)})}return t.$$set=c=>{"closeButton"in c&&r(11,h=c.closeButton),"closeOnClickOutside"in c&&r(12,m=c.closeOnClickOutside),"closeOnClickInside"in c&&r(13,w=c.closeOnClickInside),"closeOnMove"in c&&r(14,C=c.closeOnMove),"openOn"in c&&r(15,u=c.openOn),"openIfTopMost"in c&&r(16,d=c.openIfTopMost),"focusAfterOpen"in c&&r(17,L=c.focusAfterOpen),"anchor"in c&&r(18,O=c.anchor),"offset"in c&&r(19,N=c.offset),"popupClass"in c&&r(20,_=c.popupClass),"maxWidth"in c&&r(21,F=c.maxWidth),"lngLat"in c&&r(10,D=c.lngLat),"html"in c&&r(22,K=c.html),"open"in c&&r(0,q=c.open),"$$scope"in c&&r(29,p=c.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&14336&&r(27,n=h??(!m&&!w)),t.$$.dirty[0]&146685952&&(P||(r(23,P=new de.Popup({closeButton:n,closeOnClick:!1,closeOnMove:C,focusAfterOpen:L,maxWidth:F,className:_,anchor:O,offset:N})),te=P.getElement(),P.on("open",()=>{r(0,q=!0),er(),fe("open",P)}),P.on("close",()=>{r(0,q=!1),fe("close",P)}),P.on("hover",()=>{fe("hover",P)}))),t.$$.dirty[0]&8421384&&P&&a instanceof de.Marker&&(u==="click"?a.setPopup(P):a.getPopup()===P&&a.setPopup(void 0)),t.$$.dirty[0]&268468224&&Ie.includes(u)&&(l==null?void 0:l.type)===u&&(ce(l),St(v,l=null,l)),t.$$.dirty[0]&268468224&&r(26,o=u==="hover"&&((l==null?void 0:l.type)==="mousemove"||(l==null?void 0:l.type)==="mouseenter")),t.$$.dirty[0]&352354304&&u==="hover"&&v&&(o&&l&&(l.layerType==="deckgl"?(r(10,D=l.coordinate),r(4,Z=l.object?[l.object]:null)):(r(10,D=l.lngLat),r(4,Z=l.features??[]))),r(0,q=(o||Se)??!1)),t.$$.dirty[0]&12582914&&(Me?P.setDOMContent(Me):K&&P.setHTML(K)),t.$$.dirty[0]&8389632&&D&&P.setLngLat(D),t.$$.dirty[0]&41943045&&i){let c=P.isOpen();q&&!c?(P.addTo(i),X==="opening"&&r(25,X="justOpened")):!q&&c&&P.remove()}},[q,Me,i,a,Z,y,Te,v,R,f,D,h,m,w,C,u,d,L,O,N,_,F,K,P,Se,X,o,n,l,p,g,tr,rr]}class Or extends ke{constructor(e){super(),Ee(this,e,Mr,Pr,we,{closeButton:11,closeOnClickOutside:12,closeOnClickInside:13,closeOnMove:14,openOn:15,openIfTopMost:16,focusAfterOpen:17,anchor:18,offset:19,popupClass:20,maxWidth:21,lngLat:10,html:22,open:0},null,[-1,-1])}}const Ar=t=>({props:t&8}),Ct=t=>({props:Tr(t[3])});function jr(t){let e,r;const n=t[1].default,o=xe(n,t,t[2],Ct);return{c(){e=V("div"),o&&o.c(),this.h()},l(i){e=J(i,"DIV",{class:!0});var l=$(e);o&&o.l(l),l.forEach(b),this.h()},h(){G(e,"class","govuk-prose")},m(i,l){M(i,e,l),o&&o.m(e,null),r=!0},p(i,l){o&&o.p&&(!r||l&12)&&et(o,n,i,i[2],r?rt(n,i[2],l,Ar):tt(i[2]),Ct)},i(i){r||(k(o,i),r=!0)},o(i){E(o,i),r=!1},d(i){i&&b(e),o&&o.d(i)}}}function Fr(t){let e,r;return e=new Or({props:{openOn:t[0],$$slots:{default:[jr,({features:n})=>({3:n}),({features:n})=>n?8:0]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,[o]){const i={};o&1&&(i.openOn=n[0]),o&12&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(k(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Tr(t){return t?t[0].properties??{}:{}}function Ir(t,e,r){let{$$slots:n={},$$scope:o}=e,{openOn:i="hover"}=e;return t.$$set=l=>{"openOn"in l&&r(0,i=l.openOn),"$$scope"in l&&r(2,o=l.$$scope)},[i,n,o]}class Gt extends ke{constructor(e){super(),Ee(this,e,Ir,Fr,we,{openOn:0})}}var Sr=Object.defineProperty,A=(t,e)=>Sr(t,"name",{value:e,configurable:!0}),Br=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Oe(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Qe(e),o=Qe(r);return n.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Oe(e,r))return!1;const i=e;let l=r;if(o&&!this.compareCoord(i[0],l[0])){const s=this.fixStartIndex(l,i);if(s)l=s;else return!1}const a=this.compareCoord(i[n],l[n]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[n],l[l.length-(1+n)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,r){let n,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],r[0])){o=i;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,r){return Oe(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?qt(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Oe(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};A(Br,"GeojsonEquality");function Oe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}A(Oe,"sameLength");function Qe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}A(Qe,"explode");var W=63710088e-1,Nt={centimeters:W*100,centimetres:W*100,degrees:360/(2*Math.PI),feet:W*3.28084,inches:W*39.37,kilometers:W/1e3,kilometres:W/1e3,meters:W,metres:W,miles:W/1609.344,millimeters:W*1e3,millimetres:W*1e3,nauticalmiles:W/1852,radians:1,yards:W*1.0936},Lt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function le(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}A(le,"feature");function qr(t,e,r={}){switch(t){case"Point":return $e(e).geometry;case"LineString":return ot(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return zt(e).geometry;case"MultiLineString":return Dt(e).geometry;case"MultiPolygon":return Ht(e).geometry;default:throw new Error(t+" is invalid")}}A(qr,"geometry");function $e(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!ye(t[0])||!ye(t[1]))throw new Error("coordinates must contain numbers");return le({type:"Point",coordinates:t},e,r)}A($e,"point");function Gr(t,e,r={}){return We(t.map(n=>$e(n,e)),r)}A(Gr,"points");function nt(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return le({type:"Polygon",coordinates:t},e,r)}A(nt,"polygon");function Nr(t,e,r={}){return We(t.map(n=>nt(n,e)),r)}A(Nr,"polygons");function ot(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return le({type:"LineString",coordinates:t},e,r)}A(ot,"lineString");function Dr(t,e,r={}){return We(t.map(n=>ot(n,e)),r)}A(Dr,"lineStrings");function We(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}A(We,"featureCollection");function Dt(t,e,r={}){return le({type:"MultiLineString",coordinates:t},e,r)}A(Dt,"multiLineString");function zt(t,e,r={}){return le({type:"MultiPoint",coordinates:t},e,r)}A(zt,"multiPoint");function Ht(t,e,r={}){return le({type:"MultiPolygon",coordinates:t},e,r)}A(Ht,"multiPolygon");function zr(t,e,r={}){return le({type:"GeometryCollection",geometries:t},e,r)}A(zr,"geometryCollection");function Hr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}A(Hr,"round");function Rt(t,e="kilometers"){const r=Nt[e];if(!r)throw new Error(e+" units is invalid");return t*r}A(Rt,"radiansToLength");function Ue(t,e="kilometers"){const r=Nt[e];if(!r)throw new Error(e+" units is invalid");return t/r}A(Ue,"lengthToRadians");function Rr(t,e){return He(Ue(t,e))}A(Rr,"lengthToDegrees");function $r(t){let e=t%360;return e<0&&(e+=360),e}A($r,"bearingToAzimuth");function He(t){return t%(2*Math.PI)*180/Math.PI}A(He,"radiansToDegrees");function Ge(t){return t%360*Math.PI/180}A(Ge,"degreesToRadians");function Wr(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Rt(Ue(t,e),r)}A(Wr,"convertLength");function Ur(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Lt[e];if(!n)throw new Error("invalid original units");const o=Lt[r];if(!o)throw new Error("invalid final units");return t/n*o}A(Ur,"convertArea");function ye(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}A(ye,"isNumber");function Vr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}A(Vr,"isObject");function Jr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!ye(e))throw new Error("bbox must only contain numbers")})}A(Jr,"validateBBox");function Kr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}A(Kr,"validateId");var Zr=Object.defineProperty,ae=(t,e)=>Zr(t,"name",{value:e,configurable:!0});function $t(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ae($t,"getCoord");function Qr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ae(Qr,"getCoords");function Wt(t){if(t.length>1&&ye(t[0])&&ye(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Wt(t[0]);throw new Error("coordinates must only contain numbers")}ae(Wt,"containsNumber");function Xr(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}ae(Xr,"geojsonType");function Yr(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}ae(Yr,"featureOf");function xr(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}ae(xr,"collectionOf");function en(t){return t.type==="Feature"?t.geometry:t}ae(en,"getGeom");function tn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ae(tn,"getType");var rn=Object.defineProperty,nn=(t,e)=>rn(t,"name",{value:e,configurable:!0});function Ut(t,e,r,n={}){const o=$t(t),i=Ge(o[0]),l=Ge(o[1]),a=Ge(r),s=Ue(e,n.units),g=Math.asin(Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(a)),p=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(l),Math.cos(s)-Math.sin(l)*Math.sin(g)),f=He(p),h=He(g);return $e([f,h],n.properties)}nn(Ut,"destination");var on=Ut,ln=Object.defineProperty,j=(t,e)=>ln(t,"name",{value:e,configurable:!0}),an=class{constructor(e){this.direction=!1,this.compareProperties=!0;var r,n,o;this.precision=10**-((r=e==null?void 0:e.precision)!=null?r:17),this.direction=(n=e==null?void 0:e.direction)!=null?n:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,r){if(e.type!==r.type||!Ae(e,r))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,r.coordinates);case"LineString":return this.compareLine(e.coordinates,r.coordinates);case"Polygon":return this.comparePolygon(e,r);case"GeometryCollection":return this.compareGeometryCollection(e,r);case"Feature":return this.compareFeature(e,r);case"FeatureCollection":return this.compareFeatureCollection(e,r);default:if(e.type.startsWith("Multi")){const n=Xe(e),o=Xe(r);return n.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,r){return e.length===r.length&&e.every((n,o)=>Math.abs(n-r[o])<this.precision)}compareLine(e,r,n=0,o=!1){if(!Ae(e,r))return!1;const i=e;let l=r;if(o&&!this.compareCoord(i[0],l[0])){const s=this.fixStartIndex(l,i);if(s)l=s;else return!1}const a=this.compareCoord(i[n],l[n]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[n],l[l.length-(1+n)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,r){let n,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],r[0])){o=i;break}return o>=0&&(n=[].concat(e.slice(o,e.length),e.slice(1,o+1))),n}comparePath(e,r){return e.every((n,o)=>this.compareCoord(n,r[o]))}comparePolygon(e,r){if(this.compareLine(e.coordinates[0],r.coordinates[0],1,!0)){const n=e.coordinates.slice(1,e.coordinates.length),o=r.coordinates.slice(1,r.coordinates.length);return n.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,r){return Ae(e.geometries,r.geometries)&&this.compareBBox(e,r)&&e.geometries.every((n,o)=>this.compare(n,r.geometries[o]))}compareFeature(e,r){return e.id===r.id&&(this.compareProperties?qt(e.properties,r.properties):!0)&&this.compareBBox(e,r)&&this.compare(e.geometry,r.geometry)}compareFeatureCollection(e,r){return Ae(e.features,r.features)&&this.compareBBox(e,r)&&e.features.every((n,o)=>this.compare(n,r.features[o]))}compareBBox(e,r){return!e.bbox&&!r.bbox||(e.bbox&&r.bbox?this.compareCoord(e.bbox,r.bbox):!1)}};j(an,"GeojsonEquality");function Ae(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}j(Ae,"sameLength");function Xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}j(Xe,"explode");var U=63710088e-1,Vt={centimeters:U*100,centimetres:U*100,degrees:360/(2*Math.PI),feet:U*3.28084,inches:U*39.37,kilometers:U/1e3,kilometres:U/1e3,meters:U,metres:U,miles:U/1609.344,millimeters:U*1e3,millimetres:U*1e3,nauticalmiles:U/1852,radians:1,yards:U*1.0936},Pt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function se(t,e,r={}){const n={type:"Feature"};return(r.id===0||r.id)&&(n.id=r.id),r.bbox&&(n.bbox=r.bbox),n.properties=e||{},n.geometry=t,n}j(se,"feature");function sn(t,e,r={}){switch(t){case"Point":return it(e).geometry;case"LineString":return at(e).geometry;case"Polygon":return lt(e).geometry;case"MultiPoint":return Kt(e).geometry;case"MultiLineString":return Jt(e).geometry;case"MultiPolygon":return Zt(e).geometry;default:throw new Error(t+" is invalid")}}j(sn,"geometry");function it(t,e,r={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!be(t[0])||!be(t[1]))throw new Error("coordinates must contain numbers");return se({type:"Point",coordinates:t},e,r)}j(it,"point");function un(t,e,r={}){return Ve(t.map(n=>it(n,e)),r)}j(un,"points");function lt(t,e,r={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return se({type:"Polygon",coordinates:t},e,r)}j(lt,"polygon");function fn(t,e,r={}){return Ve(t.map(n=>lt(n,e)),r)}j(fn,"polygons");function at(t,e,r={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return se({type:"LineString",coordinates:t},e,r)}j(at,"lineString");function cn(t,e,r={}){return Ve(t.map(n=>at(n,e)),r)}j(cn,"lineStrings");function Ve(t,e={}){const r={type:"FeatureCollection"};return e.id&&(r.id=e.id),e.bbox&&(r.bbox=e.bbox),r.features=t,r}j(Ve,"featureCollection");function Jt(t,e,r={}){return se({type:"MultiLineString",coordinates:t},e,r)}j(Jt,"multiLineString");function Kt(t,e,r={}){return se({type:"MultiPoint",coordinates:t},e,r)}j(Kt,"multiPoint");function Zt(t,e,r={}){return se({type:"MultiPolygon",coordinates:t},e,r)}j(Zt,"multiPolygon");function mn(t,e,r={}){return se({type:"GeometryCollection",geometries:t},e,r)}j(mn,"geometryCollection");function gn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const r=Math.pow(10,e||0);return Math.round(t*r)/r}j(gn,"round");function Qt(t,e="kilometers"){const r=Vt[e];if(!r)throw new Error(e+" units is invalid");return t*r}j(Qt,"radiansToLength");function st(t,e="kilometers"){const r=Vt[e];if(!r)throw new Error(e+" units is invalid");return t/r}j(st,"lengthToRadians");function hn(t,e){return ut(st(t,e))}j(hn,"lengthToDegrees");function pn(t){let e=t%360;return e<0&&(e+=360),e}j(pn,"bearingToAzimuth");function ut(t){return t%(2*Math.PI)*180/Math.PI}j(ut,"radiansToDegrees");function je(t){return t%360*Math.PI/180}j(je,"degreesToRadians");function dn(t,e="kilometers",r="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Qt(st(t,e),r)}j(dn,"convertLength");function _n(t,e="meters",r="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const n=Pt[e];if(!n)throw new Error("invalid original units");const o=Pt[r];if(!o)throw new Error("invalid final units");return t/n*o}j(_n,"convertArea");function be(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}j(be,"isNumber");function yn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}j(yn,"isObject");function bn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!be(e))throw new Error("bbox must only contain numbers")})}j(bn,"validateBBox");function vn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}j(vn,"validateId");var wn=Object.defineProperty,ue=(t,e)=>wn(t,"name",{value:e,configurable:!0});function Ye(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ue(Ye,"getCoord");function kn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ue(kn,"getCoords");function Xt(t){if(t.length>1&&be(t[0])&&be(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Xt(t[0]);throw new Error("coordinates must only contain numbers")}ue(Xt,"containsNumber");function En(t,e,r){if(!e||!r)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.type)}ue(En,"geojsonType");function Cn(t,e,r){if(!t)throw new Error("No feature passed");if(!r)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+t.geometry.type)}ue(Cn,"featureOf");function Ln(t,e,r){if(!t)throw new Error("No featureCollection passed");if(!r)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+r+", FeatureCollection required");for(const n of t.features){if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+r+", Feature with geometry required");if(!n.geometry||n.geometry.type!==e)throw new Error("Invalid input to "+r+": must be a "+e+", given "+n.geometry.type)}}ue(Ln,"collectionOf");function Pn(t){return t.type==="Feature"?t.geometry:t}ue(Pn,"getGeom");function Mn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ue(Mn,"getType");var On=Object.defineProperty,Yt=(t,e)=>On(t,"name",{value:e,configurable:!0});function ft(t,e,r={}){if(r.final===!0)return xt(t,e);const n=Ye(t),o=Ye(e),i=je(n[0]),l=je(o[0]),a=je(n[1]),s=je(o[1]),g=Math.sin(l-i)*Math.cos(s),p=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(l-i);return ut(Math.atan2(g,p))}Yt(ft,"bearing");function xt(t,e){let r=ft(e,t);return r=(r+180)%360,r}Yt(xt,"calculateFinalBearing");var ve=ft;function An(t){let e,r;return{c(){e=Ne("svg"),r=Ne("polygon"),this.h()},l(n){e=De(n,"svg",{width:!0,height:!0,xmlns:!0});var o=$(e);r=De(o,"polygon",{points:!0,fill:!0,class:!0}),$(r).forEach(b),o.forEach(b),this.h()},h(){G(r,"points","15,0 0,30 30,30"),G(r,"fill",t[0]),G(r,"class","svelte-1rmelo9"),G(e,"width","30"),G(e,"height","30"),G(e,"xmlns","http://www.w3.org/2000/svg"),Y(e,"background","cyan")},m(n,o){M(n,e,o),Q(e,r)},p(n,o){o&1&&G(r,"fill",n[0])},d(n){n&&b(e)}}}function jn(t){let e,r;return{c(){e=Ne("svg"),r=Ne("path"),this.h()},l(n){e=De(n,"svg",{xmlns:!0,width:!0,height:!0});var o=$(e);r=De(o,"path",{d:!0,fill:!0,class:!0}),$(r).forEach(b),o.forEach(b),this.h()},h(){G(r,"d","M 0 20 l 60 -0 l 0 -20 l 40 30 l -40 30 l 0 -20 l -60 0 l 0 -20"),G(r,"fill",t[0]),G(r,"class","svelte-1rmelo9"),G(e,"xmlns","http://www.w3.org/2000/svg"),G(e,"width","100"),G(e,"height","60"),Y(e,"background","cyan")},m(n,o){M(n,e,o),Q(e,r)},p(n,o){o&1&&G(r,"fill",n[0])},d(n){n&&b(e)}}}function Fn(t){let e;function r(i,l){return i[1]=="cycling-right-turn"?jn:An}let n=r(t),o=n(t);return{c(){o.c(),e=_e()},l(i){o.l(i),e=_e()},m(i,l){o.m(i,l),M(i,e,l)},p(i,[l]){n===(n=r(i))&&o?o.p(i,l):(o.d(1),o=n(i),o&&(o.c(),o.m(e.parentNode,e)))},i:Fe,o:Fe,d(i){i&&b(e),o.d(i)}}}function Tn(t,e,r){let{color:n}=e,{angle:o}=e,{kind:i}=e;return t.$$set=l=>{"color"in l&&r(0,n=l.color),"angle"in l&&r(2,o=l.angle),"kind"in l&&r(1,i=l.kind)},[n,i,o]}class In extends ke{constructor(e){super(),Ee(this,e,Tn,Fn,we,{color:0,angle:2,kind:1})}}function Sn(t){let e,r,n=ve(t[1].jat.movements[t[0]].point1,t[1].jat.movements[t[0]].point2)+"",o,i,l,a,s,g,p,f,h,m,w;function C(_){t[4](_)}let u={label:"Name"};t[1].jat.movements[t[0]].name!==void 0&&(u.value=t[1].jat.movements[t[0]].name),l=new wr({props:u}),ee.push(()=>ne(l,"value",C));function d(_){t[5](_)}let L={label:"Kind",choices:t[2]};t[1].jat.movements[t[0]].kind!==void 0&&(L.value=t[1].jat.movements[t[0]].kind),g=new vt({props:L}),ee.push(()=>ne(g,"value",d));function O(_){t[6](_)}let N={label:"Color",choices:t[3]};return t[1].jat.movements[t[0]].color!==void 0&&(N.value=t[1].jat.movements[t[0]].color),h=new vt({props:N}),ee.push(()=>ne(h,"value",O)),{c(){e=V("p"),r=oe("Bearing: "),o=oe(n),i=z(),T(l.$$.fragment),s=z(),T(g.$$.fragment),f=z(),T(h.$$.fragment)},l(_){e=J(_,"P",{});var F=$(e);r=ie(F,"Bearing: "),o=ie(F,n),F.forEach(b),i=H(_),I(l.$$.fragment,_),s=H(_),I(g.$$.fragment,_),f=H(_),I(h.$$.fragment,_)},m(_,F){M(_,e,F),Q(e,r),Q(e,o),M(_,i,F),S(l,_,F),M(_,s,F),S(g,_,F),M(_,f,F),S(h,_,F),w=!0},p(_,[F]){(!w||F&3)&&n!==(n=ve(_[1].jat.movements[_[0]].point1,_[1].jat.movements[_[0]].point2)+"")&&Re(o,n);const D={};!a&&F&3&&(a=!0,D.value=_[1].jat.movements[_[0]].name,re(()=>a=!1)),l.$set(D);const K={};!p&&F&3&&(p=!0,K.value=_[1].jat.movements[_[0]].kind,re(()=>p=!1)),g.$set(K);const q={};!m&&F&3&&(m=!0,q.value=_[1].jat.movements[_[0]].color,re(()=>m=!1)),h.$set(q)},i(_){w||(k(l.$$.fragment,_),k(g.$$.fragment,_),k(h.$$.fragment,_),w=!0)},o(_){E(l.$$.fragment,_),E(g.$$.fragment,_),E(h.$$.fragment,_),w=!1},d(_){_&&(b(e),b(i),b(s),b(f)),B(l,_),B(g,_),B(h,_)}}}function Bn(t,e,r){let n;pe(t,x,p=>r(1,n=p));let{idx:o}=e,i=bt(["cycling-straight","cycling-left-turn","cycling-right-turn","pedestrian"]),l=bt(["green","amber","red","critical"]);function a(p){t.$$.not_equal(n.jat.movements[o].name,p)&&(n.jat.movements[o].name=p,x.set(n))}function s(p){t.$$.not_equal(n.jat.movements[o].kind,p)&&(n.jat.movements[o].kind=p,x.set(n))}function g(p){t.$$.not_equal(n.jat.movements[o].color,p)&&(n.jat.movements[o].color=p,x.set(n))}return t.$$set=p=>{"idx"in p&&r(0,o=p.idx)},[o,n,i,l,a,s,g]}class qn extends ke{constructor(e){super(),Ee(this,e,Bn,Sn,we,{idx:0})}}const{window:Gn}=mr;function Mt(t,e,r){const n=t.slice();return n[27]=e[r],n[28]=e,n[29]=r,n}function Ot(t,e,r){const n=t.slice();return n[27]=e[r],n[29]=r,n}function Nn(t){let e,r,n,o,i,l;return e=new gr({props:{$$slots:{default:[zn]},$$scope:{ctx:t}}}),e.$on("click",t[17]),n=new hr({props:{$$slots:{default:[Hn]},$$scope:{ctx:t}}}),n.$on("click",t[9]),i=new qn({props:{idx:t[0]}}),{c(){T(e.$$.fragment),r=z(),T(n.$$.fragment),o=z(),T(i.$$.fragment)},l(a){I(e.$$.fragment,a),r=H(a),I(n.$$.fragment,a),o=H(a),I(i.$$.fragment,a)},m(a,s){S(e,a,s),M(a,r,s),S(n,a,s),M(a,o,s),S(i,a,s),l=!0},p(a,s){const g={};s[1]&1&&(g.$$scope={dirty:s,ctx:a}),e.$set(g);const p={};s[1]&1&&(p.$$scope={dirty:s,ctx:a}),n.$set(p);const f={};s[0]&1&&(f.idx=a[0]),i.$set(f)},i(a){l||(k(e.$$.fragment,a),k(n.$$.fragment,a),k(i.$$.fragment,a),l=!0)},o(a){E(e.$$.fragment,a),E(n.$$.fragment,a),E(i.$$.fragment,a),l=!1},d(a){a&&(b(r),b(o)),B(e,a),B(n,a),B(i,a)}}}function Dn(t){let e,r,n,o,i,l,a,s,g="Movements",p,f,h;e=new pr({props:{$$slots:{default:[Rn]},$$scope:{ctx:t}}}),e.$on("click",t[12]),n=new _r({}),i=new yr({});let m=t[3]&&At(t),w=ze(t[2].jat.movements),C=[];for(let u=0;u<w.length;u+=1)C[u]=jt(Ot(t,w,u));return{c(){T(e.$$.fragment),r=z(),T(n.$$.fragment),o=z(),T(i.$$.fragment),l=z(),m&&m.c(),a=z(),s=V("h3"),s.textContent=g,p=z(),f=V("ol");for(let u=0;u<C.length;u+=1)C[u].c()},l(u){I(e.$$.fragment,u),r=H(u),I(n.$$.fragment,u),o=H(u),I(i.$$.fragment,u),l=H(u),m&&m.l(u),a=H(u),s=J(u,"H3",{"data-svelte-h":!0}),ir(s)!=="svelte-1dc52s8"&&(s.textContent=g),p=H(u),f=J(u,"OL",{});var d=$(f);for(let L=0;L<C.length;L+=1)C[L].l(d);d.forEach(b)},m(u,d){S(e,u,d),M(u,r,d),S(n,u,d),M(u,o,d),S(i,u,d),M(u,l,d),m&&m.m(u,d),M(u,a,d),M(u,s,d),M(u,p,d),M(u,f,d);for(let L=0;L<C.length;L+=1)C[L]&&C[L].m(f,null);h=!0},p(u,d){const L={};if(d[1]&1&&(L.$$scope={dirty:d,ctx:u}),e.$set(L),u[3]?m?(m.p(u,d),d[0]&8&&k(m,1)):(m=At(u),m.c(),k(m,1),m.m(a.parentNode,a)):m&&(Ce(),E(m,1,1,()=>{m=null}),Le()),d[0]&70){w=ze(u[2].jat.movements);let O;for(O=0;O<w.length;O+=1){const N=Ot(u,w,O);C[O]?C[O].p(N,d):(C[O]=jt(N),C[O].c(),C[O].m(f,null))}for(;O<C.length;O+=1)C[O].d(1);C.length=w.length}},i(u){h||(k(e.$$.fragment,u),k(n.$$.fragment,u),k(i.$$.fragment,u),k(m),h=!0)},o(u){E(e.$$.fragment,u),E(n.$$.fragment,u),E(i.$$.fragment,u),E(m),h=!1},d(u){u&&(b(r),b(o),b(l),b(a),b(s),b(p),b(f)),B(e,u),B(n,u),B(i,u),m&&m.d(u),Bt(C,u)}}}function zn(t){let e;return{c(){e=oe("Save")},l(r){e=ie(r,"Save")},m(r,n){M(r,e,n)},d(r){r&&b(e)}}}function Hn(t){let e;return{c(){e=oe("Delete")},l(r){e=ie(r,"Delete")},m(r,n){M(r,e,n)},d(r){r&&b(e)}}}function Rn(t){let e;return{c(){e=oe("Zoom to fit")},l(r){e=ie(r,"Zoom to fit")},m(r,n){M(r,e,n)},d(r){r&&b(e)}}}function At(t){let e,r,n;function o(l){t[13](l)}let i={map:t[3]};return t[4]!==void 0&&(i.enabled=t[4]),e=new br({props:i}),ee.push(()=>ne(e,"enabled",o)),{c(){T(e.$$.fragment)},l(l){I(e.$$.fragment,l)},m(l,a){S(e,l,a),n=!0},p(l,a){const s={};a[0]&8&&(s.map=l[3]),!r&&a[0]&16&&(r=!0,s.enabled=l[4],re(()=>r=!1)),e.$set(s)},i(l){n||(k(e.$$.fragment,l),n=!0)},o(l){E(e.$$.fragment,l),n=!1},d(l){B(e,l)}}}function jt(t){let e,r,n=(t[27].name||"Unnamed movement")+"",o,i,l,a;function s(){return t[14](t[29])}function g(){return t[15](t[29])}return{c(){e=V("li"),r=V("a"),o=oe(n),i=z(),this.h()},l(p){e=J(p,"LI",{});var f=$(e);r=J(f,"A",{href:!0});var h=$(r);o=ie(h,n),h.forEach(b),i=H(f),f.forEach(b),this.h()},h(){G(r,"href","#")},m(p,f){M(p,e,f),Q(e,r),Q(r,o),Q(e,i),l||(a=[qe(r,"click",s),qe(r,"mouseenter",g),qe(r,"mouseleave",t[16])],l=!0)},p(p,f){t=p,f[0]&4&&n!==(n=(t[27].name||"Unnamed movement")+"")&&Re(o,n)},d(p){p&&b(e),l=!1,lr(a)}}}function $n(t){let e,r;return{c(){e=V("span"),this.h()},l(n){e=J(n,"SPAN",{class:!0,style:!0}),$(e).forEach(b),this.h()},h(){G(e,"class","dot svelte-1kvjd2"),G(e,"style",r=`background-color: ${me[t[27].color].background}`)},m(n,o){M(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${me[n[27].color].background}`)&&G(e,"style",r)},d(n){n&&b(e)}}}function Wn(t){let e,r;return e=new In({props:{color:me[t[27].color].background,angle:ve(t[27].point1,t[27].point2),kind:t[27].kind}}),{c(){T(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const i={};o[0]&4&&(i.color=me[n[27].color].background),o[0]&4&&(i.angle=ve(n[27].point1,n[27].point2)),o[0]&4&&(i.kind=n[27].kind),e.$set(i)},i(n){r||(k(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Un(t){let e,r;return{c(){e=V("span"),this.h()},l(n){e=J(n,"SPAN",{class:!0,style:!0}),$(e).forEach(b),this.h()},h(){G(e,"class","dot svelte-1kvjd2"),G(e,"style",r=`background-color: ${me[t[27].color].background}`)},m(n,o){M(n,e,o)},p(n,o){o[0]&4&&r!==(r=`background-color: ${me[n[27].color].background}`)&&G(e,"style",r)},i:Fe,o:Fe,d(n){n&&b(e)}}}function Vn(t){let e,r,n,o;const i=[Un,Wn],l=[];function a(s,g){return s[27].kind=="pedestrian"?0:1}return e=a(t),r=l[e]=i[e](t),{c(){r.c(),n=_e()},l(s){r.l(s),n=_e()},m(s,g){l[e].m(s,g),M(s,n,g),o=!0},p(s,g){let p=e;e=a(s),e===p?l[e].p(s,g):(Ce(),E(l[p],1,1,()=>{l[p]=null}),Le(),r=l[e],r?r.p(s,g):(r=l[e]=i[e](s),r.c()),k(r,1),r.m(n.parentNode,n))},i(s){o||(k(r),o=!0)},o(s){E(r),o=!1},d(s){s&&b(n),l[e].d(s)}}}function Ft(t){let e,r,n,o,i,l;function a(m){t[18](m,t[27])}function s(){return t[19](t[29])}let g={draggable:!0,$$slots:{default:[$n]},$$scope:{ctx:t}};t[27].point1!==void 0&&(g.lngLat=t[27].point1),e=new yt({props:g}),ee.push(()=>ne(e,"lngLat",a)),e.$on("dragend",s);function p(m){t[20](m,t[27])}function f(){return t[21](t[29])}let h={draggable:!0,rotation:ve(t[27].point1,t[27].point2),anchor:"left",$$slots:{default:[Vn]},$$scope:{ctx:t}};return t[27].point2!==void 0&&(h.lngLat=t[27].point2),o=new yt({props:h}),ee.push(()=>ne(o,"lngLat",p)),o.$on("dragend",f),{c(){T(e.$$.fragment),n=z(),T(o.$$.fragment)},l(m){I(e.$$.fragment,m),n=H(m),I(o.$$.fragment,m)},m(m,w){S(e,m,w),M(m,n,w),S(o,m,w),l=!0},p(m,w){t=m;const C={};w[0]&4|w[1]&1&&(C.$$scope={dirty:w,ctx:t}),!r&&w[0]&4&&(r=!0,C.lngLat=t[27].point1,re(()=>r=!1)),e.$set(C);const u={};w[0]&4&&(u.rotation=ve(t[27].point1,t[27].point2)),w[0]&4|w[1]&1&&(u.$$scope={dirty:w,ctx:t}),!i&&w[0]&4&&(i=!0,u.lngLat=t[27].point2,re(()=>i=!1)),o.$set(u)},i(m){l||(k(e.$$.fragment,m),k(o.$$.fragment,m),l=!0)},o(m){E(e.$$.fragment,m),E(o.$$.fragment,m),l=!1},d(m){m&&b(n),B(e,m),B(o,m)}}}function Jn(t){let e=(t[26].name||"Untitled movement")+"",r;return{c(){r=oe(e)},l(n){r=ie(n,e)},m(n,o){M(n,r,o)},p(n,o){o[0]&67108864&&e!==(e=(n[26].name||"Untitled movement")+"")&&Re(r,e)},d(n){n&&b(r)}}}function Kn(t){let e,r;return e=new Gt({props:{$$slots:{default:[Jn,({props:n})=>({26:n}),({props:n})=>[n?67108864:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const i={};o[0]&67108864|o[1]&1&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(k(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Zn(t){let e=(t[26].name||"Untitled movement")+"",r;return{c(){r=oe(e)},l(n){r=ie(n,e)},m(n,o){M(n,r,o)},p(n,o){o[0]&67108864&&e!==(e=(n[26].name||"Untitled movement")+"")&&Re(r,e)},d(n){n&&b(r)}}}function Qn(t){let e,r;return e=new Gt({props:{$$slots:{default:[Zn,({props:n})=>({26:n}),({props:n})=>[n?67108864:0]]},$$scope:{ctx:t}}}),{c(){T(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p(n,o){const i={};o[0]&67108864|o[1]&1&&(i.$$scope={dirty:o,ctx:n}),e.$set(i)},i(n){r||(k(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function Xn(t){let e,r,n,o;return e=new Ze({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":_t(6,10),"line-color":["get","color"]},filter:["!=",["get","kind"],"pedestrian"],$$slots:{default:[Kn]},$$scope:{ctx:t}}}),e.$on("click",t[7]),n=new Ze({props:{id:"jat-pedestrian",manageHoverState:!0,paint:{"line-width":_t(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"pedestrian"],$$slots:{default:[Qn]},$$scope:{ctx:t}}}),n.$on("click",t[7]),{c(){T(e.$$.fragment),r=z(),T(n.$$.fragment)},l(i){I(e.$$.fragment,i),r=H(i),I(n.$$.fragment,i)},m(i,l){S(e,i,l),M(i,r,l),S(n,i,l),o=!0},p(i,l){const a={};l[1]&1&&(a.$$scope={dirty:l,ctx:i}),e.$set(a);const s={};l[1]&1&&(s.$$scope={dirty:l,ctx:i}),n.$set(s)},i(i){o||(k(e.$$.fragment,i),k(n.$$.fragment,i),o=!0)},o(i){E(e.$$.fragment,i),E(n.$$.fragment,i),o=!1},d(i){i&&b(r),B(e,i),B(n,i)}}}function Yn(t){let e,r;return e=new Ze({props:{paint:{"line-width":15,"line-color":"yellow"}}}),{c(){T(e.$$.fragment)},l(n){I(e.$$.fragment,n)},m(n,o){S(e,n,o),r=!0},p:Fe,i(n){r||(k(e.$$.fragment,n),r=!0)},o(n){E(e.$$.fragment,n),r=!1},d(n){B(e,n)}}}function xn(t){let e,r,n,o,i,l,a,s=ze(t[2].jat.movements),g=[];for(let f=0;f<s.length;f+=1)g[f]=Ft(Mt(t,s,f));const p=f=>E(g[f],1,1,()=>{g[f]=null});return r=new dt({props:{data:t[8](t[2].jat.movements),$$slots:{default:[Xn]},$$scope:{ctx:t}}}),o=new dt({props:{data:t[5],$$slots:{default:[Yn]},$$scope:{ctx:t}}}),l=new vr({props:{map:t[3]}}),{c(){for(let f=0;f<g.length;f+=1)g[f].c();e=z(),T(r.$$.fragment),n=z(),T(o.$$.fragment),i=z(),T(l.$$.fragment)},l(f){for(let h=0;h<g.length;h+=1)g[h].l(f);e=H(f),I(r.$$.fragment,f),n=H(f),I(o.$$.fragment,f),i=H(f),I(l.$$.fragment,f)},m(f,h){for(let m=0;m<g.length;m+=1)g[m]&&g[m].m(f,h);M(f,e,h),S(r,f,h),M(f,n,h),S(o,f,h),M(f,i,h),S(l,f,h),a=!0},p(f,h){if(h[0]&68){s=ze(f[2].jat.movements);let u;for(u=0;u<s.length;u+=1){const d=Mt(f,s,u);g[u]?(g[u].p(d,h),k(g[u],1)):(g[u]=Ft(d),g[u].c(),k(g[u],1),g[u].m(e.parentNode,e))}for(Ce(),u=s.length;u<g.length;u+=1)p(u);Le()}const m={};h[0]&4&&(m.data=f[8](f[2].jat.movements)),h[1]&1&&(m.$$scope={dirty:h,ctx:f}),r.$set(m);const w={};h[0]&32&&(w.data=f[5]),h[1]&1&&(w.$$scope={dirty:h,ctx:f}),o.$set(w);const C={};h[0]&8&&(C.map=f[3]),l.$set(C)},i(f){if(!a){for(let h=0;h<s.length;h+=1)k(g[h]);k(r.$$.fragment,f),k(o.$$.fragment,f),k(l.$$.fragment,f),a=!0}},o(f){g=g.filter(Boolean);for(let h=0;h<g.length;h+=1)E(g[h]);E(r.$$.fragment,f),E(o.$$.fragment,f),E(l.$$.fragment,f),a=!1},d(f){f&&(b(e),b(n),b(i)),Bt(g,f),B(r,f),B(o,f),B(l,f)}}}function eo(t){let e,r,n,o,i,l,a,s,g,p,f;const h=[Dn,Nn],m=[];function w(d,L){return d[0]==null?0:1}n=w(t),o=m[n]=h[n](t);function C(d){t[22](d)}let u={$$slots:{default:[xn]},$$scope:{ctx:t}};return t[3]!==void 0&&(u.map=t[3]),a=new cr({props:u}),ee.push(()=>ne(a,"map",C)),{c(){e=V("div"),r=V("div"),o.c(),i=z(),l=V("div"),T(a.$$.fragment),this.h()},l(d){e=J(d,"DIV",{style:!0});var L=$(e);r=J(L,"DIV",{style:!0});var O=$(r);o.l(O),O.forEach(b),i=H(L),l=J(L,"DIV",{style:!0});var N=$(l);I(a.$$.fragment,N),N.forEach(b),L.forEach(b),this.h()},h(){Y(r,"width","30%"),Y(r,"overflow-y","scroll"),Y(r,"padding","10px"),Y(l,"position","relative"),Y(l,"width","100%"),Y(e,"display","flex"),Y(e,"height","80vh")},m(d,L){M(d,e,L),Q(e,r),m[n].m(r,null),Q(e,i),Q(e,l),S(a,l,null),g=!0,p||(f=qe(Gn,"keydown",t[11]),p=!0)},p(d,L){let O=n;n=w(d),n===O?m[n].p(d,L):(Ce(),E(m[O],1,1,()=>{m[O]=null}),Le(),o=m[n],o?o.p(d,L):(o=m[n]=h[n](d),o.c()),k(o,1),o.m(r,null));const N={};L[0]&44|L[1]&1&&(N.$$scope={dirty:L,ctx:d}),!s&&L[0]&8&&(s=!0,N.map=d[3],re(()=>s=!1)),a.$set(N)},i(d){g||(k(o),k(a.$$.fragment,d),g=!0)},o(d){E(o),E(a.$$.fragment,d),g=!1},d(d){d&&b(e),m[n].d(),B(a),p=!1,f()}}}function to(t,e,r){let n,o;pe(t,x,v=>r(2,o=v));let i,l=null,a=null,s=!1;function g(v,R,Pe){let Ie={type:"FeatureCollection",features:[]},P=R??Pe;return P!=null&&Ie.features.push(w(v.jat.movements[P],P)),Ie}function p(v){r(0,l=v),r(1,a=null)}function f(v){if(!s){for(let R of i.queryRenderedFeatures(v.point,{layers:["jat-cycling","jat-pedestrian"]}))return;if(l!=null){r(0,l=null);return}St(x,o.jat.movements=[...o.jat.movements,{point1:v.lngLat.toArray(),point2:on(v.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling-straight",color:"green",name:"",notes:""}],o),r(0,l=o.jat.movements.length-1),r(1,a=null)}}function h(v){p(v.detail.features[0].id)}Tt(()=>{i.on("click",f),u(!1)}),It(()=>{i.off("click",f)});function m(v){return{type:"FeatureCollection",features:v.map((R,Pe)=>w(R,Pe))}}function w(v,R){return{type:"Feature",id:R,properties:{name:v.name,kind:v.kind,color:me[v.color].background},geometry:{type:"LineString",coordinates:[v.point1,v.point2]}}}function C(){window.confirm("Delete this movement?")&&(o.jat.movements.splice(l,1),x.set(o),r(0,l=null))}function u(v){o.jat.movements.length>0&&i.fitBounds(dr(m(o.jat.movements)),{padding:20,animate:v})}function d(v){l!=null&&v.key=="Escape"?(v.stopPropagation(),r(0,l=null)):l!=null&&v.key=="Delete"&&C()}const L=()=>u(!0);function O(v){s=v,r(4,s)}const N=v=>p(v),_=v=>r(1,a=v),F=()=>r(1,a=null),D=()=>r(0,l=null);function K(v,R){t.$$.not_equal(R.point1,v)&&(R.point1=v,x.set(o))}const q=v=>p(v);function fe(v,R){t.$$.not_equal(R.point2,v)&&(R.point2=v,x.set(o))}const y=v=>p(v);function Te(v){i=v,r(3,i)}return t.$$.update=()=>{t.$$.dirty[0]&7&&r(5,n=g(o,l,a))},[l,a,o,i,s,n,p,h,m,C,u,d,L,O,N,_,F,D,K,q,fe,y,Te]}class _o extends ke{constructor(e){super(),Ee(this,e,to,eo,we,{},null,[-1,-1])}}export{_o as component};
