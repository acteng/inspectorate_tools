import{s as g,e as $,c as d,p as y,q as C,i as S,n as R,f as v}from"../chunks/scheduler.DGwhun8C.js";import{S as w,i as x,c as k,a as _,m as P,t as b,b as E,d as L}from"../chunks/index.B2vZYn3d.js";import{f as T}from"../chunks/index.tnRUkvEV.js";import"../chunks/SelectWithCustom.svelte_svelte_type_style_lang.BuK5E7R6.js";import"../chunks/paths.Cb_PFDfe.js";import"../chunks/entry.B4eAUgou.js";import{F as A}from"../chunks/FileManager.Cf4IEl6S.js";import{E as N}from"../chunks/exceljs.min.DibHro62.js";import{e as D,f as F,c as I,s as q}from"../chunks/data.CJlwFXK9.js";function O(o){let r=o.getWorksheet("DALog"),t=r.getRow(1).values.map(i=>typeof i=="string"?i:i.result),n=r.getRow(2).values.map(i=>typeof i=="string"?i:i.result??null);t.shift(),t.shift(),n.shift(),n.shift();let a=t.map((i,c)=>[i,n[c]]);return Object.fromEntries(a)}function u(o){return(o+1).toString().padStart(2,"0")}function W(o){let r=D(),t=s=>{let e=o[s];if(typeof e=="string")return e;if(e==null)return"";throw new Error(`${s} isn't a string, it's ${e}`)},n=s=>{let e=o[s];return typeof e=="number"?e:(e==null||console.warn(`${s} isn't a number, it's ${e}. Defaulting to 0`),0)},a=s=>{let e=o[s];return typeof e=="object"&&e instanceof Date?T(e):""},i=s=>{let e=o[s];if(e==""||e=="Yes"||e=="No")return e;if(e==null)return"";throw new Error(`${s} isn't yesNoBlank, it's ${e}`)},c=s=>{let e=o[s];if(e==""||e=="C"||e=="N/A")return e;if(e==0||e==1||e==2)return e.toString();if(e==null)return"0";throw new Error(`${s} isn't score, it's ${e}`)},f=s=>{let e=t(s).split(", ").map(parseFloat);return[e[1],e[0]]},h=t("Sub-tool")=="Street Check"?"street":"path";r.summary={dateDesignReview:a("Date of Design Review"),schemeReference:t("Scheme Ref"),schemeName:t("Scheme Name"),schemeSummary:"",schemeInfoReviewed:"",authority:t("Authority"),transportOrCombinedAuthority:t("Transport/ Combined Authority"),region:t("Region"),fundingProgramme:t("Funding Programme"),designStage:t("Design Stage"),fundingConditions:t("Funding Conditions"),inspectorEmail:t("Inspector"),assessedRouteLengthKm:n("RouteLength"),totalRouteLengthKm:n("RouteFileLength"),notes:t("Notes"),checkType:h,networkMap:{type:"FeatureCollection",features:[]}},r.horseRiders=o["PA-LOS-HR-E"]=="N/A"?"No":"Yes";for(let[s,e]of r.policyCheck.entries())e.existing=i(`PC${u(s)}-E`),e.proposed=i(`PC${u(s)}-D`);for(let[s,e,p]of[[r.safetyCheck,"SA",0],[r.streetCheck,"ST",16],[r.streetPlacemakingCheck,"SP",0],[r.pathCheck,"PA",16],[r.pathPlacemakingCheck,"PP",0]])for(let l=0;l<s.existingScores.length;l++)s.existingScores[l]=c(`${e}${u(l+p)}-E`),s.proposedScores[l]=c(`${e}${u(l+p)}-D`);for(let s=0;s<35;s++){let e=`${u(s)}PC`;o[`${e}Ref`]!=null&&r.policyConflictLog.push({conflict:t(`${e}Typ`).substr(0,1),stage:t(`${e}Sta`),point:f(`${e}LaL`),locationName:t(`${e}Loc`),resolved:i(`${e}Res`),notes:t(`${e}Com`)})}for(let s=0;s<35;s++){let e=`${u(s)}SA`;o[`${e}Ref`]!=null&&r.criticalIssues.push({criticalIssue:t(`${e}Typ`).split(" - ")[0],stage:t(`${e}Sta`),point:f(`${e}LaL`),locationName:t(`${e}Loc`),resolved:i(`${e}Res`),notes:t(`${e}Com`)})}return r}function j(o){let r=O(o),t=W(r),n=o.getWorksheet("1. Summary of Scheme");t.summary.schemeSummary=m(n.getCell("C9")),t.summary.schemeInfoReviewed=m(n.getCell("C10")),n=o.getWorksheet("2.1 Policy Check");for(let a=0;a<6;a++)t.policyCheck[a].commentary=m(n.getCell("F"+(8+a)));return t}function m(o){if(typeof o.value=="string")return o.value;if(o.value==null)return"";throw new Error(`Input cell isn't a string, it's ${o.value}`)}function B(o){let r,t=`The Route Check Tool is used by ATE for assessing the design quality of
    linear schemes. However, it may also be used by local authorities and others
    wishing to assess the design quality of schemes against ATE's quality
    criteria.`;return{c(){r=$("p"),r.textContent=t,this.h()},l(n){r=d(n,"P",{slot:!0,"data-svelte-h":!0}),y(r)!=="svelte-5d82im"&&(r.textContent=t),this.h()},h(){C(r,"slot","description")},m(n,a){S(n,r,a)},p:R,d(n){n&&v(r)}}}function H(o){let r,t;return r=new A({props:{files:F,currentFile:I,state:q,xlsxImporter:o[0],service:"Route Check Tool",fileObjectType:"scheme",$$slots:{description:[B]},$$scope:{ctx:o}}}),{c(){k(r.$$.fragment)},l(n){_(r.$$.fragment,n)},m(n,a){P(r,n,a),t=!0},p(n,[a]){const i={};a&2&&(i.$$scope={dirty:a,ctx:n}),r.$set(i)},i(n){t||(b(r.$$.fragment,n),t=!0)},o(n){E(r.$$.fragment,n),t=!1},d(n){L(r,n)}}}function K(o){async function r(t){let n=new N.Workbook;return await n.xlsx.load(t),j(n)}return[r]}class X extends w{constructor(r){super(),x(this,r,K,H,g,{})}}export{X as component};
