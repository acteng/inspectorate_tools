import{s as je,v as ne,w as re,l as gn,u as _n,m as dn,o as $n,G as Le,k as De,U as qt,T as Ge,a as O,g as B,i as E,f as b,q as Pe,n as Ee,e as x,t as J,c as ee,b as ie,d as H,r as ze,x as Q,h as te,j as _e,z as hn,D as de,p as ft,R as bn}from"../chunks/scheduler.BBS-fkhU.js";import{S as Se,i as Ie,e as oe,c as A,a as S,m as I,t as y,b as j,d as F,g as se,f as ue}from"../chunks/index.B8H3ypVf.js";import{B as wn}from"../chunks/ButtonGroup.fhy-VJbf.js";import{W as Nt,S as $e}from"../chunks/WarningButton.CaqyhU7y.js";import{T as tt}from"../chunks/TextInput.C_aBwF72.js";import{s as Z}from"../chunks/data.Ge-qxksO.js";import{L as vn,f as yn,e as Ot,M as Bt,b as Gt,C as Dt,G as mt,l as Qe,n as ct,c as kn,P as zt,g as jn}from"../chunks/index.CsqqrQ5w.js";import{e as ge}from"../chunks/each.D79A5KlB.js";import{c as Ue}from"../chunks/colors.CYEpEtTL.js";import{M as Ut,a as En,b as Be,R as Rt,B as Jt,G as Ht,C as Kt,S as Vt}from"../chunks/GeoreferenceLayer.CBj3khmc.js";import{D as Cn,C as Xt}from"../chunks/DefaultButton.Pbp5mObw.js";import{T as Wt}from"../chunks/TextArea.Ck6ITb4v.js";import{p as Zt}from"../chunks/index.iKlZYnHD.js";import{S as Ln}from"../chunks/Select.DqyoFzIJ.js";function Pn(t){let e;const n=t[16].default,r=gn(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,i){r&&r.m(o,i),e=!0},p(o,i){r&&r.p&&(!e||i&16777216)&&_n(r,n,o,o[24],e?$n(n,o[24],i,null):dn(o[24]),null)},i(o){e||(y(r,o),e=!0)},o(o){j(r,o),e=!1},d(o){r&&r.d(o)}}}function Mn(t){let e,n,r;function o(l){t[17](l)}let i={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Pn]},$$scope:{ctx:t}};return t[0]!==void 0&&(i.hovered=t[0]),e=new vn({props:i}),ne.push(()=>oe(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){A(e.$$.fragment)},l(l){S(e.$$.fragment,l)},m(l,a){I(e,l,a),r=!0},p(l,[a]){const s={};a&2&&(s.id=l[1]),a&4&&(s.source=l[2]),a&8&&(s.sourceLayer=l[3]),a&16&&(s.beforeId=l[4]),a&32&&(s.beforeLayerType=l[5]),a&64&&(s.paint=l[6]),a&128&&(s.layout=l[7]),a&256&&(s.filter=l[8]),a&512&&(s.applyToClusters=l[9]),a&1024&&(s.minzoom=l[10]),a&2048&&(s.maxzoom=l[11]),a&4096&&(s.hoverCursor=l[12]),a&8192&&(s.manageHoverState=l[13]),a&16384&&(s.eventsIfTopMost=l[14]),a&32768&&(s.interactive=l[15]),a&16777216&&(s.$$scope={dirty:a,ctx:l}),!n&&a&1&&(n=!0,s.hovered=l[0],re(()=>n=!1)),e.$set(s)},i(l){r||(y(e.$$.fragment,l),r=!0)},o(l){j(e.$$.fragment,l),r=!1},d(l){F(e,l)}}}function An(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:i=yn("symbol")}=e,{source:l=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:p=void 0}=e,{paint:m=void 0}=e,{layout:c=void 0}=e,{filter:u=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:_=void 0}=e,{maxzoom:L=void 0}=e,{hoverCursor:d=void 0}=e,{manageHoverState:$=!1}=e,{hovered:P=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:g=!0}=e;function w(N){P=N,n(0,P)}function v(N){Le.call(this,t,N)}function T(N){Le.call(this,t,N)}function K(N){Le.call(this,t,N)}function q(N){Le.call(this,t,N)}function U(N){Le.call(this,t,N)}function pe(N){Le.call(this,t,N)}return t.$$set=N=>{"id"in N&&n(1,i=N.id),"source"in N&&n(2,l=N.source),"sourceLayer"in N&&n(3,a=N.sourceLayer),"beforeId"in N&&n(4,s=N.beforeId),"beforeLayerType"in N&&n(5,p=N.beforeLayerType),"paint"in N&&n(6,m=N.paint),"layout"in N&&n(7,c=N.layout),"filter"in N&&n(8,u=N.filter),"applyToClusters"in N&&n(9,C=N.applyToClusters),"minzoom"in N&&n(10,_=N.minzoom),"maxzoom"in N&&n(11,L=N.maxzoom),"hoverCursor"in N&&n(12,d=N.hoverCursor),"manageHoverState"in N&&n(13,$=N.manageHoverState),"hovered"in N&&n(0,P=N.hovered),"eventsIfTopMost"in N&&n(14,f=N.eventsIfTopMost),"interactive"in N&&n(15,g=N.interactive),"$$scope"in N&&n(24,o=N.$$scope)},[P,i,l,a,s,p,m,c,u,C,_,L,d,$,f,g,r,w,v,T,K,q,U,pe,o]}class Sn extends Se{constructor(e){super(),Ie(this,e,An,Mn,je,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var In=Object.defineProperty,V=(t,e)=>In(t,"name",{value:e,configurable:!0}),Fn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!qe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ye(e),o=Ye(n);return r.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!qe(e,n))return!1;const i=e;let l=n;if(o&&!this.compareCoord(i[0],l[0])){const s=this.fixStartIndex(l,i);if(s)l=s;else return!1}const a=this.compareCoord(i[r],l[r]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[r],l[l.length-(1+r)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,n){let r,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],n[0])){o=i;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,n){return qe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ot(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return qe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};V(Fn,"GeojsonEquality");function qe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}V(qe,"sameLength");function Ye(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}V(Ye,"explode");var me=63710088e-1,Qt={centimeters:me*100,centimetres:me*100,degrees:360/(2*Math.PI),feet:me*3.28084,inches:me*39.37,kilometers:me/1e3,kilometres:me/1e3,meters:me,metres:me,miles:me/1609.344,millimeters:me*1e3,millimetres:me*1e3,nauticalmiles:me/1852,radians:1,yards:me*1.0936},pt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function we(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}V(we,"feature");function Tn(t,e,n={}){switch(t){case"Point":return He(e).geometry;case"LineString":return rt(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return xt(e).geometry;case"MultiLineString":return Yt(e).geometry;case"MultiPolygon":return en(e).geometry;default:throw new Error(t+" is invalid")}}V(Tn,"geometry");function He(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Me(t[0])||!Me(t[1]))throw new Error("coordinates must contain numbers");return we({type:"Point",coordinates:t},e,n)}V(He,"point");function qn(t,e,n={}){return Ke(t.map(r=>He(r,e)),n)}V(qn,"points");function nt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return we({type:"Polygon",coordinates:t},e,n)}V(nt,"polygon");function Nn(t,e,n={}){return Ke(t.map(r=>nt(r,e)),n)}V(Nn,"polygons");function rt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return we({type:"LineString",coordinates:t},e,n)}V(rt,"lineString");function On(t,e,n={}){return Ke(t.map(r=>rt(r,e)),n)}V(On,"lineStrings");function Ke(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}V(Ke,"featureCollection");function Yt(t,e,n={}){return we({type:"MultiLineString",coordinates:t},e,n)}V(Yt,"multiLineString");function xt(t,e,n={}){return we({type:"MultiPoint",coordinates:t},e,n)}V(xt,"multiPoint");function en(t,e,n={}){return we({type:"MultiPolygon",coordinates:t},e,n)}V(en,"multiPolygon");function Bn(t,e,n={}){return we({type:"GeometryCollection",geometries:t},e,n)}V(Bn,"geometryCollection");function Gn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}V(Gn,"round");function tn(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t*n}V(tn,"radiansToLength");function Ve(t,e="kilometers"){const n=Qt[e];if(!n)throw new Error(e+" units is invalid");return t/n}V(Ve,"lengthToRadians");function Dn(t,e){return Je(Ve(t,e))}V(Dn,"lengthToDegrees");function zn(t){let e=t%360;return e<0&&(e+=360),e}V(zn,"bearingToAzimuth");function Je(t){return t%(2*Math.PI)*180/Math.PI}V(Je,"radiansToDegrees");function Re(t){return t%360*Math.PI/180}V(Re,"degreesToRadians");function Un(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return tn(Ve(t,e),n)}V(Un,"convertLength");function Rn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=pt[e];if(!r)throw new Error("invalid original units");const o=pt[n];if(!o)throw new Error("invalid final units");return t/r*o}V(Rn,"convertArea");function Me(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}V(Me,"isNumber");function Jn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}V(Jn,"isObject");function Hn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Me(e))throw new Error("bbox must only contain numbers")})}V(Hn,"validateBBox");function Kn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}V(Kn,"validateId");var Vn=Object.defineProperty,ve=(t,e)=>Vn(t,"name",{value:e,configurable:!0});function nn(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ve(nn,"getCoord");function Xn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ve(Xn,"getCoords");function rn(t){if(t.length>1&&Me(t[0])&&Me(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return rn(t[0]);throw new Error("coordinates must only contain numbers")}ve(rn,"containsNumber");function Wn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ve(Wn,"geojsonType");function Zn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ve(Zn,"featureOf");function Qn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ve(Qn,"collectionOf");function Yn(t){return t.type==="Feature"?t.geometry:t}ve(Yn,"getGeom");function xn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ve(xn,"getType");var er=Object.defineProperty,tr=(t,e)=>er(t,"name",{value:e,configurable:!0});function on(t,e,n,r={}){const o=nn(t),i=Re(o[0]),l=Re(o[1]),a=Re(n),s=Ve(e,r.units),p=Math.asin(Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(a)),m=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(l),Math.cos(s)-Math.sin(l)*Math.sin(p)),c=Je(m),u=Je(p);return He([c,u],r.properties)}tr(on,"destination");var gt=on,nr=Object.defineProperty,X=(t,e)=>nr(t,"name",{value:e,configurable:!0}),rr=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ne(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=xe(e),o=xe(n);return r.every(i=>o.some(l=>this.compare(i,l)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ne(e,n))return!1;const i=e;let l=n;if(o&&!this.compareCoord(i[0],l[0])){const s=this.fixStartIndex(l,i);if(s)l=s;else return!1}const a=this.compareCoord(i[r],l[r]);return this.direction||a?this.comparePath(i,l):this.compareCoord(i[r],l[l.length-(1+r)])?this.comparePath(i.slice().reverse(),l):!1}fixStartIndex(e,n){let r,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],n[0])){o=i;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(i=>o.some(l=>this.compareLine(i,l,1,!0)))}return!1}compareGeometryCollection(e,n){return Ne(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ot(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ne(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};X(rr,"GeojsonEquality");function Ne(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}X(Ne,"sameLength");function xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}X(xe,"explode");var ce=63710088e-1,ln={centimeters:ce*100,centimetres:ce*100,degrees:360/(2*Math.PI),feet:ce*3.28084,inches:ce*39.37,kilometers:ce/1e3,kilometres:ce/1e3,meters:ce,metres:ce,miles:ce/1609.344,millimeters:ce*1e3,millimetres:ce*1e3,nauticalmiles:ce/1852,radians:1,yards:ce*1.0936},_t={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ye(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}X(ye,"feature");function or(t,e,n={}){switch(t){case"Point":return ot(e).geometry;case"LineString":return lt(e).geometry;case"Polygon":return it(e).geometry;case"MultiPoint":return sn(e).geometry;case"MultiLineString":return an(e).geometry;case"MultiPolygon":return un(e).geometry;default:throw new Error(t+" is invalid")}}X(or,"geometry");function ot(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ae(t[0])||!Ae(t[1]))throw new Error("coordinates must contain numbers");return ye({type:"Point",coordinates:t},e,n)}X(ot,"point");function ir(t,e,n={}){return Xe(t.map(r=>ot(r,e)),n)}X(ir,"points");function it(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return ye({type:"Polygon",coordinates:t},e,n)}X(it,"polygon");function lr(t,e,n={}){return Xe(t.map(r=>it(r,e)),n)}X(lr,"polygons");function lt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ye({type:"LineString",coordinates:t},e,n)}X(lt,"lineString");function ar(t,e,n={}){return Xe(t.map(r=>lt(r,e)),n)}X(ar,"lineStrings");function Xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}X(Xe,"featureCollection");function an(t,e,n={}){return ye({type:"MultiLineString",coordinates:t},e,n)}X(an,"multiLineString");function sn(t,e,n={}){return ye({type:"MultiPoint",coordinates:t},e,n)}X(sn,"multiPoint");function un(t,e,n={}){return ye({type:"MultiPolygon",coordinates:t},e,n)}X(un,"multiPolygon");function sr(t,e,n={}){return ye({type:"GeometryCollection",geometries:t},e,n)}X(sr,"geometryCollection");function ur(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}X(ur,"round");function fn(t,e="kilometers"){const n=ln[e];if(!n)throw new Error(e+" units is invalid");return t*n}X(fn,"radiansToLength");function at(t,e="kilometers"){const n=ln[e];if(!n)throw new Error(e+" units is invalid");return t/n}X(at,"lengthToRadians");function fr(t,e){return st(at(t,e))}X(fr,"lengthToDegrees");function mr(t){let e=t%360;return e<0&&(e+=360),e}X(mr,"bearingToAzimuth");function st(t){return t%(2*Math.PI)*180/Math.PI}X(st,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}X(Oe,"degreesToRadians");function cr(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return fn(at(t,e),n)}X(cr,"convertLength");function pr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=_t[e];if(!r)throw new Error("invalid original units");const o=_t[n];if(!o)throw new Error("invalid final units");return t/r*o}X(pr,"convertArea");function Ae(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}X(Ae,"isNumber");function gr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}X(gr,"isObject");function _r(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ae(e))throw new Error("bbox must only contain numbers")})}X(_r,"validateBBox");function dr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}X(dr,"validateId");var $r=Object.defineProperty,ke=(t,e)=>$r(t,"name",{value:e,configurable:!0});function et(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ke(et,"getCoord");function hr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ke(hr,"getCoords");function mn(t){if(t.length>1&&Ae(t[0])&&Ae(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return mn(t[0]);throw new Error("coordinates must only contain numbers")}ke(mn,"containsNumber");function br(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ke(br,"geojsonType");function wr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ke(wr,"featureOf");function vr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ke(vr,"collectionOf");function yr(t){return t.type==="Feature"?t.geometry:t}ke(yr,"getGeom");function kr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ke(kr,"getType");var jr=Object.defineProperty,cn=(t,e)=>jr(t,"name",{value:e,configurable:!0});function ut(t,e,n={}){if(n.final===!0)return pn(t,e);const r=et(t),o=et(e),i=Oe(r[0]),l=Oe(o[0]),a=Oe(r[1]),s=Oe(o[1]),p=Math.sin(l-i)*Math.cos(s),m=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(l-i);return st(Math.atan2(p,m))}cn(ut,"bearing");function pn(t,e){let n=ut(e,t);return n=(n+180)%360,n}cn(pn,"calculateFinalBearing");var Er=ut;function dt(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function $t(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function Cr(t){let e,n=Br(t[36])+"",r;return{c(){e=x("span"),r=J(n),this.h()},l(o){e=ee(o,"SPAN",{class:!0});var i=ie(e);r=H(i,n),i.forEach(b),this.h()},h(){ze(e,"class","dot svelte-1qktznf"),Q(e,"color","#4472c4"),Q(e,"background-color","white")},m(o,i){E(o,e,i),te(e,r)},p:Ee,d(o){o&&b(e)}}}function ht(t){let e,n,r;function o(s){t[17](s,t[37])}function i(){return t[18](t[36])}function l(){return t[19](t[36])}let a={draggable:!0,$$slots:{default:[Cr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(a.lngLat=t[37].point),e=new Be({props:a}),ne.push(()=>oe(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",l),{c(){A(e.$$.fragment)},l(s){S(e.$$.fragment,s)},m(s,p){I(e,s,p),r=!0},p(s,p){t=s;const m={};p[1]&256&&(m.$$scope={dirty:p,ctx:t}),!n&&p[0]&11&&(n=!0,m.lngLat=t[37].point,re(()=>n=!1)),e.$set(m)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){j(e.$$.fragment,s),r=!1},d(s){F(e,s)}}}function Lr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){ze(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score]),Q(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){E(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score]),r[0]&11&&Q(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&b(e)}}}function Pr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){ze(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score])},m(n,r){E(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score])},d(n){n&&b(e)}}}function Mr(t){let e;return{c(){e=x("span"),this.h()},l(n){e=ee(n,"SPAN",{class:!0}),ie(e).forEach(b),this.h()},h(){ze(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score]),Q(e,"opacity","0%")},m(n,r){E(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score])},d(n){n&&b(e)}}}function bt(t){let e,n,r,o,i,l,a,s,p;function m(v){t[20](v,t[34])}function c(){return t[21](t[36])}function u(){return t[22](t[36])}let C={draggable:!0,$$slots:{default:[Lr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(C.lngLat=t[34].point1),e=new Be({props:C}),ne.push(()=>oe(e,"lngLat",m)),e.$on("dragend",c),e.$on("click",u);function _(v){t[23](v,t[34])}function L(){return t[24](t[36])}function d(){return t[25](t[36])}let $={draggable:!0,$$slots:{default:[Pr]},$$scope:{ctx:t}};t[34].point2!==void 0&&($.lngLat=t[34].point2),o=new Be({props:$}),ne.push(()=>oe(o,"lngLat",_)),o.$on("dragend",L),o.$on("click",d);function P(v){t[26](v,t[34])}function f(){return t[27](t[36])}function g(){return t[28](t[36])}let w={draggable:!0,$$slots:{default:[Mr]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(w.lngLat=t[34].point3),a=new Be({props:w}),ne.push(()=>oe(a,"lngLat",P)),a.$on("dragend",f),a.$on("click",g),{c(){A(e.$$.fragment),r=O(),A(o.$$.fragment),l=O(),A(a.$$.fragment)},l(v){S(e.$$.fragment,v),r=B(v),S(o.$$.fragment,v),l=B(v),S(a.$$.fragment,v)},m(v,T){I(e,v,T),E(v,r,T),I(o,v,T),E(v,l,T),I(a,v,T),p=!0},p(v,T){t=v;const K={};T[0]&11|T[1]&256&&(K.$$scope={dirty:T,ctx:t}),!n&&T[0]&11&&(n=!0,K.lngLat=t[34].point1,re(()=>n=!1)),e.$set(K);const q={};T[0]&11|T[1]&256&&(q.$$scope={dirty:T,ctx:t}),!i&&T[0]&11&&(i=!0,q.lngLat=t[34].point2,re(()=>i=!1)),o.$set(q);const U={};T[0]&11|T[1]&256&&(U.$$scope={dirty:T,ctx:t}),!s&&T[0]&11&&(s=!0,U.lngLat=t[34].point3,re(()=>s=!1)),a.$set(U)},i(v){p||(y(e.$$.fragment,v),y(o.$$.fragment,v),y(a.$$.fragment,v),p=!0)},o(v){j(e.$$.fragment,v),j(o.$$.fragment,v),j(a.$$.fragment,v),p=!1},d(v){v&&(b(r),b(l)),F(e,v),F(o,v),F(a,v)}}}function Ar(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){E(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&_e(n,e)},d(r){r&&b(n)}}}function Sr(t){let e,n;return e=new zt({props:{$$slots:{default:[Ar,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o[1]&260&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function Ir(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){E(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&_e(n,e)},d(r){r&&b(n)}}}function Fr(t){let e,n;return e=new zt({props:{$$slots:{default:[Ir,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o[1]&260&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function Tr(t){let e,n,r,o,i,l;return e=new Qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":ct(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Sr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new Qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":ct(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Fr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),i=new Sn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment),o=O(),A(i.$$.fragment)},l(a){S(e.$$.fragment,a),n=B(a),S(r.$$.fragment,a),o=B(a),S(i.$$.fragment,a)},m(a,s){I(e,a,s),E(a,n,s),I(r,a,s),E(a,o,s),I(i,a,s),l=!0},p(a,s){const p={};s[1]&256&&(p.$$scope={dirty:s,ctx:a}),e.$set(p);const m={};s[1]&256&&(m.$$scope={dirty:s,ctx:a}),r.$set(m)},i(a){l||(y(e.$$.fragment,a),y(r.$$.fragment,a),y(i.$$.fragment,a),l=!0)},o(a){j(e.$$.fragment,a),j(r.$$.fragment,a),j(i.$$.fragment,a),l=!1},d(a){a&&(b(n),b(o)),F(e,a),F(r,a),F(i,a)}}}function qr(t){let e,n,r,o;return e=new Qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new kn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment)},l(i){S(e.$$.fragment,i),n=B(i),S(r.$$.fragment,i)},m(i,l){I(e,i,l),E(i,n,l),I(r,i,l),o=!0},p:Ee,i(i){o||(y(e.$$.fragment,i),y(r.$$.fragment,i),o=!0)},o(i){j(e.$$.fragment,i),j(r.$$.fragment,i),o=!1},d(i){i&&b(n),F(e,i),F(r,i)}}}function Nr(t){let e,n,r,o,i,l,a,s,p,m,c,u;e=new Ut({}),e.$on("click",t[8]),r=new Dt({props:{gj:t[3].summary.networkMap,show:t[2]}});let C=ge(t[3].jat[t[0]][t[1]].arms),_=[];for(let f=0;f<C.length;f+=1)_[f]=ht($t(t,C,f));const L=f=>j(_[f],1,1,()=>{_[f]=null});let d=ge(t[3].jat[t[0]][t[1]].movements),$=[];for(let f=0;f<d.length;f+=1)$[f]=bt(dt(t,d,f));const P=f=>j($[f],1,1,()=>{$[f]=null});return a=new mt({props:{data:t[10](t[3]),$$slots:{default:[Tr]},$$scope:{ctx:t}}}),p=new mt({props:{data:t[5],$$slots:{default:[qr]},$$scope:{ctx:t}}}),c=new En({props:{map:t[4]}}),{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment),o=O();for(let f=0;f<_.length;f+=1)_[f].c();i=O();for(let f=0;f<$.length;f+=1)$[f].c();l=O(),A(a.$$.fragment),s=O(),A(p.$$.fragment),m=O(),A(c.$$.fragment)},l(f){S(e.$$.fragment,f),n=B(f),S(r.$$.fragment,f),o=B(f);for(let g=0;g<_.length;g+=1)_[g].l(f);i=B(f);for(let g=0;g<$.length;g+=1)$[g].l(f);l=B(f),S(a.$$.fragment,f),s=B(f),S(p.$$.fragment,f),m=B(f),S(c.$$.fragment,f)},m(f,g){I(e,f,g),E(f,n,g),I(r,f,g),E(f,o,g);for(let w=0;w<_.length;w+=1)_[w]&&_[w].m(f,g);E(f,i,g);for(let w=0;w<$.length;w+=1)$[w]&&$[w].m(f,g);E(f,l,g),I(a,f,g),E(f,s,g),I(p,f,g),E(f,m,g),I(c,f,g),u=!0},p(f,g){const w={};if(g[0]&8&&(w.gj=f[3].summary.networkMap),g[0]&4&&(w.show=f[2]),r.$set(w),g[0]&139){C=ge(f[3].jat[f[0]][f[1]].arms);let q;for(q=0;q<C.length;q+=1){const U=$t(f,C,q);_[q]?(_[q].p(U,g),y(_[q],1)):(_[q]=ht(U),_[q].c(),y(_[q],1),_[q].m(i.parentNode,i))}for(se(),q=C.length;q<_.length;q+=1)L(q);ue()}if(g[0]&203){d=ge(f[3].jat[f[0]][f[1]].movements);let q;for(q=0;q<d.length;q+=1){const U=dt(f,d,q);$[q]?($[q].p(U,g),y($[q],1)):($[q]=bt(U),$[q].c(),y($[q],1),$[q].m(l.parentNode,l))}for(se(),q=d.length;q<$.length;q+=1)P(q);ue()}const v={};g[0]&8&&(v.data=f[10](f[3])),g[1]&256&&(v.$$scope={dirty:g,ctx:f}),a.$set(v);const T={};g[0]&32&&(T.data=f[5]),g[1]&256&&(T.$$scope={dirty:g,ctx:f}),p.$set(T);const K={};g[0]&16&&(K.map=f[4]),c.$set(K)},i(f){if(!u){y(e.$$.fragment,f),y(r.$$.fragment,f);for(let g=0;g<C.length;g+=1)y(_[g]);for(let g=0;g<d.length;g+=1)y($[g]);y(a.$$.fragment,f),y(p.$$.fragment,f),y(c.$$.fragment,f),u=!0}},o(f){j(e.$$.fragment,f),j(r.$$.fragment,f),_=_.filter(Boolean);for(let g=0;g<_.length;g+=1)j(_[g]);$=$.filter(Boolean);for(let g=0;g<$.length;g+=1)j($[g]);j(a.$$.fragment,f),j(p.$$.fragment,f),j(c.$$.fragment,f),u=!1},d(f){f&&(b(n),b(o),b(i),b(l),b(s),b(m)),F(e,f),F(r,f),Pe(_,f),Pe($,f),F(a,f),F(p,f),F(c,f)}}}function Or(t){let e,n,r;function o(l){t[29](l)}let i={$$slots:{default:[Nr]},$$scope:{ctx:t}};return t[4]!==void 0&&(i.map=t[4]),e=new Bt({props:i}),ne.push(()=>oe(e,"map",o)),{c(){A(e.$$.fragment)},l(l){S(e.$$.fragment,l)},m(l,a){I(e,l,a),r=!0},p(l,a){const s={};a[0]&63|a[1]&256&&(s.$$scope={dirty:a,ctx:l}),!n&&a[0]&16&&(n=!0,s.map=l[4],re(()=>n=!1)),e.$set(s)},i(l){r||(y(e.$$.fragment,l),r=!0)},o(l){j(e.$$.fragment,l),r=!1},d(l){F(e,l)}}}function wt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Br(t){return String.fromCharCode(t+65)}function Gr(t,e,n){let r,o;De(t,Z,k=>n(3,o=k));let{junctionIdx:i}=e,{stage:l}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:p}=e,{streetviewOn:m}=e,{showContext:c}=e,u,C={0:Ue.red.background,1:Ue.amber.background,2:Ue.green.background,X:Ue.critical.background};function _(k,D,z){let he={type:"FeatureCollection",features:[]},W=D??z;return W!=null&&(W.kind=="arm"?he.features.push(wt(k.jat[i][l].arms[W.idx],W.idx)):he.features.push(f(k.jat[i][l].movements[W.idx],W.idx))),he}function L(k){n(11,s=k),n(12,p=null)}function d(k){if(!m){for(let D of u.queryRenderedFeatures(k.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(11,s=null);return}a=="arm"?(Ge(Z,o.jat[i][l].arms=[...o.jat[i][l].arms,{point:k.detail.lngLat.toArray(),name:""}],o),n(11,s={kind:"arm",idx:o.jat[i][l].arms.length-1})):(Ge(Z,o.jat[i][l].movements=[...o.jat[i][l].movements,{point1:k.detail.lngLat.toArray(),point2:gt(k.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:gt(k.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(11,s={kind:"movement",idx:o.jat[i][l].movements.length-1})),n(12,p=null)}}function $(k){L({kind:"movement",idx:k.detail.features[0].id})}qt(()=>{w(!1)});function P(k){let D={type:"FeatureCollection",features:k.jat[i][l].movements.map((z,he)=>f(z,he))};for(let z of k.jat[i][l].movements)if(D.features.push(g(z,D.features.length)),z.kind=="walking & wheeling"){let he={...z,point1:z.point3,point3:z.point1};D.features.push(g(he,D.features.length))}return D}function f(k,D){return{type:"Feature",id:D,properties:{name:k.name,kind:k.kind,color:C[k.score]},geometry:{type:"LineString",coordinates:[k.point1,k.point2,k.point3]}}}function g(k,D){return{type:"Feature",id:D,properties:{kind:k.kind,color:C[k.score],angle:Er(k.point2,k.point3)},geometry:{type:"Point",coordinates:k.point3}}}function w(k){let D=P(o);for(let z of o.jat[i][l].arms)D.features.push(wt(z,D.features.length));for(let z of o.summary.networkMap.features)D.features.push(z);D.features.length>0&&u.fitBounds(Gt(D),{padding:20,animate:k})}function v(){return u}function T(k,D){t.$$.not_equal(D.point,k)&&(D.point=k,Z.set(o))}const K=k=>L({kind:"arm",idx:k}),q=k=>L({kind:"arm",idx:k});function U(k,D){t.$$.not_equal(D.point1,k)&&(D.point1=k,Z.set(o))}const pe=k=>L({kind:"movement",idx:k}),N=k=>L({kind:"movement",idx:k});function be(k,D){t.$$.not_equal(D.point2,k)&&(D.point2=k,Z.set(o))}const le=k=>L({kind:"movement",idx:k}),Fe=k=>L({kind:"movement",idx:k});function Ce(k,D){t.$$.not_equal(D.point3,k)&&(D.point3=k,Z.set(o))}const G=k=>L({kind:"movement",idx:k}),Y=k=>L({kind:"movement",idx:k});function We(k){u=k,n(4,u)}return t.$$set=k=>{"junctionIdx"in k&&n(0,i=k.junctionIdx),"stage"in k&&n(1,l=k.stage),"newKind"in k&&n(13,a=k.newKind),"editing"in k&&n(11,s=k.editing),"hoveringSidebar"in k&&n(12,p=k.hoveringSidebar),"streetviewOn"in k&&n(14,m=k.streetviewOn),"showContext"in k&&n(2,c=k.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=_(o,s,p))},[i,l,c,o,u,r,C,L,d,$,P,s,p,a,m,w,v,T,K,q,U,pe,N,be,le,Fe,Ce,G,Y,We]}class Dr extends Se{constructor(e){super(),Ie(this,e,Gr,Or,je,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function zr(t){let e,n,r,o,i,l,a,s,p,m,c,u;function C(w){t[5](w)}let _={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new tt({props:_}),ne.push(()=>oe(e,"value",C));function L(w){t[6](w)}let d={legend:"Movement",choices:Zt(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Rt({props:d}),ne.push(()=>oe(o,"value",L));function $(w){t[7](w)}let P={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(P.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new Ln({props:P}),ne.push(()=>oe(a,"value",$));function f(w){t[8](w)}let g={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(g.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),m=new Wt({props:g}),ne.push(()=>oe(m,"value",f)),{c(){A(e.$$.fragment),r=O(),A(o.$$.fragment),l=O(),A(a.$$.fragment),p=O(),A(m.$$.fragment)},l(w){S(e.$$.fragment,w),r=B(w),S(o.$$.fragment,w),l=B(w),S(a.$$.fragment,w),p=B(w),S(m.$$.fragment,w)},m(w,v){I(e,w,v),E(w,r,v),I(o,w,v),E(w,l,v),I(a,w,v),E(w,p,v),I(m,w,v),u=!0},p(w,[v]){const T={};!n&&v&15&&(n=!0,T.value=w[3].jat[w[0]][w[1]].movements[w[2]].name,re(()=>n=!1)),e.$set(T);const K={};!i&&v&15&&(i=!0,K.value=w[3].jat[w[0]][w[1]].movements[w[2]].kind,re(()=>i=!1)),o.$set(K);const q={};!s&&v&15&&(s=!0,q.value=w[3].jat[w[0]][w[1]].movements[w[2]].score,re(()=>s=!1)),a.$set(q);const U={};!c&&v&15&&(c=!0,U.value=w[3].jat[w[0]][w[1]].movements[w[2]].notes,re(()=>c=!1)),m.$set(U)},i(w){u||(y(e.$$.fragment,w),y(o.$$.fragment,w),y(a.$$.fragment,w),y(m.$$.fragment,w),u=!0)},o(w){j(e.$$.fragment,w),j(o.$$.fragment,w),j(a.$$.fragment,w),j(m.$$.fragment,w),u=!1},d(w){w&&(b(r),b(l),b(p)),F(e,w),F(o,w),F(a,w),F(m,w)}}}function Ur(t,e,n){let r;De(t,Z,u=>n(3,r=u));let{junctionIdx:o}=e,{stage:i}=e,{idx:l}=e;Zt(["cycling","walking & wheeling"]);let a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(u){t.$$.not_equal(r.jat[o][i].movements[l].name,u)&&(r.jat[o][i].movements[l].name=u,Z.set(r))}function p(u){t.$$.not_equal(r.jat[o][i].movements[l].kind,u)&&(r.jat[o][i].movements[l].kind=u,Z.set(r))}function m(u){t.$$.not_equal(r.jat[o][i].movements[l].score,u)&&(r.jat[o][i].movements[l].score=u,Z.set(r))}function c(u){t.$$.not_equal(r.jat[o][i].movements[l].notes,u)&&(r.jat[o][i].movements[l].notes=u,Z.set(r))}return t.$$set=u=>{"junctionIdx"in u&&n(0,o=u.junctionIdx),"stage"in u&&n(1,i=u.stage),"idx"in u&&n(2,l=u.idx)},[o,i,l,r,a,s,p,m,c]}class Rr extends Se{constructor(e){super(),Ie(this,e,Ur,zr,je,{junctionIdx:0,stage:1,idx:2})}}const{window:Jr}=jn;function vt(t,e,n){const r=t.slice();return r[30]=e[n],r[32]=n,r}function yt(t,e,n){const r=t.slice();return r[33]=e[n],r[32]=n,r}function Hr(t){let e,n,r,o,i,l,a,s;e=new Cn({props:{$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[26]),r=new Nt({props:{$$slots:{default:[Xr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const p=[Zr,Wr],m=[];function c(u,C){return u[3].kind=="movement"?0:1}return i=c(t),l=m[i]=p[i](t),{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment),o=O(),l.c(),a=de()},l(u){S(e.$$.fragment,u),n=B(u),S(r.$$.fragment,u),o=B(u),l.l(u),a=de()},m(u,C){I(e,u,C),E(u,n,C),I(r,u,C),E(u,o,C),m[i].m(u,C),E(u,a,C),s=!0},p(u,C){const _={};C[1]&16&&(_.$$scope={dirty:C,ctx:u}),e.$set(_);const L={};C[1]&16&&(L.$$scope={dirty:C,ctx:u}),r.$set(L);let d=i;i=c(u),i===d?m[i].p(u,C):(se(),j(m[d],1,1,()=>{m[d]=null}),ue(),l=m[i],l?l.p(u,C):(l=m[i]=p[i](u),l.c()),y(l,1),l.m(a.parentNode,a))},i(u){s||(y(e.$$.fragment,u),y(r.$$.fragment,u),y(l),s=!0)},o(u){j(e.$$.fragment,u),j(r.$$.fragment,u),j(l),s=!1},d(u){u&&(b(n),b(o),b(a)),F(e,u),F(r,u),m[i].d(u)}}}function Kr(t){let e,n,r,o,i,l,a,s=(t[8].jat[t[0]].name||"Untitled junction")+"",p,m,c,u,C,_,L,d="Arms",$,P,f,g,w,v="Movements",T,K,q,U,pe;e=new Xt({props:{label:"Tools",$$slots:{default:[xr]},$$scope:{ctx:t}}});function N(h,M){return h[8].jat[h[0]][h[1]].movements.length>0?to:eo}let be=N(t),le=be(t);function Fe(h){t[19](h)}let Ce={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(Ce.value=t[2]),u=new Rt({props:Ce}),ne.push(()=>oe(u,"value",Fe));let G=ge(t[8].jat[t[0]][t[1]].arms),Y=[];for(let h=0;h<G.length;h+=1)Y[h]=jt(yt(t,G,h));const We=h=>j(Y[h],1,1,()=>{Y[h]=null});let k=t[8].jat[t[0]][t[9]].arms.length>0&&Et(t),D=ge(t[8].jat[t[0]][t[1]].movements),z=[];for(let h=0;h<D.length;h+=1)z[h]=Ct(vt(t,D,h));const he=h=>j(z[h],1,1,()=>{z[h]=null});let W=t[8].jat[t[0]][t[9]].movements.length>0&&Lt(t);return{c(){A(e.$$.fragment),n=O(),r=x("p"),o=J("Total JAT score for "),i=J(t[1]),l=O(),a=x("u"),p=J(s),m=J(`
        :
        `),le.c(),c=O(),A(u.$$.fragment),_=O(),L=x("h3"),L.textContent=d,$=O(),P=x("ul");for(let h=0;h<Y.length;h+=1)Y[h].c();f=O(),k&&k.c(),g=O(),w=x("h3"),w.textContent=v,T=O(),K=x("ol");for(let h=0;h<z.length;h+=1)z[h].c();q=O(),W&&W.c(),U=de()},l(h){S(e.$$.fragment,h),n=B(h),r=ee(h,"P",{});var M=ie(r);o=H(M,"Total JAT score for "),i=H(M,t[1]),l=B(M),a=ee(M,"U",{});var ae=ie(a);p=H(ae,s),ae.forEach(b),m=H(M,`
        :
        `),le.l(M),M.forEach(b),c=B(h),S(u.$$.fragment,h),_=B(h),L=ee(h,"H3",{"data-svelte-h":!0}),ft(L)!=="svelte-ld74qb"&&(L.textContent=d),$=B(h),P=ee(h,"UL",{});var Te=ie(P);for(let fe=0;fe<Y.length;fe+=1)Y[fe].l(Te);Te.forEach(b),f=B(h),k&&k.l(h),g=B(h),w=ee(h,"H3",{"data-svelte-h":!0}),ft(w)!=="svelte-1dc52s8"&&(w.textContent=v),T=B(h),K=ee(h,"OL",{});var R=ie(K);for(let fe=0;fe<z.length;fe+=1)z[fe].l(R);R.forEach(b),q=B(h),W&&W.l(h),U=de()},m(h,M){I(e,h,M),E(h,n,M),E(h,r,M),te(r,o),te(r,i),te(r,l),te(r,a),te(a,p),te(r,m),le.m(r,null),E(h,c,M),I(u,h,M),E(h,_,M),E(h,L,M),E(h,$,M),E(h,P,M);for(let ae=0;ae<Y.length;ae+=1)Y[ae]&&Y[ae].m(P,null);E(h,f,M),k&&k.m(h,M),E(h,g,M),E(h,w,M),E(h,T,M),E(h,K,M);for(let ae=0;ae<z.length;ae+=1)z[ae]&&z[ae].m(K,null);E(h,q,M),W&&W.m(h,M),E(h,U,M),pe=!0},p(h,M){const ae={};M[0]&224|M[1]&16&&(ae.$$scope={dirty:M,ctx:h}),e.$set(ae),(!pe||M[0]&2)&&_e(i,h[1]),(!pe||M[0]&257)&&s!==(s=(h[8].jat[h[0]].name||"Untitled junction")+"")&&_e(p,s),be===(be=N(h))&&le?le.p(h,M):(le.d(1),le=be(h),le&&(le.c(),le.m(r,null)));const Te={};if(!C&&M[0]&4&&(C=!0,Te.value=h[2],re(()=>C=!1)),u.$set(Te),M[0]&1299){G=ge(h[8].jat[h[0]][h[1]].arms);let R;for(R=0;R<G.length;R+=1){const fe=yt(h,G,R);Y[R]?(Y[R].p(fe,M),y(Y[R],1)):(Y[R]=jt(fe),Y[R].c(),y(Y[R],1),Y[R].m(P,null))}for(se(),R=G.length;R<Y.length;R+=1)We(R);ue()}if(h[8].jat[h[0]][h[9]].arms.length>0?k?(k.p(h,M),M[0]&257&&y(k,1)):(k=Et(h),k.c(),y(k,1),k.m(g.parentNode,g)):k&&(se(),j(k,1,1,()=>{k=null}),ue()),M[0]&1299){D=ge(h[8].jat[h[0]][h[1]].movements);let R;for(R=0;R<D.length;R+=1){const fe=vt(h,D,R);z[R]?(z[R].p(fe,M),y(z[R],1)):(z[R]=Ct(fe),z[R].c(),y(z[R],1),z[R].m(K,null))}for(se(),R=D.length;R<z.length;R+=1)he(R);ue()}h[8].jat[h[0]][h[9]].movements.length>0?W?(W.p(h,M),M[0]&257&&y(W,1)):(W=Lt(h),W.c(),y(W,1),W.m(U.parentNode,U)):W&&(se(),j(W,1,1,()=>{W=null}),ue())},i(h){if(!pe){y(e.$$.fragment,h),y(u.$$.fragment,h);for(let M=0;M<G.length;M+=1)y(Y[M]);y(k);for(let M=0;M<D.length;M+=1)y(z[M]);y(W),pe=!0}},o(h){j(e.$$.fragment,h),j(u.$$.fragment,h),Y=Y.filter(Boolean);for(let M=0;M<Y.length;M+=1)j(Y[M]);j(k),z=z.filter(Boolean);for(let M=0;M<z.length;M+=1)j(z[M]);j(W),pe=!1},d(h){h&&(b(n),b(r),b(c),b(_),b(L),b($),b(P),b(f),b(g),b(w),b(T),b(K),b(q),b(U)),F(e,h),le.d(),F(u,h),Pe(Y,h),k&&k.d(h),Pe(z,h),W&&W.d(h)}}}function Vr(t){let e;return{c(){e=J("Save")},l(n){e=H(n,"Save")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Xr(t){let e;return{c(){e=J("Delete")},l(n){e=H(n,"Delete")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Wr(t){let e,n,r;function o(l){t[27](l)}let i={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(i.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new tt({props:i}),ne.push(()=>oe(e,"value",o)),{c(){A(e.$$.fragment)},l(l){S(e.$$.fragment,l)},m(l,a){I(e,l,a),r=!0},p(l,a){const s={};!n&&a[0]&267&&(n=!0,s.value=l[8].jat[l[0]][l[1]].arms[l[3].idx].name,re(()=>n=!1)),e.$set(s)},i(l){r||(y(e.$$.fragment,l),r=!0)},o(l){j(e.$$.fragment,l),r=!1},d(l){F(e,l)}}}function Zr(t){let e,n;return e=new Rr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o[0]&1&&(i.junctionIdx=r[0]),o[0]&2&&(i.stage=r[1]),o[0]&8&&(i.idx=r[3].idx),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function Qr(t){let e;return{c(){e=J("Zoom to fit")},l(n){e=H(n,"Zoom to fit")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function kt(t){var l;let e,n,r;function o(a){t[17](a)}let i={map:(l=t[7])==null?void 0:l.getMap()};return t[5]!==void 0&&(i.enabled=t[5]),e=new Vt({props:i}),ne.push(()=>oe(e,"enabled",o)),{c(){A(e.$$.fragment)},l(a){S(e.$$.fragment,a)},m(a,s){I(e,a,s),r=!0},p(a,s){var m;const p={};s[0]&128&&(p.map=(m=a[7])==null?void 0:m.getMap()),!n&&s[0]&32&&(n=!0,p.enabled=a[5],re(()=>n=!1)),e.$set(p)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){j(e.$$.fragment,a),r=!1},d(a){F(e,a)}}}function Yr(t){let e;return{c(){e=J("Show scheme context")},l(n){e=H(n,"Show scheme context")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function xr(t){var L;let e,n,r,o,i,l,a=(L=t[7])==null?void 0:L.getMap(),s,p,m,c;e=new $e({props:{$$slots:{default:[Qr]},$$scope:{ctx:t}}}),e.$on("click",t[16]),r=new Jt({}),i=new Ht({});let u=a&&kt(t);function C(d){t[18](d)}let _={$$slots:{default:[Yr]},$$scope:{ctx:t}};return t[6]!==void 0&&(_.checked=t[6]),p=new Kt({props:_}),ne.push(()=>oe(p,"checked",C)),{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment),o=O(),A(i.$$.fragment),l=O(),u&&u.c(),s=O(),A(p.$$.fragment)},l(d){S(e.$$.fragment,d),n=B(d),S(r.$$.fragment,d),o=B(d),S(i.$$.fragment,d),l=B(d),u&&u.l(d),s=B(d),S(p.$$.fragment,d)},m(d,$){I(e,d,$),E(d,n,$),I(r,d,$),E(d,o,$),I(i,d,$),E(d,l,$),u&&u.m(d,$),E(d,s,$),I(p,d,$),c=!0},p(d,$){var g;const P={};$[1]&16&&(P.$$scope={dirty:$,ctx:d}),e.$set(P),$[0]&128&&(a=(g=d[7])==null?void 0:g.getMap()),a?u?(u.p(d,$),$[0]&128&&y(u,1)):(u=kt(d),u.c(),y(u,1),u.m(s.parentNode,s)):u&&(se(),j(u,1,1,()=>{u=null}),ue());const f={};$[1]&16&&(f.$$scope={dirty:$,ctx:d}),!m&&$[0]&64&&(m=!0,f.checked=d[6],re(()=>m=!1)),p.$set(f)},i(d){c||(y(e.$$.fragment,d),y(r.$$.fragment,d),y(i.$$.fragment,d),y(u),y(p.$$.fragment,d),c=!0)},o(d){j(e.$$.fragment,d),j(r.$$.fragment,d),j(i.$$.fragment,d),j(u),j(p.$$.fragment,d),c=!1},d(d){d&&(b(n),b(o),b(l),b(s)),F(e,d),F(r,d),F(i,d),u&&u.d(d),F(p,d)}}}function eo(t){let e;return{c(){e=J("No movements added")},l(n){e=H(n,"No movements added")},m(n,r){E(n,e,r)},p:Ee,d(n){n&&b(e)}}}function to(t){let e=Pt(t[8].jat[t[0]][t[1]]).toFixed(1)+"",n,r;return{c(){n=J(e),r=J("%")},l(o){n=H(o,e),r=H(o,"%")},m(o,i){E(o,n,i),E(o,r,i)},p(o,i){i[0]&259&&e!==(e=Pt(o[8].jat[o[0]][o[1]]).toFixed(1)+"")&&_e(n,e)},d(o){o&&(b(n),b(r))}}}function no(t){let e=ao(t[32])+"",n,r,o=(t[33].name||"Unnamed arm")+"",i;return{c(){n=J(e),r=J(" - "),i=J(o)},l(l){n=H(l,e),r=H(l," - "),i=H(l,o)},m(l,a){E(l,n,a),E(l,r,a),E(l,i,a)},p(l,a){a[0]&259&&o!==(o=(l[33].name||"Unnamed arm")+"")&&_e(i,o)},d(l){l&&(b(n),b(r),b(i))}}}function jt(t){let e,n,r,o;function i(){return t[20](t[32])}function l(){return t[21](t[32])}return n=new $e({props:{$$slots:{default:[no]},$$scope:{ctx:t}}}),n.$on("click",i),n.$on("mouseenter",l),n.$on("mouseleave",t[22]),{c(){e=x("li"),A(n.$$.fragment),r=O()},l(a){e=ee(a,"LI",{});var s=ie(e);S(n.$$.fragment,s),r=B(s),s.forEach(b)},m(a,s){E(a,e,s),I(n,e,null),te(e,r),o=!0},p(a,s){t=a;const p={};s[0]&259|s[1]&16&&(p.$$scope={dirty:s,ctx:t}),n.$set(p)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){j(n.$$.fragment,a),o=!1},d(a){a&&b(e),F(n)}}}function Et(t){let e,n;return e=new $e({props:{$$slots:{default:[ro]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o[1]&16&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function ro(t){let e,n;return{c(){e=J("Copy arms from "),n=J(t[9])},l(r){e=H(r,"Copy arms from "),n=H(r,t[9])},m(r,o){E(r,e,o),E(r,n,o)},p:Ee,d(r){r&&(b(e),b(n))}}}function oo(t){let e=(t[30].name||"Unnamed movement")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){E(r,n,o)},p(r,o){o[0]&259&&e!==(e=(r[30].name||"Unnamed movement")+"")&&_e(n,e)},d(r){r&&b(n)}}}function Ct(t){let e,n,r,o;function i(){return t[23](t[32])}function l(){return t[24](t[32])}return n=new $e({props:{$$slots:{default:[oo]},$$scope:{ctx:t}}}),n.$on("click",i),n.$on("mouseenter",l),n.$on("mouseleave",t[25]),{c(){e=x("li"),A(n.$$.fragment),r=O()},l(a){e=ee(a,"LI",{});var s=ie(e);S(n.$$.fragment,s),r=B(s),s.forEach(b)},m(a,s){E(a,e,s),I(n,e,null),te(e,r),o=!0},p(a,s){t=a;const p={};s[0]&259|s[1]&16&&(p.$$scope={dirty:s,ctx:t}),n.$set(p)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){j(n.$$.fragment,a),o=!1},d(a){a&&b(e),F(n)}}}function Lt(t){let e,n;return e=new $e({props:{$$slots:{default:[io]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o[1]&16&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function io(t){let e,n;return{c(){e=J("Copy movements from "),n=J(t[9])},l(r){e=H(r,"Copy movements from "),n=H(r,t[9])},m(r,o){E(r,e,o),E(r,n,o)},p:Ee,d(r){r&&(b(e),b(n))}}}function lo(t){let e,n,r,o,i,l,a,s,p,m,c,u,C,_;function L(v){t[15](v)}let d={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(d.value=t[8].jat[t[0]][t[1]].notes),e=new Wt({props:d}),ne.push(()=>oe(e,"value",L));const $=[Kr,Hr],P=[];function f(v,T){return v[3]==null?0:1}l=f(t),a=P[l]=$[l](t);function g(v){t[29](v)}let w={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(w.editing=t[3]),m=new Dr({props:w}),t[28](m),ne.push(()=>oe(m,"editing",g)),{c(){A(e.$$.fragment),r=O(),o=x("div"),i=x("div"),a.c(),s=O(),p=x("div"),A(m.$$.fragment),this.h()},l(v){S(e.$$.fragment,v),r=B(v),o=ee(v,"DIV",{style:!0});var T=ie(o);i=ee(T,"DIV",{style:!0});var K=ie(i);a.l(K),K.forEach(b),s=B(T),p=ee(T,"DIV",{style:!0});var q=ie(p);S(m.$$.fragment,q),q.forEach(b),T.forEach(b),this.h()},h(){Q(i,"width","30%"),Q(i,"overflow-y","scroll"),Q(i,"padding","10px"),Q(i,"border","1px solid black"),Q(p,"position","relative"),Q(p,"width","100%"),Q(o,"display","flex"),Q(o,"height","80vh")},m(v,T){I(e,v,T),E(v,r,T),E(v,o,T),te(o,i),P[l].m(i,null),te(o,s),te(o,p),I(m,p,null),u=!0,C||(_=hn(Jr,"keydown",t[12]),C=!0)},p(v,T){const K={};!n&&T[0]&259&&(n=!0,K.value=v[8].jat[v[0]][v[1]].notes,re(()=>n=!1)),e.$set(K);let q=l;l=f(v),l===q?P[l].p(v,T):(se(),j(P[q],1,1,()=>{P[q]=null}),ue(),a=P[l],a?a.p(v,T):(a=P[l]=$[l](v),a.c()),y(a,1),a.m(i,null));const U={};T[0]&1&&(U.junctionIdx=v[0]),T[0]&2&&(U.stage=v[1]),T[0]&4&&(U.newKind=v[2]),T[0]&16&&(U.hoveringSidebar=v[4]),T[0]&32&&(U.streetviewOn=v[5]),T[0]&64&&(U.showContext=v[6]),!c&&T[0]&8&&(c=!0,U.editing=v[3],re(()=>c=!1)),m.$set(U)},i(v){u||(y(e.$$.fragment,v),y(a),y(m.$$.fragment,v),u=!0)},o(v){j(e.$$.fragment,v),j(a),j(m.$$.fragment,v),u=!1},d(v){v&&(b(r),b(o)),F(e,v),P[l].d(),t[28](null),F(m),C=!1,_()}}}function ao(t){return String.fromCharCode(t+65)}function Pt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function so(t,e,n){let r;De(t,Z,G=>n(8,r=G));let{junctionIdx:o}=e,{stage:i}=e,l=i=="existing"?"proposed":"existing",a="arm",s=null,p=null,m=!1,c=!0,u=null;function C(G){n(3,s=G),n(4,p=null)}function _(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][i].movements.splice(s.idx,1),Z.set(r)):(r.jat[o][i].arms.splice(s.idx,1),Z.set(r)),n(3,s=null))}function L(G){s!=null&&G.key=="Escape"?(G.stopPropagation(),n(3,s=null)):s!=null&&G.key=="Delete"&&_()}function d(){r.jat[o][i].arms.length>0&&!window.confirm("Overwrite arms?")||(Ge(Z,r.jat[o][i].arms=JSON.parse(JSON.stringify(r.jat[o][l].arms)),r),Z.set(r))}function $(){r.jat[o][i].movements.length>0&&!window.confirm("Overwrite movements?")||(Ge(Z,r.jat[o][i].movements=JSON.parse(JSON.stringify(r.jat[o][l].movements)),r),Z.set(r))}function P(G){t.$$.not_equal(r.jat[o][i].notes,G)&&(r.jat[o][i].notes=G,Z.set(r))}const f=()=>u==null?void 0:u.zoom(!0);function g(G){m=G,n(5,m)}function w(G){c=G,n(6,c)}function v(G){a=G,n(2,a)}const T=G=>C({kind:"arm",idx:G}),K=G=>n(4,p={kind:"arm",idx:G}),q=()=>n(4,p=null),U=G=>C({kind:"movement",idx:G}),pe=G=>n(4,p={kind:"movement",idx:G}),N=()=>n(4,p=null),be=()=>n(3,s=null);function le(G){t.$$.not_equal(r.jat[o][i].arms[s.idx].name,G)&&(r.jat[o][i].arms[s.idx].name=G,Z.set(r))}function Fe(G){ne[G?"unshift":"push"](()=>{u=G,n(7,u)})}function Ce(G){s=G,n(3,s)}return t.$$set=G=>{"junctionIdx"in G&&n(0,o=G.junctionIdx),"stage"in G&&n(1,i=G.stage)},[o,i,a,s,p,m,c,u,r,l,C,_,L,d,$,P,f,g,w,v,T,K,q,U,pe,N,be,le,Fe,Ce]}class uo extends Se{constructor(e){super(),Ie(this,e,so,lo,je,{junctionIdx:0,stage:1},null,[-1,-1])}}function Mt(t,e,n){const r=t.slice();return r[14]=e[n],r[15]=e,r[16]=n,r}function At(t,e,n){const r=t.slice();return r[14]=e[n],r[16]=n,r}function fo(t){let e;return{c(){e=J("Zoom to fit")},l(n){e=H(n,"Zoom to fit")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function St(t){let e,n,r;function o(l){t[8](l)}let i={map:t[0]};return t[1]!==void 0&&(i.enabled=t[1]),e=new Vt({props:i}),ne.push(()=>oe(e,"enabled",o)),{c(){A(e.$$.fragment)},l(l){S(e.$$.fragment,l)},m(l,a){I(e,l,a),r=!0},p(l,a){const s={};a&1&&(s.map=l[0]),!n&&a&2&&(n=!0,s.enabled=l[1],re(()=>n=!1)),e.$set(s)},i(l){r||(y(e.$$.fragment,l),r=!0)},o(l){j(e.$$.fragment,l),r=!1},d(l){F(e,l)}}}function mo(t){let e;return{c(){e=J("Show scheme context")},l(n){e=H(n,"Show scheme context")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function co(t){let e,n,r,o,i,l,a,s,p,m;e=new $e({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),r=new Jt({}),i=new Ht({});let c=t[0]&&St(t);function u(_){t[9](_)}let C={$$slots:{default:[mo]},$$scope:{ctx:t}};return t[2]!==void 0&&(C.checked=t[2]),s=new Kt({props:C}),ne.push(()=>oe(s,"checked",u)),{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment),o=O(),A(i.$$.fragment),l=O(),c&&c.c(),a=O(),A(s.$$.fragment)},l(_){S(e.$$.fragment,_),n=B(_),S(r.$$.fragment,_),o=B(_),S(i.$$.fragment,_),l=B(_),c&&c.l(_),a=B(_),S(s.$$.fragment,_)},m(_,L){I(e,_,L),E(_,n,L),I(r,_,L),E(_,o,L),I(i,_,L),E(_,l,L),c&&c.m(_,L),E(_,a,L),I(s,_,L),m=!0},p(_,L){const d={};L&262144&&(d.$$scope={dirty:L,ctx:_}),e.$set(d),_[0]?c?(c.p(_,L),L&1&&y(c,1)):(c=St(_),c.c(),y(c,1),c.m(a.parentNode,a)):c&&(se(),j(c,1,1,()=>{c=null}),ue());const $={};L&262144&&($.$$scope={dirty:L,ctx:_}),!p&&L&4&&(p=!0,$.checked=_[2],re(()=>p=!1)),s.$set($)},i(_){m||(y(e.$$.fragment,_),y(r.$$.fragment,_),y(i.$$.fragment,_),y(c),y(s.$$.fragment,_),m=!0)},o(_){j(e.$$.fragment,_),j(r.$$.fragment,_),j(i.$$.fragment,_),j(c),j(s.$$.fragment,_),m=!1},d(_){_&&(b(n),b(o),b(l),b(a)),F(e,_),F(r,_),F(i,_),c&&c.d(_),F(s,_)}}}function po(t){let e=(t[14].name||"Untitled junction")+"",n;return{c(){n=J(e)},l(r){n=H(r,e)},m(r,o){E(r,n,o)},p(r,o){o&8&&e!==(e=(r[14].name||"Untitled junction")+"")&&_e(n,e)},d(r){r&&b(n)}}}function It(t){let e,n,r,o;function i(){return t[10](t[16])}return n=new $e({props:{$$slots:{default:[po]},$$scope:{ctx:t}}}),n.$on("click",i),{c(){e=x("li"),A(n.$$.fragment),r=O()},l(l){e=ee(l,"LI",{});var a=ie(e);S(n.$$.fragment,a),r=B(a),a.forEach(b)},m(l,a){E(l,e,a),I(n,e,null),te(e,r),o=!0},p(l,a){t=l;const s={};a&262152&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(l){o||(y(n.$$.fragment,l),o=!0)},o(l){j(n.$$.fragment,l),o=!1},d(l){l&&b(e),F(n)}}}function go(t){let e,n=t[14].name+"",r,o;return{c(){e=x("span"),r=J(n),o=O(),this.h()},l(i){e=ee(i,"SPAN",{class:!0});var l=ie(e);r=H(l,n),l.forEach(b),o=B(i),this.h()},h(){ze(e,"class","dot svelte-14n804a")},m(i,l){E(i,e,l),te(e,r),E(i,o,l)},p(i,l){l&8&&n!==(n=i[14].name+"")&&_e(r,n)},d(i){i&&(b(e),b(o))}}}function Ft(t){let e,n,r;function o(a){t[11](a,t[14])}function i(){return t[12](t[16])}let l={draggable:!0,$$slots:{default:[go]},$$scope:{ctx:t}};return t[14].point!==void 0&&(l.lngLat=t[14].point),e=new Be({props:l}),ne.push(()=>oe(e,"lngLat",o)),e.$on("click",i),{c(){A(e.$$.fragment)},l(a){S(e.$$.fragment,a)},m(a,s){I(e,a,s),r=!0},p(a,s){t=a;const p={};s&262152&&(p.$$scope={dirty:s,ctx:t}),!n&&s&8&&(n=!0,p.lngLat=t[14].point,re(()=>n=!1)),e.$set(p)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){j(e.$$.fragment,a),r=!1},d(a){F(e,a)}}}function _o(t){let e,n,r,o,i,l;e=new Ut({}),e.$on("click",t[6]),r=new Dt({props:{gj:t[3].summary.networkMap,show:t[2]}});let a=ge(t[3].jat),s=[];for(let m=0;m<a.length;m+=1)s[m]=Ft(Mt(t,a,m));const p=m=>j(s[m],1,1,()=>{s[m]=null});return{c(){A(e.$$.fragment),n=O(),A(r.$$.fragment),o=O();for(let m=0;m<s.length;m+=1)s[m].c();i=de()},l(m){S(e.$$.fragment,m),n=B(m),S(r.$$.fragment,m),o=B(m);for(let c=0;c<s.length;c+=1)s[c].l(m);i=de()},m(m,c){I(e,m,c),E(m,n,c),I(r,m,c),E(m,o,c);for(let u=0;u<s.length;u+=1)s[u]&&s[u].m(m,c);E(m,i,c),l=!0},p(m,c){const u={};if(c&8&&(u.gj=m[3].summary.networkMap),c&4&&(u.show=m[2]),r.$set(u),c&24){a=ge(m[3].jat);let C;for(C=0;C<a.length;C+=1){const _=Mt(m,a,C);s[C]?(s[C].p(_,c),y(s[C],1)):(s[C]=Ft(_),s[C].c(),y(s[C],1),s[C].m(i.parentNode,i))}for(se(),C=a.length;C<s.length;C+=1)p(C);ue()}},i(m){if(!l){y(e.$$.fragment,m),y(r.$$.fragment,m);for(let c=0;c<a.length;c+=1)y(s[c]);l=!0}},o(m){j(e.$$.fragment,m),j(r.$$.fragment,m),s=s.filter(Boolean);for(let c=0;c<s.length;c+=1)j(s[c]);l=!1},d(m){m&&(b(n),b(o),b(i)),F(e,m),F(r,m),Pe(s,m)}}}function $o(t){let e,n,r,o,i,l,a,s,p,m;r=new Xt({props:{label:"Tools",$$slots:{default:[co]},$$scope:{ctx:t}}});let c=ge(t[3].jat),u=[];for(let d=0;d<c.length;d+=1)u[d]=It(At(t,c,d));const C=d=>j(u[d],1,1,()=>{u[d]=null});function _(d){t[13](d)}let L={$$slots:{default:[_o]},$$scope:{ctx:t}};return t[0]!==void 0&&(L.map=t[0]),s=new Bt({props:L}),ne.push(()=>oe(s,"map",_)),{c(){e=x("div"),n=x("div"),A(r.$$.fragment),o=O(),i=x("ol");for(let d=0;d<u.length;d+=1)u[d].c();l=O(),a=x("div"),A(s.$$.fragment),this.h()},l(d){e=ee(d,"DIV",{style:!0});var $=ie(e);n=ee($,"DIV",{style:!0});var P=ie(n);S(r.$$.fragment,P),o=B(P),i=ee(P,"OL",{});var f=ie(i);for(let w=0;w<u.length;w+=1)u[w].l(f);f.forEach(b),P.forEach(b),l=B($),a=ee($,"DIV",{style:!0});var g=ie(a);S(s.$$.fragment,g),g.forEach(b),$.forEach(b),this.h()},h(){Q(n,"width","30%"),Q(n,"overflow-y","scroll"),Q(n,"padding","10px"),Q(n,"border","1px solid black"),Q(a,"position","relative"),Q(a,"width","100%"),Q(e,"display","flex"),Q(e,"height","80vh")},m(d,$){E(d,e,$),te(e,n),I(r,n,null),te(n,o),te(n,i);for(let P=0;P<u.length;P+=1)u[P]&&u[P].m(i,null);te(e,l),te(e,a),I(s,a,null),m=!0},p(d,[$]){const P={};if($&262151&&(P.$$scope={dirty:$,ctx:d}),r.$set(P),$&24){c=ge(d[3].jat);let g;for(g=0;g<c.length;g+=1){const w=At(d,c,g);u[g]?(u[g].p(w,$),y(u[g],1)):(u[g]=It(w),u[g].c(),y(u[g],1),u[g].m(i,null))}for(se(),g=c.length;g<u.length;g+=1)C(g);ue()}const f={};$&262156&&(f.$$scope={dirty:$,ctx:d}),!p&&$&1&&(p=!0,f.map=d[0],re(()=>p=!1)),s.$set(f)},i(d){if(!m){y(r.$$.fragment,d);for(let $=0;$<c.length;$+=1)y(u[$]);y(s.$$.fragment,d),m=!0}},o(d){j(r.$$.fragment,d),u=u.filter(Boolean);for(let $=0;$<u.length;$+=1)j(u[$]);j(s.$$.fragment,d),m=!1},d(d){d&&b(e),F(r),Pe(u,d),F(s)}}}function ho(t,e,n){let r;De(t,Z,$=>n(3,r=$));let o=bn(),i,l=!1,a=!0;qt(()=>{s(!1)});function s($){let P={type:"FeatureCollection",features:r.jat.map(f=>({type:"Feature",properties:{},geometry:{type:"Point",coordinates:f.point}}))};for(let f of r.summary.networkMap.features)P.features.push(f);P.features.length>0&&i.fitBounds(Gt(P),{padding:20,animate:$})}function p($){l||(Ge(Z,r.jat=[...r.jat,{name:"",point:$.detail.lngLat.toArray(),existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),o("edit",{idx:r.jat.length-1}))}const m=()=>s(!0);function c($){l=$,n(1,l)}function u($){a=$,n(2,a)}const C=$=>o("edit",{idx:$});function _($,P){t.$$.not_equal(P.point,$)&&(P.point=$,Z.set(r))}const L=$=>o("edit",{idx:$});function d($){i=$,n(0,i)}return[i,l,a,r,o,s,p,m,c,u,C,_,L,d]}class bo extends Se{constructor(e){super(),Ie(this,e,ho,$o,je,{})}}function wo(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,i=t[0].stage+"",l,a,s,p,m,c,u,C=t[0].stage,_,L;s=new wn({props:{$$slots:{default:[Po]},$$scope:{ctx:t}}});function d(f){t[8](f)}let $={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&($.value=t[1].jat[t[0].idx].name),m=new tt({props:$}),ne.push(()=>oe(m,"value",d));let P=Tt(t);return{c(){e=x("h2"),r=J(n),o=J(" - "),l=J(i),a=O(),A(s.$$.fragment),p=O(),A(m.$$.fragment),u=O(),P.c(),_=de()},l(f){e=ee(f,"H2",{});var g=ie(e);r=H(g,n),o=H(g," - "),l=H(g,i),g.forEach(b),a=B(f),S(s.$$.fragment,f),p=B(f),S(m.$$.fragment,f),u=B(f),P.l(f),_=de()},m(f,g){E(f,e,g),te(e,r),te(e,o),te(e,l),E(f,a,g),I(s,f,g),E(f,p,g),I(m,f,g),E(f,u,g),P.m(f,g),E(f,_,g),L=!0},p(f,g){(!L||g&3)&&n!==(n=(f[1].jat[f[0].idx].name||"Untitled junction")+"")&&_e(r,n),(!L||g&1)&&i!==(i=f[0].stage+"")&&_e(l,i);const w={};g&513&&(w.$$scope={dirty:g,ctx:f}),s.$set(w);const v={};!c&&g&3&&(c=!0,v.value=f[1].jat[f[0].idx].name,re(()=>c=!1)),m.$set(v),g&1&&je(C,C=f[0].stage)?(se(),j(P,1,1,Ee),ue(),P=Tt(f),P.c(),y(P,1),P.m(_.parentNode,_)):P.p(f,g)},i(f){L||(y(s.$$.fragment,f),y(m.$$.fragment,f),y(P),L=!0)},o(f){j(s.$$.fragment,f),j(m.$$.fragment,f),j(P),L=!1},d(f){f&&(b(e),b(a),b(p),b(u),b(_)),F(s,f),F(m,f),P.d(f)}}}function vo(t){let e,n;return e=new bo({}),e.$on("edit",t[3]),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p:Ee,i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function yo(t){let e;return{c(){e=J("Back to all junctions")},l(n){e=H(n,"Back to all junctions")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function ko(t){let e,n;return e=new $e({props:{$$slots:{default:[Eo]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function jo(t){let e,n;return e=new $e({props:{$$slots:{default:[Co]},$$scope:{ctx:t}}}),e.$on("click",t[5]),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o&512&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function Eo(t){let e;return{c(){e=J("Edit Proposed")},l(n){e=H(n,"Edit Proposed")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Co(t){let e;return{c(){e=J("Edit Existing")},l(n){e=H(n,"Edit Existing")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Lo(t){let e;return{c(){e=J("Delete")},l(n){e=H(n,"Delete")},m(n,r){E(n,e,r)},d(n){n&&b(e)}}}function Po(t){let e,n,r,o,i,l,a;e=new $e({props:{$$slots:{default:[yo]},$$scope:{ctx:t}}}),e.$on("click",t[4]);const s=[jo,ko],p=[];function m(c,u){return c[0].stage=="proposed"?0:1}return r=m(t),o=p[r]=s[r](t),l=new Nt({props:{$$slots:{default:[Lo]},$$scope:{ctx:t}}}),l.$on("click",t[7]),{c(){A(e.$$.fragment),n=O(),o.c(),i=O(),A(l.$$.fragment)},l(c){S(e.$$.fragment,c),n=B(c),o.l(c),i=B(c),S(l.$$.fragment,c)},m(c,u){I(e,c,u),E(c,n,u),p[r].m(c,u),E(c,i,u),I(l,c,u),a=!0},p(c,u){const C={};u&512&&(C.$$scope={dirty:u,ctx:c}),e.$set(C);let _=r;r=m(c),r===_?p[r].p(c,u):(se(),j(p[_],1,1,()=>{p[_]=null}),ue(),o=p[r],o?o.p(c,u):(o=p[r]=s[r](c),o.c()),y(o,1),o.m(i.parentNode,i));const L={};u&512&&(L.$$scope={dirty:u,ctx:c}),l.$set(L)},i(c){a||(y(e.$$.fragment,c),y(o),y(l.$$.fragment,c),a=!0)},o(c){j(e.$$.fragment,c),j(o),j(l.$$.fragment,c),a=!1},d(c){c&&(b(n),b(i)),F(e,c),p[r].d(c),F(l,c)}}}function Tt(t){let e,n;return e=new uo({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){A(e.$$.fragment)},l(r){S(e.$$.fragment,r)},m(r,o){I(e,r,o),n=!0},p(r,o){const i={};o&1&&(i.junctionIdx=r[0].idx),o&1&&(i.stage=r[0].stage),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){j(e.$$.fragment,r),n=!1},d(r){F(e,r)}}}function Mo(t){let e,n,r,o;const i=[vo,wo],l=[];function a(s,p){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(t))&&(n=l[e]=i[e](t)),{c(){n&&n.c(),r=de()},l(s){n&&n.l(s),r=de()},m(s,p){~e&&l[e].m(s,p),E(s,r,p),o=!0},p(s,[p]){let m=e;e=a(s),e===m?~e&&l[e].p(s,p):(n&&(se(),j(l[m],1,1,()=>{l[m]=null}),ue()),~e?(n=l[e],n?n.p(s,p):(n=l[e]=i[e](s),n.c()),y(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(y(n),o=!0)},o(s){j(n),o=!1},d(s){s&&b(r),~e&&l[e].d(s)}}}function Ze(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function Ao(t,e,n){let r;De(t,Z,u=>n(1,r=u));let o={kind:"list"};function i(u){window.confirm("Delete this junction?")&&(r.jat.splice(u,1),Z.set(r),n(0,o={kind:"list"}))}const l=u=>n(0,o={kind:"edit",idx:u.detail.idx,stage:"existing"}),a=()=>n(0,o={kind:"list"}),s=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"existing"}),p=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"proposed"}),m=()=>i(Ze(o));function c(u){t.$$.not_equal(r.jat[o.idx].name,u)&&(r.jat[o.idx].name=u,Z.set(r))}return[o,r,i,l,a,s,p,m,c]}class Vo extends Se{constructor(e){super(),Ie(this,e,Ao,Mo,je,{})}}export{Vo as component};
