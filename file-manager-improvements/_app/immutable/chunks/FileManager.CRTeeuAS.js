import{s as je,r as Oe,a as L,g as T,i as j,w as Re,f as p,U as We,t as M,d as X,e as I,c as F,q as Z,y as Me,n as ue,p as ce,l as Ye,b as J,v as Xe,h as c,j as se,u as Ve,m as qe,o as xe,H as Ie,V as fe,K as Ge,W as Pe}from"./scheduler.DGwhun8C.js";import{S as Be,i as Je,e as ze,c as P,a as z,m as U,t as O,b as B,d as K,g as ve,f as we}from"./index.B2vZYn3d.js";import{e as Fe}from"./each.osbS1YKp.js";import{g as Se}from"./entry.DvaquzlM.js";import{b as de}from"./paths.BPJma5Yy.js";import{a as Ne,c as Ce}from"./index.tIZh40DF.js";import{S as Ue,A as Ke}from"./ServiceHeader.DDkMBWP_.js";import{F as Qe}from"./FileInput.ix1LAelR.js";import"./SelectWithCustom.svelte_svelte_type_style_lang.BHEndFmw.js";import{S as me}from"./SecondaryButton.zQkvdoBX.js";import{W as Ze}from"./WarningButton.B3j9Frnm.js";import{F as et}from"./FormElement.Cd26lsYY.js";import{W as tt}from"./WarningText.wRiJ9IQ1.js";import{L as lt}from"./Loading.DwQ0MXrf.js";import{M as nt}from"./Modal.CX8Vic3N.js";import{d as Ee}from"./index.MnZtt33D.js";function rt(n){let e;return{c(){e=M("Import from XLSX file")},l(t){e=X(t,"Import from XLSX file")},m(t,l){j(t,e,l)},d(t){t&&p(e)}}}function ot(n){let e,t,l;return{c(){e=I("input"),this.h()},l(a){e=F(a,"INPUT",{class:!0,id:!0,type:!0}),this.h()},h(){Z(e,"class","govuk-file-upload"),Z(e,"id","import-xlsx"),Z(e,"type","file")},m(a,r){j(a,e,r),n[6](e),t||(l=Me(e,"change",n[3]),t=!0)},p:ue,d(a){a&&p(e),n[6](null),t=!1,l()}}}function st(n){let e,t=`You can import from an existing route check .xlsx file, <b>only if there&#39;s an up-to-date DALOG sheet added</b>
      . After importing, there will still be some problems:`,l,a,r=`<li>You must fill out the Junction Assessment Tool (JAT); it won&#39;t be
        imported</li> <li>Some text fields on the Summary of Scheme page will be missing</li>`;return{c(){e=I("p"),e.innerHTML=t,l=L(),a=I("ul"),a.innerHTML=r},l(o){e=F(o,"P",{"data-svelte-h":!0}),ce(e)!=="svelte-1ykh4hv"&&(e.innerHTML=t),l=T(o),a=F(o,"UL",{"data-svelte-h":!0}),ce(a)!=="svelte-1tt4pqo"&&(a.innerHTML=r)},m(o,s){j(o,e,s),j(o,l,s),j(o,a,s)},p:ue,d(o){o&&(p(e),p(l),p(a))}}}function at(n){let e;return{c(){e=M("Close")},l(t){e=X(t,"Close")},m(t,l){j(t,e,l)},d(t){t&&p(e)}}}function it(n){let e,t,l,a,r,o;return e=new et({props:{label:"Import from XLSX file",id:"import-xlsx",$$slots:{default:[ot]},$$scope:{ctx:n}}}),l=new tt({props:{$$slots:{default:[st]},$$scope:{ctx:n}}}),r=new me({props:{$$slots:{default:[at]},$$scope:{ctx:n}}}),r.$on("click",n[7]),{c(){P(e.$$.fragment),t=L(),P(l.$$.fragment),a=L(),P(r.$$.fragment)},l(s){z(e.$$.fragment,s),t=T(s),z(l.$$.fragment,s),a=T(s),z(r.$$.fragment,s)},m(s,$){U(e,s,$),j(s,t,$),U(l,s,$),j(s,a,$),U(r,s,$),o=!0},p(s,$){const v={};$&1028&&(v.$$scope={dirty:$,ctx:s}),e.$set(v);const u={};$&1024&&(u.$$scope={dirty:$,ctx:s}),l.$set(u);const f={};$&1024&&(f.$$scope={dirty:$,ctx:s}),r.$set(f)},i(s){o||(O(e.$$.fragment,s),O(l.$$.fragment,s),O(r.$$.fragment,s),o=!0)},o(s){B(e.$$.fragment,s),B(l.$$.fragment,s),B(r.$$.fragment,s),o=!1},d(s){s&&(p(t),p(a)),K(e,s),K(l,s),K(r,s)}}}function ft(n){let e,t,l,a,r,o,s;e=new me({props:{$$slots:{default:[rt]},$$scope:{ctx:n}}}),e.$on("click",n[5]),l=new lt({props:{loading:n[0]}});function $(u){n[8](u)}let v={title:"Import from XLSX file",$$slots:{default:[it]},$$scope:{ctx:n}};return n[1]!==void 0&&(v.open=n[1]),r=new nt({props:v}),Oe.push(()=>ze(r,"open",$)),{c(){P(e.$$.fragment),t=L(),P(l.$$.fragment),a=L(),P(r.$$.fragment)},l(u){z(e.$$.fragment,u),t=T(u),z(l.$$.fragment,u),a=T(u),z(r.$$.fragment,u)},m(u,f){U(e,u,f),j(u,t,f),U(l,u,f),j(u,a,f),U(r,u,f),s=!0},p(u,[f]){const d={};f&1024&&(d.$$scope={dirty:f,ctx:u}),e.$set(d);const g={};f&1&&(g.loading=u[0]),l.$set(g);const A={};f&1030&&(A.$$scope={dirty:f,ctx:u}),!o&&f&2&&(o=!0,A.open=u[1],Re(()=>o=!1)),r.$set(A)},i(u){s||(O(e.$$.fragment,u),O(l.$$.fragment,u),O(r.$$.fragment,u),s=!0)},o(u){B(e.$$.fragment,u),B(l.$$.fragment,u),B(r.$$.fragment,u),s=!1},d(u){u&&(p(t),p(a)),K(e,u),K(l,u),K(r,u)}}}function ut(n,e,t){let l=We(),{xlsxImporter:a}=e,r="",o=!1,s;async function $(g){let A=s.files[0].name;try{t(0,r=`Loading ${A}`);let C=await s.files[0].arrayBuffer(),q=await a(C);t(0,r=""),l("imported",{filename:Ne(A,".xlsx"),data:q})}catch(C){window.alert(`Couldn't import ${A}: ${C}`),t(0,r="")}}const v=()=>t(1,o=!0);function u(g){Oe[g?"unshift":"push"](()=>{s=g,t(2,s)})}const f=()=>t(1,o=!1);function d(g){o=g,t(1,o)}return n.$$set=g=>{"xlsxImporter"in g&&t(4,a=g.xlsxImporter)},[r,o,s,$,a,v,u,f,d]}class ct extends Be{constructor(e){super(),Je(this,e,ut,ft,je,{xlsxImporter:4})}}function Le(n,e,t){const l=n.slice();return l[22]=e[t],l}const mt=n=>({}),Te=n=>({});function Ae(n){let e,t,l="You are editing:",a,r,o,s;return{c(){e=I("p"),t=I("b"),t.textContent=l,a=L(),r=I("a"),o=M(n[7]),this.h()},l($){e=F($,"P",{});var v=J(e);t=F(v,"B",{"data-svelte-h":!0}),ce(t)!=="svelte-1kt2tqj"&&(t.textContent=l),a=T(v),r=F(v,"A",{href:!0});var u=J(r);o=X(u,n[7]),u.forEach(p),v.forEach(p),this.h()},h(){Z(r,"href",s=`${de}/${n[0].prefix}overview`)},m($,v){j($,e,v),c(e,t),c(e,a),c(e,r),c(r,o)},p($,v){v&128&&se(o,$[7]),v&1&&s!==(s=`${de}/${$[0].prefix}overview`)&&Z(r,"href",s)},d($){$&&p(e)}}}function _t(n){let e,t="No saved files";return{c(){e=I("p"),e.textContent=t},l(l){e=F(l,"P",{"data-svelte-h":!0}),ce(e)!=="svelte-yojds1"&&(e.textContent=t)},m(l,a){j(l,e,a)},p:ue,i:ue,o:ue,d(l){l&&p(e)}}}function dt(n){let e,t="Manage existing files",l,a,r,o,s,$="File name",v,u,f=Ce(n[4])+"",d,g,A,C,q="Action",D,V,N,E=Fe(n[6]),h=[];for(let m=0;m<E.length;m+=1)h[m]=He(Le(n,E,m));const ne=m=>B(h[m],1,1,()=>{h[m]=null});return{c(){e=I("h2"),e.textContent=t,l=L(),a=I("table"),r=I("thead"),o=I("tr"),s=I("th"),s.textContent=$,v=L(),u=I("th"),d=M(f),g=M(" name"),A=L(),C=I("th"),C.textContent=q,D=L(),V=I("tbody");for(let m=0;m<h.length;m+=1)h[m].c()},l(m){e=F(m,"H2",{"data-svelte-h":!0}),ce(e)!=="svelte-1d50rjn"&&(e.textContent=t),l=T(m),a=F(m,"TABLE",{});var b=J(a);r=F(b,"THEAD",{});var k=J(r);o=F(k,"TR",{});var w=J(o);s=F(w,"TH",{"data-svelte-h":!0}),ce(s)!=="svelte-1nlq0n5"&&(s.textContent=$),v=T(w),u=F(w,"TH",{});var S=J(u);d=X(S,f),g=X(S," name"),S.forEach(p),A=T(w),C=F(w,"TH",{"data-svelte-h":!0}),ce(C)!=="svelte-izszto"&&(C.textContent=q),w.forEach(p),k.forEach(p),D=T(b),V=F(b,"TBODY",{});var R=J(V);for(let i=0;i<h.length;i+=1)h[i].l(R);R.forEach(p),b.forEach(p)},m(m,b){j(m,e,b),j(m,l,b),j(m,a,b),c(a,r),c(r,o),c(o,s),c(o,v),c(o,u),c(u,d),c(u,g),c(o,A),c(o,C),c(a,D),c(a,V);for(let k=0;k<h.length;k+=1)h[k]&&h[k].m(V,null);N=!0},p(m,b){if((!N||b&16)&&f!==(f=Ce(m[4])+"")&&se(d,f),b&18241){E=Fe(m[6]);let k;for(k=0;k<E.length;k+=1){const w=Le(m,E,k);h[k]?(h[k].p(w,b),O(h[k],1)):(h[k]=He(w),h[k].c(),O(h[k],1),h[k].m(V,null))}for(ve(),k=E.length;k<h.length;k+=1)ne(k);we()}},i(m){if(!N){for(let b=0;b<E.length;b+=1)O(h[b]);N=!0}},o(m){h=h.filter(Boolean);for(let b=0;b<h.length;b+=1)B(h[b]);N=!1},d(m){m&&(p(e),p(l),p(a)),Ge(h,m)}}}function pt(n){let e;return{c(){e=M("Export JSON")},l(t){e=X(t,"Export JSON")},m(t,l){j(t,e,l)},d(t){t&&p(e)}}}function $t(n){let e;return{c(){e=M("Rename")},l(t){e=X(t,"Rename")},m(t,l){j(t,e,l)},d(t){t&&p(e)}}}function ht(n){let e;return{c(){e=M("Delete")},l(t){e=X(t,"Delete")},m(t,l){j(t,e,l)},d(t){t&&p(e)}}}function He(n){let e,t,l,a=n[22]+"",r,o,s,$=n[0].describeFile(n[22])+"",v,u,f,d,g,A,C,q,D,V,N,E,h;function ne(){return n[16](n[22])}function m(){return n[17](n[22])}g=new me({props:{$$slots:{default:[pt]},$$scope:{ctx:n}}}),g.$on("click",m);function b(){return n[18](n[22])}C=new me({props:{$$slots:{default:[$t]},$$scope:{ctx:n}}}),C.$on("click",b);function k(){return n[19](n[22])}return D=new Ze({props:{$$slots:{default:[ht]},$$scope:{ctx:n}}}),D.$on("click",k),{c(){e=I("tr"),t=I("td"),l=I("a"),r=M(a),o=L(),s=I("td"),v=M($),u=L(),f=I("td"),d=I("div"),P(g.$$.fragment),A=L(),P(C.$$.fragment),q=L(),P(D.$$.fragment),V=L(),this.h()},l(w){e=F(w,"TR",{});var S=J(e);t=F(S,"TD",{});var R=J(t);l=F(R,"A",{href:!0});var i=J(l);r=X(i,a),i.forEach(p),R.forEach(p),o=T(S),s=F(S,"TD",{});var y=J(s);v=X(y,$),y.forEach(p),u=T(S),f=F(S,"TD",{});var G=J(f);d=F(G,"DIV",{class:!0,style:!0});var Y=J(d);z(g.$$.fragment,Y),A=T(Y),z(C.$$.fragment,Y),q=T(Y),z(D.$$.fragment,Y),Y.forEach(p),G.forEach(p),V=T(S),S.forEach(p),this.h()},h(){Z(l,"href","#"),Z(d,"class","govuk-button-group"),Xe(d,"flex-wrap","nowrap")},m(w,S){j(w,e,S),c(e,t),c(t,l),c(l,r),c(e,o),c(e,s),c(s,v),c(e,u),c(e,f),c(f,d),U(g,d,null),c(d,A),U(C,d,null),c(d,q),U(D,d,null),c(e,V),N=!0,E||(h=Me(l,"click",Pe(ne)),E=!0)},p(w,S){n=w,(!N||S&64)&&a!==(a=n[22]+"")&&se(r,a),(!N||S&65)&&$!==($=n[0].describeFile(n[22])+"")&&se(v,$);const R={};S&1048576&&(R.$$scope={dirty:S,ctx:n}),g.$set(R);const i={};S&1048576&&(i.$$scope={dirty:S,ctx:n}),C.$set(i);const y={};S&1048576&&(y.$$scope={dirty:S,ctx:n}),D.$set(y)},i(w){N||(O(g.$$.fragment,w),O(C.$$.fragment,w),O(D.$$.fragment,w),N=!0)},o(w){B(g.$$.fragment,w),B(C.$$.fragment,w),B(D.$$.fragment,w),N=!1},d(w){w&&p(e),K(g),K(C),K(D),E=!1,h()}}}function gt(n){let e;return{c(){e=M("Create new file")},l(t){e=X(t,"Create new file")},m(t,l){j(t,e,l)},d(t){t&&p(e)}}}function De(n){let e,t,l,a;return l=new ct({props:{xlsxImporter:n[5]}}),l.$on("imported",n[13]),{c(){e=I("hr"),t=L(),P(l.$$.fragment)},l(r){e=F(r,"HR",{}),t=T(r),z(l.$$.fragment,r)},m(r,o){j(r,e,o),j(r,t,o),U(l,r,o),a=!0},p(r,o){const s={};o&32&&(s.xlsxImporter=r[5]),l.$set(s)},i(r){a||(O(l.$$.fragment,r),a=!0)},o(r){B(l.$$.fragment,r),a=!1},d(r){r&&(p(e),p(t)),K(l,r)}}}function bt(n){let e,t,l,a,r,o,s,$,v,u,f,d,g,A,C,q,D,V,N,E,h,ne,m,b,k,w,S,R,i,y,G,Y,pe,ae,$e,te;e=new Ue({props:{service:n[3]}}),a=new Ke({});const he=n[15].description,Q=Ye(he,n,n[20],Te);let x=n[7]&&Ae(n);const ke=[dt,_t],re=[];function ye(_,H){return _[6].length>0?0:1}E=ye(n),h=re[E]=ke[E](n),R=new me({props:{$$slots:{default:[gt]},$$scope:{ctx:n}}}),R.$on("click",n[11]),ae=new Qe({props:{label:"Select a .json file",onLoad:n[12]}});let W=n[5]!=null&&De(n);return{c(){P(e.$$.fragment),t=L(),l=I("div"),P(a.$$.fragment),r=L(),o=I("h1"),s=M("Manage my "),$=M(n[4]),v=M("s"),u=L(),f=I("div"),d=I("div"),Q&&Q.c(),g=L(),A=I("p"),C=M("On this page you can manage your "),q=M(n[4]),D=M(` files. All files are auto-saved
        in your browser's local storage. You can close your browser and continue
        later.`),V=L(),x&&x.c(),N=L(),h.c(),ne=L(),m=I("div"),b=I("h2"),k=M("Create a new "),w=M(n[4]),S=L(),P(R.$$.fragment),i=L(),y=I("h2"),G=M("Import a saved "),Y=M(n[4]),pe=L(),P(ae.$$.fragment),$e=L(),W&&W.c(),this.h()},l(_){z(e.$$.fragment,_),t=T(_),l=F(_,"DIV",{class:!0});var H=J(l);z(a.$$.fragment,H),r=T(H),o=F(H,"H1",{style:!0});var ie=J(o);s=X(ie,"Manage my "),$=X(ie,n[4]),v=X(ie,"s"),ie.forEach(p),u=T(H),f=F(H,"DIV",{class:!0});var oe=J(f);d=F(oe,"DIV",{class:!0});var ee=J(d);Q&&Q.l(ee),g=T(ee),A=F(ee,"P",{});var _e=J(A);C=X(_e,"On this page you can manage your "),q=X(_e,n[4]),D=X(_e,` files. All files are auto-saved
        in your browser's local storage. You can close your browser and continue
        later.`),_e.forEach(p),V=T(ee),x&&x.l(ee),N=T(ee),h.l(ee),ee.forEach(p),ne=T(oe),m=F(oe,"DIV",{class:!0});var le=J(m);b=F(le,"H2",{class:!0});var ge=J(b);k=X(ge,"Create a new "),w=X(ge,n[4]),ge.forEach(p),S=T(le),z(R.$$.fragment,le),i=T(le),y=F(le,"H2",{});var be=J(y);G=X(be,"Import a saved "),Y=X(be,n[4]),be.forEach(p),pe=T(le),z(ae.$$.fragment,le),$e=T(le),W&&W.l(le),le.forEach(p),oe.forEach(p),H.forEach(p),this.h()},h(){Xe(o,"margin-top","30px"),Z(d,"class","govuk-grid-column-two-thirds"),Z(b,"class","green-bar svelte-1z050ke"),Z(m,"class","govuk-grid-column-one-third"),Z(f,"class","govuk-grid-row"),Z(l,"class","govuk-width-container")},m(_,H){U(e,_,H),j(_,t,H),j(_,l,H),U(a,l,null),c(l,r),c(l,o),c(o,s),c(o,$),c(o,v),c(l,u),c(l,f),c(f,d),Q&&Q.m(d,null),c(d,g),c(d,A),c(A,C),c(A,q),c(A,D),c(d,V),x&&x.m(d,null),c(d,N),re[E].m(d,null),c(f,ne),c(f,m),c(m,b),c(b,k),c(b,w),c(m,S),U(R,m,null),c(m,i),c(m,y),c(y,G),c(y,Y),c(m,pe),U(ae,m,null),c(m,$e),W&&W.m(m,null),te=!0},p(_,[H]){const ie={};H&8&&(ie.service=_[3]),e.$set(ie),(!te||H&16)&&se($,_[4]),Q&&Q.p&&(!te||H&1048576)&&Ve(Q,he,_,_[20],te?xe(he,_[20],H,mt):qe(_[20]),Te),(!te||H&16)&&se(q,_[4]),_[7]?x?x.p(_,H):(x=Ae(_),x.c(),x.m(d,N)):x&&(x.d(1),x=null);let oe=E;E=ye(_),E===oe?re[E].p(_,H):(ve(),B(re[oe],1,1,()=>{re[oe]=null}),we(),h=re[E],h?h.p(_,H):(h=re[E]=ke[E](_),h.c()),O(h,1),h.m(d,null)),(!te||H&16)&&se(w,_[4]);const ee={};H&1048576&&(ee.$$scope={dirty:H,ctx:_}),R.$set(ee),(!te||H&16)&&se(Y,_[4]),_[5]!=null?W?(W.p(_,H),H&32&&O(W,1)):(W=De(_),W.c(),O(W,1),W.m(m,null)):W&&(ve(),B(W,1,1,()=>{W=null}),we())},i(_){te||(O(e.$$.fragment,_),O(a.$$.fragment,_),O(Q,_),O(h),O(R.$$.fragment,_),O(ae.$$.fragment,_),O(W),te=!0)},o(_){B(e.$$.fragment,_),B(a.$$.fragment,_),B(Q,_),B(h),B(R.$$.fragment,_),B(ae.$$.fragment,_),B(W),te=!1},d(_){_&&(p(t),p(l)),K(e,_),K(a),Q&&Q.d(_),x&&x.d(),re[E].d(),K(R),K(ae),W&&W.d()}}}function vt(n,e,t){let l,a=ue,r=()=>(a(),a=Ie(g,i=>t(21,l=i)),g),o,s=ue,$=()=>(s(),s=Ie(d,i=>t(7,o=i)),d);n.$$.on_destroy.push(()=>a()),n.$$.on_destroy.push(()=>s());let{$$slots:v={},$$scope:u}=e,{files:f}=e,{currentFile:d}=e;$();let{state:g}=e;r();let{service:A}=e,{fileObjectType:C}=e,{xlsxImporter:q=null}=e,D=f.getFileList();function V(i){let y=window.prompt(`Rename file ${i} to what?`,i);if(y){let G=f.key(i),Y=window.localStorage.getItem(G);window.localStorage.setItem(f.key(y),Y),window.localStorage.removeItem(G),t(6,D=f.getFileList()),o==i&&fe(d,o=y,o)}}function N(i){let y=f.key(i);Ee(`${i}.json`,window.localStorage.getItem(y))}function E(i){if(!window.confirm(`Really delete file ${i}? You can't undo this. (If you delete, a copy will still be downloaded to your browser's download folder, in case you make a mistake.)`))return;let y=f.key(i);Ee(`${i}.json`,window.localStorage.getItem(y)),window.localStorage.removeItem(y),o==i&&(fe(d,o="",o),fe(g,l=f.emptyState(),l),window.localStorage.setItem(f.key("last-opened-file"),"")),t(6,D=f.getFileList())}function h(){let i=window.prompt("What do you want to name your new file?");i&&(fe(d,o=i,o),fe(g,l=f.emptyState(),l),t(6,D=f.saveAndGetFileList(o,l)),Se(`${de}/${f.prefix}overview`))}function ne(i,y){let G=Ne(i,".json");try{let Y=JSON.parse(y);f.validate(Y),t(6,D=f.saveAndGetFileList(G,Y)),b(G)}catch(Y){window.alert(`Couldn't load ${G}: ${Y}`)}}function m(i){let{filename:y,data:G}=i.detail;t(6,D=f.saveAndGetFileList(y,G)),b(y)}function b(i){try{let y=f.loadFile(i);fe(d,o=i,o),fe(g,l=y,l),Se(`${de}/${f.prefix}overview`)}catch(y){window.alert(`Couldn't load ${i}: ${y}`)}return!1}const k=i=>b(i),w=i=>N(i),S=i=>V(i),R=i=>E(i);return n.$$set=i=>{"files"in i&&t(0,f=i.files),"currentFile"in i&&$(t(1,d=i.currentFile)),"state"in i&&r(t(2,g=i.state)),"service"in i&&t(3,A=i.service),"fileObjectType"in i&&t(4,C=i.fileObjectType),"xlsxImporter"in i&&t(5,q=i.xlsxImporter),"$$scope"in i&&t(20,u=i.$$scope)},[f,d,g,A,C,q,D,o,V,N,E,h,ne,m,b,v,k,w,S,R,u]}class Xt extends Be{constructor(e){super(),Je(this,e,vt,bt,je,{files:0,currentFile:1,state:2,service:3,fileObjectType:4,xlsxImporter:5})}}export{Xt as F};
