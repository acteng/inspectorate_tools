import{s as Ee,l as Tt,O as Qe,e as Q,c as Y,b as ne,f as $,r as De,x as ee,P as ct,i as w,h as te,z as ze,u as qt,m as Bt,o as Ot,B as sn,Q as gt,G as _e,v as re,w as oe,k as Je,U as un,T as Ne,a as N,g as G,q as Ge,n as Ae,t as R,d as H,j as de,D as be,p as Ye,K as fn,L as mn}from"../chunks/scheduler.BBS-fkhU.js";import{S as Me,i as Se,t as y,b as k,e as ie,c as F,a as T,m as q,d as B,g as me,f as ce}from"../chunks/index.B8H3ypVf.js";import{e as pe}from"../chunks/each.D79A5KlB.js";import{B as cn}from"../chunks/ButtonGroup.fhy-VJbf.js";import{D as Nt,C as gn}from"../chunks/DefaultButton.Pbp5mObw.js";import{g as pn,W as Gt,S as ve}from"../chunks/WarningButton.CaqyhU7y.js";import{T as rt}from"../chunks/TextInput.C_aBwF72.js";import{s as Z}from"../chunks/data.DmlLTneg.js";import{L as dn,f as _n,e as Dt,M as hn,b as $n,C as bn,G as pt,l as xe,n as dt,c as vn,P as zt,g as yn}from"../chunks/index.Ca-kOYyF.js";import{c as $e}from"../chunks/colors.CYEpEtTL.js";import{M as wn,a as kn,b as Ue,R as Ut,B as jn,G as En,S as Cn,C as Ln}from"../chunks/GeoreferenceLayer.DQ0RiqKO.js";import{T as Rt}from"../chunks/TextArea.Ck6ITb4v.js";import"../chunks/paths.TJ1ycRoZ.js";/* empty css                                                               */import{p as Ht}from"../chunks/index.CixL5vwi.js";import{S as Pn}from"../chunks/Select.DqyoFzIJ.js";function An(t){let e,n,r,o,l;const i=t[2].default,a=Tt(i,t,t[1],null);let s=[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},t[0],{style:"width: 100%"}],m={};for(let c=0;c<s.length;c+=1)m=Qe(m,s[c]);return{c(){e=Q("button"),n=Q("div"),a&&a.c(),this.h()},l(c){e=Y(c,"BUTTON",{type:!0,class:!0,"data-module":!0,style:!0});var p=ne(e);n=Y(p,"DIV",{class:!0,style:!0});var f=ne(n);a&&a.l(f),f.forEach($),p.forEach($),this.h()},h(){De(n,"class","govuk-details__text"),ee(n,"text-align","left"),ct(e,m)},m(c,p){w(c,e,p),te(e,n),a&&a.m(n,null),e.autofocus&&e.focus(),r=!0,o||(l=[ze(e,"click",t[3]),ze(e,"mouseenter",t[4]),ze(e,"mouseleave",t[5])],o=!0)},p(c,[p]){a&&a.p&&(!r||p&2)&&qt(a,i,c,c[1],r?Ot(i,c[1],p,null):Bt(c[1]),null),ct(e,m=pn(s,[{type:"button"},{class:"govuk-button govuk-button--secondary"},{"data-module":"govuk-button"},p&1&&c[0],{style:"width: 100%"}]))},i(c){r||(y(a,c),r=!0)},o(c){k(a,c),r=!1},d(c){c&&$(e),a&&a.d(c),o=!1,sn(l)}}}function Mn(t,e,n){let{$$slots:r={},$$scope:o}=e;function l(s){_e.call(this,t,s)}function i(s){_e.call(this,t,s)}function a(s){_e.call(this,t,s)}return t.$$set=s=>{n(0,e=Qe(Qe({},e),gt(s))),"$$scope"in s&&n(1,o=s.$$scope)},e=gt(e),[e,o,r,l,i,a]}class Sn extends Me{constructor(e){super(),Se(this,e,Mn,An,Ee,{})}}function In(t){let e;const n=t[16].default,r=Tt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&qt(r,n,o,o[24],e?Ot(n,o[24],l,null):Bt(o[24]),null)},i(o){e||(y(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function Fn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[In]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new dn({props:l}),re.push(()=>ie(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],oe(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function Tn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=_n("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:c=void 0}=e,{layout:p=void 0}=e,{filter:f=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:j=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:C=!1}=e,{hovered:d=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:h=!0}=e;function b(M){d=M,n(0,d)}function _(M){_e.call(this,t,M)}function L(M){_e.call(this,t,M)}function V(M){_e.call(this,t,M)}function A(M){_e.call(this,t,M)}function U(M){_e.call(this,t,M)}function he(M){_e.call(this,t,M)}return t.$$set=M=>{"id"in M&&n(1,l=M.id),"source"in M&&n(2,i=M.source),"sourceLayer"in M&&n(3,a=M.sourceLayer),"beforeId"in M&&n(4,s=M.beforeId),"beforeLayerType"in M&&n(5,m=M.beforeLayerType),"paint"in M&&n(6,c=M.paint),"layout"in M&&n(7,p=M.layout),"filter"in M&&n(8,f=M.filter),"applyToClusters"in M&&n(9,E=M.applyToClusters),"minzoom"in M&&n(10,j=M.minzoom),"maxzoom"in M&&n(11,I=M.maxzoom),"hoverCursor"in M&&n(12,D=M.hoverCursor),"manageHoverState"in M&&n(13,C=M.manageHoverState),"hovered"in M&&n(0,d=M.hovered),"eventsIfTopMost"in M&&n(14,u=M.eventsIfTopMost),"interactive"in M&&n(15,h=M.interactive),"$$scope"in M&&n(24,o=M.$$scope)},[d,l,i,a,s,m,c,p,f,E,j,I,D,C,u,h,r,b,_,L,V,A,U,he,o]}class qn extends Me{constructor(e){super(),Se(this,e,Tn,Fn,Ee,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Bn=Object.defineProperty,J=(t,e)=>Bn(t,"name",{value:e,configurable:!0}),On=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!qe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=et(e),o=et(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!qe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return qe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Dt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return qe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(On,"GeojsonEquality");function qe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(qe,"sameLength");function et(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(et,"explode");var ue=63710088e-1,Jt={centimeters:ue*100,centimetres:ue*100,degrees:360/(2*Math.PI),feet:ue*3.28084,inches:ue*39.37,kilometers:ue/1e3,kilometres:ue/1e3,meters:ue,metres:ue,miles:ue/1609.344,millimeters:ue*1e3,millimetres:ue*1e3,nauticalmiles:ue/1852,radians:1,yards:ue*1.0936},_t={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ye(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J(ye,"feature");function Nn(t,e,n={}){switch(t){case"Point":return Ke(e).geometry;case"LineString":return it(e).geometry;case"Polygon":return ot(e).geometry;case"MultiPoint":return Vt(e).geometry;case"MultiLineString":return Kt(e).geometry;case"MultiPolygon":return Xt(e).geometry;default:throw new Error(t+" is invalid")}}J(Nn,"geometry");function Ke(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Le(t[0])||!Le(t[1]))throw new Error("coordinates must contain numbers");return ye({type:"Point",coordinates:t},e,n)}J(Ke,"point");function Gn(t,e,n={}){return Ve(t.map(r=>Ke(r,e)),n)}J(Gn,"points");function ot(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ye({type:"Polygon",coordinates:t},e,n)}J(ot,"polygon");function Dn(t,e,n={}){return Ve(t.map(r=>ot(r,e)),n)}J(Dn,"polygons");function it(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ye({type:"LineString",coordinates:t},e,n)}J(it,"lineString");function zn(t,e,n={}){return Ve(t.map(r=>it(r,e)),n)}J(zn,"lineStrings");function Ve(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(Ve,"featureCollection");function Kt(t,e,n={}){return ye({type:"MultiLineString",coordinates:t},e,n)}J(Kt,"multiLineString");function Vt(t,e,n={}){return ye({type:"MultiPoint",coordinates:t},e,n)}J(Vt,"multiPoint");function Xt(t,e,n={}){return ye({type:"MultiPolygon",coordinates:t},e,n)}J(Xt,"multiPolygon");function Un(t,e,n={}){return ye({type:"GeometryCollection",geometries:t},e,n)}J(Un,"geometryCollection");function Rn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J(Rn,"round");function Wt(t,e="kilometers"){const n=Jt[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(Wt,"radiansToLength");function Xe(t,e="kilometers"){const n=Jt[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(Xe,"lengthToRadians");function Hn(t,e){return He(Xe(t,e))}J(Hn,"lengthToDegrees");function Jn(t){let e=t%360;return e<0&&(e+=360),e}J(Jn,"bearingToAzimuth");function He(t){return t%(2*Math.PI)*180/Math.PI}J(He,"radiansToDegrees");function Re(t){return t%360*Math.PI/180}J(Re,"degreesToRadians");function Kn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Wt(Xe(t,e),n)}J(Kn,"convertLength");function Vn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=_t[e];if(!r)throw new Error("invalid original units");const o=_t[n];if(!o)throw new Error("invalid final units");return t/r*o}J(Vn,"convertArea");function Le(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(Le,"isNumber");function Xn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(Xn,"isObject");function Wn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Le(e))throw new Error("bbox must only contain numbers")})}J(Wn,"validateBBox");function Zn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(Zn,"validateId");var Qn=Object.defineProperty,we=(t,e)=>Qn(t,"name",{value:e,configurable:!0});function Zt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}we(Zt,"getCoord");function Yn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}we(Yn,"getCoords");function Qt(t){if(t.length>1&&Le(t[0])&&Le(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Qt(t[0]);throw new Error("coordinates must only contain numbers")}we(Qt,"containsNumber");function xn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}we(xn,"geojsonType");function er(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}we(er,"featureOf");function tr(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}we(tr,"collectionOf");function nr(t){return t.type==="Feature"?t.geometry:t}we(nr,"getGeom");function rr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}we(rr,"getType");var or=Object.defineProperty,ir=(t,e)=>or(t,"name",{value:e,configurable:!0});function Yt(t,e,n,r={}){const o=Zt(t),l=Re(o[0]),i=Re(o[1]),a=Re(n),s=Xe(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),c=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),p=He(c),f=He(m);return Ke([p,f],r.properties)}ir(Yt,"destination");var ht=Yt,lr=Object.defineProperty,K=(t,e)=>lr(t,"name",{value:e,configurable:!0}),ar=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Be(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=tt(e),o=tt(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Be(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Be(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Dt(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Be(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};K(ar,"GeojsonEquality");function Be(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}K(Be,"sameLength");function tt(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}K(tt,"explode");var fe=63710088e-1,xt={centimeters:fe*100,centimetres:fe*100,degrees:360/(2*Math.PI),feet:fe*3.28084,inches:fe*39.37,kilometers:fe/1e3,kilometres:fe/1e3,meters:fe,metres:fe,miles:fe/1609.344,millimeters:fe*1e3,millimetres:fe*1e3,nauticalmiles:fe/1852,radians:1,yards:fe*1.0936},$t={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ke(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}K(ke,"feature");function sr(t,e,n={}){switch(t){case"Point":return lt(e).geometry;case"LineString":return st(e).geometry;case"Polygon":return at(e).geometry;case"MultiPoint":return tn(e).geometry;case"MultiLineString":return en(e).geometry;case"MultiPolygon":return nn(e).geometry;default:throw new Error(t+" is invalid")}}K(sr,"geometry");function lt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pe(t[0])||!Pe(t[1]))throw new Error("coordinates must contain numbers");return ke({type:"Point",coordinates:t},e,n)}K(lt,"point");function ur(t,e,n={}){return We(t.map(r=>lt(r,e)),n)}K(ur,"points");function at(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ke({type:"Polygon",coordinates:t},e,n)}K(at,"polygon");function fr(t,e,n={}){return We(t.map(r=>at(r,e)),n)}K(fr,"polygons");function st(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ke({type:"LineString",coordinates:t},e,n)}K(st,"lineString");function mr(t,e,n={}){return We(t.map(r=>st(r,e)),n)}K(mr,"lineStrings");function We(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}K(We,"featureCollection");function en(t,e,n={}){return ke({type:"MultiLineString",coordinates:t},e,n)}K(en,"multiLineString");function tn(t,e,n={}){return ke({type:"MultiPoint",coordinates:t},e,n)}K(tn,"multiPoint");function nn(t,e,n={}){return ke({type:"MultiPolygon",coordinates:t},e,n)}K(nn,"multiPolygon");function cr(t,e,n={}){return ke({type:"GeometryCollection",geometries:t},e,n)}K(cr,"geometryCollection");function gr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}K(gr,"round");function rn(t,e="kilometers"){const n=xt[e];if(!n)throw new Error(e+" units is invalid");return t*n}K(rn,"radiansToLength");function ut(t,e="kilometers"){const n=xt[e];if(!n)throw new Error(e+" units is invalid");return t/n}K(ut,"lengthToRadians");function pr(t,e){return ft(ut(t,e))}K(pr,"lengthToDegrees");function dr(t){let e=t%360;return e<0&&(e+=360),e}K(dr,"bearingToAzimuth");function ft(t){return t%(2*Math.PI)*180/Math.PI}K(ft,"radiansToDegrees");function Oe(t){return t%360*Math.PI/180}K(Oe,"degreesToRadians");function _r(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return rn(ut(t,e),n)}K(_r,"convertLength");function hr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=$t[e];if(!r)throw new Error("invalid original units");const o=$t[n];if(!o)throw new Error("invalid final units");return t/r*o}K(hr,"convertArea");function Pe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}K(Pe,"isNumber");function $r(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}K($r,"isObject");function br(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Pe(e))throw new Error("bbox must only contain numbers")})}K(br,"validateBBox");function vr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}K(vr,"validateId");var yr=Object.defineProperty,je=(t,e)=>yr(t,"name",{value:e,configurable:!0});function nt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}je(nt,"getCoord");function wr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}je(wr,"getCoords");function on(t){if(t.length>1&&Pe(t[0])&&Pe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return on(t[0]);throw new Error("coordinates must only contain numbers")}je(on,"containsNumber");function kr(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}je(kr,"geojsonType");function jr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}je(jr,"featureOf");function Er(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}je(Er,"collectionOf");function Cr(t){return t.type==="Feature"?t.geometry:t}je(Cr,"getGeom");function Lr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}je(Lr,"getType");var Pr=Object.defineProperty,ln=(t,e)=>Pr(t,"name",{value:e,configurable:!0});function mt(t,e,n={}){if(n.final===!0)return an(t,e);const r=nt(t),o=nt(e),l=Oe(r[0]),i=Oe(o[0]),a=Oe(r[1]),s=Oe(o[1]),m=Math.sin(i-l)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return ft(Math.atan2(m,c))}ln(mt,"bearing");function an(t,e){let n=mt(e,t);return n=(n+180)%360,n}ln(an,"calculateFinalBearing");var Ar=mt;function bt(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function vt(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function Mr(t){let e,n=Ur(t[36])+"",r;return{c(){e=Q("span"),r=R(n),this.h()},l(o){e=Y(o,"SPAN",{class:!0});var l=ne(e);r=H(l,n),l.forEach($),this.h()},h(){De(e,"class","dot svelte-1qktznf"),ee(e,"color","#4472c4"),ee(e,"background-color","white")},m(o,l){w(o,e,l),te(e,r)},p:Ae,d(o){o&&$(e)}}}function yt(t){let e,n,r;function o(s){t[17](s,t[37])}function l(){return t[18](t[36])}function i(){return t[19](t[36])}let a={draggable:!0,$$slots:{default:[Mr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(a.lngLat=t[37].point),e=new Ue({props:a}),re.push(()=>ie(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){F(e.$$.fragment)},l(s){T(e.$$.fragment,s)},m(s,m){q(e,s,m),r=!0},p(s,m){t=s;const c={};m[1]&256&&(c.$$scope={dirty:m,ctx:t}),!n&&m[0]&11&&(n=!0,c.lngLat=t[37].point,oe(()=>n=!1)),e.$set(c)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){B(e,s)}}}function Sr(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),ne(e).forEach($),this.h()},h(){De(e,"class","dot svelte-1qktznf"),ee(e,"background-color",t[6][t[34].score]),ee(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){w(n,e,r)},p(n,r){r[0]&11&&ee(e,"background-color",n[6][n[34].score]),r[0]&11&&ee(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&$(e)}}}function Ir(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),ne(e).forEach($),this.h()},h(){De(e,"class","dot svelte-1qktznf"),ee(e,"background-color",t[6][t[34].score])},m(n,r){w(n,e,r)},p(n,r){r[0]&11&&ee(e,"background-color",n[6][n[34].score])},d(n){n&&$(e)}}}function Fr(t){let e;return{c(){e=Q("span"),this.h()},l(n){e=Y(n,"SPAN",{class:!0}),ne(e).forEach($),this.h()},h(){De(e,"class","dot svelte-1qktznf"),ee(e,"background-color",t[6][t[34].score]),ee(e,"opacity","0%")},m(n,r){w(n,e,r)},p(n,r){r[0]&11&&ee(e,"background-color",n[6][n[34].score])},d(n){n&&$(e)}}}function wt(t){let e,n,r,o,l,i,a,s,m;function c(_){t[20](_,t[34])}function p(){return t[21](t[36])}function f(){return t[22](t[36])}let E={draggable:!0,$$slots:{default:[Sr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(E.lngLat=t[34].point1),e=new Ue({props:E}),re.push(()=>ie(e,"lngLat",c)),e.$on("dragend",p),e.$on("click",f);function j(_){t[23](_,t[34])}function I(){return t[24](t[36])}function D(){return t[25](t[36])}let C={draggable:!0,$$slots:{default:[Ir]},$$scope:{ctx:t}};t[34].point2!==void 0&&(C.lngLat=t[34].point2),o=new Ue({props:C}),re.push(()=>ie(o,"lngLat",j)),o.$on("dragend",I),o.$on("click",D);function d(_){t[26](_,t[34])}function u(){return t[27](t[36])}function h(){return t[28](t[36])}let b={draggable:!0,$$slots:{default:[Fr]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(b.lngLat=t[34].point3),a=new Ue({props:b}),re.push(()=>ie(a,"lngLat",d)),a.$on("dragend",u),a.$on("click",h),{c(){F(e.$$.fragment),r=N(),F(o.$$.fragment),i=N(),F(a.$$.fragment)},l(_){T(e.$$.fragment,_),r=G(_),T(o.$$.fragment,_),i=G(_),T(a.$$.fragment,_)},m(_,L){q(e,_,L),w(_,r,L),q(o,_,L),w(_,i,L),q(a,_,L),m=!0},p(_,L){t=_;const V={};L[0]&11|L[1]&256&&(V.$$scope={dirty:L,ctx:t}),!n&&L[0]&11&&(n=!0,V.lngLat=t[34].point1,oe(()=>n=!1)),e.$set(V);const A={};L[0]&11|L[1]&256&&(A.$$scope={dirty:L,ctx:t}),!l&&L[0]&11&&(l=!0,A.lngLat=t[34].point2,oe(()=>l=!1)),o.$set(A);const U={};L[0]&11|L[1]&256&&(U.$$scope={dirty:L,ctx:t}),!s&&L[0]&11&&(s=!0,U.lngLat=t[34].point3,oe(()=>s=!1)),a.$set(U)},i(_){m||(y(e.$$.fragment,_),y(o.$$.fragment,_),y(a.$$.fragment,_),m=!0)},o(_){k(e.$$.fragment,_),k(o.$$.fragment,_),k(a.$$.fragment,_),m=!1},d(_){_&&($(r),$(i)),B(e,_),B(o,_),B(a,_)}}}function Tr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=R(e)},l(r){n=H(r,e)},m(r,o){w(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&de(n,e)},d(r){r&&$(n)}}}function qr(t){let e,n;return e=new zt({props:{$$slots:{default:[Tr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function Br(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=R(e)},l(r){n=H(r,e)},m(r,o){w(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&de(n,e)},d(r){r&&$(n)}}}function Or(t){let e,n;return e=new zt({props:{$$slots:{default:[Br,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function Nr(t){let e,n,r,o,l,i;return e=new xe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":dt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[qr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new xe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":dt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Or]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new qn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N(),F(l.$$.fragment)},l(a){T(e.$$.fragment,a),n=G(a),T(r.$$.fragment,a),o=G(a),T(l.$$.fragment,a)},m(a,s){q(e,a,s),w(a,n,s),q(r,a,s),w(a,o,s),q(l,a,s),i=!0},p(a,s){const m={};s[1]&256&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const c={};s[1]&256&&(c.$$scope={dirty:s,ctx:a}),r.$set(c)},i(a){i||(y(e.$$.fragment,a),y(r.$$.fragment,a),y(l.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),k(r.$$.fragment,a),k(l.$$.fragment,a),i=!1},d(a){a&&($(n),$(o)),B(e,a),B(r,a),B(l,a)}}}function Gr(t){let e,n,r,o;return e=new xe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new vn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment)},l(l){T(e.$$.fragment,l),n=G(l),T(r.$$.fragment,l)},m(l,i){q(e,l,i),w(l,n,i),q(r,l,i),o=!0},p:Ae,i(l){o||(y(e.$$.fragment,l),y(r.$$.fragment,l),o=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),o=!1},d(l){l&&$(n),B(e,l),B(r,l)}}}function Dr(t){let e,n,r,o,l,i,a,s,m,c,p,f;e=new wn({}),e.$on("click",t[8]),r=new bn({props:{gj:t[3].summary.networkMap,show:t[2]}});let E=pe(t[3].jat[t[0]][t[1]].arms),j=[];for(let u=0;u<E.length;u+=1)j[u]=yt(vt(t,E,u));const I=u=>k(j[u],1,1,()=>{j[u]=null});let D=pe(t[3].jat[t[0]][t[1]].movements),C=[];for(let u=0;u<D.length;u+=1)C[u]=wt(bt(t,D,u));const d=u=>k(C[u],1,1,()=>{C[u]=null});return a=new pt({props:{data:t[10](t[3]),$$slots:{default:[Nr]},$$scope:{ctx:t}}}),m=new pt({props:{data:t[5],$$slots:{default:[Gr]},$$scope:{ctx:t}}}),p=new kn({props:{map:t[4]}}),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N();for(let u=0;u<j.length;u+=1)j[u].c();l=N();for(let u=0;u<C.length;u+=1)C[u].c();i=N(),F(a.$$.fragment),s=N(),F(m.$$.fragment),c=N(),F(p.$$.fragment)},l(u){T(e.$$.fragment,u),n=G(u),T(r.$$.fragment,u),o=G(u);for(let h=0;h<j.length;h+=1)j[h].l(u);l=G(u);for(let h=0;h<C.length;h+=1)C[h].l(u);i=G(u),T(a.$$.fragment,u),s=G(u),T(m.$$.fragment,u),c=G(u),T(p.$$.fragment,u)},m(u,h){q(e,u,h),w(u,n,h),q(r,u,h),w(u,o,h);for(let b=0;b<j.length;b+=1)j[b]&&j[b].m(u,h);w(u,l,h);for(let b=0;b<C.length;b+=1)C[b]&&C[b].m(u,h);w(u,i,h),q(a,u,h),w(u,s,h),q(m,u,h),w(u,c,h),q(p,u,h),f=!0},p(u,h){const b={};if(h[0]&8&&(b.gj=u[3].summary.networkMap),h[0]&4&&(b.show=u[2]),r.$set(b),h[0]&139){E=pe(u[3].jat[u[0]][u[1]].arms);let A;for(A=0;A<E.length;A+=1){const U=vt(u,E,A);j[A]?(j[A].p(U,h),y(j[A],1)):(j[A]=yt(U),j[A].c(),y(j[A],1),j[A].m(l.parentNode,l))}for(me(),A=E.length;A<j.length;A+=1)I(A);ce()}if(h[0]&203){D=pe(u[3].jat[u[0]][u[1]].movements);let A;for(A=0;A<D.length;A+=1){const U=bt(u,D,A);C[A]?(C[A].p(U,h),y(C[A],1)):(C[A]=wt(U),C[A].c(),y(C[A],1),C[A].m(i.parentNode,i))}for(me(),A=D.length;A<C.length;A+=1)d(A);ce()}const _={};h[0]&8&&(_.data=u[10](u[3])),h[1]&256&&(_.$$scope={dirty:h,ctx:u}),a.$set(_);const L={};h[0]&32&&(L.data=u[5]),h[1]&256&&(L.$$scope={dirty:h,ctx:u}),m.$set(L);const V={};h[0]&16&&(V.map=u[4]),p.$set(V)},i(u){if(!f){y(e.$$.fragment,u),y(r.$$.fragment,u);for(let h=0;h<E.length;h+=1)y(j[h]);for(let h=0;h<D.length;h+=1)y(C[h]);y(a.$$.fragment,u),y(m.$$.fragment,u),y(p.$$.fragment,u),f=!0}},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),j=j.filter(Boolean);for(let h=0;h<j.length;h+=1)k(j[h]);C=C.filter(Boolean);for(let h=0;h<C.length;h+=1)k(C[h]);k(a.$$.fragment,u),k(m.$$.fragment,u),k(p.$$.fragment,u),f=!1},d(u){u&&($(n),$(o),$(l),$(i),$(s),$(c)),B(e,u),B(r,u),Ge(j,u),Ge(C,u),B(a,u),B(m,u),B(p,u)}}}function zr(t){let e,n,r;function o(i){t[29](i)}let l={$$slots:{default:[Dr]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.map=t[4]),e=new hn({props:l}),re.push(()=>ie(e,"map",o)),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,a){const s={};a[0]&63|a[1]&256&&(s.$$scope={dirty:a,ctx:i}),!n&&a[0]&16&&(n=!0,s.map=i[4],oe(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function kt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function Ur(t){return String.fromCharCode(t+65)}function Rr(t,e,n){let r,o;Je(t,Z,v=>n(3,o=v));let{junctionIdx:l}=e,{stage:i}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:m}=e,{streetviewOn:c}=e,{showContext:p}=e,f,E={0:$e.red.background,1:$e.amber.background,2:$e.green.background,X:$e.critical.background};function j(v,S,ae){let W={type:"FeatureCollection",features:[]},g=S??ae;return g!=null&&(g.kind=="arm"?W.features.push(kt(v.jat[l][i].arms[g.idx],g.idx)):W.features.push(u(v.jat[l][i].movements[g.idx],g.idx))),W}function I(v){n(11,s=v),n(12,m=null)}function D(v){if(!c){for(let S of f.queryRenderedFeatures(v.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(11,s=null);return}a=="arm"?(Ne(Z,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:v.detail.lngLat.toArray(),name:""}],o),n(11,s={kind:"arm",idx:o.jat[l][i].arms.length-1})):(Ne(Z,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:v.detail.lngLat.toArray(),point2:ht(v.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:ht(v.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),n(11,s={kind:"movement",idx:o.jat[l][i].movements.length-1})),n(12,m=null)}}function C(v){I({kind:"movement",idx:v.detail.features[0].id})}un(()=>{b(!1)});function d(v){let S={type:"FeatureCollection",features:v.jat[l][i].movements.map((ae,W)=>u(ae,W))};for(let ae of v.jat[l][i].movements)if(S.features.push(h(ae,S.features.length)),ae.kind=="walking & wheeling"){let W={...ae,point1:ae.point3,point3:ae.point1};S.features.push(h(W,S.features.length))}return S}function u(v,S){return{type:"Feature",id:S,properties:{name:v.name,kind:v.kind,color:E[v.score]},geometry:{type:"LineString",coordinates:[v.point1,v.point2,v.point3]}}}function h(v,S){return{type:"Feature",id:S,properties:{kind:v.kind,color:E[v.score],angle:Ar(v.point2,v.point3)},geometry:{type:"Point",coordinates:v.point3}}}function b(v){let S=d(o);for(let ae of o.jat[l][i].arms)S.features.push(kt(ae,S.features.length));for(let ae of o.summary.networkMap.features)S.features.push(ae);S.features.length>0&&f.fitBounds($n(S),{padding:20,animate:v})}function _(){return f}function L(v,S){t.$$.not_equal(S.point,v)&&(S.point=v,Z.set(o))}const V=v=>I({kind:"arm",idx:v}),A=v=>I({kind:"arm",idx:v});function U(v,S){t.$$.not_equal(S.point1,v)&&(S.point1=v,Z.set(o))}const he=v=>I({kind:"movement",idx:v}),M=v=>I({kind:"movement",idx:v});function le(v,S){t.$$.not_equal(S.point2,v)&&(S.point2=v,Z.set(o))}const Ie=v=>I({kind:"movement",idx:v}),Ce=v=>I({kind:"movement",idx:v});function ge(v,S){t.$$.not_equal(S.point3,v)&&(S.point3=v,Z.set(o))}const X=v=>I({kind:"movement",idx:v}),O=v=>I({kind:"movement",idx:v});function x(v){f=v,n(4,f)}return t.$$set=v=>{"junctionIdx"in v&&n(0,l=v.junctionIdx),"stage"in v&&n(1,i=v.stage),"newKind"in v&&n(13,a=v.newKind),"editing"in v&&n(11,s=v.editing),"hoveringSidebar"in v&&n(12,m=v.hoveringSidebar),"streetviewOn"in v&&n(14,c=v.streetviewOn),"showContext"in v&&n(2,p=v.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=j(o,s,m))},[l,i,p,o,f,r,E,I,D,C,d,s,m,a,c,b,_,L,V,A,U,he,M,le,Ie,Ce,ge,X,O,x]}class Hr extends Me{constructor(e){super(),Se(this,e,Rr,zr,Ee,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Jr(t){let e,n,r,o,l,i,a,s,m,c,p,f;function E(b){t[5](b)}let j={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(j.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new rt({props:j}),re.push(()=>ie(e,"value",E));function I(b){t[6](b)}let D={legend:"Movement",choices:Ht(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(D.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new Ut({props:D}),re.push(()=>ie(o,"value",I));function C(b){t[7](b)}let d={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(d.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new Pn({props:d}),re.push(()=>ie(a,"value",C));function u(b){t[8](b)}let h={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(h.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),c=new Rt({props:h}),re.push(()=>ie(c,"value",u)),{c(){F(e.$$.fragment),r=N(),F(o.$$.fragment),i=N(),F(a.$$.fragment),m=N(),F(c.$$.fragment)},l(b){T(e.$$.fragment,b),r=G(b),T(o.$$.fragment,b),i=G(b),T(a.$$.fragment,b),m=G(b),T(c.$$.fragment,b)},m(b,_){q(e,b,_),w(b,r,_),q(o,b,_),w(b,i,_),q(a,b,_),w(b,m,_),q(c,b,_),f=!0},p(b,[_]){const L={};!n&&_&15&&(n=!0,L.value=b[3].jat[b[0]][b[1]].movements[b[2]].name,oe(()=>n=!1)),e.$set(L);const V={};!l&&_&15&&(l=!0,V.value=b[3].jat[b[0]][b[1]].movements[b[2]].kind,oe(()=>l=!1)),o.$set(V);const A={};!s&&_&15&&(s=!0,A.value=b[3].jat[b[0]][b[1]].movements[b[2]].score,oe(()=>s=!1)),a.$set(A);const U={};!p&&_&15&&(p=!0,U.value=b[3].jat[b[0]][b[1]].movements[b[2]].notes,oe(()=>p=!1)),c.$set(U)},i(b){f||(y(e.$$.fragment,b),y(o.$$.fragment,b),y(a.$$.fragment,b),y(c.$$.fragment,b),f=!0)},o(b){k(e.$$.fragment,b),k(o.$$.fragment,b),k(a.$$.fragment,b),k(c.$$.fragment,b),f=!1},d(b){b&&($(r),$(i),$(m)),B(e,b),B(o,b),B(a,b),B(c,b)}}}function Kr(t,e,n){let r;Je(t,Z,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e;Ht(["cycling","walking & wheeling"]);let a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(f){t.$$.not_equal(r.jat[o][l].movements[i].name,f)&&(r.jat[o][l].movements[i].name=f,Z.set(r))}function m(f){t.$$.not_equal(r.jat[o][l].movements[i].kind,f)&&(r.jat[o][l].movements[i].kind=f,Z.set(r))}function c(f){t.$$.not_equal(r.jat[o][l].movements[i].score,f)&&(r.jat[o][l].movements[i].score=f,Z.set(r))}function p(f){t.$$.not_equal(r.jat[o][l].movements[i].notes,f)&&(r.jat[o][l].movements[i].notes=f,Z.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,l=f.stage),"idx"in f&&n(2,i=f.idx)},[o,l,i,r,a,s,m,c,p]}class Vr extends Me{constructor(e){super(),Se(this,e,Kr,Jr,Ee,{junctionIdx:0,stage:1,idx:2})}}const{window:Xr}=yn;function jt(t,e,n){const r=t.slice();return r[31]=e[n],r[33]=n,r}function Et(t,e,n){const r=t.slice();return r[34]=e[n],r[33]=n,r}function Wr(t){let e,n,r,o,l,i,a,s;e=new Nt({props:{$$slots:{default:[Qr]},$$scope:{ctx:t}}}),e.$on("click",t[27]),r=new Gt({props:{$$slots:{default:[Yr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const m=[eo,xr],c=[];function p(f,E){return f[3].kind=="movement"?0:1}return l=p(t),i=c[l]=m[l](t),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N(),i.c(),a=be()},l(f){T(e.$$.fragment,f),n=G(f),T(r.$$.fragment,f),o=G(f),i.l(f),a=be()},m(f,E){q(e,f,E),w(f,n,E),q(r,f,E),w(f,o,E),c[l].m(f,E),w(f,a,E),s=!0},p(f,E){const j={};E[1]&32&&(j.$$scope={dirty:E,ctx:f}),e.$set(j);const I={};E[1]&32&&(I.$$scope={dirty:E,ctx:f}),r.$set(I);let D=l;l=p(f),l===D?c[l].p(f,E):(me(),k(c[D],1,1,()=>{c[D]=null}),ce(),i=c[l],i?i.p(f,E):(i=c[l]=m[l](f),i.c()),y(i,1),i.m(a.parentNode,a))},i(f){s||(y(e.$$.fragment,f),y(r.$$.fragment,f),y(i),s=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(i),s=!1},d(f){f&&($(n),$(o),$(a)),B(e,f),B(r,f),c[l].d(f)}}}function Zr(t){let e,n,r,o,l,i,a,s=(t[8].jat[t[0]].name||"Untitled junction")+"",m,c,p,f,E,j,I,D="Arms",C,d,u,h,b,_="Movements",L,V,A,U;e=new gn({props:{label:"Tools",$$slots:{default:[ro]},$$scope:{ctx:t}}});function he(g,P){return g[8].jat[g[0]][g[1]].movements.length>0?io:oo}let M=he(t),le=M(t);function Ie(g){t[20](g)}let Ce={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(Ce.value=t[2]),f=new Ut({props:Ce}),re.push(()=>ie(f,"value",Ie));let ge=pe(t[8].jat[t[0]][t[1]].arms),X=[];for(let g=0;g<ge.length;g+=1)X[g]=Ct(Et(t,ge,g));const O=g=>k(X[g],1,1,()=>{X[g]=null});let x=t[8].jat[t[0]][t[9]].arms.length>0&&Lt(t),v=pe(t[8].jat[t[0]][t[1]].movements),S=[];for(let g=0;g<v.length;g+=1)S[g]=Pt(jt(t,v,g));const ae=g=>k(S[g],1,1,()=>{S[g]=null});let W=t[8].jat[t[0]][t[9]].movements.length>0&&At(t);return{c(){F(e.$$.fragment),n=N(),r=Q("p"),o=R("Total JAT score for "),l=R(t[1]),i=N(),a=Q("u"),m=R(s),c=R(`
        :
        `),le.c(),p=N(),F(f.$$.fragment),j=N(),I=Q("h3"),I.textContent=D,C=N(),d=Q("ul");for(let g=0;g<X.length;g+=1)X[g].c();u=N(),x&&x.c(),h=N(),b=Q("h3"),b.textContent=_,L=N();for(let g=0;g<S.length;g+=1)S[g].c();V=N(),W&&W.c(),A=be()},l(g){T(e.$$.fragment,g),n=G(g),r=Y(g,"P",{});var P=ne(r);o=H(P,"Total JAT score for "),l=H(P,t[1]),i=G(P),a=Y(P,"U",{});var se=ne(a);m=H(se,s),se.forEach($),c=H(P,`
        :
        `),le.l(P),P.forEach($),p=G(g),T(f.$$.fragment,g),j=G(g),I=Y(g,"H3",{"data-svelte-h":!0}),Ye(I)!=="svelte-ld74qb"&&(I.textContent=D),C=G(g),d=Y(g,"UL",{});var Fe=ne(d);for(let z=0;z<X.length;z+=1)X[z].l(Fe);Fe.forEach($),u=G(g),x&&x.l(g),h=G(g),b=Y(g,"H3",{"data-svelte-h":!0}),Ye(b)!=="svelte-1dc52s8"&&(b.textContent=_),L=G(g);for(let z=0;z<S.length;z+=1)S[z].l(g);V=G(g),W&&W.l(g),A=be()},m(g,P){q(e,g,P),w(g,n,P),w(g,r,P),te(r,o),te(r,l),te(r,i),te(r,a),te(a,m),te(r,c),le.m(r,null),w(g,p,P),q(f,g,P),w(g,j,P),w(g,I,P),w(g,C,P),w(g,d,P);for(let se=0;se<X.length;se+=1)X[se]&&X[se].m(d,null);w(g,u,P),x&&x.m(g,P),w(g,h,P),w(g,b,P),w(g,L,P);for(let se=0;se<S.length;se+=1)S[se]&&S[se].m(g,P);w(g,V,P),W&&W.m(g,P),w(g,A,P),U=!0},p(g,P){const se={};P[0]&224|P[1]&32&&(se.$$scope={dirty:P,ctx:g}),e.$set(se),(!U||P[0]&2)&&de(l,g[1]),(!U||P[0]&257)&&s!==(s=(g[8].jat[g[0]].name||"Untitled junction")+"")&&de(m,s),M===(M=he(g))&&le?le.p(g,P):(le.d(1),le=M(g),le&&(le.c(),le.m(r,null)));const Fe={};if(!E&&P[0]&4&&(E=!0,Fe.value=g[2],oe(()=>E=!1)),f.$set(Fe),P[0]&1299){ge=pe(g[8].jat[g[0]][g[1]].arms);let z;for(z=0;z<ge.length;z+=1){const Te=Et(g,ge,z);X[z]?(X[z].p(Te,P),y(X[z],1)):(X[z]=Ct(Te),X[z].c(),y(X[z],1),X[z].m(d,null))}for(me(),z=ge.length;z<X.length;z+=1)O(z);ce()}if(g[8].jat[g[0]][g[9]].arms.length>0?x?(x.p(g,P),P[0]&257&&y(x,1)):(x=Lt(g),x.c(),y(x,1),x.m(h.parentNode,h)):x&&(me(),k(x,1,1,()=>{x=null}),ce()),P[0]&34067){v=pe(g[8].jat[g[0]][g[1]].movements);let z;for(z=0;z<v.length;z+=1){const Te=jt(g,v,z);S[z]?(S[z].p(Te,P),y(S[z],1)):(S[z]=Pt(Te),S[z].c(),y(S[z],1),S[z].m(V.parentNode,V))}for(me(),z=v.length;z<S.length;z+=1)ae(z);ce()}g[8].jat[g[0]][g[9]].movements.length>0?W?(W.p(g,P),P[0]&257&&y(W,1)):(W=At(g),W.c(),y(W,1),W.m(A.parentNode,A)):W&&(me(),k(W,1,1,()=>{W=null}),ce())},i(g){if(!U){y(e.$$.fragment,g),y(f.$$.fragment,g);for(let P=0;P<ge.length;P+=1)y(X[P]);y(x);for(let P=0;P<v.length;P+=1)y(S[P]);y(W),U=!0}},o(g){k(e.$$.fragment,g),k(f.$$.fragment,g),X=X.filter(Boolean);for(let P=0;P<X.length;P+=1)k(X[P]);k(x),S=S.filter(Boolean);for(let P=0;P<S.length;P+=1)k(S[P]);k(W),U=!1},d(g){g&&($(n),$(r),$(p),$(j),$(I),$(C),$(d),$(u),$(h),$(b),$(L),$(V),$(A)),B(e,g),le.d(),B(f,g),Ge(X,g),x&&x.d(g),Ge(S,g),W&&W.d(g)}}}function Qr(t){let e;return{c(){e=R("Save")},l(n){e=H(n,"Save")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function Yr(t){let e;return{c(){e=R("Delete")},l(n){e=H(n,"Delete")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function xr(t){let e,n,r;function o(i){t[28](i)}let l={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new rt({props:l}),re.push(()=>ie(e,"value",o)),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&267&&(n=!0,s.value=i[8].jat[i[0]][i[1]].arms[i[3].idx].name,oe(()=>n=!1)),e.$set(s)},i(i){r||(y(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){B(e,i)}}}function eo(t){let e,n;return e=new Vr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function to(t){let e;return{c(){e=R("Zoom to fit")},l(n){e=H(n,"Zoom to fit")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function no(t){let e;return{c(){e=R("Show scheme context")},l(n){e=H(n,"Show scheme context")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function ro(t){var C;let e,n,r,o,l,i,a,s,m,c,p,f;e=new ve({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),e.$on("click",t[17]),r=new jn({}),l=new En({});function E(d){t[18](d)}let j={map:(C=t[7])==null?void 0:C.getMap()};t[5]!==void 0&&(j.enabled=t[5]),a=new Cn({props:j}),re.push(()=>ie(a,"enabled",E));function I(d){t[19](d)}let D={$$slots:{default:[no]},$$scope:{ctx:t}};return t[6]!==void 0&&(D.checked=t[6]),c=new Ln({props:D}),re.push(()=>ie(c,"checked",I)),{c(){F(e.$$.fragment),n=N(),F(r.$$.fragment),o=N(),F(l.$$.fragment),i=N(),F(a.$$.fragment),m=N(),F(c.$$.fragment)},l(d){T(e.$$.fragment,d),n=G(d),T(r.$$.fragment,d),o=G(d),T(l.$$.fragment,d),i=G(d),T(a.$$.fragment,d),m=G(d),T(c.$$.fragment,d)},m(d,u){q(e,d,u),w(d,n,u),q(r,d,u),w(d,o,u),q(l,d,u),w(d,i,u),q(a,d,u),w(d,m,u),q(c,d,u),f=!0},p(d,u){var L;const h={};u[1]&32&&(h.$$scope={dirty:u,ctx:d}),e.$set(h);const b={};u[0]&128&&(b.map=(L=d[7])==null?void 0:L.getMap()),!s&&u[0]&32&&(s=!0,b.enabled=d[5],oe(()=>s=!1)),a.$set(b);const _={};u[1]&32&&(_.$$scope={dirty:u,ctx:d}),!p&&u[0]&64&&(p=!0,_.checked=d[6],oe(()=>p=!1)),c.$set(_)},i(d){f||(y(e.$$.fragment,d),y(r.$$.fragment,d),y(l.$$.fragment,d),y(a.$$.fragment,d),y(c.$$.fragment,d),f=!0)},o(d){k(e.$$.fragment,d),k(r.$$.fragment,d),k(l.$$.fragment,d),k(a.$$.fragment,d),k(c.$$.fragment,d),f=!1},d(d){d&&($(n),$(o),$(i),$(m)),B(e,d),B(r,d),B(l,d),B(a,d),B(c,d)}}}function oo(t){let e;return{c(){e=R("No movements added")},l(n){e=H(n,"No movements added")},m(n,r){w(n,e,r)},p:Ae,d(n){n&&$(e)}}}function io(t){let e=Math.round(Mt(t[8].jat[t[0]][t[1]]))+"",n,r;return{c(){n=R(e),r=R("%")},l(o){n=H(o,e),r=H(o,"%")},m(o,l){w(o,n,l),w(o,r,l)},p(o,l){l[0]&259&&e!==(e=Math.round(Mt(o[8].jat[o[0]][o[1]]))+"")&&de(n,e)},d(o){o&&($(n),$(r))}}}function lo(t){let e=mo(t[33])+"",n,r,o=(t[34].name||"Unnamed arm")+"",l;return{c(){n=R(e),r=R(" - "),l=R(o)},l(i){n=H(i,e),r=H(i," - "),l=H(i,o)},m(i,a){w(i,n,a),w(i,r,a),w(i,l,a)},p(i,a){a[0]&259&&o!==(o=(i[34].name||"Unnamed arm")+"")&&de(l,o)},d(i){i&&($(n),$(r),$(l))}}}function Ct(t){let e,n,r,o;function l(){return t[21](t[33])}function i(){return t[22](t[33])}return n=new ve({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[23]),{c(){e=Q("li"),F(n.$$.fragment),r=N()},l(a){e=Y(a,"LI",{});var s=ne(e);T(n.$$.fragment,s),r=G(s),s.forEach($)},m(a,s){w(a,e,s),q(n,e,null),te(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&32&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(y(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&$(e),B(n)}}}function Lt(t){let e,n;return e=new ve({props:{$$slots:{default:[ao]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&32&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function ao(t){let e,n;return{c(){e=R("Copy arms from "),n=R(t[9])},l(r){e=H(r,"Copy arms from "),n=H(r,t[9])},m(r,o){w(r,e,o),w(r,n,o)},p:Ae,d(r){r&&($(e),$(n))}}}function so(t){let e,n,r=t[33]+1+"",o,l,i=(t[31].name||"Unnamed movement")+"",a,s,m,c=">",p,f,E,j,I,D=t[15](t[31])+"";return{c(){e=Q("div"),n=Q("b"),o=R(r),l=R(". "),a=R(i),s=N(),m=Q("span"),m.textContent=c,p=N(),f=Q("hr"),E=N(),j=Q("div"),I=new fn(!1),this.h()},l(C){e=Y(C,"DIV",{style:!0});var d=ne(e);n=Y(d,"B",{});var u=ne(n);o=H(u,r),l=H(u,". "),a=H(u,i),u.forEach($),s=G(d),m=Y(d,"SPAN",{"data-svelte-h":!0}),Ye(m)!=="svelte-x0xyl0"&&(m.textContent=c),d.forEach($),p=G(C),f=Y(C,"HR",{}),E=G(C),j=Y(C,"DIV",{});var h=ne(j);I=mn(h,!1),h.forEach($),this.h()},h(){ee(e,"display","flex"),ee(e,"justify-content","space-between"),I.a=null},m(C,d){w(C,e,d),te(e,n),te(n,o),te(n,l),te(n,a),te(e,s),te(e,m),w(C,p,d),w(C,f,d),w(C,E,d),w(C,j,d),I.m(D,j)},p(C,d){d[0]&259&&i!==(i=(C[31].name||"Unnamed movement")+"")&&de(a,i),d[0]&259&&D!==(D=C[15](C[31])+"")&&I.p(D)},d(C){C&&($(e),$(p),$(f),$(E),$(j))}}}function Pt(t){let e,n,r;function o(){return t[24](t[33])}function l(){return t[25](t[33])}return n=new Sn({props:{$$slots:{default:[so]},$$scope:{ctx:t}}}),n.$on("click",o),n.$on("mouseenter",l),n.$on("mouseleave",t[26]),{c(){e=Q("li"),F(n.$$.fragment)},l(i){e=Y(i,"LI",{});var a=ne(e);T(n.$$.fragment,a),a.forEach($)},m(i,a){w(i,e,a),q(n,e,null),r=!0},p(i,a){t=i;const s={};a[0]&259|a[1]&32&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){r||(y(n.$$.fragment,i),r=!0)},o(i){k(n.$$.fragment,i),r=!1},d(i){i&&$(e),B(n)}}}function At(t){let e,n;return e=new ve({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&32&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function uo(t){let e,n;return{c(){e=R("Copy movements from "),n=R(t[9])},l(r){e=H(r,"Copy movements from "),n=H(r,t[9])},m(r,o){w(r,e,o),w(r,n,o)},p:Ae,d(r){r&&($(e),$(n))}}}function fo(t){let e,n,r,o,l,i,a,s,m,c,p,f,E,j;function I(_){t[16](_)}let D={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(D.value=t[8].jat[t[0]][t[1]].notes),e=new Rt({props:D}),re.push(()=>ie(e,"value",I));const C=[Zr,Wr],d=[];function u(_,L){return _[3]==null?0:1}i=u(t),a=d[i]=C[i](t);function h(_){t[30](_)}let b={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(b.editing=t[3]),c=new Hr({props:b}),t[29](c),re.push(()=>ie(c,"editing",h)),{c(){F(e.$$.fragment),r=N(),o=Q("div"),l=Q("div"),a.c(),s=N(),m=Q("div"),F(c.$$.fragment),this.h()},l(_){T(e.$$.fragment,_),r=G(_),o=Y(_,"DIV",{style:!0});var L=ne(o);l=Y(L,"DIV",{style:!0});var V=ne(l);a.l(V),V.forEach($),s=G(L),m=Y(L,"DIV",{style:!0});var A=ne(m);T(c.$$.fragment,A),A.forEach($),L.forEach($),this.h()},h(){ee(l,"width","30%"),ee(l,"overflow-y","scroll"),ee(l,"padding","10px"),ee(l,"border","1px solid black"),ee(m,"position","relative"),ee(m,"width","100%"),ee(o,"display","flex"),ee(o,"height","80vh")},m(_,L){q(e,_,L),w(_,r,L),w(_,o,L),te(o,l),d[i].m(l,null),te(o,s),te(o,m),q(c,m,null),f=!0,E||(j=ze(Xr,"keydown",t[12]),E=!0)},p(_,L){const V={};!n&&L[0]&259&&(n=!0,V.value=_[8].jat[_[0]][_[1]].notes,oe(()=>n=!1)),e.$set(V);let A=i;i=u(_),i===A?d[i].p(_,L):(me(),k(d[A],1,1,()=>{d[A]=null}),ce(),a=d[i],a?a.p(_,L):(a=d[i]=C[i](_),a.c()),y(a,1),a.m(l,null));const U={};L[0]&1&&(U.junctionIdx=_[0]),L[0]&2&&(U.stage=_[1]),L[0]&4&&(U.newKind=_[2]),L[0]&16&&(U.hoveringSidebar=_[4]),L[0]&32&&(U.streetviewOn=_[5]),L[0]&64&&(U.showContext=_[6]),!p&&L[0]&8&&(p=!0,U.editing=_[3],oe(()=>p=!1)),c.$set(U)},i(_){f||(y(e.$$.fragment,_),y(a),y(c.$$.fragment,_),f=!0)},o(_){k(e.$$.fragment,_),k(a),k(c.$$.fragment,_),f=!1},d(_){_&&($(r),$(o)),B(e,_),d[i].d(),t[29](null),B(c),E=!1,j()}}}function mo(t){return String.fromCharCode(t+65)}function Mt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function co(t,e,n){let r;Je(t,Z,O=>n(8,r=O));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",a="arm",s=null,m=null,c=!1,p=!0,f=null;function E(O){n(3,s=O),n(4,m=null)}function j(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][l].movements.splice(s.idx,1),Z.set(r)):(r.jat[o][l].arms.splice(s.idx,1),Z.set(r)),n(3,s=null))}function I(O){s!=null&&O.key=="Escape"?(O.stopPropagation(),n(3,s=null)):s!=null&&O.key=="Delete"&&j()}function D(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(Ne(Z,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),Z.set(r))}function C(){r.jat[o][l].movements.length>0&&!window.confirm("Overwrite movements?")||(Ne(Z,r.jat[o][l].movements=JSON.parse(JSON.stringify(r.jat[o][i].movements)),r),Z.set(r))}function d(O){return`<span style="color: ${{0:$e.red.background,1:$e.amber.background,2:$e.green.background,X:$e.critical.background}[O.score]}">score ${O.score}</span>`}function u(O){t.$$.not_equal(r.jat[o][l].notes,O)&&(r.jat[o][l].notes=O,Z.set(r))}const h=()=>f==null?void 0:f.zoom(!0);function b(O){c=O,n(5,c)}function _(O){p=O,n(6,p)}function L(O){a=O,n(2,a)}const V=O=>E({kind:"arm",idx:O}),A=O=>n(4,m={kind:"arm",idx:O}),U=()=>n(4,m=null),he=O=>E({kind:"movement",idx:O}),M=O=>n(4,m={kind:"movement",idx:O}),le=()=>n(4,m=null),Ie=()=>n(3,s=null);function Ce(O){t.$$.not_equal(r.jat[o][l].arms[s.idx].name,O)&&(r.jat[o][l].arms[s.idx].name=O,Z.set(r))}function ge(O){re[O?"unshift":"push"](()=>{f=O,n(7,f)})}function X(O){s=O,n(3,s)}return t.$$set=O=>{"junctionIdx"in O&&n(0,o=O.junctionIdx),"stage"in O&&n(1,l=O.stage)},[o,l,a,s,m,c,p,f,r,i,E,j,I,D,C,d,u,h,b,_,L,V,A,U,he,M,le,Ie,Ce,ge,X]}class go extends Me{constructor(e){super(),Se(this,e,co,fo,Ee,{junctionIdx:0,stage:1},null,[-1,-1])}}function St(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function po(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,c,p,f,E=t[0].stage,j,I;s=new cn({props:{$$slots:{default:[ko]},$$scope:{ctx:t}}});function D(u){t[9](u)}let C={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(C.value=t[1].jat[t[0].idx].name),c=new rt({props:C}),re.push(()=>ie(c,"value",D));let d=It(t);return{c(){e=Q("h2"),r=R(n),o=R(" - "),i=R(l),a=N(),F(s.$$.fragment),m=N(),F(c.$$.fragment),f=N(),d.c(),j=be()},l(u){e=Y(u,"H2",{});var h=ne(e);r=H(h,n),o=H(h," - "),i=H(h,l),h.forEach($),a=G(u),T(s.$$.fragment,u),m=G(u),T(c.$$.fragment,u),f=G(u),d.l(u),j=be()},m(u,h){w(u,e,h),te(e,r),te(e,o),te(e,i),w(u,a,h),q(s,u,h),w(u,m,h),q(c,u,h),w(u,f,h),d.m(u,h),w(u,j,h),I=!0},p(u,h){(!I||h&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&de(r,n),(!I||h&1)&&l!==(l=u[0].stage+"")&&de(i,l);const b={};h&8193&&(b.$$scope={dirty:h,ctx:u}),s.$set(b);const _={};!p&&h&3&&(p=!0,_.value=u[1].jat[u[0].idx].name,oe(()=>p=!1)),c.$set(_),h&1&&Ee(E,E=u[0].stage)?(me(),k(d,1,1,Ae),ce(),d=It(u),d.c(),y(d,1),d.m(j.parentNode,j)):d.p(u,h)},i(u){I||(y(s.$$.fragment,u),y(c.$$.fragment,u),y(d),I=!0)},o(u){k(s.$$.fragment,u),k(c.$$.fragment,u),k(d),I=!1},d(u){u&&($(e),$(a),$(m),$(f),$(j)),B(s,u),B(c,u),d.d(u)}}}function _o(t){let e,n,r,o;e=new Nt({props:{$$slots:{default:[jo]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=pe(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Ft(St(t,l,s));const a=s=>k(i[s],1,1,()=>{i[s]=null});return{c(){F(e.$$.fragment),n=N(),r=Q("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){T(e.$$.fragment,s),n=G(s),r=Y(s,"OL",{});var m=ne(r);for(let c=0;c<i.length;c+=1)i[c].l(m);m.forEach($)},m(s,m){q(e,s,m),w(s,n,m),w(s,r,m);for(let c=0;c<i.length;c+=1)i[c]&&i[c].m(r,null);o=!0},p(s,m){const c={};if(m&8192&&(c.$$scope={dirty:m,ctx:s}),e.$set(c),m&3){l=pe(s[1].jat);let p;for(p=0;p<l.length;p+=1){const f=St(s,l,p);i[p]?(i[p].p(f,m),y(i[p],1)):(i[p]=Ft(f),i[p].c(),y(i[p],1),i[p].m(r,null))}for(me(),p=l.length;p<i.length;p+=1)a(p);ce()}},i(s){if(!o){y(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)y(i[m]);o=!0}},o(s){k(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)k(i[m]);o=!1},d(s){s&&($(n),$(r)),B(e,s),Ge(i,s)}}}function ho(t){let e;return{c(){e=R("Back to all junctions")},l(n){e=H(n,"Back to all junctions")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function $o(t){let e,n;return e=new ve({props:{$$slots:{default:[vo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function bo(t){let e,n;return e=new ve({props:{$$slots:{default:[yo]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function vo(t){let e;return{c(){e=R("Edit Proposed")},l(n){e=H(n,"Edit Proposed")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function yo(t){let e;return{c(){e=R("Edit Existing")},l(n){e=H(n,"Edit Existing")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function wo(t){let e;return{c(){e=R("Delete")},l(n){e=H(n,"Delete")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function ko(t){let e,n,r,o,l,i,a;e=new ve({props:{$$slots:{default:[ho]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const s=[bo,$o],m=[];function c(p,f){return p[0].stage=="proposed"?0:1}return r=c(t),o=m[r]=s[r](t),i=new Gt({props:{$$slots:{default:[wo]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){F(e.$$.fragment),n=N(),o.c(),l=N(),F(i.$$.fragment)},l(p){T(e.$$.fragment,p),n=G(p),o.l(p),l=G(p),T(i.$$.fragment,p)},m(p,f){q(e,p,f),w(p,n,f),m[r].m(p,f),w(p,l,f),q(i,p,f),a=!0},p(p,f){const E={};f&8192&&(E.$$scope={dirty:f,ctx:p}),e.$set(E);let j=r;r=c(p),r===j?m[r].p(p,f):(me(),k(m[j],1,1,()=>{m[j]=null}),ce(),o=m[r],o?o.p(p,f):(o=m[r]=s[r](p),o.c()),y(o,1),o.m(l.parentNode,l));const I={};f&8192&&(I.$$scope={dirty:f,ctx:p}),i.$set(I)},i(p){a||(y(e.$$.fragment,p),y(o),y(i.$$.fragment,p),a=!0)},o(p){k(e.$$.fragment,p),k(o),k(i.$$.fragment,p),a=!1},d(p){p&&($(n),$(l)),B(e,p),m[r].d(p),B(i,p)}}}function It(t){let e,n;return e=new go({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){B(e,r)}}}function jo(t){let e;return{c(){e=R("Add new junction")},l(n){e=H(n,"Add new junction")},m(n,r){w(n,e,r)},d(n){n&&$(e)}}}function Eo(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=R(e)},l(r){n=H(r,e)},m(r,o){w(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&de(n,e)},d(r){r&&$(n)}}}function Ft(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new ve({props:{$$slots:{default:[Eo]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=Q("li"),F(n.$$.fragment),r=N()},l(i){e=Y(i,"LI",{});var a=ne(e);T(n.$$.fragment,a),r=G(a),a.forEach($)},m(i,a){w(i,e,a),q(n,e,null),te(e,r),o=!0},p(i,a){t=i;const s={};a&8194&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(y(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&$(e),B(n)}}}function Co(t){let e,n,r,o;const l=[_o,po],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=be()},l(s){n&&n.l(s),r=be()},m(s,m){~e&&i[e].m(s,m),w(s,r,m),o=!0},p(s,[m]){let c=e;e=a(s),e===c?~e&&i[e].p(s,m):(n&&(me(),k(i[c],1,1,()=>{i[c]=null}),ce()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),y(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(y(n),o=!0)},o(s){k(n),o=!1},d(s){s&&$(r),~e&&i[e].d(s)}}}function Ze(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function Lo(t,e,n){let r;Je(t,Z,E=>n(1,r=E));let o={kind:"list"};function l(){Ne(Z,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(E){window.confirm("Delete this junction?")&&(r.jat.splice(E,1),Z.set(r),n(0,o={kind:"list"}))}const a=E=>n(0,o={kind:"edit",idx:E,stage:"existing"}),s=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"existing"}),c=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"proposed"}),p=()=>i(Ze(o));function f(E){t.$$.not_equal(r.jat[o.idx].name,E)&&(r.jat[o.idx].name=E,Z.set(r))}return[o,r,l,i,a,s,m,c,p,f]}class Ko extends Me{constructor(e){super(),Se(this,e,Lo,Co,Ee,{})}}export{Ko as component};
