import{s as $e,w as Y,x,l as ct,u as _t,r as gt,v as dt,D as pe,k as ye,Q as pt,T as je,a as B,g as D,i as L,f as b,G as Ce,n as he,e as te,t as H,c as ne,b as oe,d as G,p as Ie,q as X,h as Q,j as ce,z as $t,W as ht,E as me,m as De}from"../chunks/scheduler.BwufR8Ly.js";import{S as Le,i as Me,e as ee,c as N,a as A,m as z,t as v,b as w,d as P,g as le,f as re}from"../chunks/index.BYv68wXE.js";import{e as ue}from"../chunks/each.CK1lPdNc.js";import{C as Pe,B as kt}from"../chunks/ClickableCard.5rW6i04y.js";import{D as rt}from"../chunks/DefaultButton.DUjKpF0Y.js";import{S as ke}from"../chunks/SecondaryButton.Bcl2fE5V.js";/* empty css                                                    */import{T as qe}from"../chunks/TextInput.DQAdVYnU.js";import{W as at}from"../chunks/WarningButton.BZEdAdvT.js";import{s as W}from"../chunks/data.BuusIo7N.js";import{L as bt,g as vt,M as wt,b as jt,C as Ct,G as Ue,k as Ee,l as Oe,f as Lt,P as it,e as Mt}from"../chunks/index.C9Qetb6E.js";import{c as Fe}from"../chunks/index.on1mDHXq.js";import{d as ge,l as St,p as yt,a as Ne}from"../chunks/index.DMl_jbcv.js";import{g as Ae}from"../chunks/index.DxJ5FCub.js";import{c as _e}from"../chunks/colors.DaC397qr.js";import{G as It}from"../chunks/GeoreferenceLayer.Chbuiu08.js";import{a as Tt,M as Se,B as Et,G as Nt,S as At,C as zt}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.juuTAKMb.js";import{C as Pt}from"../chunks/CollapsibleCard.CXcgKIt2.js";import{R as ze}from"../chunks/Radio.xwGHvsDf.js";import{T as st}from"../chunks/TextArea.2C2Xc7bA.js";import"../chunks/paths.NAubRItc.js";function qt(n){let e;const o=n[16].default,t=ct(o,n,n[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,r){t&&t.m(l,r),e=!0},p(l,r){t&&t.p&&(!e||r&16777216)&&_t(t,o,l,l[24],e?dt(o,l[24],r,null):gt(l[24]),null)},i(l){e||(v(t,l),e=!0)},o(l){w(t,l),e=!1},d(l){t&&t.d(l)}}}function Bt(n){let e,o,t;function l(a){n[17](a)}let r={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[qt]},$$scope:{ctx:n}};return n[0]!==void 0&&(r.hovered=n[0]),e=new bt({props:r}),Y.push(()=>ee(e,"hovered",l)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){z(e,a,s),t=!0},p(a,[s]){const i={};s&2&&(i.id=a[1]),s&4&&(i.source=a[2]),s&8&&(i.sourceLayer=a[3]),s&16&&(i.beforeId=a[4]),s&32&&(i.beforeLayerType=a[5]),s&64&&(i.paint=a[6]),s&128&&(i.layout=a[7]),s&256&&(i.filter=a[8]),s&512&&(i.applyToClusters=a[9]),s&1024&&(i.minzoom=a[10]),s&2048&&(i.maxzoom=a[11]),s&4096&&(i.hoverCursor=a[12]),s&8192&&(i.manageHoverState=a[13]),s&16384&&(i.eventsIfTopMost=a[14]),s&32768&&(i.interactive=a[15]),s&16777216&&(i.$$scope={dirty:s,ctx:a}),!o&&s&1&&(o=!0,i.hovered=a[0],x(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function Dt(n,e,o){let{$$slots:t={},$$scope:l}=e,{id:r=vt("symbol")}=e,{source:a=void 0}=e,{sourceLayer:s=void 0}=e,{beforeId:i=void 0}=e,{beforeLayerType:_=void 0}=e,{paint:g=void 0}=e,{layout:d=void 0}=e,{filter:u=void 0}=e,{applyToClusters:C=void 0}=e,{minzoom:j=void 0}=e,{maxzoom:q=void 0}=e,{hoverCursor:U=void 0}=e,{manageHoverState:E=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:f=!1}=e,{interactive:$=!0}=e;function k(S){h=S,o(0,h)}function p(S){pe.call(this,n,S)}function y(S){pe.call(this,n,S)}function J(S){pe.call(this,n,S)}function I(S){pe.call(this,n,S)}function F(S){pe.call(this,n,S)}function se(S){pe.call(this,n,S)}return n.$$set=S=>{"id"in S&&o(1,r=S.id),"source"in S&&o(2,a=S.source),"sourceLayer"in S&&o(3,s=S.sourceLayer),"beforeId"in S&&o(4,i=S.beforeId),"beforeLayerType"in S&&o(5,_=S.beforeLayerType),"paint"in S&&o(6,g=S.paint),"layout"in S&&o(7,d=S.layout),"filter"in S&&o(8,u=S.filter),"applyToClusters"in S&&o(9,C=S.applyToClusters),"minzoom"in S&&o(10,j=S.minzoom),"maxzoom"in S&&o(11,q=S.maxzoom),"hoverCursor"in S&&o(12,U=S.hoverCursor),"manageHoverState"in S&&o(13,E=S.manageHoverState),"hovered"in S&&o(0,h=S.hovered),"eventsIfTopMost"in S&&o(14,f=S.eventsIfTopMost),"interactive"in S&&o(15,$=S.interactive),"$$scope"in S&&o(24,l=S.$$scope)},[h,r,a,s,i,_,g,d,u,C,j,q,U,E,f,$,t,k,p,y,J,I,F,se,l]}class Ut extends Le{constructor(e){super(),Me(this,e,Dt,Bt,$e,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var Ot=Object.defineProperty,Ft=(n,e)=>Ot(n,"name",{value:e,configurable:!0});function ft(n,e,o,t={}){const l=Ae(n),r=ge(l[0]),a=ge(l[1]),s=ge(o),i=St(e,t.units),_=Math.asin(Math.sin(a)*Math.cos(i)+Math.cos(a)*Math.sin(i)*Math.cos(s)),g=r+Math.atan2(Math.sin(s)*Math.sin(i)*Math.cos(a),Math.cos(i)-Math.sin(a)*Math.sin(_)),d=Ne(g),u=Ne(_);return yt([d,u],t.properties)}Ft(ft,"destination");var He=ft,Ht=Object.defineProperty,ut=(n,e)=>Ht(n,"name",{value:e,configurable:!0});function Be(n,e,o={}){if(o.final===!0)return mt(n,e);const t=Ae(n),l=Ae(e),r=ge(t[0]),a=ge(l[0]),s=ge(t[1]),i=ge(l[1]),_=Math.sin(a-r)*Math.cos(i),g=Math.cos(s)*Math.sin(i)-Math.sin(s)*Math.cos(i)*Math.cos(a-r);return Ne(Math.atan2(_,g))}ut(Be,"bearing");function mt(n,e){let o=Be(e,n);return o=(o+180)%360,o}ut(mt,"calculateFinalBearing");var Gt=Be;function Ge(n,e,o){const t=n.slice();return t[35]=e[o],t[36]=e,t[37]=o,t}function Je(n,e,o){const t=n.slice();return t[38]=e[o],t[39]=e,t[37]=o,t}function Jt(n){let e,o=nn(n[37])+"",t;return{c(){e=te("span"),t=H(o),this.h()},l(l){e=ne(l,"SPAN",{class:!0});var r=oe(e);t=G(r,o),r.forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"color","#4472c4"),X(e,"background-color","white")},m(l,r){L(l,e,r),Q(e,t)},p:he,d(l){l&&b(e)}}}function Ke(n){let e,o,t;function l(i){n[18](i,n[38])}function r(){return n[19](n[37])}function a(){return n[20](n[37])}let s={draggable:!0,$$slots:{default:[Jt]},$$scope:{ctx:n}};return n[38].point!==void 0&&(s.lngLat=n[38].point),e=new Se({props:s}),Y.push(()=>ee(e,"lngLat",l)),e.$on("dragend",r),e.$on("click",a),{c(){N(e.$$.fragment)},l(i){A(e.$$.fragment,i)},m(i,_){z(e,i,_),t=!0},p(i,_){n=i;const g={};_[1]&512&&(g.$$scope={dirty:_,ctx:n}),!o&&_[0]&19&&(o=!0,g.lngLat=n[38].point,x(()=>o=!1)),e.$set(g)},i(i){t||(v(e.$$.fragment,i),t=!0)},o(i){w(e.$$.fragment,i),t=!1},d(i){P(e,i)}}}function Kt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score]),X(e,"opacity",n[35].kind=="walking & wheeling"?"0%":"100%")},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score]),t[0]&19&&X(e,"opacity",o[35].kind=="walking & wheeling"?"0%":"100%")},d(o){o&&b(e)}}}function Rt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score])},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Xt(n){let e;return{c(){e=te("span"),this.h()},l(o){e=ne(o,"SPAN",{class:!0}),oe(e).forEach(b),this.h()},h(){Ie(e,"class","dot svelte-1qktznf"),X(e,"background-color",n[7][n[35].score]),X(e,"opacity","0%")},m(o,t){L(o,e,t)},p(o,t){t[0]&19&&X(e,"background-color",o[7][o[35].score])},d(o){o&&b(e)}}}function Re(n){let e,o,t,l,r,a,s,i,_;function g(p){n[21](p,n[35])}function d(){return n[22](n[37])}function u(){return n[23](n[37])}let C={draggable:!0,$$slots:{default:[Kt]},$$scope:{ctx:n}};n[35].point1!==void 0&&(C.lngLat=n[35].point1),e=new Se({props:C}),Y.push(()=>ee(e,"lngLat",g)),e.$on("dragend",d),e.$on("click",u);function j(p){n[24](p,n[35])}function q(){return n[25](n[37])}function U(){return n[26](n[37])}let E={draggable:!0,$$slots:{default:[Rt]},$$scope:{ctx:n}};n[35].point2!==void 0&&(E.lngLat=n[35].point2),l=new Se({props:E}),Y.push(()=>ee(l,"lngLat",j)),l.$on("dragend",q),l.$on("click",U);function h(p){n[27](p,n[35])}function f(){return n[28](n[37])}function $(){return n[29](n[37])}let k={draggable:!0,$$slots:{default:[Xt]},$$scope:{ctx:n}};return n[35].point3!==void 0&&(k.lngLat=n[35].point3),s=new Se({props:k}),Y.push(()=>ee(s,"lngLat",h)),s.$on("dragend",f),s.$on("click",$),{c(){N(e.$$.fragment),t=B(),N(l.$$.fragment),a=B(),N(s.$$.fragment)},l(p){A(e.$$.fragment,p),t=D(p),A(l.$$.fragment,p),a=D(p),A(s.$$.fragment,p)},m(p,y){z(e,p,y),L(p,t,y),z(l,p,y),L(p,a,y),z(s,p,y),_=!0},p(p,y){n=p;const J={};y[0]&19|y[1]&512&&(J.$$scope={dirty:y,ctx:n}),!o&&y[0]&19&&(o=!0,J.lngLat=n[35].point1,x(()=>o=!1)),e.$set(J);const I={};y[0]&19|y[1]&512&&(I.$$scope={dirty:y,ctx:n}),!r&&y[0]&19&&(r=!0,I.lngLat=n[35].point2,x(()=>r=!1)),l.$set(I);const F={};y[0]&19|y[1]&512&&(F.$$scope={dirty:y,ctx:n}),!i&&y[0]&19&&(i=!0,F.lngLat=n[35].point3,x(()=>i=!1)),s.$set(F)},i(p){_||(v(e.$$.fragment,p),v(l.$$.fragment,p),v(s.$$.fragment,p),_=!0)},o(p){w(e.$$.fragment,p),w(l.$$.fragment,p),w(s.$$.fragment,p),_=!1},d(p){p&&(b(t),b(a)),P(e,p),P(l,p),P(s,p)}}}function Wt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=H(e)},l(t){o=G(t,e)},m(t,l){L(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&ce(o,e)},d(t){t&&b(o)}}}function Vt(n){let e,o;return e=new it({props:{$$slots:{default:[Wt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Zt(n){let e=(n[34].name||"Untitled movement")+"",o;return{c(){o=H(e)},l(t){o=G(t,e)},m(t,l){L(t,o,l)},p(t,l){l[1]&8&&e!==(e=(t[34].name||"Untitled movement")+"")&&ce(o,e)},d(t){t&&b(o)}}}function Qt(n){let e,o;return e=new it({props:{$$slots:{default:[Zt,({props:t})=>({34:t}),({props:t})=>[0,t?8:0]]},$$scope:{ctx:n}}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&520&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Yt(n){let e,o,t,l,r,a;return e=new Ee({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Oe(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Vt]},$$scope:{ctx:n}}}),e.$on("click",n[9]),t=new Ee({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Oe(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Qt]},$$scope:{ctx:n}}}),t.$on("click",n[9]),r=new Ut({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),N(r.$$.fragment)},l(s){A(e.$$.fragment,s),o=D(s),A(t.$$.fragment,s),l=D(s),A(r.$$.fragment,s)},m(s,i){z(e,s,i),L(s,o,i),z(t,s,i),L(s,l,i),z(r,s,i),a=!0},p(s,i){const _={};i[1]&512&&(_.$$scope={dirty:i,ctx:s}),e.$set(_);const g={};i[1]&512&&(g.$$scope={dirty:i,ctx:s}),t.$set(g)},i(s){a||(v(e.$$.fragment,s),v(t.$$.fragment,s),v(r.$$.fragment,s),a=!0)},o(s){w(e.$$.fragment,s),w(t.$$.fragment,s),w(r.$$.fragment,s),a=!1},d(s){s&&(b(o),b(l)),P(e,s),P(t,s),P(r,s)}}}function xt(n){let e,o,t,l;return e=new Ee({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Lt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment)},l(r){A(e.$$.fragment,r),o=D(r),A(t.$$.fragment,r)},m(r,a){z(e,r,a),L(r,o,a),z(t,r,a),l=!0},p:he,i(r){l||(v(e.$$.fragment,r),v(t.$$.fragment,r),l=!0)},o(r){w(e.$$.fragment,r),w(t.$$.fragment,r),l=!1},d(r){r&&b(o),P(e,r),P(t,r)}}}function en(n){let e,o,t,l,r,a,s,i,_,g,d,u;e=new Tt({}),e.$on("click",n[8]),t=new Ct({props:{gj:n[4].summary.networkMap,show:n[2]}});let C=ue(n[4].jat[n[0]][n[1]].arms),j=[];for(let f=0;f<C.length;f+=1)j[f]=Ke(Je(n,C,f));const q=f=>w(j[f],1,1,()=>{j[f]=null});let U=ue(n[4].jat[n[0]][n[1]].movements),E=[];for(let f=0;f<U.length;f+=1)E[f]=Re(Ge(n,U,f));const h=f=>w(E[f],1,1,()=>{E[f]=null});return s=new Ue({props:{data:n[10](n[4]),$$slots:{default:[Yt]},$$scope:{ctx:n}}}),_=new Ue({props:{data:n[6],$$slots:{default:[xt]},$$scope:{ctx:n}}}),d=new It({props:{map:n[5]}}),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B();for(let f=0;f<j.length;f+=1)j[f].c();r=B();for(let f=0;f<E.length;f+=1)E[f].c();a=B(),N(s.$$.fragment),i=B(),N(_.$$.fragment),g=B(),N(d.$$.fragment)},l(f){A(e.$$.fragment,f),o=D(f),A(t.$$.fragment,f),l=D(f);for(let $=0;$<j.length;$+=1)j[$].l(f);r=D(f);for(let $=0;$<E.length;$+=1)E[$].l(f);a=D(f),A(s.$$.fragment,f),i=D(f),A(_.$$.fragment,f),g=D(f),A(d.$$.fragment,f)},m(f,$){z(e,f,$),L(f,o,$),z(t,f,$),L(f,l,$);for(let k=0;k<j.length;k+=1)j[k]&&j[k].m(f,$);L(f,r,$);for(let k=0;k<E.length;k+=1)E[k]&&E[k].m(f,$);L(f,a,$),z(s,f,$),L(f,i,$),z(_,f,$),L(f,g,$),z(d,f,$),u=!0},p(f,$){const k={};if($[0]&16&&(k.gj=f[4].summary.networkMap),$[0]&4&&(k.show=f[2]),t.$set(k),$[0]&27){C=ue(f[4].jat[f[0]][f[1]].arms);let I;for(I=0;I<C.length;I+=1){const F=Je(f,C,I);j[I]?(j[I].p(F,$),v(j[I],1)):(j[I]=Ke(F),j[I].c(),v(j[I],1),j[I].m(r.parentNode,r))}for(le(),I=C.length;I<j.length;I+=1)q(I);re()}if($[0]&155){U=ue(f[4].jat[f[0]][f[1]].movements);let I;for(I=0;I<U.length;I+=1){const F=Ge(f,U,I);E[I]?(E[I].p(F,$),v(E[I],1)):(E[I]=Re(F),E[I].c(),v(E[I],1),E[I].m(a.parentNode,a))}for(le(),I=U.length;I<E.length;I+=1)h(I);re()}const p={};$[0]&16&&(p.data=f[10](f[4])),$[1]&512&&(p.$$scope={dirty:$,ctx:f}),s.$set(p);const y={};$[0]&64&&(y.data=f[6]),$[1]&512&&(y.$$scope={dirty:$,ctx:f}),_.$set(y);const J={};$[0]&32&&(J.map=f[5]),d.$set(J)},i(f){if(!u){v(e.$$.fragment,f),v(t.$$.fragment,f);for(let $=0;$<C.length;$+=1)v(j[$]);for(let $=0;$<U.length;$+=1)v(E[$]);v(s.$$.fragment,f),v(_.$$.fragment,f),v(d.$$.fragment,f),u=!0}},o(f){w(e.$$.fragment,f),w(t.$$.fragment,f),j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)w(j[$]);E=E.filter(Boolean);for(let $=0;$<E.length;$+=1)w(E[$]);w(s.$$.fragment,f),w(_.$$.fragment,f),w(d.$$.fragment,f),u=!1},d(f){f&&(b(o),b(l),b(r),b(a),b(i),b(g)),P(e,f),P(t,f),Ce(j,f),Ce(E,f),P(s,f),P(_,f),P(d,f)}}}function tn(n){let e,o,t;function l(a){n[30](a)}let r={$$slots:{default:[en]},$$scope:{ctx:n}};return n[5]!==void 0&&(r.map=n[5]),e=new wt({props:r}),Y.push(()=>ee(e,"map",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){z(e,a,s),t=!0},p(a,s){const i={};s[0]&127|s[1]&512&&(i.$$scope={dirty:s,ctx:a}),!o&&s[0]&32&&(o=!0,i.map=a[5],x(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function Xe(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function nn(n){return String.fromCharCode(n+65)}function on(n,e,o){let t,l;ye(n,W,m=>o(4,l=m));let{junctionIdx:r}=e,{stage:a}=e,{newKind:s}=e,{editing:i}=e,{hoveringSidebar:_}=e,{streetviewOn:g}=e,{showContext:d}=e,{select:u}=e,{stopEditing:C}=e,j,q={0:_e.red.background,1:_e.amber.background,2:_e.green.background,X:_e.critical.background};function U(m,T,c){let M={type:"FeatureCollection",features:[]},Z=T??c;return Z!=null&&(Z.kind=="arm"?M.features.push(Xe(m.jat[r][a].arms[Z.idx],Z.idx)):M.features.push($(m.jat[r][a].movements[Z.idx],Z.idx))),M}async function E(m){if(!g){for(let T of j.queryRenderedFeatures(m.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(i!=null){await C();return}s=="arm"?(je(W,l.jat[r][a].arms=[...l.jat[r][a].arms,{point:m.detail.lngLat.toArray(),name:""}],l),await u({kind:"arm",idx:l.jat[r][a].arms.length-1})):(je(W,l.jat[r][a].movements=[...l.jat[r][a].movements,{point1:m.detail.lngLat.toArray(),point2:He(m.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:He(m.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await u({kind:"movement",idx:l.jat[r][a].movements.length-1}))}}async function h(m){await u({kind:"movement",idx:m.detail.features[0].id})}pt(()=>{p(!1)});function f(m){let T={type:"FeatureCollection",features:m.jat[r][a].movements.map((c,M)=>$(c,M))};for(let c of m.jat[r][a].movements)if(T.features.push(k(c,T.features.length)),c.kind=="walking & wheeling"){let M={...c,point1:c.point3,point3:c.point1};T.features.push(k(M,T.features.length))}return T}function $(m,T){return{type:"Feature",id:T,properties:{name:m.name,kind:m.kind,color:q[m.score]},geometry:{type:"LineString",coordinates:[m.point1,m.point2,m.point3]}}}function k(m,T){return{type:"Feature",id:T,properties:{kind:m.kind,color:q[m.score],angle:Gt(m.point2,m.point3)},geometry:{type:"Point",coordinates:m.point3}}}function p(m){let T=f(l);for(let c of l.jat[r][a].arms)T.features.push(Xe(c,T.features.length));for(let c of l.summary.networkMap.features)T.features.push(c);T.features.length>0&&j.fitBounds(jt(T),{padding:20,animate:m})}function y(){return j}function J(m,T){n.$$.not_equal(T.point,m)&&(T.point=m,W.set(l))}const I=m=>u({kind:"arm",idx:m}),F=m=>u({kind:"arm",idx:m});function se(m,T){n.$$.not_equal(T.point1,m)&&(T.point1=m,W.set(l))}const S=m=>u({kind:"movement",idx:m}),be=m=>u({kind:"movement",idx:m});function de(m,T){n.$$.not_equal(T.point2,m)&&(T.point2=m,W.set(l))}const ae=m=>u({kind:"movement",idx:m}),K=m=>u({kind:"movement",idx:m});function ve(m,T){n.$$.not_equal(T.point3,m)&&(T.point3=m,W.set(l))}const V=m=>u({kind:"movement",idx:m}),ie=m=>u({kind:"movement",idx:m});function R(m){j=m,o(5,j)}return n.$$set=m=>{"junctionIdx"in m&&o(0,r=m.junctionIdx),"stage"in m&&o(1,a=m.stage),"newKind"in m&&o(11,s=m.newKind),"editing"in m&&o(12,i=m.editing),"hoveringSidebar"in m&&o(13,_=m.hoveringSidebar),"streetviewOn"in m&&o(14,g=m.streetviewOn),"showContext"in m&&o(2,d=m.showContext),"select"in m&&o(3,u=m.select),"stopEditing"in m&&o(15,C=m.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&12304&&o(6,t=U(l,i,_))},[r,a,d,u,l,j,t,q,E,h,f,s,i,_,g,C,p,y,J,I,F,se,S,be,de,ae,K,ve,V,ie,R]}class ln extends Le{constructor(e){super(),Me(this,e,on,tn,$e,{junctionIdx:0,stage:1,newKind:11,editing:12,hoveringSidebar:13,streetviewOn:14,showContext:2,select:3,stopEditing:15,zoom:16,getMap:17},null,[-1,-1])}get zoom(){return this.$$.ctx[16]}get getMap(){return this.$$.ctx[17]}}function rn(n){let e,o,t,l,r,a,s,i,_,g,d,u;function C(k){n[5](k)}let j={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(j.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new qe({props:j}),Y.push(()=>ee(e,"value",C));function q(k){n[6](k)}let U={legend:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(U.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),l=new ze({props:U}),Y.push(()=>ee(l,"value",q));function E(k){n[7](k)}let h={legend:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(h.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),s=new ze({props:h}),Y.push(()=>ee(s,"value",E));function f(k){n[8](k)}let $={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),g=new st({props:$}),Y.push(()=>ee(g,"value",f)),{c(){N(e.$$.fragment),t=B(),N(l.$$.fragment),a=B(),N(s.$$.fragment),_=B(),N(g.$$.fragment)},l(k){A(e.$$.fragment,k),t=D(k),A(l.$$.fragment,k),a=D(k),A(s.$$.fragment,k),_=D(k),A(g.$$.fragment,k)},m(k,p){z(e,k,p),L(k,t,p),z(l,k,p),L(k,a,p),z(s,k,p),L(k,_,p),z(g,k,p),u=!0},p(k,[p]){const y={};!o&&p&15&&(o=!0,y.value=k[3].jat[k[0]][k[1]].movements[k[2]].name,x(()=>o=!1)),e.$set(y);const J={};!r&&p&15&&(r=!0,J.value=k[3].jat[k[0]][k[1]].movements[k[2]].kind,x(()=>r=!1)),l.$set(J);const I={};!i&&p&15&&(i=!0,I.value=k[3].jat[k[0]][k[1]].movements[k[2]].score,x(()=>i=!1)),s.$set(I);const F={};!d&&p&15&&(d=!0,F.value=k[3].jat[k[0]][k[1]].movements[k[2]].notes,x(()=>d=!1)),g.$set(F)},i(k){u||(v(e.$$.fragment,k),v(l.$$.fragment,k),v(s.$$.fragment,k),v(g.$$.fragment,k),u=!0)},o(k){w(e.$$.fragment,k),w(l.$$.fragment,k),w(s.$$.fragment,k),w(g.$$.fragment,k),u=!1},d(k){k&&(b(t),b(a),b(_)),P(e,k),P(l,k),P(s,k),P(g,k)}}}function an(n,e,o){let t;ye(n,W,u=>o(3,t=u));let{junctionIdx:l}=e,{stage:r}=e,{idx:a}=e,s=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function i(u){n.$$.not_equal(t.jat[l][r].movements[a].name,u)&&(t.jat[l][r].movements[a].name=u,W.set(t))}function _(u){n.$$.not_equal(t.jat[l][r].movements[a].kind,u)&&(t.jat[l][r].movements[a].kind=u,W.set(t))}function g(u){n.$$.not_equal(t.jat[l][r].movements[a].score,u)&&(t.jat[l][r].movements[a].score=u,W.set(t))}function d(u){n.$$.not_equal(t.jat[l][r].movements[a].notes,u)&&(t.jat[l][r].movements[a].notes=u,W.set(t))}return n.$$set=u=>{"junctionIdx"in u&&o(0,l=u.junctionIdx),"stage"in u&&o(1,r=u.stage),"idx"in u&&o(2,a=u.idx)},[l,r,a,t,s,i,_,g,d]}class sn extends Le{constructor(e){super(),Me(this,e,an,rn,$e,{junctionIdx:0,stage:1,idx:2})}}const{window:fn}=Mt;function We(n,e,o){const t=n.slice();t[34]=e[o],t[37]=o;const l=t[17][t[34].score];return t[35]=l,t}function Ve(n,e,o){const t=n.slice();return t[38]=e[o],t[37]=o,t}function un(n){let e,o,t,l,r,a,s,i;e=new rt({props:{$$slots:{default:[cn]},$$scope:{ctx:n}}}),e.$on("click",n[12]),t=new at({props:{$$slots:{default:[_n]},$$scope:{ctx:n}}}),t.$on("click",n[13]);const _=[dn,gn],g=[];function d(u,C){return u[3].kind=="movement"?0:1}return r=d(n),a=g[r]=_[r](n),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),a.c(),s=me()},l(u){A(e.$$.fragment,u),o=D(u),A(t.$$.fragment,u),l=D(u),a.l(u),s=me()},m(u,C){z(e,u,C),L(u,o,C),z(t,u,C),L(u,l,C),g[r].m(u,C),L(u,s,C),i=!0},p(u,C){const j={};C[1]&512&&(j.$$scope={dirty:C,ctx:u}),e.$set(j);const q={};C[1]&512&&(q.$$scope={dirty:C,ctx:u}),t.$set(q);let U=r;r=d(u),r===U?g[r].p(u,C):(le(),w(g[U],1,1,()=>{g[U]=null}),re(),a=g[r],a?a.p(u,C):(a=g[r]=_[r](u),a.c()),v(a,1),a.m(s.parentNode,s))},i(u){i||(v(e.$$.fragment,u),v(t.$$.fragment,u),v(a),i=!0)},o(u){w(e.$$.fragment,u),w(t.$$.fragment,u),w(a),i=!1},d(u){u&&(b(o),b(l),b(s)),P(e,u),P(t,u),g[r].d(u)}}}function mn(n){let e,o,t,l,r,a,s,i=(n[9].jat[n[0]].name||"Untitled junction")+"",_,g,d,u,C,j,q,U="Arms",E,h,f,$,k="Movements",p,y,J,I;e=new Pt({props:{label:"Tools",$$slots:{default:[hn]},$$scope:{ctx:n}}});function F(c,M){return c[9].jat[c[0]][c[1]].movements.length>0?bn:kn}let se=F(n),S=se(n);function be(c){n[22](c)}let de={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};n[2]!==void 0&&(de.value=n[2]),u=new ze({props:de}),Y.push(()=>ee(u,"value",be));let ae=ue(n[9].jat[n[0]][n[1]].arms),K=[];for(let c=0;c<ae.length;c+=1)K[c]=Ze(Ve(n,ae,c));const ve=c=>w(K[c],1,1,()=>{K[c]=null});let V=n[9].jat[n[0]][n[10]].arms.length>0&&Qe(n),ie=ue(n[9].jat[n[0]][n[1]].movements),R=[];for(let c=0;c<ie.length;c+=1)R[c]=Ye(We(n,ie,c));const m=c=>w(R[c],1,1,()=>{R[c]=null});let T=n[9].jat[n[0]][n[10]].movements.length>0&&xe(n);return{c(){N(e.$$.fragment),o=B(),t=te("p"),l=H("Total JAT score for "),r=H(n[1]),a=B(),s=te("u"),_=H(i),g=H(`
        :
        `),S.c(),d=B(),N(u.$$.fragment),j=B(),q=te("h3"),q.textContent=U,E=B();for(let c=0;c<K.length;c+=1)K[c].c();h=B(),V&&V.c(),f=B(),$=te("h3"),$.textContent=k,p=B();for(let c=0;c<R.length;c+=1)R[c].c();y=B(),T&&T.c(),J=me()},l(c){A(e.$$.fragment,c),o=D(c),t=ne(c,"P",{});var M=oe(t);l=G(M,"Total JAT score for "),r=G(M,n[1]),a=D(M),s=ne(M,"U",{});var Z=oe(s);_=G(Z,i),Z.forEach(b),g=G(M,`
        :
        `),S.l(M),M.forEach(b),d=D(c),A(u.$$.fragment,c),j=D(c),q=ne(c,"H3",{"data-svelte-h":!0}),De(q)!=="svelte-ld74qb"&&(q.textContent=U),E=D(c);for(let fe=0;fe<K.length;fe+=1)K[fe].l(c);h=D(c),V&&V.l(c),f=D(c),$=ne(c,"H3",{"data-svelte-h":!0}),De($)!=="svelte-1dc52s8"&&($.textContent=k),p=D(c);for(let fe=0;fe<R.length;fe+=1)R[fe].l(c);y=D(c),T&&T.l(c),J=me()},m(c,M){z(e,c,M),L(c,o,M),L(c,t,M),Q(t,l),Q(t,r),Q(t,a),Q(t,s),Q(s,_),Q(t,g),S.m(t,null),L(c,d,M),z(u,c,M),L(c,j,M),L(c,q,M),L(c,E,M);for(let Z=0;Z<K.length;Z+=1)K[Z]&&K[Z].m(c,M);L(c,h,M),V&&V.m(c,M),L(c,f,M),L(c,$,M),L(c,p,M);for(let Z=0;Z<R.length;Z+=1)R[Z]&&R[Z].m(c,M);L(c,y,M),T&&T.m(c,M),L(c,J,M),I=!0},p(c,M){const Z={};M[0]&224|M[1]&512&&(Z.$$scope={dirty:M,ctx:c}),e.$set(Z),(!I||M[0]&2)&&ce(r,c[1]),(!I||M[0]&513)&&i!==(i=(c[9].jat[c[0]].name||"Untitled junction")+"")&&ce(_,i),se===(se=F(c))&&S?S.p(c,M):(S.d(1),S=se(c),S&&(S.c(),S.m(t,null)));const fe={};if(!C&&M[0]&4&&(C=!0,fe.value=c[2],x(()=>C=!1)),u.$set(fe),M[0]&2579){ae=ue(c[9].jat[c[0]][c[1]].arms);let O;for(O=0;O<ae.length;O+=1){const we=Ve(c,ae,O);K[O]?(K[O].p(we,M),v(K[O],1)):(K[O]=Ze(we),K[O].c(),v(K[O],1),K[O].m(h.parentNode,h))}for(le(),O=ae.length;O<K.length;O+=1)ve(O);re()}if(c[9].jat[c[0]][c[10]].arms.length>0?V?(V.p(c,M),M[0]&513&&v(V,1)):(V=Qe(c),V.c(),v(V,1),V.m(f.parentNode,f)):V&&(le(),w(V,1,1,()=>{V=null}),re()),M[0]&133651){ie=ue(c[9].jat[c[0]][c[1]].movements);let O;for(O=0;O<ie.length;O+=1){const we=We(c,ie,O);R[O]?(R[O].p(we,M),v(R[O],1)):(R[O]=Ye(we),R[O].c(),v(R[O],1),R[O].m(y.parentNode,y))}for(le(),O=ie.length;O<R.length;O+=1)m(O);re()}c[9].jat[c[0]][c[10]].movements.length>0?T?(T.p(c,M),M[0]&513&&v(T,1)):(T=xe(c),T.c(),v(T,1),T.m(J.parentNode,J)):T&&(le(),w(T,1,1,()=>{T=null}),re())},i(c){if(!I){v(e.$$.fragment,c),v(u.$$.fragment,c);for(let M=0;M<ae.length;M+=1)v(K[M]);v(V);for(let M=0;M<ie.length;M+=1)v(R[M]);v(T),I=!0}},o(c){w(e.$$.fragment,c),w(u.$$.fragment,c),K=K.filter(Boolean);for(let M=0;M<K.length;M+=1)w(K[M]);w(V),R=R.filter(Boolean);for(let M=0;M<R.length;M+=1)w(R[M]);w(T),I=!1},d(c){c&&(b(o),b(t),b(d),b(j),b(q),b(E),b(h),b(f),b($),b(p),b(y),b(J)),P(e,c),S.d(),P(u,c),Ce(K,c),V&&V.d(c),Ce(R,c),T&&T.d(c)}}}function cn(n){let e;return{c(){e=H("Save")},l(o){e=G(o,"Save")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function _n(n){let e;return{c(){e=H("Delete")},l(o){e=G(o,"Delete")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function gn(n){let e,o,t;function l(a){n[29](a)}let r={label:"Arm Name"};return n[9].jat[n[0]][n[1]].arms[n[3].idx].name!==void 0&&(r.value=n[9].jat[n[0]][n[1]].arms[n[3].idx].name),e=new qe({props:r}),Y.push(()=>ee(e,"value",l)),{c(){N(e.$$.fragment)},l(a){A(e.$$.fragment,a)},m(a,s){z(e,a,s),t=!0},p(a,s){const i={};!o&&s[0]&523&&(o=!0,i.value=a[9].jat[a[0]][a[1]].arms[a[3].idx].name,x(()=>o=!1)),e.$set(i)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){w(e.$$.fragment,a),t=!1},d(a){P(e,a)}}}function dn(n){let e,o;return e=new sn({props:{junctionIdx:n[0],stage:n[1],idx:n[3].idx}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[0]&1&&(r.junctionIdx=t[0]),l[0]&2&&(r.stage=t[1]),l[0]&8&&(r.idx=t[3].idx),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function pn(n){let e;return{c(){e=H("Zoom to fit")},l(o){e=G(o,"Zoom to fit")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function $n(n){let e;return{c(){e=H("Show scheme context")},l(o){e=G(o,"Show scheme context")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function hn(n){var E;let e,o,t,l,r,a,s,i,_,g,d,u;e=new ke({props:{$$slots:{default:[pn]},$$scope:{ctx:n}}}),e.$on("click",n[19]),t=new Et({}),r=new Nt({});function C(h){n[20](h)}let j={map:(E=n[7])==null?void 0:E.getMap()};n[5]!==void 0&&(j.enabled=n[5]),s=new At({props:j}),Y.push(()=>ee(s,"enabled",C));function q(h){n[21](h)}let U={$$slots:{default:[$n]},$$scope:{ctx:n}};return n[6]!==void 0&&(U.checked=n[6]),g=new zt({props:U}),Y.push(()=>ee(g,"checked",q)),{c(){N(e.$$.fragment),o=B(),N(t.$$.fragment),l=B(),N(r.$$.fragment),a=B(),N(s.$$.fragment),_=B(),N(g.$$.fragment)},l(h){A(e.$$.fragment,h),o=D(h),A(t.$$.fragment,h),l=D(h),A(r.$$.fragment,h),a=D(h),A(s.$$.fragment,h),_=D(h),A(g.$$.fragment,h)},m(h,f){z(e,h,f),L(h,o,f),z(t,h,f),L(h,l,f),z(r,h,f),L(h,a,f),z(s,h,f),L(h,_,f),z(g,h,f),u=!0},p(h,f){var y;const $={};f[1]&512&&($.$$scope={dirty:f,ctx:h}),e.$set($);const k={};f[0]&128&&(k.map=(y=h[7])==null?void 0:y.getMap()),!i&&f[0]&32&&(i=!0,k.enabled=h[5],x(()=>i=!1)),s.$set(k);const p={};f[1]&512&&(p.$$scope={dirty:f,ctx:h}),!d&&f[0]&64&&(d=!0,p.checked=h[6],x(()=>d=!1)),g.$set(p)},i(h){u||(v(e.$$.fragment,h),v(t.$$.fragment,h),v(r.$$.fragment,h),v(s.$$.fragment,h),v(g.$$.fragment,h),u=!0)},o(h){w(e.$$.fragment,h),w(t.$$.fragment,h),w(r.$$.fragment,h),w(s.$$.fragment,h),w(g.$$.fragment,h),u=!1},d(h){h&&(b(o),b(l),b(a),b(_)),P(e,h),P(t,h),P(r,h),P(s,h),P(g,h)}}}function kn(n){let e;return{c(){e=H("No movements added")},l(o){e=G(o,"No movements added")},m(o,t){L(o,e,t)},p:he,d(o){o&&b(e)}}}function bn(n){let e=Math.round(tt(n[9].jat[n[0]][n[1]]))+"",o,t;return{c(){o=H(e),t=H("%")},l(l){o=G(l,e),t=G(l,"%")},m(l,r){L(l,o,r),L(l,t,r)},p(l,r){r[0]&515&&e!==(e=Math.round(tt(l[9].jat[l[0]][l[1]]))+"")&&ce(o,e)},d(l){l&&(b(o),b(t))}}}function Ze(n){let e,o;function t(){return n[23](n[37])}function l(){return n[24](n[37])}return e=new Pe({props:{name:`${et(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[25]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){z(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=`${et(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(s)},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){w(e.$$.fragment,r),o=!1},d(r){P(e,r)}}}function Qe(n){let e,o;return e=new ke({props:{$$slots:{default:[vn]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function vn(n){let e,o;return{c(){e=H("Copy arms from "),o=H(n[10])},l(t){e=G(t,"Copy arms from "),o=G(t,n[10])},m(t,l){L(t,e,l),L(t,o,l)},p:he,d(t){t&&(b(e),b(o))}}}function wn(n){let e,o,t,l=n[34].score+"",r,a,s,i=Fe(n[34].kind)+"",_;return{c(){e=te("div"),o=te("span"),t=H("Score: "),r=H(l),a=B(),s=te("span"),_=H(i),this.h()},l(g){e=ne(g,"DIV",{style:!0});var d=oe(e);o=ne(d,"SPAN",{style:!0});var u=oe(o);t=G(u,"Score: "),r=G(u,l),u.forEach(b),a=D(d),s=ne(d,"SPAN",{});var C=oe(s);_=G(C,i),C.forEach(b),d.forEach(b),this.h()},h(){X(o,"padding","4px"),X(o,"color",n[35].font),X(o,"background-color",n[35].background),X(e,"width","100%"),X(e,"display","flex"),X(e,"justify-content","space-between")},m(g,d){L(g,e,d),Q(e,o),Q(o,t),Q(o,r),Q(e,a),Q(e,s),Q(s,_)},p(g,d){d[0]&515&&l!==(l=g[34].score+"")&&ce(r,l),d[0]&515&&X(o,"color",g[35].font),d[0]&515&&X(o,"background-color",g[35].background),d[0]&515&&i!==(i=Fe(g[34].kind)+"")&&ce(_,i)},d(g){g&&b(e)}}}function Ye(n){let e,o;function t(){return n[26](n[37])}function l(){return n[27](n[37])}return e=new Pe({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[wn]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",n[28]),{c(){N(e.$$.fragment)},l(r){A(e.$$.fragment,r)},m(r,a){z(e,r,a),o=!0},p(r,a){n=r;const s={};a[0]&515&&(s.name=n[34].name||"Unnamed movement"),a[0]&515|a[1]&512&&(s.$$scope={dirty:a,ctx:n}),e.$set(s)},i(r){o||(v(e.$$.fragment,r),o=!0)},o(r){w(e.$$.fragment,r),o=!1},d(r){P(e,r)}}}function xe(n){let e,o;return e=new ke({props:{$$slots:{default:[jn]},$$scope:{ctx:n}}}),e.$on("click",n[16]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l[1]&512&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function jn(n){let e,o;return{c(){e=H("Copy movements from "),o=H(n[10])},l(t){e=G(t,"Copy movements from "),o=G(t,n[10])},m(t,l){L(t,e,l),L(t,o,l)},p:he,d(t){t&&(b(e),b(o))}}}function Cn(n){let e,o,t,l,r,a,s,i,_,g,d,u,C,j;function q(p){n[18](p)}let U={label:"Commentary / Notes"};n[9].jat[n[0]][n[1]].notes!==void 0&&(U.value=n[9].jat[n[0]][n[1]].notes),e=new st({props:U}),Y.push(()=>ee(e,"value",q));const E=[mn,un],h=[];function f(p,y){return p[3]==null?0:1}a=f(n),s=h[a]=E[a](n);function $(p){n[32](p)}let k={junctionIdx:n[0],stage:n[1],newKind:n[2],hoveringSidebar:n[4],streetviewOn:n[5],showContext:n[6],select:n[11],stopEditing:n[12]};return n[3]!==void 0&&(k.editing=n[3]),g=new ln({props:k}),n[31](g),Y.push(()=>ee(g,"editing",$)),{c(){N(e.$$.fragment),t=B(),l=te("div"),r=te("div"),s.c(),i=B(),_=te("div"),N(g.$$.fragment),this.h()},l(p){A(e.$$.fragment,p),t=D(p),l=ne(p,"DIV",{style:!0});var y=oe(l);r=ne(y,"DIV",{style:!0});var J=oe(r);s.l(J),J.forEach(b),i=D(y),_=ne(y,"DIV",{style:!0});var I=oe(_);A(g.$$.fragment,I),I.forEach(b),y.forEach(b),this.h()},h(){X(r,"width","30%"),X(r,"overflow-y","scroll"),X(r,"padding","10px"),X(r,"border","1px solid black"),X(_,"position","relative"),X(_,"width","100%"),X(l,"display","flex"),X(l,"height","80vh")},m(p,y){z(e,p,y),L(p,t,y),L(p,l,y),Q(l,r),h[a].m(r,null),n[30](r),Q(l,i),Q(l,_),z(g,_,null),u=!0,C||(j=$t(fn,"keydown",n[14]),C=!0)},p(p,y){const J={};!o&&y[0]&515&&(o=!0,J.value=p[9].jat[p[0]][p[1]].notes,x(()=>o=!1)),e.$set(J);let I=a;a=f(p),a===I?h[a].p(p,y):(le(),w(h[I],1,1,()=>{h[I]=null}),re(),s=h[a],s?s.p(p,y):(s=h[a]=E[a](p),s.c()),v(s,1),s.m(r,null));const F={};y[0]&1&&(F.junctionIdx=p[0]),y[0]&2&&(F.stage=p[1]),y[0]&4&&(F.newKind=p[2]),y[0]&16&&(F.hoveringSidebar=p[4]),y[0]&32&&(F.streetviewOn=p[5]),y[0]&64&&(F.showContext=p[6]),!d&&y[0]&8&&(d=!0,F.editing=p[3],x(()=>d=!1)),g.$set(F)},i(p){u||(v(e.$$.fragment,p),v(s),v(g.$$.fragment,p),u=!0)},o(p){w(e.$$.fragment,p),w(s),w(g.$$.fragment,p),u=!1},d(p){p&&(b(t),b(l)),P(e,p),h[a].d(),n[30](null),n[31](null),P(g),C=!1,j()}}}function et(n){return String.fromCharCode(n+65)}function tt(n){let e=0,o=0;for(let t of n.movements)e+={0:0,1:1,2:2,X:0}[t.score],o+=2;return e/o*100}function Ln(n,e,o){let t;ye(n,W,m=>o(9,t=m));let{junctionIdx:l}=e,{stage:r}=e,a=r=="existing"?"proposed":"existing",s="arm",i=null,_=null,g=null,d=!1,u=!0,C=null,j;async function q(m){_=j.scrollTop,o(3,i=m),o(4,g=null)}async function U(){o(3,i=null),_!=null&&(await ht(),o(8,j.scrollTop=_,j),_=null)}function E(){window.confirm(`Delete this ${i.kind}?`)&&(i.kind=="movement"?(t.jat[l][r].movements.splice(i.idx,1),W.set(t)):(t.jat[l][r].arms.splice(i.idx,1),W.set(t)),U())}function h(m){if(i!=null&&m.key=="Escape")m.stopPropagation(),U();else if(i!=null&&m.key=="Delete"){let T=m.target.tagName;if(T=="INPUT"||T=="TEXTAREA")return;m.stopPropagation(),E()}}function f(){t.jat[l][r].arms.length>0&&!window.confirm("Overwrite arms?")||(je(W,t.jat[l][r].arms=JSON.parse(JSON.stringify(t.jat[l][a].arms)),t),W.set(t))}function $(){t.jat[l][r].movements.length>0&&!window.confirm("Overwrite movements?")||(je(W,t.jat[l][r].movements=JSON.parse(JSON.stringify(t.jat[l][a].movements)),t),W.set(t))}let k={0:_e.red,1:_e.amber,2:_e.green,X:_e.critical};function p(m){n.$$.not_equal(t.jat[l][r].notes,m)&&(t.jat[l][r].notes=m,W.set(t))}const y=()=>C==null?void 0:C.zoom(!0);function J(m){d=m,o(5,d)}function I(m){u=m,o(6,u)}function F(m){s=m,o(2,s)}const se=m=>q({kind:"arm",idx:m}),S=m=>o(4,g={kind:"arm",idx:m}),be=()=>o(4,g=null),de=m=>q({kind:"movement",idx:m}),ae=m=>o(4,g={kind:"movement",idx:m}),K=()=>o(4,g=null);function ve(m){n.$$.not_equal(t.jat[l][r].arms[i.idx].name,m)&&(t.jat[l][r].arms[i.idx].name=m,W.set(t))}function V(m){Y[m?"unshift":"push"](()=>{j=m,o(8,j)})}function ie(m){Y[m?"unshift":"push"](()=>{C=m,o(7,C)})}function R(m){i=m,o(3,i)}return n.$$set=m=>{"junctionIdx"in m&&o(0,l=m.junctionIdx),"stage"in m&&o(1,r=m.stage)},[l,r,s,i,g,d,u,C,j,t,a,q,U,E,h,f,$,k,p,y,J,I,F,se,S,be,de,ae,K,ve,V,ie,R]}class Mn extends Le{constructor(e){super(),Me(this,e,Ln,Cn,$e,{junctionIdx:0,stage:1},null,[-1,-1])}}function nt(n,e,o){const t=n.slice();return t[10]=e[o],t[12]=o,t}function Sn(n){let e,o=(n[1].jat[n[0].idx].name||"Untitled junction")+"",t,l,r=n[0].stage+"",a,s,i,_,g,d,u,C=n[0].stage,j,q;i=new kt({props:{$$slots:{default:[Pn]},$$scope:{ctx:n}}});function U(f){n[9](f)}let E={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(E.value=n[1].jat[n[0].idx].name),g=new qe({props:E}),Y.push(()=>ee(g,"value",U));let h=ot(n);return{c(){e=te("h2"),t=H(o),l=H(" - "),a=H(r),s=B(),N(i.$$.fragment),_=B(),N(g.$$.fragment),u=B(),h.c(),j=me()},l(f){e=ne(f,"H2",{});var $=oe(e);t=G($,o),l=G($," - "),a=G($,r),$.forEach(b),s=D(f),A(i.$$.fragment,f),_=D(f),A(g.$$.fragment,f),u=D(f),h.l(f),j=me()},m(f,$){L(f,e,$),Q(e,t),Q(e,l),Q(e,a),L(f,s,$),z(i,f,$),L(f,_,$),z(g,f,$),L(f,u,$),h.m(f,$),L(f,j,$),q=!0},p(f,$){(!q||$&3)&&o!==(o=(f[1].jat[f[0].idx].name||"Untitled junction")+"")&&ce(t,o),(!q||$&1)&&r!==(r=f[0].stage+"")&&ce(a,r);const k={};$&8193&&(k.$$scope={dirty:$,ctx:f}),i.$set(k);const p={};!d&&$&3&&(d=!0,p.value=f[1].jat[f[0].idx].name,x(()=>d=!1)),g.$set(p),$&1&&$e(C,C=f[0].stage)?(le(),w(h,1,1,he),re(),h=ot(f),h.c(),v(h,1),h.m(j.parentNode,j)):h.p(f,$)},i(f){q||(v(i.$$.fragment,f),v(g.$$.fragment,f),v(h),q=!0)},o(f){w(i.$$.fragment,f),w(g.$$.fragment,f),w(h),q=!1},d(f){f&&(b(e),b(s),b(_),b(u),b(j)),P(i,f),P(g,f),h.d(f)}}}function yn(n){let e,o,t,l;e=new rt({props:{$$slots:{default:[qn]},$$scope:{ctx:n}}}),e.$on("click",n[2]);let r=ue(n[1].jat),a=[];for(let i=0;i<r.length;i+=1)a[i]=lt(nt(n,r,i));const s=i=>w(a[i],1,1,()=>{a[i]=null});return{c(){N(e.$$.fragment),o=B();for(let i=0;i<a.length;i+=1)a[i].c();t=me()},l(i){A(e.$$.fragment,i),o=D(i);for(let _=0;_<a.length;_+=1)a[_].l(i);t=me()},m(i,_){z(e,i,_),L(i,o,_);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(i,_);L(i,t,_),l=!0},p(i,_){const g={};if(_&8192&&(g.$$scope={dirty:_,ctx:i}),e.$set(g),_&3){r=ue(i[1].jat);let d;for(d=0;d<r.length;d+=1){const u=nt(i,r,d);a[d]?(a[d].p(u,_),v(a[d],1)):(a[d]=lt(u),a[d].c(),v(a[d],1),a[d].m(t.parentNode,t))}for(le(),d=r.length;d<a.length;d+=1)s(d);re()}},i(i){if(!l){v(e.$$.fragment,i);for(let _=0;_<r.length;_+=1)v(a[_]);l=!0}},o(i){w(e.$$.fragment,i),a=a.filter(Boolean);for(let _=0;_<a.length;_+=1)w(a[_]);l=!1},d(i){i&&(b(o),b(t)),P(e,i),Ce(a,i)}}}function In(n){let e;return{c(){e=H("Back to all junctions")},l(o){e=G(o,"Back to all junctions")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function Tn(n){let e,o;return e=new ke({props:{$$slots:{default:[Nn]},$$scope:{ctx:n}}}),e.$on("click",n[7]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function En(n){let e,o;return e=new ke({props:{$$slots:{default:[An]},$$scope:{ctx:n}}}),e.$on("click",n[6]),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l&8192&&(r.$$scope={dirty:l,ctx:t}),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function Nn(n){let e;return{c(){e=H("Edit Proposed")},l(o){e=G(o,"Edit Proposed")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function An(n){let e;return{c(){e=H("Edit Existing")},l(o){e=G(o,"Edit Existing")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function zn(n){let e;return{c(){e=H("Delete")},l(o){e=G(o,"Delete")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function Pn(n){let e,o,t,l,r,a,s;e=new ke({props:{$$slots:{default:[In]},$$scope:{ctx:n}}}),e.$on("click",n[5]);const i=[En,Tn],_=[];function g(d,u){return d[0].stage=="proposed"?0:1}return t=g(n),l=_[t]=i[t](n),a=new at({props:{$$slots:{default:[zn]},$$scope:{ctx:n}}}),a.$on("click",n[8]),{c(){N(e.$$.fragment),o=B(),l.c(),r=B(),N(a.$$.fragment)},l(d){A(e.$$.fragment,d),o=D(d),l.l(d),r=D(d),A(a.$$.fragment,d)},m(d,u){z(e,d,u),L(d,o,u),_[t].m(d,u),L(d,r,u),z(a,d,u),s=!0},p(d,u){const C={};u&8192&&(C.$$scope={dirty:u,ctx:d}),e.$set(C);let j=t;t=g(d),t===j?_[t].p(d,u):(le(),w(_[j],1,1,()=>{_[j]=null}),re(),l=_[t],l?l.p(d,u):(l=_[t]=i[t](d),l.c()),v(l,1),l.m(r.parentNode,r));const q={};u&8192&&(q.$$scope={dirty:u,ctx:d}),a.$set(q)},i(d){s||(v(e.$$.fragment,d),v(l),v(a.$$.fragment,d),s=!0)},o(d){w(e.$$.fragment,d),w(l),w(a.$$.fragment,d),s=!1},d(d){d&&(b(o),b(r)),P(e,d),_[t].d(d),P(a,d)}}}function ot(n){let e,o;return e=new Mn({props:{junctionIdx:n[0].idx,stage:n[0].stage}}),{c(){N(e.$$.fragment)},l(t){A(e.$$.fragment,t)},m(t,l){z(e,t,l),o=!0},p(t,l){const r={};l&1&&(r.junctionIdx=t[0].idx),l&1&&(r.stage=t[0].stage),e.$set(r)},i(t){o||(v(e.$$.fragment,t),o=!0)},o(t){w(e.$$.fragment,t),o=!1},d(t){P(e,t)}}}function qn(n){let e;return{c(){e=H("Add new junction")},l(o){e=G(o,"Add new junction")},m(o,t){L(o,e,t)},d(o){o&&b(e)}}}function lt(n){let e,o;function t(){return n[4](n[12])}return e=new Pe({props:{name:n[10].name||"Untitled junction"}}),e.$on("click",t),{c(){N(e.$$.fragment)},l(l){A(e.$$.fragment,l)},m(l,r){z(e,l,r),o=!0},p(l,r){n=l;const a={};r&2&&(a.name=n[10].name||"Untitled junction"),e.$set(a)},i(l){o||(v(e.$$.fragment,l),o=!0)},o(l){w(e.$$.fragment,l),o=!1},d(l){P(e,l)}}}function Bn(n){let e,o,t,l;const r=[yn,Sn],a=[];function s(i,_){return i[0].kind=="list"?0:i[0].kind=="edit"?1:-1}return~(e=s(n))&&(o=a[e]=r[e](n)),{c(){o&&o.c(),t=me()},l(i){o&&o.l(i),t=me()},m(i,_){~e&&a[e].m(i,_),L(i,t,_),l=!0},p(i,[_]){let g=e;e=s(i),e===g?~e&&a[e].p(i,_):(o&&(le(),w(a[g],1,1,()=>{a[g]=null}),re()),~e?(o=a[e],o?o.p(i,_):(o=a[e]=r[e](i),o.c()),v(o,1),o.m(t.parentNode,t)):o=null)},i(i){l||(v(o),l=!0)},o(i){w(o),l=!1},d(i){i&&b(t),~e&&a[e].d(i)}}}function Te(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Dn(n,e,o){let t;ye(n,W,C=>o(1,t=C));let l={kind:"list"};function r(){je(W,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),o(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function a(C){window.confirm("Delete this junction?")&&(t.jat.splice(C,1),W.set(t),o(0,l={kind:"list"}))}const s=C=>o(0,l={kind:"edit",idx:C,stage:"existing"}),i=()=>o(0,l={kind:"list"}),_=()=>o(0,l={kind:"edit",idx:Te(l),stage:"existing"}),g=()=>o(0,l={kind:"edit",idx:Te(l),stage:"proposed"}),d=()=>a(Te(l));function u(C){n.$$.not_equal(t.jat[l.idx].name,C)&&(t.jat[l.idx].name=C,W.set(t))}return[l,t,r,a,s,i,_,g,d,u]}class ao extends Le{constructor(e){super(),Me(this,e,Dn,Bn,$e,{})}}export{ao as component};
