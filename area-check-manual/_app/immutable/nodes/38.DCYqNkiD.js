import{s as Me,v as ee,w as te,l as xt,u as en,p as tn,q as nn,E as Le,k as He,U as rn,S as Oe,a as O,g as B,i as v,f as y,r as Be,n as Se,e as Y,t as H,c as x,b as oe,d as J,o as Je,x as Q,h as re,j as de,z as on,B as ye,m as ft,M as ln,N as an}from"../chunks/scheduler.DH2GUgXz.js";import{S as Ge,i as ze,e as ne,c as F,b as T,m as q,t as w,a as k,d as N,g as me,f as ce}from"../chunks/index.BHUn3u8Z.js";import{e as pe}from"../chunks/each.CZblyi7L.js";import{B as sn}from"../chunks/ButtonGroup.D2q4FpCM.js";import{D as St,C as un}from"../chunks/DefaultButton.DSpbdVzv.js";import{W as It,S as he}from"../chunks/WarningButton.DMIZkWvd.js";import{T as tt}from"../chunks/TextInput.CDomP4SG.js";import{s as Z}from"../chunks/data.CmOI2-Ym.js";import{L as fn,g as mn,e as Ft,M as cn,b as gn,C as pn,G as mt,l as Qe,n as ct,h as dn,P as Tt,f as _n}from"../chunks/index.D5MTNeEK.js";import{c as be}from"../chunks/colors.CYEpEtTL.js";import{G as hn}from"../chunks/GeoreferenceLayer.m6UjNBeH.js";import{a as $n,M as De,R as qt,B as bn,G as yn,S as wn,C as vn}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.9azZOhz4.js";import{T as Nt}from"../chunks/TextArea.Bfj0cJeT.js";import{p as kn}from"../chunks/index.IPqBl-0e.js";import{S as jn}from"../chunks/Select.BObLJK-W.js";function En(t){let e;const n=t[16].default,r=xt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,l){r&&r.m(o,l),e=!0},p(o,l){r&&r.p&&(!e||l&16777216)&&en(r,n,o,o[24],e?nn(n,o[24],l,null):tn(o[24]),null)},i(o){e||(w(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function Cn(t){let e,n,r;function o(i){t[17](i)}let l={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[En]},$$scope:{ctx:t}};return t[0]!==void 0&&(l.hovered=t[0]),e=new fn({props:l}),ee.push(()=>ne(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,[a]){const s={};a&2&&(s.id=i[1]),a&4&&(s.source=i[2]),a&8&&(s.sourceLayer=i[3]),a&16&&(s.beforeId=i[4]),a&32&&(s.beforeLayerType=i[5]),a&64&&(s.paint=i[6]),a&128&&(s.layout=i[7]),a&256&&(s.filter=i[8]),a&512&&(s.applyToClusters=i[9]),a&1024&&(s.minzoom=i[10]),a&2048&&(s.maxzoom=i[11]),a&4096&&(s.hoverCursor=i[12]),a&8192&&(s.manageHoverState=i[13]),a&16384&&(s.eventsIfTopMost=i[14]),a&32768&&(s.interactive=i[15]),a&16777216&&(s.$$scope={dirty:a,ctx:i}),!n&&a&1&&(n=!0,s.hovered=i[0],te(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){N(e,i)}}}function Ln(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:l=mn("symbol")}=e,{source:i=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:m=void 0}=e,{paint:g=void 0}=e,{layout:d=void 0}=e,{filter:f=void 0}=e,{applyToClusters:E=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:I=void 0}=e,{hoverCursor:D=void 0}=e,{manageHoverState:S=!1}=e,{hovered:b=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:_=!0}=e;function h(M){b=M,n(0,b)}function p(M){Le.call(this,t,M)}function L(M){Le.call(this,t,M)}function K(M){Le.call(this,t,M)}function A(M){Le.call(this,t,M)}function U(M){Le.call(this,t,M)}function fe(M){Le.call(this,t,M)}return t.$$set=M=>{"id"in M&&n(1,l=M.id),"source"in M&&n(2,i=M.source),"sourceLayer"in M&&n(3,a=M.sourceLayer),"beforeId"in M&&n(4,s=M.beforeId),"beforeLayerType"in M&&n(5,m=M.beforeLayerType),"paint"in M&&n(6,g=M.paint),"layout"in M&&n(7,d=M.layout),"filter"in M&&n(8,f=M.filter),"applyToClusters"in M&&n(9,E=M.applyToClusters),"minzoom"in M&&n(10,C=M.minzoom),"maxzoom"in M&&n(11,I=M.maxzoom),"hoverCursor"in M&&n(12,D=M.hoverCursor),"manageHoverState"in M&&n(13,S=M.manageHoverState),"hovered"in M&&n(0,b=M.hovered),"eventsIfTopMost"in M&&n(14,u=M.eventsIfTopMost),"interactive"in M&&n(15,_=M.interactive),"$$scope"in M&&n(24,o=M.$$scope)},[b,l,i,a,s,m,g,d,f,E,C,I,D,S,u,_,r,h,p,L,K,A,U,fe,o]}class Pn extends Ge{constructor(e){super(),ze(this,e,Ln,Cn,Me,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var An=Object.defineProperty,X=(t,e)=>An(t,"name",{value:e,configurable:!0}),Mn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Te(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ye(e),o=Ye(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Te(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return Te(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Te(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};X(Mn,"GeojsonEquality");function Te(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}X(Te,"sameLength");function Ye(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}X(Ye,"explode");var se=63710088e-1,Ot={centimeters:se*100,centimetres:se*100,degrees:360/(2*Math.PI),feet:se*3.28084,inches:se*39.37,kilometers:se/1e3,kilometres:se/1e3,meters:se,metres:se,miles:se/1609.344,millimeters:se*1e3,millimetres:se*1e3,nauticalmiles:se/1852,radians:1,yards:se*1.0936},gt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function we(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}X(we,"feature");function Sn(t,e,n={}){switch(t){case"Point":return Ke(e).geometry;case"LineString":return rt(e).geometry;case"Polygon":return nt(e).geometry;case"MultiPoint":return Gt(e).geometry;case"MultiLineString":return Bt(e).geometry;case"MultiPolygon":return zt(e).geometry;default:throw new Error(t+" is invalid")}}X(Sn,"geometry");function Ke(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Pe(t[0])||!Pe(t[1]))throw new Error("coordinates must contain numbers");return we({type:"Point",coordinates:t},e,n)}X(Ke,"point");function In(t,e,n={}){return Xe(t.map(r=>Ke(r,e)),n)}X(In,"points");function nt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return we({type:"Polygon",coordinates:t},e,n)}X(nt,"polygon");function Fn(t,e,n={}){return Xe(t.map(r=>nt(r,e)),n)}X(Fn,"polygons");function rt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return we({type:"LineString",coordinates:t},e,n)}X(rt,"lineString");function Tn(t,e,n={}){return Xe(t.map(r=>rt(r,e)),n)}X(Tn,"lineStrings");function Xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}X(Xe,"featureCollection");function Bt(t,e,n={}){return we({type:"MultiLineString",coordinates:t},e,n)}X(Bt,"multiLineString");function Gt(t,e,n={}){return we({type:"MultiPoint",coordinates:t},e,n)}X(Gt,"multiPoint");function zt(t,e,n={}){return we({type:"MultiPolygon",coordinates:t},e,n)}X(zt,"multiPolygon");function qn(t,e,n={}){return we({type:"GeometryCollection",geometries:t},e,n)}X(qn,"geometryCollection");function Nn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}X(Nn,"round");function Dt(t,e="kilometers"){const n=Ot[e];if(!n)throw new Error(e+" units is invalid");return t*n}X(Dt,"radiansToLength");function Ve(t,e="kilometers"){const n=Ot[e];if(!n)throw new Error(e+" units is invalid");return t/n}X(Ve,"lengthToRadians");function On(t,e){return Re(Ve(t,e))}X(On,"lengthToDegrees");function Bn(t){let e=t%360;return e<0&&(e+=360),e}X(Bn,"bearingToAzimuth");function Re(t){return t%(2*Math.PI)*180/Math.PI}X(Re,"radiansToDegrees");function Ue(t){return t%360*Math.PI/180}X(Ue,"degreesToRadians");function Gn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Dt(Ve(t,e),n)}X(Gn,"convertLength");function zn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=gt[e];if(!r)throw new Error("invalid original units");const o=gt[n];if(!o)throw new Error("invalid final units");return t/r*o}X(zn,"convertArea");function Pe(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}X(Pe,"isNumber");function Dn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}X(Dn,"isObject");function Un(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Pe(e))throw new Error("bbox must only contain numbers")})}X(Un,"validateBBox");function Rn(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}X(Rn,"validateId");var Hn=Object.defineProperty,ve=(t,e)=>Hn(t,"name",{value:e,configurable:!0});function Ut(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ve(Ut,"getCoord");function Jn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ve(Jn,"getCoords");function Rt(t){if(t.length>1&&Pe(t[0])&&Pe(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Rt(t[0]);throw new Error("coordinates must only contain numbers")}ve(Rt,"containsNumber");function Kn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ve(Kn,"geojsonType");function Xn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ve(Xn,"featureOf");function Vn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ve(Vn,"collectionOf");function Wn(t){return t.type==="Feature"?t.geometry:t}ve(Wn,"getGeom");function Zn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ve(Zn,"getType");var Qn=Object.defineProperty,Yn=(t,e)=>Qn(t,"name",{value:e,configurable:!0});function Ht(t,e,n,r={}){const o=Ut(t),l=Ue(o[0]),i=Ue(o[1]),a=Ue(n),s=Ve(e,r.units),m=Math.asin(Math.sin(i)*Math.cos(s)+Math.cos(i)*Math.sin(s)*Math.cos(a)),g=l+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(i),Math.cos(s)-Math.sin(i)*Math.sin(m)),d=Re(g),f=Re(m);return Ke([d,f],r.properties)}Yn(Ht,"destination");var pt=Ht,xn=Object.defineProperty,V=(t,e)=>xn(t,"name",{value:e,configurable:!0}),er=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!qe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=xe(e),o=xe(n);return r.every(l=>o.some(i=>this.compare(l,i)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!qe(e,n))return!1;const l=e;let i=n;if(o&&!this.compareCoord(l[0],i[0])){const s=this.fixStartIndex(i,l);if(s)i=s;else return!1}const a=this.compareCoord(l[r],i[r]);return this.direction||a?this.comparePath(l,i):this.compareCoord(l[r],i[i.length-(1+r)])?this.comparePath(l.slice().reverse(),i):!1}fixStartIndex(e,n){let r,o=-1;for(let l=0;l<e.length;l++)if(this.compareCoord(e[l],n[0])){o=l;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(l=>o.some(i=>this.compareLine(l,i,1,!0)))}return!1}compareGeometryCollection(e,n){return qe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return qe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};V(er,"GeojsonEquality");function qe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}V(qe,"sameLength");function xe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}V(xe,"explode");var ue=63710088e-1,Jt={centimeters:ue*100,centimetres:ue*100,degrees:360/(2*Math.PI),feet:ue*3.28084,inches:ue*39.37,kilometers:ue/1e3,kilometres:ue/1e3,meters:ue,metres:ue,miles:ue/1609.344,millimeters:ue*1e3,millimetres:ue*1e3,nauticalmiles:ue/1852,radians:1,yards:ue*1.0936},dt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function ke(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}V(ke,"feature");function tr(t,e,n={}){switch(t){case"Point":return ot(e).geometry;case"LineString":return lt(e).geometry;case"Polygon":return it(e).geometry;case"MultiPoint":return Xt(e).geometry;case"MultiLineString":return Kt(e).geometry;case"MultiPolygon":return Vt(e).geometry;default:throw new Error(t+" is invalid")}}V(tr,"geometry");function ot(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ae(t[0])||!Ae(t[1]))throw new Error("coordinates must contain numbers");return ke({type:"Point",coordinates:t},e,n)}V(ot,"point");function nr(t,e,n={}){return We(t.map(r=>ot(r,e)),n)}V(nr,"points");function it(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let l=0;l<o[o.length-1].length;l++)if(o[o.length-1][l]!==o[0][l])throw new Error("First and last Position are not equivalent.")}return ke({type:"Polygon",coordinates:t},e,n)}V(it,"polygon");function rr(t,e,n={}){return We(t.map(r=>it(r,e)),n)}V(rr,"polygons");function lt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return ke({type:"LineString",coordinates:t},e,n)}V(lt,"lineString");function or(t,e,n={}){return We(t.map(r=>lt(r,e)),n)}V(or,"lineStrings");function We(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}V(We,"featureCollection");function Kt(t,e,n={}){return ke({type:"MultiLineString",coordinates:t},e,n)}V(Kt,"multiLineString");function Xt(t,e,n={}){return ke({type:"MultiPoint",coordinates:t},e,n)}V(Xt,"multiPoint");function Vt(t,e,n={}){return ke({type:"MultiPolygon",coordinates:t},e,n)}V(Vt,"multiPolygon");function ir(t,e,n={}){return ke({type:"GeometryCollection",geometries:t},e,n)}V(ir,"geometryCollection");function lr(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}V(lr,"round");function Wt(t,e="kilometers"){const n=Jt[e];if(!n)throw new Error(e+" units is invalid");return t*n}V(Wt,"radiansToLength");function at(t,e="kilometers"){const n=Jt[e];if(!n)throw new Error(e+" units is invalid");return t/n}V(at,"lengthToRadians");function ar(t,e){return st(at(t,e))}V(ar,"lengthToDegrees");function sr(t){let e=t%360;return e<0&&(e+=360),e}V(sr,"bearingToAzimuth");function st(t){return t%(2*Math.PI)*180/Math.PI}V(st,"radiansToDegrees");function Ne(t){return t%360*Math.PI/180}V(Ne,"degreesToRadians");function ur(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Wt(at(t,e),n)}V(ur,"convertLength");function fr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=dt[e];if(!r)throw new Error("invalid original units");const o=dt[n];if(!o)throw new Error("invalid final units");return t/r*o}V(fr,"convertArea");function Ae(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}V(Ae,"isNumber");function mr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}V(mr,"isObject");function cr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ae(e))throw new Error("bbox must only contain numbers")})}V(cr,"validateBBox");function gr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}V(gr,"validateId");var pr=Object.defineProperty,je=(t,e)=>pr(t,"name",{value:e,configurable:!0});function et(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}je(et,"getCoord");function dr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}je(dr,"getCoords");function Zt(t){if(t.length>1&&Ae(t[0])&&Ae(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Zt(t[0]);throw new Error("coordinates must only contain numbers")}je(Zt,"containsNumber");function _r(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}je(_r,"geojsonType");function hr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}je(hr,"featureOf");function $r(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}je($r,"collectionOf");function br(t){return t.type==="Feature"?t.geometry:t}je(br,"getGeom");function yr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}je(yr,"getType");var wr=Object.defineProperty,Qt=(t,e)=>wr(t,"name",{value:e,configurable:!0});function ut(t,e,n={}){if(n.final===!0)return Yt(t,e);const r=et(t),o=et(e),l=Ne(r[0]),i=Ne(o[0]),a=Ne(r[1]),s=Ne(o[1]),m=Math.sin(i-l)*Math.cos(s),g=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(i-l);return st(Math.atan2(m,g))}Qt(ut,"bearing");function Yt(t,e){let n=ut(e,t);return n=(n+180)%360,n}Qt(Yt,"calculateFinalBearing");var vr=ut;function _t(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function ht(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function kr(t){let e,n=qr(t[36])+"",r;return{c(){e=Y("span"),r=H(n),this.h()},l(o){e=x(o,"SPAN",{class:!0});var l=oe(e);r=J(l,n),l.forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Q(e,"color","#4472c4"),Q(e,"background-color","white")},m(o,l){v(o,e,l),re(e,r)},p:Se,d(o){o&&y(e)}}}function $t(t){let e,n,r;function o(s){t[17](s,t[37])}function l(){return t[18](t[36])}function i(){return t[19](t[36])}let a={draggable:!0,$$slots:{default:[kr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(a.lngLat=t[37].point),e=new De({props:a}),ee.push(()=>ne(e,"lngLat",o)),e.$on("dragend",l),e.$on("click",i),{c(){F(e.$$.fragment)},l(s){T(e.$$.fragment,s)},m(s,m){q(e,s,m),r=!0},p(s,m){t=s;const g={};m[1]&256&&(g.$$scope={dirty:m,ctx:t}),!n&&m[0]&11&&(n=!0,g.lngLat=t[37].point,te(()=>n=!1)),e.$set(g)},i(s){r||(w(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){N(e,s)}}}function jr(t){let e;return{c(){e=Y("span"),this.h()},l(n){e=x(n,"SPAN",{class:!0}),oe(e).forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score]),Q(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score]),r[0]&11&&Q(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&y(e)}}}function Er(t){let e;return{c(){e=Y("span"),this.h()},l(n){e=x(n,"SPAN",{class:!0}),oe(e).forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score])},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score])},d(n){n&&y(e)}}}function Cr(t){let e;return{c(){e=Y("span"),this.h()},l(n){e=x(n,"SPAN",{class:!0}),oe(e).forEach(y),this.h()},h(){Je(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score]),Q(e,"opacity","0%")},m(n,r){v(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score])},d(n){n&&y(e)}}}function bt(t){let e,n,r,o,l,i,a,s,m;function g(p){t[20](p,t[34])}function d(){return t[21](t[36])}function f(){return t[22](t[36])}let E={draggable:!0,$$slots:{default:[jr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(E.lngLat=t[34].point1),e=new De({props:E}),ee.push(()=>ne(e,"lngLat",g)),e.$on("dragend",d),e.$on("click",f);function C(p){t[23](p,t[34])}function I(){return t[24](t[36])}function D(){return t[25](t[36])}let S={draggable:!0,$$slots:{default:[Er]},$$scope:{ctx:t}};t[34].point2!==void 0&&(S.lngLat=t[34].point2),o=new De({props:S}),ee.push(()=>ne(o,"lngLat",C)),o.$on("dragend",I),o.$on("click",D);function b(p){t[26](p,t[34])}function u(){return t[27](t[36])}function _(){return t[28](t[36])}let h={draggable:!0,$$slots:{default:[Cr]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(h.lngLat=t[34].point3),a=new De({props:h}),ee.push(()=>ne(a,"lngLat",b)),a.$on("dragend",u),a.$on("click",_),{c(){F(e.$$.fragment),r=O(),F(o.$$.fragment),i=O(),F(a.$$.fragment)},l(p){T(e.$$.fragment,p),r=B(p),T(o.$$.fragment,p),i=B(p),T(a.$$.fragment,p)},m(p,L){q(e,p,L),v(p,r,L),q(o,p,L),v(p,i,L),q(a,p,L),m=!0},p(p,L){t=p;const K={};L[0]&11|L[1]&256&&(K.$$scope={dirty:L,ctx:t}),!n&&L[0]&11&&(n=!0,K.lngLat=t[34].point1,te(()=>n=!1)),e.$set(K);const A={};L[0]&11|L[1]&256&&(A.$$scope={dirty:L,ctx:t}),!l&&L[0]&11&&(l=!0,A.lngLat=t[34].point2,te(()=>l=!1)),o.$set(A);const U={};L[0]&11|L[1]&256&&(U.$$scope={dirty:L,ctx:t}),!s&&L[0]&11&&(s=!0,U.lngLat=t[34].point3,te(()=>s=!1)),a.$set(U)},i(p){m||(w(e.$$.fragment,p),w(o.$$.fragment,p),w(a.$$.fragment,p),m=!0)},o(p){k(e.$$.fragment,p),k(o.$$.fragment,p),k(a.$$.fragment,p),m=!1},d(p){p&&(y(r),y(i)),N(e,p),N(o,p),N(a,p)}}}function Lr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=H(e)},l(r){n=J(r,e)},m(r,o){v(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&de(n,e)},d(r){r&&y(n)}}}function Pr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Lr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function Ar(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=H(e)},l(r){n=J(r,e)},m(r,o){v(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&de(n,e)},d(r){r&&y(n)}}}function Mr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Ar,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&260&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function Sr(t){let e,n,r,o,l,i;return e=new Qe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":ct(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Pr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new Qe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":ct(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Mr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),l=new Pn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){F(e.$$.fragment),n=O(),F(r.$$.fragment),o=O(),F(l.$$.fragment)},l(a){T(e.$$.fragment,a),n=B(a),T(r.$$.fragment,a),o=B(a),T(l.$$.fragment,a)},m(a,s){q(e,a,s),v(a,n,s),q(r,a,s),v(a,o,s),q(l,a,s),i=!0},p(a,s){const m={};s[1]&256&&(m.$$scope={dirty:s,ctx:a}),e.$set(m);const g={};s[1]&256&&(g.$$scope={dirty:s,ctx:a}),r.$set(g)},i(a){i||(w(e.$$.fragment,a),w(r.$$.fragment,a),w(l.$$.fragment,a),i=!0)},o(a){k(e.$$.fragment,a),k(r.$$.fragment,a),k(l.$$.fragment,a),i=!1},d(a){a&&(y(n),y(o)),N(e,a),N(r,a),N(l,a)}}}function Ir(t){let e,n,r,o;return e=new Qe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new dn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){F(e.$$.fragment),n=O(),F(r.$$.fragment)},l(l){T(e.$$.fragment,l),n=B(l),T(r.$$.fragment,l)},m(l,i){q(e,l,i),v(l,n,i),q(r,l,i),o=!0},p:Se,i(l){o||(w(e.$$.fragment,l),w(r.$$.fragment,l),o=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),o=!1},d(l){l&&y(n),N(e,l),N(r,l)}}}function Fr(t){let e,n,r,o,l,i,a,s,m,g,d,f;e=new $n({}),e.$on("click",t[8]),r=new pn({props:{gj:t[3].summary.networkMap,show:t[2]}});let E=pe(t[3].jat[t[0]][t[1]].arms),C=[];for(let u=0;u<E.length;u+=1)C[u]=$t(ht(t,E,u));const I=u=>k(C[u],1,1,()=>{C[u]=null});let D=pe(t[3].jat[t[0]][t[1]].movements),S=[];for(let u=0;u<D.length;u+=1)S[u]=bt(_t(t,D,u));const b=u=>k(S[u],1,1,()=>{S[u]=null});return a=new mt({props:{data:t[10](t[3]),$$slots:{default:[Sr]},$$scope:{ctx:t}}}),m=new mt({props:{data:t[5],$$slots:{default:[Ir]},$$scope:{ctx:t}}}),d=new hn({props:{map:t[4]}}),{c(){F(e.$$.fragment),n=O(),F(r.$$.fragment),o=O();for(let u=0;u<C.length;u+=1)C[u].c();l=O();for(let u=0;u<S.length;u+=1)S[u].c();i=O(),F(a.$$.fragment),s=O(),F(m.$$.fragment),g=O(),F(d.$$.fragment)},l(u){T(e.$$.fragment,u),n=B(u),T(r.$$.fragment,u),o=B(u);for(let _=0;_<C.length;_+=1)C[_].l(u);l=B(u);for(let _=0;_<S.length;_+=1)S[_].l(u);i=B(u),T(a.$$.fragment,u),s=B(u),T(m.$$.fragment,u),g=B(u),T(d.$$.fragment,u)},m(u,_){q(e,u,_),v(u,n,_),q(r,u,_),v(u,o,_);for(let h=0;h<C.length;h+=1)C[h]&&C[h].m(u,_);v(u,l,_);for(let h=0;h<S.length;h+=1)S[h]&&S[h].m(u,_);v(u,i,_),q(a,u,_),v(u,s,_),q(m,u,_),v(u,g,_),q(d,u,_),f=!0},p(u,_){const h={};if(_[0]&8&&(h.gj=u[3].summary.networkMap),_[0]&4&&(h.show=u[2]),r.$set(h),_[0]&139){E=pe(u[3].jat[u[0]][u[1]].arms);let A;for(A=0;A<E.length;A+=1){const U=ht(u,E,A);C[A]?(C[A].p(U,_),w(C[A],1)):(C[A]=$t(U),C[A].c(),w(C[A],1),C[A].m(l.parentNode,l))}for(me(),A=E.length;A<C.length;A+=1)I(A);ce()}if(_[0]&203){D=pe(u[3].jat[u[0]][u[1]].movements);let A;for(A=0;A<D.length;A+=1){const U=_t(u,D,A);S[A]?(S[A].p(U,_),w(S[A],1)):(S[A]=bt(U),S[A].c(),w(S[A],1),S[A].m(i.parentNode,i))}for(me(),A=D.length;A<S.length;A+=1)b(A);ce()}const p={};_[0]&8&&(p.data=u[10](u[3])),_[1]&256&&(p.$$scope={dirty:_,ctx:u}),a.$set(p);const L={};_[0]&32&&(L.data=u[5]),_[1]&256&&(L.$$scope={dirty:_,ctx:u}),m.$set(L);const K={};_[0]&16&&(K.map=u[4]),d.$set(K)},i(u){if(!f){w(e.$$.fragment,u),w(r.$$.fragment,u);for(let _=0;_<E.length;_+=1)w(C[_]);for(let _=0;_<D.length;_+=1)w(S[_]);w(a.$$.fragment,u),w(m.$$.fragment,u),w(d.$$.fragment,u),f=!0}},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),C=C.filter(Boolean);for(let _=0;_<C.length;_+=1)k(C[_]);S=S.filter(Boolean);for(let _=0;_<S.length;_+=1)k(S[_]);k(a.$$.fragment,u),k(m.$$.fragment,u),k(d.$$.fragment,u),f=!1},d(u){u&&(y(n),y(o),y(l),y(i),y(s),y(g)),N(e,u),N(r,u),Be(C,u),Be(S,u),N(a,u),N(m,u),N(d,u)}}}function Tr(t){let e,n,r;function o(i){t[29](i)}let l={$$slots:{default:[Fr]},$$scope:{ctx:t}};return t[4]!==void 0&&(l.map=t[4]),e=new cn({props:l}),ee.push(()=>ne(e,"map",o)),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,a){const s={};a[0]&63|a[1]&256&&(s.$$scope={dirty:a,ctx:i}),!n&&a[0]&16&&(n=!0,s.map=i[4],te(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){N(e,i)}}}function yt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function qr(t){return String.fromCharCode(t+65)}function Nr(t,e,n){let r,o;He(t,Z,$=>n(3,o=$));let{junctionIdx:l}=e,{stage:i}=e,{newKind:a}=e,{editing:s}=e,{hoveringSidebar:m}=e,{streetviewOn:g}=e,{showContext:d}=e,f,E={0:be.red.background,1:be.amber.background,2:be.green.background,X:be.critical.background};function C($,G,z){let _e={type:"FeatureCollection",features:[]},W=G??z;return W!=null&&(W.kind=="arm"?_e.features.push(yt($.jat[l][i].arms[W.idx],W.idx)):_e.features.push(u($.jat[l][i].movements[W.idx],W.idx))),_e}function I($){n(11,s=$),n(12,m=null)}function D($){if(!g){for(let G of f.queryRenderedFeatures($.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(11,s=null);return}a=="arm"?(Oe(Z,o.jat[l][i].arms=[...o.jat[l][i].arms,{point:$.detail.lngLat.toArray(),name:""}],o),I({kind:"arm",idx:o.jat[l][i].arms.length-1})):(Oe(Z,o.jat[l][i].movements=[...o.jat[l][i].movements,{point1:$.detail.lngLat.toArray(),point2:pt($.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:pt($.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),I({kind:"movement",idx:o.jat[l][i].movements.length-1}))}}function S($){I({kind:"movement",idx:$.detail.features[0].id})}rn(()=>{h(!1)});function b($){let G={type:"FeatureCollection",features:$.jat[l][i].movements.map((z,_e)=>u(z,_e))};for(let z of $.jat[l][i].movements)if(G.features.push(_(z,G.features.length)),z.kind=="walking & wheeling"){let _e={...z,point1:z.point3,point3:z.point1};G.features.push(_(_e,G.features.length))}return G}function u($,G){return{type:"Feature",id:G,properties:{name:$.name,kind:$.kind,color:E[$.score]},geometry:{type:"LineString",coordinates:[$.point1,$.point2,$.point3]}}}function _($,G){return{type:"Feature",id:G,properties:{kind:$.kind,color:E[$.score],angle:vr($.point2,$.point3)},geometry:{type:"Point",coordinates:$.point3}}}function h($){let G=b(o);for(let z of o.jat[l][i].arms)G.features.push(yt(z,G.features.length));for(let z of o.summary.networkMap.features)G.features.push(z);G.features.length>0&&f.fitBounds(gn(G),{padding:20,animate:$})}function p(){return f}function L($,G){t.$$.not_equal(G.point,$)&&(G.point=$,Z.set(o))}const K=$=>I({kind:"arm",idx:$}),A=$=>I({kind:"arm",idx:$});function U($,G){t.$$.not_equal(G.point1,$)&&(G.point1=$,Z.set(o))}const fe=$=>I({kind:"movement",idx:$}),M=$=>I({kind:"movement",idx:$});function $e($,G){t.$$.not_equal(G.point2,$)&&(G.point2=$,Z.set(o))}const ie=$=>I({kind:"movement",idx:$}),Ie=$=>I({kind:"movement",idx:$});function Ce($,G){t.$$.not_equal(G.point3,$)&&(G.point3=$,Z.set(o))}const ge=$=>I({kind:"movement",idx:$}),j=$=>I({kind:"movement",idx:$});function Ee($){f=$,n(4,f)}return t.$$set=$=>{"junctionIdx"in $&&n(0,l=$.junctionIdx),"stage"in $&&n(1,i=$.stage),"newKind"in $&&n(13,a=$.newKind),"editing"in $&&n(11,s=$.editing),"hoveringSidebar"in $&&n(12,m=$.hoveringSidebar),"streetviewOn"in $&&n(14,g=$.streetviewOn),"showContext"in $&&n(2,d=$.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=C(o,s,m))},[l,i,d,o,f,r,E,I,D,S,b,s,m,a,g,h,p,L,K,A,U,fe,M,$e,ie,Ie,Ce,ge,j,Ee]}class Or extends Ge{constructor(e){super(),ze(this,e,Nr,Tr,Me,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Br(t){let e,n,r,o,l,i,a,s,m,g,d,f;function E(h){t[5](h)}let C={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(C.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new tt({props:C}),ee.push(()=>ne(e,"value",E));function I(h){t[6](h)}let D={legend:"Movement",choices:kn(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(D.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new qt({props:D}),ee.push(()=>ne(o,"value",I));function S(h){t[7](h)}let b={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&(b.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),a=new jn({props:b}),ee.push(()=>ne(a,"value",S));function u(h){t[8](h)}let _={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(_.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),g=new Nt({props:_}),ee.push(()=>ne(g,"value",u)),{c(){F(e.$$.fragment),r=O(),F(o.$$.fragment),i=O(),F(a.$$.fragment),m=O(),F(g.$$.fragment)},l(h){T(e.$$.fragment,h),r=B(h),T(o.$$.fragment,h),i=B(h),T(a.$$.fragment,h),m=B(h),T(g.$$.fragment,h)},m(h,p){q(e,h,p),v(h,r,p),q(o,h,p),v(h,i,p),q(a,h,p),v(h,m,p),q(g,h,p),f=!0},p(h,[p]){const L={};!n&&p&15&&(n=!0,L.value=h[3].jat[h[0]][h[1]].movements[h[2]].name,te(()=>n=!1)),e.$set(L);const K={};!l&&p&15&&(l=!0,K.value=h[3].jat[h[0]][h[1]].movements[h[2]].kind,te(()=>l=!1)),o.$set(K);const A={};!s&&p&15&&(s=!0,A.value=h[3].jat[h[0]][h[1]].movements[h[2]].score,te(()=>s=!1)),a.$set(A);const U={};!d&&p&15&&(d=!0,U.value=h[3].jat[h[0]][h[1]].movements[h[2]].notes,te(()=>d=!1)),g.$set(U)},i(h){f||(w(e.$$.fragment,h),w(o.$$.fragment,h),w(a.$$.fragment,h),w(g.$$.fragment,h),f=!0)},o(h){k(e.$$.fragment,h),k(o.$$.fragment,h),k(a.$$.fragment,h),k(g.$$.fragment,h),f=!1},d(h){h&&(y(r),y(i),y(m)),N(e,h),N(o,h),N(a,h),N(g,h)}}}function Gr(t,e,n){let r;He(t,Z,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:l}=e,{idx:i}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(f){t.$$.not_equal(r.jat[o][l].movements[i].name,f)&&(r.jat[o][l].movements[i].name=f,Z.set(r))}function m(f){t.$$.not_equal(r.jat[o][l].movements[i].kind,f)&&(r.jat[o][l].movements[i].kind=f,Z.set(r))}function g(f){t.$$.not_equal(r.jat[o][l].movements[i].score,f)&&(r.jat[o][l].movements[i].score=f,Z.set(r))}function d(f){t.$$.not_equal(r.jat[o][l].movements[i].notes,f)&&(r.jat[o][l].movements[i].notes=f,Z.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,l=f.stage),"idx"in f&&n(2,i=f.idx)},[o,l,i,r,a,s,m,g,d]}class zr extends Ge{constructor(e){super(),ze(this,e,Gr,Br,Me,{junctionIdx:0,stage:1,idx:2})}}const{window:Dr}=_n;function wt(t,e,n){const r=t.slice();return r[31]=e[n],r[33]=n,r}function vt(t,e,n){const r=t.slice();return r[34]=e[n],r[33]=n,r}function Ur(t){let e,n,r,o,l,i,a,s;e=new St({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),e.$on("click",t[27]),r=new It({props:{$$slots:{default:[Jr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const m=[Xr,Kr],g=[];function d(f,E){return f[3].kind=="movement"?0:1}return l=d(t),i=g[l]=m[l](t),{c(){F(e.$$.fragment),n=O(),F(r.$$.fragment),o=O(),i.c(),a=ye()},l(f){T(e.$$.fragment,f),n=B(f),T(r.$$.fragment,f),o=B(f),i.l(f),a=ye()},m(f,E){q(e,f,E),v(f,n,E),q(r,f,E),v(f,o,E),g[l].m(f,E),v(f,a,E),s=!0},p(f,E){const C={};E[1]&32&&(C.$$scope={dirty:E,ctx:f}),e.$set(C);const I={};E[1]&32&&(I.$$scope={dirty:E,ctx:f}),r.$set(I);let D=l;l=d(f),l===D?g[l].p(f,E):(me(),k(g[D],1,1,()=>{g[D]=null}),ce(),i=g[l],i?i.p(f,E):(i=g[l]=m[l](f),i.c()),w(i,1),i.m(a.parentNode,a))},i(f){s||(w(e.$$.fragment,f),w(r.$$.fragment,f),w(i),s=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(i),s=!1},d(f){f&&(y(n),y(o),y(a)),N(e,f),N(r,f),g[l].d(f)}}}function Rr(t){let e,n,r,o,l,i,a,s=(t[8].jat[t[0]].name||"Untitled junction")+"",m,g,d,f,E,C,I,D="Arms",S,b,u,_,h,p="Movements",L,K,A,U,fe;e=new un({props:{label:"Tools",$$slots:{default:[Zr]},$$scope:{ctx:t}}});function M(c,P){return c[8].jat[c[0]][c[1]].movements.length>0?Yr:Qr}let $e=M(t),ie=$e(t);function Ie(c){t[20](c)}let Ce={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(Ce.value=t[2]),f=new qt({props:Ce}),ee.push(()=>ne(f,"value",Ie));let ge=pe(t[8].jat[t[0]][t[1]].arms),j=[];for(let c=0;c<ge.length;c+=1)j[c]=kt(vt(t,ge,c));const Ee=c=>k(j[c],1,1,()=>{j[c]=null});let $=t[8].jat[t[0]][t[9]].arms.length>0&&jt(t),G=pe(t[8].jat[t[0]][t[1]].movements),z=[];for(let c=0;c<G.length;c+=1)z[c]=Et(wt(t,G,c));const _e=c=>k(z[c],1,1,()=>{z[c]=null});let W=t[8].jat[t[0]][t[9]].movements.length>0&&Ct(t);return{c(){F(e.$$.fragment),n=O(),r=Y("p"),o=H("Total JAT score for "),l=H(t[1]),i=O(),a=Y("u"),m=H(s),g=H(`
        :
        `),ie.c(),d=O(),F(f.$$.fragment),C=O(),I=Y("h3"),I.textContent=D,S=O(),b=Y("ul");for(let c=0;c<j.length;c+=1)j[c].c();u=O(),$&&$.c(),_=O(),h=Y("h3"),h.textContent=p,L=O(),K=Y("ol");for(let c=0;c<z.length;c+=1)z[c].c();A=O(),W&&W.c(),U=ye()},l(c){T(e.$$.fragment,c),n=B(c),r=x(c,"P",{});var P=oe(r);o=J(P,"Total JAT score for "),l=J(P,t[1]),i=B(P),a=x(P,"U",{});var le=oe(a);m=J(le,s),le.forEach(y),g=J(P,`
        :
        `),ie.l(P),P.forEach(y),d=B(c),T(f.$$.fragment,c),C=B(c),I=x(c,"H3",{"data-svelte-h":!0}),ft(I)!=="svelte-ld74qb"&&(I.textContent=D),S=B(c),b=x(c,"UL",{});var Fe=oe(b);for(let ae=0;ae<j.length;ae+=1)j[ae].l(Fe);Fe.forEach(y),u=B(c),$&&$.l(c),_=B(c),h=x(c,"H3",{"data-svelte-h":!0}),ft(h)!=="svelte-1dc52s8"&&(h.textContent=p),L=B(c),K=x(c,"OL",{});var R=oe(K);for(let ae=0;ae<z.length;ae+=1)z[ae].l(R);R.forEach(y),A=B(c),W&&W.l(c),U=ye()},m(c,P){q(e,c,P),v(c,n,P),v(c,r,P),re(r,o),re(r,l),re(r,i),re(r,a),re(a,m),re(r,g),ie.m(r,null),v(c,d,P),q(f,c,P),v(c,C,P),v(c,I,P),v(c,S,P),v(c,b,P);for(let le=0;le<j.length;le+=1)j[le]&&j[le].m(b,null);v(c,u,P),$&&$.m(c,P),v(c,_,P),v(c,h,P),v(c,L,P),v(c,K,P);for(let le=0;le<z.length;le+=1)z[le]&&z[le].m(K,null);v(c,A,P),W&&W.m(c,P),v(c,U,P),fe=!0},p(c,P){const le={};P[0]&224|P[1]&32&&(le.$$scope={dirty:P,ctx:c}),e.$set(le),(!fe||P[0]&2)&&de(l,c[1]),(!fe||P[0]&257)&&s!==(s=(c[8].jat[c[0]].name||"Untitled junction")+"")&&de(m,s),$e===($e=M(c))&&ie?ie.p(c,P):(ie.d(1),ie=$e(c),ie&&(ie.c(),ie.m(r,null)));const Fe={};if(!E&&P[0]&4&&(E=!0,Fe.value=c[2],te(()=>E=!1)),f.$set(Fe),P[0]&1299){ge=pe(c[8].jat[c[0]][c[1]].arms);let R;for(R=0;R<ge.length;R+=1){const ae=vt(c,ge,R);j[R]?(j[R].p(ae,P),w(j[R],1)):(j[R]=kt(ae),j[R].c(),w(j[R],1),j[R].m(b,null))}for(me(),R=ge.length;R<j.length;R+=1)Ee(R);ce()}if(c[8].jat[c[0]][c[9]].arms.length>0?$?($.p(c,P),P[0]&257&&w($,1)):($=jt(c),$.c(),w($,1),$.m(_.parentNode,_)):$&&(me(),k($,1,1,()=>{$=null}),ce()),P[0]&34067){G=pe(c[8].jat[c[0]][c[1]].movements);let R;for(R=0;R<G.length;R+=1){const ae=wt(c,G,R);z[R]?(z[R].p(ae,P),w(z[R],1)):(z[R]=Et(ae),z[R].c(),w(z[R],1),z[R].m(K,null))}for(me(),R=G.length;R<z.length;R+=1)_e(R);ce()}c[8].jat[c[0]][c[9]].movements.length>0?W?(W.p(c,P),P[0]&257&&w(W,1)):(W=Ct(c),W.c(),w(W,1),W.m(U.parentNode,U)):W&&(me(),k(W,1,1,()=>{W=null}),ce())},i(c){if(!fe){w(e.$$.fragment,c),w(f.$$.fragment,c);for(let P=0;P<ge.length;P+=1)w(j[P]);w($);for(let P=0;P<G.length;P+=1)w(z[P]);w(W),fe=!0}},o(c){k(e.$$.fragment,c),k(f.$$.fragment,c),j=j.filter(Boolean);for(let P=0;P<j.length;P+=1)k(j[P]);k($),z=z.filter(Boolean);for(let P=0;P<z.length;P+=1)k(z[P]);k(W),fe=!1},d(c){c&&(y(n),y(r),y(d),y(C),y(I),y(S),y(b),y(u),y(_),y(h),y(L),y(K),y(A),y(U)),N(e,c),ie.d(),N(f,c),Be(j,c),$&&$.d(c),Be(z,c),W&&W.d(c)}}}function Hr(t){let e;return{c(){e=H("Save")},l(n){e=J(n,"Save")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Jr(t){let e;return{c(){e=H("Delete")},l(n){e=J(n,"Delete")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Kr(t){let e,n,r;function o(i){t[28](i)}let l={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(l.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new tt({props:l}),ee.push(()=>ne(e,"value",o)),{c(){F(e.$$.fragment)},l(i){T(e.$$.fragment,i)},m(i,a){q(e,i,a),r=!0},p(i,a){const s={};!n&&a[0]&267&&(n=!0,s.value=i[8].jat[i[0]][i[1]].arms[i[3].idx].name,te(()=>n=!1)),e.$set(s)},i(i){r||(w(e.$$.fragment,i),r=!0)},o(i){k(e.$$.fragment,i),r=!1},d(i){N(e,i)}}}function Xr(t){let e,n;return e=new zr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[0]&1&&(l.junctionIdx=r[0]),o[0]&2&&(l.stage=r[1]),o[0]&8&&(l.idx=r[3].idx),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function Vr(t){let e;return{c(){e=H("Zoom to fit")},l(n){e=J(n,"Zoom to fit")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Wr(t){let e;return{c(){e=H("Show scheme context")},l(n){e=J(n,"Show scheme context")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function Zr(t){var S;let e,n,r,o,l,i,a,s,m,g,d,f;e=new he({props:{$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[17]),r=new bn({}),l=new yn({});function E(b){t[18](b)}let C={map:(S=t[7])==null?void 0:S.getMap()};t[5]!==void 0&&(C.enabled=t[5]),a=new wn({props:C}),ee.push(()=>ne(a,"enabled",E));function I(b){t[19](b)}let D={$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[6]!==void 0&&(D.checked=t[6]),g=new vn({props:D}),ee.push(()=>ne(g,"checked",I)),{c(){F(e.$$.fragment),n=O(),F(r.$$.fragment),o=O(),F(l.$$.fragment),i=O(),F(a.$$.fragment),m=O(),F(g.$$.fragment)},l(b){T(e.$$.fragment,b),n=B(b),T(r.$$.fragment,b),o=B(b),T(l.$$.fragment,b),i=B(b),T(a.$$.fragment,b),m=B(b),T(g.$$.fragment,b)},m(b,u){q(e,b,u),v(b,n,u),q(r,b,u),v(b,o,u),q(l,b,u),v(b,i,u),q(a,b,u),v(b,m,u),q(g,b,u),f=!0},p(b,u){var L;const _={};u[1]&32&&(_.$$scope={dirty:u,ctx:b}),e.$set(_);const h={};u[0]&128&&(h.map=(L=b[7])==null?void 0:L.getMap()),!s&&u[0]&32&&(s=!0,h.enabled=b[5],te(()=>s=!1)),a.$set(h);const p={};u[1]&32&&(p.$$scope={dirty:u,ctx:b}),!d&&u[0]&64&&(d=!0,p.checked=b[6],te(()=>d=!1)),g.$set(p)},i(b){f||(w(e.$$.fragment,b),w(r.$$.fragment,b),w(l.$$.fragment,b),w(a.$$.fragment,b),w(g.$$.fragment,b),f=!0)},o(b){k(e.$$.fragment,b),k(r.$$.fragment,b),k(l.$$.fragment,b),k(a.$$.fragment,b),k(g.$$.fragment,b),f=!1},d(b){b&&(y(n),y(o),y(i),y(m)),N(e,b),N(r,b),N(l,b),N(a,b),N(g,b)}}}function Qr(t){let e;return{c(){e=H("No movements added")},l(n){e=J(n,"No movements added")},m(n,r){v(n,e,r)},p:Se,d(n){n&&y(e)}}}function Yr(t){let e=Math.round(Lt(t[8].jat[t[0]][t[1]]))+"",n,r;return{c(){n=H(e),r=H("%")},l(o){n=J(o,e),r=J(o,"%")},m(o,l){v(o,n,l),v(o,r,l)},p(o,l){l[0]&259&&e!==(e=Math.round(Lt(o[8].jat[o[0]][o[1]]))+"")&&de(n,e)},d(o){o&&(y(n),y(r))}}}function xr(t){let e=oo(t[33])+"",n,r,o=(t[34].name||"Unnamed arm")+"",l;return{c(){n=H(e),r=H(" - "),l=H(o)},l(i){n=J(i,e),r=J(i," - "),l=J(i,o)},m(i,a){v(i,n,a),v(i,r,a),v(i,l,a)},p(i,a){a[0]&259&&o!==(o=(i[34].name||"Unnamed arm")+"")&&de(l,o)},d(i){i&&(y(n),y(r),y(l))}}}function kt(t){let e,n,r,o;function l(){return t[21](t[33])}function i(){return t[22](t[33])}return n=new he({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[23]),{c(){e=Y("li"),F(n.$$.fragment),r=O()},l(a){e=x(a,"LI",{});var s=oe(e);T(n.$$.fragment,s),r=B(s),s.forEach(y)},m(a,s){v(a,e,s),q(n,e,null),re(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&32&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&y(e),N(n)}}}function jt(t){let e,n;return e=new he({props:{$$slots:{default:[eo]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&32&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function eo(t){let e,n;return{c(){e=H("Copy arms from "),n=H(t[9])},l(r){e=J(r,"Copy arms from "),n=J(r,t[9])},m(r,o){v(r,e,o),v(r,n,o)},p:Se,d(r){r&&(y(e),y(n))}}}function to(t){let e=(t[31].name||"Unnamed movement")+"",n,r,o,l=t[15](t[31])+"",i;return{c(){n=H(e),r=H(" ("),o=new ln(!1),i=H(")"),this.h()},l(a){n=J(a,e),r=J(a," ("),o=an(a,!1),i=J(a,")"),this.h()},h(){o.a=i},m(a,s){v(a,n,s),v(a,r,s),o.m(l,a,s),v(a,i,s)},p(a,s){s[0]&259&&e!==(e=(a[31].name||"Unnamed movement")+"")&&de(n,e),s[0]&259&&l!==(l=a[15](a[31])+"")&&o.p(l)},d(a){a&&(y(n),y(r),o.d(),y(i))}}}function Et(t){let e,n,r,o;function l(){return t[24](t[33])}function i(){return t[25](t[33])}return n=new he({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),n.$on("click",l),n.$on("mouseenter",i),n.$on("mouseleave",t[26]),{c(){e=Y("li"),F(n.$$.fragment),r=O()},l(a){e=x(a,"LI",{});var s=oe(e);T(n.$$.fragment,s),r=B(s),s.forEach(y)},m(a,s){v(a,e,s),q(n,e,null),re(e,r),o=!0},p(a,s){t=a;const m={};s[0]&259|s[1]&32&&(m.$$scope={dirty:s,ctx:t}),n.$set(m)},i(a){o||(w(n.$$.fragment,a),o=!0)},o(a){k(n.$$.fragment,a),o=!1},d(a){a&&y(e),N(n)}}}function Ct(t){let e,n;return e=new he({props:{$$slots:{default:[no]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o[1]&32&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function no(t){let e,n;return{c(){e=H("Copy movements from "),n=H(t[9])},l(r){e=J(r,"Copy movements from "),n=J(r,t[9])},m(r,o){v(r,e,o),v(r,n,o)},p:Se,d(r){r&&(y(e),y(n))}}}function ro(t){let e,n,r,o,l,i,a,s,m,g,d,f,E,C;function I(p){t[16](p)}let D={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(D.value=t[8].jat[t[0]][t[1]].notes),e=new Nt({props:D}),ee.push(()=>ne(e,"value",I));const S=[Rr,Ur],b=[];function u(p,L){return p[3]==null?0:1}i=u(t),a=b[i]=S[i](t);function _(p){t[30](p)}let h={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(h.editing=t[3]),g=new Or({props:h}),t[29](g),ee.push(()=>ne(g,"editing",_)),{c(){F(e.$$.fragment),r=O(),o=Y("div"),l=Y("div"),a.c(),s=O(),m=Y("div"),F(g.$$.fragment),this.h()},l(p){T(e.$$.fragment,p),r=B(p),o=x(p,"DIV",{style:!0});var L=oe(o);l=x(L,"DIV",{style:!0});var K=oe(l);a.l(K),K.forEach(y),s=B(L),m=x(L,"DIV",{style:!0});var A=oe(m);T(g.$$.fragment,A),A.forEach(y),L.forEach(y),this.h()},h(){Q(l,"width","30%"),Q(l,"overflow-y","scroll"),Q(l,"padding","10px"),Q(l,"border","1px solid black"),Q(m,"position","relative"),Q(m,"width","100%"),Q(o,"display","flex"),Q(o,"height","80vh")},m(p,L){q(e,p,L),v(p,r,L),v(p,o,L),re(o,l),b[i].m(l,null),re(o,s),re(o,m),q(g,m,null),f=!0,E||(C=on(Dr,"keydown",t[12]),E=!0)},p(p,L){const K={};!n&&L[0]&259&&(n=!0,K.value=p[8].jat[p[0]][p[1]].notes,te(()=>n=!1)),e.$set(K);let A=i;i=u(p),i===A?b[i].p(p,L):(me(),k(b[A],1,1,()=>{b[A]=null}),ce(),a=b[i],a?a.p(p,L):(a=b[i]=S[i](p),a.c()),w(a,1),a.m(l,null));const U={};L[0]&1&&(U.junctionIdx=p[0]),L[0]&2&&(U.stage=p[1]),L[0]&4&&(U.newKind=p[2]),L[0]&16&&(U.hoveringSidebar=p[4]),L[0]&32&&(U.streetviewOn=p[5]),L[0]&64&&(U.showContext=p[6]),!d&&L[0]&8&&(d=!0,U.editing=p[3],te(()=>d=!1)),g.$set(U)},i(p){f||(w(e.$$.fragment,p),w(a),w(g.$$.fragment,p),f=!0)},o(p){k(e.$$.fragment,p),k(a),k(g.$$.fragment,p),f=!1},d(p){p&&(y(r),y(o)),N(e,p),b[i].d(),t[29](null),N(g),E=!1,C()}}}function oo(t){return String.fromCharCode(t+65)}function Lt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function io(t,e,n){let r;He(t,Z,j=>n(8,r=j));let{junctionIdx:o}=e,{stage:l}=e,i=l=="existing"?"proposed":"existing",a="arm",s=null,m=null,g=!1,d=!0,f=null;function E(j){n(3,s=j),n(4,m=null)}function C(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][l].movements.splice(s.idx,1),Z.set(r)):(r.jat[o][l].arms.splice(s.idx,1),Z.set(r)),n(3,s=null))}function I(j){if(s!=null&&j.key=="Escape")j.stopPropagation(),n(3,s=null);else if(s!=null&&j.key=="Delete"){let Ee=j.target.tagName;if(Ee=="INPUT"||Ee=="TEXTAREA")return;j.stopPropagation(),C()}}function D(){r.jat[o][l].arms.length>0&&!window.confirm("Overwrite arms?")||(Oe(Z,r.jat[o][l].arms=JSON.parse(JSON.stringify(r.jat[o][i].arms)),r),Z.set(r))}function S(){r.jat[o][l].movements.length>0&&!window.confirm("Overwrite movements?")||(Oe(Z,r.jat[o][l].movements=JSON.parse(JSON.stringify(r.jat[o][i].movements)),r),Z.set(r))}function b(j){return`<span style="color: ${{0:be.red.background,1:be.amber.background,2:be.green.background,X:be.critical.background}[j.score]}">score ${j.score}</span>`}function u(j){t.$$.not_equal(r.jat[o][l].notes,j)&&(r.jat[o][l].notes=j,Z.set(r))}const _=()=>f==null?void 0:f.zoom(!0);function h(j){g=j,n(5,g)}function p(j){d=j,n(6,d)}function L(j){a=j,n(2,a)}const K=j=>E({kind:"arm",idx:j}),A=j=>n(4,m={kind:"arm",idx:j}),U=()=>n(4,m=null),fe=j=>E({kind:"movement",idx:j}),M=j=>n(4,m={kind:"movement",idx:j}),$e=()=>n(4,m=null),ie=()=>n(3,s=null);function Ie(j){t.$$.not_equal(r.jat[o][l].arms[s.idx].name,j)&&(r.jat[o][l].arms[s.idx].name=j,Z.set(r))}function Ce(j){ee[j?"unshift":"push"](()=>{f=j,n(7,f)})}function ge(j){s=j,n(3,s)}return t.$$set=j=>{"junctionIdx"in j&&n(0,o=j.junctionIdx),"stage"in j&&n(1,l=j.stage)},[o,l,a,s,m,g,d,f,r,i,E,C,I,D,S,b,u,_,h,p,L,K,A,U,fe,M,$e,ie,Ie,Ce,ge]}class lo extends Ge{constructor(e){super(),ze(this,e,io,ro,Me,{junctionIdx:0,stage:1},null,[-1,-1])}}function Pt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function ao(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,l=t[0].stage+"",i,a,s,m,g,d,f,E=t[0].stage,C,I;s=new sn({props:{$$slots:{default:[_o]},$$scope:{ctx:t}}});function D(u){t[9](u)}let S={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(S.value=t[1].jat[t[0].idx].name),g=new tt({props:S}),ee.push(()=>ne(g,"value",D));let b=At(t);return{c(){e=Y("h2"),r=H(n),o=H(" - "),i=H(l),a=O(),F(s.$$.fragment),m=O(),F(g.$$.fragment),f=O(),b.c(),C=ye()},l(u){e=x(u,"H2",{});var _=oe(e);r=J(_,n),o=J(_," - "),i=J(_,l),_.forEach(y),a=B(u),T(s.$$.fragment,u),m=B(u),T(g.$$.fragment,u),f=B(u),b.l(u),C=ye()},m(u,_){v(u,e,_),re(e,r),re(e,o),re(e,i),v(u,a,_),q(s,u,_),v(u,m,_),q(g,u,_),v(u,f,_),b.m(u,_),v(u,C,_),I=!0},p(u,_){(!I||_&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&de(r,n),(!I||_&1)&&l!==(l=u[0].stage+"")&&de(i,l);const h={};_&8193&&(h.$$scope={dirty:_,ctx:u}),s.$set(h);const p={};!d&&_&3&&(d=!0,p.value=u[1].jat[u[0].idx].name,te(()=>d=!1)),g.$set(p),_&1&&Me(E,E=u[0].stage)?(me(),k(b,1,1,Se),ce(),b=At(u),b.c(),w(b,1),b.m(C.parentNode,C)):b.p(u,_)},i(u){I||(w(s.$$.fragment,u),w(g.$$.fragment,u),w(b),I=!0)},o(u){k(s.$$.fragment,u),k(g.$$.fragment,u),k(b),I=!1},d(u){u&&(y(e),y(a),y(m),y(f),y(C)),N(s,u),N(g,u),b.d(u)}}}function so(t){let e,n,r,o;e=new St({props:{$$slots:{default:[ho]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let l=pe(t[1].jat),i=[];for(let s=0;s<l.length;s+=1)i[s]=Mt(Pt(t,l,s));const a=s=>k(i[s],1,1,()=>{i[s]=null});return{c(){F(e.$$.fragment),n=O(),r=Y("ol");for(let s=0;s<i.length;s+=1)i[s].c()},l(s){T(e.$$.fragment,s),n=B(s),r=x(s,"OL",{});var m=oe(r);for(let g=0;g<i.length;g+=1)i[g].l(m);m.forEach(y)},m(s,m){q(e,s,m),v(s,n,m),v(s,r,m);for(let g=0;g<i.length;g+=1)i[g]&&i[g].m(r,null);o=!0},p(s,m){const g={};if(m&8192&&(g.$$scope={dirty:m,ctx:s}),e.$set(g),m&3){l=pe(s[1].jat);let d;for(d=0;d<l.length;d+=1){const f=Pt(s,l,d);i[d]?(i[d].p(f,m),w(i[d],1)):(i[d]=Mt(f),i[d].c(),w(i[d],1),i[d].m(r,null))}for(me(),d=l.length;d<i.length;d+=1)a(d);ce()}},i(s){if(!o){w(e.$$.fragment,s);for(let m=0;m<l.length;m+=1)w(i[m]);o=!0}},o(s){k(e.$$.fragment,s),i=i.filter(Boolean);for(let m=0;m<i.length;m+=1)k(i[m]);o=!1},d(s){s&&(y(n),y(r)),N(e,s),Be(i,s)}}}function uo(t){let e;return{c(){e=H("Back to all junctions")},l(n){e=J(n,"Back to all junctions")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function fo(t){let e,n;return e=new he({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function mo(t){let e,n;return e=new he({props:{$$slots:{default:[go]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&8192&&(l.$$scope={dirty:o,ctx:r}),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function co(t){let e;return{c(){e=H("Edit Proposed")},l(n){e=J(n,"Edit Proposed")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function go(t){let e;return{c(){e=H("Edit Existing")},l(n){e=J(n,"Edit Existing")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function po(t){let e;return{c(){e=H("Delete")},l(n){e=J(n,"Delete")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function _o(t){let e,n,r,o,l,i,a;e=new he({props:{$$slots:{default:[uo]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const s=[mo,fo],m=[];function g(d,f){return d[0].stage=="proposed"?0:1}return r=g(t),o=m[r]=s[r](t),i=new It({props:{$$slots:{default:[po]},$$scope:{ctx:t}}}),i.$on("click",t[8]),{c(){F(e.$$.fragment),n=O(),o.c(),l=O(),F(i.$$.fragment)},l(d){T(e.$$.fragment,d),n=B(d),o.l(d),l=B(d),T(i.$$.fragment,d)},m(d,f){q(e,d,f),v(d,n,f),m[r].m(d,f),v(d,l,f),q(i,d,f),a=!0},p(d,f){const E={};f&8192&&(E.$$scope={dirty:f,ctx:d}),e.$set(E);let C=r;r=g(d),r===C?m[r].p(d,f):(me(),k(m[C],1,1,()=>{m[C]=null}),ce(),o=m[r],o?o.p(d,f):(o=m[r]=s[r](d),o.c()),w(o,1),o.m(l.parentNode,l));const I={};f&8192&&(I.$$scope={dirty:f,ctx:d}),i.$set(I)},i(d){a||(w(e.$$.fragment,d),w(o),w(i.$$.fragment,d),a=!0)},o(d){k(e.$$.fragment,d),k(o),k(i.$$.fragment,d),a=!1},d(d){d&&(y(n),y(l)),N(e,d),m[r].d(d),N(i,d)}}}function At(t){let e,n;return e=new lo({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){F(e.$$.fragment)},l(r){T(e.$$.fragment,r)},m(r,o){q(e,r,o),n=!0},p(r,o){const l={};o&1&&(l.junctionIdx=r[0].idx),o&1&&(l.stage=r[0].stage),e.$set(l)},i(r){n||(w(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){N(e,r)}}}function ho(t){let e;return{c(){e=H("Add new junction")},l(n){e=J(n,"Add new junction")},m(n,r){v(n,e,r)},d(n){n&&y(e)}}}function $o(t){let e=(t[10].name||"Untitled junction")+"",n;return{c(){n=H(e)},l(r){n=J(r,e)},m(r,o){v(r,n,o)},p(r,o){o&2&&e!==(e=(r[10].name||"Untitled junction")+"")&&de(n,e)},d(r){r&&y(n)}}}function Mt(t){let e,n,r,o;function l(){return t[4](t[12])}return n=new he({props:{$$slots:{default:[$o]},$$scope:{ctx:t}}}),n.$on("click",l),{c(){e=Y("li"),F(n.$$.fragment),r=O()},l(i){e=x(i,"LI",{});var a=oe(e);T(n.$$.fragment,a),r=B(a),a.forEach(y)},m(i,a){v(i,e,a),q(n,e,null),re(e,r),o=!0},p(i,a){t=i;const s={};a&8194&&(s.$$scope={dirty:a,ctx:t}),n.$set(s)},i(i){o||(w(n.$$.fragment,i),o=!0)},o(i){k(n.$$.fragment,i),o=!1},d(i){i&&y(e),N(n)}}}function bo(t){let e,n,r,o;const l=[so,ao],i=[];function a(s,m){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(t))&&(n=i[e]=l[e](t)),{c(){n&&n.c(),r=ye()},l(s){n&&n.l(s),r=ye()},m(s,m){~e&&i[e].m(s,m),v(s,r,m),o=!0},p(s,[m]){let g=e;e=a(s),e===g?~e&&i[e].p(s,m):(n&&(me(),k(i[g],1,1,()=>{i[g]=null}),ce()),~e?(n=i[e],n?n.p(s,m):(n=i[e]=l[e](s),n.c()),w(n,1),n.m(r.parentNode,r)):n=null)},i(s){o||(w(n),o=!0)},o(s){k(n),o=!1},d(s){s&&y(r),~e&&i[e].d(s)}}}function Ze(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function yo(t,e,n){let r;He(t,Z,E=>n(1,r=E));let o={kind:"list"};function l(){Oe(Z,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function i(E){window.confirm("Delete this junction?")&&(r.jat.splice(E,1),Z.set(r),n(0,o={kind:"list"}))}const a=E=>n(0,o={kind:"edit",idx:E,stage:"existing"}),s=()=>n(0,o={kind:"list"}),m=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"existing"}),g=()=>n(0,o={kind:"edit",idx:Ze(o),stage:"proposed"}),d=()=>i(Ze(o));function f(E){t.$$.not_equal(r.jat[o.idx].name,E)&&(r.jat[o.idx].name=E,Z.set(r))}return[o,r,l,i,a,s,m,g,d,f]}class Bo extends Ge{constructor(e){super(),ze(this,e,yo,bo,Me,{})}}export{Bo as component};
