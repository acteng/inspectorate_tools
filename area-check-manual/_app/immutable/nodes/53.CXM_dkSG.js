import{s as Ee,v as Y,w as x,l as xt,u as en,p as tn,q as nn,D as ke,k as Re,V as rn,U as qe,a as B,g as O,i as j,f as w,r as Ne,n as Pe,e as re,t as V,c as oe,b as me,d as W,o as Ue,x as Q,h as ne,j as he,z as on,F as de,m as ut}from"../chunks/scheduler.ScMV3vmV.js";import{S as Be,i as Oe,e as ee,c as I,a as F,m as T,t as y,b as k,d as q,g as se,f as ue}from"../chunks/index.DbrWxxqn.js";import{e as pe}from"../chunks/each.DgxkLI6f.js";import{B as an}from"../chunks/ButtonGroup.B2LkAXM6.js";import{D as St}from"../chunks/DefaultButton.DmNBc77J.js";import{S as Le}from"../chunks/SecondaryButton.BknZbHJL.js";/* empty css                                                               */import{T as xe}from"../chunks/TextInput.C1q4cP7I.js";import{W as It}from"../chunks/WarningButton.Dxk6Eh5H.js";import{s as Z}from"../chunks/data.CumCHyjt.js";import{L as ln,g as sn,e as Ft,M as un,b as fn,C as mn,G as ft,l as We,n as mt,h as cn,P as Tt,f as gn}from"../chunks/index.DvJuIAz_.js";import{c as _e}from"../chunks/colors.CYEpEtTL.js";import{G as pn}from"../chunks/GeoreferenceLayer.CoDqoS1u.js";import{a as dn,M as Ge,B as _n,G as hn,S as $n,C as bn}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.CVqq1GaY.js";import{C as wn}from"../chunks/CollapsibleCard.DOoboPEd.js";import{R as qt}from"../chunks/Radio.CFR2d39u.js";import{T as Nt}from"../chunks/TextArea.DbkWbfhb.js";import{C as et}from"../chunks/ClickableCard.ofSK2zeq.js";import"../chunks/ManualPage.svelte_svelte_type_style_lang.D_PO7ki1.js";import"../chunks/paths.Bmuqy74b.js";import{p as yn}from"../chunks/index.e3GrqhhB.js";import{S as vn}from"../chunks/Select.CV0kGAxR.js";import{S as kn}from"../chunks/SectionModal.BkZv95RR.js";import{c as jn}from"../chunks/content.88lnt74o.js";function Cn(t){let e;const n=t[16].default,r=xt(n,t,t[24],null);return{c(){r&&r.c()},l(o){r&&r.l(o)},m(o,i){r&&r.m(o,i),e=!0},p(o,i){r&&r.p&&(!e||i&16777216)&&en(r,n,o,o[24],e?nn(n,o[24],i,null):tn(o[24]),null)},i(o){e||(y(r,o),e=!0)},o(o){k(r,o),e=!1},d(o){r&&r.d(o)}}}function En(t){let e,n,r;function o(a){t[17](a)}let i={id:t[1],type:"symbol",source:t[2],sourceLayer:t[3],beforeId:t[4],beforeLayerType:t[5],paint:t[6],layout:t[7],filter:t[8],applyToClusters:t[9],minzoom:t[10],maxzoom:t[11],hoverCursor:t[12],manageHoverState:t[13],eventsIfTopMost:t[14],interactive:t[15],$$slots:{default:[Cn]},$$scope:{ctx:t}};return t[0]!==void 0&&(i.hovered=t[0]),e=new ln({props:i}),Y.push(()=>ee(e,"hovered",o)),e.$on("click",t[18]),e.$on("dblclick",t[19]),e.$on("contextmenu",t[20]),e.$on("mouseenter",t[21]),e.$on("mousemove",t[22]),e.$on("mouseleave",t[23]),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,l){T(e,a,l),r=!0},p(a,[l]){const s={};l&2&&(s.id=a[1]),l&4&&(s.source=a[2]),l&8&&(s.sourceLayer=a[3]),l&16&&(s.beforeId=a[4]),l&32&&(s.beforeLayerType=a[5]),l&64&&(s.paint=a[6]),l&128&&(s.layout=a[7]),l&256&&(s.filter=a[8]),l&512&&(s.applyToClusters=a[9]),l&1024&&(s.minzoom=a[10]),l&2048&&(s.maxzoom=a[11]),l&4096&&(s.hoverCursor=a[12]),l&8192&&(s.manageHoverState=a[13]),l&16384&&(s.eventsIfTopMost=a[14]),l&32768&&(s.interactive=a[15]),l&16777216&&(s.$$scope={dirty:l,ctx:a}),!n&&l&1&&(n=!0,s.hovered=a[0],x(()=>n=!1)),e.$set(s)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function Pn(t,e,n){let{$$slots:r={},$$scope:o}=e,{id:i=sn("symbol")}=e,{source:a=void 0}=e,{sourceLayer:l=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:c=void 0}=e,{paint:g=void 0}=e,{layout:_=void 0}=e,{filter:f=void 0}=e,{applyToClusters:v=void 0}=e,{minzoom:C=void 0}=e,{maxzoom:N=void 0}=e,{hoverCursor:G=void 0}=e,{manageHoverState:S=!1}=e,{hovered:$=null}=e,{eventsIfTopMost:u=!1}=e,{interactive:h=!0}=e;function b(P){$=P,n(0,$)}function p(P){ke.call(this,t,P)}function L(P){ke.call(this,t,P)}function K(P){ke.call(this,t,P)}function M(P){ke.call(this,t,P)}function U(P){ke.call(this,t,P)}function ce(P){ke.call(this,t,P)}return t.$$set=P=>{"id"in P&&n(1,i=P.id),"source"in P&&n(2,a=P.source),"sourceLayer"in P&&n(3,l=P.sourceLayer),"beforeId"in P&&n(4,s=P.beforeId),"beforeLayerType"in P&&n(5,c=P.beforeLayerType),"paint"in P&&n(6,g=P.paint),"layout"in P&&n(7,_=P.layout),"filter"in P&&n(8,f=P.filter),"applyToClusters"in P&&n(9,v=P.applyToClusters),"minzoom"in P&&n(10,C=P.minzoom),"maxzoom"in P&&n(11,N=P.maxzoom),"hoverCursor"in P&&n(12,G=P.hoverCursor),"manageHoverState"in P&&n(13,S=P.manageHoverState),"hovered"in P&&n(0,$=P.hovered),"eventsIfTopMost"in P&&n(14,u=P.eventsIfTopMost),"interactive"in P&&n(15,h=P.interactive),"$$scope"in P&&n(24,o=P.$$scope)},[$,i,a,l,s,c,g,_,f,v,C,N,G,S,u,h,r,b,p,L,K,M,U,ce,o]}class Ln extends Be{constructor(e){super(),Oe(this,e,Pn,En,Ee,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var An=Object.defineProperty,J=(t,e)=>An(t,"name",{value:e,configurable:!0}),Mn=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Ie(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Ze(e),o=Ze(n);return r.every(i=>o.some(a=>this.compare(i,a)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Ie(e,n))return!1;const i=e;let a=n;if(o&&!this.compareCoord(i[0],a[0])){const s=this.fixStartIndex(a,i);if(s)a=s;else return!1}const l=this.compareCoord(i[r],a[r]);return this.direction||l?this.comparePath(i,a):this.compareCoord(i[r],a[a.length-(1+r)])?this.comparePath(i.slice().reverse(),a):!1}fixStartIndex(e,n){let r,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],n[0])){o=i;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(i=>o.some(a=>this.compareLine(i,a,1,!0)))}return!1}compareGeometryCollection(e,n){return Ie(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Ie(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};J(Mn,"GeojsonEquality");function Ie(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}J(Ie,"sameLength");function Ze(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}J(Ze,"explode");var ie=63710088e-1,Bt={centimeters:ie*100,centimetres:ie*100,degrees:360/(2*Math.PI),feet:ie*3.28084,inches:ie*39.37,kilometers:ie/1e3,kilometres:ie/1e3,meters:ie,metres:ie,miles:ie/1609.344,millimeters:ie*1e3,millimetres:ie*1e3,nauticalmiles:ie/1852,radians:1,yards:ie*1.0936},ct={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function $e(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}J($e,"feature");function Sn(t,e,n={}){switch(t){case"Point":return Je(e).geometry;case"LineString":return nt(e).geometry;case"Polygon":return tt(e).geometry;case"MultiPoint":return Gt(e).geometry;case"MultiLineString":return Ot(e).geometry;case"MultiPolygon":return zt(e).geometry;default:throw new Error(t+" is invalid")}}J(Sn,"geometry");function Je(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!je(t[0])||!je(t[1]))throw new Error("coordinates must contain numbers");return $e({type:"Point",coordinates:t},e,n)}J(Je,"point");function In(t,e,n={}){return He(t.map(r=>Je(r,e)),n)}J(In,"points");function tt(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return $e({type:"Polygon",coordinates:t},e,n)}J(tt,"polygon");function Fn(t,e,n={}){return He(t.map(r=>tt(r,e)),n)}J(Fn,"polygons");function nt(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return $e({type:"LineString",coordinates:t},e,n)}J(nt,"lineString");function Tn(t,e,n={}){return He(t.map(r=>nt(r,e)),n)}J(Tn,"lineStrings");function He(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}J(He,"featureCollection");function Ot(t,e,n={}){return $e({type:"MultiLineString",coordinates:t},e,n)}J(Ot,"multiLineString");function Gt(t,e,n={}){return $e({type:"MultiPoint",coordinates:t},e,n)}J(Gt,"multiPoint");function zt(t,e,n={}){return $e({type:"MultiPolygon",coordinates:t},e,n)}J(zt,"multiPolygon");function qn(t,e,n={}){return $e({type:"GeometryCollection",geometries:t},e,n)}J(qn,"geometryCollection");function Nn(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}J(Nn,"round");function Dt(t,e="kilometers"){const n=Bt[e];if(!n)throw new Error(e+" units is invalid");return t*n}J(Dt,"radiansToLength");function Ke(t,e="kilometers"){const n=Bt[e];if(!n)throw new Error(e+" units is invalid");return t/n}J(Ke,"lengthToRadians");function Bn(t,e){return De(Ke(t,e))}J(Bn,"lengthToDegrees");function On(t){let e=t%360;return e<0&&(e+=360),e}J(On,"bearingToAzimuth");function De(t){return t%(2*Math.PI)*180/Math.PI}J(De,"radiansToDegrees");function ze(t){return t%360*Math.PI/180}J(ze,"degreesToRadians");function Gn(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Dt(Ke(t,e),n)}J(Gn,"convertLength");function zn(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=ct[e];if(!r)throw new Error("invalid original units");const o=ct[n];if(!o)throw new Error("invalid final units");return t/r*o}J(zn,"convertArea");function je(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}J(je,"isNumber");function Dn(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}J(Dn,"isObject");function Rn(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!je(e))throw new Error("bbox must only contain numbers")})}J(Rn,"validateBBox");function Un(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}J(Un,"validateId");var Jn=Object.defineProperty,be=(t,e)=>Jn(t,"name",{value:e,configurable:!0});function Rt(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}be(Rt,"getCoord");function Hn(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}be(Hn,"getCoords");function Ut(t){if(t.length>1&&je(t[0])&&je(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Ut(t[0]);throw new Error("coordinates must only contain numbers")}be(Ut,"containsNumber");function Kn(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}be(Kn,"geojsonType");function Xn(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}be(Xn,"featureOf");function Vn(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}be(Vn,"collectionOf");function Wn(t){return t.type==="Feature"?t.geometry:t}be(Wn,"getGeom");function Zn(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}be(Zn,"getType");var Qn=Object.defineProperty,Yn=(t,e)=>Qn(t,"name",{value:e,configurable:!0});function Jt(t,e,n,r={}){const o=Rt(t),i=ze(o[0]),a=ze(o[1]),l=ze(n),s=Ke(e,r.units),c=Math.asin(Math.sin(a)*Math.cos(s)+Math.cos(a)*Math.sin(s)*Math.cos(l)),g=i+Math.atan2(Math.sin(l)*Math.sin(s)*Math.cos(a),Math.cos(s)-Math.sin(a)*Math.sin(c)),_=De(g),f=De(c);return Je([_,f],r.properties)}Yn(Jt,"destination");var gt=Jt,xn=Object.defineProperty,H=(t,e)=>xn(t,"name",{value:e,configurable:!0}),er=class{constructor(e){this.direction=!1,this.compareProperties=!0;var n,r,o;this.precision=10**-((n=e==null?void 0:e.precision)!=null?n:17),this.direction=(r=e==null?void 0:e.direction)!=null?r:!1,this.compareProperties=(o=e==null?void 0:e.compareProperties)!=null?o:!0}compare(e,n){if(e.type!==n.type||!Fe(e,n))return!1;switch(e.type){case"Point":return this.compareCoord(e.coordinates,n.coordinates);case"LineString":return this.compareLine(e.coordinates,n.coordinates);case"Polygon":return this.comparePolygon(e,n);case"GeometryCollection":return this.compareGeometryCollection(e,n);case"Feature":return this.compareFeature(e,n);case"FeatureCollection":return this.compareFeatureCollection(e,n);default:if(e.type.startsWith("Multi")){const r=Qe(e),o=Qe(n);return r.every(i=>o.some(a=>this.compare(i,a)))}}return!1}compareCoord(e,n){return e.length===n.length&&e.every((r,o)=>Math.abs(r-n[o])<this.precision)}compareLine(e,n,r=0,o=!1){if(!Fe(e,n))return!1;const i=e;let a=n;if(o&&!this.compareCoord(i[0],a[0])){const s=this.fixStartIndex(a,i);if(s)a=s;else return!1}const l=this.compareCoord(i[r],a[r]);return this.direction||l?this.comparePath(i,a):this.compareCoord(i[r],a[a.length-(1+r)])?this.comparePath(i.slice().reverse(),a):!1}fixStartIndex(e,n){let r,o=-1;for(let i=0;i<e.length;i++)if(this.compareCoord(e[i],n[0])){o=i;break}return o>=0&&(r=[].concat(e.slice(o,e.length),e.slice(1,o+1))),r}comparePath(e,n){return e.every((r,o)=>this.compareCoord(r,n[o]))}comparePolygon(e,n){if(this.compareLine(e.coordinates[0],n.coordinates[0],1,!0)){const r=e.coordinates.slice(1,e.coordinates.length),o=n.coordinates.slice(1,n.coordinates.length);return r.every(i=>o.some(a=>this.compareLine(i,a,1,!0)))}return!1}compareGeometryCollection(e,n){return Fe(e.geometries,n.geometries)&&this.compareBBox(e,n)&&e.geometries.every((r,o)=>this.compare(r,n.geometries[o]))}compareFeature(e,n){return e.id===n.id&&(this.compareProperties?Ft(e.properties,n.properties):!0)&&this.compareBBox(e,n)&&this.compare(e.geometry,n.geometry)}compareFeatureCollection(e,n){return Fe(e.features,n.features)&&this.compareBBox(e,n)&&e.features.every((r,o)=>this.compare(r,n.features[o]))}compareBBox(e,n){return!e.bbox&&!n.bbox||(e.bbox&&n.bbox?this.compareCoord(e.bbox,n.bbox):!1)}};H(er,"GeojsonEquality");function Fe(t,e){return t.coordinates?t.coordinates.length===e.coordinates.length:t.length===e.length}H(Fe,"sameLength");function Qe(t){return t.coordinates.map(e=>({type:t.type.replace("Multi",""),coordinates:e}))}H(Qe,"explode");var ae=63710088e-1,Ht={centimeters:ae*100,centimetres:ae*100,degrees:360/(2*Math.PI),feet:ae*3.28084,inches:ae*39.37,kilometers:ae/1e3,kilometres:ae/1e3,meters:ae,metres:ae,miles:ae/1609.344,millimeters:ae*1e3,millimetres:ae*1e3,nauticalmiles:ae/1852,radians:1,yards:ae*1.0936},pt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,nauticalmiles:29155334959812285e-23,millimeters:1e6,millimetres:1e6,yards:1.195990046};function we(t,e,n={}){const r={type:"Feature"};return(n.id===0||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}H(we,"feature");function tr(t,e,n={}){switch(t){case"Point":return rt(e).geometry;case"LineString":return it(e).geometry;case"Polygon":return ot(e).geometry;case"MultiPoint":return Xt(e).geometry;case"MultiLineString":return Kt(e).geometry;case"MultiPolygon":return Vt(e).geometry;default:throw new Error(t+" is invalid")}}H(tr,"geometry");function rt(t,e,n={}){if(!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ce(t[0])||!Ce(t[1]))throw new Error("coordinates must contain numbers");return we({type:"Point",coordinates:t},e,n)}H(rt,"point");function nr(t,e,n={}){return Xe(t.map(r=>rt(r,e)),n)}H(nr,"points");function ot(t,e,n={}){for(const o of t){if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(o[o.length-1].length!==o[0].length)throw new Error("First and last Position are not equivalent.");for(let i=0;i<o[o.length-1].length;i++)if(o[o.length-1][i]!==o[0][i])throw new Error("First and last Position are not equivalent.")}return we({type:"Polygon",coordinates:t},e,n)}H(ot,"polygon");function rr(t,e,n={}){return Xe(t.map(r=>ot(r,e)),n)}H(rr,"polygons");function it(t,e,n={}){if(t.length<2)throw new Error("coordinates must be an array of two or more positions");return we({type:"LineString",coordinates:t},e,n)}H(it,"lineString");function or(t,e,n={}){return Xe(t.map(r=>it(r,e)),n)}H(or,"lineStrings");function Xe(t,e={}){const n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}H(Xe,"featureCollection");function Kt(t,e,n={}){return we({type:"MultiLineString",coordinates:t},e,n)}H(Kt,"multiLineString");function Xt(t,e,n={}){return we({type:"MultiPoint",coordinates:t},e,n)}H(Xt,"multiPoint");function Vt(t,e,n={}){return we({type:"MultiPolygon",coordinates:t},e,n)}H(Vt,"multiPolygon");function ir(t,e,n={}){return we({type:"GeometryCollection",geometries:t},e,n)}H(ir,"geometryCollection");function ar(t,e=0){if(e&&!(e>=0))throw new Error("precision must be a positive number");const n=Math.pow(10,e||0);return Math.round(t*n)/n}H(ar,"round");function Wt(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t*n}H(Wt,"radiansToLength");function at(t,e="kilometers"){const n=Ht[e];if(!n)throw new Error(e+" units is invalid");return t/n}H(at,"lengthToRadians");function lr(t,e){return lt(at(t,e))}H(lr,"lengthToDegrees");function sr(t){let e=t%360;return e<0&&(e+=360),e}H(sr,"bearingToAzimuth");function lt(t){return t%(2*Math.PI)*180/Math.PI}H(lt,"radiansToDegrees");function Te(t){return t%360*Math.PI/180}H(Te,"degreesToRadians");function ur(t,e="kilometers",n="kilometers"){if(!(t>=0))throw new Error("length must be a positive number");return Wt(at(t,e),n)}H(ur,"convertLength");function fr(t,e="meters",n="kilometers"){if(!(t>=0))throw new Error("area must be a positive number");const r=pt[e];if(!r)throw new Error("invalid original units");const o=pt[n];if(!o)throw new Error("invalid final units");return t/r*o}H(fr,"convertArea");function Ce(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}H(Ce,"isNumber");function mr(t){return t!==null&&typeof t=="object"&&!Array.isArray(t)}H(mr,"isObject");function cr(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(t.length!==4&&t.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach(e=>{if(!Ce(e))throw new Error("bbox must only contain numbers")})}H(cr,"validateBBox");function gr(t){if(!t)throw new Error("id is required");if(["string","number"].indexOf(typeof t)===-1)throw new Error("id must be a number or a string")}H(gr,"validateId");var pr=Object.defineProperty,ye=(t,e)=>pr(t,"name",{value:e,configurable:!0});function Ye(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if(t.type==="Feature"&&t.geometry!==null&&t.geometry.type==="Point")return[...t.geometry.coordinates];if(t.type==="Point")return[...t.coordinates]}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return[...t];throw new Error("coord must be GeoJSON Point or an Array of numbers")}ye(Ye,"getCoord");function dr(t){if(Array.isArray(t))return t;if(t.type==="Feature"){if(t.geometry!==null)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}ye(dr,"getCoords");function Zt(t){if(t.length>1&&Ce(t[0])&&Ce(t[1]))return!0;if(Array.isArray(t[0])&&t[0].length)return Zt(t[0]);throw new Error("coordinates must only contain numbers")}ye(Zt,"containsNumber");function _r(t,e,n){if(!e||!n)throw new Error("type and name required");if(!t||t.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.type)}ye(_r,"geojsonType");function hr(t,e,n){if(!t)throw new Error("No feature passed");if(!n)throw new Error(".featureOf() requires a name");if(!t||t.type!=="Feature"||!t.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!t.geometry||t.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+t.geometry.type)}ye(hr,"featureOf");function $r(t,e,n){if(!t)throw new Error("No featureCollection passed");if(!n)throw new Error(".collectionOf() requires a name");if(!t||t.type!=="FeatureCollection")throw new Error("Invalid input to "+n+", FeatureCollection required");for(const r of t.features){if(!r||r.type!=="Feature"||!r.geometry)throw new Error("Invalid input to "+n+", Feature with geometry required");if(!r.geometry||r.geometry.type!==e)throw new Error("Invalid input to "+n+": must be a "+e+", given "+r.geometry.type)}}ye($r,"collectionOf");function br(t){return t.type==="Feature"?t.geometry:t}ye(br,"getGeom");function wr(t,e){return t.type==="FeatureCollection"?"FeatureCollection":t.type==="GeometryCollection"?"GeometryCollection":t.type==="Feature"&&t.geometry!==null?t.geometry.type:t.type}ye(wr,"getType");var yr=Object.defineProperty,Qt=(t,e)=>yr(t,"name",{value:e,configurable:!0});function st(t,e,n={}){if(n.final===!0)return Yt(t,e);const r=Ye(t),o=Ye(e),i=Te(r[0]),a=Te(o[0]),l=Te(r[1]),s=Te(o[1]),c=Math.sin(a-i)*Math.cos(s),g=Math.cos(l)*Math.sin(s)-Math.sin(l)*Math.cos(s)*Math.cos(a-i);return lt(Math.atan2(c,g))}Qt(st,"bearing");function Yt(t,e){let n=st(e,t);return n=(n+180)%360,n}Qt(Yt,"calculateFinalBearing");var vr=st;function dt(t,e,n){const r=t.slice();return r[34]=e[n],r[35]=e,r[36]=n,r}function _t(t,e,n){const r=t.slice();return r[37]=e[n],r[38]=e,r[36]=n,r}function kr(t){let e,n=qr(t[36])+"",r;return{c(){e=re("span"),r=V(n),this.h()},l(o){e=oe(o,"SPAN",{class:!0});var i=me(e);r=W(i,n),i.forEach(w),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"color","#4472c4"),Q(e,"background-color","white")},m(o,i){j(o,e,i),ne(e,r)},p:Pe,d(o){o&&w(e)}}}function ht(t){let e,n,r;function o(s){t[17](s,t[37])}function i(){return t[18](t[36])}function a(){return t[19](t[36])}let l={draggable:!0,$$slots:{default:[kr]},$$scope:{ctx:t}};return t[37].point!==void 0&&(l.lngLat=t[37].point),e=new Ge({props:l}),Y.push(()=>ee(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",a),{c(){I(e.$$.fragment)},l(s){F(e.$$.fragment,s)},m(s,c){T(e,s,c),r=!0},p(s,c){t=s;const g={};c[1]&256&&(g.$$scope={dirty:c,ctx:t}),!n&&c[0]&11&&(n=!0,g.lngLat=t[37].point,x(()=>n=!1)),e.$set(g)},i(s){r||(y(e.$$.fragment,s),r=!0)},o(s){k(e.$$.fragment,s),r=!1},d(s){q(e,s)}}}function jr(t){let e;return{c(){e=re("span"),this.h()},l(n){e=oe(n,"SPAN",{class:!0}),me(e).forEach(w),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score]),Q(e,"opacity",t[34].kind=="walking & wheeling"?"0%":"100%")},m(n,r){j(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score]),r[0]&11&&Q(e,"opacity",n[34].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&w(e)}}}function Cr(t){let e;return{c(){e=re("span"),this.h()},l(n){e=oe(n,"SPAN",{class:!0}),me(e).forEach(w),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score])},m(n,r){j(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score])},d(n){n&&w(e)}}}function Er(t){let e;return{c(){e=re("span"),this.h()},l(n){e=oe(n,"SPAN",{class:!0}),me(e).forEach(w),this.h()},h(){Ue(e,"class","dot svelte-1qktznf"),Q(e,"background-color",t[6][t[34].score]),Q(e,"opacity","0%")},m(n,r){j(n,e,r)},p(n,r){r[0]&11&&Q(e,"background-color",n[6][n[34].score])},d(n){n&&w(e)}}}function $t(t){let e,n,r,o,i,a,l,s,c;function g(p){t[20](p,t[34])}function _(){return t[21](t[36])}function f(){return t[22](t[36])}let v={draggable:!0,$$slots:{default:[jr]},$$scope:{ctx:t}};t[34].point1!==void 0&&(v.lngLat=t[34].point1),e=new Ge({props:v}),Y.push(()=>ee(e,"lngLat",g)),e.$on("dragend",_),e.$on("click",f);function C(p){t[23](p,t[34])}function N(){return t[24](t[36])}function G(){return t[25](t[36])}let S={draggable:!0,$$slots:{default:[Cr]},$$scope:{ctx:t}};t[34].point2!==void 0&&(S.lngLat=t[34].point2),o=new Ge({props:S}),Y.push(()=>ee(o,"lngLat",C)),o.$on("dragend",N),o.$on("click",G);function $(p){t[26](p,t[34])}function u(){return t[27](t[36])}function h(){return t[28](t[36])}let b={draggable:!0,$$slots:{default:[Er]},$$scope:{ctx:t}};return t[34].point3!==void 0&&(b.lngLat=t[34].point3),l=new Ge({props:b}),Y.push(()=>ee(l,"lngLat",$)),l.$on("dragend",u),l.$on("click",h),{c(){I(e.$$.fragment),r=B(),I(o.$$.fragment),a=B(),I(l.$$.fragment)},l(p){F(e.$$.fragment,p),r=O(p),F(o.$$.fragment,p),a=O(p),F(l.$$.fragment,p)},m(p,L){T(e,p,L),j(p,r,L),T(o,p,L),j(p,a,L),T(l,p,L),c=!0},p(p,L){t=p;const K={};L[0]&11|L[1]&256&&(K.$$scope={dirty:L,ctx:t}),!n&&L[0]&11&&(n=!0,K.lngLat=t[34].point1,x(()=>n=!1)),e.$set(K);const M={};L[0]&11|L[1]&256&&(M.$$scope={dirty:L,ctx:t}),!i&&L[0]&11&&(i=!0,M.lngLat=t[34].point2,x(()=>i=!1)),o.$set(M);const U={};L[0]&11|L[1]&256&&(U.$$scope={dirty:L,ctx:t}),!s&&L[0]&11&&(s=!0,U.lngLat=t[34].point3,x(()=>s=!1)),l.$set(U)},i(p){c||(y(e.$$.fragment,p),y(o.$$.fragment,p),y(l.$$.fragment,p),c=!0)},o(p){k(e.$$.fragment,p),k(o.$$.fragment,p),k(l.$$.fragment,p),c=!1},d(p){p&&(w(r),w(a)),q(e,p),q(o,p),q(l,p)}}}function Pr(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=W(r,e)},m(r,o){j(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&he(n,e)},d(r){r&&w(n)}}}function Lr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Pr,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&260&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Ar(t){let e=(t[33].name||"Untitled movement")+"",n;return{c(){n=V(e)},l(r){n=W(r,e)},m(r,o){j(r,n,o)},p(r,o){o[1]&4&&e!==(e=(r[33].name||"Untitled movement")+"")&&he(n,e)},d(r){r&&w(n)}}}function Mr(t){let e,n;return e=new Tt({props:{$$slots:{default:[Ar,({props:r})=>({33:r}),({props:r})=>[0,r?4:0]]},$$scope:{ctx:t}}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&260&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Sr(t){let e,n,r,o,i,a;return e=new We({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":mt(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Lr]},$$scope:{ctx:t}}}),e.$on("click",t[9]),r=new We({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":mt(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Mr]},$$scope:{ctx:t}}}),r.$on("click",t[9]),i=new Ln({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B(),I(i.$$.fragment)},l(l){F(e.$$.fragment,l),n=O(l),F(r.$$.fragment,l),o=O(l),F(i.$$.fragment,l)},m(l,s){T(e,l,s),j(l,n,s),T(r,l,s),j(l,o,s),T(i,l,s),a=!0},p(l,s){const c={};s[1]&256&&(c.$$scope={dirty:s,ctx:l}),e.$set(c);const g={};s[1]&256&&(g.$$scope={dirty:s,ctx:l}),r.$set(g)},i(l){a||(y(e.$$.fragment,l),y(r.$$.fragment,l),y(i.$$.fragment,l),a=!0)},o(l){k(e.$$.fragment,l),k(r.$$.fragment,l),k(i.$$.fragment,l),a=!1},d(l){l&&(w(n),w(o)),q(e,l),q(r,l),q(i,l)}}}function Ir(t){let e,n,r,o;return e=new We({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),r=new cn({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment)},l(i){F(e.$$.fragment,i),n=O(i),F(r.$$.fragment,i)},m(i,a){T(e,i,a),j(i,n,a),T(r,i,a),o=!0},p:Pe,i(i){o||(y(e.$$.fragment,i),y(r.$$.fragment,i),o=!0)},o(i){k(e.$$.fragment,i),k(r.$$.fragment,i),o=!1},d(i){i&&w(n),q(e,i),q(r,i)}}}function Fr(t){let e,n,r,o,i,a,l,s,c,g,_,f;e=new dn({}),e.$on("click",t[8]),r=new mn({props:{gj:t[3].summary.networkMap,show:t[2]}});let v=pe(t[3].jat[t[0]][t[1]].arms),C=[];for(let u=0;u<v.length;u+=1)C[u]=ht(_t(t,v,u));const N=u=>k(C[u],1,1,()=>{C[u]=null});let G=pe(t[3].jat[t[0]][t[1]].movements),S=[];for(let u=0;u<G.length;u+=1)S[u]=$t(dt(t,G,u));const $=u=>k(S[u],1,1,()=>{S[u]=null});return l=new ft({props:{data:t[10](t[3]),$$slots:{default:[Sr]},$$scope:{ctx:t}}}),c=new ft({props:{data:t[5],$$slots:{default:[Ir]},$$scope:{ctx:t}}}),_=new pn({props:{map:t[4]}}),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B();for(let u=0;u<C.length;u+=1)C[u].c();i=B();for(let u=0;u<S.length;u+=1)S[u].c();a=B(),I(l.$$.fragment),s=B(),I(c.$$.fragment),g=B(),I(_.$$.fragment)},l(u){F(e.$$.fragment,u),n=O(u),F(r.$$.fragment,u),o=O(u);for(let h=0;h<C.length;h+=1)C[h].l(u);i=O(u);for(let h=0;h<S.length;h+=1)S[h].l(u);a=O(u),F(l.$$.fragment,u),s=O(u),F(c.$$.fragment,u),g=O(u),F(_.$$.fragment,u)},m(u,h){T(e,u,h),j(u,n,h),T(r,u,h),j(u,o,h);for(let b=0;b<C.length;b+=1)C[b]&&C[b].m(u,h);j(u,i,h);for(let b=0;b<S.length;b+=1)S[b]&&S[b].m(u,h);j(u,a,h),T(l,u,h),j(u,s,h),T(c,u,h),j(u,g,h),T(_,u,h),f=!0},p(u,h){const b={};if(h[0]&8&&(b.gj=u[3].summary.networkMap),h[0]&4&&(b.show=u[2]),r.$set(b),h[0]&139){v=pe(u[3].jat[u[0]][u[1]].arms);let M;for(M=0;M<v.length;M+=1){const U=_t(u,v,M);C[M]?(C[M].p(U,h),y(C[M],1)):(C[M]=ht(U),C[M].c(),y(C[M],1),C[M].m(i.parentNode,i))}for(se(),M=v.length;M<C.length;M+=1)N(M);ue()}if(h[0]&203){G=pe(u[3].jat[u[0]][u[1]].movements);let M;for(M=0;M<G.length;M+=1){const U=dt(u,G,M);S[M]?(S[M].p(U,h),y(S[M],1)):(S[M]=$t(U),S[M].c(),y(S[M],1),S[M].m(a.parentNode,a))}for(se(),M=G.length;M<S.length;M+=1)$(M);ue()}const p={};h[0]&8&&(p.data=u[10](u[3])),h[1]&256&&(p.$$scope={dirty:h,ctx:u}),l.$set(p);const L={};h[0]&32&&(L.data=u[5]),h[1]&256&&(L.$$scope={dirty:h,ctx:u}),c.$set(L);const K={};h[0]&16&&(K.map=u[4]),_.$set(K)},i(u){if(!f){y(e.$$.fragment,u),y(r.$$.fragment,u);for(let h=0;h<v.length;h+=1)y(C[h]);for(let h=0;h<G.length;h+=1)y(S[h]);y(l.$$.fragment,u),y(c.$$.fragment,u),y(_.$$.fragment,u),f=!0}},o(u){k(e.$$.fragment,u),k(r.$$.fragment,u),C=C.filter(Boolean);for(let h=0;h<C.length;h+=1)k(C[h]);S=S.filter(Boolean);for(let h=0;h<S.length;h+=1)k(S[h]);k(l.$$.fragment,u),k(c.$$.fragment,u),k(_.$$.fragment,u),f=!1},d(u){u&&(w(n),w(o),w(i),w(a),w(s),w(g)),q(e,u),q(r,u),Ne(C,u),Ne(S,u),q(l,u),q(c,u),q(_,u)}}}function Tr(t){let e,n,r;function o(a){t[29](a)}let i={$$slots:{default:[Fr]},$$scope:{ctx:t}};return t[4]!==void 0&&(i.map=t[4]),e=new un({props:i}),Y.push(()=>ee(e,"map",o)),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,l){T(e,a,l),r=!0},p(a,l){const s={};l[0]&63|l[1]&256&&(s.$$scope={dirty:l,ctx:a}),!n&&l[0]&16&&(n=!0,s.map=a[4],x(()=>n=!1)),e.$set(s)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function bt(t,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:t.point}}}function qr(t){return String.fromCharCode(t+65)}function Nr(t,e,n){let r,o;Re(t,Z,d=>n(3,o=d));let{junctionIdx:i}=e,{stage:a}=e,{newKind:l}=e,{editing:s}=e,{hoveringSidebar:c}=e,{streetviewOn:g}=e,{showContext:_}=e,f,v={0:_e.red.background,1:_e.amber.background,2:_e.green.background,X:_e.critical.background};function C(d,D,z){let m={type:"FeatureCollection",features:[]},E=D??z;return E!=null&&(E.kind=="arm"?m.features.push(bt(d.jat[i][a].arms[E.idx],E.idx)):m.features.push(u(d.jat[i][a].movements[E.idx],E.idx))),m}function N(d){n(11,s=d),n(12,c=null)}function G(d){if(!g){for(let D of f.queryRenderedFeatures(d.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(s!=null){n(11,s=null);return}l=="arm"?(qe(Z,o.jat[i][a].arms=[...o.jat[i][a].arms,{point:d.detail.lngLat.toArray(),name:""}],o),N({kind:"arm",idx:o.jat[i][a].arms.length-1})):(qe(Z,o.jat[i][a].movements=[...o.jat[i][a].movements,{point1:d.detail.lngLat.toArray(),point2:gt(d.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:gt(d.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),N({kind:"movement",idx:o.jat[i][a].movements.length-1}))}}function S(d){N({kind:"movement",idx:d.detail.features[0].id})}rn(()=>{b(!1)});function $(d){let D={type:"FeatureCollection",features:d.jat[i][a].movements.map((z,m)=>u(z,m))};for(let z of d.jat[i][a].movements)if(D.features.push(h(z,D.features.length)),z.kind=="walking & wheeling"){let m={...z,point1:z.point3,point3:z.point1};D.features.push(h(m,D.features.length))}return D}function u(d,D){return{type:"Feature",id:D,properties:{name:d.name,kind:d.kind,color:v[d.score]},geometry:{type:"LineString",coordinates:[d.point1,d.point2,d.point3]}}}function h(d,D){return{type:"Feature",id:D,properties:{kind:d.kind,color:v[d.score],angle:vr(d.point2,d.point3)},geometry:{type:"Point",coordinates:d.point3}}}function b(d){let D=$(o);for(let z of o.jat[i][a].arms)D.features.push(bt(z,D.features.length));for(let z of o.summary.networkMap.features)D.features.push(z);D.features.length>0&&f.fitBounds(fn(D),{padding:20,animate:d})}function p(){return f}function L(d,D){t.$$.not_equal(D.point,d)&&(D.point=d,Z.set(o))}const K=d=>N({kind:"arm",idx:d}),M=d=>N({kind:"arm",idx:d});function U(d,D){t.$$.not_equal(D.point1,d)&&(D.point1=d,Z.set(o))}const ce=d=>N({kind:"movement",idx:d}),P=d=>N({kind:"movement",idx:d});function Ae(d,D){t.$$.not_equal(D.point2,d)&&(D.point2=d,Z.set(o))}const ve=d=>N({kind:"movement",idx:d}),fe=d=>N({kind:"movement",idx:d});function X(d,D){t.$$.not_equal(D.point3,d)&&(D.point3=d,Z.set(o))}const Me=d=>N({kind:"movement",idx:d}),A=d=>N({kind:"movement",idx:d});function le(d){f=d,n(4,f)}return t.$$set=d=>{"junctionIdx"in d&&n(0,i=d.junctionIdx),"stage"in d&&n(1,a=d.stage),"newKind"in d&&n(13,l=d.newKind),"editing"in d&&n(11,s=d.editing),"hoveringSidebar"in d&&n(12,c=d.hoveringSidebar),"streetviewOn"in d&&n(14,g=d.streetviewOn),"showContext"in d&&n(2,_=d.showContext)},t.$$.update=()=>{t.$$.dirty[0]&6152&&n(5,r=C(o,s,c))},[i,a,_,o,f,r,v,N,G,S,$,s,c,l,g,b,p,L,K,M,U,ce,P,Ae,ve,fe,X,Me,A,le]}class Br extends Be{constructor(e){super(),Oe(this,e,Nr,Tr,Ee,{junctionIdx:0,stage:1,newKind:13,editing:11,hoveringSidebar:12,streetviewOn:14,showContext:2,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function Or(t){let e,n,r,o,i,a,l,s,c,g,_,f;function v(b){t[5](b)}let C={label:"Name"};t[3].jat[t[0]][t[1]].movements[t[2]].name!==void 0&&(C.value=t[3].jat[t[0]][t[1]].movements[t[2]].name),e=new xe({props:C}),Y.push(()=>ee(e,"value",v));function N(b){t[6](b)}let G={legend:"Movement",choices:yn(["cycling","walking & wheeling"]),inlineSmall:!0};t[3].jat[t[0]][t[1]].movements[t[2]].kind!==void 0&&(G.value=t[3].jat[t[0]][t[1]].movements[t[2]].kind),o=new qt({props:G}),Y.push(()=>ee(o,"value",N));function S(b){t[7](b)}let $={label:"Score",choices:t[4]};t[3].jat[t[0]][t[1]].movements[t[2]].score!==void 0&&($.value=t[3].jat[t[0]][t[1]].movements[t[2]].score),l=new vn({props:$}),Y.push(()=>ee(l,"value",S));function u(b){t[8](b)}let h={label:"Comments"};return t[3].jat[t[0]][t[1]].movements[t[2]].notes!==void 0&&(h.value=t[3].jat[t[0]][t[1]].movements[t[2]].notes),g=new Nt({props:h}),Y.push(()=>ee(g,"value",u)),{c(){I(e.$$.fragment),r=B(),I(o.$$.fragment),a=B(),I(l.$$.fragment),c=B(),I(g.$$.fragment)},l(b){F(e.$$.fragment,b),r=O(b),F(o.$$.fragment,b),a=O(b),F(l.$$.fragment,b),c=O(b),F(g.$$.fragment,b)},m(b,p){T(e,b,p),j(b,r,p),T(o,b,p),j(b,a,p),T(l,b,p),j(b,c,p),T(g,b,p),f=!0},p(b,[p]){const L={};!n&&p&15&&(n=!0,L.value=b[3].jat[b[0]][b[1]].movements[b[2]].name,x(()=>n=!1)),e.$set(L);const K={};!i&&p&15&&(i=!0,K.value=b[3].jat[b[0]][b[1]].movements[b[2]].kind,x(()=>i=!1)),o.$set(K);const M={};!s&&p&15&&(s=!0,M.value=b[3].jat[b[0]][b[1]].movements[b[2]].score,x(()=>s=!1)),l.$set(M);const U={};!_&&p&15&&(_=!0,U.value=b[3].jat[b[0]][b[1]].movements[b[2]].notes,x(()=>_=!1)),g.$set(U)},i(b){f||(y(e.$$.fragment,b),y(o.$$.fragment,b),y(l.$$.fragment,b),y(g.$$.fragment,b),f=!0)},o(b){k(e.$$.fragment,b),k(o.$$.fragment,b),k(l.$$.fragment,b),k(g.$$.fragment,b),f=!1},d(b){b&&(w(r),w(a),w(c)),q(e,b),q(o,b),q(l,b),q(g,b)}}}function Gr(t,e,n){let r;Re(t,Z,f=>n(3,r=f));let{junctionIdx:o}=e,{stage:i}=e,{idx:a}=e,l=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(f){t.$$.not_equal(r.jat[o][i].movements[a].name,f)&&(r.jat[o][i].movements[a].name=f,Z.set(r))}function c(f){t.$$.not_equal(r.jat[o][i].movements[a].kind,f)&&(r.jat[o][i].movements[a].kind=f,Z.set(r))}function g(f){t.$$.not_equal(r.jat[o][i].movements[a].score,f)&&(r.jat[o][i].movements[a].score=f,Z.set(r))}function _(f){t.$$.not_equal(r.jat[o][i].movements[a].notes,f)&&(r.jat[o][i].movements[a].notes=f,Z.set(r))}return t.$$set=f=>{"junctionIdx"in f&&n(0,o=f.junctionIdx),"stage"in f&&n(1,i=f.stage),"idx"in f&&n(2,a=f.idx)},[o,i,a,r,l,s,c,g,_]}class zr extends Be{constructor(e){super(),Oe(this,e,Gr,Or,Ee,{junctionIdx:0,stage:1,idx:2})}}const{window:Dr}=gn;function wt(t,e,n){const r=t.slice();r[31]=e[n],r[34]=n;const o=r[15][r[31].score];return r[32]=o,r}function yt(t,e,n){const r=t.slice();return r[35]=e[n],r[34]=n,r}function Rr(t){let e,n,r,o,i,a,l,s;e=new St({props:{$$slots:{default:[Jr]},$$scope:{ctx:t}}}),e.$on("click",t[27]),r=new It({props:{$$slots:{default:[Hr]},$$scope:{ctx:t}}}),r.$on("click",t[11]);const c=[Xr,Kr],g=[];function _(f,v){return f[3].kind=="movement"?0:1}return i=_(t),a=g[i]=c[i](t),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B(),a.c(),l=de()},l(f){F(e.$$.fragment,f),n=O(f),F(r.$$.fragment,f),o=O(f),a.l(f),l=de()},m(f,v){T(e,f,v),j(f,n,v),T(r,f,v),j(f,o,v),g[i].m(f,v),j(f,l,v),s=!0},p(f,v){const C={};v[1]&64&&(C.$$scope={dirty:v,ctx:f}),e.$set(C);const N={};v[1]&64&&(N.$$scope={dirty:v,ctx:f}),r.$set(N);let G=i;i=_(f),i===G?g[i].p(f,v):(se(),k(g[G],1,1,()=>{g[G]=null}),ue(),a=g[i],a?a.p(f,v):(a=g[i]=c[i](f),a.c()),y(a,1),a.m(l.parentNode,l))},i(f){s||(y(e.$$.fragment,f),y(r.$$.fragment,f),y(a),s=!0)},o(f){k(e.$$.fragment,f),k(r.$$.fragment,f),k(a),s=!1},d(f){f&&(w(n),w(o),w(l)),q(e,f),q(r,f),g[i].d(f)}}}function Ur(t){let e,n,r,o,i,a,l,s=(t[8].jat[t[0]].name||"Untitled junction")+"",c,g,_,f,v,C,N,G="Arms",S,$,u,h,b="Movements",p,L,K,M;e=new wn({props:{label:"Tools",$$slots:{default:[Zr]},$$scope:{ctx:t}}});function U(m,E){return m[8].jat[m[0]][m[1]].movements.length>0?Yr:Qr}let ce=U(t),P=ce(t);function Ae(m){t[20](m)}let ve={legend:"Add to map",choices:[["arm","Arm"],["movement","Movement"]],inlineSmall:!0};t[2]!==void 0&&(ve.value=t[2]),f=new qt({props:ve}),Y.push(()=>ee(f,"value",Ae));let fe=pe(t[8].jat[t[0]][t[1]].arms),X=[];for(let m=0;m<fe.length;m+=1)X[m]=vt(yt(t,fe,m));const Me=m=>k(X[m],1,1,()=>{X[m]=null});let A=t[8].jat[t[0]][t[9]].arms.length>0&&kt(t),le=pe(t[8].jat[t[0]][t[1]].movements),d=[];for(let m=0;m<le.length;m+=1)d[m]=jt(wt(t,le,m));const D=m=>k(d[m],1,1,()=>{d[m]=null});let z=t[8].jat[t[0]][t[9]].movements.length>0&&Ct(t);return{c(){I(e.$$.fragment),n=B(),r=re("p"),o=V("Total JAT score for "),i=V(t[1]),a=B(),l=re("u"),c=V(s),g=V(`
        :
        `),P.c(),_=B(),I(f.$$.fragment),C=B(),N=re("h3"),N.textContent=G,S=B();for(let m=0;m<X.length;m+=1)X[m].c();$=B(),A&&A.c(),u=B(),h=re("h3"),h.textContent=b,p=B();for(let m=0;m<d.length;m+=1)d[m].c();L=B(),z&&z.c(),K=de()},l(m){F(e.$$.fragment,m),n=O(m),r=oe(m,"P",{});var E=me(r);o=W(E,"Total JAT score for "),i=W(E,t[1]),a=O(E),l=oe(E,"U",{});var te=me(l);c=W(te,s),te.forEach(w),g=W(E,`
        :
        `),P.l(E),E.forEach(w),_=O(m),F(f.$$.fragment,m),C=O(m),N=oe(m,"H3",{"data-svelte-h":!0}),ut(N)!=="svelte-ld74qb"&&(N.textContent=G),S=O(m);for(let ge=0;ge<X.length;ge+=1)X[ge].l(m);$=O(m),A&&A.l(m),u=O(m),h=oe(m,"H3",{"data-svelte-h":!0}),ut(h)!=="svelte-1dc52s8"&&(h.textContent=b),p=O(m);for(let ge=0;ge<d.length;ge+=1)d[ge].l(m);L=O(m),z&&z.l(m),K=de()},m(m,E){T(e,m,E),j(m,n,E),j(m,r,E),ne(r,o),ne(r,i),ne(r,a),ne(r,l),ne(l,c),ne(r,g),P.m(r,null),j(m,_,E),T(f,m,E),j(m,C,E),j(m,N,E),j(m,S,E);for(let te=0;te<X.length;te+=1)X[te]&&X[te].m(m,E);j(m,$,E),A&&A.m(m,E),j(m,u,E),j(m,h,E),j(m,p,E);for(let te=0;te<d.length;te+=1)d[te]&&d[te].m(m,E);j(m,L,E),z&&z.m(m,E),j(m,K,E),M=!0},p(m,E){const te={};E[0]&224|E[1]&64&&(te.$$scope={dirty:E,ctx:m}),e.$set(te),(!M||E[0]&2)&&he(i,m[1]),(!M||E[0]&257)&&s!==(s=(m[8].jat[m[0]].name||"Untitled junction")+"")&&he(c,s),ce===(ce=U(m))&&P?P.p(m,E):(P.d(1),P=ce(m),P&&(P.c(),P.m(r,null)));const ge={};if(!v&&E[0]&4&&(v=!0,ge.value=m[2],x(()=>v=!1)),f.$set(ge),E[0]&1299){fe=pe(m[8].jat[m[0]][m[1]].arms);let R;for(R=0;R<fe.length;R+=1){const Se=yt(m,fe,R);X[R]?(X[R].p(Se,E),y(X[R],1)):(X[R]=vt(Se),X[R].c(),y(X[R],1),X[R].m($.parentNode,$))}for(se(),R=fe.length;R<X.length;R+=1)Me(R);ue()}if(m[8].jat[m[0]][m[9]].arms.length>0?A?(A.p(m,E),E[0]&257&&y(A,1)):(A=kt(m),A.c(),y(A,1),A.m(u.parentNode,u)):A&&(se(),k(A,1,1,()=>{A=null}),ue()),E[0]&34067){le=pe(m[8].jat[m[0]][m[1]].movements);let R;for(R=0;R<le.length;R+=1){const Se=wt(m,le,R);d[R]?(d[R].p(Se,E),y(d[R],1)):(d[R]=jt(Se),d[R].c(),y(d[R],1),d[R].m(L.parentNode,L))}for(se(),R=le.length;R<d.length;R+=1)D(R);ue()}m[8].jat[m[0]][m[9]].movements.length>0?z?(z.p(m,E),E[0]&257&&y(z,1)):(z=Ct(m),z.c(),y(z,1),z.m(K.parentNode,K)):z&&(se(),k(z,1,1,()=>{z=null}),ue())},i(m){if(!M){y(e.$$.fragment,m),y(f.$$.fragment,m);for(let E=0;E<fe.length;E+=1)y(X[E]);y(A);for(let E=0;E<le.length;E+=1)y(d[E]);y(z),M=!0}},o(m){k(e.$$.fragment,m),k(f.$$.fragment,m),X=X.filter(Boolean);for(let E=0;E<X.length;E+=1)k(X[E]);k(A),d=d.filter(Boolean);for(let E=0;E<d.length;E+=1)k(d[E]);k(z),M=!1},d(m){m&&(w(n),w(r),w(_),w(C),w(N),w(S),w($),w(u),w(h),w(p),w(L),w(K)),q(e,m),P.d(),q(f,m),Ne(X,m),A&&A.d(m),Ne(d,m),z&&z.d(m)}}}function Jr(t){let e;return{c(){e=V("Save")},l(n){e=W(n,"Save")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function Hr(t){let e;return{c(){e=V("Delete")},l(n){e=W(n,"Delete")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function Kr(t){let e,n,r;function o(a){t[28](a)}let i={label:"Arm Name"};return t[8].jat[t[0]][t[1]].arms[t[3].idx].name!==void 0&&(i.value=t[8].jat[t[0]][t[1]].arms[t[3].idx].name),e=new xe({props:i}),Y.push(()=>ee(e,"value",o)),{c(){I(e.$$.fragment)},l(a){F(e.$$.fragment,a)},m(a,l){T(e,a,l),r=!0},p(a,l){const s={};!n&&l[0]&267&&(n=!0,s.value=a[8].jat[a[0]][a[1]].arms[a[3].idx].name,x(()=>n=!1)),e.$set(s)},i(a){r||(y(e.$$.fragment,a),r=!0)},o(a){k(e.$$.fragment,a),r=!1},d(a){q(e,a)}}}function Xr(t){let e,n;return e=new zr({props:{junctionIdx:t[0],stage:t[1],idx:t[3].idx}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[0]&1&&(i.junctionIdx=r[0]),o[0]&2&&(i.stage=r[1]),o[0]&8&&(i.idx=r[3].idx),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function Vr(t){let e;return{c(){e=V("Zoom to fit")},l(n){e=W(n,"Zoom to fit")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function Wr(t){let e;return{c(){e=V("Show scheme context")},l(n){e=W(n,"Show scheme context")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function Zr(t){var S;let e,n,r,o,i,a,l,s,c,g,_,f;e=new Le({props:{$$slots:{default:[Vr]},$$scope:{ctx:t}}}),e.$on("click",t[17]),r=new _n({}),i=new hn({});function v($){t[18]($)}let C={map:(S=t[7])==null?void 0:S.getMap()};t[5]!==void 0&&(C.enabled=t[5]),l=new $n({props:C}),Y.push(()=>ee(l,"enabled",v));function N($){t[19]($)}let G={$$slots:{default:[Wr]},$$scope:{ctx:t}};return t[6]!==void 0&&(G.checked=t[6]),g=new bn({props:G}),Y.push(()=>ee(g,"checked",N)),{c(){I(e.$$.fragment),n=B(),I(r.$$.fragment),o=B(),I(i.$$.fragment),a=B(),I(l.$$.fragment),c=B(),I(g.$$.fragment)},l($){F(e.$$.fragment,$),n=O($),F(r.$$.fragment,$),o=O($),F(i.$$.fragment,$),a=O($),F(l.$$.fragment,$),c=O($),F(g.$$.fragment,$)},m($,u){T(e,$,u),j($,n,u),T(r,$,u),j($,o,u),T(i,$,u),j($,a,u),T(l,$,u),j($,c,u),T(g,$,u),f=!0},p($,u){var L;const h={};u[1]&64&&(h.$$scope={dirty:u,ctx:$}),e.$set(h);const b={};u[0]&128&&(b.map=(L=$[7])==null?void 0:L.getMap()),!s&&u[0]&32&&(s=!0,b.enabled=$[5],x(()=>s=!1)),l.$set(b);const p={};u[1]&64&&(p.$$scope={dirty:u,ctx:$}),!_&&u[0]&64&&(_=!0,p.checked=$[6],x(()=>_=!1)),g.$set(p)},i($){f||(y(e.$$.fragment,$),y(r.$$.fragment,$),y(i.$$.fragment,$),y(l.$$.fragment,$),y(g.$$.fragment,$),f=!0)},o($){k(e.$$.fragment,$),k(r.$$.fragment,$),k(i.$$.fragment,$),k(l.$$.fragment,$),k(g.$$.fragment,$),f=!1},d($){$&&(w(n),w(o),w(a),w(c)),q(e,$),q(r,$),q(i,$),q(l,$),q(g,$)}}}function Qr(t){let e;return{c(){e=V("No movements added")},l(n){e=W(n,"No movements added")},m(n,r){j(n,e,r)},p:Pe,d(n){n&&w(e)}}}function Yr(t){let e=Math.round(Pt(t[8].jat[t[0]][t[1]]))+"",n,r;return{c(){n=V(e),r=V("%")},l(o){n=W(o,e),r=W(o,"%")},m(o,i){j(o,n,i),j(o,r,i)},p(o,i){i[0]&259&&e!==(e=Math.round(Pt(o[8].jat[o[0]][o[1]]))+"")&&he(n,e)},d(o){o&&(w(n),w(r))}}}function vt(t){let e,n;function r(){return t[21](t[34])}function o(){return t[22](t[34])}return e=new et({props:{name:`${Et(t[34])} - ${t[35].name||"Unnamed arm"}`}}),e.$on("click",r),e.$on("mouseenter",o),e.$on("mouseleave",t[23]),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){T(e,i,a),n=!0},p(i,a){t=i;const l={};a[0]&259&&(l.name=`${Et(t[34])} - ${t[35].name||"Unnamed arm"}`),e.$set(l)},i(i){n||(y(e.$$.fragment,i),n=!0)},o(i){k(e.$$.fragment,i),n=!1},d(i){q(e,i)}}}function kt(t){let e,n;return e=new Le({props:{$$slots:{default:[xr]},$$scope:{ctx:t}}}),e.$on("click",t[13]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&64&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function xr(t){let e,n;return{c(){e=V("Copy arms from "),n=V(t[9])},l(r){e=W(r,"Copy arms from "),n=W(r,t[9])},m(r,o){j(r,e,o),j(r,n,o)},p:Pe,d(r){r&&(w(e),w(n))}}}function eo(t){let e,n,r=t[31].score+"",o;return{c(){e=re("span"),n=V("Score: "),o=V(r),this.h()},l(i){e=oe(i,"SPAN",{style:!0});var a=me(e);n=W(a,"Score: "),o=W(a,r),a.forEach(w),this.h()},h(){Q(e,"color",t[32].font),Q(e,"background-color",t[32].background)},m(i,a){j(i,e,a),ne(e,n),ne(e,o)},p(i,a){a[0]&259&&r!==(r=i[31].score+"")&&he(o,r),a[0]&259&&Q(e,"color",i[32].font),a[0]&259&&Q(e,"background-color",i[32].background)},d(i){i&&w(e)}}}function jt(t){let e,n;function r(){return t[24](t[34])}function o(){return t[25](t[34])}return e=new et({props:{name:t[31].name||"Unnamed movement",$$slots:{default:[eo]},$$scope:{ctx:t}}}),e.$on("click",r),e.$on("mouseenter",o),e.$on("mouseleave",t[26]),{c(){I(e.$$.fragment)},l(i){F(e.$$.fragment,i)},m(i,a){T(e,i,a),n=!0},p(i,a){t=i;const l={};a[0]&259&&(l.name=t[31].name||"Unnamed movement"),a[0]&259|a[1]&64&&(l.$$scope={dirty:a,ctx:t}),e.$set(l)},i(i){n||(y(e.$$.fragment,i),n=!0)},o(i){k(e.$$.fragment,i),n=!1},d(i){q(e,i)}}}function Ct(t){let e,n;return e=new Le({props:{$$slots:{default:[to]},$$scope:{ctx:t}}}),e.$on("click",t[14]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o[1]&64&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function to(t){let e,n;return{c(){e=V("Copy movements from "),n=V(t[9])},l(r){e=W(r,"Copy movements from "),n=W(r,t[9])},m(r,o){j(r,e,o),j(r,n,o)},p:Pe,d(r){r&&(w(e),w(n))}}}function no(t){let e,n,r,o,i,a,l,s,c,g,_,f,v,C;function N(p){t[16](p)}let G={label:"Commentary / Notes"};t[8].jat[t[0]][t[1]].notes!==void 0&&(G.value=t[8].jat[t[0]][t[1]].notes),e=new Nt({props:G}),Y.push(()=>ee(e,"value",N));const S=[Ur,Rr],$=[];function u(p,L){return p[3]==null?0:1}a=u(t),l=$[a]=S[a](t);function h(p){t[30](p)}let b={junctionIdx:t[0],stage:t[1],newKind:t[2],hoveringSidebar:t[4],streetviewOn:t[5],showContext:t[6]};return t[3]!==void 0&&(b.editing=t[3]),g=new Br({props:b}),t[29](g),Y.push(()=>ee(g,"editing",h)),{c(){I(e.$$.fragment),r=B(),o=re("div"),i=re("div"),l.c(),s=B(),c=re("div"),I(g.$$.fragment),this.h()},l(p){F(e.$$.fragment,p),r=O(p),o=oe(p,"DIV",{style:!0});var L=me(o);i=oe(L,"DIV",{style:!0});var K=me(i);l.l(K),K.forEach(w),s=O(L),c=oe(L,"DIV",{style:!0});var M=me(c);F(g.$$.fragment,M),M.forEach(w),L.forEach(w),this.h()},h(){Q(i,"width","30%"),Q(i,"overflow-y","scroll"),Q(i,"padding","10px"),Q(i,"border","1px solid black"),Q(c,"position","relative"),Q(c,"width","100%"),Q(o,"display","flex"),Q(o,"height","80vh")},m(p,L){T(e,p,L),j(p,r,L),j(p,o,L),ne(o,i),$[a].m(i,null),ne(o,s),ne(o,c),T(g,c,null),f=!0,v||(C=on(Dr,"keydown",t[12]),v=!0)},p(p,L){const K={};!n&&L[0]&259&&(n=!0,K.value=p[8].jat[p[0]][p[1]].notes,x(()=>n=!1)),e.$set(K);let M=a;a=u(p),a===M?$[a].p(p,L):(se(),k($[M],1,1,()=>{$[M]=null}),ue(),l=$[a],l?l.p(p,L):(l=$[a]=S[a](p),l.c()),y(l,1),l.m(i,null));const U={};L[0]&1&&(U.junctionIdx=p[0]),L[0]&2&&(U.stage=p[1]),L[0]&4&&(U.newKind=p[2]),L[0]&16&&(U.hoveringSidebar=p[4]),L[0]&32&&(U.streetviewOn=p[5]),L[0]&64&&(U.showContext=p[6]),!_&&L[0]&8&&(_=!0,U.editing=p[3],x(()=>_=!1)),g.$set(U)},i(p){f||(y(e.$$.fragment,p),y(l),y(g.$$.fragment,p),f=!0)},o(p){k(e.$$.fragment,p),k(l),k(g.$$.fragment,p),f=!1},d(p){p&&(w(r),w(o)),q(e,p),$[a].d(),t[29](null),q(g),v=!1,C()}}}function Et(t){return String.fromCharCode(t+65)}function Pt(t){let e=0,n=0;for(let r of t.movements)e+={0:0,1:1,2:2,X:0}[r.score],n+=2;return e/n*100}function ro(t,e,n){let r;Re(t,Z,A=>n(8,r=A));let{junctionIdx:o}=e,{stage:i}=e,a=i=="existing"?"proposed":"existing",l="arm",s=null,c=null,g=!1,_=!0,f=null;function v(A){n(3,s=A),n(4,c=null)}function C(){window.confirm(`Delete this ${s.kind}?`)&&(s.kind=="movement"?(r.jat[o][i].movements.splice(s.idx,1),Z.set(r)):(r.jat[o][i].arms.splice(s.idx,1),Z.set(r)),n(3,s=null))}function N(A){if(s!=null&&A.key=="Escape")A.stopPropagation(),n(3,s=null);else if(s!=null&&A.key=="Delete"){let le=A.target.tagName;if(le=="INPUT"||le=="TEXTAREA")return;A.stopPropagation(),C()}}function G(){r.jat[o][i].arms.length>0&&!window.confirm("Overwrite arms?")||(qe(Z,r.jat[o][i].arms=JSON.parse(JSON.stringify(r.jat[o][a].arms)),r),Z.set(r))}function S(){r.jat[o][i].movements.length>0&&!window.confirm("Overwrite movements?")||(qe(Z,r.jat[o][i].movements=JSON.parse(JSON.stringify(r.jat[o][a].movements)),r),Z.set(r))}let $={0:_e.red,1:_e.amber,2:_e.green,X:_e.critical};function u(A){t.$$.not_equal(r.jat[o][i].notes,A)&&(r.jat[o][i].notes=A,Z.set(r))}const h=()=>f==null?void 0:f.zoom(!0);function b(A){g=A,n(5,g)}function p(A){_=A,n(6,_)}function L(A){l=A,n(2,l)}const K=A=>v({kind:"arm",idx:A}),M=A=>n(4,c={kind:"arm",idx:A}),U=()=>n(4,c=null),ce=A=>v({kind:"movement",idx:A}),P=A=>n(4,c={kind:"movement",idx:A}),Ae=()=>n(4,c=null),ve=()=>n(3,s=null);function fe(A){t.$$.not_equal(r.jat[o][i].arms[s.idx].name,A)&&(r.jat[o][i].arms[s.idx].name=A,Z.set(r))}function X(A){Y[A?"unshift":"push"](()=>{f=A,n(7,f)})}function Me(A){s=A,n(3,s)}return t.$$set=A=>{"junctionIdx"in A&&n(0,o=A.junctionIdx),"stage"in A&&n(1,i=A.stage)},[o,i,l,s,c,g,_,f,r,a,v,C,N,G,S,$,u,h,b,p,L,K,M,U,ce,P,Ae,ve,fe,X,Me]}class oo extends Be{constructor(e){super(),Oe(this,e,ro,no,Ee,{junctionIdx:0,stage:1},null,[-1,-1])}}function Lt(t,e,n){const r=t.slice();return r[10]=e[n],r[12]=n,r}function io(t){let e,n=(t[1].jat[t[0].idx].name||"Untitled junction")+"",r,o,i=t[0].stage+"",a,l,s,c,g,_,f,v=t[0].stage,C,N;s=new an({props:{$$slots:{default:[go]},$$scope:{ctx:t}}});function G(u){t[9](u)}let S={label:"Junction Name"};t[1].jat[t[0].idx].name!==void 0&&(S.value=t[1].jat[t[0].idx].name),g=new xe({props:S}),Y.push(()=>ee(g,"value",G));let $=At(t);return{c(){e=re("h2"),r=V(n),o=V(" - "),a=V(i),l=B(),I(s.$$.fragment),c=B(),I(g.$$.fragment),f=B(),$.c(),C=de()},l(u){e=oe(u,"H2",{});var h=me(e);r=W(h,n),o=W(h," - "),a=W(h,i),h.forEach(w),l=O(u),F(s.$$.fragment,u),c=O(u),F(g.$$.fragment,u),f=O(u),$.l(u),C=de()},m(u,h){j(u,e,h),ne(e,r),ne(e,o),ne(e,a),j(u,l,h),T(s,u,h),j(u,c,h),T(g,u,h),j(u,f,h),$.m(u,h),j(u,C,h),N=!0},p(u,h){(!N||h&3)&&n!==(n=(u[1].jat[u[0].idx].name||"Untitled junction")+"")&&he(r,n),(!N||h&1)&&i!==(i=u[0].stage+"")&&he(a,i);const b={};h&8193&&(b.$$scope={dirty:h,ctx:u}),s.$set(b);const p={};!_&&h&3&&(_=!0,p.value=u[1].jat[u[0].idx].name,x(()=>_=!1)),g.$set(p),h&1&&Ee(v,v=u[0].stage)?(se(),k($,1,1,Pe),ue(),$=At(u),$.c(),y($,1),$.m(C.parentNode,C)):$.p(u,h)},i(u){N||(y(s.$$.fragment,u),y(g.$$.fragment,u),y($),N=!0)},o(u){k(s.$$.fragment,u),k(g.$$.fragment,u),k($),N=!1},d(u){u&&(w(e),w(l),w(c),w(f),w(C)),q(s,u),q(g,u),$.d(u)}}}function ao(t){let e,n,r,o;e=new St({props:{$$slots:{default:[po]},$$scope:{ctx:t}}}),e.$on("click",t[2]);let i=pe(t[1].jat),a=[];for(let s=0;s<i.length;s+=1)a[s]=Mt(Lt(t,i,s));const l=s=>k(a[s],1,1,()=>{a[s]=null});return{c(){I(e.$$.fragment),n=B();for(let s=0;s<a.length;s+=1)a[s].c();r=de()},l(s){F(e.$$.fragment,s),n=O(s);for(let c=0;c<a.length;c+=1)a[c].l(s);r=de()},m(s,c){T(e,s,c),j(s,n,c);for(let g=0;g<a.length;g+=1)a[g]&&a[g].m(s,c);j(s,r,c),o=!0},p(s,c){const g={};if(c&8192&&(g.$$scope={dirty:c,ctx:s}),e.$set(g),c&3){i=pe(s[1].jat);let _;for(_=0;_<i.length;_+=1){const f=Lt(s,i,_);a[_]?(a[_].p(f,c),y(a[_],1)):(a[_]=Mt(f),a[_].c(),y(a[_],1),a[_].m(r.parentNode,r))}for(se(),_=i.length;_<a.length;_+=1)l(_);ue()}},i(s){if(!o){y(e.$$.fragment,s);for(let c=0;c<i.length;c+=1)y(a[c]);o=!0}},o(s){k(e.$$.fragment,s),a=a.filter(Boolean);for(let c=0;c<a.length;c+=1)k(a[c]);o=!1},d(s){s&&(w(n),w(r)),q(e,s),Ne(a,s)}}}function lo(t){let e;return{c(){e=V("Back to all junctions")},l(n){e=W(n,"Back to all junctions")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function so(t){let e,n;return e=new Le({props:{$$slots:{default:[fo]},$$scope:{ctx:t}}}),e.$on("click",t[7]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function uo(t){let e,n;return e=new Le({props:{$$slots:{default:[mo]},$$scope:{ctx:t}}}),e.$on("click",t[6]),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:r}),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function fo(t){let e;return{c(){e=V("Edit Proposed")},l(n){e=W(n,"Edit Proposed")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function mo(t){let e;return{c(){e=V("Edit Existing")},l(n){e=W(n,"Edit Existing")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function co(t){let e;return{c(){e=V("Delete")},l(n){e=W(n,"Delete")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function go(t){let e,n,r,o,i,a,l;e=new Le({props:{$$slots:{default:[lo]},$$scope:{ctx:t}}}),e.$on("click",t[5]);const s=[uo,so],c=[];function g(_,f){return _[0].stage=="proposed"?0:1}return r=g(t),o=c[r]=s[r](t),a=new It({props:{$$slots:{default:[co]},$$scope:{ctx:t}}}),a.$on("click",t[8]),{c(){I(e.$$.fragment),n=B(),o.c(),i=B(),I(a.$$.fragment)},l(_){F(e.$$.fragment,_),n=O(_),o.l(_),i=O(_),F(a.$$.fragment,_)},m(_,f){T(e,_,f),j(_,n,f),c[r].m(_,f),j(_,i,f),T(a,_,f),l=!0},p(_,f){const v={};f&8192&&(v.$$scope={dirty:f,ctx:_}),e.$set(v);let C=r;r=g(_),r===C?c[r].p(_,f):(se(),k(c[C],1,1,()=>{c[C]=null}),ue(),o=c[r],o?o.p(_,f):(o=c[r]=s[r](_),o.c()),y(o,1),o.m(i.parentNode,i));const N={};f&8192&&(N.$$scope={dirty:f,ctx:_}),a.$set(N)},i(_){l||(y(e.$$.fragment,_),y(o),y(a.$$.fragment,_),l=!0)},o(_){k(e.$$.fragment,_),k(o),k(a.$$.fragment,_),l=!1},d(_){_&&(w(n),w(i)),q(e,_),c[r].d(_),q(a,_)}}}function At(t){let e,n;return e=new oo({props:{junctionIdx:t[0].idx,stage:t[0].stage}}),{c(){I(e.$$.fragment)},l(r){F(e.$$.fragment,r)},m(r,o){T(e,r,o),n=!0},p(r,o){const i={};o&1&&(i.junctionIdx=r[0].idx),o&1&&(i.stage=r[0].stage),e.$set(i)},i(r){n||(y(e.$$.fragment,r),n=!0)},o(r){k(e.$$.fragment,r),n=!1},d(r){q(e,r)}}}function po(t){let e;return{c(){e=V("Add new junction")},l(n){e=W(n,"Add new junction")},m(n,r){j(n,e,r)},d(n){n&&w(e)}}}function Mt(t){let e,n;function r(){return t[4](t[12])}return e=new et({props:{name:t[10].name||"Untitled junction"}}),e.$on("click",r),{c(){I(e.$$.fragment)},l(o){F(e.$$.fragment,o)},m(o,i){T(e,o,i),n=!0},p(o,i){t=o;const a={};i&2&&(a.name=t[10].name||"Untitled junction"),e.$set(a)},i(o){n||(y(e.$$.fragment,o),n=!0)},o(o){k(e.$$.fragment,o),n=!1},d(o){q(e,o)}}}function _o(t){let e,n,r,o,i,a,l,s;e=new kn({props:{title:"Junction Assessment Tool Check Manual",section:jn[10],link:"/route_check/manual"}});const c=[ao,io],g=[];function _(f,v){return f[0].kind=="list"?0:f[0].kind=="edit"?1:-1}return~(i=_(t))&&(a=g[i]=c[i](t)),{c(){I(e.$$.fragment),n=B(),r=re("br"),o=B(),a&&a.c(),l=de()},l(f){F(e.$$.fragment,f),n=O(f),r=oe(f,"BR",{}),o=O(f),a&&a.l(f),l=de()},m(f,v){T(e,f,v),j(f,n,v),j(f,r,v),j(f,o,v),~i&&g[i].m(f,v),j(f,l,v),s=!0},p(f,[v]){let C=i;i=_(f),i===C?~i&&g[i].p(f,v):(a&&(se(),k(g[C],1,1,()=>{g[C]=null}),ue()),~i?(a=g[i],a?a.p(f,v):(a=g[i]=c[i](f),a.c()),y(a,1),a.m(l.parentNode,l)):a=null)},i(f){s||(y(e.$$.fragment,f),y(a),s=!0)},o(f){k(e.$$.fragment,f),k(a),s=!1},d(f){f&&(w(n),w(r),w(o),w(l)),q(e,f),~i&&g[i].d(f)}}}function Ve(t){if(t.kind=="list")throw new Error("Unreachable case");return t.idx}function ho(t,e,n){let r;Re(t,Z,v=>n(1,r=v));let o={kind:"list"};function i(){qe(Z,r.jat=[...r.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],r),n(0,o={kind:"edit",idx:r.jat.length-1,stage:"existing"})}function a(v){window.confirm("Delete this junction?")&&(r.jat.splice(v,1),Z.set(r),n(0,o={kind:"list"}))}const l=v=>n(0,o={kind:"edit",idx:v,stage:"existing"}),s=()=>n(0,o={kind:"list"}),c=()=>n(0,o={kind:"edit",idx:Ve(o),stage:"existing"}),g=()=>n(0,o={kind:"edit",idx:Ve(o),stage:"proposed"}),_=()=>a(Ve(o));function f(v){t.$$.not_equal(r.jat[o.idx].name,v)&&(r.jat[o.idx].name=v,Z.set(r))}return[o,r,i,a,l,s,c,g,_,f]}class Jo extends Be{constructor(e){super(),Oe(this,e,ho,_o,Ee,{})}}export{Jo as component};
