import{s as Ce,r as ge,d as m,a as Q,v as de,i as q,b as i,p as ae,c as f,e as S,q as D,g as v,f as L,h as C,j as _,t as F,k as le}from"../chunks/hklQk-fT.js";import{S as he,i as pe,e as ve,d as re,t as oe,a as se,m as ne,c as ie,b as ue}from"../chunks/4RGf_tlt.js";import{h as _e,s as ce}from"../chunks/CFInOUOc.js";import"../chunks/D0kRk3uf.js";import{S as ke}from"../chunks/DA7LY1yu.js";import{T as ye}from"../chunks/By-iwSz6.js";import{s as me,c as xe}from"../chunks/BzyJoe8Q.js";import{E as Se}from"../chunks/Bezo7dsq.js";const be=""+new URL("../assets/blank_area_check.uvpRTcLS.xlsx",import.meta.url).href;async function we(e,l){console.log("Loading blank area check xlsx");let r=await(await fetch(be)).arrayBuffer(),o=new Se.Workbook;await o.xlsx.load(r),$e(e,o),Ee(e,o),Te(e,o),o.getWorksheet("Results & Commentary").getCell("F17").value=e.resultsNotes,console.log("Writing area check xlsx");let u=await o.xlsx.writeBuffer();_e(u,`area_check_${l}.xlsx`)}function $e(e,l){let t=l.getWorksheet("Summary of Scheme");t.getCell("C6").value=e.summary.dateDesignReview,t.getCell("C7").value=e.summary.schemeReference,t.getCell("C8").value=e.summary.schemeName,t.getCell("C9").value=e.summary.schemeSummary,t.getCell("C10").value=e.summary.schemeInfoReviewed,t.getCell("C11").value=e.summary.authority,t.getCell("C12").value=e.summary.transportOrCombinedAuthority,t.getCell("C13").value=e.summary.region,t.getCell("C14").value=e.summary.fundingProgramme,t.getCell("C15").value=e.summary.designStage,t.getCell("C16").value=e.summary.fundingConditions,t.getCell("C17").value=e.summary.inspectorEmail,t.getCell("C18").value=e.summary.schemeAreaSizeKm2,t.getCell("C19").value=e.summary.notes}function Ee(e,l){let t=l.getWorksheet("Traffic Mitigation Check"),r=e.trafficMitigationCheck;t.getCell("C6").value=r.q1,t.getCell("C11").value=r.q2,t.getCell("C16").value=r.q3,r.q3=="Major routes (e.g. scheme eliminates a rat run)"?(t.getCell("C21").value=r.majorQ1,t.getCell("C26").value=r.majorQ2,t.getCell("C31").value=r.majorQ3,t.getCell("C36").value=r.majorQ4):r.q3=="Minor streets (e.g. residential)"&&(t.getCell("C21").value=r.minorQ1,t.getCell("C26").value=r.minorQ2),t.getCell("E11").value=r.notes}function Te(e,l){let t=l.getWorksheet("Area Scorecard"),r=[10,15,21,26,32,37,43,48,54,60,66,72,78];for(let o=0;o<e.existingScores.length;o++){t.getCell("H"+r[o]).value=e.existingScoreNotes[o],t.getCell("L"+r[o]).value=e.proposedScoreNotes[o];for(let u=0;u<5;u++){let c=t.getCell("C"+(r[o]+u)).value;t.getCell("F"+(r[o]+u)).value=e.existingScores[o]==c||u==0&&e.existingScores[o]==""?"Yes":"No",t.getCell("J"+(r[o]+u)).value=e.proposedScores[o]==c||u==0&&e.proposedScores[o]==""?"Yes":"No"}}}function Me(e){let l;return{c(){l=F("Convert to .xlsx (takes a few seconds)")},l(t){l=L(t,"Convert to .xlsx (takes a few seconds)")},m(t,r){q(t,l,r)},d(t){t&&m(l)}}}function Ne(e){let l,t,r="Traffic Mitigation Check Results",o,u,c=e[0].trafficMitigationCheck.notes+"",b,E,s,y,K="Area Scorecard Results",I,w,V="<th>Existing Area Score</th> <th>Proposed Area Score</th> <th>Uplift</th>",O,g,T,P,U,M,W,J,N,A=e[1]-e[2]+"",j,Y,d,z,B,h,H,x,G=`<i>When you open the file, you need to force Excel to recalculate all formulas
    with Ctrl + Alt + F9</i>`,k;function fe(a){e[4](a)}let X={label:"Comments on Area Scorecard"};return e[0].resultsNotes!==void 0&&(X.value=e[0].resultsNotes),d=new ye({props:X}),ge.push(()=>ve(d,"value",fe)),h=new ke({props:{$$slots:{default:[Me]},$$scope:{ctx:e}}}),h.$on("click",e[3]),{c(){l=C("div"),t=C("h2"),t.textContent=r,o=_(),u=C("p"),b=F(c),E=_(),s=C("table"),y=C("caption"),y.textContent=K,I=_(),w=C("tr"),w.innerHTML=V,O=_(),g=C("tr"),T=C("td"),P=F(e[2]),U=_(),M=C("td"),W=F(e[1]),J=_(),N=C("td"),j=F(A),Y=_(),ue(d.$$.fragment),B=_(),ue(h.$$.fragment),H=_(),x=C("p"),x.innerHTML=G,this.h()},l(a){l=f(a,"DIV",{class:!0});var n=S(l);t=f(n,"H2",{"data-svelte-h":!0}),D(t)!=="svelte-anx0ls"&&(t.textContent=r),o=v(n),u=f(n,"P",{});var R=S(u);b=L(R,c),R.forEach(m),E=v(n),s=f(n,"TABLE",{});var p=S(s);y=f(p,"CAPTION",{class:!0,"data-svelte-h":!0}),D(y)!=="svelte-n1427n"&&(y.textContent=K),I=v(p),w=f(p,"TR",{"data-svelte-h":!0}),D(w)!=="svelte-18seq6c"&&(w.innerHTML=V),O=v(p),g=f(p,"TR",{});var $=S(g);T=f($,"TD",{});var Z=S(T);P=L(Z,e[2]),Z.forEach(m),U=v($),M=f($,"TD",{});var ee=S(M);W=L(ee,e[1]),ee.forEach(m),J=v($),N=f($,"TD",{});var te=S(N);j=L(te,A),te.forEach(m),$.forEach(m),p.forEach(m),Y=v(n),ie(d.$$.fragment,n),n.forEach(m),B=v(a),ie(h.$$.fragment,a),H=v(a),x=f(a,"P",{"data-svelte-h":!0}),D(x)!=="svelte-6hhtkc"&&(x.innerHTML=G),this.h()},h(){ae(y,"class","govuk-table__caption govuk-table__caption--m"),ae(l,"class","govuk-width-container")},m(a,n){q(a,l,n),i(l,t),i(l,o),i(l,u),i(u,b),i(l,E),i(l,s),i(s,y),i(s,I),i(s,w),i(s,O),i(s,g),i(g,T),i(T,P),i(g,U),i(g,M),i(M,W),i(g,J),i(g,N),i(N,j),i(l,Y),ne(d,l,null),q(a,B,n),ne(h,a,n),q(a,H,n),q(a,x,n),k=!0},p(a,[n]){(!k||n&1)&&c!==(c=a[0].trafficMitigationCheck.notes+"")&&Q(b,c),(!k||n&4)&&Q(P,a[2]),(!k||n&2)&&Q(W,a[1]),(!k||n&6)&&A!==(A=a[1]-a[2]+"")&&Q(j,A);const R={};!z&&n&1&&(z=!0,R.value=a[0].resultsNotes,de(()=>z=!1)),d.$set(R);const p={};n&64&&(p.$$scope={dirty:n,ctx:a}),h.$set(p)},i(a){k||(se(d.$$.fragment,a),se(h.$$.fragment,a),k=!0)},o(a){oe(d.$$.fragment,a),oe(h.$$.fragment,a),k=!1},d(a){a&&(m(l),m(B),m(H),m(x)),re(d),re(h,a)}}}function Ae(e,l,t){let r,o,u,c;le(e,xe,s=>t(5,u=s)),le(e,me,s=>t(0,c=s));async function b(){try{await we(c,u)}catch(s){window.alert(`Conversion failed: ${s}`)}}function E(s){e.$$.not_equal(c.resultsNotes,s)&&(c.resultsNotes=s,me.set(c))}return e.$$.update=()=>{e.$$.dirty&1&&t(2,r=ce(c.existingScores.map(s=>parseInt(s||"0")))),e.$$.dirty&1&&t(1,o=ce(c.proposedScores.map(s=>parseInt(s||"0"))))},[c,o,r,b,E]}class He extends he{constructor(l){super(),pe(this,l,Ae,Ne,Ce,{})}}export{He as component};
