import{s as Ne,r as Z,e as J,t as H,a as q,c as U,b as O,d as K,f as m,g as A,q as M,v as z,i as b,h as B,w as X,k as be,V as re,y as gt,G as Ce,E as x,p as he,K as ve,j as ae,I as dt,O as _e,P as me,n as ht}from"../chunks/scheduler.Bpan6Ont.js";import{S as Se,i as Ee,e as Q,c as G,a as V,m as j,t as h,g as ne,b as C,f as ie,d as T}from"../chunks/index.B_gktW-4.js";import{g as bt}from"../chunks/globals.D0QH3NT1.js";import{e as se}from"../chunks/each.rqQRCiyP.js";import{p as vt}from"../chunks/stores.CxgI06z2.js";import{G as kt,S as wt,C as Ze}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.BEQFiPnB.js";import{C as yt}from"../chunks/CheckboxGroup.DNpm-CPd.js";import{B as Ct,C as Xe,M as Qe}from"../chunks/Marker.B6IgNbLA.js";import{C as It}from"../chunks/CollapsibleCard.CnaEhlqF.js";import{D as Lt}from"../chunks/DefaultButton.pW5DN5JW.js";import{I as Ie,p as Nt,G as St}from"../chunks/pan.DOQmrb0u.js";import"../chunks/SelectWithCustom.svelte_svelte_type_style_lang.CF9DEGxe.js";import{S as Le}from"../chunks/SecondaryButton.CmPSp86y.js";import{W as Et}from"../chunks/WarningButton.BjgVp-1z.js";import{p as xe,d as Dt}from"../chunks/authority_names.q23vDEAl.js";import"../chunks/paths.hsw4WodT.js";import"../chunks/entry.DoV6p_Wl.js";import{p as De,c as et}from"../chunks/colors.DaC397qr.js";import{l as ke,n as we,M as Pt,o as Bt,G as Mt,b as qt,C as At}from"../chunks/index.C2gZs7t0.js";import{s as Y}from"../chunks/data.C4EKNHD0.js";import{p as Rt,c as Gt,b as Be,e as Me,f as Vt,g as jt}from"../chunks/lists.CDD60ceY.js";import{R as Tt}from"../chunks/RouteMapLayer.CKIkiFlS.js";import{R as tt}from"../chunks/Radio.BdXxJUhT.js";import{S as lt}from"../chunks/Select.-o8eNBRo.js";import{T as nt}from"../chunks/TextArea.DYByNowJ.js";import{T as it}from"../chunks/TextInput.DwRSvJsQ.js";import{Y as ot}from"../chunks/YesNo.Bl55rSki.js";function qe(i){let e,t,l;function n(o){i[5](o)}let s={label:"Resolved by Design",inlineSmall:!0};return i[1].policyConflictLog[i[0]].resolved!==void 0&&(s.value=i[1].policyConflictLog[i[0]].resolved),e=new ot({props:s}),Z.push(()=>Q(e,"value",n)),{c(){G(e.$$.fragment)},l(o){V(e.$$.fragment,o)},m(o,f){j(e,o,f),l=!0},p(o,f){const r={};!t&&f&3&&(t=!0,r.value=o[1].policyConflictLog[o[0]].resolved,X(()=>t=!1)),e.$set(r)},i(o){l||(h(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){T(e,o)}}}function Ft(i){let e,t,l,n,s,o,f,r,u,c,v,L,N,$,E,k,y,D,a,_,g,w;function I(p){i[2](p)}let W={label:"Policy Conflict",emptyOption:!0,choices:Rt};i[1].policyConflictLog[i[0]].conflict!==void 0&&(W.value=i[1].policyConflictLog[i[0]].conflict),c=new lt({props:W}),Z.push(()=>Q(c,"value",I));function R(p){i[3](p)}let ee={label:"Stage",choices:xe(["Existing","Design"]),inlineSmall:!0};i[1].policyConflictLog[i[0]].stage!==void 0&&(ee.value=i[1].policyConflictLog[i[0]].stage),N=new tt({props:ee}),Z.push(()=>Q(N,"value",R));function $e(p){i[4](p)}let fe={label:"Location Name"};i[1].policyConflictLog[i[0]].locationName!==void 0&&(fe.value=i[1].policyConflictLog[i[0]].locationName),k=new it({props:fe}),Z.push(()=>Q(k,"value",$e));let P=i[1].policyConflictLog[i[0]].stage!="Design"&&qe(i);function ge(p){i[6](p)}let ce={label:"Commentary & Feedback"};return i[1].policyConflictLog[i[0]].notes!==void 0&&(ce.value=i[1].policyConflictLog[i[0]].notes),_=new nt({props:ce}),Z.push(()=>Q(_,"value",ge)),{c(){e=J("div"),t=J("a"),l=H("Google StreetView"),s=q(),o=J("a"),f=H("Bing Streetside"),u=q(),G(c.$$.fragment),L=q(),G(N.$$.fragment),E=q(),G(k.$$.fragment),D=q(),P&&P.c(),a=q(),G(_.$$.fragment),this.h()},l(p){e=U(p,"DIV",{style:!0});var S=O(e);t=U(S,"A",{href:!0,target:!0});var te=O(t);l=K(te,"Google StreetView"),te.forEach(m),s=A(S),o=U(S,"A",{href:!0,target:!0});var le=O(o);f=K(le,"Bing Streetside"),le.forEach(m),S.forEach(m),u=A(p),V(c.$$.fragment,p),L=A(p),V(N.$$.fragment,p),E=A(p),V(k.$$.fragment,p),D=A(p),P&&P.l(p),a=A(p),V(_.$$.fragment,p),this.h()},h(){M(t,"href",n=ke(i[1].policyConflictLog[i[0]].point)),M(t,"target","_blank"),M(o,"href",r=we(i[1].policyConflictLog[i[0]].point)),M(o,"target","_blank"),z(e,"display","flex"),z(e,"justify-content","space-evenly")},m(p,S){b(p,e,S),B(e,t),B(t,l),B(e,s),B(e,o),B(o,f),b(p,u,S),j(c,p,S),b(p,L,S),j(N,p,S),b(p,E,S),j(k,p,S),b(p,D,S),P&&P.m(p,S),b(p,a,S),j(_,p,S),w=!0},p(p,[S]){(!w||S&3&&n!==(n=ke(p[1].policyConflictLog[p[0]].point)))&&M(t,"href",n),(!w||S&3&&r!==(r=we(p[1].policyConflictLog[p[0]].point)))&&M(o,"href",r);const te={};!v&&S&3&&(v=!0,te.value=p[1].policyConflictLog[p[0]].conflict,X(()=>v=!1)),c.$set(te);const le={};!$&&S&3&&($=!0,le.value=p[1].policyConflictLog[p[0]].stage,X(()=>$=!1)),N.$set(le);const ue={};!y&&S&3&&(y=!0,ue.value=p[1].policyConflictLog[p[0]].locationName,X(()=>y=!1)),k.$set(ue),p[1].policyConflictLog[p[0]].stage!="Design"?P?(P.p(p,S),S&3&&h(P,1)):(P=qe(p),P.c(),h(P,1),P.m(a.parentNode,a)):P&&(ne(),C(P,1,1,()=>{P=null}),ie());const pe={};!g&&S&3&&(g=!0,pe.value=p[1].policyConflictLog[p[0]].notes,X(()=>g=!1)),_.$set(pe)},i(p){w||(h(c.$$.fragment,p),h(N.$$.fragment,p),h(k.$$.fragment,p),h(P),h(_.$$.fragment,p),w=!0)},o(p){C(c.$$.fragment,p),C(N.$$.fragment,p),C(k.$$.fragment,p),C(P),C(_.$$.fragment,p),w=!1},d(p){p&&(m(e),m(u),m(L),m(E),m(D),m(a)),T(c,p),T(N,p),T(k,p),P&&P.d(p),T(_,p)}}}function Ot(i,e,t){let l;be(i,Y,c=>t(1,l=c));let{idx:n}=e;function s(c){i.$$.not_equal(l.policyConflictLog[n].conflict,c)&&(l.policyConflictLog[n].conflict=c,Y.set(l))}function o(c){i.$$.not_equal(l.policyConflictLog[n].stage,c)&&(l.policyConflictLog[n].stage=c,Y.set(l))}function f(c){i.$$.not_equal(l.policyConflictLog[n].locationName,c)&&(l.policyConflictLog[n].locationName=c,Y.set(l))}function r(c){i.$$.not_equal(l.policyConflictLog[n].resolved,c)&&(l.policyConflictLog[n].resolved=c,Y.set(l))}function u(c){i.$$.not_equal(l.policyConflictLog[n].notes,c)&&(l.policyConflictLog[n].notes=c,Y.set(l))}return i.$$set=c=>{"idx"in c&&t(0,n=c.idx)},i.$$.update=()=>{i.$$.dirty&3&&l.policyConflictLog[n].stage=="Design"&&re(Y,l.policyConflictLog[n].resolved="",l)},[n,l,s,o,f,r,u]}class Jt extends Se{constructor(e){super(),Ee(this,e,Ot,Ft,Ne,{idx:0})}}function Ae(i){let e,t,l;function n(o){i[5](o)}let s={label:"Resolved by Design",inlineSmall:!0};return i[1].criticalIssues[i[0]].resolved!==void 0&&(s.value=i[1].criticalIssues[i[0]].resolved),e=new ot({props:s}),Z.push(()=>Q(e,"value",n)),{c(){G(e.$$.fragment)},l(o){V(e.$$.fragment,o)},m(o,f){j(e,o,f),l=!0},p(o,f){const r={};!t&&f&3&&(t=!0,r.value=o[1].criticalIssues[o[0]].resolved,X(()=>t=!1)),e.$set(r)},i(o){l||(h(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){T(e,o)}}}function Ut(i){let e,t,l,n,s,o,f,r,u,c,v,L,N,$,E,k,y,D,a,_,g,w;function I(p){i[2](p)}let W={label:"Critical Issue",emptyOption:!0,choices:Gt};i[1].criticalIssues[i[0]].criticalIssue!==void 0&&(W.value=i[1].criticalIssues[i[0]].criticalIssue),c=new lt({props:W}),Z.push(()=>Q(c,"value",I));function R(p){i[3](p)}let ee={label:"Stage",choices:xe(["Existing","Design"]),inlineSmall:!0};i[1].criticalIssues[i[0]].stage!==void 0&&(ee.value=i[1].criticalIssues[i[0]].stage),N=new tt({props:ee}),Z.push(()=>Q(N,"value",R));function $e(p){i[4](p)}let fe={label:"Location Name"};i[1].criticalIssues[i[0]].locationName!==void 0&&(fe.value=i[1].criticalIssues[i[0]].locationName),k=new it({props:fe}),Z.push(()=>Q(k,"value",$e));let P=i[1].criticalIssues[i[0]].stage!="Design"&&Ae(i);function ge(p){i[6](p)}let ce={label:"Commentary & Feedback"};return i[1].criticalIssues[i[0]].notes!==void 0&&(ce.value=i[1].criticalIssues[i[0]].notes),_=new nt({props:ce}),Z.push(()=>Q(_,"value",ge)),{c(){e=J("div"),t=J("a"),l=H("Google StreetView"),s=q(),o=J("a"),f=H("Bing Streetside"),u=q(),G(c.$$.fragment),L=q(),G(N.$$.fragment),E=q(),G(k.$$.fragment),D=q(),P&&P.c(),a=q(),G(_.$$.fragment),this.h()},l(p){e=U(p,"DIV",{style:!0});var S=O(e);t=U(S,"A",{href:!0,target:!0});var te=O(t);l=K(te,"Google StreetView"),te.forEach(m),s=A(S),o=U(S,"A",{href:!0,target:!0});var le=O(o);f=K(le,"Bing Streetside"),le.forEach(m),S.forEach(m),u=A(p),V(c.$$.fragment,p),L=A(p),V(N.$$.fragment,p),E=A(p),V(k.$$.fragment,p),D=A(p),P&&P.l(p),a=A(p),V(_.$$.fragment,p),this.h()},h(){M(t,"href",n=ke(i[1].criticalIssues[i[0]].point)),M(t,"target","_blank"),M(o,"href",r=we(i[1].criticalIssues[i[0]].point)),M(o,"target","_blank"),z(e,"display","flex"),z(e,"justify-content","space-evenly")},m(p,S){b(p,e,S),B(e,t),B(t,l),B(e,s),B(e,o),B(o,f),b(p,u,S),j(c,p,S),b(p,L,S),j(N,p,S),b(p,E,S),j(k,p,S),b(p,D,S),P&&P.m(p,S),b(p,a,S),j(_,p,S),w=!0},p(p,[S]){(!w||S&3&&n!==(n=ke(p[1].criticalIssues[p[0]].point)))&&M(t,"href",n),(!w||S&3&&r!==(r=we(p[1].criticalIssues[p[0]].point)))&&M(o,"href",r);const te={};!v&&S&3&&(v=!0,te.value=p[1].criticalIssues[p[0]].criticalIssue,X(()=>v=!1)),c.$set(te);const le={};!$&&S&3&&($=!0,le.value=p[1].criticalIssues[p[0]].stage,X(()=>$=!1)),N.$set(le);const ue={};!y&&S&3&&(y=!0,ue.value=p[1].criticalIssues[p[0]].locationName,X(()=>y=!1)),k.$set(ue),p[1].criticalIssues[p[0]].stage!="Design"?P?(P.p(p,S),S&3&&h(P,1)):(P=Ae(p),P.c(),h(P,1),P.m(a.parentNode,a)):P&&(ne(),C(P,1,1,()=>{P=null}),ie());const pe={};!g&&S&3&&(g=!0,pe.value=p[1].criticalIssues[p[0]].notes,X(()=>g=!1)),_.$set(pe)},i(p){w||(h(c.$$.fragment,p),h(N.$$.fragment,p),h(k.$$.fragment,p),h(P),h(_.$$.fragment,p),w=!0)},o(p){C(c.$$.fragment,p),C(N.$$.fragment,p),C(k.$$.fragment,p),C(P),C(_.$$.fragment,p),w=!1},d(p){p&&(m(e),m(u),m(L),m(E),m(D),m(a)),T(c,p),T(N,p),T(k,p),P&&P.d(p),T(_,p)}}}function zt(i,e,t){let l;be(i,Y,c=>t(1,l=c));let{idx:n}=e;function s(c){i.$$.not_equal(l.criticalIssues[n].criticalIssue,c)&&(l.criticalIssues[n].criticalIssue=c,Y.set(l))}function o(c){i.$$.not_equal(l.criticalIssues[n].stage,c)&&(l.criticalIssues[n].stage=c,Y.set(l))}function f(c){i.$$.not_equal(l.criticalIssues[n].locationName,c)&&(l.criticalIssues[n].locationName=c,Y.set(l))}function r(c){i.$$.not_equal(l.criticalIssues[n].resolved,c)&&(l.criticalIssues[n].resolved=c,Y.set(l))}function u(c){i.$$.not_equal(l.criticalIssues[n].notes,c)&&(l.criticalIssues[n].notes=c,Y.set(l))}return i.$$set=c=>{"idx"in c&&t(0,n=c.idx)},i.$$.update=()=>{i.$$.dirty&3&&l.criticalIssues[n].stage=="Design"&&re(Y,l.criticalIssues[n].resolved="",l)},[n,l,s,o,f,r,u]}class Ht extends Se{constructor(e){super(),Ee(this,e,zt,Ut,Ne,{idx:0})}}const{window:Kt}=bt;function Re(i,e,t){const l=i.slice();return l[43]=e[t],l[44]=e,l[45]=t,l}function Ge(i,e,t){const l=i.slice();return l[46]=e[t],l[47]=e,l[45]=t,l}function Ve(i,e,t){const l=i.slice();return l[43]=e[t],l[45]=t,l}function je(i,e,t){const l=i.slice();return l[46]=e[t],l[45]=t,l}function Wt(i){let e,t,l,n,s,o,f,r,u,c;e=new Lt({props:{$$slots:{default:[Zt]},$$scope:{ctx:i}}}),e.$on("click",i[12]),l=new Et({props:{$$slots:{default:[Xt]},$$scope:{ctx:i}}}),l.$on("click",i[14]),s=new Le({props:{$$slots:{default:[Qt]},$$scope:{ctx:i}}}),s.$on("click",i[11]);const v=[el,xt],L=[];function N($,E){return $[1].id.kind=="critical"?0:1}return f=N(i),r=L[f]=v[f](i),{c(){G(e.$$.fragment),t=q(),G(l.$$.fragment),n=q(),G(s.$$.fragment),o=q(),r.c(),u=x()},l($){V(e.$$.fragment,$),t=A($),V(l.$$.fragment,$),n=A($),V(s.$$.fragment,$),o=A($),r.l($),u=x()},m($,E){j(e,$,E),b($,t,E),j(l,$,E),b($,n,E),j(s,$,E),b($,o,E),L[f].m($,E),b($,u,E),c=!0},p($,E){const k={};E[1]&524288&&(k.$$scope={dirty:E,ctx:$}),e.$set(k);const y={};E[1]&524288&&(y.$$scope={dirty:E,ctx:$}),l.$set(y);const D={};E[1]&524288&&(D.$$scope={dirty:E,ctx:$}),s.$set(D);let a=f;f=N($),f===a?L[f].p($,E):(ne(),C(L[a],1,1,()=>{L[a]=null}),ie(),r=L[f],r?r.p($,E):(r=L[f]=v[f]($),r.c()),h(r,1),r.m(u.parentNode,u))},i($){c||(h(e.$$.fragment,$),h(l.$$.fragment,$),h(s.$$.fragment,$),h(r),c=!0)},o($){C(e.$$.fragment,$),C(l.$$.fragment,$),C(s.$$.fragment,$),C(r),c=!1},d($){$&&(m(t),m(n),m(o),m(u)),T(e,$),T(l,$),T(s,$),L[f].d($)}}}function Yt(i){let e,t,l,n,s,o,f="Critical Issue Log",r,u,c,v,L="Policy Conflict Log",N,$;e=new It({props:{label:"Map tools",$$slots:{default:[il]},$$scope:{ctx:i}}}),l=new yt({props:{small:!0,$$slots:{default:[rl]},$$scope:{ctx:i}}});let E=se(i[3].criticalIssues),k=[];for(let g=0;g<E.length;g+=1)k[g]=Fe(je(i,E,g));const y=g=>C(k[g],1,1,()=>{k[g]=null});let D=se(i[3].policyConflictLog),a=[];for(let g=0;g<D.length;g+=1)a[g]=Je(Ve(i,D,g));const _=g=>C(a[g],1,1,()=>{a[g]=null});return{c(){G(e.$$.fragment),t=q(),G(l.$$.fragment),n=q(),s=J("div"),o=J("h3"),o.textContent=f,r=q();for(let g=0;g<k.length;g+=1)k[g].c();u=q(),c=J("div"),v=J("h3"),v.textContent=L,N=q();for(let g=0;g<a.length;g+=1)a[g].c();this.h()},l(g){V(e.$$.fragment,g),t=A(g),V(l.$$.fragment,g),n=A(g),s=U(g,"DIV",{style:!0});var w=O(s);o=U(w,"H3",{"data-svelte-h":!0}),he(o)!=="svelte-e9mkko"&&(o.textContent=f),r=A(w);for(let W=0;W<k.length;W+=1)k[W].l(w);w.forEach(m),u=A(g),c=U(g,"DIV",{style:!0});var I=O(c);v=U(I,"H3",{"data-svelte-h":!0}),he(v)!=="svelte-y008oc"&&(v.textContent=L),N=A(I);for(let W=0;W<a.length;W+=1)a[W].l(I);I.forEach(m),this.h()},h(){z(s,"background-color","grey"),z(s,"padding","4px"),z(c,"background-color",De),z(c,"padding","4px")},m(g,w){j(e,g,w),b(g,t,w),j(l,g,w),b(g,n,w),b(g,s,w),B(s,o),B(s,r);for(let I=0;I<k.length;I+=1)k[I]&&k[I].m(s,null);b(g,u,w),b(g,c,w),B(c,v),B(c,N);for(let I=0;I<a.length;I+=1)a[I]&&a[I].m(c,null);$=!0},p(g,w){const I={};w[0]&97|w[1]&524288&&(I.$$scope={dirty:w,ctx:g}),e.$set(I);const W={};if(w[0]&128|w[1]&524288&&(W.$$scope={dirty:w,ctx:g}),l.$set(W),w[0]&132108){E=se(g[3].criticalIssues);let R;for(R=0;R<E.length;R+=1){const ee=je(g,E,R);k[R]?(k[R].p(ee,w),h(k[R],1)):(k[R]=Fe(ee),k[R].c(),h(k[R],1),k[R].m(s,null))}for(ne(),R=E.length;R<k.length;R+=1)y(R);ie()}if(w[0]&263180){D=se(g[3].policyConflictLog);let R;for(R=0;R<D.length;R+=1){const ee=Ve(g,D,R);a[R]?(a[R].p(ee,w),h(a[R],1)):(a[R]=Je(ee),a[R].c(),h(a[R],1),a[R].m(c,null))}for(ne(),R=D.length;R<a.length;R+=1)_(R);ie()}},i(g){if(!$){h(e.$$.fragment,g),h(l.$$.fragment,g);for(let w=0;w<E.length;w+=1)h(k[w]);for(let w=0;w<D.length;w+=1)h(a[w]);$=!0}},o(g){C(e.$$.fragment,g),C(l.$$.fragment,g),k=k.filter(Boolean);for(let w=0;w<k.length;w+=1)C(k[w]);a=a.filter(Boolean);for(let w=0;w<a.length;w+=1)C(a[w]);$=!1},d(g){g&&(m(t),m(n),m(s),m(u),m(c)),T(e,g),T(l,g),ve(k,g),ve(a,g)}}}function Zt(i){let e;return{c(){e=H("Save")},l(t){e=K(t,"Save")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function Xt(i){let e;return{c(){e=H("Delete")},l(t){e=K(t,"Delete")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function Qt(i){let e;return{c(){e=H("Copy")},l(t){e=K(t,"Copy")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function xt(i){let e,t;return e=new Jt({props:{idx:i[1].id.idx}}),{c(){G(e.$$.fragment)},l(l){V(e.$$.fragment,l)},m(l,n){j(e,l,n),t=!0},p(l,n){const s={};n[0]&2&&(s.idx=l[1].id.idx),e.$set(s)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function el(i){let e,t;return e=new Ht({props:{idx:i[1].id.idx}}),{c(){G(e.$$.fragment)},l(l){V(e.$$.fragment,l)},m(l,n){j(e,l,n),t=!0},p(l,n){const s={};n[0]&2&&(s.idx=l[1].id.idx),e.$set(s)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function tl(i){let e;return{c(){e=H("Zoom to fit")},l(t){e=K(t,"Zoom to fit")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function ll(i){let e;return{c(){e=H("Show route")},l(t){e=K(t,"Show route")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function nl(i){let e;return{c(){e=H("Export Problems Map")},l(t){e=K(t,"Export Problems Map")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function il(i){let e,t,l,n,s,o,f,r,u,c,v,L,N,$;e=new Le({props:{$$slots:{default:[tl]},$$scope:{ctx:i}}}),e.$on("click",i[20]),l=new Ct({}),s=new kt({});function E(a){i[21](a)}let k={map:i[0]};i[5]!==void 0&&(k.enabled=i[5]),f=new wt({props:k}),Z.push(()=>Q(f,"enabled",E));function y(a){i[22](a)}let D={$$slots:{default:[ll]},$$scope:{ctx:i}};return i[6]!==void 0&&(D.checked=i[6]),c=new Xe({props:D}),Z.push(()=>Q(c,"checked",y)),N=new Le({props:{$$slots:{default:[nl]},$$scope:{ctx:i}}}),N.$on("click",i[16]),{c(){G(e.$$.fragment),t=q(),G(l.$$.fragment),n=q(),G(s.$$.fragment),o=q(),G(f.$$.fragment),u=q(),G(c.$$.fragment),L=q(),G(N.$$.fragment)},l(a){V(e.$$.fragment,a),t=A(a),V(l.$$.fragment,a),n=A(a),V(s.$$.fragment,a),o=A(a),V(f.$$.fragment,a),u=A(a),V(c.$$.fragment,a),L=A(a),V(N.$$.fragment,a)},m(a,_){j(e,a,_),b(a,t,_),j(l,a,_),b(a,n,_),j(s,a,_),b(a,o,_),j(f,a,_),b(a,u,_),j(c,a,_),b(a,L,_),j(N,a,_),$=!0},p(a,_){const g={};_[1]&524288&&(g.$$scope={dirty:_,ctx:a}),e.$set(g);const w={};_[0]&1&&(w.map=a[0]),!r&&_[0]&32&&(r=!0,w.enabled=a[5],X(()=>r=!1)),f.$set(w);const I={};_[1]&524288&&(I.$$scope={dirty:_,ctx:a}),!v&&_[0]&64&&(v=!0,I.checked=a[6],X(()=>v=!1)),c.$set(I);const W={};_[1]&524288&&(W.$$scope={dirty:_,ctx:a}),N.$set(W)},i(a){$||(h(e.$$.fragment,a),h(l.$$.fragment,a),h(s.$$.fragment,a),h(f.$$.fragment,a),h(c.$$.fragment,a),h(N.$$.fragment,a),$=!0)},o(a){C(e.$$.fragment,a),C(l.$$.fragment,a),C(s.$$.fragment,a),C(f.$$.fragment,a),C(c.$$.fragment,a),C(N.$$.fragment,a),$=!1},d(a){a&&(m(t),m(n),m(o),m(u),m(L)),T(e,a),T(l,a),T(s,a),T(f,a),T(c,a),T(N,a)}}}function ol(i){let e;return{c(){e=H("Show resolved problems")},l(t){e=K(t,"Show resolved problems")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function rl(i){let e,t,l;function n(o){i[23](o)}let s={$$slots:{default:[ol]},$$scope:{ctx:i}};return i[7]!==void 0&&(s.checked=i[7]),e=new Xe({props:s}),Z.push(()=>Q(e,"checked",n)),{c(){G(e.$$.fragment)},l(o){V(e.$$.fragment,o)},m(o,f){j(e,o,f),l=!0},p(o,f){const r={};f[1]&524288&&(r.$$scope={dirty:f,ctx:o}),!t&&f[0]&128&&(t=!0,r.checked=o[7],X(()=>t=!1)),e.$set(r)},i(o){l||(h(e.$$.fragment,o),l=!0)},o(o){C(e.$$.fragment,o),l=!1},d(o){T(e,o)}}}function Te(i){let e;function t(s,o){return s[46].resolved=="No"?al:sl}let l=t(i),n=l(i);return{c(){n.c(),e=x()},l(s){n.l(s),e=x()},m(s,o){n.m(s,o),b(s,e,o)},p(s,o){l===(l=t(s))&&n?n.p(s,o):(n.d(1),n=l(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&m(e),n.d(s)}}}function sl(i){let e,t,l=i[46].resolved+"",n;return{c(){e=J("span"),t=H("Resolved: "),n=H(l)},l(s){e=U(s,"SPAN",{});var o=O(e);t=K(o,"Resolved: "),n=K(o,l),o.forEach(m)},m(s,o){b(s,e,o),B(e,t),B(e,n)},p(s,o){o[0]&8&&l!==(l=s[46].resolved+"")&&ae(n,l)},d(s){s&&m(e)}}}function al(i){let e,t,l,n=i[46].resolved+"",s;return{c(){e=J("span"),t=J("b"),l=H("Resolved: "),s=H(n)},l(o){e=U(o,"SPAN",{});var f=O(e);t=U(f,"B",{});var r=O(t);l=K(r,"Resolved: "),s=K(r,n),r.forEach(m),f.forEach(m)},m(o,f){b(o,e,f),B(e,t),B(t,l),B(t,s)},p(o,f){f[0]&8&&n!==(n=o[46].resolved+"")&&ae(s,n)},d(o){o&&m(e)}}}function fl(i){let e,t,l,n=i[46].stage+"",s,o,f,r=i[46].stage!="Design"&&Te(i);return{c(){e=J("div"),t=J("span"),l=H("Stage: "),s=H(n),o=q(),r&&r.c(),f=q(),this.h()},l(u){e=U(u,"DIV",{style:!0});var c=O(e);t=U(c,"SPAN",{});var v=O(t);l=K(v,"Stage: "),s=K(v,n),v.forEach(m),o=A(c),r&&r.l(c),c.forEach(m),f=A(u),this.h()},h(){z(e,"width","100%"),z(e,"display","flex"),z(e,"justify-content","space-between")},m(u,c){b(u,e,c),B(e,t),B(t,l),B(t,s),B(e,o),r&&r.m(e,null),b(u,f,c)},p(u,c){c[0]&8&&n!==(n=u[46].stage+"")&&ae(s,n),u[46].stage!="Design"?r?r.p(u,c):(r=Te(u),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},d(u){u&&(m(e),m(f)),r&&r.d()}}}function Fe(i){let e,t;function l(){return i[24](i[45])}function n(){return i[25](i[45])}return e=new Ze({props:{name:i[17](i[46]),$$slots:{default:[fl]},$$scope:{ctx:i}}}),e.$on("click",l),e.$on("mouseenter",n),e.$on("mouseleave",i[26]),{c(){G(e.$$.fragment)},l(s){V(e.$$.fragment,s)},m(s,o){j(e,s,o),t=!0},p(s,o){i=s;const f={};o[0]&8&&(f.name=i[17](i[46])),o[0]&8|o[1]&524288&&(f.$$scope={dirty:o,ctx:i}),e.$set(f)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){T(e,s)}}}function Oe(i){let e;function t(s,o){return s[43].resolved=="No"?ul:cl}let l=t(i),n=l(i);return{c(){n.c(),e=x()},l(s){n.l(s),e=x()},m(s,o){n.m(s,o),b(s,e,o)},p(s,o){l===(l=t(s))&&n?n.p(s,o):(n.d(1),n=l(s),n&&(n.c(),n.m(e.parentNode,e)))},d(s){s&&m(e),n.d(s)}}}function cl(i){let e,t,l=i[43].resolved+"",n;return{c(){e=J("span"),t=H("Resolved: "),n=H(l)},l(s){e=U(s,"SPAN",{});var o=O(e);t=K(o,"Resolved: "),n=K(o,l),o.forEach(m)},m(s,o){b(s,e,o),B(e,t),B(e,n)},p(s,o){o[0]&8&&l!==(l=s[43].resolved+"")&&ae(n,l)},d(s){s&&m(e)}}}function ul(i){let e,t,l,n=i[43].resolved+"",s;return{c(){e=J("span"),t=J("b"),l=H("Resolved: "),s=H(n)},l(o){e=U(o,"SPAN",{});var f=O(e);t=U(f,"B",{});var r=O(t);l=K(r,"Resolved: "),s=K(r,n),r.forEach(m),f.forEach(m)},m(o,f){b(o,e,f),B(e,t),B(t,l),B(t,s)},p(o,f){f[0]&8&&n!==(n=o[43].resolved+"")&&ae(s,n)},d(o){o&&m(e)}}}function pl(i){let e,t,l,n=i[43].stage+"",s,o,f,r=i[43].stage!="Design"&&Oe(i);return{c(){e=J("div"),t=J("span"),l=H("Stage: "),s=H(n),o=q(),r&&r.c(),f=q(),this.h()},l(u){e=U(u,"DIV",{style:!0});var c=O(e);t=U(c,"SPAN",{});var v=O(t);l=K(v,"Stage: "),s=K(v,n),v.forEach(m),o=A(c),r&&r.l(c),c.forEach(m),f=A(u),this.h()},h(){z(e,"width","100%"),z(e,"display","flex"),z(e,"justify-content","space-between")},m(u,c){b(u,e,c),B(e,t),B(t,l),B(t,s),B(e,o),r&&r.m(e,null),b(u,f,c)},p(u,c){c[0]&8&&n!==(n=u[43].stage+"")&&ae(s,n),u[43].stage!="Design"?r?r.p(u,c):(r=Oe(u),r.c(),r.m(e,null)):r&&(r.d(1),r=null)},d(u){u&&(m(e),m(f)),r&&r.d()}}}function Je(i){let e,t;function l(){return i[27](i[45])}function n(){return i[28](i[45])}return e=new Ze({props:{name:i[18](i[43]),$$slots:{default:[pl]},$$scope:{ctx:i}}}),e.$on("click",l),e.$on("mouseenter",n),e.$on("mouseleave",i[29]),{c(){G(e.$$.fragment)},l(s){V(e.$$.fragment,s)},m(s,o){j(e,s,o),t=!0},p(s,o){i=s;const f={};o[0]&8&&(f.name=i[18](i[43])),o[0]&8|o[1]&524288&&(f.$$scope={dirty:o,ctx:i}),e.$set(f)},i(s){t||(h(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){T(e,s)}}}function Ue(i){let e,t,l,n,s,o,f;return t=new Ie({props:{$$slots:{default:[$l]},$$scope:{ctx:i}}}),t.$on("click",i[12]),n=new Ie({props:{$$slots:{default:[hl]},$$scope:{ctx:i}}}),n.$on("click",i[31]),o=new Ie({props:{$$slots:{default:[kl]},$$scope:{ctx:i}}}),o.$on("click",i[32]),{c(){e=J("div"),G(t.$$.fragment),l=q(),G(n.$$.fragment),s=q(),G(o.$$.fragment),this.h()},l(r){e=U(r,"DIV",{class:!0});var u=O(e);V(t.$$.fragment,u),l=A(u),V(n.$$.fragment,u),s=A(u),V(o.$$.fragment,u),u.forEach(m),this.h()},h(){M(e,"class","control-panel svelte-70vzbr")},m(r,u){b(r,e,u),j(t,e,null),B(e,l),j(n,e,null),B(e,s),j(o,e,null),f=!0},p(r,u){const c={};u[0]&2|u[1]&524288&&(c.$$scope={dirty:u,ctx:r}),t.$set(c);const v={};u[0]&2|u[1]&524288&&(v.$$scope={dirty:u,ctx:r}),n.$set(v);const L={};u[0]&2|u[1]&524288&&(L.$$scope={dirty:u,ctx:r}),o.$set(L)},i(r){f||(h(t.$$.fragment,r),h(n.$$.fragment,r),h(o.$$.fragment,r),f=!0)},o(r){C(t.$$.fragment,r),C(n.$$.fragment,r),C(o.$$.fragment,r),f=!1},d(r){r&&m(e),T(t),T(n),T(o)}}}function _l(i){let e;return{c(){e=H("Move map")},l(t){e=K(t,"Move map")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function ml(i){let e,t="Move map";return{c(){e=J("b"),e.textContent=t},l(l){e=U(l,"B",{"data-svelte-h":!0}),he(e)!=="svelte-ydcbkl"&&(e.textContent=t)},m(l,n){b(l,e,n)},d(l){l&&m(e)}}}function $l(i){let e,t,l,n;function s(r,u){return r[1].mode=="select"?ml:_l}let o=s(i),f=o(i);return{c(){e=J("img"),l=q(),f.c(),n=x(),this.h()},l(r){e=U(r,"IMG",{src:!0,alt:!0,style:!0}),l=A(r),f.l(r),n=x(),this.h()},h(){dt(e.src,t=Nt)||M(e,"src",t),M(e,"alt","Move map"),z(e,"vertical-align","middle")},m(r,u){b(r,e,u),b(r,l,u),f.m(r,u),b(r,n,u)},p(r,u){o!==(o=s(r))&&(f.d(1),f=o(r),f&&(f.c(),f.m(n.parentNode,n)))},d(r){r&&(m(e),m(l),m(n)),f.d(r)}}}function gl(i){let e;return{c(){e=H("New critical issue")},l(t){e=K(t,"New critical issue")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function dl(i){let e,t="New critical issue";return{c(){e=J("b"),e.textContent=t},l(l){e=U(l,"B",{"data-svelte-h":!0}),he(e)!=="svelte-1q9dhgs"&&(e.textContent=t)},m(l,n){b(l,e,n)},d(l){l&&m(e)}}}function hl(i){let e,t,l,n;function s(r,u){return r[1].mode=="new-critical"?dl:gl}let o=s(i),f=o(i);return{c(){e=_e("svg"),t=_e("rect"),l=q(),f.c(),n=x(),this.h()},l(r){e=me(r,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var u=O(e);t=me(u,"rect",{width:!0,height:!0,fill:!0,class:!0}),O(t).forEach(m),u.forEach(m),l=A(r),f.l(r),n=x(),this.h()},h(){M(t,"width","24"),M(t,"height","24"),M(t,"fill",et.critical.background),M(t,"class","svelte-70vzbr"),M(e,"width","24"),M(e,"height","24"),M(e,"xmlns","http://www.w3.org/2000/svg"),z(e,"vertical-align","middle")},m(r,u){b(r,e,u),B(e,t),b(r,l,u),f.m(r,u),b(r,n,u)},p(r,u){o!==(o=s(r))&&(f.d(1),f=o(r),f&&(f.c(),f.m(n.parentNode,n)))},d(r){r&&(m(e),m(l),m(n)),f.d(r)}}}function bl(i){let e;return{c(){e=H("New policy conflict")},l(t){e=K(t,"New policy conflict")},m(t,l){b(t,e,l)},d(t){t&&m(e)}}}function vl(i){let e,t="New policy conflict";return{c(){e=J("b"),e.textContent=t},l(l){e=U(l,"B",{"data-svelte-h":!0}),he(e)!=="svelte-pf83jq"&&(e.textContent=t)},m(l,n){b(l,e,n)},d(l){l&&m(e)}}}function kl(i){let e,t,l,n;function s(r,u){return r[1].mode=="new-conflict"?vl:bl}let o=s(i),f=o(i);return{c(){e=_e("svg"),t=_e("circle"),l=q(),f.c(),n=x(),this.h()},l(r){e=me(r,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var u=O(e);t=me(u,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),O(t).forEach(m),u.forEach(m),l=A(r),f.l(r),n=x(),this.h()},h(){M(t,"cx","12"),M(t,"cy","12"),M(t,"r","12"),M(t,"fill",De),M(e,"width","24"),M(e,"height","24"),M(e,"xmlns","http://www.w3.org/2000/svg"),z(e,"vertical-align","middle")},m(r,u){b(r,e,u),B(e,t),b(r,l,u),f.m(r,u),b(r,n,u)},p(r,u){o!==(o=s(r))&&(f.d(1),f=o(r),f&&(f.c(),f.m(n.parentNode,n)))},d(r){r&&(m(e),m(l),m(n)),f.d(r)}}}function ze(i){let e,t;return e=new St({props:{map:i[0],beforeId:"route-map"}}),{c(){G(e.$$.fragment)},l(l){V(e.$$.fragment,l)},m(l,n){j(e,l,n),t=!0},p(l,n){const s={};n[0]&1&&(s.map=l[0]),e.$set(s)},i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function He(i){let e,t,l;function n(r){i[33](r,i[46])}function s(){return i[34](i[45])}function o(){return i[35](i[45])}let f={draggable:!0,$$slots:{default:[wl]},$$scope:{ctx:i}};return i[46].point!==void 0&&(f.lngLat=i[46].point),e=new Qe({props:f}),Z.push(()=>Q(e,"lngLat",n)),e.$on("click",s),e.$on("dragend",o),{c(){G(e.$$.fragment)},l(r){V(e.$$.fragment,r)},m(r,u){j(e,r,u),l=!0},p(r,u){i=r;const c={};u[0]&8|u[1]&524288&&(c.$$scope={dirty:u,ctx:i}),!t&&u[0]&8&&(t=!0,c.lngLat=i[46].point,X(()=>t=!1)),e.$set(c)},i(r){l||(h(e.$$.fragment,r),l=!0)},o(r){C(e.$$.fragment,r),l=!1},d(r){T(e,r)}}}function wl(i){let e,t,l,n=i[46].criticalIssue+"",s;return{c(){e=_e("svg"),t=_e("rect"),l=_e("text"),s=H(n),this.h()},l(o){e=me(o,"svg",{width:!0,height:!0,xmlns:!0});var f=O(e);t=me(f,"rect",{width:!0,height:!0,fill:!0,class:!0}),O(t).forEach(m),l=me(f,"text",{x:!0,y:!0,"dominant-baseline":!0,"text-anchor":!0});var r=O(l);s=K(r,n),r.forEach(m),f.forEach(m),this.h()},h(){M(t,"width","40"),M(t,"height","40"),M(t,"fill",et.critical.background),M(t,"class","svelte-70vzbr"),M(l,"x","50%"),M(l,"y","50%"),M(l,"dominant-baseline","middle"),M(l,"text-anchor","middle"),z(l,"fill","white"),z(l,"font","bold 15px sans-serif"),M(e,"width","40"),M(e,"height","40"),M(e,"xmlns","http://www.w3.org/2000/svg")},m(o,f){b(o,e,f),B(e,t),B(e,l),B(l,s)},p(o,f){f[0]&8&&n!==(n=o[46].criticalIssue+"")&&ae(s,n)},d(o){o&&m(e)}}}function Ke(i){let e=ye(i[7],i[46].resolved),t,l,n=e&&He(i);return{c(){n&&n.c(),t=x()},l(s){n&&n.l(s),t=x()},m(s,o){n&&n.m(s,o),b(s,t,o),l=!0},p(s,o){o[0]&136&&(e=ye(s[7],s[46].resolved)),e?n?(n.p(s,o),o[0]&136&&h(n,1)):(n=He(s),n.c(),h(n,1),n.m(t.parentNode,t)):n&&(ne(),C(n,1,1,()=>{n=null}),ie())},i(s){l||(h(n),l=!0)},o(s){C(n),l=!1},d(s){s&&m(t),n&&n.d(s)}}}function We(i){let e,t,l;function n(r){i[36](r,i[43])}function s(){return i[37](i[45])}function o(){return i[38](i[45])}let f={draggable:!0,$$slots:{default:[yl]},$$scope:{ctx:i}};return i[43].point!==void 0&&(f.lngLat=i[43].point),e=new Qe({props:f}),Z.push(()=>Q(e,"lngLat",n)),e.$on("click",s),e.$on("dragend",o),{c(){G(e.$$.fragment)},l(r){V(e.$$.fragment,r)},m(r,u){j(e,r,u),l=!0},p(r,u){i=r;const c={};u[0]&8|u[1]&524288&&(c.$$scope={dirty:u,ctx:i}),!t&&u[0]&8&&(t=!0,c.lngLat=i[43].point,X(()=>t=!1)),e.$set(c)},i(r){l||(h(e.$$.fragment,r),l=!0)},o(r){C(e.$$.fragment,r),l=!1},d(r){T(e,r)}}}function yl(i){let e,t=i[43].conflict+"",l;return{c(){e=J("span"),l=H(t),this.h()},l(n){e=U(n,"SPAN",{class:!0});var s=O(e);l=K(s,t),s.forEach(m),this.h()},h(){M(e,"class","dot svelte-70vzbr"),z(e,"background",De)},m(n,s){b(n,e,s),B(e,l)},p(n,s){s[0]&8&&t!==(t=n[43].conflict+"")&&ae(l,t)},d(n){n&&m(e)}}}function Ye(i){let e=ye(i[7],i[43].resolved),t,l,n=e&&We(i);return{c(){n&&n.c(),t=x()},l(s){n&&n.l(s),t=x()},m(s,o){n&&n.m(s,o),b(s,t,o),l=!0},p(s,o){o[0]&136&&(e=ye(s[7],s[43].resolved)),e?n?(n.p(s,o),o[0]&136&&h(n,1)):(n=We(s),n.c(),h(n,1),n.m(t.parentNode,t)):n&&(ne(),C(n,1,1,()=>{n=null}),ie())},i(s){l||(h(n),l=!0)},o(s){C(n),l=!1},d(s){s&&m(t),n&&n.d(s)}}}function Cl(i){let e,t;return e=new At({props:{paint:{"circle-radius":30,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){G(e.$$.fragment)},l(l){V(e.$$.fragment,l)},m(l,n){j(e,l,n),t=!0},p:ht,i(l){t||(h(e.$$.fragment,l),t=!0)},o(l){C(e.$$.fragment,l),t=!1},d(l){T(e,l)}}}function Il(i){let e,t,l,n,s,o,f,r,u,c;e=new Bt({}),e.$on("click",i[13]);let v=i[1].mode!="editing"&&Ue(i);n=new Tt({props:{show:i[6],id:"route-map"}});let L=i[0]&&ze(i),N=se(i[3].criticalIssues),$=[];for(let a=0;a<N.length;a+=1)$[a]=Ke(Ge(i,N,a));const E=a=>C($[a],1,1,()=>{$[a]=null});let k=se(i[3].policyConflictLog),y=[];for(let a=0;a<k.length;a+=1)y[a]=Ye(Re(i,k,a));const D=a=>C(y[a],1,1,()=>{y[a]=null});return u=new Mt({props:{data:i[8],$$slots:{default:[Cl]},$$scope:{ctx:i}}}),{c(){G(e.$$.fragment),t=q(),v&&v.c(),l=q(),G(n.$$.fragment),s=q(),L&&L.c(),o=q();for(let a=0;a<$.length;a+=1)$[a].c();f=q();for(let a=0;a<y.length;a+=1)y[a].c();r=q(),G(u.$$.fragment)},l(a){V(e.$$.fragment,a),t=A(a),v&&v.l(a),l=A(a),V(n.$$.fragment,a),s=A(a),L&&L.l(a),o=A(a);for(let _=0;_<$.length;_+=1)$[_].l(a);f=A(a);for(let _=0;_<y.length;_+=1)y[_].l(a);r=A(a),V(u.$$.fragment,a)},m(a,_){j(e,a,_),b(a,t,_),v&&v.m(a,_),b(a,l,_),j(n,a,_),b(a,s,_),L&&L.m(a,_),b(a,o,_);for(let g=0;g<$.length;g+=1)$[g]&&$[g].m(a,_);b(a,f,_);for(let g=0;g<y.length;g+=1)y[g]&&y[g].m(a,_);b(a,r,_),j(u,a,_),c=!0},p(a,_){a[1].mode!="editing"?v?(v.p(a,_),_[0]&2&&h(v,1)):(v=Ue(a),v.c(),h(v,1),v.m(l.parentNode,l)):v&&(ne(),C(v,1,1,()=>{v=null}),ie());const g={};if(_[0]&64&&(g.show=a[6]),n.$set(g),a[0]?L?(L.p(a,_),_[0]&1&&h(L,1)):(L=ze(a),L.c(),h(L,1),L.m(o.parentNode,o)):L&&(ne(),C(L,1,1,()=>{L=null}),ie()),_[0]&648){N=se(a[3].criticalIssues);let I;for(I=0;I<N.length;I+=1){const W=Ge(a,N,I);$[I]?($[I].p(W,_),h($[I],1)):($[I]=Ke(W),$[I].c(),h($[I],1),$[I].m(f.parentNode,f))}for(ne(),I=N.length;I<$.length;I+=1)E(I);ie()}if(_[0]&648){k=se(a[3].policyConflictLog);let I;for(I=0;I<k.length;I+=1){const W=Re(a,k,I);y[I]?(y[I].p(W,_),h(y[I],1)):(y[I]=Ye(W),y[I].c(),h(y[I],1),y[I].m(r.parentNode,r))}for(ne(),I=k.length;I<y.length;I+=1)D(I);ie()}const w={};_[0]&256&&(w.data=a[8]),_[1]&524288&&(w.$$scope={dirty:_,ctx:a}),u.$set(w)},i(a){if(!c){h(e.$$.fragment,a),h(v),h(n.$$.fragment,a),h(L);for(let _=0;_<N.length;_+=1)h($[_]);for(let _=0;_<k.length;_+=1)h(y[_]);h(u.$$.fragment,a),c=!0}},o(a){C(e.$$.fragment,a),C(v),C(n.$$.fragment,a),C(L),$=$.filter(Boolean);for(let _=0;_<$.length;_+=1)C($[_]);y=y.filter(Boolean);for(let _=0;_<y.length;_+=1)C(y[_]);C(u.$$.fragment,a),c=!1},d(a){a&&(m(t),m(l),m(s),m(o),m(f),m(r)),T(e,a),v&&v.d(a),T(n,a),L&&L.d(a),ve($,a),ve(y,a),T(u,a)}}}function Ll(i){let e,t,l,n,s,o,f,r,u,c,v;const L=[Yt,Wt],N=[];function $(y,D){return y[1].mode!="editing"?0:1}l=$(i),n=N[l]=L[l](i);function E(y){i[39](y)}let k={$$slots:{default:[Il]},$$scope:{ctx:i}};return i[0]!==void 0&&(k.map=i[0]),f=new Pt({props:k}),Z.push(()=>Q(f,"map",E)),{c(){e=J("div"),t=J("div"),n.c(),s=q(),o=J("div"),G(f.$$.fragment),this.h()},l(y){e=U(y,"DIV",{style:!0});var D=O(e);t=U(D,"DIV",{style:!0});var a=O(t);n.l(a),a.forEach(m),s=A(D),o=U(D,"DIV",{style:!0});var _=O(o);V(f.$$.fragment,_),_.forEach(m),D.forEach(m),this.h()},h(){z(t,"width","30%"),z(t,"overflow-y","scroll"),z(t,"padding","10px"),z(t,"border","1px solid black"),z(o,"position","relative"),z(o,"width","70%"),z(e,"display","flex"),z(e,"height","80vh")},m(y,D){b(y,e,D),B(e,t),N[l].m(t,null),i[30](t),B(e,s),B(e,o),j(f,o,null),u=!0,c||(v=gt(Kt,"keydown",i[19]),c=!0)},p(y,D){let a=l;l=$(y),l===a?N[l].p(y,D):(ne(),C(N[a],1,1,()=>{N[a]=null}),ie(),n=N[l],n?n.p(y,D):(n=N[l]=L[l](y),n.c()),h(n,1),n.m(t,null));const _={};D[0]&459|D[1]&524288&&(_.$$scope={dirty:D,ctx:y}),!r&&D[0]&1&&(r=!0,_.map=y[0],X(()=>r=!1)),f.$set(_)},i(y){u||(h(n),h(f.$$.fragment,y),u=!0)},o(y){C(n),C(f.$$.fragment,y),u=!1},d(y){y&&m(e),N[l].d(),i[30](null),T(f),c=!1,v()}}}function Nl(i,e,t){let l={type:"FeatureCollection",features:[]},n=e.mode=="editing"?e.id:t;if(n!=null){let s=n.kind=="critical"?i.criticalIssues:i.policyConflictLog;l.features.push(de(s[n.idx]))}return l}function de(i){const e=i.point;let t=JSON.parse(JSON.stringify(i));return delete t.point,{type:"Feature",properties:t,geometry:{type:"Point",coordinates:e}}}function ye(i,e){return i||e!="Yes"}function Sl(i,e,t){let l,n,s;be(i,Y,d=>t(3,n=d)),be(i,vt,d=>t(41,s=d));let o,f,r={mode:"select"},u=s.url.searchParams.get("kind")||"";u=="critical"?r={mode:"new-critical"}:u=="conflict"&&(r={mode:"new-conflict"});let c=null,v=null,L=!1,N=!0,$=!0;async function E(d){c=f.scrollTop,t(1,r={mode:"editing",id:d}),t(2,v=null),await Ce(),t(4,f.scrollTop=0,f)}async function k(d){c=f.scrollTop,t(1,r={mode:"editing",id:d}),t(2,v=null),await Ce(),t(4,f.scrollTop=0,f);let F=d.kind=="critical"?n.criticalIssues:n.policyConflictLog;o==null||o.flyTo({center:F[d.idx].point,duration:500})}async function y(){if(r.mode!="editing"||!o)return;let d=r.id,F=d.kind=="critical"?n.criticalIssues:n.policyConflictLog,oe=JSON.parse(JSON.stringify(F[d.idx])),mt=o.getBounds().getWest(),$t=o.getBounds().getEast();oe.point[0]+=($t-mt)*.05;let Pe=F.toSpliced(d.idx+1,0,oe);d.kind=="critical"?re(Y,n.criticalIssues=Pe,n):re(Y,n.policyConflictLog=Pe,n),await E({kind:d.kind,idx:d.idx+1})}async function D(){t(1,r={mode:"select"}),re(Y,n.policyConflictLog=n.policyConflictLog.toSorted((d,F)=>Be(d.conflict)-Be(F.conflict)),n),re(Y,n.criticalIssues=n.criticalIssues.toSorted((d,F)=>Me(d.criticalIssue)-Me(F.criticalIssue)),n),c!=null&&(await Ce(),t(4,f.scrollTop=c,f),c=null)}function a(d){if(!L&&r.mode!="select"){if(r.mode=="editing"){D();return}r.mode=="new-critical"?(re(Y,n.criticalIssues=[...n.criticalIssues,{criticalIssue:s.url.searchParams.get("code")||"",stage:"",point:d.detail.lngLat.toArray(),locationName:"",resolved:"",notes:""}],n),E({kind:"critical",idx:n.criticalIssues.length-1})):r.mode=="new-conflict"&&(re(Y,n.policyConflictLog=[...n.policyConflictLog,{conflict:s.url.searchParams.get("code")||"",stage:"",point:d.detail.lngLat.toArray(),locationName:"",resolved:"",notes:""}],n),E({kind:"conflict",idx:n.policyConflictLog.length-1}))}}function _(){r.mode=="editing"&&window.confirm("Delete this entry?")&&(r.id.kind=="critical"?(n.criticalIssues.splice(r.id.idx,1),Y.set(n)):(n.policyConflictLog.splice(r.id.idx,1),Y.set(n)),D())}function g(d){if(!o)return;let F={type:"FeatureCollection",features:[...n.criticalIssues.map(oe=>de(oe)),...n.policyConflictLog.map(oe=>de(oe)),...n.summary.networkMap.features]};F.features.length>0&&o.fitBounds(qt(F),{padding:20,animate:d})}function w(){if(!o)return;let d={type:"FeatureCollection",features:[...n.criticalIssues.map(F=>de(F)),...n.policyConflictLog.map(F=>de(F)),...n.summary.networkMap.features]};Dt(`problems-map-${n.summary.schemeName}.geojson`,JSON.stringify(d))}function I(d){let F=d.criticalIssue?Vt(d.criticalIssue):"Unknown critical";return d.locationName?`${F} (${d.locationName})`:F}function W(d){let F=d.conflict?"PO0"+jt(d.conflict):"Unknown conflict";return d.locationName?`${F} (${d.locationName})`:F}function R(d){if(r.mode=="editing"){let F=d.target.tagName,oe=F=="INPUT"||F=="TEXTAREA";d.key=="Escape"||d.key=="Enter"&&!oe?(d.stopPropagation(),D()):d.key=="Delete"&&!oe&&(d.stopPropagation(),_())}else(r.mode=="new-critical"||r.mode=="new-conflict")&&d.key=="Escape"&&(d.stopPropagation(),t(1,r={mode:"select"}))}const ee=()=>g(!0);function $e(d){L=d,t(5,L)}function fe(d){N=d,t(6,N)}function P(d){$=d,t(7,$)}const ge=d=>k({kind:"critical",idx:d}),ce=d=>t(2,v={kind:"critical",idx:d}),p=()=>t(2,v=null),S=d=>k({kind:"conflict",idx:d}),te=d=>t(2,v={kind:"conflict",idx:d}),le=()=>t(2,v=null);function ue(d){Z[d?"unshift":"push"](()=>{f=d,t(4,f)})}const pe=()=>t(1,r={mode:"new-critical"}),rt=()=>t(1,r={mode:"new-conflict"});function st(d,F){i.$$.not_equal(F.point,d)&&(F.point=d,Y.set(n))}const at=d=>E({kind:"critical",idx:d}),ft=d=>E({kind:"critical",idx:d});function ct(d,F){i.$$.not_equal(F.point,d)&&(F.point=d,Y.set(n))}const ut=d=>E({kind:"conflict",idx:d}),pt=d=>E({kind:"conflict",idx:d});function _t(d){o=d,t(0,o)}return i.$$.update=()=>{i.$$.dirty[0]&1&&o&&g(!1),i.$$.dirty[0]&3&&o&&(o.getCanvas().style.cursor=r.mode=="new-critical"||r.mode=="new-conflict"?"crosshair":"auto"),i.$$.dirty[0]&14&&t(8,l=Nl(n,r,v))},[o,r,v,n,f,L,N,$,l,E,k,y,D,a,_,g,w,I,W,R,ee,$e,fe,P,ge,ce,p,S,te,le,ue,pe,rt,st,at,ft,ct,ut,pt,_t]}class ln extends Se{constructor(e){super(),Ee(this,e,Sl,Ll,Ne,{},null,[-1,-1])}}export{ln as component};
