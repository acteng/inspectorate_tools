import{s as be,r as ie,w as fe,l as jt,u as Ct,m as Tt,o as Mt,E as Ce,k as Be,Q as Pt,V as Me,a as O,g as P,i as k,f as g,B as ve,X as Dt,e as G,c as J,b as K,q as re,h as A,J as ce,Y as Lt,v as ee,L as Oe,t as R,M as Pe,d as z,n as Ie,p as Le,j as ae,z as Ut,$ as Xe}from"../chunks/scheduler.Bxdx0f0B.js";import{S as ye,i as je,e as ue,c as D,a as U,m as q,t as y,b as C,d as F,g as _e,f as ge}from"../chunks/index.itOPPQ0R.js";import{e as de}from"../chunks/each.BdQ2bsat.js";import{B as qt}from"../chunks/ButtonGroup.CFC5gCUN.js";import{D as He,C as Ft}from"../chunks/DefaultButton.j5-p4xk5.js";import{p as qe,j as We}from"../chunks/index.D0b_TaAp.js";import{S as ke}from"../chunks/SecondaryButton.C3WEK5d3.js";import{T as Ze}from"../chunks/TextInput.Dl411CD5.js";import{W as Ge}from"../chunks/WarningButton.DE8BQTXW.js";import{s as oe}from"../chunks/data.DcHwrt9P.js";import{g as Rt}from"../chunks/globals.D0QH3NT1.js";import{a as zt,c as Ht,j as we,v as Zt,w as Et,x as Fe,M as Gt,b as Jt,G as Ke,L as Re,h as Qe,C as Vt,y as Xt}from"../chunks/index.vkVG34n2.js";import{g as ze,t as Wt}from"../chunks/index.B4THrvq7.js";import{c as he}from"../chunks/colors.DaC397qr.js";import{G as Kt,I as De,p as Qt}from"../chunks/pan.DzeBvkQ4.js";import{M as Yt,G as xt,S as en,C as Je}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.C3PU5y-M.js";import{M as Ne,B as tn,C as nn}from"../chunks/Marker.NoQXZYOu.js";import"../chunks/paths.DsJDkbz9.js";import"../chunks/entry.DPojm7ur.js";import{R as on}from"../chunks/RouteMapLayer.CgXJv9hE.js";import{P as St}from"../chunks/Popup.CgRC6A04.js";import{T as It}from"../chunks/TextArea.6NUOtg5S.js";import{R as Ae}from"../chunks/Radio.CEE00jE4.js";import{M as ln}from"../chunks/Modal.B7Jfey3u.js";function rn(o){let e;const n=o[16].default,t=jt(n,o,o[24],null);return{c(){t&&t.c()},l(l){t&&t.l(l)},m(l,i){t&&t.m(l,i),e=!0},p(l,i){t&&t.p&&(!e||i&16777216)&&Ct(t,n,l,l[24],e?Mt(n,l[24],i,null):Tt(l[24]),null)},i(l){e||(y(t,l),e=!0)},o(l){C(t,l),e=!1},d(l){t&&t.d(l)}}}function an(o){let e,n,t;function l(r){o[17](r)}let i={id:o[1],type:"symbol",source:o[2],sourceLayer:o[3],beforeId:o[4],beforeLayerType:o[5],paint:o[6],layout:o[7],filter:o[8],applyToClusters:o[9],minzoom:o[10],maxzoom:o[11],hoverCursor:o[12],manageHoverState:o[13],eventsIfTopMost:o[14],interactive:o[15],$$slots:{default:[rn]},$$scope:{ctx:o}};return o[0]!==void 0&&(i.hovered=o[0]),e=new zt({props:i}),ie.push(()=>ue(e,"hovered",l)),e.$on("click",o[18]),e.$on("dblclick",o[19]),e.$on("contextmenu",o[20]),e.$on("mouseenter",o[21]),e.$on("mousemove",o[22]),e.$on("mouseleave",o[23]),{c(){D(e.$$.fragment)},l(r){U(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,[a]){const s={};a&2&&(s.id=r[1]),a&4&&(s.source=r[2]),a&8&&(s.sourceLayer=r[3]),a&16&&(s.beforeId=r[4]),a&32&&(s.beforeLayerType=r[5]),a&64&&(s.paint=r[6]),a&128&&(s.layout=r[7]),a&256&&(s.filter=r[8]),a&512&&(s.applyToClusters=r[9]),a&1024&&(s.minzoom=r[10]),a&2048&&(s.maxzoom=r[11]),a&4096&&(s.hoverCursor=r[12]),a&8192&&(s.manageHoverState=r[13]),a&16384&&(s.eventsIfTopMost=r[14]),a&32768&&(s.interactive=r[15]),a&16777216&&(s.$$scope={dirty:a,ctx:r}),!n&&a&1&&(n=!0,s.hovered=r[0],fe(()=>n=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function sn(o,e,n){let{$$slots:t={},$$scope:l}=e,{id:i=Ht("symbol")}=e,{source:r=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:c=void 0}=e,{layout:d=void 0}=e,{filter:m=void 0}=e,{applyToClusters:j=void 0}=e,{minzoom:L=void 0}=e,{maxzoom:N=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:S=!1}=e,{hovered:v=null}=e,{eventsIfTopMost:b=!1}=e,{interactive:B=!0}=e;function _(h){v=h,n(0,v)}function $(h){Ce.call(this,o,h)}function p(h){Ce.call(this,o,h)}function V(h){Ce.call(this,o,h)}function X(h){Ce.call(this,o,h)}function T(h){Ce.call(this,o,h)}function E(h){Ce.call(this,o,h)}return o.$$set=h=>{"id"in h&&n(1,i=h.id),"source"in h&&n(2,r=h.source),"sourceLayer"in h&&n(3,a=h.sourceLayer),"beforeId"in h&&n(4,s=h.beforeId),"beforeLayerType"in h&&n(5,f=h.beforeLayerType),"paint"in h&&n(6,c=h.paint),"layout"in h&&n(7,d=h.layout),"filter"in h&&n(8,m=h.filter),"applyToClusters"in h&&n(9,j=h.applyToClusters),"minzoom"in h&&n(10,L=h.minzoom),"maxzoom"in h&&n(11,N=h.maxzoom),"hoverCursor"in h&&n(12,M=h.hoverCursor),"manageHoverState"in h&&n(13,S=h.manageHoverState),"hovered"in h&&n(0,v=h.hovered),"eventsIfTopMost"in h&&n(14,b=h.eventsIfTopMost),"interactive"in h&&n(15,B=h.interactive),"$$scope"in h&&n(24,l=h.$$scope)},[v,i,r,a,s,f,c,d,m,j,L,N,M,S,b,B,t,_,$,p,V,X,T,E,l]}class fn extends ye{constructor(e){super(),je(this,e,sn,an,be,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var un=Object.defineProperty,cn=(o,e)=>un(o,"name",{value:e,configurable:!0});function Nt(o,e,n,t={}){const l=ze(o),i=we(l[0]),r=we(l[1]),a=we(n),s=Zt(e,t.units),f=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(a)),c=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(f)),d=Fe(c),m=Fe(f);return Et([d,m],t.properties)}cn(Nt,"destination");var Se=Nt,mn=Object.defineProperty,At=(o,e)=>mn(o,"name",{value:e,configurable:!0});function Ve(o,e,n={}){if(n.final===!0)return Bt(o,e);const t=ze(o),l=ze(e),i=we(t[0]),r=we(l[0]),a=we(t[1]),s=we(l[1]),f=Math.sin(r-i)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(r-i);return Fe(Math.atan2(f,c))}At(Ve,"bearing");function Bt(o,e){let n=Ve(e,o);return n=(n+180)%360,n}At(Bt,"calculateFinalBearing");var Te=Ve;const dn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ye(o,e,n){const t=o.slice();return t[36]=e[n],t[37]=e,t[38]=n,t}function xe(o,e,n){const t=o.slice();return t[39]=e[n],t[40]=e,t[38]=n,t}function et(o){let e,n,t,l,i,r,a;return n=new De({props:{$$slots:{default:[pn]},$$scope:{ctx:o}}}),n.$on("click",function(){Dt(o[5])&&o[5].apply(this,arguments)}),l=new De({props:{$$slots:{default:[vn]},$$scope:{ctx:o}}}),l.$on("click",o[17]),r=new De({props:{$$slots:{default:[wn]},$$scope:{ctx:o}}}),r.$on("click",o[18]),{c(){e=G("div"),D(n.$$.fragment),t=O(),D(l.$$.fragment),i=O(),D(r.$$.fragment),this.h()},l(s){e=J(s,"DIV",{class:!0});var f=K(e);U(n.$$.fragment,f),t=P(f),U(l.$$.fragment,f),i=P(f),U(r.$$.fragment,f),f.forEach(g),this.h()},h(){re(e,"class","control-panel svelte-1w3m76d")},m(s,f){k(s,e,f),q(n,e,null),A(e,t),q(l,e,null),A(e,i),q(r,e,null),a=!0},p(s,f){o=s;const c={};f[0]&1|f[1]&1024&&(c.$$scope={dirty:f,ctx:o}),n.$set(c);const d={};f[0]&1|f[1]&1024&&(d.$$scope={dirty:f,ctx:o}),l.$set(d);const m={};f[0]&1|f[1]&1024&&(m.$$scope={dirty:f,ctx:o}),r.$set(m)},i(s){a||(y(n.$$.fragment,s),y(l.$$.fragment,s),y(r.$$.fragment,s),a=!0)},o(s){C(n.$$.fragment,s),C(l.$$.fragment,s),C(r.$$.fragment,s),a=!1},d(s){s&&g(e),F(n),F(l),F(r)}}}function _n(o){let e;return{c(){e=R("Move map")},l(n){e=z(n,"Move map")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function gn(o){let e,n="Move map";return{c(){e=G("u"),e.textContent=n},l(t){e=J(t,"U",{"data-svelte-h":!0}),Le(e)!=="svelte-1719ytd"&&(e.textContent=n)},m(t,l){k(t,e,l)},d(t){t&&g(e)}}}function pn(o){let e,n,t,l;function i(s,f){return s[0].mode=="select"?gn:_n}let r=i(o),a=r(o);return{c(){e=G("img"),t=O(),a.c(),l=ce(),this.h()},l(s){e=J(s,"IMG",{src:!0,alt:!0,style:!0}),t=P(s),a.l(s),l=ce(),this.h()},h(){Lt(e.src,n=Qt)||re(e,"src",n),re(e,"alt","Move map"),ee(e,"vertical-align","middle")},m(s,f){k(s,e,f),k(s,t,f),a.m(s,f),k(s,l,f)},p(s,f){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(l.parentNode,l)))},d(s){s&&(g(e),g(t),g(l)),a.d(s)}}}function $n(o){let e;return{c(){e=R("New arm")},l(n){e=z(n,"New arm")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function hn(o){let e,n="New arm";return{c(){e=G("u"),e.textContent=n},l(t){e=J(t,"U",{"data-svelte-h":!0}),Le(e)!=="svelte-1typ7gq"&&(e.textContent=n)},m(t,l){k(t,e,l)},d(t){t&&g(e)}}}function vn(o){let e,n,t,l,i,r;function a(c,d){return c[0].mode=="new-arm"?hn:$n}let s=a(o),f=s(o);return{c(){e=Oe("svg"),n=Oe("circle"),t=Oe("text"),l=R("A"),i=O(),f.c(),r=ce(),this.h()},l(c){e=Pe(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var d=K(e);n=Pe(d,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),K(n).forEach(g),t=Pe(d,"text",{x:!0,y:!0,fill:!0});var m=K(t);l=z(m,"A"),m.forEach(g),d.forEach(g),i=P(c),f.l(c),r=ce(),this.h()},h(){re(n,"cx","12"),re(n,"cy","12"),re(n,"r","12"),re(n,"fill","white"),re(t,"x","6"),re(t,"y","16"),re(t,"fill","#4472c4"),re(e,"width","24"),re(e,"height","24"),re(e,"xmlns","http://www.w3.org/2000/svg"),ee(e,"vertical-align","middle")},m(c,d){k(c,e,d),A(e,n),A(e,t),A(t,l),k(c,i,d),f.m(c,d),k(c,r,d)},p(c,d){s!==(s=a(c))&&(f.d(1),f=s(c),f&&(f.c(),f.m(r.parentNode,r)))},d(c){c&&(g(e),g(i),g(r)),f.d(c)}}}function bn(o){let e;return{c(){e=R("New movement")},l(n){e=z(n,"New movement")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function kn(o){let e,n="New movement";return{c(){e=G("u"),e.textContent=n},l(t){e=J(t,"U",{"data-svelte-h":!0}),Le(e)!=="svelte-o92ucp"&&(e.textContent=n)},m(t,l){k(t,e,l)},d(t){t&&g(e)}}}function wn(o){let e,n,t,l;function i(s,f){return s[0].mode=="new-movement"?kn:bn}let r=i(o),a=r(o);return{c(){e=G("img"),t=O(),a.c(),l=ce(),this.h()},l(s){e=J(s,"IMG",{src:!0,alt:!0,style:!0}),t=P(s),a.l(s),l=ce(),this.h()},h(){Lt(e.src,n=dn)||re(e,"src",n),re(e,"alt","New movement"),ee(e,"vertical-align","middle")},m(s,f){k(s,e,f),k(s,t,f),a.m(s,f),k(s,l,f)},p(s,f){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(l.parentNode,l)))},d(s){s&&(g(e),g(t),g(l)),a.d(s)}}}function yn(o){let e,n=On(o[38])+"",t;return{c(){e=G("span"),t=R(n),this.h()},l(l){e=J(l,"SPAN",{class:!0});var i=K(e);t=z(i,n),i.forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"color","#4472c4"),ee(e,"background-color","white")},m(l,i){k(l,e,i),A(e,t)},p:Ie,d(l){l&&g(e)}}}function tt(o){let e,n,t;function l(s){o[19](s,o[39])}function i(){return o[20](o[38])}function r(){return o[21](o[38])}let a={draggable:!0,$$slots:{default:[yn]},$$scope:{ctx:o}};return o[39].point!==void 0&&(a.lngLat=o[39].point),e=new Ne({props:a}),ie.push(()=>ue(e,"lngLat",l)),e.$on("dragend",i),e.$on("click",r),{c(){D(e.$$.fragment)},l(s){U(e.$$.fragment,s)},m(s,f){q(e,s,f),t=!0},p(s,f){o=s;const c={};f[1]&1024&&(c.$$scope={dirty:f,ctx:o}),!n&&f[0]&70&&(n=!0,c.lngLat=o[39].point,fe(()=>n=!1)),e.$set(c)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){C(e.$$.fragment,s),t=!1},d(s){F(e,s)}}}function jn(o){let e;return{c(){e=G("span"),this.h()},l(n){e=J(n,"SPAN",{class:!0}),K(e).forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"background-color",o[9][o[36].score]),ee(e,"opacity",o[36].kind=="walking & wheeling"?"0%":"100%")},m(n,t){k(n,e,t)},p(n,t){t[0]&70&&ee(e,"background-color",n[9][n[36].score]),t[0]&70&&ee(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},d(n){n&&g(e)}}}function Cn(o){let e;return{c(){e=G("span"),this.h()},l(n){e=J(n,"SPAN",{class:!0}),K(e).forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"background-color",o[9][o[36].score])},m(n,t){k(n,e,t)},p(n,t){t[0]&70&&ee(e,"background-color",n[9][n[36].score])},d(n){n&&g(e)}}}function Tn(o){let e;return{c(){e=G("span"),this.h()},l(n){e=J(n,"SPAN",{class:!0}),K(e).forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"background-color",o[9][o[36].score]),ee(e,"opacity","0%")},m(n,t){k(n,e,t)},p(n,t){t[0]&70&&ee(e,"background-color",n[9][n[36].score])},d(n){n&&g(e)}}}function nt(o){let e,n,t,l,i,r,a,s,f;function c($){o[22]($,o[36])}function d(){return o[23](o[38])}function m(){return o[24](o[38])}let j={draggable:!0,$$slots:{default:[jn]},$$scope:{ctx:o}};o[36].point1!==void 0&&(j.lngLat=o[36].point1),e=new Ne({props:j}),ie.push(()=>ue(e,"lngLat",c)),e.$on("dragend",d),e.$on("click",m);function L($){o[25]($,o[36])}function N(){return o[26](o[38])}function M(){return o[27](o[38])}let S={draggable:!0,$$slots:{default:[Cn]},$$scope:{ctx:o}};o[36].point2!==void 0&&(S.lngLat=o[36].point2),l=new Ne({props:S}),ie.push(()=>ue(l,"lngLat",L)),l.$on("dragend",N),l.$on("click",M);function v($){o[28]($,o[36])}function b(){return o[29](o[38])}function B(){return o[30](o[38])}let _={draggable:!0,$$slots:{default:[Tn]},$$scope:{ctx:o}};return o[36].point3!==void 0&&(_.lngLat=o[36].point3),a=new Ne({props:_}),ie.push(()=>ue(a,"lngLat",v)),a.$on("dragend",b),a.$on("click",B),{c(){D(e.$$.fragment),t=O(),D(l.$$.fragment),r=O(),D(a.$$.fragment)},l($){U(e.$$.fragment,$),t=P($),U(l.$$.fragment,$),r=P($),U(a.$$.fragment,$)},m($,p){q(e,$,p),k($,t,p),q(l,$,p),k($,r,p),q(a,$,p),f=!0},p($,p){o=$;const V={};p[0]&70|p[1]&1024&&(V.$$scope={dirty:p,ctx:o}),!n&&p[0]&70&&(n=!0,V.lngLat=o[36].point1,fe(()=>n=!1)),e.$set(V);const X={};p[0]&70|p[1]&1024&&(X.$$scope={dirty:p,ctx:o}),!i&&p[0]&70&&(i=!0,X.lngLat=o[36].point2,fe(()=>i=!1)),l.$set(X);const T={};p[0]&70|p[1]&1024&&(T.$$scope={dirty:p,ctx:o}),!s&&p[0]&70&&(s=!0,T.lngLat=o[36].point3,fe(()=>s=!1)),a.$set(T)},i($){f||(y(e.$$.fragment,$),y(l.$$.fragment,$),y(a.$$.fragment,$),f=!0)},o($){C(e.$$.fragment,$),C(l.$$.fragment,$),C(a.$$.fragment,$),f=!1},d($){$&&(g(t),g(r)),F(e,$),F(l,$),F(a,$)}}}function Mn(o){let e=(o[35].name||"Untitled movement")+"",n;return{c(){n=R(e)},l(t){n=z(t,e)},m(t,l){k(t,n,l)},p(t,l){l[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ae(n,e)},d(t){t&&g(n)}}}function Ln(o){let e,n;return e=new St({props:{$$slots:{default:[Mn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l[1]&1040&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function En(o){let e=(o[35].name||"Untitled movement")+"",n;return{c(){n=R(e)},l(t){n=z(t,e)},m(t,l){k(t,n,l)},p(t,l){l[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&ae(n,e)},d(t){t&&g(n)}}}function Sn(o){let e,n;return e=new St({props:{$$slots:{default:[En,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l[1]&1040&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function In(o){let e,n,t,l,i,r;return e=new Re({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Qe(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Ln]},$$scope:{ctx:o}}}),e.$on("click",o[11]),t=new Re({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Qe(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[Sn]},$$scope:{ctx:o}}}),t.$on("click",o[11]),i=new fn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){D(e.$$.fragment),n=O(),D(t.$$.fragment),l=O(),D(i.$$.fragment)},l(a){U(e.$$.fragment,a),n=P(a),U(t.$$.fragment,a),l=P(a),U(i.$$.fragment,a)},m(a,s){q(e,a,s),k(a,n,s),q(t,a,s),k(a,l,s),q(i,a,s),r=!0},p(a,s){const f={};s[1]&1024&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){r||(y(e.$$.fragment,a),y(t.$$.fragment,a),y(i.$$.fragment,a),r=!0)},o(a){C(e.$$.fragment,a),C(t.$$.fragment,a),C(i.$$.fragment,a),r=!1},d(a){a&&(g(n),g(l)),F(e,a),F(t,a),F(i,a)}}}function Nn(o){let e,n,t,l;return e=new Re({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Vt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){D(e.$$.fragment),n=O(),D(t.$$.fragment)},l(i){U(e.$$.fragment,i),n=P(i),U(t.$$.fragment,i)},m(i,r){q(e,i,r),k(i,n,r),q(t,i,r),l=!0},p:Ie,i(i){l||(y(e.$$.fragment,i),y(t.$$.fragment,i),l=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),l=!1},d(i){i&&g(n),F(e,i),F(t,i)}}}function An(o){let e,n,t,l,i,r,a,s,f,c,d,m,j;e=new Yt({}),e.$on("click",o[10]);let L=o[0].mode!="editing"&&et(o);l=new on({props:{show:o[3]}});let N=de(o[6].jat[o[1]][o[2]].arms),M=[];for(let _=0;_<N.length;_+=1)M[_]=tt(xe(o,N,_));const S=_=>C(M[_],1,1,()=>{M[_]=null});let v=de(o[6].jat[o[1]][o[2]].movements),b=[];for(let _=0;_<v.length;_+=1)b[_]=nt(Ye(o,v,_));const B=_=>C(b[_],1,1,()=>{b[_]=null});return s=new Ke({props:{data:o[12](o[6]),$$slots:{default:[In]},$$scope:{ctx:o}}}),c=new Ke({props:{data:o[8],$$slots:{default:[Nn]},$$scope:{ctx:o}}}),m=new Kt({props:{map:o[7]}}),{c(){D(e.$$.fragment),n=O(),L&&L.c(),t=O(),D(l.$$.fragment),i=O();for(let _=0;_<M.length;_+=1)M[_].c();r=O();for(let _=0;_<b.length;_+=1)b[_].c();a=O(),D(s.$$.fragment),f=O(),D(c.$$.fragment),d=O(),D(m.$$.fragment)},l(_){U(e.$$.fragment,_),n=P(_),L&&L.l(_),t=P(_),U(l.$$.fragment,_),i=P(_);for(let $=0;$<M.length;$+=1)M[$].l(_);r=P(_);for(let $=0;$<b.length;$+=1)b[$].l(_);a=P(_),U(s.$$.fragment,_),f=P(_),U(c.$$.fragment,_),d=P(_),U(m.$$.fragment,_)},m(_,$){q(e,_,$),k(_,n,$),L&&L.m(_,$),k(_,t,$),q(l,_,$),k(_,i,$);for(let p=0;p<M.length;p+=1)M[p]&&M[p].m(_,$);k(_,r,$);for(let p=0;p<b.length;p+=1)b[p]&&b[p].m(_,$);k(_,a,$),q(s,_,$),k(_,f,$),q(c,_,$),k(_,d,$),q(m,_,$),j=!0},p(_,$){_[0].mode!="editing"?L?(L.p(_,$),$[0]&1&&y(L,1)):(L=et(_),L.c(),y(L,1),L.m(t.parentNode,t)):L&&(_e(),C(L,1,1,()=>{L=null}),ge());const p={};if($[0]&8&&(p.show=_[3]),l.$set(p),$[0]&86){N=de(_[6].jat[_[1]][_[2]].arms);let E;for(E=0;E<N.length;E+=1){const h=xe(_,N,E);M[E]?(M[E].p(h,$),y(M[E],1)):(M[E]=tt(h),M[E].c(),y(M[E],1),M[E].m(r.parentNode,r))}for(_e(),E=N.length;E<M.length;E+=1)S(E);ge()}if($[0]&598){v=de(_[6].jat[_[1]][_[2]].movements);let E;for(E=0;E<v.length;E+=1){const h=Ye(_,v,E);b[E]?(b[E].p(h,$),y(b[E],1)):(b[E]=nt(h),b[E].c(),y(b[E],1),b[E].m(a.parentNode,a))}for(_e(),E=v.length;E<b.length;E+=1)B(E);ge()}const V={};$[0]&64&&(V.data=_[12](_[6])),$[1]&1024&&(V.$$scope={dirty:$,ctx:_}),s.$set(V);const X={};$[0]&256&&(X.data=_[8]),$[1]&1024&&(X.$$scope={dirty:$,ctx:_}),c.$set(X);const T={};$[0]&128&&(T.map=_[7]),m.$set(T)},i(_){if(!j){y(e.$$.fragment,_),y(L),y(l.$$.fragment,_);for(let $=0;$<N.length;$+=1)y(M[$]);for(let $=0;$<v.length;$+=1)y(b[$]);y(s.$$.fragment,_),y(c.$$.fragment,_),y(m.$$.fragment,_),j=!0}},o(_){C(e.$$.fragment,_),C(L),C(l.$$.fragment,_),M=M.filter(Boolean);for(let $=0;$<M.length;$+=1)C(M[$]);b=b.filter(Boolean);for(let $=0;$<b.length;$+=1)C(b[$]);C(s.$$.fragment,_),C(c.$$.fragment,_),C(m.$$.fragment,_),j=!1},d(_){_&&(g(n),g(t),g(i),g(r),g(a),g(f),g(d)),F(e,_),L&&L.d(_),F(l,_),ve(M,_),ve(b,_),F(s,_),F(c,_),F(m,_)}}}function Bn(o){let e,n,t;function l(r){o[31](r)}let i={$$slots:{default:[An]},$$scope:{ctx:o}};return o[7]!==void 0&&(i.map=o[7]),e=new Gt({props:i}),ie.push(()=>ue(e,"map",l)),{c(){D(e.$$.fragment)},l(r){U(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const s={};a[0]&511|a[1]&1024&&(s.$$scope={dirty:a,ctx:r}),!n&&a[0]&128&&(n=!0,s.map=r[7],fe(()=>n=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function ot(o,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:o.point}}}function On(o){return String.fromCharCode(o+65)}function Pn(o,e,n){let t,l;Be(o,oe,u=>n(6,l=u));let{junctionIdx:i}=e,{stage:r}=e,{mode:a}=e,{hoveringSidebar:s}=e,{streetviewOn:f}=e,{showRoute:c}=e,{select:d}=e,{stopEditing:m}=e,j,L={0:he.red.background,1:he.amber.background,2:he.green.background,X:he.critical.background};function N(u,w,te){let se={type:"FeatureCollection",features:[]},Y=w.mode=="editing"?w.id:te;return Y!=null&&(Y.kind=="arm"?se.features.push(ot(u.jat[i][r].arms[Y.idx],Y.idx)):se.features.push(b(u.jat[i][r].movements[Y.idx],Y.idx))),se}async function M(u){if(!f){for(let w of j.queryRenderedFeatures(u.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await m();return}a.mode=="new-arm"?(Me(oe,l.jat[i][r].arms=[...l.jat[i][r].arms,{point:u.detail.lngLat.toArray(),name:""}],l),await d({kind:"arm",idx:l.jat[i][r].arms.length-1})):(Me(oe,l.jat[i][r].movements=[...l.jat[i][r].movements,{point1:u.detail.lngLat.toArray(),point2:Se(u.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Se(u.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],l),await d({kind:"movement",idx:l.jat[i][r].movements.length-1}))}}}async function S(u){await d({kind:"movement",idx:u.detail.features[0].id})}Pt(()=>{_(!1)});function v(u){let w={type:"FeatureCollection",features:u.jat[i][r].movements.map((te,se)=>b(te,se))};for(let te of u.jat[i][r].movements)if(w.features.push(B(te,w.features.length)),te.kind=="walking & wheeling"){let se={...te,point1:te.point3,point3:te.point1};w.features.push(B(se,w.features.length))}return w}function b(u,w){return{type:"Feature",id:w,properties:{name:u.name,kind:u.kind,color:L[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2,u.point3]}}}function B(u,w){return{type:"Feature",id:w,properties:{kind:u.kind,color:L[u.score],angle:Te(u.point2,u.point3)},geometry:{type:"Point",coordinates:u.point3}}}function _(u){let w=v(l);for(let te of l.jat[i][r].arms)w.features.push(ot(te,w.features.length));for(let te of l.summary.networkMap.features)w.features.push(te);w.features.length>0&&j.fitBounds(Jt(w),{padding:20,animate:u})}function $(){return j}const p=()=>n(0,a={mode:"new-arm"}),V=()=>n(0,a={mode:"new-movement"});function X(u,w){o.$$.not_equal(w.point,u)&&(w.point=u,oe.set(l))}const T=u=>d({kind:"arm",idx:u}),E=u=>d({kind:"arm",idx:u});function h(u,w){o.$$.not_equal(w.point1,u)&&(w.point1=u,oe.set(l))}const W=u=>d({kind:"movement",idx:u}),me=u=>d({kind:"movement",idx:u});function x(u,w){o.$$.not_equal(w.point2,u)&&(w.point2=u,oe.set(l))}const Z=u=>d({kind:"movement",idx:u}),H=u=>d({kind:"movement",idx:u});function le(u,w){o.$$.not_equal(w.point3,u)&&(w.point3=u,oe.set(l))}const Q=u=>d({kind:"movement",idx:u}),ne=u=>d({kind:"movement",idx:u});function I(u){j=u,n(7,j)}return o.$$set=u=>{"junctionIdx"in u&&n(1,i=u.junctionIdx),"stage"in u&&n(2,r=u.stage),"mode"in u&&n(0,a=u.mode),"hoveringSidebar"in u&&n(13,s=u.hoveringSidebar),"streetviewOn"in u&&n(14,f=u.streetviewOn),"showRoute"in u&&n(3,c=u.showRoute),"select"in u&&n(4,d=u.select),"stopEditing"in u&&n(5,m=u.stopEditing)},o.$$.update=()=>{o.$$.dirty[0]&8257&&n(8,t=N(l,a,s))},[a,i,r,c,d,m,l,j,t,L,M,S,v,s,f,_,$,p,V,X,T,E,h,W,me,x,Z,H,le,Q,ne,I]}class Dn extends ye{constructor(e){super(),je(this,e,Pn,Bn,be,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showRoute:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function lt(o,e,n){const t=o.slice();return t[9]=e[n],t}function rt(o,e,n){const t=o.slice();return t[9]=e[n],t}function it(o,e,n){const t=o.slice();return t[9]=e[n],t}function Un(o){let e;return{c(){e=R("Display guidance")},l(n){e=z(n,"Display guidance")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function at(o){let e,n;return{c(){e=G("p"),n=R(o[2])},l(t){e=J(t,"P",{});var l=K(e);n=z(l,o[2]),l.forEach(g)},m(t,l){k(t,e,l),A(e,n)},p(t,l){l&4&&ae(n,t[2])},d(t){t&&g(e)}}}function st(o){let e,n=o[9]+"",t;return{c(){e=G("li"),t=R(n)},l(l){e=J(l,"LI",{});var i=K(e);t=z(i,n),i.forEach(g)},m(l,i){k(l,e,i),A(e,t)},p(l,i){i&8&&n!==(n=l[9]+"")&&ae(t,n)},d(l){l&&g(e)}}}function ft(o){let e,n=o[9]+"",t;return{c(){e=G("li"),t=R(n)},l(l){e=J(l,"LI",{});var i=K(e);t=z(i,n),i.forEach(g)},m(l,i){k(l,e,i),A(e,t)},p(l,i){i&16&&n!==(n=l[9]+"")&&ae(t,n)},d(l){l&&g(e)}}}function ut(o){let e,n=o[9]+"",t;return{c(){e=G("li"),t=R(n)},l(l){e=J(l,"LI",{});var i=K(e);t=z(i,n),i.forEach(g)},m(l,i){k(l,e,i),A(e,t)},p(l,i){i&32&&n!==(n=l[9]+"")&&ae(t,n)},d(l){l&&g(e)}}}function qn(o){let e,n=`${o[0]}: ${o[1]}`,t,l,i,r,a,s=`<th class="score-zero-header svelte-1i1c8i5">Score = 0
        <br/>
        Suitable only for confident existing cyclists, and may be avoided by some
        experienced cyclists Conditions are most likely to give rise to the most
        common collision types</th> <th class="score-one-header svelte-1i1c8i5">Score = 1
        <br/>
        Likely to be more acceptable to most cyclists, but may still pose problems
        for less confident or new cyclists The risk of collisions has been reduced
        by design layout or traffic management interventions</th> <th class="has-hover score-two-header svelte-1i1c8i5">Score = 2
        <br/>
        Suitable for all potential and existing cyclists The potential for collisions
        has been removed, or managed to a high standard of safety for cyclists</th>`,f,c,d,m,j,L,N,M,S,v,b=o[2]&&at(o),B=de(o[3]),_=[];for(let T=0;T<B.length;T+=1)_[T]=st(it(o,B,T));let $=de(o[4]),p=[];for(let T=0;T<$.length;T+=1)p[T]=ft(rt(o,$,T));let V=de(o[5]),X=[];for(let T=0;T<V.length;T+=1)X[T]=ut(lt(o,V,T));return{c(){e=G("h3"),t=R(n),l=O(),b&&b.c(),i=O(),r=G("table"),a=G("tr"),a.innerHTML=s,f=O(),c=G("tr"),d=G("td"),m=G("ul");for(let T=0;T<_.length;T+=1)_[T].c();j=O(),L=G("td"),N=G("ul");for(let T=0;T<p.length;T+=1)p[T].c();M=O(),S=G("td"),v=G("ul");for(let T=0;T<X.length;T+=1)X[T].c();this.h()},l(T){e=J(T,"H3",{});var E=K(e);t=z(E,n),E.forEach(g),l=P(T),b&&b.l(T),i=P(T),r=J(T,"TABLE",{});var h=K(r);a=J(h,"TR",{"data-svelte-h":!0}),Le(a)!=="svelte-1nzo4f7"&&(a.innerHTML=s),f=P(h),c=J(h,"TR",{});var W=K(c);d=J(W,"TD",{class:!0});var me=K(d);m=J(me,"UL",{});var x=K(m);for(let ne=0;ne<_.length;ne+=1)_[ne].l(x);x.forEach(g),me.forEach(g),j=P(W),L=J(W,"TD",{class:!0});var Z=K(L);N=J(Z,"UL",{});var H=K(N);for(let ne=0;ne<p.length;ne+=1)p[ne].l(H);H.forEach(g),Z.forEach(g),M=P(W),S=J(W,"TD",{class:!0});var le=K(S);v=J(le,"UL",{});var Q=K(v);for(let ne=0;ne<X.length;ne+=1)X[ne].l(Q);Q.forEach(g),le.forEach(g),W.forEach(g),h.forEach(g),this.h()},h(){re(d,"class","score-zero svelte-1i1c8i5"),re(L,"class","score-one svelte-1i1c8i5"),re(S,"class","score-two svelte-1i1c8i5")},m(T,E){k(T,e,E),A(e,t),k(T,l,E),b&&b.m(T,E),k(T,i,E),k(T,r,E),A(r,a),A(r,f),A(r,c),A(c,d),A(d,m);for(let h=0;h<_.length;h+=1)_[h]&&_[h].m(m,null);A(c,j),A(c,L),A(L,N);for(let h=0;h<p.length;h+=1)p[h]&&p[h].m(N,null);A(c,M),A(c,S),A(S,v);for(let h=0;h<X.length;h+=1)X[h]&&X[h].m(v,null)},p(T,E){if(E&3&&n!==(n=`${T[0]}: ${T[1]}`)&&ae(t,n),T[2]?b?b.p(T,E):(b=at(T),b.c(),b.m(i.parentNode,i)):b&&(b.d(1),b=null),E&8){B=de(T[3]);let h;for(h=0;h<B.length;h+=1){const W=it(T,B,h);_[h]?_[h].p(W,E):(_[h]=st(W),_[h].c(),_[h].m(m,null))}for(;h<_.length;h+=1)_[h].d(1);_.length=B.length}if(E&16){$=de(T[4]);let h;for(h=0;h<$.length;h+=1){const W=rt(T,$,h);p[h]?p[h].p(W,E):(p[h]=ft(W),p[h].c(),p[h].m(N,null))}for(;h<p.length;h+=1)p[h].d(1);p.length=$.length}if(E&32){V=de(T[5]);let h;for(h=0;h<V.length;h+=1){const W=lt(T,V,h);X[h]?X[h].p(W,E):(X[h]=ut(W),X[h].c(),X[h].m(v,null))}for(;h<X.length;h+=1)X[h].d(1);X.length=V.length}},d(T){T&&(g(e),g(l),g(i),g(r)),b&&b.d(T),ve(_,T),ve(p,T),ve(X,T)}}}function Fn(o){let e,n,t,l,i,r;n=new ke({props:{$$slots:{default:[Un]},$$scope:{ctx:o}}}),n.$on("click",o[7]);function a(f){o[8](f)}let s={title:"Guidance",$$slots:{default:[qn]},$$scope:{ctx:o}};return o[6]!==void 0&&(s.open=o[6]),l=new ln({props:s}),ie.push(()=>ue(l,"open",a)),{c(){e=G("div"),D(n.$$.fragment),t=O(),D(l.$$.fragment)},l(f){e=J(f,"DIV",{});var c=K(e);U(n.$$.fragment,c),c.forEach(g),t=P(f),U(l.$$.fragment,f)},m(f,c){k(f,e,c),q(n,e,null),k(f,t,c),q(l,f,c),r=!0},p(f,[c]){const d={};c&65536&&(d.$$scope={dirty:c,ctx:f}),n.$set(d);const m={};c&65599&&(m.$$scope={dirty:c,ctx:f}),!i&&c&64&&(i=!0,m.open=f[6],fe(()=>i=!1)),l.$set(m)},i(f){r||(y(n.$$.fragment,f),y(l.$$.fragment,f),r=!0)},o(f){C(n.$$.fragment,f),C(l.$$.fragment,f),r=!1},d(f){f&&(g(e),g(t)),F(n),F(l,f)}}}function Rn(o,e,n){let{junctionType:t}=e,{cycleMovement:l}=e,{summary:i=""}=e,{scoreZeroBullets:r}=e,{scoreOneBullets:a}=e,{scoreTwoBullets:s}=e,f=!1;function c(){n(6,f=!0)}function d(m){f=m,n(6,f)}return o.$$set=m=>{"junctionType"in m&&n(0,t=m.junctionType),"cycleMovement"in m&&n(1,l=m.cycleMovement),"summary"in m&&n(2,i=m.summary),"scoreZeroBullets"in m&&n(3,r=m.scoreZeroBullets),"scoreOneBullets"in m&&n(4,a=m.scoreOneBullets),"scoreTwoBullets"in m&&n(5,s=m.scoreTwoBullets)},[t,l,i,r,a,s,f,c,d]}class zn extends ye{constructor(e){super(),je(this,e,Rn,Fn,be,{junctionType:0,cycleMovement:1,summary:2,scoreZeroBullets:3,scoreOneBullets:4,scoreTwoBullets:5})}}const pe={"Any type of junction":{"Any movement":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movementcrosses wide junctionentry or exit: e.g. withmerge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. accessonly streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation"]}},"Simple priority T-junction":{summary:"This guidance is in addition to and notwithstanding any of the above “any junction” conditions.","Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority"]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{summary:"This guidance is in addition to and notwithstanding any of the above “any junction” and T junction conditions.","Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{summary:"This guidance is in addition to and notwithstanding any of the above “any junction” conditions.","All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn viaASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{summary:"This guidance is in addition to and notwithstanding any of the above “any junction” conditions.","All movements":{scoreZero:["a Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. ","Cycle/pedestrian scramble (toucan crossings with all-red stage)."],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}};function ct(o){let e,n,t;function l(r){o[5](r)}let i={label:"What type of movement do you need guidance for",choices:qe(o[1])};return o[2]!==void 0&&(i.value=o[2]),e=new Ae({props:i}),ie.push(()=>ue(e,"value",l)),{c(){D(e.$$.fragment)},l(r){U(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const s={};a&2&&(s.choices=qe(r[1])),!n&&a&4&&(n=!0,s.value=r[2],fe(()=>n=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function mt(o){let e,n;return e=new zn({props:{junctionType:o[0],cycleMovement:o[2],summary:pe[o[0]].summary,scoreZeroBullets:pe[o[0]][o[2]].scoreZero,scoreOneBullets:pe[o[0]][o[2]].scoreOne,scoreTwoBullets:pe[o[0]][o[2]].scoreTwo}}),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l&1&&(i.junctionType=t[0]),l&4&&(i.cycleMovement=t[2]),l&1&&(i.summary=pe[t[0]].summary),l&5&&(i.scoreZeroBullets=pe[t[0]][t[2]].scoreZero),l&5&&(i.scoreOneBullets=pe[t[0]][t[2]].scoreOne),l&5&&(i.scoreTwoBullets=pe[t[0]][t[2]].scoreTwo),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Hn(o){let e,n,t,l,i,r;function a(d){o[4](d)}let s={label:"What type of junction do you need guidance for",choices:qe(o[3])};o[0]!==void 0&&(s.value=o[0]),e=new Ae({props:s}),ie.push(()=>ue(e,"value",a));let f=o[1].length>1&&ct(o),c=pe[o[0]][o[2]]&&mt(o);return{c(){D(e.$$.fragment),t=O(),f&&f.c(),l=O(),c&&c.c(),i=ce()},l(d){U(e.$$.fragment,d),t=P(d),f&&f.l(d),l=P(d),c&&c.l(d),i=ce()},m(d,m){q(e,d,m),k(d,t,m),f&&f.m(d,m),k(d,l,m),c&&c.m(d,m),k(d,i,m),r=!0},p(d,[m]){const j={};!n&&m&1&&(n=!0,j.value=d[0],fe(()=>n=!1)),e.$set(j),d[1].length>1?f?(f.p(d,m),m&2&&y(f,1)):(f=ct(d),f.c(),y(f,1),f.m(l.parentNode,l)):f&&(_e(),C(f,1,1,()=>{f=null}),ge()),pe[d[0]][d[2]]?c?(c.p(d,m),m&5&&y(c,1)):(c=mt(d),c.c(),y(c,1),c.m(i.parentNode,i)):c&&(_e(),C(c,1,1,()=>{c=null}),ge())},i(d){r||(y(e.$$.fragment,d),y(f),y(c),r=!0)},o(d){C(e.$$.fragment,d),C(f),C(c),r=!1},d(d){d&&(g(t),g(l),g(i)),F(e,d),f&&f.d(d),c&&c.d(d)}}}function Zn(o,e,n){let t=Object.keys(pe),l=t[0],i=[],r="";function a(f){l=f,n(0,l)}function s(f){r=f,n(2,r),n(0,l),n(1,i)}return o.$$.update=()=>{o.$$.dirty&3&&(n(1,i=Object.keys(pe[l]).filter(f=>f!=="summary")),i.length===1&&n(2,r=i[0]))},[l,i,r,t,a,s]}class Gn extends ye{constructor(e){super(),je(this,e,Zn,Hn,be,{})}}function Jn(o){let e,n,t,l,i,r,a,s,f,c,d,m,j,L;function N(p){o[5](p)}let M={label:"Name"};o[3].jat[o[0]][o[1]].movements[o[2]].name!==void 0&&(M.value=o[3].jat[o[0]][o[1]].movements[o[2]].name),e=new Ze({props:M}),ie.push(()=>ue(e,"value",N));function S(p){o[6](p)}let v={label:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};o[3].jat[o[0]][o[1]].movements[o[2]].kind!==void 0&&(v.value=o[3].jat[o[0]][o[1]].movements[o[2]].kind),l=new Ae({props:v}),ie.push(()=>ue(l,"value",S));function b(p){o[7](p)}let B={label:"Score",choices:o[4]};o[3].jat[o[0]][o[1]].movements[o[2]].score!==void 0&&(B.value=o[3].jat[o[0]][o[1]].movements[o[2]].score),a=new Ae({props:B}),ie.push(()=>ue(a,"value",b));function _(p){o[8](p)}let $={label:"Comments"};return o[3].jat[o[0]][o[1]].movements[o[2]].notes!==void 0&&($.value=o[3].jat[o[0]][o[1]].movements[o[2]].notes),c=new It({props:$}),ie.push(()=>ue(c,"value",_)),j=new Gn({}),{c(){D(e.$$.fragment),t=O(),D(l.$$.fragment),r=O(),D(a.$$.fragment),f=O(),D(c.$$.fragment),m=O(),D(j.$$.fragment)},l(p){U(e.$$.fragment,p),t=P(p),U(l.$$.fragment,p),r=P(p),U(a.$$.fragment,p),f=P(p),U(c.$$.fragment,p),m=P(p),U(j.$$.fragment,p)},m(p,V){q(e,p,V),k(p,t,V),q(l,p,V),k(p,r,V),q(a,p,V),k(p,f,V),q(c,p,V),k(p,m,V),q(j,p,V),L=!0},p(p,[V]){const X={};!n&&V&15&&(n=!0,X.value=p[3].jat[p[0]][p[1]].movements[p[2]].name,fe(()=>n=!1)),e.$set(X);const T={};!i&&V&15&&(i=!0,T.value=p[3].jat[p[0]][p[1]].movements[p[2]].kind,fe(()=>i=!1)),l.$set(T);const E={};!s&&V&15&&(s=!0,E.value=p[3].jat[p[0]][p[1]].movements[p[2]].score,fe(()=>s=!1)),a.$set(E);const h={};!d&&V&15&&(d=!0,h.value=p[3].jat[p[0]][p[1]].movements[p[2]].notes,fe(()=>d=!1)),c.$set(h)},i(p){L||(y(e.$$.fragment,p),y(l.$$.fragment,p),y(a.$$.fragment,p),y(c.$$.fragment,p),y(j.$$.fragment,p),L=!0)},o(p){C(e.$$.fragment,p),C(l.$$.fragment,p),C(a.$$.fragment,p),C(c.$$.fragment,p),C(j.$$.fragment,p),L=!1},d(p){p&&(g(t),g(r),g(f),g(m)),F(e,p),F(l,p),F(a,p),F(c,p),F(j,p)}}}function Vn(o,e,n){let t;Be(o,oe,m=>n(3,t=m));let{junctionIdx:l}=e,{stage:i}=e,{idx:r}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(m){o.$$.not_equal(t.jat[l][i].movements[r].name,m)&&(t.jat[l][i].movements[r].name=m,oe.set(t))}function f(m){o.$$.not_equal(t.jat[l][i].movements[r].kind,m)&&(t.jat[l][i].movements[r].kind=m,oe.set(t))}function c(m){o.$$.not_equal(t.jat[l][i].movements[r].score,m)&&(t.jat[l][i].movements[r].score=m,oe.set(t))}function d(m){o.$$.not_equal(t.jat[l][i].movements[r].notes,m)&&(t.jat[l][i].movements[r].notes=m,oe.set(t))}return o.$$set=m=>{"junctionIdx"in m&&n(0,l=m.junctionIdx),"stage"in m&&n(1,i=m.stage),"idx"in m&&n(2,r=m.idx)},[l,i,r,t,a,s,f,c,d]}class Xn extends ye{constructor(e){super(),je(this,e,Vn,Jn,be,{junctionIdx:0,stage:1,idx:2})}}function $e(o){if(o.movements.length==0)return"No movements added";let e=0,n=0;for(let l of o.movements)e+={0:0,1:1,2:2,X:0}[l.score],n+=2;let t=e/n*100;return`${Math.round(t)}%`}var Wn=Object.defineProperty,Kn=(o,e)=>Wn(o,"name",{value:e,configurable:!0});function Ot(o,e={}){const n=Xt(o),t=(n[0]+n[2])/2,l=(n[1]+n[3])/2;return Et([t,l],e.properties,e)}Kn(Ot,"center");var Qn=Ot;function Yn(o){let e=Qn({type:"FeatureCollection",features:o.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;o.sort((t,l)=>dt(Te(e,l.point))-dt(Te(e,t.point)));let n=[];for(let t=0;t<o.length;t++){let l=o[t],i=Te(l.point,e),r=1;for(let a of eo(t,o.length)){let s=o[a],f=Te(e,s.point),c=xn(l.point,e,r++),d=Wt(l.point,e),m=Se(c,.5*d,i).geometry.coordinates,j=Se(m,.2*d,f).geometry.coordinates;n.push({point1:c,point2:m,point3:j,kind:"cycling",score:"X",name:`${l.name} to ${s.name}`,notes:""})}}return n}function xn(o,e,n){let t=.003,i=Te(o,e)-90,r=t*n;return Se(o,r,i).geometry.coordinates}function dt(o){return(o+360)%360}function eo(o,e){let n=[];for(let t=o+1;t<e;t++)n.push(t);for(let t=0;t<o;t++)n.push(t);return n}const{window:to}=Rt;function _t(o,e,n){const t=o.slice();t[34]=e[n],t[37]=n;const l=t[16][t[34].score];return t[35]=l,t}function gt(o,e,n){const t=o.slice();return t[38]=e[n],t[37]=n,t}function no(o){let e,n,t,l,i,r,a,s;e=new He({props:{$$slots:{default:[lo]},$$scope:{ctx:o}}}),e.$on("click",o[11]),t=new Ge({props:{$$slots:{default:[ro]},$$scope:{ctx:o}}}),t.$on("click",o[12]);const f=[ao,io],c=[];function d(m,j){return m[2].id.kind=="movement"?0:1}return i=d(o),r=c[i]=f[i](o),{c(){D(e.$$.fragment),n=O(),D(t.$$.fragment),l=O(),r.c(),a=ce()},l(m){U(e.$$.fragment,m),n=P(m),U(t.$$.fragment,m),l=P(m),r.l(m),a=ce()},m(m,j){q(e,m,j),k(m,n,j),q(t,m,j),k(m,l,j),c[i].m(m,j),k(m,a,j),s=!0},p(m,j){const L={};j[1]&2&&(L.$$scope={dirty:j,ctx:m}),e.$set(L);const N={};j[1]&2&&(N.$$scope={dirty:j,ctx:m}),t.$set(N);let M=i;i=d(m),i===M?c[i].p(m,j):(_e(),C(c[M],1,1,()=>{c[M]=null}),ge(),r=c[i],r?r.p(m,j):(r=c[i]=f[i](m),r.c()),y(r,1),r.m(a.parentNode,a))},i(m){s||(y(e.$$.fragment,m),y(t.$$.fragment,m),y(r),s=!0)},o(m){C(e.$$.fragment,m),C(t.$$.fragment,m),C(r),s=!1},d(m){m&&(g(n),g(l),g(a)),F(e,m),F(t,m),c[i].d(m)}}}function oo(o){let e,n,t,l,i="Arms",r,a,s,f,c="Movements",d,m,j,L,N,M,S=(o[8].jat[o[0]].name||"Untitled junction")+"",v,b,B=$e(o[8].jat[o[0]][o[1]])+"",_,$,p,V,X,T,E;const h=o[18].default,W=jt(h,o,o[32],null);n=new Ft({props:{label:"Tools",$$slots:{default:[mo]},$$scope:{ctx:o}}});let me=de(o[8].jat[o[0]][o[1]].arms),x=[];for(let u=0;u<me.length;u+=1)x[u]=pt(gt(o,me,u));const Z=u=>C(x[u],1,1,()=>{x[u]=null});let H=o[8].jat[o[0]][o[9]].arms.length>0&&$t(o);p=new ke({props:{disabled:o[8].jat[o[0]][o[1]].arms.length<2,$$slots:{default:[go]},$$scope:{ctx:o}}}),p.$on("click",o[17]);let le=de(o[8].jat[o[0]][o[1]].movements),Q=[];for(let u=0;u<le.length;u+=1)Q[u]=ht(_t(o,le,u));const ne=u=>C(Q[u],1,1,()=>{Q[u]=null});let I=o[8].jat[o[0]][o[9]].movements.length>0&&vt(o);return{c(){W&&W.c(),e=O(),D(n.$$.fragment),t=O(),l=G("h3"),l.textContent=i,r=O();for(let u=0;u<x.length;u+=1)x[u].c();a=O(),H&&H.c(),s=O(),f=G("h3"),f.textContent=c,d=O(),m=G("p"),j=R("Total JAT score for "),L=R(o[1]),N=O(),M=G("u"),v=R(S),b=R(`
        : `),_=R(B),$=O(),D(p.$$.fragment),V=O();for(let u=0;u<Q.length;u+=1)Q[u].c();X=O(),I&&I.c(),T=ce()},l(u){W&&W.l(u),e=P(u),U(n.$$.fragment,u),t=P(u),l=J(u,"H3",{"data-svelte-h":!0}),Le(l)!=="svelte-ld74qb"&&(l.textContent=i),r=P(u);for(let se=0;se<x.length;se+=1)x[se].l(u);a=P(u),H&&H.l(u),s=P(u),f=J(u,"H3",{"data-svelte-h":!0}),Le(f)!=="svelte-1dc52s8"&&(f.textContent=c),d=P(u),m=J(u,"P",{});var w=K(m);j=z(w,"Total JAT score for "),L=z(w,o[1]),N=P(w),M=J(w,"U",{});var te=K(M);v=z(te,S),te.forEach(g),b=z(w,`
        : `),_=z(w,B),w.forEach(g),$=P(u),U(p.$$.fragment,u),V=P(u);for(let se=0;se<Q.length;se+=1)Q[se].l(u);X=P(u),I&&I.l(u),T=ce()},m(u,w){W&&W.m(u,w),k(u,e,w),q(n,u,w),k(u,t,w),k(u,l,w),k(u,r,w);for(let te=0;te<x.length;te+=1)x[te]&&x[te].m(u,w);k(u,a,w),H&&H.m(u,w),k(u,s,w),k(u,f,w),k(u,d,w),k(u,m,w),A(m,j),A(m,L),A(m,N),A(m,M),A(M,v),A(m,b),A(m,_),k(u,$,w),q(p,u,w),k(u,V,w);for(let te=0;te<Q.length;te+=1)Q[te]&&Q[te].m(u,w);k(u,X,w),I&&I.m(u,w),k(u,T,w),E=!0},p(u,w){W&&W.p&&(!E||w[1]&2)&&Ct(W,h,u,u[32],E?Mt(h,u[32],w,null):Tt(u[32]),null);const te={};if(w[0]&112|w[1]&2&&(te.$$scope={dirty:w,ctx:u}),n.$set(te),w[0]&1291){me=de(u[8].jat[u[0]][u[1]].arms);let Y;for(Y=0;Y<me.length;Y+=1){const Ee=gt(u,me,Y);x[Y]?(x[Y].p(Ee,w),y(x[Y],1)):(x[Y]=pt(Ee),x[Y].c(),y(x[Y],1),x[Y].m(a.parentNode,a))}for(_e(),Y=me.length;Y<x.length;Y+=1)Z(Y);ge()}u[8].jat[u[0]][u[9]].arms.length>0?H?(H.p(u,w),w[0]&257&&y(H,1)):(H=$t(u),H.c(),y(H,1),H.m(s.parentNode,s)):H&&(_e(),C(H,1,1,()=>{H=null}),ge()),(!E||w[0]&2)&&ae(L,u[1]),(!E||w[0]&257)&&S!==(S=(u[8].jat[u[0]].name||"Untitled junction")+"")&&ae(v,S),(!E||w[0]&259)&&B!==(B=$e(u[8].jat[u[0]][u[1]])+"")&&ae(_,B);const se={};if(w[0]&259&&(se.disabled=u[8].jat[u[0]][u[1]].arms.length<2),w[1]&2&&(se.$$scope={dirty:w,ctx:u}),p.$set(se),w[0]&66827){le=de(u[8].jat[u[0]][u[1]].movements);let Y;for(Y=0;Y<le.length;Y+=1){const Ee=_t(u,le,Y);Q[Y]?(Q[Y].p(Ee,w),y(Q[Y],1)):(Q[Y]=ht(Ee),Q[Y].c(),y(Q[Y],1),Q[Y].m(X.parentNode,X))}for(_e(),Y=le.length;Y<Q.length;Y+=1)ne(Y);ge()}u[8].jat[u[0]][u[9]].movements.length>0?I?(I.p(u,w),w[0]&257&&y(I,1)):(I=vt(u),I.c(),y(I,1),I.m(T.parentNode,T)):I&&(_e(),C(I,1,1,()=>{I=null}),ge())},i(u){if(!E){y(W,u),y(n.$$.fragment,u);for(let w=0;w<me.length;w+=1)y(x[w]);y(H),y(p.$$.fragment,u);for(let w=0;w<le.length;w+=1)y(Q[w]);y(I),E=!0}},o(u){C(W,u),C(n.$$.fragment,u),x=x.filter(Boolean);for(let w=0;w<x.length;w+=1)C(x[w]);C(H),C(p.$$.fragment,u),Q=Q.filter(Boolean);for(let w=0;w<Q.length;w+=1)C(Q[w]);C(I),E=!1},d(u){u&&(g(e),g(t),g(l),g(r),g(a),g(s),g(f),g(d),g(m),g($),g(V),g(X),g(T)),W&&W.d(u),F(n,u),ve(x,u),H&&H.d(u),F(p,u),ve(Q,u),I&&I.d(u)}}}function lo(o){let e;return{c(){e=R("Save")},l(n){e=z(n,"Save")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function ro(o){let e;return{c(){e=R("Delete")},l(n){e=z(n,"Delete")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function io(o){let e,n,t;function l(r){o[29](r)}let i={label:"Arm Name"};return o[8].jat[o[0]][o[1]].arms[o[2].id.idx].name!==void 0&&(i.value=o[8].jat[o[0]][o[1]].arms[o[2].id.idx].name),e=new Ze({props:i}),ie.push(()=>ue(e,"value",l)),{c(){D(e.$$.fragment)},l(r){U(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const s={};!n&&a[0]&263&&(n=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,fe(()=>n=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function ao(o){let e,n,t,l,i,r;return e=new Xn({props:{junctionIdx:o[0],stage:o[1],idx:o[2].id.idx}}),t=new He({props:{$$slots:{default:[so]},$$scope:{ctx:o}}}),t.$on("click",o[11]),i=new Ge({props:{$$slots:{default:[fo]},$$scope:{ctx:o}}}),i.$on("click",o[12]),{c(){D(e.$$.fragment),n=O(),D(t.$$.fragment),l=O(),D(i.$$.fragment)},l(a){U(e.$$.fragment,a),n=P(a),U(t.$$.fragment,a),l=P(a),U(i.$$.fragment,a)},m(a,s){q(e,a,s),k(a,n,s),q(t,a,s),k(a,l,s),q(i,a,s),r=!0},p(a,s){const f={};s[0]&1&&(f.junctionIdx=a[0]),s[0]&2&&(f.stage=a[1]),s[0]&4&&(f.idx=a[2].id.idx),e.$set(f);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:a}),t.$set(c);const d={};s[1]&2&&(d.$$scope={dirty:s,ctx:a}),i.$set(d)},i(a){r||(y(e.$$.fragment,a),y(t.$$.fragment,a),y(i.$$.fragment,a),r=!0)},o(a){C(e.$$.fragment,a),C(t.$$.fragment,a),C(i.$$.fragment,a),r=!1},d(a){a&&(g(n),g(l)),F(e,a),F(t,a),F(i,a)}}}function so(o){let e;return{c(){e=R("Save")},l(n){e=z(n,"Save")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function fo(o){let e;return{c(){e=R("Delete")},l(n){e=z(n,"Delete")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function uo(o){let e;return{c(){e=R("Zoom to fit")},l(n){e=z(n,"Zoom to fit")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function co(o){let e;return{c(){e=R("Show route")},l(n){e=z(n,"Show route")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function mo(o){var S;let e,n,t,l,i,r,a,s,f,c,d,m;e=new ke({props:{$$slots:{default:[uo]},$$scope:{ctx:o}}}),e.$on("click",o[20]),t=new tn({}),i=new xt({});function j(v){o[21](v)}let L={map:(S=o[6])==null?void 0:S.getMap()};o[4]!==void 0&&(L.enabled=o[4]),a=new en({props:L}),ie.push(()=>ue(a,"enabled",j));function N(v){o[22](v)}let M={$$slots:{default:[co]},$$scope:{ctx:o}};return o[5]!==void 0&&(M.checked=o[5]),c=new nn({props:M}),ie.push(()=>ue(c,"checked",N)),{c(){D(e.$$.fragment),n=O(),D(t.$$.fragment),l=O(),D(i.$$.fragment),r=O(),D(a.$$.fragment),f=O(),D(c.$$.fragment)},l(v){U(e.$$.fragment,v),n=P(v),U(t.$$.fragment,v),l=P(v),U(i.$$.fragment,v),r=P(v),U(a.$$.fragment,v),f=P(v),U(c.$$.fragment,v)},m(v,b){q(e,v,b),k(v,n,b),q(t,v,b),k(v,l,b),q(i,v,b),k(v,r,b),q(a,v,b),k(v,f,b),q(c,v,b),m=!0},p(v,b){var p;const B={};b[1]&2&&(B.$$scope={dirty:b,ctx:v}),e.$set(B);const _={};b[0]&64&&(_.map=(p=v[6])==null?void 0:p.getMap()),!s&&b[0]&16&&(s=!0,_.enabled=v[4],fe(()=>s=!1)),a.$set(_);const $={};b[1]&2&&($.$$scope={dirty:b,ctx:v}),!d&&b[0]&32&&(d=!0,$.checked=v[5],fe(()=>d=!1)),c.$set($)},i(v){m||(y(e.$$.fragment,v),y(t.$$.fragment,v),y(i.$$.fragment,v),y(a.$$.fragment,v),y(c.$$.fragment,v),m=!0)},o(v){C(e.$$.fragment,v),C(t.$$.fragment,v),C(i.$$.fragment,v),C(a.$$.fragment,v),C(c.$$.fragment,v),m=!1},d(v){v&&(g(n),g(l),g(r),g(f)),F(e,v),F(t,v),F(i,v),F(a,v),F(c,v)}}}function pt(o){let e,n;function t(){return o[23](o[37])}function l(){return o[24](o[37])}return e=new Je({props:{name:`${bt(o[37])} - ${o[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",o[25]),{c(){D(e.$$.fragment)},l(i){U(e.$$.fragment,i)},m(i,r){q(e,i,r),n=!0},p(i,r){o=i;const a={};r[0]&259&&(a.name=`${bt(o[37])} - ${o[38].name||"Unnamed arm"}`),e.$set(a)},i(i){n||(y(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function $t(o){let e,n;return e=new ke({props:{$$slots:{default:[_o]},$$scope:{ctx:o}}}),e.$on("click",o[14]),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l[1]&2&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function _o(o){let e,n;return{c(){e=R("Copy arms from "),n=R(o[9])},l(t){e=z(t,"Copy arms from "),n=z(t,o[9])},m(t,l){k(t,e,l),k(t,n,l)},p:Ie,d(t){t&&(g(e),g(n))}}}function go(o){let e;return{c(){e=R("Generate cycling movements between all arms")},l(n){e=z(n,"Generate cycling movements between all arms")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function po(o){let e,n,t,l=o[34].score+"",i,r,a,s=We(o[34].kind)+"",f;return{c(){e=G("div"),n=G("span"),t=R("Score: "),i=R(l),r=O(),a=G("span"),f=R(s),this.h()},l(c){e=J(c,"DIV",{style:!0});var d=K(e);n=J(d,"SPAN",{style:!0});var m=K(n);t=z(m,"Score: "),i=z(m,l),m.forEach(g),r=P(d),a=J(d,"SPAN",{});var j=K(a);f=z(j,s),j.forEach(g),d.forEach(g),this.h()},h(){ee(n,"padding","4px"),ee(n,"color",o[35].font),ee(n,"background-color",o[35].background),ee(e,"width","100%"),ee(e,"display","flex"),ee(e,"justify-content","space-between")},m(c,d){k(c,e,d),A(e,n),A(n,t),A(n,i),A(e,r),A(e,a),A(a,f)},p(c,d){d[0]&259&&l!==(l=c[34].score+"")&&ae(i,l),d[0]&259&&ee(n,"color",c[35].font),d[0]&259&&ee(n,"background-color",c[35].background),d[0]&259&&s!==(s=We(c[34].kind)+"")&&ae(f,s)},d(c){c&&g(e)}}}function ht(o){let e,n;function t(){return o[26](o[37])}function l(){return o[27](o[37])}return e=new Je({props:{name:o[34].name||"Unnamed movement",$$slots:{default:[po]},$$scope:{ctx:o}}}),e.$on("click",t),e.$on("mouseenter",l),e.$on("mouseleave",o[28]),{c(){D(e.$$.fragment)},l(i){U(e.$$.fragment,i)},m(i,r){q(e,i,r),n=!0},p(i,r){o=i;const a={};r[0]&259&&(a.name=o[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(a.$$scope={dirty:r,ctx:o}),e.$set(a)},i(i){n||(y(e.$$.fragment,i),n=!0)},o(i){C(e.$$.fragment,i),n=!1},d(i){F(e,i)}}}function vt(o){let e,n;return e=new ke({props:{$$slots:{default:[$o]},$$scope:{ctx:o}}}),e.$on("click",o[15]),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l[1]&2&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function $o(o){let e,n;return{c(){e=R("Copy movements from "),n=R(o[9])},l(t){e=z(t,"Copy movements from "),n=z(t,o[9])},m(t,l){k(t,e,l),k(t,n,l)},p:Ie,d(t){t&&(g(e),g(n))}}}function ho(o){let e,n,t,l,i,r,a,s=$e(o[8].jat[o[0]].existing)+"",f,c,d,m=$e(o[8].jat[o[0]].proposed)+"",j,L,N,M,S,v,b,B,_,$,p,V,X;function T(Z){o[19](Z)}let E={label:"Commentary / Notes about "+o[1]+" junction"};o[8].jat[o[0]][o[1]].notes!==void 0&&(E.value=o[8].jat[o[0]][o[1]].notes),n=new It({props:E}),ie.push(()=>ue(n,"value",T));const h=[oo,no],W=[];function me(Z,H){return Z[2].mode!="editing"?0:1}v=me(o),b=W[v]=h[v](o);let x={junctionIdx:o[0],stage:o[1],mode:o[2],hoveringSidebar:o[3],streetviewOn:o[4],showRoute:o[5],select:o[10],stopEditing:o[11]};return $=new Dn({props:x}),o[31]($),{c(){e=G("div"),D(n.$$.fragment),l=O(),i=G("p"),r=R("Total JAT score: "),a=G("b"),f=R(s),c=R(`
    existing,
    `),d=G("b"),j=R(m),L=R(`
    proposed`),N=O(),M=G("div"),S=G("div"),b.c(),B=O(),_=G("div"),D($.$$.fragment),this.h()},l(Z){e=J(Z,"DIV",{class:!0});var H=K(e);U(n.$$.fragment,H),l=P(H),i=J(H,"P",{});var le=K(i);r=z(le,"Total JAT score: "),a=J(le,"B",{});var Q=K(a);f=z(Q,s),Q.forEach(g),c=z(le,`
    existing,
    `),d=J(le,"B",{});var ne=K(d);j=z(ne,m),ne.forEach(g),L=z(le,`
    proposed`),le.forEach(g),H.forEach(g),N=P(Z),M=J(Z,"DIV",{style:!0});var I=K(M);S=J(I,"DIV",{style:!0});var u=K(S);b.l(u),u.forEach(g),B=P(I),_=J(I,"DIV",{style:!0});var w=K(_);U($.$$.fragment,w),w.forEach(g),I.forEach(g),this.h()},h(){re(e,"class","govuk-width-container"),ee(S,"width","30%"),ee(S,"overflow-y","scroll"),ee(S,"padding","10px"),ee(S,"border","1px solid black"),ee(_,"position","relative"),ee(_,"width","100%"),ee(M,"display","flex"),ee(M,"height","80vh")},m(Z,H){k(Z,e,H),q(n,e,null),A(e,l),A(e,i),A(i,r),A(i,a),A(a,f),A(i,c),A(i,d),A(d,j),A(i,L),k(Z,N,H),k(Z,M,H),A(M,S),W[v].m(S,null),o[30](S),A(M,B),A(M,_),q($,_,null),p=!0,V||(X=Ut(to,"keydown",o[13]),V=!0)},p(Z,H){const le={};H[0]&2&&(le.label="Commentary / Notes about "+Z[1]+" junction"),!t&&H[0]&259&&(t=!0,le.value=Z[8].jat[Z[0]][Z[1]].notes,fe(()=>t=!1)),n.$set(le),(!p||H[0]&257)&&s!==(s=$e(Z[8].jat[Z[0]].existing)+"")&&ae(f,s),(!p||H[0]&257)&&m!==(m=$e(Z[8].jat[Z[0]].proposed)+"")&&ae(j,m);let Q=v;v=me(Z),v===Q?W[v].p(Z,H):(_e(),C(W[Q],1,1,()=>{W[Q]=null}),ge(),b=W[v],b?b.p(Z,H):(b=W[v]=h[v](Z),b.c()),y(b,1),b.m(S,null));const ne={};H[0]&1&&(ne.junctionIdx=Z[0]),H[0]&2&&(ne.stage=Z[1]),H[0]&4&&(ne.mode=Z[2]),H[0]&8&&(ne.hoveringSidebar=Z[3]),H[0]&16&&(ne.streetviewOn=Z[4]),H[0]&32&&(ne.showRoute=Z[5]),$.$set(ne)},i(Z){p||(y(n.$$.fragment,Z),y(b),y($.$$.fragment,Z),p=!0)},o(Z){C(n.$$.fragment,Z),C(b),C($.$$.fragment,Z),p=!1},d(Z){Z&&(g(e),g(N),g(M)),F(n),W[v].d(),o[30](null),o[31](null),F($),V=!1,X()}}}function bt(o){return String.fromCharCode(o+65)}function vo(o,e,n){let t;Be(o,oe,I=>n(8,t=I));let{$$slots:l={},$$scope:i}=e,{junctionIdx:r}=e,{stage:a}=e,s=a=="existing"?"proposed":"existing",f={mode:"select"},c=null,d=null,m=!1,j=!0,L=null,N;async function M(I){c=N.scrollTop,n(2,f={mode:"editing",id:I}),n(3,d=null),await Xe(),n(7,N.scrollTop=0,N)}async function S(){n(2,f={mode:"select"}),c!=null&&(await Xe(),n(7,N.scrollTop=c,N),c=null)}function v(){f.mode=="editing"&&window.confirm(`Delete this ${f.id.kind}?`)&&(f.id.kind=="movement"?(t.jat[r][a].movements.splice(f.id.idx,1),oe.set(t)):(t.jat[r][a].arms.splice(f.id.idx,1),oe.set(t)),S())}function b(I){if(f.mode!="editing")return;let u=I.target.tagName,w=u=="INPUT"||u=="TEXTAREA";I.key=="Escape"||I.key=="Enter"&&!w?(I.stopPropagation(),S()):I.key=="Delete"&&!w&&(I.stopPropagation(),v())}function B(){t.jat[r][a].arms.length>0&&!window.confirm("Overwrite arms?")||(Me(oe,t.jat[r][a].arms=JSON.parse(JSON.stringify(t.jat[r][s].arms)),t),oe.set(t))}function _(){t.jat[r][a].movements.length>0&&!window.confirm("Overwrite movements?")||(Me(oe,t.jat[r][a].movements=JSON.parse(JSON.stringify(t.jat[r][s].movements)),t),oe.set(t))}let $={0:he.red,1:he.amber,2:he.green,X:he.critical};function p(){t.jat[r][a].movements.length>0&&!window.confirm("Overwrite all movements?")||Me(oe,t.jat[r][a].movements=Yn(t.jat[r][a].arms),t)}function V(I){o.$$.not_equal(t.jat[r][a].notes,I)&&(t.jat[r][a].notes=I,oe.set(t))}const X=()=>L==null?void 0:L.zoom(!0);function T(I){m=I,n(4,m)}function E(I){j=I,n(5,j)}const h=I=>M({kind:"arm",idx:I}),W=I=>n(3,d={kind:"arm",idx:I}),me=()=>n(3,d=null),x=I=>M({kind:"movement",idx:I}),Z=I=>n(3,d={kind:"movement",idx:I}),H=()=>n(3,d=null);function le(I){o.$$.not_equal(t.jat[r][a].arms[f.id.idx].name,I)&&(t.jat[r][a].arms[f.id.idx].name=I,oe.set(t))}function Q(I){ie[I?"unshift":"push"](()=>{N=I,n(7,N)})}function ne(I){ie[I?"unshift":"push"](()=>{L=I,n(6,L)})}return o.$$set=I=>{"junctionIdx"in I&&n(0,r=I.junctionIdx),"stage"in I&&n(1,a=I.stage),"$$scope"in I&&n(32,i=I.$$scope)},[r,a,f,d,m,j,L,N,t,s,M,S,v,b,B,_,$,p,l,V,X,T,E,h,W,me,x,Z,H,le,Q,ne,i]}class bo extends ye{constructor(e){super(),je(this,e,vo,ho,be,{junctionIdx:0,stage:1},null,[-1,-1])}}function kt(o,e,n){const t=o.slice();return t[10]=e[n],t[12]=n,t}function ko(o){let e,n,t=(o[1].jat[o[0].idx].name||"Untitled junction")+"",l,i,r=o[0].stage+"",a,s,f,c,d,m,j,L=o[0].stage,N,M;f=new qt({props:{$$slots:{default:[Co]},$$scope:{ctx:o}}});function S(B){o[7](B)}let v={label:"Junction Name"};o[1].jat[o[0].idx].name!==void 0&&(v.value=o[1].jat[o[0].idx].name),d=new Ze({props:v}),ie.push(()=>ue(d,"value",S));let b=wt(o);return{c(){e=G("div"),n=G("h2"),l=R(t),i=R(" - "),a=R(r),s=O(),D(f.$$.fragment),c=O(),D(d.$$.fragment),j=O(),b.c(),N=ce(),this.h()},l(B){e=J(B,"DIV",{class:!0});var _=K(e);n=J(_,"H2",{});var $=K(n);l=z($,t),i=z($," - "),a=z($,r),$.forEach(g),s=P(_),U(f.$$.fragment,_),c=P(_),U(d.$$.fragment,_),_.forEach(g),j=P(B),b.l(B),N=ce(),this.h()},h(){re(e,"class","govuk-width-container")},m(B,_){k(B,e,_),A(e,n),A(n,l),A(n,i),A(n,a),A(e,s),q(f,e,null),A(e,c),q(d,e,null),k(B,j,_),b.m(B,_),k(B,N,_),M=!0},p(B,_){(!M||_&3)&&t!==(t=(B[1].jat[B[0].idx].name||"Untitled junction")+"")&&ae(l,t),(!M||_&1)&&r!==(r=B[0].stage+"")&&ae(a,r);const $={};_&8193&&($.$$scope={dirty:_,ctx:B}),f.$set($);const p={};!m&&_&3&&(m=!0,p.value=B[1].jat[B[0].idx].name,fe(()=>m=!1)),d.$set(p),_&1&&be(L,L=B[0].stage)?(_e(),C(b,1,1,Ie),ge(),b=wt(B),b.c(),y(b,1),b.m(N.parentNode,N)):b.p(B,_)},i(B){M||(y(f.$$.fragment,B),y(d.$$.fragment,B),y(b),M=!0)},o(B){C(f.$$.fragment,B),C(d.$$.fragment,B),C(b),M=!1},d(B){B&&(g(e),g(j),g(N)),F(f),F(d),b.d(B)}}}function wo(o){let e,n,t,l;n=new He({props:{$$slots:{default:[Io]},$$scope:{ctx:o}}}),n.$on("click",o[2]);let i=de(o[1].jat),r=[];for(let s=0;s<i.length;s+=1)r[s]=yt(kt(o,i,s));const a=s=>C(r[s],1,1,()=>{r[s]=null});return{c(){e=G("div"),D(n.$$.fragment),t=O();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=J(s,"DIV",{class:!0});var f=K(e);U(n.$$.fragment,f),t=P(f);for(let c=0;c<r.length;c+=1)r[c].l(f);f.forEach(g),this.h()},h(){re(e,"class","govuk-width-container")},m(s,f){k(s,e,f),q(n,e,null),A(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);l=!0},p(s,f){const c={};if(f&8192&&(c.$$scope={dirty:f,ctx:s}),n.$set(c),f&3){i=de(s[1].jat);let d;for(d=0;d<i.length;d+=1){const m=kt(s,i,d);r[d]?(r[d].p(m,f),y(r[d],1)):(r[d]=yt(m),r[d].c(),y(r[d],1),r[d].m(e,null))}for(_e(),d=i.length;d<r.length;d+=1)a(d);ge()}},i(s){if(!l){y(n.$$.fragment,s);for(let f=0;f<i.length;f+=1)y(r[f]);l=!0}},o(s){C(n.$$.fragment,s),r=r.filter(Boolean);for(let f=0;f<r.length;f+=1)C(r[f]);l=!1},d(s){s&&g(e),F(n),ve(r,s)}}}function yo(o){let e;return{c(){e=R("Back to all junctions")},l(n){e=z(n,"Back to all junctions")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function jo(o){let e;return{c(){e=R("Delete junction")},l(n){e=z(n,"Delete junction")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function Co(o){let e,n,t,l;return e=new ke({props:{$$slots:{default:[yo]},$$scope:{ctx:o}}}),e.$on("click",o[5]),t=new Ge({props:{$$slots:{default:[jo]},$$scope:{ctx:o}}}),t.$on("click",o[6]),{c(){D(e.$$.fragment),n=O(),D(t.$$.fragment)},l(i){U(e.$$.fragment,i),n=P(i),U(t.$$.fragment,i)},m(i,r){q(e,i,r),k(i,n,r),q(t,i,r),l=!0},p(i,r){const a={};r&8192&&(a.$$scope={dirty:r,ctx:i}),e.$set(a);const s={};r&8192&&(s.$$scope={dirty:r,ctx:i}),t.$set(s)},i(i){l||(y(e.$$.fragment,i),y(t.$$.fragment,i),l=!0)},o(i){C(e.$$.fragment,i),C(t.$$.fragment,i),l=!1},d(i){i&&g(n),F(e,i),F(t,i)}}}function To(o){let e,n;return e=new ke({props:{$$slots:{default:[Lo]},$$scope:{ctx:o}}}),e.$on("click",o[9]),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l&8192&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Mo(o){let e,n;return e=new ke({props:{$$slots:{default:[Eo]},$$scope:{ctx:o}}}),e.$on("click",o[8]),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l&8192&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Lo(o){let e;return{c(){e=R("Edit Proposed")},l(n){e=z(n,"Edit Proposed")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function Eo(o){let e;return{c(){e=R("Edit Existing")},l(n){e=z(n,"Edit Existing")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function So(o){let e,n,t=o[0].stage+"",l,i,r,a=o[1].jat[o[0].idx].name+"",s,f,c,d,m,j;const L=[Mo,To],N=[];function M(S,v){return S[0].stage=="proposed"?0:1}return c=M(o),d=N[c]=L[c](o),{c(){e=G("p"),n=R("Currently editing "),l=R(t),i=R(` junction
        `),r=G("u"),s=R(a),f=O(),d.c(),m=ce()},l(S){e=J(S,"P",{});var v=K(e);n=z(v,"Currently editing "),l=z(v,t),i=z(v,` junction
        `),r=J(v,"U",{});var b=K(r);s=z(b,a),b.forEach(g),v.forEach(g),f=P(S),d.l(S),m=ce()},m(S,v){k(S,e,v),A(e,n),A(e,l),A(e,i),A(e,r),A(r,s),k(S,f,v),N[c].m(S,v),k(S,m,v),j=!0},p(S,v){(!j||v&1)&&t!==(t=S[0].stage+"")&&ae(l,t),(!j||v&3)&&a!==(a=S[1].jat[S[0].idx].name+"")&&ae(s,a);let b=c;c=M(S),c===b?N[c].p(S,v):(_e(),C(N[b],1,1,()=>{N[b]=null}),ge(),d=N[c],d?d.p(S,v):(d=N[c]=L[c](S),d.c()),y(d,1),d.m(m.parentNode,m))},i(S){j||(y(d),j=!0)},o(S){C(d),j=!1},d(S){S&&(g(e),g(f),g(m)),N[c].d(S)}}}function wt(o){let e,n;return e=new bo({props:{junctionIdx:o[0].idx,stage:o[0].stage,$$slots:{default:[So]},$$scope:{ctx:o}}}),{c(){D(e.$$.fragment)},l(t){U(e.$$.fragment,t)},m(t,l){q(e,t,l),n=!0},p(t,l){const i={};l&1&&(i.junctionIdx=t[0].idx),l&1&&(i.stage=t[0].stage),l&8195&&(i.$$scope={dirty:l,ctx:t}),e.$set(i)},i(t){n||(y(e.$$.fragment,t),n=!0)},o(t){C(e.$$.fragment,t),n=!1},d(t){F(e,t)}}}function Io(o){let e;return{c(){e=R("Add new junction")},l(n){e=z(n,"Add new junction")},m(n,t){k(n,e,t)},d(n){n&&g(e)}}}function No(o){let e,n,t,l=$e(o[10].existing)+"",i,r,a,s,f=$e(o[10].proposed)+"",c,d;return{c(){e=G("div"),n=G("span"),t=R("Existing: "),i=R(l),r=O(),a=G("span"),s=R("Proposed: "),c=R(f),d=O(),this.h()},l(m){e=J(m,"DIV",{style:!0});var j=K(e);n=J(j,"SPAN",{});var L=K(n);t=z(L,"Existing: "),i=z(L,l),L.forEach(g),r=P(j),a=J(j,"SPAN",{});var N=K(a);s=z(N,"Proposed: "),c=z(N,f),N.forEach(g),j.forEach(g),d=P(m),this.h()},h(){ee(e,"width","100%"),ee(e,"display","flex"),ee(e,"justify-content","space-between")},m(m,j){k(m,e,j),A(e,n),A(n,t),A(n,i),A(e,r),A(e,a),A(a,s),A(a,c),k(m,d,j)},p(m,j){j&2&&l!==(l=$e(m[10].existing)+"")&&ae(i,l),j&2&&f!==(f=$e(m[10].proposed)+"")&&ae(c,f)},d(m){m&&(g(e),g(d))}}}function yt(o){let e,n;function t(){return o[4](o[12])}return e=new Je({props:{name:o[10].name||"Untitled junction",$$slots:{default:[No]},$$scope:{ctx:o}}}),e.$on("click",t),{c(){D(e.$$.fragment)},l(l){U(e.$$.fragment,l)},m(l,i){q(e,l,i),n=!0},p(l,i){o=l;const r={};i&2&&(r.name=o[10].name||"Untitled junction"),i&8194&&(r.$$scope={dirty:i,ctx:o}),e.$set(r)},i(l){n||(y(e.$$.fragment,l),n=!0)},o(l){C(e.$$.fragment,l),n=!1},d(l){F(e,l)}}}function Ao(o){let e,n,t,l;const i=[wo,ko],r=[];function a(s,f){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(o))&&(n=r[e]=i[e](o)),{c(){n&&n.c(),t=ce()},l(s){n&&n.l(s),t=ce()},m(s,f){~e&&r[e].m(s,f),k(s,t,f),l=!0},p(s,[f]){let c=e;e=a(s),e===c?~e&&r[e].p(s,f):(n&&(_e(),C(r[c],1,1,()=>{r[c]=null}),ge()),~e?(n=r[e],n?n.p(s,f):(n=r[e]=i[e](s),n.c()),y(n,1),n.m(t.parentNode,t)):n=null)},i(s){l||(y(n),l=!0)},o(s){C(n),l=!1},d(s){s&&g(t),~e&&r[e].d(s)}}}function Ue(o){if(o.kind=="list")throw new Error("Unreachable case");return o.idx}function Bo(o,e,n){let t;Be(o,oe,j=>n(1,t=j));let l={kind:"list"};function i(){Me(oe,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),n(0,l={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function r(j){window.confirm("Delete this junction?")&&(t.jat.splice(j,1),oe.set(t),n(0,l={kind:"list"}))}const a=j=>n(0,l={kind:"edit",idx:j,stage:"existing"}),s=()=>n(0,l={kind:"list"}),f=()=>r(Ue(l));function c(j){o.$$.not_equal(t.jat[l.idx].name,j)&&(t.jat[l.idx].name=j,oe.set(t))}return[l,t,i,r,a,s,f,c,()=>n(0,l={kind:"edit",idx:Ue(l),stage:"existing"}),()=>n(0,l={kind:"edit",idx:Ue(l),stage:"proposed"})]}class rl extends ye{constructor(e){super(),je(this,e,Bo,Ao,be,{})}}export{rl as component};
