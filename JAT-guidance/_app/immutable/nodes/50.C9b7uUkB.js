import{s as we,r as le,w as se,l as yt,u as jt,m as Ct,o as Tt,E as ye,k as Oe,Q as Pt,V as Ce,a as J,g as D,i as b,f as g,B as ve,X as Jt,e as Z,c as W,b as X,q as re,h as P,J as ue,Y as Lt,v as ee,L as Pe,t as R,M as Je,d as H,n as Ae,p as Te,j as ae,z as Dt,$ as Ve}from"../chunks/scheduler.Bxdx0f0B.js";import{S as Le,i as Se,e as fe,c as U,a as q,m as B,t as y,b as C,d as F,g as _e,f as ge}from"../chunks/index.itOPPQ0R.js";import{e as de}from"../chunks/each.BdQ2bsat.js";import{B as Ut}from"../chunks/ButtonGroup.CFC5gCUN.js";import{D as He,C as qt}from"../chunks/DefaultButton.j5-p4xk5.js";import{p as qe,j as Xe}from"../chunks/index.BqSLFEU1.js";import{S as be}from"../chunks/SecondaryButton.C3WEK5d3.js";import{T as ze}from"../chunks/TextInput.CJSxXsW7.js";import{W as Ge}from"../chunks/WarningButton.DE8BQTXW.js";import{s as oe}from"../chunks/data.BWTO9UD8.js";import{g as Bt}from"../chunks/globals.D0QH3NT1.js";import{a as Ft,c as Rt,j as ke,v as Ht,w as St,x as Be,M as zt,b as Gt,G as Ke,L as Fe,h as Qe,C as Zt,y as Wt}from"../chunks/index.B-fHZQdG.js";import{g as Re,t as Vt}from"../chunks/index.CP9PMOEH.js";import{c as he}from"../chunks/colors.DaC397qr.js";import{G as Xt,I as De,p as Kt}from"../chunks/pan.DXmntCs0.js";import{M as Qt,G as Yt,S as xt,C as Ze}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.D93MigRI.js";import{M as Ie,B as en,C as tn}from"../chunks/Marker.DslmP-fI.js";import"../chunks/paths.DkauEOkI.js";import"../chunks/entry.BQ01ldxk.js";import{R as nn}from"../chunks/RouteMapLayer.IpE1arbj.js";import{P as Et}from"../chunks/Popup.7hKczVAt.js";import{T as Mt}from"../chunks/TextArea.ChZCSQyI.js";import{R as Ne}from"../chunks/Radio.DXs925lR.js";import{M as on}from"../chunks/Modal.1zQK6xf3.js";function rn(n){let e;const t=n[16].default,o=yt(t,n,n[24],null);return{c(){o&&o.c()},l(r){o&&o.l(r)},m(r,i){o&&o.m(r,i),e=!0},p(r,i){o&&o.p&&(!e||i&16777216)&&jt(o,t,r,r[24],e?Tt(t,r[24],i,null):Ct(r[24]),null)},i(r){e||(y(o,r),e=!0)},o(r){C(o,r),e=!1},d(r){o&&o.d(r)}}}function ln(n){let e,t,o;function r(l){n[17](l)}let i={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[rn]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.hovered=n[0]),e=new Ft({props:i}),le.push(()=>fe(e,"hovered",r)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){U(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){B(e,l,a),o=!0},p(l,[a]){const s={};a&2&&(s.id=l[1]),a&4&&(s.source=l[2]),a&8&&(s.sourceLayer=l[3]),a&16&&(s.beforeId=l[4]),a&32&&(s.beforeLayerType=l[5]),a&64&&(s.paint=l[6]),a&128&&(s.layout=l[7]),a&256&&(s.filter=l[8]),a&512&&(s.applyToClusters=l[9]),a&1024&&(s.minzoom=l[10]),a&2048&&(s.maxzoom=l[11]),a&4096&&(s.hoverCursor=l[12]),a&8192&&(s.manageHoverState=l[13]),a&16384&&(s.eventsIfTopMost=l[14]),a&32768&&(s.interactive=l[15]),a&16777216&&(s.$$scope={dirty:a,ctx:l}),!t&&a&1&&(t=!0,s.hovered=l[0],se(()=>t=!1)),e.$set(s)},i(l){o||(y(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){F(e,l)}}}function an(n,e,t){let{$$slots:o={},$$scope:r}=e,{id:i=Rt("symbol")}=e,{source:l=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:f=void 0}=e,{paint:c=void 0}=e,{layout:m=void 0}=e,{filter:d=void 0}=e,{applyToClusters:w=void 0}=e,{minzoom:M=void 0}=e,{maxzoom:E=void 0}=e,{hoverCursor:j=void 0}=e,{manageHoverState:S=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:v=!1}=e,{interactive:O=!0}=e;function _(A){h=A,t(0,h)}function $(A){ye.call(this,n,A)}function p(A){ye.call(this,n,A)}function T(A){ye.call(this,n,A)}function V(A){ye.call(this,n,A)}function L(A){ye.call(this,n,A)}function I(A){ye.call(this,n,A)}return n.$$set=A=>{"id"in A&&t(1,i=A.id),"source"in A&&t(2,l=A.source),"sourceLayer"in A&&t(3,a=A.sourceLayer),"beforeId"in A&&t(4,s=A.beforeId),"beforeLayerType"in A&&t(5,f=A.beforeLayerType),"paint"in A&&t(6,c=A.paint),"layout"in A&&t(7,m=A.layout),"filter"in A&&t(8,d=A.filter),"applyToClusters"in A&&t(9,w=A.applyToClusters),"minzoom"in A&&t(10,M=A.minzoom),"maxzoom"in A&&t(11,E=A.maxzoom),"hoverCursor"in A&&t(12,j=A.hoverCursor),"manageHoverState"in A&&t(13,S=A.manageHoverState),"hovered"in A&&t(0,h=A.hovered),"eventsIfTopMost"in A&&t(14,v=A.eventsIfTopMost),"interactive"in A&&t(15,O=A.interactive),"$$scope"in A&&t(24,r=A.$$scope)},[h,i,l,a,s,f,c,m,d,w,M,E,j,S,v,O,o,_,$,p,T,V,L,I,r]}class sn extends Le{constructor(e){super(),Se(this,e,an,ln,we,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var fn=Object.defineProperty,un=(n,e)=>fn(n,"name",{value:e,configurable:!0});function At(n,e,t,o={}){const r=Re(n),i=ke(r[0]),l=ke(r[1]),a=ke(t),s=Ht(e,o.units),f=Math.asin(Math.sin(l)*Math.cos(s)+Math.cos(l)*Math.sin(s)*Math.cos(a)),c=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(l),Math.cos(s)-Math.sin(l)*Math.sin(f)),m=Be(c),d=Be(f);return St([m,d],o.properties)}un(At,"destination");var Me=At,cn=Object.defineProperty,It=(n,e)=>cn(n,"name",{value:e,configurable:!0});function We(n,e,t={}){if(t.final===!0)return Nt(n,e);const o=Re(n),r=Re(e),i=ke(o[0]),l=ke(r[0]),a=ke(o[1]),s=ke(r[1]),f=Math.sin(l-i)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(l-i);return Be(Math.atan2(f,c))}It(We,"bearing");function Nt(n,e){let t=We(e,n);return t=(t+180)%360,t}It(Nt,"calculateFinalBearing");var je=We;const mn="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ye(n,e,t){const o=n.slice();return o[36]=e[t],o[37]=e,o[38]=t,o}function xe(n,e,t){const o=n.slice();return o[39]=e[t],o[40]=e,o[38]=t,o}function et(n){let e,t,o,r,i,l,a;return t=new De({props:{$$slots:{default:[gn]},$$scope:{ctx:n}}}),t.$on("click",function(){Jt(n[5])&&n[5].apply(this,arguments)}),r=new De({props:{$$slots:{default:[hn]},$$scope:{ctx:n}}}),r.$on("click",n[17]),l=new De({props:{$$slots:{default:[kn]},$$scope:{ctx:n}}}),l.$on("click",n[18]),{c(){e=Z("div"),U(t.$$.fragment),o=J(),U(r.$$.fragment),i=J(),U(l.$$.fragment),this.h()},l(s){e=W(s,"DIV",{class:!0});var f=X(e);q(t.$$.fragment,f),o=D(f),q(r.$$.fragment,f),i=D(f),q(l.$$.fragment,f),f.forEach(g),this.h()},h(){re(e,"class","control-panel svelte-1w3m76d")},m(s,f){b(s,e,f),B(t,e,null),P(e,o),B(r,e,null),P(e,i),B(l,e,null),a=!0},p(s,f){n=s;const c={};f[0]&1|f[1]&1024&&(c.$$scope={dirty:f,ctx:n}),t.$set(c);const m={};f[0]&1|f[1]&1024&&(m.$$scope={dirty:f,ctx:n}),r.$set(m);const d={};f[0]&1|f[1]&1024&&(d.$$scope={dirty:f,ctx:n}),l.$set(d)},i(s){a||(y(t.$$.fragment,s),y(r.$$.fragment,s),y(l.$$.fragment,s),a=!0)},o(s){C(t.$$.fragment,s),C(r.$$.fragment,s),C(l.$$.fragment,s),a=!1},d(s){s&&g(e),F(t),F(r),F(l)}}}function dn(n){let e;return{c(){e=R("Move map")},l(t){e=H(t,"Move map")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function _n(n){let e,t="Move map";return{c(){e=Z("u"),e.textContent=t},l(o){e=W(o,"U",{"data-svelte-h":!0}),Te(e)!=="svelte-1719ytd"&&(e.textContent=t)},m(o,r){b(o,e,r)},d(o){o&&g(e)}}}function gn(n){let e,t,o,r;function i(s,f){return s[0].mode=="select"?_n:dn}let l=i(n),a=l(n);return{c(){e=Z("img"),o=J(),a.c(),r=ue(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),o=D(s),a.l(s),r=ue(),this.h()},h(){Lt(e.src,t=Kt)||re(e,"src",t),re(e,"alt","Move map"),ee(e,"vertical-align","middle")},m(s,f){b(s,e,f),b(s,o,f),a.m(s,f),b(s,r,f)},p(s,f){l!==(l=i(s))&&(a.d(1),a=l(s),a&&(a.c(),a.m(r.parentNode,r)))},d(s){s&&(g(e),g(o),g(r)),a.d(s)}}}function pn(n){let e;return{c(){e=R("New arm")},l(t){e=H(t,"New arm")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function $n(n){let e,t="New arm";return{c(){e=Z("u"),e.textContent=t},l(o){e=W(o,"U",{"data-svelte-h":!0}),Te(e)!=="svelte-1typ7gq"&&(e.textContent=t)},m(o,r){b(o,e,r)},d(o){o&&g(e)}}}function hn(n){let e,t,o,r,i,l;function a(c,m){return c[0].mode=="new-arm"?$n:pn}let s=a(n),f=s(n);return{c(){e=Pe("svg"),t=Pe("circle"),o=Pe("text"),r=R("A"),i=J(),f.c(),l=ue(),this.h()},l(c){e=Je(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var m=X(e);t=Je(m,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),X(t).forEach(g),o=Je(m,"text",{x:!0,y:!0,fill:!0});var d=X(o);r=H(d,"A"),d.forEach(g),m.forEach(g),i=D(c),f.l(c),l=ue(),this.h()},h(){re(t,"cx","12"),re(t,"cy","12"),re(t,"r","12"),re(t,"fill","white"),re(o,"x","6"),re(o,"y","16"),re(o,"fill","#4472c4"),re(e,"width","24"),re(e,"height","24"),re(e,"xmlns","http://www.w3.org/2000/svg"),ee(e,"vertical-align","middle")},m(c,m){b(c,e,m),P(e,t),P(e,o),P(o,r),b(c,i,m),f.m(c,m),b(c,l,m)},p(c,m){s!==(s=a(c))&&(f.d(1),f=s(c),f&&(f.c(),f.m(l.parentNode,l)))},d(c){c&&(g(e),g(i),g(l)),f.d(c)}}}function vn(n){let e;return{c(){e=R("New movement")},l(t){e=H(t,"New movement")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function bn(n){let e,t="New movement";return{c(){e=Z("u"),e.textContent=t},l(o){e=W(o,"U",{"data-svelte-h":!0}),Te(e)!=="svelte-o92ucp"&&(e.textContent=t)},m(o,r){b(o,e,r)},d(o){o&&g(e)}}}function kn(n){let e,t,o,r;function i(s,f){return s[0].mode=="new-movement"?bn:vn}let l=i(n),a=l(n);return{c(){e=Z("img"),o=J(),a.c(),r=ue(),this.h()},l(s){e=W(s,"IMG",{src:!0,alt:!0,style:!0}),o=D(s),a.l(s),r=ue(),this.h()},h(){Lt(e.src,t=mn)||re(e,"src",t),re(e,"alt","New movement"),ee(e,"vertical-align","middle")},m(s,f){b(s,e,f),b(s,o,f),a.m(s,f),b(s,r,f)},p(s,f){l!==(l=i(s))&&(a.d(1),a=l(s),a&&(a.c(),a.m(r.parentNode,r)))},d(s){s&&(g(e),g(o),g(r)),a.d(s)}}}function wn(n){let e,t=On(n[38])+"",o;return{c(){e=Z("span"),o=R(t),this.h()},l(r){e=W(r,"SPAN",{class:!0});var i=X(e);o=H(i,t),i.forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"color","#4472c4"),ee(e,"background-color","white")},m(r,i){b(r,e,i),P(e,o)},p:Ae,d(r){r&&g(e)}}}function tt(n){let e,t,o;function r(s){n[19](s,n[39])}function i(){return n[20](n[38])}function l(){return n[21](n[38])}let a={draggable:!0,$$slots:{default:[wn]},$$scope:{ctx:n}};return n[39].point!==void 0&&(a.lngLat=n[39].point),e=new Ie({props:a}),le.push(()=>fe(e,"lngLat",r)),e.$on("dragend",i),e.$on("click",l),{c(){U(e.$$.fragment)},l(s){q(e.$$.fragment,s)},m(s,f){B(e,s,f),o=!0},p(s,f){n=s;const c={};f[1]&1024&&(c.$$scope={dirty:f,ctx:n}),!t&&f[0]&70&&(t=!0,c.lngLat=n[39].point,se(()=>t=!1)),e.$set(c)},i(s){o||(y(e.$$.fragment,s),o=!0)},o(s){C(e.$$.fragment,s),o=!1},d(s){F(e,s)}}}function yn(n){let e;return{c(){e=Z("span"),this.h()},l(t){e=W(t,"SPAN",{class:!0}),X(e).forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"background-color",n[9][n[36].score]),ee(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(t,o){b(t,e,o)},p(t,o){o[0]&70&&ee(e,"background-color",t[9][t[36].score]),o[0]&70&&ee(e,"opacity",t[36].kind=="walking & wheeling"?"0%":"100%")},d(t){t&&g(e)}}}function jn(n){let e;return{c(){e=Z("span"),this.h()},l(t){e=W(t,"SPAN",{class:!0}),X(e).forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"background-color",n[9][n[36].score])},m(t,o){b(t,e,o)},p(t,o){o[0]&70&&ee(e,"background-color",t[9][t[36].score])},d(t){t&&g(e)}}}function Cn(n){let e;return{c(){e=Z("span"),this.h()},l(t){e=W(t,"SPAN",{class:!0}),X(e).forEach(g),this.h()},h(){re(e,"class","dot svelte-1w3m76d"),ee(e,"background-color",n[9][n[36].score]),ee(e,"opacity","0%")},m(t,o){b(t,e,o)},p(t,o){o[0]&70&&ee(e,"background-color",t[9][t[36].score])},d(t){t&&g(e)}}}function nt(n){let e,t,o,r,i,l,a,s,f;function c($){n[22]($,n[36])}function m(){return n[23](n[38])}function d(){return n[24](n[38])}let w={draggable:!0,$$slots:{default:[yn]},$$scope:{ctx:n}};n[36].point1!==void 0&&(w.lngLat=n[36].point1),e=new Ie({props:w}),le.push(()=>fe(e,"lngLat",c)),e.$on("dragend",m),e.$on("click",d);function M($){n[25]($,n[36])}function E(){return n[26](n[38])}function j(){return n[27](n[38])}let S={draggable:!0,$$slots:{default:[jn]},$$scope:{ctx:n}};n[36].point2!==void 0&&(S.lngLat=n[36].point2),r=new Ie({props:S}),le.push(()=>fe(r,"lngLat",M)),r.$on("dragend",E),r.$on("click",j);function h($){n[28]($,n[36])}function v(){return n[29](n[38])}function O(){return n[30](n[38])}let _={draggable:!0,$$slots:{default:[Cn]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(_.lngLat=n[36].point3),a=new Ie({props:_}),le.push(()=>fe(a,"lngLat",h)),a.$on("dragend",v),a.$on("click",O),{c(){U(e.$$.fragment),o=J(),U(r.$$.fragment),l=J(),U(a.$$.fragment)},l($){q(e.$$.fragment,$),o=D($),q(r.$$.fragment,$),l=D($),q(a.$$.fragment,$)},m($,p){B(e,$,p),b($,o,p),B(r,$,p),b($,l,p),B(a,$,p),f=!0},p($,p){n=$;const T={};p[0]&70|p[1]&1024&&(T.$$scope={dirty:p,ctx:n}),!t&&p[0]&70&&(t=!0,T.lngLat=n[36].point1,se(()=>t=!1)),e.$set(T);const V={};p[0]&70|p[1]&1024&&(V.$$scope={dirty:p,ctx:n}),!i&&p[0]&70&&(i=!0,V.lngLat=n[36].point2,se(()=>i=!1)),r.$set(V);const L={};p[0]&70|p[1]&1024&&(L.$$scope={dirty:p,ctx:n}),!s&&p[0]&70&&(s=!0,L.lngLat=n[36].point3,se(()=>s=!1)),a.$set(L)},i($){f||(y(e.$$.fragment,$),y(r.$$.fragment,$),y(a.$$.fragment,$),f=!0)},o($){C(e.$$.fragment,$),C(r.$$.fragment,$),C(a.$$.fragment,$),f=!1},d($){$&&(g(o),g(l)),F(e,$),F(r,$),F(a,$)}}}function Tn(n){let e=(n[35].name||"Untitled movement")+"",t;return{c(){t=R(e)},l(o){t=H(o,e)},m(o,r){b(o,t,r)},p(o,r){r[1]&16&&e!==(e=(o[35].name||"Untitled movement")+"")&&ae(t,e)},d(o){o&&g(t)}}}function Ln(n){let e,t;return e=new Et({props:{$$slots:{default:[Tn,({props:o})=>({35:o}),({props:o})=>[0,o?16:0]]},$$scope:{ctx:n}}}),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r[1]&1040&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function Sn(n){let e=(n[35].name||"Untitled movement")+"",t;return{c(){t=R(e)},l(o){t=H(o,e)},m(o,r){b(o,t,r)},p(o,r){r[1]&16&&e!==(e=(o[35].name||"Untitled movement")+"")&&ae(t,e)},d(o){o&&g(t)}}}function En(n){let e,t;return e=new Et({props:{$$slots:{default:[Sn,({props:o})=>({35:o}),({props:o})=>[0,o?16:0]]},$$scope:{ctx:n}}}),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r[1]&1040&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function Mn(n){let e,t,o,r,i,l;return e=new Fe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Qe(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[Ln]},$$scope:{ctx:n}}}),e.$on("click",n[11]),o=new Fe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Qe(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[En]},$$scope:{ctx:n}}}),o.$on("click",n[11]),i=new sn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"⬆","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){U(e.$$.fragment),t=J(),U(o.$$.fragment),r=J(),U(i.$$.fragment)},l(a){q(e.$$.fragment,a),t=D(a),q(o.$$.fragment,a),r=D(a),q(i.$$.fragment,a)},m(a,s){B(e,a,s),b(a,t,s),B(o,a,s),b(a,r,s),B(i,a,s),l=!0},p(a,s){const f={};s[1]&1024&&(f.$$scope={dirty:s,ctx:a}),e.$set(f);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:a}),o.$set(c)},i(a){l||(y(e.$$.fragment,a),y(o.$$.fragment,a),y(i.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),C(i.$$.fragment,a),l=!1},d(a){a&&(g(t),g(r)),F(e,a),F(o,a),F(i,a)}}}function An(n){let e,t,o,r;return e=new Fe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),o=new Zt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){U(e.$$.fragment),t=J(),U(o.$$.fragment)},l(i){q(e.$$.fragment,i),t=D(i),q(o.$$.fragment,i)},m(i,l){B(e,i,l),b(i,t,l),B(o,i,l),r=!0},p:Ae,i(i){r||(y(e.$$.fragment,i),y(o.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),C(o.$$.fragment,i),r=!1},d(i){i&&g(t),F(e,i),F(o,i)}}}function In(n){let e,t,o,r,i,l,a,s,f,c,m,d,w;e=new Qt({}),e.$on("click",n[10]);let M=n[0].mode!="editing"&&et(n);r=new nn({props:{show:n[3]}});let E=de(n[6].jat[n[1]][n[2]].arms),j=[];for(let _=0;_<E.length;_+=1)j[_]=tt(xe(n,E,_));const S=_=>C(j[_],1,1,()=>{j[_]=null});let h=de(n[6].jat[n[1]][n[2]].movements),v=[];for(let _=0;_<h.length;_+=1)v[_]=nt(Ye(n,h,_));const O=_=>C(v[_],1,1,()=>{v[_]=null});return s=new Ke({props:{data:n[12](n[6]),$$slots:{default:[Mn]},$$scope:{ctx:n}}}),c=new Ke({props:{data:n[8],$$slots:{default:[An]},$$scope:{ctx:n}}}),d=new Xt({props:{map:n[7]}}),{c(){U(e.$$.fragment),t=J(),M&&M.c(),o=J(),U(r.$$.fragment),i=J();for(let _=0;_<j.length;_+=1)j[_].c();l=J();for(let _=0;_<v.length;_+=1)v[_].c();a=J(),U(s.$$.fragment),f=J(),U(c.$$.fragment),m=J(),U(d.$$.fragment)},l(_){q(e.$$.fragment,_),t=D(_),M&&M.l(_),o=D(_),q(r.$$.fragment,_),i=D(_);for(let $=0;$<j.length;$+=1)j[$].l(_);l=D(_);for(let $=0;$<v.length;$+=1)v[$].l(_);a=D(_),q(s.$$.fragment,_),f=D(_),q(c.$$.fragment,_),m=D(_),q(d.$$.fragment,_)},m(_,$){B(e,_,$),b(_,t,$),M&&M.m(_,$),b(_,o,$),B(r,_,$),b(_,i,$);for(let p=0;p<j.length;p+=1)j[p]&&j[p].m(_,$);b(_,l,$);for(let p=0;p<v.length;p+=1)v[p]&&v[p].m(_,$);b(_,a,$),B(s,_,$),b(_,f,$),B(c,_,$),b(_,m,$),B(d,_,$),w=!0},p(_,$){_[0].mode!="editing"?M?(M.p(_,$),$[0]&1&&y(M,1)):(M=et(_),M.c(),y(M,1),M.m(o.parentNode,o)):M&&(_e(),C(M,1,1,()=>{M=null}),ge());const p={};if($[0]&8&&(p.show=_[3]),r.$set(p),$[0]&86){E=de(_[6].jat[_[1]][_[2]].arms);let I;for(I=0;I<E.length;I+=1){const A=xe(_,E,I);j[I]?(j[I].p(A,$),y(j[I],1)):(j[I]=tt(A),j[I].c(),y(j[I],1),j[I].m(l.parentNode,l))}for(_e(),I=E.length;I<j.length;I+=1)S(I);ge()}if($[0]&598){h=de(_[6].jat[_[1]][_[2]].movements);let I;for(I=0;I<h.length;I+=1){const A=Ye(_,h,I);v[I]?(v[I].p(A,$),y(v[I],1)):(v[I]=nt(A),v[I].c(),y(v[I],1),v[I].m(a.parentNode,a))}for(_e(),I=h.length;I<v.length;I+=1)O(I);ge()}const T={};$[0]&64&&(T.data=_[12](_[6])),$[1]&1024&&(T.$$scope={dirty:$,ctx:_}),s.$set(T);const V={};$[0]&256&&(V.data=_[8]),$[1]&1024&&(V.$$scope={dirty:$,ctx:_}),c.$set(V);const L={};$[0]&128&&(L.map=_[7]),d.$set(L)},i(_){if(!w){y(e.$$.fragment,_),y(M),y(r.$$.fragment,_);for(let $=0;$<E.length;$+=1)y(j[$]);for(let $=0;$<h.length;$+=1)y(v[$]);y(s.$$.fragment,_),y(c.$$.fragment,_),y(d.$$.fragment,_),w=!0}},o(_){C(e.$$.fragment,_),C(M),C(r.$$.fragment,_),j=j.filter(Boolean);for(let $=0;$<j.length;$+=1)C(j[$]);v=v.filter(Boolean);for(let $=0;$<v.length;$+=1)C(v[$]);C(s.$$.fragment,_),C(c.$$.fragment,_),C(d.$$.fragment,_),w=!1},d(_){_&&(g(t),g(o),g(i),g(l),g(a),g(f),g(m)),F(e,_),M&&M.d(_),F(r,_),ve(j,_),ve(v,_),F(s,_),F(c,_),F(d,_)}}}function Nn(n){let e,t,o;function r(l){n[31](l)}let i={$$slots:{default:[In]},$$scope:{ctx:n}};return n[7]!==void 0&&(i.map=n[7]),e=new zt({props:i}),le.push(()=>fe(e,"map",r)),{c(){U(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){B(e,l,a),o=!0},p(l,a){const s={};a[0]&511|a[1]&1024&&(s.$$scope={dirty:a,ctx:l}),!t&&a[0]&128&&(t=!0,s.map=l[7],se(()=>t=!1)),e.$set(s)},i(l){o||(y(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){F(e,l)}}}function ot(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function On(n){return String.fromCharCode(n+65)}function Pn(n,e,t){let o,r;Oe(n,oe,u=>t(6,r=u));let{junctionIdx:i}=e,{stage:l}=e,{mode:a}=e,{hoveringSidebar:s}=e,{streetviewOn:f}=e,{showRoute:c}=e,{select:m}=e,{stopEditing:d}=e,w,M={0:he.red.background,1:he.amber.background,2:he.green.background,X:he.critical.background};function E(u,k,ne){let ie={type:"FeatureCollection",features:[]},K=k.mode=="editing"?k.id:ne;return K!=null&&(K.kind=="arm"?ie.features.push(ot(u.jat[i][l].arms[K.idx],K.idx)):ie.features.push(v(u.jat[i][l].movements[K.idx],K.idx))),ie}async function j(u){if(!f){for(let k of w.queryRenderedFeatures(u.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await d();return}a.mode=="new-arm"?(Ce(oe,r.jat[i][l].arms=[...r.jat[i][l].arms,{point:u.detail.lngLat.toArray(),name:""}],r),await m({kind:"arm",idx:r.jat[i][l].arms.length-1})):(Ce(oe,r.jat[i][l].movements=[...r.jat[i][l].movements,{point1:u.detail.lngLat.toArray(),point2:Me(u.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Me(u.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],r),await m({kind:"movement",idx:r.jat[i][l].movements.length-1}))}}}async function S(u){await m({kind:"movement",idx:u.detail.features[0].id})}Pt(()=>{_(!1)});function h(u){let k={type:"FeatureCollection",features:u.jat[i][l].movements.map((ne,ie)=>v(ne,ie))};for(let ne of u.jat[i][l].movements)if(k.features.push(O(ne,k.features.length)),ne.kind=="walking & wheeling"){let ie={...ne,point1:ne.point3,point3:ne.point1};k.features.push(O(ie,k.features.length))}return k}function v(u,k){return{type:"Feature",id:k,properties:{name:u.name,kind:u.kind,color:M[u.score]},geometry:{type:"LineString",coordinates:[u.point1,u.point2,u.point3]}}}function O(u,k){return{type:"Feature",id:k,properties:{kind:u.kind,color:M[u.score],angle:je(u.point2,u.point3)},geometry:{type:"Point",coordinates:u.point3}}}function _(u){let k=h(r);for(let ne of r.jat[i][l].arms)k.features.push(ot(ne,k.features.length));for(let ne of r.summary.networkMap.features)k.features.push(ne);k.features.length>0&&w.fitBounds(Gt(k),{padding:20,animate:u})}function $(){return w}const p=()=>t(0,a={mode:"new-arm"}),T=()=>t(0,a={mode:"new-movement"});function V(u,k){n.$$.not_equal(k.point,u)&&(k.point=u,oe.set(r))}const L=u=>m({kind:"arm",idx:u}),I=u=>m({kind:"arm",idx:u});function A(u,k){n.$$.not_equal(k.point1,u)&&(k.point1=u,oe.set(r))}const te=u=>m({kind:"movement",idx:u}),ce=u=>m({kind:"movement",idx:u});function x(u,k){n.$$.not_equal(k.point2,u)&&(k.point2=u,oe.set(r))}const G=u=>m({kind:"movement",idx:u}),z=u=>m({kind:"movement",idx:u});function Y(u,k){n.$$.not_equal(k.point3,u)&&(k.point3=u,oe.set(r))}const Q=u=>m({kind:"movement",idx:u}),me=u=>m({kind:"movement",idx:u});function N(u){w=u,t(7,w)}return n.$$set=u=>{"junctionIdx"in u&&t(1,i=u.junctionIdx),"stage"in u&&t(2,l=u.stage),"mode"in u&&t(0,a=u.mode),"hoveringSidebar"in u&&t(13,s=u.hoveringSidebar),"streetviewOn"in u&&t(14,f=u.streetviewOn),"showRoute"in u&&t(3,c=u.showRoute),"select"in u&&t(4,m=u.select),"stopEditing"in u&&t(5,d=u.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&8257&&t(8,o=E(r,a,s))},[a,i,l,c,m,d,r,w,o,M,j,S,h,s,f,_,$,p,T,V,L,I,A,te,ce,x,G,z,Y,Q,me,N]}class Jn extends Le{constructor(e){super(),Se(this,e,Pn,Nn,we,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showRoute:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}const pe={"Any type of junction":{otherJunctionTypeWhichApplies:"","All movements":{scoreZero:["Cycle movement in potential conflict with heavy motor traffic flow.","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movement crosses wide junction entry or exit: e.g. with merge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOne:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwo:["Low traffic speed and volume in mixed traffic environment (e.g. access-only streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation."]}},"Simple priority T-junction":{otherJunctionTypeWhichApplies:"","Right turn from minor arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with cycle movement, with no physical refuge in the centre of the major road (including ghost island junction)."],scoreOne:["Central refuge allowing two-stage cycle movement crossing one traffic lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm with dedicated cycle signals or cycle priority."]},"Left turn from major arm":{scoreZero:[],scoreOne:["Side road entry treatment (table across minor arm)."],scoreTwo:["Continuous footway and cycle track across minor arm."]},"Right turn from major arm":{scoreZero:["Heavy traffic movements and/or high bus and HGV flows in potential conflict with no physical refuge in the centre of major road (including ghost island junction)."],scoreOne:["Protected turning refuge allowing two stage cycle movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]},"Ahead on major arm, crossing minor arm":{scoreZero:["Congested conditions causing poor visibility for right-turning motor vehicles from major arm.","Junction corner radius ≥9m, including where off-carriageway cycle track crosses minor arm."],scoreOne:["Junction free from queueing traffic and cycle lane on major arm meeting desirable minimum width requirements.","Junction corner radius <9m, including where off-carriageway cycle track crosses minor arm without priority.","Side road entry treatment (table across minor arm)."],scoreTwo:["Off-carriageway cycle track or stepped cycle track alongside major arm, crossing minor arm with priority over turning traffic."]}},Crossroads:{otherJunctionTypeWhichApplies:"Simple priority T-junction","Ahead from minor arm":{scoreZero:["Heavy opposing traffic movements with no physical refuge (including ghost island junction)."],scoreOne:["Protected pocket refuge for ahead cycles allowing two stage movement, crossing one lane at a time."],scoreTwo:["Cycle movement made via crossing of major arm via dedicated cycle signals or cycle priority."]}},"Traffic Signals":{otherJunctionTypeWhichApplies:"","All movements":{scoreZero:["Single or multiple queuing lanes with no cycle lanes or tracks on approaches.","Junctions with unsignalised left turn merge/diverge and signalised ahead lanes."],scoreOne:["Advance Cycle Stop lines, at least 5m deep and where the signals on the approach are on green for <30% of the cycle time.","Signal timings adjusted to provide extended intergreen to suit cycle movement under consideration.","Cycle/pedestrian scramble (toucan crossings with all-red stage).","Early release for cycles, with enough time to clear junction for cycle movement being considered."],scoreTwo:["Cycle movement has no potential conflict with motor traffic, e.g. dedicated cycle stage, conflicting traffic movement held or banned."]},"Right turn":{scoreZero:[],scoreOne:["Two-stage right turn via ASL or marked area in front of stop line."],scoreTwo:["Two-stage right turn with physically protected waiting area."]}},Roundabout:{otherJunctionTypeWhichApplies:"","All movements":{scoreZero:["Any type of roundabout with high traffic throughput.","Normal roundabout with multi-lane flared approaches.","Any type of roundabout with annular cycle lane marked on the circulatory carriageway."],scoreOne:["Compact roundabout or raised mini roundabout with no more than moderate traffic throughput","Off-carriageway cycle track with crossings of entries and exits without cycle priority, crossing single traffic lanes with traffic flows < 4000 vehicles per day or 400 HGV/bus flow. "],scoreTwo:["Off-carriageway cycle track with crossings of entries and exits with signals or cycle priority."]}}};function rt(n,e,t){const o=n.slice();return o[12]=e[t],o}function lt(n,e,t){const o=n.slice();return o[12]=e[t],o}function it(n,e,t){const o=n.slice();return o[12]=e[t],o}function Dn(n){let e;return{c(){e=R("Display guidance")},l(t){e=H(t,"Display guidance")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function at(n){let e,t,o;function r(l){n[8](l)}let i={label:"What type of movement do you need guidance for",choices:qe(n[1])};return n[2]!==void 0&&(i.value=n[2]),e=new Ne({props:i}),le.push(()=>fe(e,"value",r)),{c(){U(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){B(e,l,a),o=!0},p(l,a){const s={};a&2&&(s.choices=qe(l[1])),!t&&a&4&&(t=!0,s.value=l[2],se(()=>t=!1)),e.$set(s)},i(l){o||(y(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){F(e,l)}}}function st(n){let e,t=`${n[0]}: ${n[2]}`,o,r,i,l,a=`<th class="score-zero-header svelte-1i1c8i5">Score = 0
          <br/>
          Suitable only for confident existing cyclists, and may be avoided by some
          experienced cyclists Conditions are most likely to give rise to the most
          common collision types</th> <th class="score-one-header svelte-1i1c8i5">Score = 1
          <br/>
          Likely to be more acceptable to most cyclists, but may still pose problems
          for less confident or new cyclists The risk of collisions has been reduced
          by design layout or traffic management interventions</th> <th class="has-hover score-two-header svelte-1i1c8i5">Score = 2
          <br/>
          Suitable for all potential and existing cyclists The potential for collisions
          has been removed, or managed to a high standard of safety for cyclists</th>`,s,f,c,m,d,w,M,E,j,S,h=de(n[4].scoreZero),v=[];for(let T=0;T<h.length;T+=1)v[T]=ft(it(n,h,T));let O=de(n[4].scoreOne),_=[];for(let T=0;T<O.length;T+=1)_[T]=ut(lt(n,O,T));let $=de(n[4].scoreTwo),p=[];for(let T=0;T<$.length;T+=1)p[T]=ct(rt(n,$,T));return{c(){e=Z("h3"),o=R(t),r=J(),i=Z("table"),l=Z("tr"),l.innerHTML=a,s=J(),f=Z("tr"),c=Z("td"),m=Z("ul");for(let T=0;T<v.length;T+=1)v[T].c();d=J(),w=Z("td"),M=Z("ul");for(let T=0;T<_.length;T+=1)_[T].c();E=J(),j=Z("td"),S=Z("ul");for(let T=0;T<p.length;T+=1)p[T].c();this.h()},l(T){e=W(T,"H3",{});var V=X(e);o=H(V,t),V.forEach(g),r=D(T),i=W(T,"TABLE",{});var L=X(i);l=W(L,"TR",{"data-svelte-h":!0}),Te(l)!=="svelte-o7re77"&&(l.innerHTML=a),s=D(L),f=W(L,"TR",{});var I=X(f);c=W(I,"TD",{class:!0});var A=X(c);m=W(A,"UL",{});var te=X(m);for(let Y=0;Y<v.length;Y+=1)v[Y].l(te);te.forEach(g),A.forEach(g),d=D(I),w=W(I,"TD",{class:!0});var ce=X(w);M=W(ce,"UL",{});var x=X(M);for(let Y=0;Y<_.length;Y+=1)_[Y].l(x);x.forEach(g),ce.forEach(g),E=D(I),j=W(I,"TD",{class:!0});var G=X(j);S=W(G,"UL",{});var z=X(S);for(let Y=0;Y<p.length;Y+=1)p[Y].l(z);z.forEach(g),G.forEach(g),I.forEach(g),L.forEach(g),this.h()},h(){re(c,"class","score-zero svelte-1i1c8i5"),re(w,"class","score-one svelte-1i1c8i5"),re(j,"class","score-two svelte-1i1c8i5")},m(T,V){b(T,e,V),P(e,o),b(T,r,V),b(T,i,V),P(i,l),P(i,s),P(i,f),P(f,c),P(c,m);for(let L=0;L<v.length;L+=1)v[L]&&v[L].m(m,null);P(f,d),P(f,w),P(w,M);for(let L=0;L<_.length;L+=1)_[L]&&_[L].m(M,null);P(f,E),P(f,j),P(j,S);for(let L=0;L<p.length;L+=1)p[L]&&p[L].m(S,null)},p(T,V){if(V&5&&t!==(t=`${T[0]}: ${T[2]}`)&&ae(o,t),V&16){h=de(T[4].scoreZero);let L;for(L=0;L<h.length;L+=1){const I=it(T,h,L);v[L]?v[L].p(I,V):(v[L]=ft(I),v[L].c(),v[L].m(m,null))}for(;L<v.length;L+=1)v[L].d(1);v.length=h.length}if(V&16){O=de(T[4].scoreOne);let L;for(L=0;L<O.length;L+=1){const I=lt(T,O,L);_[L]?_[L].p(I,V):(_[L]=ut(I),_[L].c(),_[L].m(M,null))}for(;L<_.length;L+=1)_[L].d(1);_.length=O.length}if(V&16){$=de(T[4].scoreTwo);let L;for(L=0;L<$.length;L+=1){const I=rt(T,$,L);p[L]?p[L].p(I,V):(p[L]=ct(I),p[L].c(),p[L].m(S,null))}for(;L<p.length;L+=1)p[L].d(1);p.length=$.length}},d(T){T&&(g(e),g(r),g(i)),ve(v,T),ve(_,T),ve(p,T)}}}function ft(n){let e,t=n[12]+"",o;return{c(){e=Z("li"),o=R(t)},l(r){e=W(r,"LI",{});var i=X(e);o=H(i,t),i.forEach(g)},m(r,i){b(r,e,i),P(e,o)},p(r,i){i&16&&t!==(t=r[12]+"")&&ae(o,t)},d(r){r&&g(e)}}}function ut(n){let e,t=n[12]+"",o;return{c(){e=Z("li"),o=R(t)},l(r){e=W(r,"LI",{});var i=X(e);o=H(i,t),i.forEach(g)},m(r,i){b(r,e,i),P(e,o)},p(r,i){i&16&&t!==(t=r[12]+"")&&ae(o,t)},d(r){r&&g(e)}}}function ct(n){let e,t=n[12]+"",o;return{c(){e=Z("li"),o=R(t)},l(r){e=W(r,"LI",{});var i=X(e);o=H(i,t),i.forEach(g)},m(r,i){b(r,e,i),P(e,o)},p(r,i){i&16&&t!==(t=r[12]+"")&&ae(o,t)},d(r){r&&g(e)}}}function Un(n){let e,t,o,r,i,l;function a(m){n[7](m)}let s={label:"What type of junction do you need guidance for",choices:qe(n[5])};n[0]!==void 0&&(s.value=n[0]),e=new Ne({props:s}),le.push(()=>fe(e,"value",a));let f=n[1].length>1&&at(n),c=n[4]&&st(n);return{c(){U(e.$$.fragment),o=J(),f&&f.c(),r=J(),c&&c.c(),i=ue()},l(m){q(e.$$.fragment,m),o=D(m),f&&f.l(m),r=D(m),c&&c.l(m),i=ue()},m(m,d){B(e,m,d),b(m,o,d),f&&f.m(m,d),b(m,r,d),c&&c.m(m,d),b(m,i,d),l=!0},p(m,d){const w={};!t&&d&1&&(t=!0,w.value=m[0],se(()=>t=!1)),e.$set(w),m[1].length>1?f?(f.p(m,d),d&2&&y(f,1)):(f=at(m),f.c(),y(f,1),f.m(r.parentNode,r)):f&&(_e(),C(f,1,1,()=>{f=null}),ge()),m[4]?c?c.p(m,d):(c=st(m),c.c(),c.m(i.parentNode,i)):c&&(c.d(1),c=null)},i(m){l||(y(e.$$.fragment,m),y(f),l=!0)},o(m){C(e.$$.fragment,m),C(f),l=!1},d(m){m&&(g(o),g(r),g(i)),F(e,m),f&&f.d(m),c&&c.d(m)}}}function qn(n){let e,t,o,r,i,l;t=new be({props:{$$slots:{default:[Dn]},$$scope:{ctx:n}}}),t.$on("click",n[6]);function a(f){n[9](f)}let s={title:"Guidance",viewWidth:80,$$slots:{default:[Un]},$$scope:{ctx:n}};return n[3]!==void 0&&(s.open=n[3]),r=new on({props:s}),le.push(()=>fe(r,"open",a)),{c(){e=Z("div"),U(t.$$.fragment),o=J(),U(r.$$.fragment)},l(f){e=W(f,"DIV",{});var c=X(e);q(t.$$.fragment,c),c.forEach(g),o=D(f),q(r.$$.fragment,f)},m(f,c){b(f,e,c),B(t,e,null),b(f,o,c),B(r,f,c),l=!0},p(f,[c]){const m={};c&524288&&(m.$$scope={dirty:c,ctx:f}),t.$set(m);const d={};c&524311&&(d.$$scope={dirty:c,ctx:f}),!i&&c&8&&(i=!0,d.open=f[3],se(()=>i=!1)),r.$set(d)},i(f){l||(y(t.$$.fragment,f),y(r.$$.fragment,f),l=!0)},o(f){C(t.$$.fragment,f),C(r.$$.fragment,f),l=!1},d(f){f&&(g(e),g(o)),F(t),F(r,f)}}}function Bn(n,e,t){let o,r=Object.keys(pe),i=r[0],l=[],a="";function s(E){let j=Object.keys(pe[E]).filter(h=>h!=="summary"&&h!=="otherJunctionTypeWhichApplies"),S=pe[E].otherJunctionTypeWhichApplies;return S&&(j=j.concat(Object.keys(pe[S]).filter(h=>h!=="summary"&&h!=="otherJunctionTypeWhichApplies"))),j}function f(E,j){l.includes(j)||(t(2,a=l[0]),j=l[0]);let S=pe[E][j],h=pe[E].otherJunctionTypeWhichApplies;!S&&pe[h]&&(S=pe[h][j]);let v=JSON.parse(JSON.stringify(pe["Any type of junction"]["All movements"]));if(E==="Any type of junction"&&j==="All movements")return v;if(pe[E]["All movements"]){let O=pe[E]["All movements"];v.scoreZero=v.scoreZero.concat(O.scoreZero),v.scoreOne=v.scoreOne.concat(O.scoreOne),v.scoreTwo=v.scoreTwo.concat(O.scoreTwo)}return S&&(v.scoreZero=v.scoreZero.concat(S.scoreZero),v.scoreOne=v.scoreOne.concat(S.scoreOne),v.scoreTwo=v.scoreTwo.concat(S.scoreTwo)),v}let c=!1;function m(){t(3,c=!0)}function d(E){i=E,t(0,i)}function w(E){a=E,t(2,a),t(0,i),t(1,l)}function M(E){c=E,t(3,c)}return n.$$.update=()=>{n.$$.dirty&3&&(t(1,l=s(i)),l.length===1&&t(2,a=l[0])),n.$$.dirty&5&&t(4,o=f(i,a))},[i,l,a,c,o,r,m,d,w,M]}class Fn extends Le{constructor(e){super(),Se(this,e,Bn,qn,we,{})}}function Rn(n){let e,t,o,r,i,l,a,s,f,c,m,d,w,M;function E(p){n[5](p)}let j={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(j.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new ze({props:j}),le.push(()=>fe(e,"value",E));function S(p){n[6](p)}let h={label:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(h.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),r=new Ne({props:h}),le.push(()=>fe(r,"value",S));function v(p){n[7](p)}let O={label:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(O.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),a=new Ne({props:O}),le.push(()=>fe(a,"value",v)),c=new Fn({});function _(p){n[8](p)}let $={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&($.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),d=new Mt({props:$}),le.push(()=>fe(d,"value",_)),{c(){U(e.$$.fragment),o=J(),U(r.$$.fragment),l=J(),U(a.$$.fragment),f=J(),U(c.$$.fragment),m=J(),U(d.$$.fragment)},l(p){q(e.$$.fragment,p),o=D(p),q(r.$$.fragment,p),l=D(p),q(a.$$.fragment,p),f=D(p),q(c.$$.fragment,p),m=D(p),q(d.$$.fragment,p)},m(p,T){B(e,p,T),b(p,o,T),B(r,p,T),b(p,l,T),B(a,p,T),b(p,f,T),B(c,p,T),b(p,m,T),B(d,p,T),M=!0},p(p,[T]){const V={};!t&&T&15&&(t=!0,V.value=p[3].jat[p[0]][p[1]].movements[p[2]].name,se(()=>t=!1)),e.$set(V);const L={};!i&&T&15&&(i=!0,L.value=p[3].jat[p[0]][p[1]].movements[p[2]].kind,se(()=>i=!1)),r.$set(L);const I={};!s&&T&15&&(s=!0,I.value=p[3].jat[p[0]][p[1]].movements[p[2]].score,se(()=>s=!1)),a.$set(I);const A={};!w&&T&15&&(w=!0,A.value=p[3].jat[p[0]][p[1]].movements[p[2]].notes,se(()=>w=!1)),d.$set(A)},i(p){M||(y(e.$$.fragment,p),y(r.$$.fragment,p),y(a.$$.fragment,p),y(c.$$.fragment,p),y(d.$$.fragment,p),M=!0)},o(p){C(e.$$.fragment,p),C(r.$$.fragment,p),C(a.$$.fragment,p),C(c.$$.fragment,p),C(d.$$.fragment,p),M=!1},d(p){p&&(g(o),g(l),g(f),g(m)),F(e,p),F(r,p),F(a,p),F(c,p),F(d,p)}}}function Hn(n,e,t){let o;Oe(n,oe,d=>t(3,o=d));let{junctionIdx:r}=e,{stage:i}=e,{idx:l}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(d){n.$$.not_equal(o.jat[r][i].movements[l].name,d)&&(o.jat[r][i].movements[l].name=d,oe.set(o))}function f(d){n.$$.not_equal(o.jat[r][i].movements[l].kind,d)&&(o.jat[r][i].movements[l].kind=d,oe.set(o))}function c(d){n.$$.not_equal(o.jat[r][i].movements[l].score,d)&&(o.jat[r][i].movements[l].score=d,oe.set(o))}function m(d){n.$$.not_equal(o.jat[r][i].movements[l].notes,d)&&(o.jat[r][i].movements[l].notes=d,oe.set(o))}return n.$$set=d=>{"junctionIdx"in d&&t(0,r=d.junctionIdx),"stage"in d&&t(1,i=d.stage),"idx"in d&&t(2,l=d.idx)},[r,i,l,o,a,s,f,c,m]}class zn extends Le{constructor(e){super(),Se(this,e,Hn,Rn,we,{junctionIdx:0,stage:1,idx:2})}}function $e(n){if(n.movements.length==0)return"No movements added";let e=0,t=0;for(let r of n.movements)e+={0:0,1:1,2:2,X:0}[r.score],t+=2;let o=e/t*100;return`${Math.round(o)}%`}var Gn=Object.defineProperty,Zn=(n,e)=>Gn(n,"name",{value:e,configurable:!0});function Ot(n,e={}){const t=Wt(n),o=(t[0]+t[2])/2,r=(t[1]+t[3])/2;return St([o,r],e.properties,e)}Zn(Ot,"center");var Wn=Ot;function Vn(n){let e=Wn({type:"FeatureCollection",features:n.map(o=>({type:"Feature",geometry:{type:"Point",coordinates:o.point},properties:{}}))}).geometry.coordinates;n.sort((o,r)=>mt(je(e,r.point))-mt(je(e,o.point)));let t=[];for(let o=0;o<n.length;o++){let r=n[o],i=je(r.point,e),l=1;for(let a of Kn(o,n.length)){let s=n[a],f=je(e,s.point),c=Xn(r.point,e,l++),m=Vt(r.point,e),d=Me(c,.5*m,i).geometry.coordinates,w=Me(d,.2*m,f).geometry.coordinates;t.push({point1:c,point2:d,point3:w,kind:"cycling",score:"X",name:`${r.name} to ${s.name}`,notes:""})}}return t}function Xn(n,e,t){let o=.003,i=je(n,e)-90,l=o*t;return Me(n,l,i).geometry.coordinates}function mt(n){return(n+360)%360}function Kn(n,e){let t=[];for(let o=n+1;o<e;o++)t.push(o);for(let o=0;o<n;o++)t.push(o);return t}const{window:Qn}=Bt;function dt(n,e,t){const o=n.slice();o[34]=e[t],o[37]=t;const r=o[16][o[34].score];return o[35]=r,o}function _t(n,e,t){const o=n.slice();return o[38]=e[t],o[37]=t,o}function Yn(n){let e,t,o,r,i,l,a,s;e=new He({props:{$$slots:{default:[eo]},$$scope:{ctx:n}}}),e.$on("click",n[11]),o=new Ge({props:{$$slots:{default:[to]},$$scope:{ctx:n}}}),o.$on("click",n[12]);const f=[oo,no],c=[];function m(d,w){return d[2].id.kind=="movement"?0:1}return i=m(n),l=c[i]=f[i](n),{c(){U(e.$$.fragment),t=J(),U(o.$$.fragment),r=J(),l.c(),a=ue()},l(d){q(e.$$.fragment,d),t=D(d),q(o.$$.fragment,d),r=D(d),l.l(d),a=ue()},m(d,w){B(e,d,w),b(d,t,w),B(o,d,w),b(d,r,w),c[i].m(d,w),b(d,a,w),s=!0},p(d,w){const M={};w[1]&2&&(M.$$scope={dirty:w,ctx:d}),e.$set(M);const E={};w[1]&2&&(E.$$scope={dirty:w,ctx:d}),o.$set(E);let j=i;i=m(d),i===j?c[i].p(d,w):(_e(),C(c[j],1,1,()=>{c[j]=null}),ge(),l=c[i],l?l.p(d,w):(l=c[i]=f[i](d),l.c()),y(l,1),l.m(a.parentNode,a))},i(d){s||(y(e.$$.fragment,d),y(o.$$.fragment,d),y(l),s=!0)},o(d){C(e.$$.fragment,d),C(o.$$.fragment,d),C(l),s=!1},d(d){d&&(g(t),g(r),g(a)),F(e,d),F(o,d),c[i].d(d)}}}function xn(n){let e,t,o,r,i="Arms",l,a,s,f,c="Movements",m,d,w,M,E,j,S=(n[8].jat[n[0]].name||"Untitled junction")+"",h,v,O=$e(n[8].jat[n[0]][n[1]])+"",_,$,p,T,V,L,I;const A=n[18].default,te=yt(A,n,n[32],null);t=new qt({props:{label:"Tools",$$slots:{default:[so]},$$scope:{ctx:n}}});let ce=de(n[8].jat[n[0]][n[1]].arms),x=[];for(let u=0;u<ce.length;u+=1)x[u]=gt(_t(n,ce,u));const G=u=>C(x[u],1,1,()=>{x[u]=null});let z=n[8].jat[n[0]][n[9]].arms.length>0&&pt(n);p=new be({props:{disabled:n[8].jat[n[0]][n[1]].arms.length<2,$$slots:{default:[uo]},$$scope:{ctx:n}}}),p.$on("click",n[17]);let Y=de(n[8].jat[n[0]][n[1]].movements),Q=[];for(let u=0;u<Y.length;u+=1)Q[u]=$t(dt(n,Y,u));const me=u=>C(Q[u],1,1,()=>{Q[u]=null});let N=n[8].jat[n[0]][n[9]].movements.length>0&&ht(n);return{c(){te&&te.c(),e=J(),U(t.$$.fragment),o=J(),r=Z("h3"),r.textContent=i,l=J();for(let u=0;u<x.length;u+=1)x[u].c();a=J(),z&&z.c(),s=J(),f=Z("h3"),f.textContent=c,m=J(),d=Z("p"),w=R("Total JAT score for "),M=R(n[1]),E=J(),j=Z("u"),h=R(S),v=R(`
        : `),_=R(O),$=J(),U(p.$$.fragment),T=J();for(let u=0;u<Q.length;u+=1)Q[u].c();V=J(),N&&N.c(),L=ue()},l(u){te&&te.l(u),e=D(u),q(t.$$.fragment,u),o=D(u),r=W(u,"H3",{"data-svelte-h":!0}),Te(r)!=="svelte-ld74qb"&&(r.textContent=i),l=D(u);for(let ie=0;ie<x.length;ie+=1)x[ie].l(u);a=D(u),z&&z.l(u),s=D(u),f=W(u,"H3",{"data-svelte-h":!0}),Te(f)!=="svelte-1dc52s8"&&(f.textContent=c),m=D(u),d=W(u,"P",{});var k=X(d);w=H(k,"Total JAT score for "),M=H(k,n[1]),E=D(k),j=W(k,"U",{});var ne=X(j);h=H(ne,S),ne.forEach(g),v=H(k,`
        : `),_=H(k,O),k.forEach(g),$=D(u),q(p.$$.fragment,u),T=D(u);for(let ie=0;ie<Q.length;ie+=1)Q[ie].l(u);V=D(u),N&&N.l(u),L=ue()},m(u,k){te&&te.m(u,k),b(u,e,k),B(t,u,k),b(u,o,k),b(u,r,k),b(u,l,k);for(let ne=0;ne<x.length;ne+=1)x[ne]&&x[ne].m(u,k);b(u,a,k),z&&z.m(u,k),b(u,s,k),b(u,f,k),b(u,m,k),b(u,d,k),P(d,w),P(d,M),P(d,E),P(d,j),P(j,h),P(d,v),P(d,_),b(u,$,k),B(p,u,k),b(u,T,k);for(let ne=0;ne<Q.length;ne+=1)Q[ne]&&Q[ne].m(u,k);b(u,V,k),N&&N.m(u,k),b(u,L,k),I=!0},p(u,k){te&&te.p&&(!I||k[1]&2)&&jt(te,A,u,u[32],I?Tt(A,u[32],k,null):Ct(u[32]),null);const ne={};if(k[0]&112|k[1]&2&&(ne.$$scope={dirty:k,ctx:u}),t.$set(ne),k[0]&1291){ce=de(u[8].jat[u[0]][u[1]].arms);let K;for(K=0;K<ce.length;K+=1){const Ee=_t(u,ce,K);x[K]?(x[K].p(Ee,k),y(x[K],1)):(x[K]=gt(Ee),x[K].c(),y(x[K],1),x[K].m(a.parentNode,a))}for(_e(),K=ce.length;K<x.length;K+=1)G(K);ge()}u[8].jat[u[0]][u[9]].arms.length>0?z?(z.p(u,k),k[0]&257&&y(z,1)):(z=pt(u),z.c(),y(z,1),z.m(s.parentNode,s)):z&&(_e(),C(z,1,1,()=>{z=null}),ge()),(!I||k[0]&2)&&ae(M,u[1]),(!I||k[0]&257)&&S!==(S=(u[8].jat[u[0]].name||"Untitled junction")+"")&&ae(h,S),(!I||k[0]&259)&&O!==(O=$e(u[8].jat[u[0]][u[1]])+"")&&ae(_,O);const ie={};if(k[0]&259&&(ie.disabled=u[8].jat[u[0]][u[1]].arms.length<2),k[1]&2&&(ie.$$scope={dirty:k,ctx:u}),p.$set(ie),k[0]&66827){Y=de(u[8].jat[u[0]][u[1]].movements);let K;for(K=0;K<Y.length;K+=1){const Ee=dt(u,Y,K);Q[K]?(Q[K].p(Ee,k),y(Q[K],1)):(Q[K]=$t(Ee),Q[K].c(),y(Q[K],1),Q[K].m(V.parentNode,V))}for(_e(),K=Y.length;K<Q.length;K+=1)me(K);ge()}u[8].jat[u[0]][u[9]].movements.length>0?N?(N.p(u,k),k[0]&257&&y(N,1)):(N=ht(u),N.c(),y(N,1),N.m(L.parentNode,L)):N&&(_e(),C(N,1,1,()=>{N=null}),ge())},i(u){if(!I){y(te,u),y(t.$$.fragment,u);for(let k=0;k<ce.length;k+=1)y(x[k]);y(z),y(p.$$.fragment,u);for(let k=0;k<Y.length;k+=1)y(Q[k]);y(N),I=!0}},o(u){C(te,u),C(t.$$.fragment,u),x=x.filter(Boolean);for(let k=0;k<x.length;k+=1)C(x[k]);C(z),C(p.$$.fragment,u),Q=Q.filter(Boolean);for(let k=0;k<Q.length;k+=1)C(Q[k]);C(N),I=!1},d(u){u&&(g(e),g(o),g(r),g(l),g(a),g(s),g(f),g(m),g(d),g($),g(T),g(V),g(L)),te&&te.d(u),F(t,u),ve(x,u),z&&z.d(u),F(p,u),ve(Q,u),N&&N.d(u)}}}function eo(n){let e;return{c(){e=R("Save")},l(t){e=H(t,"Save")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function to(n){let e;return{c(){e=R("Delete")},l(t){e=H(t,"Delete")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function no(n){let e,t,o;function r(l){n[29](l)}let i={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(i.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new ze({props:i}),le.push(()=>fe(e,"value",r)),{c(){U(e.$$.fragment)},l(l){q(e.$$.fragment,l)},m(l,a){B(e,l,a),o=!0},p(l,a){const s={};!t&&a[0]&263&&(t=!0,s.value=l[8].jat[l[0]][l[1]].arms[l[2].id.idx].name,se(()=>t=!1)),e.$set(s)},i(l){o||(y(e.$$.fragment,l),o=!0)},o(l){C(e.$$.fragment,l),o=!1},d(l){F(e,l)}}}function oo(n){let e,t,o,r,i,l;return e=new zn({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),o=new He({props:{$$slots:{default:[ro]},$$scope:{ctx:n}}}),o.$on("click",n[11]),i=new Ge({props:{$$slots:{default:[lo]},$$scope:{ctx:n}}}),i.$on("click",n[12]),{c(){U(e.$$.fragment),t=J(),U(o.$$.fragment),r=J(),U(i.$$.fragment)},l(a){q(e.$$.fragment,a),t=D(a),q(o.$$.fragment,a),r=D(a),q(i.$$.fragment,a)},m(a,s){B(e,a,s),b(a,t,s),B(o,a,s),b(a,r,s),B(i,a,s),l=!0},p(a,s){const f={};s[0]&1&&(f.junctionIdx=a[0]),s[0]&2&&(f.stage=a[1]),s[0]&4&&(f.idx=a[2].id.idx),e.$set(f);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:a}),o.$set(c);const m={};s[1]&2&&(m.$$scope={dirty:s,ctx:a}),i.$set(m)},i(a){l||(y(e.$$.fragment,a),y(o.$$.fragment,a),y(i.$$.fragment,a),l=!0)},o(a){C(e.$$.fragment,a),C(o.$$.fragment,a),C(i.$$.fragment,a),l=!1},d(a){a&&(g(t),g(r)),F(e,a),F(o,a),F(i,a)}}}function ro(n){let e;return{c(){e=R("Save")},l(t){e=H(t,"Save")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function lo(n){let e;return{c(){e=R("Delete")},l(t){e=H(t,"Delete")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function io(n){let e;return{c(){e=R("Zoom to fit")},l(t){e=H(t,"Zoom to fit")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function ao(n){let e;return{c(){e=R("Show route")},l(t){e=H(t,"Show route")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function so(n){var S;let e,t,o,r,i,l,a,s,f,c,m,d;e=new be({props:{$$slots:{default:[io]},$$scope:{ctx:n}}}),e.$on("click",n[20]),o=new en({}),i=new Yt({});function w(h){n[21](h)}let M={map:(S=n[6])==null?void 0:S.getMap()};n[4]!==void 0&&(M.enabled=n[4]),a=new xt({props:M}),le.push(()=>fe(a,"enabled",w));function E(h){n[22](h)}let j={$$slots:{default:[ao]},$$scope:{ctx:n}};return n[5]!==void 0&&(j.checked=n[5]),c=new tn({props:j}),le.push(()=>fe(c,"checked",E)),{c(){U(e.$$.fragment),t=J(),U(o.$$.fragment),r=J(),U(i.$$.fragment),l=J(),U(a.$$.fragment),f=J(),U(c.$$.fragment)},l(h){q(e.$$.fragment,h),t=D(h),q(o.$$.fragment,h),r=D(h),q(i.$$.fragment,h),l=D(h),q(a.$$.fragment,h),f=D(h),q(c.$$.fragment,h)},m(h,v){B(e,h,v),b(h,t,v),B(o,h,v),b(h,r,v),B(i,h,v),b(h,l,v),B(a,h,v),b(h,f,v),B(c,h,v),d=!0},p(h,v){var p;const O={};v[1]&2&&(O.$$scope={dirty:v,ctx:h}),e.$set(O);const _={};v[0]&64&&(_.map=(p=h[6])==null?void 0:p.getMap()),!s&&v[0]&16&&(s=!0,_.enabled=h[4],se(()=>s=!1)),a.$set(_);const $={};v[1]&2&&($.$$scope={dirty:v,ctx:h}),!m&&v[0]&32&&(m=!0,$.checked=h[5],se(()=>m=!1)),c.$set($)},i(h){d||(y(e.$$.fragment,h),y(o.$$.fragment,h),y(i.$$.fragment,h),y(a.$$.fragment,h),y(c.$$.fragment,h),d=!0)},o(h){C(e.$$.fragment,h),C(o.$$.fragment,h),C(i.$$.fragment,h),C(a.$$.fragment,h),C(c.$$.fragment,h),d=!1},d(h){h&&(g(t),g(r),g(l),g(f)),F(e,h),F(o,h),F(i,h),F(a,h),F(c,h)}}}function gt(n){let e,t;function o(){return n[23](n[37])}function r(){return n[24](n[37])}return e=new Ze({props:{name:`${vt(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",o),e.$on("mouseenter",r),e.$on("mouseleave",n[25]),{c(){U(e.$$.fragment)},l(i){q(e.$$.fragment,i)},m(i,l){B(e,i,l),t=!0},p(i,l){n=i;const a={};l[0]&259&&(a.name=`${vt(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(a)},i(i){t||(y(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function pt(n){let e,t;return e=new be({props:{$$slots:{default:[fo]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r[1]&2&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function fo(n){let e,t;return{c(){e=R("Copy arms from "),t=R(n[9])},l(o){e=H(o,"Copy arms from "),t=H(o,n[9])},m(o,r){b(o,e,r),b(o,t,r)},p:Ae,d(o){o&&(g(e),g(t))}}}function uo(n){let e;return{c(){e=R("Generate cycling movements between all arms")},l(t){e=H(t,"Generate cycling movements between all arms")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function co(n){let e,t,o,r=n[34].score+"",i,l,a,s=Xe(n[34].kind)+"",f;return{c(){e=Z("div"),t=Z("span"),o=R("Score: "),i=R(r),l=J(),a=Z("span"),f=R(s),this.h()},l(c){e=W(c,"DIV",{style:!0});var m=X(e);t=W(m,"SPAN",{style:!0});var d=X(t);o=H(d,"Score: "),i=H(d,r),d.forEach(g),l=D(m),a=W(m,"SPAN",{});var w=X(a);f=H(w,s),w.forEach(g),m.forEach(g),this.h()},h(){ee(t,"padding","4px"),ee(t,"color",n[35].font),ee(t,"background-color",n[35].background),ee(e,"width","100%"),ee(e,"display","flex"),ee(e,"justify-content","space-between")},m(c,m){b(c,e,m),P(e,t),P(t,o),P(t,i),P(e,l),P(e,a),P(a,f)},p(c,m){m[0]&259&&r!==(r=c[34].score+"")&&ae(i,r),m[0]&259&&ee(t,"color",c[35].font),m[0]&259&&ee(t,"background-color",c[35].background),m[0]&259&&s!==(s=Xe(c[34].kind)+"")&&ae(f,s)},d(c){c&&g(e)}}}function $t(n){let e,t;function o(){return n[26](n[37])}function r(){return n[27](n[37])}return e=new Ze({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[co]},$$scope:{ctx:n}}}),e.$on("click",o),e.$on("mouseenter",r),e.$on("mouseleave",n[28]),{c(){U(e.$$.fragment)},l(i){q(e.$$.fragment,i)},m(i,l){B(e,i,l),t=!0},p(i,l){n=i;const a={};l[0]&259&&(a.name=n[34].name||"Unnamed movement"),l[0]&259|l[1]&2&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(i){t||(y(e.$$.fragment,i),t=!0)},o(i){C(e.$$.fragment,i),t=!1},d(i){F(e,i)}}}function ht(n){let e,t;return e=new be({props:{$$slots:{default:[mo]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r[1]&2&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function mo(n){let e,t;return{c(){e=R("Copy movements from "),t=R(n[9])},l(o){e=H(o,"Copy movements from "),t=H(o,n[9])},m(o,r){b(o,e,r),b(o,t,r)},p:Ae,d(o){o&&(g(e),g(t))}}}function _o(n){let e,t,o,r,i,l,a,s=$e(n[8].jat[n[0]].existing)+"",f,c,m,d=$e(n[8].jat[n[0]].proposed)+"",w,M,E,j,S,h,v,O,_,$,p,T,V;function L(G){n[19](G)}let I={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(I.value=n[8].jat[n[0]][n[1]].notes),t=new Mt({props:I}),le.push(()=>fe(t,"value",L));const A=[xn,Yn],te=[];function ce(G,z){return G[2].mode!="editing"?0:1}h=ce(n),v=te[h]=A[h](n);let x={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showRoute:n[5],select:n[10],stopEditing:n[11]};return $=new Jn({props:x}),n[31]($),{c(){e=Z("div"),U(t.$$.fragment),r=J(),i=Z("p"),l=R("Total JAT score: "),a=Z("b"),f=R(s),c=R(`
    existing,
    `),m=Z("b"),w=R(d),M=R(`
    proposed`),E=J(),j=Z("div"),S=Z("div"),v.c(),O=J(),_=Z("div"),U($.$$.fragment),this.h()},l(G){e=W(G,"DIV",{class:!0});var z=X(e);q(t.$$.fragment,z),r=D(z),i=W(z,"P",{});var Y=X(i);l=H(Y,"Total JAT score: "),a=W(Y,"B",{});var Q=X(a);f=H(Q,s),Q.forEach(g),c=H(Y,`
    existing,
    `),m=W(Y,"B",{});var me=X(m);w=H(me,d),me.forEach(g),M=H(Y,`
    proposed`),Y.forEach(g),z.forEach(g),E=D(G),j=W(G,"DIV",{style:!0});var N=X(j);S=W(N,"DIV",{style:!0});var u=X(S);v.l(u),u.forEach(g),O=D(N),_=W(N,"DIV",{style:!0});var k=X(_);q($.$$.fragment,k),k.forEach(g),N.forEach(g),this.h()},h(){re(e,"class","govuk-width-container"),ee(S,"width","30%"),ee(S,"overflow-y","scroll"),ee(S,"padding","10px"),ee(S,"border","1px solid black"),ee(_,"position","relative"),ee(_,"width","100%"),ee(j,"display","flex"),ee(j,"height","80vh")},m(G,z){b(G,e,z),B(t,e,null),P(e,r),P(e,i),P(i,l),P(i,a),P(a,f),P(i,c),P(i,m),P(m,w),P(i,M),b(G,E,z),b(G,j,z),P(j,S),te[h].m(S,null),n[30](S),P(j,O),P(j,_),B($,_,null),p=!0,T||(V=Dt(Qn,"keydown",n[13]),T=!0)},p(G,z){const Y={};z[0]&2&&(Y.label="Commentary / Notes about "+G[1]+" junction"),!o&&z[0]&259&&(o=!0,Y.value=G[8].jat[G[0]][G[1]].notes,se(()=>o=!1)),t.$set(Y),(!p||z[0]&257)&&s!==(s=$e(G[8].jat[G[0]].existing)+"")&&ae(f,s),(!p||z[0]&257)&&d!==(d=$e(G[8].jat[G[0]].proposed)+"")&&ae(w,d);let Q=h;h=ce(G),h===Q?te[h].p(G,z):(_e(),C(te[Q],1,1,()=>{te[Q]=null}),ge(),v=te[h],v?v.p(G,z):(v=te[h]=A[h](G),v.c()),y(v,1),v.m(S,null));const me={};z[0]&1&&(me.junctionIdx=G[0]),z[0]&2&&(me.stage=G[1]),z[0]&4&&(me.mode=G[2]),z[0]&8&&(me.hoveringSidebar=G[3]),z[0]&16&&(me.streetviewOn=G[4]),z[0]&32&&(me.showRoute=G[5]),$.$set(me)},i(G){p||(y(t.$$.fragment,G),y(v),y($.$$.fragment,G),p=!0)},o(G){C(t.$$.fragment,G),C(v),C($.$$.fragment,G),p=!1},d(G){G&&(g(e),g(E),g(j)),F(t),te[h].d(),n[30](null),n[31](null),F($),T=!1,V()}}}function vt(n){return String.fromCharCode(n+65)}function go(n,e,t){let o;Oe(n,oe,N=>t(8,o=N));let{$$slots:r={},$$scope:i}=e,{junctionIdx:l}=e,{stage:a}=e,s=a=="existing"?"proposed":"existing",f={mode:"select"},c=null,m=null,d=!1,w=!0,M=null,E;async function j(N){c=E.scrollTop,t(2,f={mode:"editing",id:N}),t(3,m=null),await Ve(),t(7,E.scrollTop=0,E)}async function S(){t(2,f={mode:"select"}),c!=null&&(await Ve(),t(7,E.scrollTop=c,E),c=null)}function h(){f.mode=="editing"&&window.confirm(`Delete this ${f.id.kind}?`)&&(f.id.kind=="movement"?(o.jat[l][a].movements.splice(f.id.idx,1),oe.set(o)):(o.jat[l][a].arms.splice(f.id.idx,1),oe.set(o)),S())}function v(N){if(f.mode!="editing")return;let u=N.target.tagName,k=u=="INPUT"||u=="TEXTAREA";N.key=="Escape"||N.key=="Enter"&&!k?(N.stopPropagation(),S()):N.key=="Delete"&&!k&&(N.stopPropagation(),h())}function O(){o.jat[l][a].arms.length>0&&!window.confirm("Overwrite arms?")||(Ce(oe,o.jat[l][a].arms=JSON.parse(JSON.stringify(o.jat[l][s].arms)),o),oe.set(o))}function _(){o.jat[l][a].movements.length>0&&!window.confirm("Overwrite movements?")||(Ce(oe,o.jat[l][a].movements=JSON.parse(JSON.stringify(o.jat[l][s].movements)),o),oe.set(o))}let $={0:he.red,1:he.amber,2:he.green,X:he.critical};function p(){o.jat[l][a].movements.length>0&&!window.confirm("Overwrite all movements?")||Ce(oe,o.jat[l][a].movements=Vn(o.jat[l][a].arms),o)}function T(N){n.$$.not_equal(o.jat[l][a].notes,N)&&(o.jat[l][a].notes=N,oe.set(o))}const V=()=>M==null?void 0:M.zoom(!0);function L(N){d=N,t(4,d)}function I(N){w=N,t(5,w)}const A=N=>j({kind:"arm",idx:N}),te=N=>t(3,m={kind:"arm",idx:N}),ce=()=>t(3,m=null),x=N=>j({kind:"movement",idx:N}),G=N=>t(3,m={kind:"movement",idx:N}),z=()=>t(3,m=null);function Y(N){n.$$.not_equal(o.jat[l][a].arms[f.id.idx].name,N)&&(o.jat[l][a].arms[f.id.idx].name=N,oe.set(o))}function Q(N){le[N?"unshift":"push"](()=>{E=N,t(7,E)})}function me(N){le[N?"unshift":"push"](()=>{M=N,t(6,M)})}return n.$$set=N=>{"junctionIdx"in N&&t(0,l=N.junctionIdx),"stage"in N&&t(1,a=N.stage),"$$scope"in N&&t(32,i=N.$$scope)},[l,a,f,m,d,w,M,E,o,s,j,S,h,v,O,_,$,p,r,T,V,L,I,A,te,ce,x,G,z,Y,Q,me,i]}class po extends Le{constructor(e){super(),Se(this,e,go,_o,we,{junctionIdx:0,stage:1},null,[-1,-1])}}function bt(n,e,t){const o=n.slice();return o[10]=e[t],o[12]=t,o}function $o(n){let e,t,o=(n[1].jat[n[0].idx].name||"Untitled junction")+"",r,i,l=n[0].stage+"",a,s,f,c,m,d,w,M=n[0].stage,E,j;f=new Ut({props:{$$slots:{default:[ko]},$$scope:{ctx:n}}});function S(O){n[7](O)}let h={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(h.value=n[1].jat[n[0].idx].name),m=new ze({props:h}),le.push(()=>fe(m,"value",S));let v=kt(n);return{c(){e=Z("div"),t=Z("h2"),r=R(o),i=R(" - "),a=R(l),s=J(),U(f.$$.fragment),c=J(),U(m.$$.fragment),w=J(),v.c(),E=ue(),this.h()},l(O){e=W(O,"DIV",{class:!0});var _=X(e);t=W(_,"H2",{});var $=X(t);r=H($,o),i=H($," - "),a=H($,l),$.forEach(g),s=D(_),q(f.$$.fragment,_),c=D(_),q(m.$$.fragment,_),_.forEach(g),w=D(O),v.l(O),E=ue(),this.h()},h(){re(e,"class","govuk-width-container")},m(O,_){b(O,e,_),P(e,t),P(t,r),P(t,i),P(t,a),P(e,s),B(f,e,null),P(e,c),B(m,e,null),b(O,w,_),v.m(O,_),b(O,E,_),j=!0},p(O,_){(!j||_&3)&&o!==(o=(O[1].jat[O[0].idx].name||"Untitled junction")+"")&&ae(r,o),(!j||_&1)&&l!==(l=O[0].stage+"")&&ae(a,l);const $={};_&8193&&($.$$scope={dirty:_,ctx:O}),f.$set($);const p={};!d&&_&3&&(d=!0,p.value=O[1].jat[O[0].idx].name,se(()=>d=!1)),m.$set(p),_&1&&we(M,M=O[0].stage)?(_e(),C(v,1,1,Ae),ge(),v=kt(O),v.c(),y(v,1),v.m(E.parentNode,E)):v.p(O,_)},i(O){j||(y(f.$$.fragment,O),y(m.$$.fragment,O),y(v),j=!0)},o(O){C(f.$$.fragment,O),C(m.$$.fragment,O),C(v),j=!1},d(O){O&&(g(e),g(w),g(E)),F(f),F(m),v.d(O)}}}function ho(n){let e,t,o,r;t=new He({props:{$$slots:{default:[Lo]},$$scope:{ctx:n}}}),t.$on("click",n[2]);let i=de(n[1].jat),l=[];for(let s=0;s<i.length;s+=1)l[s]=wt(bt(n,i,s));const a=s=>C(l[s],1,1,()=>{l[s]=null});return{c(){e=Z("div"),U(t.$$.fragment),o=J();for(let s=0;s<l.length;s+=1)l[s].c();this.h()},l(s){e=W(s,"DIV",{class:!0});var f=X(e);q(t.$$.fragment,f),o=D(f);for(let c=0;c<l.length;c+=1)l[c].l(f);f.forEach(g),this.h()},h(){re(e,"class","govuk-width-container")},m(s,f){b(s,e,f),B(t,e,null),P(e,o);for(let c=0;c<l.length;c+=1)l[c]&&l[c].m(e,null);r=!0},p(s,f){const c={};if(f&8192&&(c.$$scope={dirty:f,ctx:s}),t.$set(c),f&3){i=de(s[1].jat);let m;for(m=0;m<i.length;m+=1){const d=bt(s,i,m);l[m]?(l[m].p(d,f),y(l[m],1)):(l[m]=wt(d),l[m].c(),y(l[m],1),l[m].m(e,null))}for(_e(),m=i.length;m<l.length;m+=1)a(m);ge()}},i(s){if(!r){y(t.$$.fragment,s);for(let f=0;f<i.length;f+=1)y(l[f]);r=!0}},o(s){C(t.$$.fragment,s),l=l.filter(Boolean);for(let f=0;f<l.length;f+=1)C(l[f]);r=!1},d(s){s&&g(e),F(t),ve(l,s)}}}function vo(n){let e;return{c(){e=R("Back to all junctions")},l(t){e=H(t,"Back to all junctions")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function bo(n){let e;return{c(){e=R("Delete junction")},l(t){e=H(t,"Delete junction")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function ko(n){let e,t,o,r;return e=new be({props:{$$slots:{default:[vo]},$$scope:{ctx:n}}}),e.$on("click",n[5]),o=new Ge({props:{$$slots:{default:[bo]},$$scope:{ctx:n}}}),o.$on("click",n[6]),{c(){U(e.$$.fragment),t=J(),U(o.$$.fragment)},l(i){q(e.$$.fragment,i),t=D(i),q(o.$$.fragment,i)},m(i,l){B(e,i,l),b(i,t,l),B(o,i,l),r=!0},p(i,l){const a={};l&8192&&(a.$$scope={dirty:l,ctx:i}),e.$set(a);const s={};l&8192&&(s.$$scope={dirty:l,ctx:i}),o.$set(s)},i(i){r||(y(e.$$.fragment,i),y(o.$$.fragment,i),r=!0)},o(i){C(e.$$.fragment,i),C(o.$$.fragment,i),r=!1},d(i){i&&g(t),F(e,i),F(o,i)}}}function wo(n){let e,t;return e=new be({props:{$$slots:{default:[jo]},$$scope:{ctx:n}}}),e.$on("click",n[9]),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function yo(n){let e,t;return e=new be({props:{$$slots:{default:[Co]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r&8192&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function jo(n){let e;return{c(){e=R("Edit Proposed")},l(t){e=H(t,"Edit Proposed")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function Co(n){let e;return{c(){e=R("Edit Existing")},l(t){e=H(t,"Edit Existing")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function To(n){let e,t,o=n[0].stage+"",r,i,l,a=n[1].jat[n[0].idx].name+"",s,f,c,m,d,w;const M=[yo,wo],E=[];function j(S,h){return S[0].stage=="proposed"?0:1}return c=j(n),m=E[c]=M[c](n),{c(){e=Z("p"),t=R("Currently editing "),r=R(o),i=R(` junction
        `),l=Z("u"),s=R(a),f=J(),m.c(),d=ue()},l(S){e=W(S,"P",{});var h=X(e);t=H(h,"Currently editing "),r=H(h,o),i=H(h,` junction
        `),l=W(h,"U",{});var v=X(l);s=H(v,a),v.forEach(g),h.forEach(g),f=D(S),m.l(S),d=ue()},m(S,h){b(S,e,h),P(e,t),P(e,r),P(e,i),P(e,l),P(l,s),b(S,f,h),E[c].m(S,h),b(S,d,h),w=!0},p(S,h){(!w||h&1)&&o!==(o=S[0].stage+"")&&ae(r,o),(!w||h&3)&&a!==(a=S[1].jat[S[0].idx].name+"")&&ae(s,a);let v=c;c=j(S),c===v?E[c].p(S,h):(_e(),C(E[v],1,1,()=>{E[v]=null}),ge(),m=E[c],m?m.p(S,h):(m=E[c]=M[c](S),m.c()),y(m,1),m.m(d.parentNode,d))},i(S){w||(y(m),w=!0)},o(S){C(m),w=!1},d(S){S&&(g(e),g(f),g(d)),E[c].d(S)}}}function kt(n){let e,t;return e=new po({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[To]},$$scope:{ctx:n}}}),{c(){U(e.$$.fragment)},l(o){q(e.$$.fragment,o)},m(o,r){B(e,o,r),t=!0},p(o,r){const i={};r&1&&(i.junctionIdx=o[0].idx),r&1&&(i.stage=o[0].stage),r&8195&&(i.$$scope={dirty:r,ctx:o}),e.$set(i)},i(o){t||(y(e.$$.fragment,o),t=!0)},o(o){C(e.$$.fragment,o),t=!1},d(o){F(e,o)}}}function Lo(n){let e;return{c(){e=R("Add new junction")},l(t){e=H(t,"Add new junction")},m(t,o){b(t,e,o)},d(t){t&&g(e)}}}function So(n){let e,t,o,r=$e(n[10].existing)+"",i,l,a,s,f=$e(n[10].proposed)+"",c,m;return{c(){e=Z("div"),t=Z("span"),o=R("Existing: "),i=R(r),l=J(),a=Z("span"),s=R("Proposed: "),c=R(f),m=J(),this.h()},l(d){e=W(d,"DIV",{style:!0});var w=X(e);t=W(w,"SPAN",{});var M=X(t);o=H(M,"Existing: "),i=H(M,r),M.forEach(g),l=D(w),a=W(w,"SPAN",{});var E=X(a);s=H(E,"Proposed: "),c=H(E,f),E.forEach(g),w.forEach(g),m=D(d),this.h()},h(){ee(e,"width","100%"),ee(e,"display","flex"),ee(e,"justify-content","space-between")},m(d,w){b(d,e,w),P(e,t),P(t,o),P(t,i),P(e,l),P(e,a),P(a,s),P(a,c),b(d,m,w)},p(d,w){w&2&&r!==(r=$e(d[10].existing)+"")&&ae(i,r),w&2&&f!==(f=$e(d[10].proposed)+"")&&ae(c,f)},d(d){d&&(g(e),g(m))}}}function wt(n){let e,t;function o(){return n[4](n[12])}return e=new Ze({props:{name:n[10].name||"Untitled junction",$$slots:{default:[So]},$$scope:{ctx:n}}}),e.$on("click",o),{c(){U(e.$$.fragment)},l(r){q(e.$$.fragment,r)},m(r,i){B(e,r,i),t=!0},p(r,i){n=r;const l={};i&2&&(l.name=n[10].name||"Untitled junction"),i&8194&&(l.$$scope={dirty:i,ctx:n}),e.$set(l)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){C(e.$$.fragment,r),t=!1},d(r){F(e,r)}}}function Eo(n){let e,t,o,r;const i=[ho,$o],l=[];function a(s,f){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(n))&&(t=l[e]=i[e](n)),{c(){t&&t.c(),o=ue()},l(s){t&&t.l(s),o=ue()},m(s,f){~e&&l[e].m(s,f),b(s,o,f),r=!0},p(s,[f]){let c=e;e=a(s),e===c?~e&&l[e].p(s,f):(t&&(_e(),C(l[c],1,1,()=>{l[c]=null}),ge()),~e?(t=l[e],t?t.p(s,f):(t=l[e]=i[e](s),t.c()),y(t,1),t.m(o.parentNode,o)):t=null)},i(s){r||(y(t),r=!0)},o(s){C(t),r=!1},d(s){s&&g(o),~e&&l[e].d(s)}}}function Ue(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function Mo(n,e,t){let o;Oe(n,oe,w=>t(1,o=w));let r={kind:"list"};function i(){Ce(oe,o.jat=[...o.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],o),t(0,r={kind:"edit",idx:o.jat.length-1,stage:"existing"})}function l(w){window.confirm("Delete this junction?")&&(o.jat.splice(w,1),oe.set(o),t(0,r={kind:"list"}))}const a=w=>t(0,r={kind:"edit",idx:w,stage:"existing"}),s=()=>t(0,r={kind:"list"}),f=()=>l(Ue(r));function c(w){n.$$.not_equal(o.jat[r.idx].name,w)&&(o.jat[r.idx].name=w,oe.set(o))}return[r,o,i,l,a,s,f,c,()=>t(0,r={kind:"edit",idx:Ue(r),stage:"existing"}),()=>t(0,r={kind:"edit",idx:Ue(r),stage:"proposed"})]}class tr extends Le{constructor(e){super(),Se(this,e,Mo,Eo,we,{})}}export{tr as component};
