import{s as be,r as se,w as me,l as vt,u as bt,m as kt,o as wt,E as Le,k as Ne,Q as It,V as Ee,a as P,g as D,i as k,f as p,B as he,X as Nt,e as X,c as Z,b as K,q as oe,h as B,J as ce,Y as jt,v as x,L as Be,t as R,M as Ae,d as H,n as ve,p as we,j as re,z as Bt,$ as Je}from"../chunks/scheduler.Bxdx0f0B.js";import{S as je,i as ye,e as _e,c as F,a as O,m as q,t as y,b as L,d as z,g as de,f as ge}from"../chunks/index.itOPPQ0R.js";import{e as ue}from"../chunks/each.BdQ2bsat.js";import{B as At}from"../chunks/ButtonGroup.CFC5gCUN.js";import{D as qe,C as Pt}from"../chunks/DefaultButton.j5-p4xk5.js";import{j as Ve}from"../chunks/index.CgbRdXYT.js";import{S as Ce}from"../chunks/SecondaryButton.C3WEK5d3.js";import{T as ze}from"../chunks/TextInput.C0OaqV_c.js";import{W as Re}from"../chunks/WarningButton.DE8BQTXW.js";import{s as ne}from"../chunks/data.Vq0nYpz3.js";import{g as Dt}from"../chunks/globals.D0QH3NT1.js";import{a as Ut,c as Ft,j as ke,v as Ot,w as yt,x as Ue,M as qt,b as zt,G as Xe,L as Fe,h as Ze,C as Rt,y as Ht}from"../chunks/index.CNzBS49z.js";import{g as Oe,t as Gt}from"../chunks/index.BBN6ECFG.js";import{c as $e}from"../chunks/colors.DaC397qr.js";import{G as Jt,I as Pe,p as Vt}from"../chunks/pan.Cw1k_3Cr.js";import{M as Xt,G as Zt,S as Wt,C as He}from"../chunks/GeoreferenceLayer.svelte_svelte_type_style_lang.55BDKwRQ.js";import{M as Ie,B as Kt,C as Qt}from"../chunks/Marker.BuapyMpp.js";import"../chunks/paths.ufndQOGu.js";import"../chunks/entry.EguuSlE3.js";import{R as Yt}from"../chunks/RouteMapLayer.jCyWSlvq.js";import{P as Ct}from"../chunks/Popup.KRxMTUht.js";import{T as Lt}from"../chunks/TextArea.Daia9mJB.js";import{R as We}from"../chunks/Radio.DziM1Hc1.js";function xt(n){let e;const l=n[16].default,t=vt(l,n,n[24],null);return{c(){t&&t.c()},l(o){t&&t.l(o)},m(o,i){t&&t.m(o,i),e=!0},p(o,i){t&&t.p&&(!e||i&16777216)&&bt(t,l,o,o[24],e?wt(l,o[24],i,null):kt(o[24]),null)},i(o){e||(y(t,o),e=!0)},o(o){L(t,o),e=!1},d(o){t&&t.d(o)}}}function en(n){let e,l,t;function o(r){n[17](r)}let i={id:n[1],type:"symbol",source:n[2],sourceLayer:n[3],beforeId:n[4],beforeLayerType:n[5],paint:n[6],layout:n[7],filter:n[8],applyToClusters:n[9],minzoom:n[10],maxzoom:n[11],hoverCursor:n[12],manageHoverState:n[13],eventsIfTopMost:n[14],interactive:n[15],$$slots:{default:[xt]},$$scope:{ctx:n}};return n[0]!==void 0&&(i.hovered=n[0]),e=new Ut({props:i}),se.push(()=>_e(e,"hovered",o)),e.$on("click",n[18]),e.$on("dblclick",n[19]),e.$on("contextmenu",n[20]),e.$on("mouseenter",n[21]),e.$on("mousemove",n[22]),e.$on("mouseleave",n[23]),{c(){F(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,[a]){const s={};a&2&&(s.id=r[1]),a&4&&(s.source=r[2]),a&8&&(s.sourceLayer=r[3]),a&16&&(s.beforeId=r[4]),a&32&&(s.beforeLayerType=r[5]),a&64&&(s.paint=r[6]),a&128&&(s.layout=r[7]),a&256&&(s.filter=r[8]),a&512&&(s.applyToClusters=r[9]),a&1024&&(s.minzoom=r[10]),a&2048&&(s.maxzoom=r[11]),a&4096&&(s.hoverCursor=r[12]),a&8192&&(s.manageHoverState=r[13]),a&16384&&(s.eventsIfTopMost=r[14]),a&32768&&(s.interactive=r[15]),a&16777216&&(s.$$scope={dirty:a,ctx:r}),!l&&a&1&&(l=!0,s.hovered=r[0],me(()=>l=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function tn(n,e,l){let{$$slots:t={},$$scope:o}=e,{id:i=Ft("symbol")}=e,{source:r=void 0}=e,{sourceLayer:a=void 0}=e,{beforeId:s=void 0}=e,{beforeLayerType:u=void 0}=e,{paint:c=void 0}=e,{layout:g=void 0}=e,{filter:_=void 0}=e,{applyToClusters:j=void 0}=e,{minzoom:S=void 0}=e,{maxzoom:A=void 0}=e,{hoverCursor:M=void 0}=e,{manageHoverState:I=!1}=e,{hovered:h=null}=e,{eventsIfTopMost:w=!1}=e,{interactive:E=!0}=e;function m(C){h=C,l(0,h)}function d(C){Le.call(this,n,C)}function $(C){Le.call(this,n,C)}function U(C){Le.call(this,n,C)}function T(C){Le.call(this,n,C)}function W(C){Le.call(this,n,C)}function v(C){Le.call(this,n,C)}return n.$$set=C=>{"id"in C&&l(1,i=C.id),"source"in C&&l(2,r=C.source),"sourceLayer"in C&&l(3,a=C.sourceLayer),"beforeId"in C&&l(4,s=C.beforeId),"beforeLayerType"in C&&l(5,u=C.beforeLayerType),"paint"in C&&l(6,c=C.paint),"layout"in C&&l(7,g=C.layout),"filter"in C&&l(8,_=C.filter),"applyToClusters"in C&&l(9,j=C.applyToClusters),"minzoom"in C&&l(10,S=C.minzoom),"maxzoom"in C&&l(11,A=C.maxzoom),"hoverCursor"in C&&l(12,M=C.hoverCursor),"manageHoverState"in C&&l(13,I=C.manageHoverState),"hovered"in C&&l(0,h=C.hovered),"eventsIfTopMost"in C&&l(14,w=C.eventsIfTopMost),"interactive"in C&&l(15,E=C.interactive),"$$scope"in C&&l(24,o=C.$$scope)},[h,i,r,a,s,u,c,g,_,j,S,A,M,I,w,E,t,m,d,$,U,T,W,v,o]}class nn extends je{constructor(e){super(),ye(this,e,tn,en,be,{id:1,source:2,sourceLayer:3,beforeId:4,beforeLayerType:5,paint:6,layout:7,filter:8,applyToClusters:9,minzoom:10,maxzoom:11,hoverCursor:12,manageHoverState:13,hovered:0,eventsIfTopMost:14,interactive:15})}}var ln=Object.defineProperty,on=(n,e)=>ln(n,"name",{value:e,configurable:!0});function Mt(n,e,l,t={}){const o=Oe(n),i=ke(o[0]),r=ke(o[1]),a=ke(l),s=Ot(e,t.units),u=Math.asin(Math.sin(r)*Math.cos(s)+Math.cos(r)*Math.sin(s)*Math.cos(a)),c=i+Math.atan2(Math.sin(a)*Math.sin(s)*Math.cos(r),Math.cos(s)-Math.sin(r)*Math.sin(u)),g=Ue(c),_=Ue(u);return yt([g,_],t.properties)}on(Mt,"destination");var Se=Mt,rn=Object.defineProperty,Et=(n,e)=>rn(n,"name",{value:e,configurable:!0});function Ge(n,e,l={}){if(l.final===!0)return Tt(n,e);const t=Oe(n),o=Oe(e),i=ke(t[0]),r=ke(o[0]),a=ke(t[1]),s=ke(o[1]),u=Math.sin(r-i)*Math.cos(s),c=Math.cos(a)*Math.sin(s)-Math.sin(a)*Math.cos(s)*Math.cos(r-i);return Ue(Math.atan2(u,c))}Et(Ge,"bearing");function Tt(n,e){let l=Ge(e,n);return l=(l+180)%360,l}Et(Tt,"calculateFinalBearing");var Me=Ge;const an="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20height='24px'%20viewBox='0%20-960%20960%20960'%20width='24px'%20fill='%23FFFFFF'%3e%3cpath%20d='m136-240-56-56%20296-298%20160%20160%20208-206H640v-80h240v240h-80v-104L536-320%20376-480%20136-240Z'%20fill='black'/%3e%3c/svg%3e";function Ke(n,e,l){const t=n.slice();return t[36]=e[l],t[37]=e,t[38]=l,t}function Qe(n,e,l){const t=n.slice();return t[39]=e[l],t[40]=e,t[38]=l,t}function Ye(n){let e,l,t,o,i,r,a;return l=new Pe({props:{$$slots:{default:[un]},$$scope:{ctx:n}}}),l.$on("click",function(){Nt(n[5])&&n[5].apply(this,arguments)}),o=new Pe({props:{$$slots:{default:[_n]},$$scope:{ctx:n}}}),o.$on("click",n[17]),r=new Pe({props:{$$slots:{default:[pn]},$$scope:{ctx:n}}}),r.$on("click",n[18]),{c(){e=X("div"),F(l.$$.fragment),t=P(),F(o.$$.fragment),i=P(),F(r.$$.fragment),this.h()},l(s){e=Z(s,"DIV",{class:!0});var u=K(e);O(l.$$.fragment,u),t=D(u),O(o.$$.fragment,u),i=D(u),O(r.$$.fragment,u),u.forEach(p),this.h()},h(){oe(e,"class","control-panel svelte-1w3m76d")},m(s,u){k(s,e,u),q(l,e,null),B(e,t),q(o,e,null),B(e,i),q(r,e,null),a=!0},p(s,u){n=s;const c={};u[0]&1|u[1]&1024&&(c.$$scope={dirty:u,ctx:n}),l.$set(c);const g={};u[0]&1|u[1]&1024&&(g.$$scope={dirty:u,ctx:n}),o.$set(g);const _={};u[0]&1|u[1]&1024&&(_.$$scope={dirty:u,ctx:n}),r.$set(_)},i(s){a||(y(l.$$.fragment,s),y(o.$$.fragment,s),y(r.$$.fragment,s),a=!0)},o(s){L(l.$$.fragment,s),L(o.$$.fragment,s),L(r.$$.fragment,s),a=!1},d(s){s&&p(e),z(l),z(o),z(r)}}}function sn(n){let e;return{c(){e=R("Move map")},l(l){e=H(l,"Move map")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function fn(n){let e,l="Move map";return{c(){e=X("u"),e.textContent=l},l(t){e=Z(t,"U",{"data-svelte-h":!0}),we(e)!=="svelte-1719ytd"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function un(n){let e,l,t,o;function i(s,u){return s[0].mode=="select"?fn:sn}let r=i(n),a=r(n);return{c(){e=X("img"),t=P(),a.c(),o=ce(),this.h()},l(s){e=Z(s,"IMG",{src:!0,alt:!0,style:!0}),t=D(s),a.l(s),o=ce(),this.h()},h(){jt(e.src,l=Vt)||oe(e,"src",l),oe(e,"alt","Move map"),x(e,"vertical-align","middle")},m(s,u){k(s,e,u),k(s,t,u),a.m(s,u),k(s,o,u)},p(s,u){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(o.parentNode,o)))},d(s){s&&(p(e),p(t),p(o)),a.d(s)}}}function cn(n){let e;return{c(){e=R("New arm")},l(l){e=H(l,"New arm")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function mn(n){let e,l="New arm";return{c(){e=X("u"),e.textContent=l},l(t){e=Z(t,"U",{"data-svelte-h":!0}),we(e)!=="svelte-1typ7gq"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function _n(n){let e,l,t,o,i,r;function a(c,g){return c[0].mode=="new-arm"?mn:cn}let s=a(n),u=s(n);return{c(){e=Be("svg"),l=Be("circle"),t=Be("text"),o=R("A"),i=P(),u.c(),r=ce(),this.h()},l(c){e=Ae(c,"svg",{width:!0,height:!0,xmlns:!0,style:!0});var g=K(e);l=Ae(g,"circle",{cx:!0,cy:!0,r:!0,fill:!0}),K(l).forEach(p),t=Ae(g,"text",{x:!0,y:!0,fill:!0});var _=K(t);o=H(_,"A"),_.forEach(p),g.forEach(p),i=D(c),u.l(c),r=ce(),this.h()},h(){oe(l,"cx","12"),oe(l,"cy","12"),oe(l,"r","12"),oe(l,"fill","white"),oe(t,"x","6"),oe(t,"y","16"),oe(t,"fill","#4472c4"),oe(e,"width","24"),oe(e,"height","24"),oe(e,"xmlns","http://www.w3.org/2000/svg"),x(e,"vertical-align","middle")},m(c,g){k(c,e,g),B(e,l),B(e,t),B(t,o),k(c,i,g),u.m(c,g),k(c,r,g)},p(c,g){s!==(s=a(c))&&(u.d(1),u=s(c),u&&(u.c(),u.m(r.parentNode,r)))},d(c){c&&(p(e),p(i),p(r)),u.d(c)}}}function dn(n){let e;return{c(){e=R("New movement")},l(l){e=H(l,"New movement")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function gn(n){let e,l="New movement";return{c(){e=X("u"),e.textContent=l},l(t){e=Z(t,"U",{"data-svelte-h":!0}),we(e)!=="svelte-o92ucp"&&(e.textContent=l)},m(t,o){k(t,e,o)},d(t){t&&p(e)}}}function pn(n){let e,l,t,o;function i(s,u){return s[0].mode=="new-movement"?gn:dn}let r=i(n),a=r(n);return{c(){e=X("img"),t=P(),a.c(),o=ce(),this.h()},l(s){e=Z(s,"IMG",{src:!0,alt:!0,style:!0}),t=D(s),a.l(s),o=ce(),this.h()},h(){jt(e.src,l=an)||oe(e,"src",l),oe(e,"alt","New movement"),x(e,"vertical-align","middle")},m(s,u){k(s,e,u),k(s,t,u),a.m(s,u),k(s,o,u)},p(s,u){r!==(r=i(s))&&(a.d(1),a=r(s),a&&(a.c(),a.m(o.parentNode,o)))},d(s){s&&(p(e),p(t),p(o)),a.d(s)}}}function $n(n){let e,l=Tn(n[38])+"",t;return{c(){e=X("span"),t=R(l),this.h()},l(o){e=Z(o,"SPAN",{class:!0});var i=K(e);t=H(i,l),i.forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),x(e,"color","#4472c4"),x(e,"background-color","white")},m(o,i){k(o,e,i),B(e,t)},p:ve,d(o){o&&p(e)}}}function xe(n){let e,l,t;function o(s){n[19](s,n[39])}function i(){return n[20](n[38])}function r(){return n[21](n[38])}let a={draggable:!0,$$slots:{default:[$n]},$$scope:{ctx:n}};return n[39].point!==void 0&&(a.lngLat=n[39].point),e=new Ie({props:a}),se.push(()=>_e(e,"lngLat",o)),e.$on("dragend",i),e.$on("click",r),{c(){F(e.$$.fragment)},l(s){O(e.$$.fragment,s)},m(s,u){q(e,s,u),t=!0},p(s,u){n=s;const c={};u[1]&1024&&(c.$$scope={dirty:u,ctx:n}),!l&&u[0]&70&&(l=!0,c.lngLat=n[39].point,me(()=>l=!1)),e.$set(c)},i(s){t||(y(e.$$.fragment,s),t=!0)},o(s){L(e.$$.fragment,s),t=!1},d(s){z(e,s)}}}function hn(n){let e;return{c(){e=X("span"),this.h()},l(l){e=Z(l,"SPAN",{class:!0}),K(e).forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),x(e,"background-color",n[9][n[36].score]),x(e,"opacity",n[36].kind=="walking & wheeling"?"0%":"100%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&x(e,"background-color",l[9][l[36].score]),t[0]&70&&x(e,"opacity",l[36].kind=="walking & wheeling"?"0%":"100%")},d(l){l&&p(e)}}}function vn(n){let e;return{c(){e=X("span"),this.h()},l(l){e=Z(l,"SPAN",{class:!0}),K(e).forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),x(e,"background-color",n[9][n[36].score])},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&x(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function bn(n){let e;return{c(){e=X("span"),this.h()},l(l){e=Z(l,"SPAN",{class:!0}),K(e).forEach(p),this.h()},h(){oe(e,"class","dot svelte-1w3m76d"),x(e,"background-color",n[9][n[36].score]),x(e,"opacity","0%")},m(l,t){k(l,e,t)},p(l,t){t[0]&70&&x(e,"background-color",l[9][l[36].score])},d(l){l&&p(e)}}}function et(n){let e,l,t,o,i,r,a,s,u;function c(d){n[22](d,n[36])}function g(){return n[23](n[38])}function _(){return n[24](n[38])}let j={draggable:!0,$$slots:{default:[hn]},$$scope:{ctx:n}};n[36].point1!==void 0&&(j.lngLat=n[36].point1),e=new Ie({props:j}),se.push(()=>_e(e,"lngLat",c)),e.$on("dragend",g),e.$on("click",_);function S(d){n[25](d,n[36])}function A(){return n[26](n[38])}function M(){return n[27](n[38])}let I={draggable:!0,$$slots:{default:[vn]},$$scope:{ctx:n}};n[36].point2!==void 0&&(I.lngLat=n[36].point2),o=new Ie({props:I}),se.push(()=>_e(o,"lngLat",S)),o.$on("dragend",A),o.$on("click",M);function h(d){n[28](d,n[36])}function w(){return n[29](n[38])}function E(){return n[30](n[38])}let m={draggable:!0,$$slots:{default:[bn]},$$scope:{ctx:n}};return n[36].point3!==void 0&&(m.lngLat=n[36].point3),a=new Ie({props:m}),se.push(()=>_e(a,"lngLat",h)),a.$on("dragend",w),a.$on("click",E),{c(){F(e.$$.fragment),t=P(),F(o.$$.fragment),r=P(),F(a.$$.fragment)},l(d){O(e.$$.fragment,d),t=D(d),O(o.$$.fragment,d),r=D(d),O(a.$$.fragment,d)},m(d,$){q(e,d,$),k(d,t,$),q(o,d,$),k(d,r,$),q(a,d,$),u=!0},p(d,$){n=d;const U={};$[0]&70|$[1]&1024&&(U.$$scope={dirty:$,ctx:n}),!l&&$[0]&70&&(l=!0,U.lngLat=n[36].point1,me(()=>l=!1)),e.$set(U);const T={};$[0]&70|$[1]&1024&&(T.$$scope={dirty:$,ctx:n}),!i&&$[0]&70&&(i=!0,T.lngLat=n[36].point2,me(()=>i=!1)),o.$set(T);const W={};$[0]&70|$[1]&1024&&(W.$$scope={dirty:$,ctx:n}),!s&&$[0]&70&&(s=!0,W.lngLat=n[36].point3,me(()=>s=!1)),a.$set(W)},i(d){u||(y(e.$$.fragment,d),y(o.$$.fragment,d),y(a.$$.fragment,d),u=!0)},o(d){L(e.$$.fragment,d),L(o.$$.fragment,d),L(a.$$.fragment,d),u=!1},d(d){d&&(p(t),p(r)),z(e,d),z(o,d),z(a,d)}}}function kn(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=R(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&re(l,e)},d(t){t&&p(l)}}}function wn(n){let e,l;return e=new Ct({props:{$$slots:{default:[kn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o[1]&1040&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function jn(n){let e=(n[35].name||"Untitled movement")+"",l;return{c(){l=R(e)},l(t){l=H(t,e)},m(t,o){k(t,l,o)},p(t,o){o[1]&16&&e!==(e=(t[35].name||"Untitled movement")+"")&&re(l,e)},d(t){t&&p(l)}}}function yn(n){let e,l;return e=new Ct({props:{$$slots:{default:[jn,({props:t})=>({35:t}),({props:t})=>[0,t?16:0]]},$$scope:{ctx:n}}}),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o[1]&1040&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function Cn(n){let e,l,t,o,i,r;return e=new Fe({props:{id:"jat-cycling",manageHoverState:!0,paint:{"line-width":Ze(6,10),"line-color":["get","color"]},filter:["==",["get","kind"],"cycling"],$$slots:{default:[wn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Fe({props:{id:"jat-walking-wheeling",manageHoverState:!0,paint:{"line-width":Ze(6,8),"line-color":["get","color"],"line-dasharray":[3,2]},filter:["==",["get","kind"],"walking & wheeling"],$$slots:{default:[yn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),i=new nn({props:{id:"jat-arrow",filter:["has","angle"],paint:{"text-color":["get","color"],"text-halo-color":"white","text-halo-width":3},layout:{"text-field":"â¬†","text-overlap":"always","text-rotate":["get","angle"],"text-size":70}}}),{c(){F(e.$$.fragment),l=P(),F(t.$$.fragment),o=P(),F(i.$$.fragment)},l(a){O(e.$$.fragment,a),l=D(a),O(t.$$.fragment,a),o=D(a),O(i.$$.fragment,a)},m(a,s){q(e,a,s),k(a,l,s),q(t,a,s),k(a,o,s),q(i,a,s),r=!0},p(a,s){const u={};s[1]&1024&&(u.$$scope={dirty:s,ctx:a}),e.$set(u);const c={};s[1]&1024&&(c.$$scope={dirty:s,ctx:a}),t.$set(c)},i(a){r||(y(e.$$.fragment,a),y(t.$$.fragment,a),y(i.$$.fragment,a),r=!0)},o(a){L(e.$$.fragment,a),L(t.$$.fragment,a),L(i.$$.fragment,a),r=!1},d(a){a&&(p(l),p(o)),z(e,a),z(t,a),z(i,a)}}}function Ln(n){let e,l,t,o;return e=new Fe({props:{paint:{"line-width":5,"line-color":"yellow","line-gap-width":45}}}),t=new Rt({props:{filter:["==",["get","kind"],"arm"],paint:{"circle-radius":20,"circle-opacity":0,"circle-stroke-width":5,"circle-stroke-color":"yellow"}}}),{c(){F(e.$$.fragment),l=P(),F(t.$$.fragment)},l(i){O(e.$$.fragment,i),l=D(i),O(t.$$.fragment,i)},m(i,r){q(e,i,r),k(i,l,r),q(t,i,r),o=!0},p:ve,i(i){o||(y(e.$$.fragment,i),y(t.$$.fragment,i),o=!0)},o(i){L(e.$$.fragment,i),L(t.$$.fragment,i),o=!1},d(i){i&&p(l),z(e,i),z(t,i)}}}function Mn(n){let e,l,t,o,i,r,a,s,u,c,g,_,j;e=new Xt({}),e.$on("click",n[10]);let S=n[0].mode!="editing"&&Ye(n);o=new Yt({props:{show:n[3]}});let A=ue(n[6].jat[n[1]][n[2]].arms),M=[];for(let m=0;m<A.length;m+=1)M[m]=xe(Qe(n,A,m));const I=m=>L(M[m],1,1,()=>{M[m]=null});let h=ue(n[6].jat[n[1]][n[2]].movements),w=[];for(let m=0;m<h.length;m+=1)w[m]=et(Ke(n,h,m));const E=m=>L(w[m],1,1,()=>{w[m]=null});return s=new Xe({props:{data:n[12](n[6]),$$slots:{default:[Cn]},$$scope:{ctx:n}}}),c=new Xe({props:{data:n[8],$$slots:{default:[Ln]},$$scope:{ctx:n}}}),_=new Jt({props:{map:n[7]}}),{c(){F(e.$$.fragment),l=P(),S&&S.c(),t=P(),F(o.$$.fragment),i=P();for(let m=0;m<M.length;m+=1)M[m].c();r=P();for(let m=0;m<w.length;m+=1)w[m].c();a=P(),F(s.$$.fragment),u=P(),F(c.$$.fragment),g=P(),F(_.$$.fragment)},l(m){O(e.$$.fragment,m),l=D(m),S&&S.l(m),t=D(m),O(o.$$.fragment,m),i=D(m);for(let d=0;d<M.length;d+=1)M[d].l(m);r=D(m);for(let d=0;d<w.length;d+=1)w[d].l(m);a=D(m),O(s.$$.fragment,m),u=D(m),O(c.$$.fragment,m),g=D(m),O(_.$$.fragment,m)},m(m,d){q(e,m,d),k(m,l,d),S&&S.m(m,d),k(m,t,d),q(o,m,d),k(m,i,d);for(let $=0;$<M.length;$+=1)M[$]&&M[$].m(m,d);k(m,r,d);for(let $=0;$<w.length;$+=1)w[$]&&w[$].m(m,d);k(m,a,d),q(s,m,d),k(m,u,d),q(c,m,d),k(m,g,d),q(_,m,d),j=!0},p(m,d){m[0].mode!="editing"?S?(S.p(m,d),d[0]&1&&y(S,1)):(S=Ye(m),S.c(),y(S,1),S.m(t.parentNode,t)):S&&(de(),L(S,1,1,()=>{S=null}),ge());const $={};if(d[0]&8&&($.show=m[3]),o.$set($),d[0]&86){A=ue(m[6].jat[m[1]][m[2]].arms);let v;for(v=0;v<A.length;v+=1){const C=Qe(m,A,v);M[v]?(M[v].p(C,d),y(M[v],1)):(M[v]=xe(C),M[v].c(),y(M[v],1),M[v].m(r.parentNode,r))}for(de(),v=A.length;v<M.length;v+=1)I(v);ge()}if(d[0]&598){h=ue(m[6].jat[m[1]][m[2]].movements);let v;for(v=0;v<h.length;v+=1){const C=Ke(m,h,v);w[v]?(w[v].p(C,d),y(w[v],1)):(w[v]=et(C),w[v].c(),y(w[v],1),w[v].m(a.parentNode,a))}for(de(),v=h.length;v<w.length;v+=1)E(v);ge()}const U={};d[0]&64&&(U.data=m[12](m[6])),d[1]&1024&&(U.$$scope={dirty:d,ctx:m}),s.$set(U);const T={};d[0]&256&&(T.data=m[8]),d[1]&1024&&(T.$$scope={dirty:d,ctx:m}),c.$set(T);const W={};d[0]&128&&(W.map=m[7]),_.$set(W)},i(m){if(!j){y(e.$$.fragment,m),y(S),y(o.$$.fragment,m);for(let d=0;d<A.length;d+=1)y(M[d]);for(let d=0;d<h.length;d+=1)y(w[d]);y(s.$$.fragment,m),y(c.$$.fragment,m),y(_.$$.fragment,m),j=!0}},o(m){L(e.$$.fragment,m),L(S),L(o.$$.fragment,m),M=M.filter(Boolean);for(let d=0;d<M.length;d+=1)L(M[d]);w=w.filter(Boolean);for(let d=0;d<w.length;d+=1)L(w[d]);L(s.$$.fragment,m),L(c.$$.fragment,m),L(_.$$.fragment,m),j=!1},d(m){m&&(p(l),p(t),p(i),p(r),p(a),p(u),p(g)),z(e,m),S&&S.d(m),z(o,m),he(M,m),he(w,m),z(s,m),z(c,m),z(_,m)}}}function En(n){let e,l,t;function o(r){n[31](r)}let i={$$slots:{default:[Mn]},$$scope:{ctx:n}};return n[7]!==void 0&&(i.map=n[7]),e=new qt({props:i}),se.push(()=>_e(e,"map",o)),{c(){F(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const s={};a[0]&511|a[1]&1024&&(s.$$scope={dirty:a,ctx:r}),!l&&a[0]&128&&(l=!0,s.map=r[7],me(()=>l=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function tt(n,e){return{type:"Feature",id:e,properties:{kind:"arm"},geometry:{type:"Point",coordinates:n.point}}}function Tn(n){return String.fromCharCode(n+65)}function Sn(n,e,l){let t,o;Ne(n,ne,f=>l(6,o=f));let{junctionIdx:i}=e,{stage:r}=e,{mode:a}=e,{hoveringSidebar:s}=e,{streetviewOn:u}=e,{showRoute:c}=e,{select:g}=e,{stopEditing:_}=e,j,S={0:$e.red.background,1:$e.amber.background,2:$e.green.background,X:$e.critical.background};function A(f,b,te){let ie={type:"FeatureCollection",features:[]},Q=b.mode=="editing"?b.id:te;return Q!=null&&(Q.kind=="arm"?ie.features.push(tt(f.jat[i][r].arms[Q.idx],Q.idx)):ie.features.push(w(f.jat[i][r].movements[Q.idx],Q.idx))),ie}async function M(f){if(!u){for(let b of j.queryRenderedFeatures(f.detail.point,{layers:["jat-cycling","jat-walking-wheeling"]}))return;if(a.mode!="select"){if(a.mode=="editing"){await _();return}a.mode=="new-arm"?(Ee(ne,o.jat[i][r].arms=[...o.jat[i][r].arms,{point:f.detail.lngLat.toArray(),name:""}],o),await g({kind:"arm",idx:o.jat[i][r].arms.length-1})):(Ee(ne,o.jat[i][r].movements=[...o.jat[i][r].movements,{point1:f.detail.lngLat.toArray(),point2:Se(f.detail.lngLat.toArray(),.005,0).geometry.coordinates,point3:Se(f.detail.lngLat.toArray(),.01,0).geometry.coordinates,kind:"cycling",score:"X",name:"",notes:""}],o),await g({kind:"movement",idx:o.jat[i][r].movements.length-1}))}}}async function I(f){await g({kind:"movement",idx:f.detail.features[0].id})}It(()=>{m(!1)});function h(f){let b={type:"FeatureCollection",features:f.jat[i][r].movements.map((te,ie)=>w(te,ie))};for(let te of f.jat[i][r].movements)if(b.features.push(E(te,b.features.length)),te.kind=="walking & wheeling"){let ie={...te,point1:te.point3,point3:te.point1};b.features.push(E(ie,b.features.length))}return b}function w(f,b){return{type:"Feature",id:b,properties:{name:f.name,kind:f.kind,color:S[f.score]},geometry:{type:"LineString",coordinates:[f.point1,f.point2,f.point3]}}}function E(f,b){return{type:"Feature",id:b,properties:{kind:f.kind,color:S[f.score],angle:Me(f.point2,f.point3)},geometry:{type:"Point",coordinates:f.point3}}}function m(f){let b=h(o);for(let te of o.jat[i][r].arms)b.features.push(tt(te,b.features.length));for(let te of o.summary.networkMap.features)b.features.push(te);b.features.length>0&&j.fitBounds(zt(b),{padding:20,animate:f})}function d(){return j}const $=()=>l(0,a={mode:"new-arm"}),U=()=>l(0,a={mode:"new-movement"});function T(f,b){n.$$.not_equal(b.point,f)&&(b.point=f,ne.set(o))}const W=f=>g({kind:"arm",idx:f}),v=f=>g({kind:"arm",idx:f});function C(f,b){n.$$.not_equal(b.point1,f)&&(b.point1=f,ne.set(o))}const ee=f=>g({kind:"movement",idx:f}),ae=f=>g({kind:"movement",idx:f});function Y(f,b){n.$$.not_equal(b.point2,f)&&(b.point2=f,ne.set(o))}const J=f=>g({kind:"movement",idx:f}),G=f=>g({kind:"movement",idx:f});function le(f,b){n.$$.not_equal(b.point3,f)&&(b.point3=f,ne.set(o))}const V=f=>g({kind:"movement",idx:f}),fe=f=>g({kind:"movement",idx:f});function N(f){j=f,l(7,j)}return n.$$set=f=>{"junctionIdx"in f&&l(1,i=f.junctionIdx),"stage"in f&&l(2,r=f.stage),"mode"in f&&l(0,a=f.mode),"hoveringSidebar"in f&&l(13,s=f.hoveringSidebar),"streetviewOn"in f&&l(14,u=f.streetviewOn),"showRoute"in f&&l(3,c=f.showRoute),"select"in f&&l(4,g=f.select),"stopEditing"in f&&l(5,_=f.stopEditing)},n.$$.update=()=>{n.$$.dirty[0]&8257&&l(8,t=A(o,a,s))},[a,i,r,c,g,_,o,j,t,S,M,I,h,s,u,m,d,$,U,T,W,v,C,ee,ae,Y,J,G,le,V,fe,N]}class In extends je{constructor(e){super(),ye(this,e,Sn,En,be,{junctionIdx:1,stage:2,mode:0,hoveringSidebar:13,streetviewOn:14,showRoute:3,select:4,stopEditing:5,zoom:15,getMap:16},null,[-1,-1])}get zoom(){return this.$$.ctx[15]}get getMap(){return this.$$.ctx[16]}}function nt(n,e,l){const t=n.slice();return t[5]=e[l],t}function lt(n,e,l){const t=n.slice();return t[5]=e[l],t}function ot(n,e,l){const t=n.slice();return t[5]=e[l],t}function rt(n){let e,l=n[5]+"",t;return{c(){e=X("li"),t=R(l)},l(o){e=Z(o,"LI",{});var i=K(e);t=H(i,l),i.forEach(p)},m(o,i){k(o,e,i),B(e,t)},p(o,i){i&4&&l!==(l=o[5]+"")&&re(t,l)},d(o){o&&p(e)}}}function it(n){let e,l=n[5]+"",t;return{c(){e=X("li"),t=R(l)},l(o){e=Z(o,"LI",{});var i=K(e);t=H(i,l),i.forEach(p)},m(o,i){k(o,e,i),B(e,t)},p(o,i){i&8&&l!==(l=o[5]+"")&&re(t,l)},d(o){o&&p(e)}}}function at(n){let e,l=n[5]+"",t;return{c(){e=X("li"),t=R(l)},l(o){e=Z(o,"LI",{});var i=K(e);t=H(i,l),i.forEach(p)},m(o,i){k(o,e,i),B(e,t)},p(o,i){i&16&&l!==(l=o[5]+"")&&re(t,l)},d(o){o&&p(e)}}}function Nn(n){let e,l,t,o,i,r,a,s=`<th class="has-hover score-zero-header svelte-1ted965">Score = 0
      <span class="hover-text svelte-1ted965">Suitable only for confident existing cyclists, and may be avoided by
        some experienced cyclists Conditions are most likely to give rise to the
        most common collision types</span></th> <th class="has-hover score-one-header svelte-1ted965">Score = 1
      <span class="hover-text svelte-1ted965">Likely to be more acceptable to most cyclists, but may still pose
        problems for less confident or new cyclists The risk of collisions has
        been reduced by design layout or traffic management interventions</span></th> <th class="has-hover score-two-header svelte-1ted965">Score = 2
      <span class="hover-text svelte-1ted965">Suitable for all potential and existing cyclists The potential for
        collisions has been removed, or managed to a high standard of safety for
        cyclists</span></th>`,u,c,g,_,j,S,A,M,I,h,w=ue(n[2]),E=[];for(let T=0;T<w.length;T+=1)E[T]=rt(ot(n,w,T));let m=ue(n[3]),d=[];for(let T=0;T<m.length;T+=1)d[T]=it(lt(n,m,T));let $=ue(n[4]),U=[];for(let T=0;T<$.length;T+=1)U[T]=at(nt(n,$,T));return{c(){e=X("h3"),l=R(n[0]),t=R(": "),o=R(n[1]),i=P(),r=X("table"),a=X("tr"),a.innerHTML=s,u=P(),c=X("tr"),g=X("td"),_=X("ul");for(let T=0;T<E.length;T+=1)E[T].c();j=P(),S=X("td"),A=X("ul");for(let T=0;T<d.length;T+=1)d[T].c();M=P(),I=X("td"),h=X("ul");for(let T=0;T<U.length;T+=1)U[T].c();this.h()},l(T){e=Z(T,"H3",{});var W=K(e);l=H(W,n[0]),t=H(W,": "),o=H(W,n[1]),W.forEach(p),i=D(T),r=Z(T,"TABLE",{});var v=K(r);a=Z(v,"TR",{"data-svelte-h":!0}),we(a)!=="svelte-1slbcvq"&&(a.innerHTML=s),u=D(v),c=Z(v,"TR",{});var C=K(c);g=Z(C,"TD",{class:!0});var ee=K(g);_=Z(ee,"UL",{});var ae=K(_);for(let V=0;V<E.length;V+=1)E[V].l(ae);ae.forEach(p),ee.forEach(p),j=D(C),S=Z(C,"TD",{class:!0});var Y=K(S);A=Z(Y,"UL",{});var J=K(A);for(let V=0;V<d.length;V+=1)d[V].l(J);J.forEach(p),Y.forEach(p),M=D(C),I=Z(C,"TD",{class:!0});var G=K(I);h=Z(G,"UL",{});var le=K(h);for(let V=0;V<U.length;V+=1)U[V].l(le);le.forEach(p),G.forEach(p),C.forEach(p),v.forEach(p),this.h()},h(){oe(g,"class","score-zero svelte-1ted965"),oe(S,"class","score-one svelte-1ted965"),oe(I,"class","score-two svelte-1ted965")},m(T,W){k(T,e,W),B(e,l),B(e,t),B(e,o),k(T,i,W),k(T,r,W),B(r,a),B(r,u),B(r,c),B(c,g),B(g,_);for(let v=0;v<E.length;v+=1)E[v]&&E[v].m(_,null);B(c,j),B(c,S),B(S,A);for(let v=0;v<d.length;v+=1)d[v]&&d[v].m(A,null);B(c,M),B(c,I),B(I,h);for(let v=0;v<U.length;v+=1)U[v]&&U[v].m(h,null)},p(T,[W]){if(W&1&&re(l,T[0]),W&2&&re(o,T[1]),W&4){w=ue(T[2]);let v;for(v=0;v<w.length;v+=1){const C=ot(T,w,v);E[v]?E[v].p(C,W):(E[v]=rt(C),E[v].c(),E[v].m(_,null))}for(;v<E.length;v+=1)E[v].d(1);E.length=w.length}if(W&8){m=ue(T[3]);let v;for(v=0;v<m.length;v+=1){const C=lt(T,m,v);d[v]?d[v].p(C,W):(d[v]=it(C),d[v].c(),d[v].m(A,null))}for(;v<d.length;v+=1)d[v].d(1);d.length=m.length}if(W&16){$=ue(T[4]);let v;for(v=0;v<$.length;v+=1){const C=nt(T,$,v);U[v]?U[v].p(C,W):(U[v]=at(C),U[v].c(),U[v].m(h,null))}for(;v<U.length;v+=1)U[v].d(1);U.length=$.length}},i:ve,o:ve,d(T){T&&(p(e),p(i),p(r)),he(E,T),he(d,T),he(U,T)}}}function Bn(n,e,l){let{junctionType:t}=e,{cycleMovement:o}=e,{scoreZeroBullets:i}=e,{scoreOneBullets:r}=e,{scoreTwoBullets:a}=e;return n.$$set=s=>{"junctionType"in s&&l(0,t=s.junctionType),"cycleMovement"in s&&l(1,o=s.cycleMovement),"scoreZeroBullets"in s&&l(2,i=s.scoreZeroBullets),"scoreOneBullets"in s&&l(3,r=s.scoreOneBullets),"scoreTwoBullets"in s&&l(4,a=s.scoreTwoBullets)},[t,o,i,r,a]}class An extends je{constructor(e){super(),ye(this,e,Bn,Nn,be,{junctionType:0,cycleMovement:1,scoreZeroBullets:2,scoreOneBullets:3,scoreTwoBullets:4})}}function Pn(n){let e,l="Generic Guidance",t,o,i;return o=new An({props:{junctionType:"Any type of junction",cycleMovement:"Any movement",scoreZeroBullets:["Cycle movement in potential conflict with heavy motor traffic flow","Cycle movement mixed with or crossing traffic with 85th percentile speed exceeding 60kph, or where vehicles accelerate rapidly.","Necessary to cross more than one traffic lane (without refuge or protection) to complete cycle movement unless traffic flows are low.","Cycle movementcrosses wide junctionentry or exit: e.g. withmerge or diverge taper or slip lane.","Pinch points on junction entry or exit (lane width 3.2m-3.9m).","Cycle movement affected by very poor surface quality utility reinstatement, gully positioning, debris."],scoreOneBullets:["Cycle movement in potential conflict with moderate traffic flow.","Cycle lanes through junction meeting appropriate desirable minimum width requirements for the movement under consideration.","Raised table at junction crossed by traffic in potential conflict with cycle movement.","Cycle movement made by transiting onto section of shared use footway."],scoreTwoBullets:["Low traffic speed and volume in mixed traffic environment (e.g. accessonly streets in a residential area).","Cycle movement separated physically and/or in time from motor traffic and also separated from pedestrians.","Cycle movement bypasses junction completely, including via good quality grade separation"]}}),{c(){e=X("h3"),e.textContent=l,t=P(),F(o.$$.fragment)},l(r){e=Z(r,"H3",{"data-svelte-h":!0}),we(e)!=="svelte-183clep"&&(e.textContent=l),t=D(r),O(o.$$.fragment,r)},m(r,a){k(r,e,a),k(r,t,a),q(o,r,a),i=!0},p:ve,i(r){i||(y(o.$$.fragment,r),i=!0)},o(r){L(o.$$.fragment,r),i=!1},d(r){r&&(p(e),p(t)),z(o,r)}}}class Dn extends je{constructor(e){super(),ye(this,e,null,Pn,be,{})}}function Un(n){let e,l,t,o,i,r,a,s,u,c,g,_,j,S;function A($){n[5]($)}let M={label:"Name"};n[3].jat[n[0]][n[1]].movements[n[2]].name!==void 0&&(M.value=n[3].jat[n[0]][n[1]].movements[n[2]].name),e=new ze({props:M}),se.push(()=>_e(e,"value",A));function I($){n[6]($)}let h={label:"Movement",choices:[["cycling","Cycling"],["walking & wheeling","Walking & Wheeling"]]};n[3].jat[n[0]][n[1]].movements[n[2]].kind!==void 0&&(h.value=n[3].jat[n[0]][n[1]].movements[n[2]].kind),o=new We({props:h}),se.push(()=>_e(o,"value",I));function w($){n[7]($)}let E={label:"Score",choices:n[4]};n[3].jat[n[0]][n[1]].movements[n[2]].score!==void 0&&(E.value=n[3].jat[n[0]][n[1]].movements[n[2]].score),a=new We({props:E}),se.push(()=>_e(a,"value",w));function m($){n[8]($)}let d={label:"Comments"};return n[3].jat[n[0]][n[1]].movements[n[2]].notes!==void 0&&(d.value=n[3].jat[n[0]][n[1]].movements[n[2]].notes),c=new Lt({props:d}),se.push(()=>_e(c,"value",m)),j=new Dn({}),{c(){F(e.$$.fragment),t=P(),F(o.$$.fragment),r=P(),F(a.$$.fragment),u=P(),F(c.$$.fragment),_=P(),F(j.$$.fragment)},l($){O(e.$$.fragment,$),t=D($),O(o.$$.fragment,$),r=D($),O(a.$$.fragment,$),u=D($),O(c.$$.fragment,$),_=D($),O(j.$$.fragment,$)},m($,U){q(e,$,U),k($,t,U),q(o,$,U),k($,r,U),q(a,$,U),k($,u,U),q(c,$,U),k($,_,U),q(j,$,U),S=!0},p($,[U]){const T={};!l&&U&15&&(l=!0,T.value=$[3].jat[$[0]][$[1]].movements[$[2]].name,me(()=>l=!1)),e.$set(T);const W={};!i&&U&15&&(i=!0,W.value=$[3].jat[$[0]][$[1]].movements[$[2]].kind,me(()=>i=!1)),o.$set(W);const v={};!s&&U&15&&(s=!0,v.value=$[3].jat[$[0]][$[1]].movements[$[2]].score,me(()=>s=!1)),a.$set(v);const C={};!g&&U&15&&(g=!0,C.value=$[3].jat[$[0]][$[1]].movements[$[2]].notes,me(()=>g=!1)),c.$set(C)},i($){S||(y(e.$$.fragment,$),y(o.$$.fragment,$),y(a.$$.fragment,$),y(c.$$.fragment,$),y(j.$$.fragment,$),S=!0)},o($){L(e.$$.fragment,$),L(o.$$.fragment,$),L(a.$$.fragment,$),L(c.$$.fragment,$),L(j.$$.fragment,$),S=!1},d($){$&&(p(t),p(r),p(u),p(_)),z(e,$),z(o,$),z(a,$),z(c,$),z(j,$)}}}function Fn(n,e,l){let t;Ne(n,ne,_=>l(3,t=_));let{junctionIdx:o}=e,{stage:i}=e,{idx:r}=e,a=[["X","X - black"],["0","0 - red"],["1","1 - amber"],["2","2 - green"]];function s(_){n.$$.not_equal(t.jat[o][i].movements[r].name,_)&&(t.jat[o][i].movements[r].name=_,ne.set(t))}function u(_){n.$$.not_equal(t.jat[o][i].movements[r].kind,_)&&(t.jat[o][i].movements[r].kind=_,ne.set(t))}function c(_){n.$$.not_equal(t.jat[o][i].movements[r].score,_)&&(t.jat[o][i].movements[r].score=_,ne.set(t))}function g(_){n.$$.not_equal(t.jat[o][i].movements[r].notes,_)&&(t.jat[o][i].movements[r].notes=_,ne.set(t))}return n.$$set=_=>{"junctionIdx"in _&&l(0,o=_.junctionIdx),"stage"in _&&l(1,i=_.stage),"idx"in _&&l(2,r=_.idx)},[o,i,r,t,a,s,u,c,g]}class On extends je{constructor(e){super(),ye(this,e,Fn,Un,be,{junctionIdx:0,stage:1,idx:2})}}function pe(n){if(n.movements.length==0)return"No movements added";let e=0,l=0;for(let o of n.movements)e+={0:0,1:1,2:2,X:0}[o.score],l+=2;let t=e/l*100;return`${Math.round(t)}%`}var qn=Object.defineProperty,zn=(n,e)=>qn(n,"name",{value:e,configurable:!0});function St(n,e={}){const l=Ht(n),t=(l[0]+l[2])/2,o=(l[1]+l[3])/2;return yt([t,o],e.properties,e)}zn(St,"center");var Rn=St;function Hn(n){let e=Rn({type:"FeatureCollection",features:n.map(t=>({type:"Feature",geometry:{type:"Point",coordinates:t.point},properties:{}}))}).geometry.coordinates;n.sort((t,o)=>st(Me(e,o.point))-st(Me(e,t.point)));let l=[];for(let t=0;t<n.length;t++){let o=n[t],i=Me(o.point,e),r=1;for(let a of Jn(t,n.length)){let s=n[a],u=Me(e,s.point),c=Gn(o.point,e,r++),g=Gt(o.point,e),_=Se(c,.5*g,i).geometry.coordinates,j=Se(_,.2*g,u).geometry.coordinates;l.push({point1:c,point2:_,point3:j,kind:"cycling",score:"X",name:`${o.name} to ${s.name}`,notes:""})}}return l}function Gn(n,e,l){let t=.003,i=Me(n,e)-90,r=t*l;return Se(n,r,i).geometry.coordinates}function st(n){return(n+360)%360}function Jn(n,e){let l=[];for(let t=n+1;t<e;t++)l.push(t);for(let t=0;t<n;t++)l.push(t);return l}const{window:Vn}=Dt;function ft(n,e,l){const t=n.slice();t[34]=e[l],t[37]=l;const o=t[16][t[34].score];return t[35]=o,t}function ut(n,e,l){const t=n.slice();return t[38]=e[l],t[37]=l,t}function Xn(n){let e,l,t,o,i,r,a,s;e=new qe({props:{$$slots:{default:[Wn]},$$scope:{ctx:n}}}),e.$on("click",n[11]),t=new Re({props:{$$slots:{default:[Kn]},$$scope:{ctx:n}}}),t.$on("click",n[12]);const u=[Yn,Qn],c=[];function g(_,j){return _[2].id.kind=="movement"?0:1}return i=g(n),r=c[i]=u[i](n),{c(){F(e.$$.fragment),l=P(),F(t.$$.fragment),o=P(),r.c(),a=ce()},l(_){O(e.$$.fragment,_),l=D(_),O(t.$$.fragment,_),o=D(_),r.l(_),a=ce()},m(_,j){q(e,_,j),k(_,l,j),q(t,_,j),k(_,o,j),c[i].m(_,j),k(_,a,j),s=!0},p(_,j){const S={};j[1]&2&&(S.$$scope={dirty:j,ctx:_}),e.$set(S);const A={};j[1]&2&&(A.$$scope={dirty:j,ctx:_}),t.$set(A);let M=i;i=g(_),i===M?c[i].p(_,j):(de(),L(c[M],1,1,()=>{c[M]=null}),ge(),r=c[i],r?r.p(_,j):(r=c[i]=u[i](_),r.c()),y(r,1),r.m(a.parentNode,a))},i(_){s||(y(e.$$.fragment,_),y(t.$$.fragment,_),y(r),s=!0)},o(_){L(e.$$.fragment,_),L(t.$$.fragment,_),L(r),s=!1},d(_){_&&(p(l),p(o),p(a)),z(e,_),z(t,_),c[i].d(_)}}}function Zn(n){let e,l,t,o,i="Arms",r,a,s,u,c="Movements",g,_,j,S,A,M,I=(n[8].jat[n[0]].name||"Untitled junction")+"",h,w,E=pe(n[8].jat[n[0]][n[1]])+"",m,d,$,U,T,W,v;const C=n[18].default,ee=vt(C,n,n[32],null);l=new Pt({props:{label:"Tools",$$slots:{default:[ll]},$$scope:{ctx:n}}});let ae=ue(n[8].jat[n[0]][n[1]].arms),Y=[];for(let f=0;f<ae.length;f+=1)Y[f]=ct(ut(n,ae,f));const J=f=>L(Y[f],1,1,()=>{Y[f]=null});let G=n[8].jat[n[0]][n[9]].arms.length>0&&mt(n);$=new Ce({props:{disabled:n[8].jat[n[0]][n[1]].arms.length<2,$$slots:{default:[rl]},$$scope:{ctx:n}}}),$.$on("click",n[17]);let le=ue(n[8].jat[n[0]][n[1]].movements),V=[];for(let f=0;f<le.length;f+=1)V[f]=_t(ft(n,le,f));const fe=f=>L(V[f],1,1,()=>{V[f]=null});let N=n[8].jat[n[0]][n[9]].movements.length>0&&dt(n);return{c(){ee&&ee.c(),e=P(),F(l.$$.fragment),t=P(),o=X("h3"),o.textContent=i,r=P();for(let f=0;f<Y.length;f+=1)Y[f].c();a=P(),G&&G.c(),s=P(),u=X("h3"),u.textContent=c,g=P(),_=X("p"),j=R("Total JAT score for "),S=R(n[1]),A=P(),M=X("u"),h=R(I),w=R(`
        : `),m=R(E),d=P(),F($.$$.fragment),U=P();for(let f=0;f<V.length;f+=1)V[f].c();T=P(),N&&N.c(),W=ce()},l(f){ee&&ee.l(f),e=D(f),O(l.$$.fragment,f),t=D(f),o=Z(f,"H3",{"data-svelte-h":!0}),we(o)!=="svelte-ld74qb"&&(o.textContent=i),r=D(f);for(let ie=0;ie<Y.length;ie+=1)Y[ie].l(f);a=D(f),G&&G.l(f),s=D(f),u=Z(f,"H3",{"data-svelte-h":!0}),we(u)!=="svelte-1dc52s8"&&(u.textContent=c),g=D(f),_=Z(f,"P",{});var b=K(_);j=H(b,"Total JAT score for "),S=H(b,n[1]),A=D(b),M=Z(b,"U",{});var te=K(M);h=H(te,I),te.forEach(p),w=H(b,`
        : `),m=H(b,E),b.forEach(p),d=D(f),O($.$$.fragment,f),U=D(f);for(let ie=0;ie<V.length;ie+=1)V[ie].l(f);T=D(f),N&&N.l(f),W=ce()},m(f,b){ee&&ee.m(f,b),k(f,e,b),q(l,f,b),k(f,t,b),k(f,o,b),k(f,r,b);for(let te=0;te<Y.length;te+=1)Y[te]&&Y[te].m(f,b);k(f,a,b),G&&G.m(f,b),k(f,s,b),k(f,u,b),k(f,g,b),k(f,_,b),B(_,j),B(_,S),B(_,A),B(_,M),B(M,h),B(_,w),B(_,m),k(f,d,b),q($,f,b),k(f,U,b);for(let te=0;te<V.length;te+=1)V[te]&&V[te].m(f,b);k(f,T,b),N&&N.m(f,b),k(f,W,b),v=!0},p(f,b){ee&&ee.p&&(!v||b[1]&2)&&bt(ee,C,f,f[32],v?wt(C,f[32],b,null):kt(f[32]),null);const te={};if(b[0]&112|b[1]&2&&(te.$$scope={dirty:b,ctx:f}),l.$set(te),b[0]&1291){ae=ue(f[8].jat[f[0]][f[1]].arms);let Q;for(Q=0;Q<ae.length;Q+=1){const Te=ut(f,ae,Q);Y[Q]?(Y[Q].p(Te,b),y(Y[Q],1)):(Y[Q]=ct(Te),Y[Q].c(),y(Y[Q],1),Y[Q].m(a.parentNode,a))}for(de(),Q=ae.length;Q<Y.length;Q+=1)J(Q);ge()}f[8].jat[f[0]][f[9]].arms.length>0?G?(G.p(f,b),b[0]&257&&y(G,1)):(G=mt(f),G.c(),y(G,1),G.m(s.parentNode,s)):G&&(de(),L(G,1,1,()=>{G=null}),ge()),(!v||b[0]&2)&&re(S,f[1]),(!v||b[0]&257)&&I!==(I=(f[8].jat[f[0]].name||"Untitled junction")+"")&&re(h,I),(!v||b[0]&259)&&E!==(E=pe(f[8].jat[f[0]][f[1]])+"")&&re(m,E);const ie={};if(b[0]&259&&(ie.disabled=f[8].jat[f[0]][f[1]].arms.length<2),b[1]&2&&(ie.$$scope={dirty:b,ctx:f}),$.$set(ie),b[0]&66827){le=ue(f[8].jat[f[0]][f[1]].movements);let Q;for(Q=0;Q<le.length;Q+=1){const Te=ft(f,le,Q);V[Q]?(V[Q].p(Te,b),y(V[Q],1)):(V[Q]=_t(Te),V[Q].c(),y(V[Q],1),V[Q].m(T.parentNode,T))}for(de(),Q=le.length;Q<V.length;Q+=1)fe(Q);ge()}f[8].jat[f[0]][f[9]].movements.length>0?N?(N.p(f,b),b[0]&257&&y(N,1)):(N=dt(f),N.c(),y(N,1),N.m(W.parentNode,W)):N&&(de(),L(N,1,1,()=>{N=null}),ge())},i(f){if(!v){y(ee,f),y(l.$$.fragment,f);for(let b=0;b<ae.length;b+=1)y(Y[b]);y(G),y($.$$.fragment,f);for(let b=0;b<le.length;b+=1)y(V[b]);y(N),v=!0}},o(f){L(ee,f),L(l.$$.fragment,f),Y=Y.filter(Boolean);for(let b=0;b<Y.length;b+=1)L(Y[b]);L(G),L($.$$.fragment,f),V=V.filter(Boolean);for(let b=0;b<V.length;b+=1)L(V[b]);L(N),v=!1},d(f){f&&(p(e),p(t),p(o),p(r),p(a),p(s),p(u),p(g),p(_),p(d),p(U),p(T),p(W)),ee&&ee.d(f),z(l,f),he(Y,f),G&&G.d(f),z($,f),he(V,f),N&&N.d(f)}}}function Wn(n){let e;return{c(){e=R("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Kn(n){let e;return{c(){e=R("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function Qn(n){let e,l,t;function o(r){n[29](r)}let i={label:"Arm Name"};return n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name!==void 0&&(i.value=n[8].jat[n[0]][n[1]].arms[n[2].id.idx].name),e=new ze({props:i}),se.push(()=>_e(e,"value",o)),{c(){F(e.$$.fragment)},l(r){O(e.$$.fragment,r)},m(r,a){q(e,r,a),t=!0},p(r,a){const s={};!l&&a[0]&263&&(l=!0,s.value=r[8].jat[r[0]][r[1]].arms[r[2].id.idx].name,me(()=>l=!1)),e.$set(s)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){L(e.$$.fragment,r),t=!1},d(r){z(e,r)}}}function Yn(n){let e,l,t,o,i,r;return e=new On({props:{junctionIdx:n[0],stage:n[1],idx:n[2].id.idx}}),t=new qe({props:{$$slots:{default:[xn]},$$scope:{ctx:n}}}),t.$on("click",n[11]),i=new Re({props:{$$slots:{default:[el]},$$scope:{ctx:n}}}),i.$on("click",n[12]),{c(){F(e.$$.fragment),l=P(),F(t.$$.fragment),o=P(),F(i.$$.fragment)},l(a){O(e.$$.fragment,a),l=D(a),O(t.$$.fragment,a),o=D(a),O(i.$$.fragment,a)},m(a,s){q(e,a,s),k(a,l,s),q(t,a,s),k(a,o,s),q(i,a,s),r=!0},p(a,s){const u={};s[0]&1&&(u.junctionIdx=a[0]),s[0]&2&&(u.stage=a[1]),s[0]&4&&(u.idx=a[2].id.idx),e.$set(u);const c={};s[1]&2&&(c.$$scope={dirty:s,ctx:a}),t.$set(c);const g={};s[1]&2&&(g.$$scope={dirty:s,ctx:a}),i.$set(g)},i(a){r||(y(e.$$.fragment,a),y(t.$$.fragment,a),y(i.$$.fragment,a),r=!0)},o(a){L(e.$$.fragment,a),L(t.$$.fragment,a),L(i.$$.fragment,a),r=!1},d(a){a&&(p(l),p(o)),z(e,a),z(t,a),z(i,a)}}}function xn(n){let e;return{c(){e=R("Save")},l(l){e=H(l,"Save")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function el(n){let e;return{c(){e=R("Delete")},l(l){e=H(l,"Delete")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function tl(n){let e;return{c(){e=R("Zoom to fit")},l(l){e=H(l,"Zoom to fit")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function nl(n){let e;return{c(){e=R("Show route")},l(l){e=H(l,"Show route")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function ll(n){var I;let e,l,t,o,i,r,a,s,u,c,g,_;e=new Ce({props:{$$slots:{default:[tl]},$$scope:{ctx:n}}}),e.$on("click",n[20]),t=new Kt({}),i=new Zt({});function j(h){n[21](h)}let S={map:(I=n[6])==null?void 0:I.getMap()};n[4]!==void 0&&(S.enabled=n[4]),a=new Wt({props:S}),se.push(()=>_e(a,"enabled",j));function A(h){n[22](h)}let M={$$slots:{default:[nl]},$$scope:{ctx:n}};return n[5]!==void 0&&(M.checked=n[5]),c=new Qt({props:M}),se.push(()=>_e(c,"checked",A)),{c(){F(e.$$.fragment),l=P(),F(t.$$.fragment),o=P(),F(i.$$.fragment),r=P(),F(a.$$.fragment),u=P(),F(c.$$.fragment)},l(h){O(e.$$.fragment,h),l=D(h),O(t.$$.fragment,h),o=D(h),O(i.$$.fragment,h),r=D(h),O(a.$$.fragment,h),u=D(h),O(c.$$.fragment,h)},m(h,w){q(e,h,w),k(h,l,w),q(t,h,w),k(h,o,w),q(i,h,w),k(h,r,w),q(a,h,w),k(h,u,w),q(c,h,w),_=!0},p(h,w){var $;const E={};w[1]&2&&(E.$$scope={dirty:w,ctx:h}),e.$set(E);const m={};w[0]&64&&(m.map=($=h[6])==null?void 0:$.getMap()),!s&&w[0]&16&&(s=!0,m.enabled=h[4],me(()=>s=!1)),a.$set(m);const d={};w[1]&2&&(d.$$scope={dirty:w,ctx:h}),!g&&w[0]&32&&(g=!0,d.checked=h[5],me(()=>g=!1)),c.$set(d)},i(h){_||(y(e.$$.fragment,h),y(t.$$.fragment,h),y(i.$$.fragment,h),y(a.$$.fragment,h),y(c.$$.fragment,h),_=!0)},o(h){L(e.$$.fragment,h),L(t.$$.fragment,h),L(i.$$.fragment,h),L(a.$$.fragment,h),L(c.$$.fragment,h),_=!1},d(h){h&&(p(l),p(o),p(r),p(u)),z(e,h),z(t,h),z(i,h),z(a,h),z(c,h)}}}function ct(n){let e,l;function t(){return n[23](n[37])}function o(){return n[24](n[37])}return e=new He({props:{name:`${gt(n[37])} - ${n[38].name||"Unnamed arm"}`}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[25]),{c(){F(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,r){q(e,i,r),l=!0},p(i,r){n=i;const a={};r[0]&259&&(a.name=`${gt(n[37])} - ${n[38].name||"Unnamed arm"}`),e.$set(a)},i(i){l||(y(e.$$.fragment,i),l=!0)},o(i){L(e.$$.fragment,i),l=!1},d(i){z(e,i)}}}function mt(n){let e,l;return e=new Ce({props:{$$slots:{default:[ol]},$$scope:{ctx:n}}}),e.$on("click",n[14]),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o[1]&2&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function ol(n){let e,l;return{c(){e=R("Copy arms from "),l=R(n[9])},l(t){e=H(t,"Copy arms from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:ve,d(t){t&&(p(e),p(l))}}}function rl(n){let e;return{c(){e=R("Generate cycling movements between all arms")},l(l){e=H(l,"Generate cycling movements between all arms")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function il(n){let e,l,t,o=n[34].score+"",i,r,a,s=Ve(n[34].kind)+"",u;return{c(){e=X("div"),l=X("span"),t=R("Score: "),i=R(o),r=P(),a=X("span"),u=R(s),this.h()},l(c){e=Z(c,"DIV",{style:!0});var g=K(e);l=Z(g,"SPAN",{style:!0});var _=K(l);t=H(_,"Score: "),i=H(_,o),_.forEach(p),r=D(g),a=Z(g,"SPAN",{});var j=K(a);u=H(j,s),j.forEach(p),g.forEach(p),this.h()},h(){x(l,"padding","4px"),x(l,"color",n[35].font),x(l,"background-color",n[35].background),x(e,"width","100%"),x(e,"display","flex"),x(e,"justify-content","space-between")},m(c,g){k(c,e,g),B(e,l),B(l,t),B(l,i),B(e,r),B(e,a),B(a,u)},p(c,g){g[0]&259&&o!==(o=c[34].score+"")&&re(i,o),g[0]&259&&x(l,"color",c[35].font),g[0]&259&&x(l,"background-color",c[35].background),g[0]&259&&s!==(s=Ve(c[34].kind)+"")&&re(u,s)},d(c){c&&p(e)}}}function _t(n){let e,l;function t(){return n[26](n[37])}function o(){return n[27](n[37])}return e=new He({props:{name:n[34].name||"Unnamed movement",$$slots:{default:[il]},$$scope:{ctx:n}}}),e.$on("click",t),e.$on("mouseenter",o),e.$on("mouseleave",n[28]),{c(){F(e.$$.fragment)},l(i){O(e.$$.fragment,i)},m(i,r){q(e,i,r),l=!0},p(i,r){n=i;const a={};r[0]&259&&(a.name=n[34].name||"Unnamed movement"),r[0]&259|r[1]&2&&(a.$$scope={dirty:r,ctx:n}),e.$set(a)},i(i){l||(y(e.$$.fragment,i),l=!0)},o(i){L(e.$$.fragment,i),l=!1},d(i){z(e,i)}}}function dt(n){let e,l;return e=new Ce({props:{$$slots:{default:[al]},$$scope:{ctx:n}}}),e.$on("click",n[15]),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o[1]&2&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function al(n){let e,l;return{c(){e=R("Copy movements from "),l=R(n[9])},l(t){e=H(t,"Copy movements from "),l=H(t,n[9])},m(t,o){k(t,e,o),k(t,l,o)},p:ve,d(t){t&&(p(e),p(l))}}}function sl(n){let e,l,t,o,i,r,a,s=pe(n[8].jat[n[0]].existing)+"",u,c,g,_=pe(n[8].jat[n[0]].proposed)+"",j,S,A,M,I,h,w,E,m,d,$,U,T;function W(J){n[19](J)}let v={label:"Commentary / Notes about "+n[1]+" junction"};n[8].jat[n[0]][n[1]].notes!==void 0&&(v.value=n[8].jat[n[0]][n[1]].notes),l=new Lt({props:v}),se.push(()=>_e(l,"value",W));const C=[Zn,Xn],ee=[];function ae(J,G){return J[2].mode!="editing"?0:1}h=ae(n),w=ee[h]=C[h](n);let Y={junctionIdx:n[0],stage:n[1],mode:n[2],hoveringSidebar:n[3],streetviewOn:n[4],showRoute:n[5],select:n[10],stopEditing:n[11]};return d=new In({props:Y}),n[31](d),{c(){e=X("div"),F(l.$$.fragment),o=P(),i=X("p"),r=R("Total JAT score: "),a=X("b"),u=R(s),c=R(`
    existing,
    `),g=X("b"),j=R(_),S=R(`
    proposed`),A=P(),M=X("div"),I=X("div"),w.c(),E=P(),m=X("div"),F(d.$$.fragment),this.h()},l(J){e=Z(J,"DIV",{class:!0});var G=K(e);O(l.$$.fragment,G),o=D(G),i=Z(G,"P",{});var le=K(i);r=H(le,"Total JAT score: "),a=Z(le,"B",{});var V=K(a);u=H(V,s),V.forEach(p),c=H(le,`
    existing,
    `),g=Z(le,"B",{});var fe=K(g);j=H(fe,_),fe.forEach(p),S=H(le,`
    proposed`),le.forEach(p),G.forEach(p),A=D(J),M=Z(J,"DIV",{style:!0});var N=K(M);I=Z(N,"DIV",{style:!0});var f=K(I);w.l(f),f.forEach(p),E=D(N),m=Z(N,"DIV",{style:!0});var b=K(m);O(d.$$.fragment,b),b.forEach(p),N.forEach(p),this.h()},h(){oe(e,"class","govuk-width-container"),x(I,"width","30%"),x(I,"overflow-y","scroll"),x(I,"padding","10px"),x(I,"border","1px solid black"),x(m,"position","relative"),x(m,"width","100%"),x(M,"display","flex"),x(M,"height","80vh")},m(J,G){k(J,e,G),q(l,e,null),B(e,o),B(e,i),B(i,r),B(i,a),B(a,u),B(i,c),B(i,g),B(g,j),B(i,S),k(J,A,G),k(J,M,G),B(M,I),ee[h].m(I,null),n[30](I),B(M,E),B(M,m),q(d,m,null),$=!0,U||(T=Bt(Vn,"keydown",n[13]),U=!0)},p(J,G){const le={};G[0]&2&&(le.label="Commentary / Notes about "+J[1]+" junction"),!t&&G[0]&259&&(t=!0,le.value=J[8].jat[J[0]][J[1]].notes,me(()=>t=!1)),l.$set(le),(!$||G[0]&257)&&s!==(s=pe(J[8].jat[J[0]].existing)+"")&&re(u,s),(!$||G[0]&257)&&_!==(_=pe(J[8].jat[J[0]].proposed)+"")&&re(j,_);let V=h;h=ae(J),h===V?ee[h].p(J,G):(de(),L(ee[V],1,1,()=>{ee[V]=null}),ge(),w=ee[h],w?w.p(J,G):(w=ee[h]=C[h](J),w.c()),y(w,1),w.m(I,null));const fe={};G[0]&1&&(fe.junctionIdx=J[0]),G[0]&2&&(fe.stage=J[1]),G[0]&4&&(fe.mode=J[2]),G[0]&8&&(fe.hoveringSidebar=J[3]),G[0]&16&&(fe.streetviewOn=J[4]),G[0]&32&&(fe.showRoute=J[5]),d.$set(fe)},i(J){$||(y(l.$$.fragment,J),y(w),y(d.$$.fragment,J),$=!0)},o(J){L(l.$$.fragment,J),L(w),L(d.$$.fragment,J),$=!1},d(J){J&&(p(e),p(A),p(M)),z(l),ee[h].d(),n[30](null),n[31](null),z(d),U=!1,T()}}}function gt(n){return String.fromCharCode(n+65)}function fl(n,e,l){let t;Ne(n,ne,N=>l(8,t=N));let{$$slots:o={},$$scope:i}=e,{junctionIdx:r}=e,{stage:a}=e,s=a=="existing"?"proposed":"existing",u={mode:"select"},c=null,g=null,_=!1,j=!0,S=null,A;async function M(N){c=A.scrollTop,l(2,u={mode:"editing",id:N}),l(3,g=null),await Je(),l(7,A.scrollTop=0,A)}async function I(){l(2,u={mode:"select"}),c!=null&&(await Je(),l(7,A.scrollTop=c,A),c=null)}function h(){u.mode=="editing"&&window.confirm(`Delete this ${u.id.kind}?`)&&(u.id.kind=="movement"?(t.jat[r][a].movements.splice(u.id.idx,1),ne.set(t)):(t.jat[r][a].arms.splice(u.id.idx,1),ne.set(t)),I())}function w(N){if(u.mode!="editing")return;let f=N.target.tagName,b=f=="INPUT"||f=="TEXTAREA";N.key=="Escape"||N.key=="Enter"&&!b?(N.stopPropagation(),I()):N.key=="Delete"&&!b&&(N.stopPropagation(),h())}function E(){t.jat[r][a].arms.length>0&&!window.confirm("Overwrite arms?")||(Ee(ne,t.jat[r][a].arms=JSON.parse(JSON.stringify(t.jat[r][s].arms)),t),ne.set(t))}function m(){t.jat[r][a].movements.length>0&&!window.confirm("Overwrite movements?")||(Ee(ne,t.jat[r][a].movements=JSON.parse(JSON.stringify(t.jat[r][s].movements)),t),ne.set(t))}let d={0:$e.red,1:$e.amber,2:$e.green,X:$e.critical};function $(){t.jat[r][a].movements.length>0&&!window.confirm("Overwrite all movements?")||Ee(ne,t.jat[r][a].movements=Hn(t.jat[r][a].arms),t)}function U(N){n.$$.not_equal(t.jat[r][a].notes,N)&&(t.jat[r][a].notes=N,ne.set(t))}const T=()=>S==null?void 0:S.zoom(!0);function W(N){_=N,l(4,_)}function v(N){j=N,l(5,j)}const C=N=>M({kind:"arm",idx:N}),ee=N=>l(3,g={kind:"arm",idx:N}),ae=()=>l(3,g=null),Y=N=>M({kind:"movement",idx:N}),J=N=>l(3,g={kind:"movement",idx:N}),G=()=>l(3,g=null);function le(N){n.$$.not_equal(t.jat[r][a].arms[u.id.idx].name,N)&&(t.jat[r][a].arms[u.id.idx].name=N,ne.set(t))}function V(N){se[N?"unshift":"push"](()=>{A=N,l(7,A)})}function fe(N){se[N?"unshift":"push"](()=>{S=N,l(6,S)})}return n.$$set=N=>{"junctionIdx"in N&&l(0,r=N.junctionIdx),"stage"in N&&l(1,a=N.stage),"$$scope"in N&&l(32,i=N.$$scope)},[r,a,u,g,_,j,S,A,t,s,M,I,h,w,E,m,d,$,o,U,T,W,v,C,ee,ae,Y,J,G,le,V,fe,i]}class ul extends je{constructor(e){super(),ye(this,e,fl,sl,be,{junctionIdx:0,stage:1},null,[-1,-1])}}function pt(n,e,l){const t=n.slice();return t[10]=e[l],t[12]=l,t}function cl(n){let e,l,t=(n[1].jat[n[0].idx].name||"Untitled junction")+"",o,i,r=n[0].stage+"",a,s,u,c,g,_,j,S=n[0].stage,A,M;u=new At({props:{$$slots:{default:[gl]},$$scope:{ctx:n}}});function I(E){n[7](E)}let h={label:"Junction Name"};n[1].jat[n[0].idx].name!==void 0&&(h.value=n[1].jat[n[0].idx].name),g=new ze({props:h}),se.push(()=>_e(g,"value",I));let w=$t(n);return{c(){e=X("div"),l=X("h2"),o=R(t),i=R(" - "),a=R(r),s=P(),F(u.$$.fragment),c=P(),F(g.$$.fragment),j=P(),w.c(),A=ce(),this.h()},l(E){e=Z(E,"DIV",{class:!0});var m=K(e);l=Z(m,"H2",{});var d=K(l);o=H(d,t),i=H(d," - "),a=H(d,r),d.forEach(p),s=D(m),O(u.$$.fragment,m),c=D(m),O(g.$$.fragment,m),m.forEach(p),j=D(E),w.l(E),A=ce(),this.h()},h(){oe(e,"class","govuk-width-container")},m(E,m){k(E,e,m),B(e,l),B(l,o),B(l,i),B(l,a),B(e,s),q(u,e,null),B(e,c),q(g,e,null),k(E,j,m),w.m(E,m),k(E,A,m),M=!0},p(E,m){(!M||m&3)&&t!==(t=(E[1].jat[E[0].idx].name||"Untitled junction")+"")&&re(o,t),(!M||m&1)&&r!==(r=E[0].stage+"")&&re(a,r);const d={};m&8193&&(d.$$scope={dirty:m,ctx:E}),u.$set(d);const $={};!_&&m&3&&(_=!0,$.value=E[1].jat[E[0].idx].name,me(()=>_=!1)),g.$set($),m&1&&be(S,S=E[0].stage)?(de(),L(w,1,1,ve),ge(),w=$t(E),w.c(),y(w,1),w.m(A.parentNode,A)):w.p(E,m)},i(E){M||(y(u.$$.fragment,E),y(g.$$.fragment,E),y(w),M=!0)},o(E){L(u.$$.fragment,E),L(g.$$.fragment,E),L(w),M=!1},d(E){E&&(p(e),p(j),p(A)),z(u),z(g),w.d(E)}}}function ml(n){let e,l,t,o;l=new qe({props:{$$slots:{default:[kl]},$$scope:{ctx:n}}}),l.$on("click",n[2]);let i=ue(n[1].jat),r=[];for(let s=0;s<i.length;s+=1)r[s]=ht(pt(n,i,s));const a=s=>L(r[s],1,1,()=>{r[s]=null});return{c(){e=X("div"),F(l.$$.fragment),t=P();for(let s=0;s<r.length;s+=1)r[s].c();this.h()},l(s){e=Z(s,"DIV",{class:!0});var u=K(e);O(l.$$.fragment,u),t=D(u);for(let c=0;c<r.length;c+=1)r[c].l(u);u.forEach(p),this.h()},h(){oe(e,"class","govuk-width-container")},m(s,u){k(s,e,u),q(l,e,null),B(e,t);for(let c=0;c<r.length;c+=1)r[c]&&r[c].m(e,null);o=!0},p(s,u){const c={};if(u&8192&&(c.$$scope={dirty:u,ctx:s}),l.$set(c),u&3){i=ue(s[1].jat);let g;for(g=0;g<i.length;g+=1){const _=pt(s,i,g);r[g]?(r[g].p(_,u),y(r[g],1)):(r[g]=ht(_),r[g].c(),y(r[g],1),r[g].m(e,null))}for(de(),g=i.length;g<r.length;g+=1)a(g);ge()}},i(s){if(!o){y(l.$$.fragment,s);for(let u=0;u<i.length;u+=1)y(r[u]);o=!0}},o(s){L(l.$$.fragment,s),r=r.filter(Boolean);for(let u=0;u<r.length;u+=1)L(r[u]);o=!1},d(s){s&&p(e),z(l),he(r,s)}}}function _l(n){let e;return{c(){e=R("Back to all junctions")},l(l){e=H(l,"Back to all junctions")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function dl(n){let e;return{c(){e=R("Delete junction")},l(l){e=H(l,"Delete junction")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function gl(n){let e,l,t,o;return e=new Ce({props:{$$slots:{default:[_l]},$$scope:{ctx:n}}}),e.$on("click",n[5]),t=new Re({props:{$$slots:{default:[dl]},$$scope:{ctx:n}}}),t.$on("click",n[6]),{c(){F(e.$$.fragment),l=P(),F(t.$$.fragment)},l(i){O(e.$$.fragment,i),l=D(i),O(t.$$.fragment,i)},m(i,r){q(e,i,r),k(i,l,r),q(t,i,r),o=!0},p(i,r){const a={};r&8192&&(a.$$scope={dirty:r,ctx:i}),e.$set(a);const s={};r&8192&&(s.$$scope={dirty:r,ctx:i}),t.$set(s)},i(i){o||(y(e.$$.fragment,i),y(t.$$.fragment,i),o=!0)},o(i){L(e.$$.fragment,i),L(t.$$.fragment,i),o=!1},d(i){i&&p(l),z(e,i),z(t,i)}}}function pl(n){let e,l;return e=new Ce({props:{$$slots:{default:[hl]},$$scope:{ctx:n}}}),e.$on("click",n[9]),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function $l(n){let e,l;return e=new Ce({props:{$$slots:{default:[vl]},$$scope:{ctx:n}}}),e.$on("click",n[8]),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o&8192&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function hl(n){let e;return{c(){e=R("Edit Proposed")},l(l){e=H(l,"Edit Proposed")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function vl(n){let e;return{c(){e=R("Edit Existing")},l(l){e=H(l,"Edit Existing")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function bl(n){let e,l,t=n[0].stage+"",o,i,r,a=n[1].jat[n[0].idx].name+"",s,u,c,g,_,j;const S=[$l,pl],A=[];function M(I,h){return I[0].stage=="proposed"?0:1}return c=M(n),g=A[c]=S[c](n),{c(){e=X("p"),l=R("Currently editing "),o=R(t),i=R(` junction
        `),r=X("u"),s=R(a),u=P(),g.c(),_=ce()},l(I){e=Z(I,"P",{});var h=K(e);l=H(h,"Currently editing "),o=H(h,t),i=H(h,` junction
        `),r=Z(h,"U",{});var w=K(r);s=H(w,a),w.forEach(p),h.forEach(p),u=D(I),g.l(I),_=ce()},m(I,h){k(I,e,h),B(e,l),B(e,o),B(e,i),B(e,r),B(r,s),k(I,u,h),A[c].m(I,h),k(I,_,h),j=!0},p(I,h){(!j||h&1)&&t!==(t=I[0].stage+"")&&re(o,t),(!j||h&3)&&a!==(a=I[1].jat[I[0].idx].name+"")&&re(s,a);let w=c;c=M(I),c===w?A[c].p(I,h):(de(),L(A[w],1,1,()=>{A[w]=null}),ge(),g=A[c],g?g.p(I,h):(g=A[c]=S[c](I),g.c()),y(g,1),g.m(_.parentNode,_))},i(I){j||(y(g),j=!0)},o(I){L(g),j=!1},d(I){I&&(p(e),p(u),p(_)),A[c].d(I)}}}function $t(n){let e,l;return e=new ul({props:{junctionIdx:n[0].idx,stage:n[0].stage,$$slots:{default:[bl]},$$scope:{ctx:n}}}),{c(){F(e.$$.fragment)},l(t){O(e.$$.fragment,t)},m(t,o){q(e,t,o),l=!0},p(t,o){const i={};o&1&&(i.junctionIdx=t[0].idx),o&1&&(i.stage=t[0].stage),o&8195&&(i.$$scope={dirty:o,ctx:t}),e.$set(i)},i(t){l||(y(e.$$.fragment,t),l=!0)},o(t){L(e.$$.fragment,t),l=!1},d(t){z(e,t)}}}function kl(n){let e;return{c(){e=R("Add new junction")},l(l){e=H(l,"Add new junction")},m(l,t){k(l,e,t)},d(l){l&&p(e)}}}function wl(n){let e,l,t,o=pe(n[10].existing)+"",i,r,a,s,u=pe(n[10].proposed)+"",c,g;return{c(){e=X("div"),l=X("span"),t=R("Existing: "),i=R(o),r=P(),a=X("span"),s=R("Proposed: "),c=R(u),g=P(),this.h()},l(_){e=Z(_,"DIV",{style:!0});var j=K(e);l=Z(j,"SPAN",{});var S=K(l);t=H(S,"Existing: "),i=H(S,o),S.forEach(p),r=D(j),a=Z(j,"SPAN",{});var A=K(a);s=H(A,"Proposed: "),c=H(A,u),A.forEach(p),j.forEach(p),g=D(_),this.h()},h(){x(e,"width","100%"),x(e,"display","flex"),x(e,"justify-content","space-between")},m(_,j){k(_,e,j),B(e,l),B(l,t),B(l,i),B(e,r),B(e,a),B(a,s),B(a,c),k(_,g,j)},p(_,j){j&2&&o!==(o=pe(_[10].existing)+"")&&re(i,o),j&2&&u!==(u=pe(_[10].proposed)+"")&&re(c,u)},d(_){_&&(p(e),p(g))}}}function ht(n){let e,l;function t(){return n[4](n[12])}return e=new He({props:{name:n[10].name||"Untitled junction",$$slots:{default:[wl]},$$scope:{ctx:n}}}),e.$on("click",t),{c(){F(e.$$.fragment)},l(o){O(e.$$.fragment,o)},m(o,i){q(e,o,i),l=!0},p(o,i){n=o;const r={};i&2&&(r.name=n[10].name||"Untitled junction"),i&8194&&(r.$$scope={dirty:i,ctx:n}),e.$set(r)},i(o){l||(y(e.$$.fragment,o),l=!0)},o(o){L(e.$$.fragment,o),l=!1},d(o){z(e,o)}}}function jl(n){let e,l,t,o;const i=[ml,cl],r=[];function a(s,u){return s[0].kind=="list"?0:s[0].kind=="edit"?1:-1}return~(e=a(n))&&(l=r[e]=i[e](n)),{c(){l&&l.c(),t=ce()},l(s){l&&l.l(s),t=ce()},m(s,u){~e&&r[e].m(s,u),k(s,t,u),o=!0},p(s,[u]){let c=e;e=a(s),e===c?~e&&r[e].p(s,u):(l&&(de(),L(r[c],1,1,()=>{r[c]=null}),ge()),~e?(l=r[e],l?l.p(s,u):(l=r[e]=i[e](s),l.c()),y(l,1),l.m(t.parentNode,t)):l=null)},i(s){o||(y(l),o=!0)},o(s){L(l),o=!1},d(s){s&&p(t),~e&&r[e].d(s)}}}function De(n){if(n.kind=="list")throw new Error("Unreachable case");return n.idx}function yl(n,e,l){let t;Ne(n,ne,j=>l(1,t=j));let o={kind:"list"};function i(){Ee(ne,t.jat=[...t.jat,{name:"",existing:{arms:[],movements:[],notes:""},proposed:{arms:[],movements:[],notes:""}}],t),l(0,o={kind:"edit",idx:t.jat.length-1,stage:"existing"})}function r(j){window.confirm("Delete this junction?")&&(t.jat.splice(j,1),ne.set(t),l(0,o={kind:"list"}))}const a=j=>l(0,o={kind:"edit",idx:j,stage:"existing"}),s=()=>l(0,o={kind:"list"}),u=()=>r(De(o));function c(j){n.$$.not_equal(t.jat[o.idx].name,j)&&(t.jat[o.idx].name=j,ne.set(t))}return[o,t,i,r,a,s,u,c,()=>l(0,o={kind:"edit",idx:De(o),stage:"existing"}),()=>l(0,o={kind:"edit",idx:De(o),stage:"proposed"})]}class Zl extends je{constructor(e){super(),ye(this,e,yl,jl,be,{})}}export{Zl as component};
